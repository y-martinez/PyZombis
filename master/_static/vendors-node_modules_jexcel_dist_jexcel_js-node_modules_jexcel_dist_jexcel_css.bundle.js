(self["webpackChunkWebComponents"] = self["webpackChunkWebComponents"] || []).push([["vendors-node_modules_jexcel_dist_jexcel_js-node_modules_jexcel_dist_jexcel_css"],{

/***/ 27010:
/*!********************************************!*\
  !*** ./node_modules/jexcel/dist/jexcel.js ***!
  \********************************************/
/***/ (function(module, __unused_webpack_exports, __webpack_require__) {


/**
 * jExcel v3.9.1
 *
 * Author: Paul Hodel <paul.hodel@gmail.com>
 * Website: https://bossanova.uk/jexcel/
 * Description: Create amazing web based spreadsheets.
 *
 * This software is distribute under MIT License
 */

 if (! jSuites && "function" === 'function') {
    var jSuites = __webpack_require__(/*! jsuites */ 45551);
    __webpack_require__(/*! jsuites/dist/jsuites.css */ 41892);
}

;(function (global, factory) {
     true ? module.exports = factory() :
    0;
}(this, (function () {

    'use strict';

// Jexcel core object

var jexcel = (function(el, options) {
    // Create jexcel object
    var obj = {};
    obj.options = {};

    if (! (el instanceof Element || el instanceof HTMLDocument)) {
        console.error('JEXCEL: el is not a valid DOM element');
        return false;
    }

    // Loading default configuration
    var defaults = {
        // External data
        url:null,
        // Data
        data:null,
        // Copy behavior
        copyCompatibility:false,
        // Rows and columns definitions
        rows:[],
        columns:[],
        // Deprected legacy options
        colHeaders:[],
        colWidths:[],
        colAlignments:[],
        nestedHeaders:null,
        // Column width that is used by default
        defaultColWidth:50,
        defaultColAlign:'center',
        // Spare rows and columns
        minSpareRows:0,
        minSpareCols:0,
        // Minimal table dimensions
        minDimensions:[0,0],
        // Allow Export
        allowExport:true,
        // @type {boolean} - Include the header titles on download
        includeHeadersOnDownload:false,
        // Allow column sorting
        columnSorting:true,
        // Allow column dragging
        columnDrag:false,
        // Allow column resizing
        columnResize:true,
        // Allow row resizing
        rowResize:false,
        // Allow row dragging
        rowDrag:true,
        // Allow table edition
        editable:true,
        // Allow new rows
        allowInsertRow:true,
        // Allow new rows
        allowManualInsertRow:true,
        // Allow new columns
        allowInsertColumn:true,
        // Allow new rows
        allowManualInsertColumn:true,
        // Allow row delete
        allowDeleteRow:true,
        // Allow deleting of all rows
        allowDeletingAllRows:false,
        // Allow column delete
        allowDeleteColumn:true,
        // Allow rename column
        allowRenameColumn:true,
        // Allow comments
        allowComments:false,
        // Global wrap
        wordWrap:false,
        // Image options
        imageOptions: null,
        // CSV source
        csv:null,
        // Filename
        csvFileName:'jexcel',
        // Consider first line as header
        csvHeaders:true,
        // Delimiters
        csvDelimiter:',',
        // Disable corner selection
        selectionCopy:true,
        // Merged cells
        mergeCells:{},
        // Create toolbar
        toolbar:null,
        // Allow search
        search:false,
        // Create pagination
        pagination:false,
        paginationOptions:null,
        // Full screen
        fullscreen:false,
        // Lazy loading
        lazyLoading:false,
        loadingSpin:false,
        // Table overflow
        tableOverflow:false,
        tableHeight:'300px',
        tableWidth:null,
        // Meta
        meta: null,
        // Style
        style:null,
        // Execute formulas
        parseFormulas:true,
        autoIncrement:true,
        autoCasting:true,
        // Event handles
        onundo:null,
        onredo:null,
        onload:null,
        onchange:null,
        onbeforechange:null,
        onafterchanges:null,
        onbeforeinsertrow: null,
        oninsertrow:null,
        onbeforeinsertcolumn: null,
        oninsertcolumn:null,
        onbeforedeleterow:null,
        ondeleterow:null,
        onbeforedeletecolumn:null,
        ondeletecolumn:null,
        onmoverow:null,
        onmovecolumn:null,
        onresizerow:null,
        onresizecolumn:null,
        onsort:null,
        onselection:null,
        onpaste:null,
        onbeforepaste:null,
        onmerge:null,
        onfocus:null,
        onblur:null,
        onchangeheader:null,
        oneditionstart:null,
        oneditionend:null,
        onchangestyle:null,
        onchangemeta:null,
        onchangepage:null,
        // Customize any cell behavior
        updateTable:null,
        // Detach the HTML table when calling updateTable
        detachForUpdates: false,
        // Texts
        text:{
            noRecordsFound: 'No records found',
            showingPage: 'Showing page {0} of {1} entries',
            show: 'Show ',
            search: 'Search',
            entries: ' entries',
            columnName: 'Column name',
            insertANewColumnBefore: 'Insert a new column before',
            insertANewColumnAfter: 'Insert a new column after',
            deleteSelectedColumns: 'Delete selected columns',
            renameThisColumn: 'Rename this column',
            orderAscending: 'Order ascending',
            orderDescending: 'Order descending',
            insertANewRowBefore: 'Insert a new row before',
            insertANewRowAfter: 'Insert a new row after',
            deleteSelectedRows: 'Delete selected rows',
            editComments: 'Edit comments',
            addComments: 'Add comments',
            comments: 'Comments',
            clearComments: 'Clear comments',
            copy: 'Copy...',
            paste: 'Paste...',
            saveAs: 'Save as...',
            about: 'About',
            areYouSureToDeleteTheSelectedRows: 'Are you sure to delete the selected rows?',
            areYouSureToDeleteTheSelectedColumns: 'Are you sure to delete the selected columns?',
            thisActionWillDestroyAnyExistingMergedCellsAreYouSure: 'This action will destroy any existing merged cells. Are you sure?',
            thisActionWillClearYourSearchResultsAreYouSure: 'This action will clear your search results. Are you sure?',
            thereIsAConflictWithAnotherMergedCell: 'There is a conflict with another merged cell',
            invalidMergeProperties: 'Invalid merged properties',
            cellAlreadyMerged: 'Cell already merged',
            noCellsSelected: 'No cells selected',
        },
        // About message
        about:"jExcel CE Spreadsheet\nVersion 3.9.1\nAuthor: Paul Hodel <paul.hodel@gmail.com>\nWebsite: https://bossanova.uk/jexcel/v3",
    };

    // Loading initial configuration from user
    for (var property in defaults) {
        if (options && options.hasOwnProperty(property)) {
            if (property === 'text') {
                obj.options[property] = defaults[property];
                for (var textKey in options[property]) {
                    if (options[property].hasOwnProperty(textKey)){
                        obj.options[property][textKey] = options[property][textKey];
                    }
                }
            } else {
                obj.options[property] = options[property];
            }
        } else {
            obj.options[property] = defaults[property];
        }
    }

    // Global elements
    obj.el = el;
    obj.corner = null;
    obj.contextMenu = null;
    obj.textarea = null;
    obj.ads = null;
    obj.content = null;
    obj.table = null;
    obj.thead = null;
    obj.tbody = null;
    obj.rows = [];
    obj.results = null;
    obj.searchInput = null;
    obj.toolbar = null;
    obj.pagination = null;
    obj.pageNumber = null;
    obj.headerContainer = null;
    obj.colgroupContainer = null;

    // Containers
    obj.headers = [];
    obj.records = [];
    obj.history = [];
    obj.formula = [];
    obj.colgroup = [];
    obj.selection = [];
    obj.highlighted  = [];
    obj.selectedCell = null;
    obj.selectedContainer = null;
    obj.style = [];
    obj.data = null;

    // Internal controllers
    obj.cursor = null;
    obj.historyIndex = -1;
    obj.ignoreEvents = false;
    obj.ignoreHistory = false;
    obj.edition = null;
    obj.hashString = null;
    obj.resizing = null;
    obj.dragging = null;

    // Lazy loading
    if (obj.options.lazyLoading == true && (obj.options.tableOverflow == false && obj.options.fullscreen == false)) {
        console.error('JEXCEL: The lazyloading only works when tableOverflow = yes or fullscreen = yes');
        obj.options.lazyLoading = false;
    }
    
    /**
     * Activate/Disable fullscreen 
     * use programmatically : table.fullscreen(); or table.fullscreen(true); or table.fullscreen(false);
     * @Param {boolean} activate
     */
    obj.fullscreen = function(activate) {
        // If activate not defined, get reverse options.fullscreen
        if (activate == null) {
            activate = ! obj.options.fullscreen;
        }

        // If change
        if (obj.options.fullscreen != activate) {
            obj.options.fullscreen = activate;

            // Test LazyLoading conflict
            if (activate == true) {
                el.classList.add('fullscreen');
            } else {
                el.classList.remove('fullscreen');
            }
        } 
    }

    /**
     * Prepare the jexcel table
     * 
     * @Param config
     */
    obj.prepareTable = function() {
        // Loading initial data from remote sources
        var results = [];

        // Number of columns
        var size = obj.options.columns.length;

        if (obj.options.data && typeof(obj.options.data[0]) !== 'undefined') {
            // Data keys
            var keys = Object.keys(obj.options.data[0]);

            if (keys.length > size) {
                size = keys.length;
            }
        }

        // Minimal dimensions
        if (obj.options.minDimensions[0] > size) {
            size = obj.options.minDimensions[0];
        }

        // Requests
        var multiple = [];

        // Preparations
        for (var i = 0; i < size; i++) {
            // Deprected options. You should use only columns
            if (! obj.options.colHeaders[i]) {
                obj.options.colHeaders[i] = '';
            }
            if (! obj.options.colWidths[i]) {
                obj.options.colWidths[i] = obj.options.defaultColWidth;
            }
            if (! obj.options.colAlignments[i]) {
                obj.options.colAlignments[i] = obj.options.defaultColAlign;
            }

            // Default column description
            if (! obj.options.columns[i]) {
                obj.options.columns[i] = { type:'text' };
            } else if (! obj.options.columns[i].type) {
                obj.options.columns[i].type = 'text';
            }
            if (! obj.options.columns[i].name) {
                obj.options.columns[i].name = keys && keys[i] ? keys[i] : i;
            }
            if (! obj.options.columns[i].source) {
                obj.options.columns[i].source = [];
            }
            if (! obj.options.columns[i].options) {
                obj.options.columns[i].options = [];
            }
            if (! obj.options.columns[i].editor) {
                obj.options.columns[i].editor = null;
            }
            if (! obj.options.columns[i].allowEmpty) {
                obj.options.columns[i].allowEmpty = false;
            }
            if (! obj.options.columns[i].title) {
                obj.options.columns[i].title = obj.options.colHeaders[i] ? obj.options.colHeaders[i] : '';
            }
            if (! obj.options.columns[i].width) {
                obj.options.columns[i].width = obj.options.colWidths[i] ? obj.options.colWidths[i] : obj.options.defaultColWidth;
            }
            if (! obj.options.columns[i].align) {
                obj.options.columns[i].align = obj.options.colAlignments[i] ? obj.options.colAlignments[i] : 'center';
            }

            // Pre-load initial source for json autocomplete
            if (obj.options.columns[i].type == 'autocomplete' || obj.options.columns[i].type == 'dropdown') {
                // if remote content
                if (obj.options.columns[i].url) {
                    multiple.push(jSuites.ajax({
                        url: obj.options.columns[i].url,
                        index: i,
                        method: 'GET',
                        dataType: 'json',
                        multiple: multiple,
                        success: function(data) {
                            var source = [];
                            for (var i = 0; i < data.length; i++) {
                                obj.options.columns[this.index].source.push(data[i]);
                            }
                        },
                        complete: function() {
                            obj.createTable();
                        }
                    }));
                }
            } else if (obj.options.columns[i].type == 'calendar') {
                // Default format for date columns
                if (! obj.options.columns[i].options.format) {
                    obj.options.columns[i].options.format = 'DD/MM/YYYY';
                }
            }
        }

        // On complete
        if (! multiple.length) {
            obj.createTable();
        }
    }

    obj.createTable = function() {
        // Elements
        obj.table = document.createElement('table');
        obj.thead = document.createElement('thead');
        obj.tbody = document.createElement('tbody');

        // Create headers controllers
        obj.headers = [];
        obj.colgroup = [];

        // Create table container
        obj.content = document.createElement('div');
        obj.content.classList.add('jexcel_content');

        // Create toolbar object
        obj.toolbar = document.createElement('div');
        obj.toolbar.classList.add('jexcel_toolbar');

        // Search
        var searchContainer = document.createElement('div');
        var searchText = document.createTextNode((obj.options.text.search) + ': ');
        obj.searchInput = document.createElement('input');
        obj.searchInput.classList.add('jexcel_search');
        searchContainer.appendChild(searchText);
        searchContainer.appendChild(obj.searchInput);
        obj.searchInput.onfocus = function() {
            obj.resetSelection();
        }

        // Pagination select option
        var paginationUpdateContainer = document.createElement('div');

        if (obj.options.pagination > 0 && obj.options.paginationOptions && obj.options.paginationOptions.length > 0) {
            obj.paginationDropdown = document.createElement('select');
            obj.paginationDropdown.classList.add('jexcel_pagination_dropdown');
            obj.paginationDropdown.onchange = function() {
                obj.options.pagination = parseInt(this.value);
                obj.page(0);
            }

            for (var i = 0; i < obj.options.paginationOptions.length; i++) {
                var temp = document.createElement('option');
                temp.value = obj.options.paginationOptions[i];
                temp.innerHTML = obj.options.paginationOptions[i];
                obj.paginationDropdown.appendChild(temp);
            }

            paginationUpdateContainer.appendChild(document.createTextNode(obj.options.text.show));
            paginationUpdateContainer.appendChild(obj.paginationDropdown);
            paginationUpdateContainer.appendChild(document.createTextNode(obj.options.text.entries));
        }

        // Filter and pagination container
        obj.filter = document.createElement('div');
        obj.filter.classList.add('jexcel_filter');
        obj.filter.appendChild(paginationUpdateContainer);
        obj.filter.appendChild(searchContainer);

        // Colsgroup
        obj.colgroupContainer = document.createElement('colgroup');
        var tempCol = document.createElement('col');
        tempCol.setAttribute('width', '50');
        obj.colgroupContainer.appendChild(tempCol);

        // Nested
        if (obj.options.nestedHeaders && obj.options.nestedHeaders.length > 0) {
            // Flexible way to handle nestedheaders
            if (obj.options.nestedHeaders[0] && obj.options.nestedHeaders[0][0]) {
                for (var j = 0; j < obj.options.nestedHeaders.length; j++) {
                    obj.thead.appendChild(obj.createNestedHeader(obj.options.nestedHeaders[j]));
                }
            } else {
                obj.thead.appendChild(obj.createNestedHeader(obj.options.nestedHeaders));
            }
        }

        // Row
        obj.headerContainer = document.createElement('tr');
        var tempCol = document.createElement('td');
        tempCol.classList.add('jexcel_selectall');
        obj.headerContainer.appendChild(tempCol);

        for (var i = 0; i < obj.options.columns.length; i++) {
            // Create header
            obj.createCellHeader(i);
            // Append cell to the container
            obj.headerContainer.appendChild(obj.headers[i]);
            obj.colgroupContainer.appendChild(obj.colgroup[i]);
        }

        obj.thead.appendChild(obj.headerContainer);

        // Content table
        obj.table = document.createElement('table');
        obj.table.classList.add('jexcel');
        obj.table.setAttribute('cellpadding', '0');
        obj.table.setAttribute('cellspacing', '0');
        obj.table.setAttribute('unselectable', 'yes');
        obj.table.setAttribute('onselectstart', 'return false');
        obj.table.appendChild(obj.colgroupContainer);
        obj.table.appendChild(obj.thead);
        obj.table.appendChild(obj.tbody);

        // Spreadsheet corner
        obj.corner = document.createElement('div');
        obj.corner.className = 'jexcel_corner';
        obj.corner.setAttribute('unselectable', 'on');
        obj.corner.setAttribute('onselectstart', 'return false');

        if (obj.options.selectionCopy == false) {
            obj.corner.style.display = 'none';
        }

        // Textarea helper
        obj.textarea = document.createElement('textarea');
        obj.textarea.className = 'jexcel_textarea';
        obj.textarea.id = 'jexcel_textarea';
        obj.textarea.tabIndex = '-1';

        // Contextmenu container
        obj.contextMenu = document.createElement('div');
        obj.contextMenu.className = 'jexcel_contextmenu';

        // Create element
        jSuites.contextmenu(obj.contextMenu, {
            onclick:function() {
                obj.contextMenu.contextmenu.close(false);
            }
        });

        // Powered by jExcel
        var ads = document.createElement('a');
        ads.setAttribute('href', 'https://bossanova.uk/jexcel/');
        obj.ads = document.createElement('div');
        obj.ads.className = 'jexcel_about';
        if (typeof(sessionStorage) !== "undefined" && ! sessionStorage.getItem('jexcel')) {
            sessionStorage.setItem('jexcel', true);
            var img = document.createElement('img');
            img.src = '//bossanova.uk/jexcel/logo.png';
            ads.appendChild(img);
        }
        var span = document.createElement('span');
        span.innerHTML = 'Jexcel spreadsheet';
        ads.appendChild(span);
        obj.ads.appendChild(ads);

        // Create table container TODO: frozen columns
        var container = document.createElement('div');
        container.classList.add('jexcel_table');

        // Pagination
        obj.pagination = document.createElement('div');
        obj.pagination.classList.add('jexcel_pagination');
        var paginationInfo = document.createElement('div');
        var paginationPages = document.createElement('div');
        obj.pagination.appendChild(paginationInfo);
        obj.pagination.appendChild(paginationPages);

        // Hide pagination if not in use
        if (! obj.options.pagination) {
            obj.pagination.style.display = 'none';
        }

        // Append containers to the table
        if (obj.options.search == true) {
            el.appendChild(obj.filter);
        }

        // Elements
        obj.content.appendChild(obj.table);
        obj.content.appendChild(obj.corner);
        obj.content.appendChild(obj.textarea);

        el.appendChild(obj.toolbar);
        el.appendChild(obj.content);
        el.appendChild(obj.pagination);
        el.appendChild(obj.contextMenu);
        el.appendChild(obj.ads);
        el.classList.add('jexcel_container');

        // Create toolbar
        if (obj.options.toolbar && obj.options.toolbar.length) {
            obj.createToolbar();
        }

        // Fullscreen
        if (obj.options.fullscreen == true) {
            el.classList.add('fullscreen');
        } else {
            // Overflow
            if (obj.options.tableOverflow == true) {
                if (obj.options.tableHeight) {
                    obj.content.style['overflow-y'] = 'auto';
                    obj.content.style.maxHeight = obj.options.tableHeight;
                }
                if (obj.options.tableWidth) {
                    obj.content.style['overflow-x'] = 'auto';
                    obj.content.style.width = obj.options.tableWidth;
                }
            }
        }

        // With toolbars
        if (obj.options.tableOverflow != true && obj.options.toolbar) {
            el.classList.add('with-toolbar');
        }

        // Actions
        if (obj.options.columnDrag == true) {
            obj.thead.classList.add('draggable');
        }
        if (obj.options.columnResize == true) {
            obj.thead.classList.add('resizable');
        }
        if (obj.options.rowDrag == true) {
            obj.tbody.classList.add('draggable');
        }
        if (obj.options.rowResize == true) {
            obj.tbody.classList.add('resizable');
        }

        // Load data
        obj.setData();

        // Style
        if (obj.options.style) {
            obj.setStyle(obj.options.style, null, null, 1, 1);
        }
    }

    /**
     * Refresh the data
     * 
     * @return void
     */
    obj.refresh = function() {
        if (obj.options.url) {
            // Loading
            if (obj.options.loadingSpin == true) {
                jSuites.loading.show();
            }

            jSuites.ajax({
                url: obj.options.url,
                method: 'GET',
                dataType: 'json',
                success: function(result) {
                    // Data
                    obj.options.data = (result.data) ? result.data : result;
                    // Prepare table
                    obj.setData();
                    // Hide spin
                    if (obj.options.loadingSpin == true) {
                        jSuites.loading.hide();
                    }
                }
            });
        } else {
            obj.setData();
        }
    }

    /**
     * Set data
     * 
     * @param array data In case no data is sent, default is reloaded
     * @return void
     */
    obj.setData = function(data) {
        // Update data
        if (data) {
            if (typeof(data) == 'string') {
                data = JSON.parse(data);
            }

            obj.options.data = data;
        }

        // Data
        if (! obj.options.data) {
            obj.options.data = [];
        }

        // Prepare data
        if (obj.options.data) {
            var data = [];
            for (var j = 0; j < obj.options.data.length; j++) {
                var row = [];
                for (var i = 0; i < obj.options.columns.length; i++) {
                    row[i] = obj.options.data[j][obj.options.columns[i].name];
                }
                data.push(row);
            }

            obj.options.data = data;
        }

        // Adjust minimal dimensions
        var j = 0;
        var i = 0;
        var size_i = obj.options.columns.length;
        var size_j = obj.options.data.length;
        var min_i = obj.options.minDimensions[0];
        var min_j = obj.options.minDimensions[1];
        var max_i = min_i > size_i ? min_i : size_i;
        var max_j = min_j > size_j ? min_j : size_j;

        for (j = 0; j < max_j; j++) {
            for (i = 0; i < max_i; i++) {
                if (obj.options.data[j] == undefined) {
                    obj.options.data[j] = [];
                }

                if (obj.options.data[j][i] == undefined) {
                    obj.options.data[j][i] = '';
                }
            }
        }

        // Reset containers
        obj.rows = [];
        obj.results = null;
        obj.records = [];
        obj.history = [];

        // Reset internal controllers
        obj.historyIndex = -1;

        // Reset data
        obj.tbody.innerHTML = '';

        // Lazy loading
        if (obj.options.lazyLoading == true) {
            // Load only 100 records
            var startNumber = 0
            var finalNumber = obj.options.data.length < 100 ? obj.options.data.length : 100;

            if (obj.options.pagination) {
                obj.options.pagination = false;
                console.error('JEXCEL: Pagination will be disable due the lazyLoading');
            }
        } else if (obj.options.pagination) {
            // Pagination
            if (! obj.pageNumber) {
                obj.pageNumber = 0;
            }
            var quantityPerPage = obj.options.pagination;
            startNumber = (obj.options.pagination * obj.pageNumber);
            finalNumber = (obj.options.pagination * obj.pageNumber) + obj.options.pagination;

            if (obj.options.data.length < finalNumber) {
                finalNumber = obj.options.data.length;
            }
        } else {
            var startNumber = 0;
            var finalNumber = obj.options.data.length;
        }

        // Append nodes to the HTML
        for (j = 0; j < obj.options.data.length; j++) {
            // Create row
            var tr = obj.createRow(j, obj.options.data[j]);
            // Append line to the table
            if (j >= startNumber && j < finalNumber) {
                obj.tbody.appendChild(tr);
            }
        }

        if (obj.options.lazyLoading == true) {
            // Do not create pagination with lazyloading activated
        } else if (obj.options.pagination) {
            obj.updatePagination();
        }

        // Merge cells
        if (obj.options.mergeCells) {
            var keys = Object.keys(obj.options.mergeCells);
            for (var i = 0; i < keys.length; i++) {
                var num = obj.options.mergeCells[keys[i]];
                obj.setMerge(keys[i], num[0], num[1], 1);
            }
        }

        // Updata table with custom configurations if applicable
        obj.updateTable();

        // Onload
        if (! obj.ignoreEvents) {
            if (typeof(obj.options.onload) == 'function') {
                obj.options.onload(el, obj);
            }
        }
    }

    /**
     * Get the whole table data
     * 
     * @param bool get highlighted cells only
     * @return array data
     */
        obj.getData = function(highlighted, dataOnly) {
        // Control vars
        var dataset = [];
        var px = 0;
        var py = 0;

        // Data type
        var dataType = dataOnly == true || obj.options.copyCompatibility == false ? true : false;

        // Column and row length
        var x = obj.options.columns.length
        var y = obj.options.data.length

        // Go through the columns to get the data
        for (var j = 0; j < y; j++) {
            px = 0;
            for (var i = 0; i < x; i++) {
                // Cell selected or fullset
                if (! highlighted || obj.records[j][i].classList.contains('highlight')) {
                    // Get value
                    if (! dataset[py]) {
                        dataset[py] = [];
                    }
                    if (! dataType) {
                        dataset[py][px] = obj.records[j][i].innerHTML;
                    } else {
                        dataset[py][px] = obj.options.data[j][i];
                    }
                    px++;
                }
            }
            if (px > 0) {
                py++;
            }
       }

       return dataset;
    }

    /**
     * Get the whole table data
     * 
     * @param integer row number
     * @return string value
     */
    obj.getJson = function(highlighted) {
        // Control vars
        var data = [];

        // Column and row length
        var x = obj.options.columns.length
        var y = obj.options.data.length

        // Go through the columns to get the data
        for (var j = 0; j < y; j++) {
            var row = null;
            for (var i = 0; i < x; i++) {
                if (! highlighted || obj.records[j][i].classList.contains('highlight')) {
                    if (row == null) {
                        row = {};
                    }
                    row[obj.options.columns[i].name] = obj.options.data[j][i];
                }
            }

            if (row != null) {
                data.push(row);
            }
       }

       return data;
    }

    /**
     * Get a row data by rowNumber
     */
    obj.getRowData = function(rowNumber) {
        return obj.options.data[rowNumber];
    }

    /**
     * Set a row data by rowNumber
     */
    obj.setRowData = function(rowNumber, data) {
        for (var i = 0; i < obj.headers.length; i++) {
            // Update cell
            var columnName = jexcel.getColumnNameFromId([ i, rowNumber ]);
            // Set value
            if (data[i] != null) {
                obj.setValue(columnName, data[i]);
            }
        }
    }

    /**
     * Get a column data by columnNumber
     */
    obj.getColumnData = function(columnNumber) {
        var dataset = [];
        // Go through the rows to get the data
        for (var j = 0; j < obj.options.data.length; j++) {
            dataset.push(obj.options.data[j][columnNumber]);
        }
        return dataset;
    }

    /**
     * Set a column data by colNumber
     */
    obj.setColumnData = function(colNumber, data) {
        for (var j = 0; j < obj.rows.length; j++) {
            // Update cell
            var columnName = jexcel.getColumnNameFromId([ colNumber, j ]);
            // Set value
            if (data[j] != null) {
                obj.setValue(columnName, data[j]);
            }
        }
    }

    /**
     * Create row
     */
    obj.createRow = function(j, data) {
        // Create container
        if (! obj.records[j]) {
            obj.records[j] = [];
        }
        // Default data
        if (! data) {
            var data = obj.options.data[j];
        }
        // New line of data to be append in the table
        obj.rows[j] = document.createElement('tr');
        obj.rows[j].setAttribute('data-y', j);
        // Definitions
        if (obj.options.rows[j]) {
            if (obj.options.rows[j].height) {
                obj.rows[j].style.height = obj.options.rows[j].height;
            }
        }
        // Row number label
        var td = document.createElement('td');
        td.innerHTML = parseInt(j + 1);
        td.setAttribute('data-y', j);
        td.className = 'jexcel_row';
        obj.rows[j].appendChild(td);

        // Data columns
        for (i = 0; i < obj.options.columns.length; i++) {
            // New column of data to be append in the line
            obj.records[j][i] = obj.createCell(i, j, data[i]);
            // Add column to the row
            obj.rows[j].appendChild(obj.records[j][i]);
        }

        // Add row to the table body
        return obj.rows[j];
    }

    /**
     * Create cell
     */
    obj.createCell = function(i, j, value) {
        // Create cell and properties
        var td = document.createElement('td');
        td.setAttribute('data-x', i);
        td.setAttribute('data-y', j);
        // Hidden column
        if (obj.options.columns[i].type == 'hidden') {
            td.style.display = 'none';
            td.innerHTML = value;
        } else if (obj.options.columns[i].type == 'checkbox' || obj.options.columns[i].type == 'radio') {
            // Create input
            var element = document.createElement('input');
            element.type = obj.options.columns[i].type;
            element.name = 'c' + i;
            element.checked = (value == 1 || value == true || value == 'true') ? true : false;
            element.onclick = function() {
                obj.setValue(td, this.checked);
            }

            if (obj.options.columns[i].readOnly == true) {
                element.setAttribute('disabled', 'disabled');
            }

            // Append to the table
            td.appendChild(element);
            // Make sure the values are correct
            obj.options.data[j][i] = element.checked;
        } else if (obj.options.columns[i].type == 'calendar') {
            // Try formatted date
            var formatted = jSuites.calendar.extractDateFromString(value, obj.options.columns[i].options.format);
            // Create calendar cell
            td.innerHTML = jSuites.calendar.getDateString(formatted ? formatted : value, obj.options.columns[i].options.format);
        } else if (obj.options.columns[i].type == 'dropdown' || obj.options.columns[i].type == 'autocomplete') {
            // Create dropdown cell
            td.classList.add('jexcel_dropdown');
            td.innerHTML = obj.getDropDownValue(i, value);
        } else if (obj.options.columns[i].type == 'color') {
            if (obj.options.columns[i].render == 'square') {
                var color = document.createElement('div');
                color.className = 'color';
                color.style.backgroundColor = value;
                td.appendChild(color);
            } else {
                td.style.color = value;
                td.innerHTML = value;
            }
        } else if (obj.options.columns[i].type == 'image') {
            if (value && value.substr(0, 10) == 'data:image') {
                var img = document.createElement('img');
                img.src = value;
                td.appendChild(img);
            }
        } else {
            if ((''+value).substr(0,1) == '=' && obj.options.parseFormulas == true) {
                value = obj.executeFormula(value, i, j)
            }
            if (obj.options.columns[i].mask) {
                var decimal = obj.options.columns[i].decimal || '.';
                value = '' + jSuites.mask.run(value, obj.options.columns[i].mask, decimal);
            }

            td.innerHTML = value;
        }

        // Readonly
        if (obj.options.columns[i].readOnly == true) {
            td.className = 'readonly';
        }

        // Text align
        var colAlign = obj.options.columns[i].align ? obj.options.columns[i].align : 'center';
        td.style.textAlign = colAlign;

        // Wrap option
        if (obj.options.columns[i].wordWrap != false && (obj.options.wordWrap == true || obj.options.columns[i].wordWrap == true || td.innerHTML.length > 200)) {
            td.style.whiteSpace = 'pre-wrap';
        }

        // Overflow
        if (i > 0) {
            if (value || td.innerHTML) {
                obj.records[j][i-1].style.overflow = 'hidden';
            } else {
                if (i == obj.options.columns.length - 1) {
                    td.style.overflow = 'hidden';
                }
            }
        }

        return td;
    }

    obj.createCellHeader = function(colNumber) {
        // Create col global control
        var colWidth = obj.options.columns[colNumber].width ? obj.options.columns[colNumber].width : obj.options.defaultColWidth;
        var colAlign = obj.options.columns[colNumber].align ? obj.options.columns[colNumber].align : obj.options.defaultColAlign;

        // Create header cell
        obj.headers[colNumber] = document.createElement('td');
        obj.headers[colNumber].innerHTML = obj.options.columns[colNumber].title ? obj.options.columns[colNumber].title : jexcel.getColumnName(colNumber);
        obj.headers[colNumber].setAttribute('data-x', colNumber);
        obj.headers[colNumber].style.textAlign = colAlign;
        if (obj.options.columns[colNumber].title) {
            obj.headers[colNumber].setAttribute('title', obj.options.columns[colNumber].title);
        }

        // Width control
        obj.colgroup[colNumber] = document.createElement('col');
        obj.colgroup[colNumber].setAttribute('width', colWidth);

        // Hidden column
        if (obj.options.columns[colNumber].type == 'hidden') {
            obj.headers[colNumber].style.display = 'none';
            obj.colgroup[colNumber].style.display = 'none';
        }
    }

    obj.createNestedHeader = function(nestedInformation) {
        var tr = document.createElement('tr');
        tr.classList.add('jexcel_nested');
        var td = document.createElement('td');
        tr.appendChild(td);

        var headerIndex = 0;
        for (var i = 0; i < nestedInformation.length; i++) {
            // Default values
            if (! nestedInformation[i].colspan) {
                nestedInformation[i].colspan = 1;
            }
            if (! nestedInformation[i].align) {
                nestedInformation[i].align = 'center';
            }
            if (! nestedInformation[i].title) {
                nestedInformation[i].title = '';
            }

            // Number of columns
            var numberOfColumns = nestedInformation[i].colspan;

            // Classes container
            var column = [];
            // Header classes for this cell
            for (var x = 0; x < numberOfColumns; x++) {
                if (obj.options.columns[headerIndex] && obj.options.columns[headerIndex].type == 'hidden') {
                    numberOfColumns++;
                }
                column.push(headerIndex);
                headerIndex++;
            }

            // Created the nested cell
            var td = document.createElement('td');
            td.setAttribute('data-column', column.join(','));
            td.setAttribute('colspan', nestedInformation[i].colspan);
            td.setAttribute('align', nestedInformation[i].align);
            td.innerHTML = nestedInformation[i].title;
            tr.appendChild(td);
        }

        return tr;
    }

    /**
     * Create toolbar
     */
    obj.createToolbar = function(toolbar) {
        if (toolbar) {
            obj.options.toolbar = toolbar;
        } else {
            var toolbar = obj.options.toolbar;
        }

        for (var i = 0; i < toolbar.length; i++) {
            if (toolbar[i].type == 'i') {
                var toolbarItem = document.createElement('i');
                toolbarItem.classList.add('jexcel_toolbar_item');
                toolbarItem.classList.add('material-icons');
                toolbarItem.setAttribute('data-k', toolbar[i].k);
                toolbarItem.setAttribute('data-v', toolbar[i].v);
                // Tooltip
                if (toolbar[i].tooltip) {
                    toolbarItem.setAttribute('title', toolbar[i].tooltip);
                }
                // Handle click
                if (toolbar[i].onclick && typeof(toolbar[i].onclick)) {
                    toolbarItem.onclick = toolbar[i].onclick;
                } else {
                    toolbarItem.onclick = function() {
                        var k = this.getAttribute('data-k');
                        var v = this.getAttribute('data-v');
                        obj.setStyle(obj.highlighted, k, v);
                    }
                }
                // Append element
                toolbarItem.innerHTML = toolbar[i].content;
                obj.toolbar.appendChild(toolbarItem);
            } else if (toolbar[i].type == 'select') {
               var toolbarItem = document.createElement('select');
               toolbarItem.classList.add('jexcel_toolbar_item');
               toolbarItem.setAttribute('data-k', toolbar[i].k);
               // Tooltip
               if (toolbar[i].tooltip) {
                   toolbarItem.setAttribute('title', toolbar[i].tooltip);
               }
               // Handle onchange
               if (toolbar[i].onchange && typeof(toolbar[i].onchange)) {
                   toolbarItem.onchange = toolbar[i].onchange;
               } else {
                   toolbarItem.onchange = function() {
                       var k = this.getAttribute('data-k');
                       obj.setStyle(obj.highlighted, k, this.value);
                   }
               }
               // Add options to the dropdown
               for(var j = 0; j < toolbar[i].v.length; j++) {
                    var toolbarDropdownOption = document.createElement('option');
                    toolbarDropdownOption.value = toolbar[i].v[j];
                    toolbarDropdownOption.innerHTML = toolbar[i].v[j];
                    toolbarItem.appendChild(toolbarDropdownOption);
               }
               obj.toolbar.appendChild(toolbarItem);
            } else if (toolbar[i].type == 'color') {
                 var toolbarItem = document.createElement('i');
                 toolbarItem.classList.add('jexcel_toolbar_item');
                 toolbarItem.classList.add('material-icons');
                 toolbarItem.setAttribute('data-k', toolbar[i].k);
                 toolbarItem.setAttribute('data-v', '');
                 // Tooltip
                 if (toolbar[i].tooltip) {
                     toolbarItem.setAttribute('title', toolbar[i].tooltip);
                 }
                 obj.toolbar.appendChild(toolbarItem);
                 toolbarItem.onclick = function() {
                     this.color.open();
                 }
                 toolbarItem.innerHTML = toolbar[i].content;
                 jSuites.color(toolbarItem, {
                     onchange:function(o, v) {
                         var k = o.getAttribute('data-k');
                         obj.setStyle(obj.highlighted, k, v);
                     }
                 });
            }
        }
    }

    /**
     * Merge cells
     * @param cellName
     * @param colspan
     * @param rowspan
     * @param ignoreHistoryAndEvents
     */
    obj.setMerge = function(cellName, colspan, rowspan, ignoreHistoryAndEvents) {
        var test = false;

        if (! cellName) {
            if (! obj.highlighted.length) {
                alert(obj.options.text.noCellsSelected);
                return null;
            } else {
                var x1 = parseInt(obj.highlighted[0].getAttribute('data-x'));
                var y1 = parseInt(obj.highlighted[0].getAttribute('data-y'));
                var x2 = parseInt(obj.highlighted[obj.highlighted.length-1].getAttribute('data-x'));
                var y2 = parseInt(obj.highlighted[obj.highlighted.length-1].getAttribute('data-y'));
                var cellName = jexcel.getColumnNameFromId([ x1, y1 ]);
                var colspan = (x2 - x1) + 1;
                var rowspan = (y2 - y1) + 1;
            }
        }

        var cell = jexcel.getIdFromColumnName(cellName, true);

        if (obj.options.mergeCells[cellName]) {
            if (obj.records[cell[1]][cell[0]].getAttribute('data-merged')) {
                test = obj.options.text.cellAlreadyMerged;
            }
        } else if ((! colspan || colspan < 2) && (! rowspan || rowspan < 2)) {
            test = obj.options.text.invalidMergeProperties;
        } else {
            var cells = [];
            for (var j = cell[1]; j < cell[1] + rowspan; j++) {
                for (var i = cell[0]; i < cell[0] + colspan; i++) {
                    var columnName = jexcel.getColumnNameFromId([i, j]);
                    if (obj.records[j][i].getAttribute('data-merged')) {
                        test = obj.options.text.thereIsAConflictWithAnotherMergedCell;
                    }
                }
            }
        }

        if (test) {
            alert(test);
        } else {
            // Add property
            if (colspan > 1) {
                obj.records[cell[1]][cell[0]].setAttribute('colspan', colspan);
            } else {
                colspan = 1;
            }
            if (rowspan > 1) {
                obj.records[cell[1]][cell[0]].setAttribute('rowspan', rowspan);
            } else {
                rowspan = 1;
            }
            // Keep links to the existing nodes
            obj.options.mergeCells[cellName] = [ colspan, rowspan, [] ];
            // Mark cell as merged
            obj.records[cell[1]][cell[0]].setAttribute('data-merged', 'true');
            // Overflow
            obj.records[cell[1]][cell[0]].style.overflow = 'hidden';
            // History data
            var data = [];
            // Adjust the nodes
            for (var y = cell[1]; y < cell[1] + rowspan; y++) {
                for (var x = cell[0]; x < cell[0] + colspan; x++) {
                    if (! (cell[0] == x && cell[1] == y)) {
                        data.push(obj.options.data[y][x]);
                        obj.updateCell(x, y, '', true);
                        obj.options.mergeCells[cellName][2].push(obj.records[y][x]);
                        obj.records[y][x].style.display = 'none';
                        obj.records[y][x] = obj.records[cell[1]][cell[0]];
                    }
                }
            }
            // In the initialization is not necessary keep the history
            obj.updateSelection(obj.records[cell[1]][cell[0]]);

            if (! ignoreHistoryAndEvents) {
                obj.setHistory({
                    action:'setMerge',
                    column:cellName,
                    colspan:colspan,
                    rowspan:rowspan,
                    data:data,
                });

                if (typeof(obj.options.onmerge) == 'function') {
                    obj.options.onmerge(el, cellName, colspan, rowspan);
                }
            }
        }
    }

    /**
     * Merge cells
     * @param cellName
     * @param colspan
     * @param rowspan
     * @param ignoreHistoryAndEvents
     */
    obj.getMerge = function(cellName) {
        var data = {};
        if (cellName) {
            if (obj.options.mergeCells[cellName]) {
                data = [ obj.options.mergeCells[cellName][0], obj.options.mergeCells[cellName][1] ];
            } else {
                data = null;
            }
        } else {
            if (obj.options.mergeCells) {
                var mergedCells = obj.options.mergeCells;
                var keys = Object.keys(obj.options.mergeCells);
                for (var i = 0; i < keys.length; i++) {
                    data[keys[i]] = [ obj.options.mergeCells[keys[i]][0], obj.options.mergeCells[keys[i]][1] ];
                }
            }
        }

        return data;
    }

    /**
     * Remove merge by cellname
     * @param cellName
     */
    obj.removeMerge = function(cellName, data, keepOptions) {
        if (obj.options.mergeCells[cellName]) {
            var cell = jexcel.getIdFromColumnName(cellName, true);
            obj.records[cell[1]][cell[0]].removeAttribute('colspan');
            obj.records[cell[1]][cell[0]].removeAttribute('rowspan');
            obj.records[cell[1]][cell[0]].removeAttribute('data-merged');
            var info = obj.options.mergeCells[cellName];

            var index = 0;
            for (var j = 0; j < info[1]; j++) {
                for (var i = 0; i < info[0]; i++) {
                    if (j > 0 || i > 0) {
                        obj.records[cell[1]+j][cell[0]+i] = info[2][index];
                        obj.records[cell[1]+j][cell[0]+i].style.display = '';
                        // Recover data
                        if (data && data[index]) {
                            obj.updateCell(cell[0]+i, cell[1]+j, data[index]);
                        }
                        index++;
                    }
                }
            }

            // Update selection
            obj.updateSelection(obj.records[cell[1]][cell[0]], obj.records[cell[1]+j-1][cell[0]+i-1]);

            if (! keepOptions) {
                delete(obj.options.mergeCells[cellName]);
            }
        }
    }

    /**
     * Remove all merged cells
     */
    obj.destroyMerged = function(keepOptions) {
        // Remove any merged cells
        if (obj.options.mergeCells) {
            var mergedCells = obj.options.mergeCells;
            var keys = Object.keys(obj.options.mergeCells);
            for (var i = 0; i < keys.length; i++) {
                obj.removeMerge(keys[i], null, keepOptions);
            }
        }
    }

    /**
     * Is column merged
     */
    obj.isColMerged = function(x, insertBefore) {
        var cols = [];
        // Remove any merged cells
        if (obj.options.mergeCells) {
            var keys = Object.keys(obj.options.mergeCells);
            for (var i = 0; i < keys.length; i++) {
                var info = jexcel.getIdFromColumnName(keys[i], true);
                var colspan = obj.options.mergeCells[keys[i]][0];
                var x1 = info[0];
                var x2 = info[0] + (colspan > 1 ? colspan - 1 : 0);

                if (insertBefore == null) {
                    if ((x1 <= x && x2 >= x)) {
                        cols.push(keys[i]);
                    }
                } else {
                    if (insertBefore) {
                        if ((x1 < x && x2 >= x)) {
                            cols.push(keys[i]);
                        }
                    } else {
                        if ((x1 <= x && x2 > x)) {
                            cols.push(keys[i]);
                        }
                    }
                }
            }
        }

        return cols;
    }

    /**
     * Is rows merged
     */
    obj.isRowMerged = function(y, insertBefore) {
        var rows = [];
        // Remove any merged cells
        if (obj.options.mergeCells) {
            var keys = Object.keys(obj.options.mergeCells);
            for (var i = 0; i < keys.length; i++) {
                var info = jexcel.getIdFromColumnName(keys[i], true);
                var rowspan = obj.options.mergeCells[keys[i]][1];
                var y1 = info[1];
                var y2 = info[1] + (rowspan > 1 ? rowspan - 1 : 0);

                if (insertBefore == null) {
                    if ((y1 <= y && y2 >= y)) {
                        rows.push(keys[i]);
                    }
                } else {
                    if (insertBefore) {
                        if ((y1 < y && y2 >= y)) {
                            rows.push(keys[i]);
                        }
                    } else {
                        if ((y1 <= y && y2 > y)) {
                            rows.push(keys[i]);
                        }
                    }
                }
            }
        }

        return rows;
    }

    /**
     * Open the editor
     * 
     * @param object cell
     * @return void
     */
    obj.openEditor = function(cell, empty, e) {
        // Get cell position
        var y = cell.getAttribute('data-y');
        var x = cell.getAttribute('data-x');

        // On edition start
        if (! obj.ignoreEvents) {
            if (typeof(obj.options.oneditionstart) == 'function') {
                obj.options.oneditionstart(el, cell, x, y);
            }
        }

        // Overflow
        if (x > 0) {
            obj.records[y][x-1].style.overflow = 'hidden';
        }

        // Create editor
        var createEditor = function(type) {
            // Cell information
            var info = cell.getBoundingClientRect();

            // Create dropdown
            var editor = document.createElement(type);
            editor.style.width = (info.width) + 'px';
            editor.style.height = (info.height - 2) + 'px';
            editor.style.minHeight = (info.height - 2) + 'px';

            // Edit cell
            cell.classList.add('editor');
            cell.innerHTML = '';
            cell.appendChild(editor);

            return editor;
        }

        // Readonly
        if (cell.classList.contains('readonly') == true) {
            // Do nothing
        } else {
            // Holder
            obj.edition = [ obj.records[y][x], obj.records[y][x].innerHTML, x, y ];

            // If there is a custom editor for it
            if (obj.options.columns[x].editor) {
                // Custom editors
                obj.options.columns[x].editor.openEditor(cell, el, empty, e);
            } else {
                // Native functions
                if (obj.options.columns[x].type == 'hidden') {
                    // Do nothing
                } else if (obj.options.columns[x].type == 'checkbox' || obj.options.columns[x].type == 'radio') {
                    // Get value
                    var value = cell.children[0].checked ? false : true;
                    // Toogle value
                    obj.setValue(cell, value);
                    // Do not keep edition open
                    obj.edition = null;
                } else if (obj.options.columns[x].type == 'dropdown' || obj.options.columns[x].type == 'autocomplete') {
                    // Get current value
                    var value = obj.options.data[y][x];

                    // Create dropdown
                    if (typeof(obj.options.columns[x].filter) == 'function') {
                        var source = obj.options.columns[x].filter(el, cell, x, y, obj.options.columns[x].source);
                    } else {
                        var source = obj.options.columns[x].source;
                    }

                    // Create editor
                    var editor = createEditor('div');
                    var options = {
                        data: source,
                        multiple: obj.options.columns[x].multiple ? true : false,
                        autocomplete: obj.options.columns[x].autocomplete || obj.options.columns[x].type == 'autocomplete' ? true : false,
                        opened:true,
                        value: obj.options.columns[x].multiple ? value.split(';') : value,
                        width:'100%',
                        height:editor.style.minHeight,
                        position: (obj.options.tableOverflow == true || obj.options.fullscreen == true) ? true : false,
                        onclose:function() {
                            obj.closeEditor(cell, true);
                        }
                    };
                    if (obj.options.columns[x].options && obj.options.columns[x].options.type) {
                        options.type = obj.options.columns[x].options.type;
                    }
                    jSuites.dropdown(editor, options);
                } else if (obj.options.columns[x].type == 'calendar' || obj.options.columns[x].type == 'color') {
                    // Value
                    var value = obj.options.data[y][x];
                    // Create editor
                    var editor = createEditor('input');
                    editor.value = value;

                    if (obj.options.tableOverflow == true || obj.options.fullscreen == true) {
                        obj.options.columns[x].options.position = true;
                    }
                    obj.options.columns[x].options.value = obj.options.data[y][x];
                    obj.options.columns[x].options.opened = true;
                    obj.options.columns[x].options.onclose = function(el, value) {
                        obj.closeEditor(cell, true);
                    }
                    // Current value
                    if (obj.options.columns[x].type == 'color') {
                        jSuites.color(editor, obj.options.columns[x].options);
                    } else {
                        var calendar = jSuites.calendar(editor, obj.options.columns[x].options);
                        calendar.setValue(value);
                    }
                    // Focus on editor
                    editor.focus();
                } else if (obj.options.columns[x].type == 'image') {
                    // Value
                    var img = cell.children[0];
                    // Create editor
                    var editor = createEditor('div');
                    editor.style.position = 'relative';
                    var div = document.createElement('div');
                    div.classList.add('jclose');
                    if (img && img.src) {
                        div.appendChild(img);
                    }
                    editor.appendChild(div);
                    jSuites.image(div, obj.options.imageOptions);
                    const rect = cell.getBoundingClientRect();
                    const rectContent = div.getBoundingClientRect();
                    if (window.innerHeight < rect.bottom + rectContent.height) {
                        div.style.top = (rect.top - (rectContent.height + 2)) + 'px';
                    } else {
                        div.style.top = (rect.top) + 'px';
                    }
                } else {
                    // Value
                    var value = empty == true ? '' : obj.options.data[y][x];

                    // Basic editor
                    if (obj.options.columns[x].wordWrap != false && (obj.options.wordWrap == true || obj.options.columns[x].wordWrap == true)) {
                        var editor = createEditor('textarea');
                    } else {
                        var editor = createEditor('input');
                        // Mask
                        if (obj.options.columns[x].mask) {
                            editor.setAttribute('data-mask', obj.options.columns[x].mask);
                        }
                    }

                    editor.value = value;
                    editor.onblur = function() {
                        obj.closeEditor(cell, true);
                    };
                    editor.focus();
                }
            }
        }
    }

    /**
     * Close the editor and save the information
     * 
     * @param object cell
     * @param boolean save
     * @return void
     */
    obj.closeEditor = function(cell, save) {
        var x = parseInt(cell.getAttribute('data-x'));
        var y = parseInt(cell.getAttribute('data-y'));

        // Get cell properties
        if (save == true) {
            // If custom editor
            if (obj.options.columns[x].editor) {
                // Custom editor
                var value = obj.options.columns[x].editor.closeEditor(cell, save);
            } else {
                // Native functions
                if (obj.options.columns[x].type == 'checkbox' || obj.options.columns[x].type == 'radio' || obj.options.columns[x].type == 'hidden') {
                    // Do nothing
                } else if (obj.options.columns[x].type == 'dropdown' || obj.options.columns[x].type == 'autocomplete') {
                    var value = cell.children[0].dropdown.close(true);
                } else if (obj.options.columns[x].type == 'calendar') {
                    var value = cell.children[0].calendar.close(true);
                } else if (obj.options.columns[x].type == 'color') {
                    var value = cell.children[1].color.close(true);
                } else if (obj.options.columns[x].type == 'image') {
                    var img = cell.children[0].children[0].children[0];
                    var value = img && img.tagName == 'IMG' ? img.src : '';
                } else if (obj.options.columns[x].type == 'numeric') {
                    var value = cell.children[0].value;
                    if (value.substr(0,1) != '=') {
                        if (value == '') {
                            value = obj.options.columns[x].allowEmpty ? '' : 0;
                        }
                    }
                    cell.children[0].onblur = null;
                } else {
                    var value = cell.children[0].value;
                    cell.children[0].onblur = null;
                }
            }

            // Ignore changes if the value is the same
            if (obj.options.data[y][x] == value) {
                cell.innerHTML = obj.edition[1];
            } else {
                obj.setValue(cell, value);
            }
        } else {
            if (obj.options.columns[x].editor) {
                // Custom editor
                obj.options.columns[x].editor.closeEditor(cell, save);
            } else {
                if (obj.options.columns[x].type == 'dropdown' || obj.options.columns[x].type == 'autocomplete') {
                    cell.children[0].dropdown.close(true);
                } else if (obj.options.columns[x].type == 'calendar') {
                    cell.children[0].calendar.close(true);
                } else if (obj.options.columns[x].type == 'color') {
                    cell.children[1].color.close(true);
                } else {
                    cell.children[0].onblur = null;
                }
            }

            // Restore value
            cell.innerHTML = obj.edition && obj.edition[1] ? obj.edition[1] : '';
        }

        // On edition end
        if (! obj.ignoreEvents) {
            if (typeof(obj.options.oneditionend) == 'function') {
                obj.options.oneditionend(el, cell, x, y, value, save);
            }
        }

        // Remove editor class
        cell.classList.remove('editor');

        // Finish edition
        obj.edition = null;
    }

    /**
     * Get the cell object
     * 
     * @param object cell
     * @return string value
     */
    obj.getCell = function(cell) {
        // Convert in case name is excel liked ex. A10, BB92
        cell = jexcel.getIdFromColumnName(cell, true);
        var x = cell[0];
        var y = cell[1];

        return obj.records[y][x];
    }

    /**
     * Get the cell object from coords
     * 
     * @param object cell
     * @return string value
     */
    obj.getCellFromCoords = function(x, y) {
        return obj.records[y][x];
    }

    /**
     * Get label
     * 
     * @param object cell
     * @return string value
     */
    obj.getLabel = function(cell) {
        // Convert in case name is excel liked ex. A10, BB92
        cell = jexcel.getIdFromColumnName(cell, true);
        var x = cell[0];
        var y = cell[1];

        return obj.records[y][x].innerHTML;
    }

    /**
     * Get labelfrom coords
     * 
     * @param object cell
     * @return string value
     */
    obj.getLabelFromCoords = function(x, y) {
        return obj.records[y][x].innerHTML;
    }

    /**
     * Get the value from a cell
     * 
     * @param object cell
     * @return string value
     */
    obj.getValue = function(cell, processedValue) {
        if (typeof(cell) == 'object') {
            var x = cell.getAttribute('data-x');
            var y = cell.getAttribute('data-y');
        } else {
            cell = jexcel.getIdFromColumnName(cell, true);
            var x = cell[0];
            var y = cell[1];
        }

        var value = null;

        if (x != null && y != null) {
            if (obj.records[y] && obj.records[y][x] && (processedValue || obj.options.copyCompatibility == true)) {
                value = obj.records[y][x].innerHTML;
            } else {
                if (obj.options.data[y] && obj.options.data[y][x] != 'undefined') {
                    value = obj.options.data[y][x];
                }
            }
        }

        return value;
    }

    /**
     * Get the value from a coords
     * 
     * @param int x
     * @param int y
     * @return string value
     */
    obj.getValueFromCoords = function(x, y, processedValue) {
        var value = null;

        if (x != null && y != null) {
            if ((obj.records[y] && obj.records[y][x]) && processedValue || obj.options.copyCompatibility == true) {
                value = obj.records[y][x].innerHTML;
            } else {
                if (obj.options.data[y] && obj.options.data[y][x] != 'undefined') {
                    value = obj.options.data[y][x];
                }
            }
        }

        return value;
    }

    /**
     * Set a cell value
     * 
     * @param mixed cell destination cell
     * @param string value value
     * @return void
     */
    obj.setValue = function(cell, value, force) {
        var records = [];

        if (typeof(cell) == 'string') {
            var columnId = jexcel.getIdFromColumnName(cell, true);
            var x = columnId[0];
            var y = columnId[1];

            // Update cell
            records.push(obj.updateCell(x, y, value, force));

            // Update all formulas in the chain
            obj.updateFormulaChain(x, y, records);
        } else {
            var x = null;
            var y = null;
            if (cell && cell.getAttribute) {
                var x = cell.getAttribute('data-x');
                var y = cell.getAttribute('data-y');
            }

            // Update cell
            if (x != null && y != null) {
                records.push(obj.updateCell(x, y, value, force));

                // Update all formulas in the chain
                obj.updateFormulaChain(x, y, records);
            } else {
                var keys = Object.keys(cell);
                if (keys.length > 0) {
                    for (var i = 0; i < keys.length; i++) {
                        if (typeof(cell[i]) == 'string') {
                            var columnId = jexcel.getIdFromColumnName(cell[i], true);
                            var x = columnId[0];
                            var y = columnId[1];
                        } else {
                            var x = cell[i].getAttribute('data-x');
                            var y = cell[i].getAttribute('data-y');
                        }

                         // Update cell
                        if (x != null && y != null) {
                            records.push(obj.updateCell(x, y, value, force));

                            // Update all formulas in the chain
                            obj.updateFormulaChain(x, y, records);
                        }
                    }
                }
            }
        }

        // Update history
        obj.setHistory({
            action:'setValue',
            records:records,
            selection:obj.selectedCell,
        });

        // Update table with custom configurations if applicable
        obj.updateTable();

        // On after changes
        obj.onafterchanges(el, records);
    }

    /**
     * Set a cell value based on coordinates
     * 
     * @param int x destination cell
     * @param int y destination cell
     * @param string value
     * @return void
     */
    obj.setValueFromCoords = function(x, y, value, force) {
        var records = [];
        records.push(obj.updateCell(x, y, value, force));

        // Update all formulas in the chain
        obj.updateFormulaChain(x, y, records);

        // Update history
        obj.setHistory({
            action:'setValue',
            records:records,
            selection:obj.selectedCell,
        });

        // Update table with custom configurations if applicable
        obj.updateTable();

        // On after changes
        obj.onafterchanges(el, records);
    }

    /**
     * Toogle
     */
    obj.setCheckRadioValue = function() {
        var records = [];
        var keys = Object.keys(obj.highlighted);
        for (var i = 0; i < keys.length; i++) {
            var x = obj.highlighted[i].getAttribute('data-x');
            var y = obj.highlighted[i].getAttribute('data-y');

            if (obj.options.columns[x].type == 'checkbox' || obj.options.columns[x].type == 'radio') {
                // Update cell
                records.push(obj.updateCell(x, y, ! obj.options.data[y][x]));
            }
        }

        if (records.length) {
            // Update history
            obj.setHistory({
                action:'setValue',
                records:records,
                selection:obj.selectedCell,
            });

            // On after changes
            obj.onafterchanges(el, records);
        }
    }

    /**
     * Update cell content
     * 
     * @param object cell
     * @return void
     */
    obj.updateCell = function(x, y, value, force) {
        // Changing value depending on the column type
        if (obj.records[y][x].classList.contains('readonly') == true && ! force) {
            // Do nothing
            var record = {
                x: x,
                y: y,
                col: x,
                row: y
            }
        } else {
            // On change
            if (! obj.ignoreEvents) {
                if (typeof(obj.options.onbeforechange) == 'function') {
                    // Overwrite a value
                    var val = obj.options.onbeforechange(el, obj.records[y][x], x, y, value);

                    // If you return something this will overwrite the value
                    if (val != undefined) {
                        value = val;
                    }
                }
            }

            // History format
            var record = {
                x: x,
                y: y,
                col: x,
                row: y,
                newValue: value,
                oldValue: obj.options.data[y][x],
            }

            if (obj.options.columns[x].editor) {
                // Update data and cell
                obj.options.data[y][x] = value;
                obj.options.columns[x].editor.setValue(obj.records[y][x], value, force);
            } else {
                // Native functions
                if (obj.options.columns[x].type == 'checkbox' || obj.options.columns[x].type == 'radio') {
                    // Unchecked all options
                    if (obj.options.columns[x].type == 'radio') {
                        for (var j = 0; j < obj.options.data.length; j++) {
                            obj.options.data[j][x] = false;
                        }
                    }

                    // Update data and cell
                    obj.records[y][x].children[0].checked = (value == 1 || value == true || value == 'true' || value == 'TRUE') ? true : false;
                    obj.options.data[y][x] = obj.records[y][x].children[0].checked;
                } else if (obj.options.columns[x].type == 'dropdown' || obj.options.columns[x].type == 'autocomplete') {
                    // Update data and cell
                    obj.options.data[y][x] = value;
                    obj.records[y][x].innerHTML = obj.getDropDownValue(x, value);
                } else if (obj.options.columns[x].type == 'calendar') {
                    // Update calendar
                    var formatted = jSuites.calendar.extractDateFromString(value, obj.options.columns[x].options.format);
                    // Update data and cell
                    obj.options.data[y][x] = value;
                    obj.records[y][x].innerHTML = jSuites.calendar.getDateString(formatted ? formatted : value, obj.options.columns[x].options.format);
                } else if (obj.options.columns[x].type == 'color') {
                    // Update color
                    obj.options.data[y][x] = value;
                    // Render
                    if (obj.options.columns[x].render == 'square') {
                        var color = document.createElement('div');
                        color.className = 'color';
                        color.style.backgroundColor = value;
                        obj.records[y][x].innerHTML = '';
                        obj.records[y][x].appendChild(color);
                    } else {
                    obj.records[y][x].style.color = value;
                        obj.records[y][x].innerHTML = value;
                    }
                } else if (obj.options.columns[x].type == 'image') {
                    value = ''+value;
                    obj.options.data[y][x] = value;
                    obj.records[y][x].innerHTML = '';
                    if (value && value.substr(0, 10) == 'data:image') {
                        var img = document.createElement('img');
                        img.src = value;
                        obj.records[y][x].appendChild(img);
                    }
                } else {
                    // Update data and cell
                    obj.options.data[y][x] = value;
                    // Label
                    if (('' + value).substr(0,1) == '='  && obj.options.parseFormulas == true) {
                        value = obj.executeFormula(value, x, y);
                    }
                    if (obj.options.columns[x].mask) {
                        var decimal = obj.options.columns[x].decimal || '.';
                        value = '' + jSuites.mask.run(value, obj.options.columns[x].mask, decimal);
                    }
                    obj.records[y][x].innerHTML = value;

                    // Handle big text inside a cell
                    if (obj.options.columns[x].wordWrap != false && (obj.options.wordWrap == true || obj.options.columns[x].wordWrap == true || obj.records[y][x].innerHTML.length > 200)) {
                        obj.records[y][x].style.whiteSpace = 'pre-wrap';
                    } else {
                        obj.records[y][x].style.whiteSpace = '';
                    }
                }
            }

            // Overflow
            if (x > 0) {
                if (value) {
                    obj.records[y][x-1].style.overflow = 'hidden';
                } else {
                    obj.records[y][x-1].style.overflow = '';
                }
            }

            // On change
            if (! obj.ignoreEvents) {
                if (typeof(obj.options.onchange) == 'function') {
                    obj.options.onchange(el, (obj.records[y] && obj.records[y][x] ? obj.records[y][x] : null), x, y, value, record.oldValue);
                }
            }
        }

        return record;
    }

    /**
     * Helper function to copy data using the corner icon
     */
    obj.copyData = function(o, d) {
        // Get data from all selected cells
        var data = obj.getData(true, true);

        // Selected cells
        var h = obj.selectedContainer;

        // Cells
        var x1 = parseInt(o.getAttribute('data-x'));
        var y1 = parseInt(o.getAttribute('data-y'));
        var x2 = parseInt(d.getAttribute('data-x'));
        var y2 = parseInt(d.getAttribute('data-y'));

        // Records
        var records = [];
        var breakControl = false;

        if (h[0] == x1) {
            // Vertical copy
            if (y1 < h[1]) {
                var rowNumber = y1 - h[1];
            } else {
                var rowNumber = 1;
            }
            var colNumber = 0;
        } else {
            if (x1 < h[0]) {
                var colNumber = x1 - h[0];
            } else {
                var colNumber = 1;
            }
            var rowNumber = 0;
        }

        // Copy data procedure
        var posx = 0;
        var posy = 0;

        for (var j = y1; j <= y2; j++) {
            // Skip hidden rows
            if (obj.rows[j] && obj.rows[j].style.display == 'none') {
                continue;
            }

            // Controls
            if (data[posy] == undefined) {
                posy = 0;
            }
            posx = 0;

            // Data columns
            if (h[0] != x1) {
                if (x1 < h[0]) {
                    var colNumber = x1 - h[0];
                } else {
                    var colNumber = 1;
                }
            }
            // Data columns
            for (var i = x1; i <= x2; i++) {
                // Update non-readonly
                if (obj.records[j][i] && ! obj.records[j][i].classList.contains('readonly') && obj.records[j][i].style.display != 'none' && breakControl == false) {
                    // Stop if contains value
                    if (! obj.selection.length) {
                        if (obj.options.data[j][i] != '') {
                            breakControl = true;
                            continue;
                        }
                    }

                    // Column
                    if (data[posy] == undefined) {
                        posx = 0;
                    } else if (data[posy][posx] == undefined) {
                        posx = 0;
                    }

                    // Value
                    var value = data[posy][posx];

                        if (value && ! data[1] && obj.options.autoIncrement == true) {
                        if (obj.options.columns[i].type == 'text' || obj.options.columns[i].type == 'number') {
                            if ((''+value).substr(0,1) == '=') {
                                var tokens = value.match(/([A-Z]+[0-9]+)/g);

                                if (tokens) {
                                    var affectedTokens = [];
                                    for (var index = 0; index < tokens.length; index++) {
                                        var position = jexcel.getIdFromColumnName(tokens[index], 1);
                                        position[0] += colNumber;
                                        position[1] += rowNumber;
                                        if (position[1] < 0) {
                                            position[1] = 0;
                                        }
                                        var token = jexcel.getColumnNameFromId([position[0], position[1]]);

                                        if (token != tokens[index]) {
                                            affectedTokens[tokens[index]] = token;
                                        }
                                    }
                                    // Update formula
                                    if (affectedTokens) {
                                        value = obj.updateFormula(value, affectedTokens)
                                    }
                                }
                            } else {
                                if (value == Number(value)) {
                                    value = Number(value) + rowNumber;
                                }
                            }
                        } else if (obj.options.columns[i].type == 'calendar') {
                            var date = new Date(value);
                            date.setDate(date.getDate() + rowNumber);
                            value = date.getFullYear() + '-' + jexcel.doubleDigitFormat(parseInt(date.getMonth() + 1)) + '-' + jexcel.doubleDigitFormat(date.getDate()) + ' ' + '00:00:00';
                        }
                    }

                    records.push(obj.updateCell(i, j, value));

                    // Update all formulas in the chain
                    obj.updateFormulaChain(i, j, records);
                }
                posx++;
                if (h[0] != x1) {
                    colNumber++;
                }
            }
            posy++;
            rowNumber++;
        }

        // Update history
        obj.setHistory({
            action:'setValue',
            records:records,
            selection:obj.selectedCell,
        });

        // Update table with custom configuration if applicable
        obj.updateTable();

        // On after changes
        obj.onafterchanges(el, records);
    }

    /**
     * Refresh current selection
     */
    obj.refreshSelection = function() {
        if (obj.selectedCell) {
            obj.updateSelectionFromCoords(obj.selectedCell[0], obj.selectedCell[1], obj.selectedCell[2], obj.selectedCell[3]);
        }
    }

    /**
     * Move coords to A1 in case ovelaps with an excluded cell
     */
    obj.conditionalSelectionUpdate = function(type, o, d) {
        if (type == 1) {
            if (obj.selectedCell && ((o >= obj.selectedCell[1] && o <= obj.selectedCell[3]) || (d >= obj.selectedCell[1] && d <= obj.selectedCell[3]))) {
                obj.resetSelection();
                return;
            }
        } else {
            if (obj.selectedCell && ((o >= obj.selectedCell[0] && o <= obj.selectedCell[2]) || (d >= obj.selectedCell[0] && d <= obj.selectedCell[2]))) {
                obj.resetSelection();
                return;
            }
        }
    }

    /**
     * Clear table selection
     */
    obj.resetSelection = function(blur) {
        // Remove style
        if (! obj.highlighted.length) {
            var previousStatus = 0;
        } else {
            var previousStatus = 1;

            for (var i = 0; i < obj.highlighted.length; i++) {
                obj.highlighted[i].classList.remove('highlight');
                obj.highlighted[i].classList.remove('highlight-left');
                obj.highlighted[i].classList.remove('highlight-right');
                obj.highlighted[i].classList.remove('highlight-top');
                obj.highlighted[i].classList.remove('highlight-bottom');
                obj.highlighted[i].classList.remove('highlight-selected');

                var px = parseInt(obj.highlighted[i].getAttribute('data-x'));
                var py = parseInt(obj.highlighted[i].getAttribute('data-y'));

                // Check for merged cells
                if (obj.highlighted[i].getAttribute('data-merged')) {
                    var colspan = parseInt(obj.highlighted[i].getAttribute('colspan'));
                    var rowspan = parseInt(obj.highlighted[i].getAttribute('rowspan'));
                    var ux = colspan > 0 ? px + (colspan - 1) : px;
                    var uy = rowspan > 0 ? py + (rowspan - 1): py;
                } else {
                    var ux = px;
                    var uy = py;
                }

                // Remove selected from headers
                for (var j = px; j <= ux; j++) {
                    if (obj.headers[j]) {
                        obj.headers[j].classList.remove('selected');
                    }
                }

                // Remove selected from rows
                for (var j = py; j <= uy; j++) {
                    if (obj.rows[j]) {
                        obj.rows[j].classList.remove('selected');
                    }
                }
            }
        }

        // Reset highlighed cells
        obj.highlighted = [];

        // Reset
        obj.selectedCell = null;

        // Hide corner
        obj.corner.style.top = '-2000px';
        obj.corner.style.left = '-2000px';

        if (obj.ignoreEvents != true && blur == true) {
            if (obj.options.onblur) {
                if (typeof(obj.options.onblur) == 'function') {
                    if (previousStatus == 1) {
                        obj.options.onblur(el);
                    }
                }
            }
        }

        return previousStatus;
    }

    /**
     * Update selection based on two cells
     */
    obj.updateSelection = function(el1, el2, origin) {
        var x1 = el1.getAttribute('data-x');
        var y1 = el1.getAttribute('data-y');
        if (el2) {
            var x2 = el2.getAttribute('data-x');
            var y2 = el2.getAttribute('data-y');
        } else {
            var x2 = x1;
            var y2 = y1;
        }

        obj.updateSelectionFromCoords(x1, y1, x2, y2, origin);
    }

    /**
     * Update selection from coords
     */
    obj.updateSelectionFromCoords = function(x1, y1, x2, y2, origin) {
        // Reset Selection
        var updated = null;
        var previousState = obj.resetSelection();

        // Same element
        if (x2 == null) {
            x2 = x1;
        }
        if (y2 == null) {
            y2 = y1;
        }

        // Selection must be within the existing data
        if (x1 >= obj.headers.length) {
            x1 = obj.headers.length - 1;
        }
        if (y1 >= obj.rows.length) {
            y1 = obj.rows.length - 1;
        }
        if (x2 >= obj.headers.length) {
            x2 = obj.headers.length - 1;
        }
        if (y2 >= obj.rows.length) {
            y2 = obj.rows.length - 1;
        }

        // Keep selected cell
        obj.selectedCell = [x1, y1, x2, y2];

        // Select cells
        if (x1 != null) {
            // Add selected cell
            if (obj.records[y1][x1]) {
                obj.records[y1][x1].classList.add('highlight-selected');
            }

            // Origin & Destination
            if (parseInt(x1) < parseInt(x2)) {
                var px = parseInt(x1);
                var ux = parseInt(x2);
            } else {
                var px = parseInt(x2);
                var ux = parseInt(x1);
            }

            if (parseInt(y1) < parseInt(y2)) {
                var py = parseInt(y1);
                var uy = parseInt(y2);
            } else {
                var py = parseInt(y2);
                var uy = parseInt(y1);
            }

            // Verify merged columns
            for (var i = px; i <= ux; i++) {
                for (var j = py; j <= uy; j++) {
                    if (obj.records[j][i] && obj.records[j][i].getAttribute('data-merged')) {
                        var x = parseInt(obj.records[j][i].getAttribute('data-x'));
                        var y = parseInt(obj.records[j][i].getAttribute('data-y'));
                        var colspan = parseInt(obj.records[j][i].getAttribute('colspan'));
                        var rowspan = parseInt(obj.records[j][i].getAttribute('rowspan'));

                        if (colspan > 1) {
                            if (x < px) {
                                px = x;
                            }
                            if (x + colspan > ux) {
                                ux = x + colspan - 1;
                            }
                        }

                        if (rowspan) {
                            if (y < py) {
                                py = y;

                            }
                            if (y + rowspan > uy) {
                                uy = y + rowspan - 1;
                            }
                        }
                    }
                }
            }

            // Limits
            var borderLeft = null;
            var borderRight = null;
            var borderTop = null;
            var borderBottom = null;

            // Vertical limits
            for (var j = py; j <= uy; j++) {
                if (obj.rows[j].style.display != 'none') {
                    if (borderTop == null) {
                        borderTop = j;
                    }
                    borderBottom = j;
                }
            }

            // Redefining styles
            for (var i = px; i <= ux; i++) {
                for (var j = py; j <= uy; j++) {
                    if (obj.rows[j].style.display != 'none' && obj.records[j][i].style.display != 'none') {
                        obj.records[j][i].classList.add('highlight');
                        obj.highlighted.push(obj.records[j][i]);
                    }
                }

                // Horizontal limits
                if (obj.options.columns[i].type != 'hidden') {
                    if (borderLeft == null) {
                        borderLeft = i;
                    }
                    borderRight = i;
                }
            }

            // Create borders
            if (! borderLeft) {
                borderLeft = 0;
            }
            if (! borderRight) {
                borderRight = 0;
            }
            for (var i = borderLeft; i <= borderRight; i++) {
                if (obj.options.columns[i].type != 'hidden') {
                    // Top border
                    if (obj.records[borderTop][i]) {
                        obj.records[borderTop][i].classList.add('highlight-top');
                    }
                    // Bottom border
                    if (obj.records[borderBottom][i]) {
                        obj.records[borderBottom][i].classList.add('highlight-bottom');
                    }
                    // Add selected from headers
                    obj.headers[i].classList.add('selected');
                }
            }

            for (var j = borderTop; j <= borderBottom; j++) {
                if (obj.rows[j].style.display != 'none') {
                    // Left border
                    obj.records[j][borderLeft].classList.add('highlight-left');
                    // Right border
                    obj.records[j][borderRight].classList.add('highlight-right');
                    // Add selected from rows
                    obj.rows[j].classList.add('selected');
                }
            }

            obj.selectedContainer = [ borderLeft, borderTop, borderRight, borderBottom ];
        }

        // Handle events
        if (obj.ignoreEvents != true) {
            if (obj.options.onfocus) {
                if (typeof(obj.options.onfocus) == 'function') {
                    if (previousState == 0) {
                        obj.options.onfocus(el);
                    }
                }
            }

            if (typeof(obj.options.onselection) == 'function') {
                obj.options.onselection(el, borderLeft, borderTop, borderRight, borderBottom, origin);
            }
        }

        // Find corner cell
        obj.updateCornerPosition();
    }

    /**
     * Remove copy selection
     * 
     * @return void
     */
    obj.removeCopySelection = function() {
        // Remove current selection
        for (var i = 0; i < obj.selection.length; i++) {
            obj.selection[i].classList.remove('selection');
            obj.selection[i].classList.remove('selection-left');
            obj.selection[i].classList.remove('selection-right');
            obj.selection[i].classList.remove('selection-top');
            obj.selection[i].classList.remove('selection-bottom');
        }

        obj.selection = [];
    }

    /**
     * Update copy selection
     * 
     * @param int x, y
     * @return void
     */
    obj.updateCopySelection = function(x3, y3) {
        // Remove selection
        obj.removeCopySelection();

        // Get elements first and last
        var x1 = obj.selectedContainer[0];
        var y1 = obj.selectedContainer[1];
        var x2 = obj.selectedContainer[2];
        var y2 = obj.selectedContainer[3];

        if (x3 != null && y3 != null) {
            if (x3 - x2 > 0) {
                var px = parseInt(x2) + 1;
                var ux = parseInt(x3);
            } else {
                var px = parseInt(x3);
                var ux = parseInt(x1) - 1;
            }

            if (y3 - y2 > 0) {
                var py = parseInt(y2) + 1;
                var uy = parseInt(y3);
            } else {
                var py = parseInt(y3);
                var uy = parseInt(y1) - 1;
            }

            if (ux - px < uy - py) {
                var px = parseInt(x1);
                var ux = parseInt(x2);
            } else {
                var py = parseInt(y1);
                var uy = parseInt(y2);
            }

            for (var j = py; j <= uy; j++) {
                for (var i = px; i <= ux; i++) {
                    if (obj.records[j][i] && obj.rows[j].style.display != 'none' && obj.records[j][i].style.display != 'none') {
                        obj.records[j][i].classList.add('selection');
                        obj.records[py][i].classList.add('selection-top');
                        obj.records[uy][i].classList.add('selection-bottom');
                        obj.records[j][px].classList.add('selection-left');
                        obj.records[j][ux].classList.add('selection-right');

                        // Persist selected elements
                        obj.selection.push(obj.records[j][i]);
                    }
                }
            }
        }
    }

    /**
     * Update corner position
     * 
     * @return void
     */
    obj.updateCornerPosition = function() {
        // If any selected cells
        if (! obj.highlighted.length) {
            obj.corner.style.top = '-2000px';
            obj.corner.style.left = '-2000px';
        } else {
            // Get last cell
            var last = obj.highlighted[obj.highlighted.length-1];

            const contentRect = obj.content.getBoundingClientRect();
            var x1 = contentRect.left;
            var y1 = contentRect.top;

            const lastRect = last.getBoundingClientRect();
            var x2 = lastRect.left;
            var y2 = lastRect.top;
            var w2 = lastRect.width;
            var h2 = lastRect.height;

            var x = (x2 - x1) + obj.content.scrollLeft + w2 - 4;
            var y = (y2 - y1) + obj.content.scrollTop + h2 - 4;

            // Place the corner in the correct place
            obj.corner.style.top = y + 'px';
            obj.corner.style.left = x + 'px';
        }
    }

    /**
     * Update scroll position based on the selection
     */
    obj.updateScroll = function(direction) {
        // jExcel Container information
        const contentRect = obj.content.getBoundingClientRect();
        var x1 = contentRect.left;
        var y1 = contentRect.top;
        var w1 = contentRect.width;
        var h1 = contentRect.height;

        // Direction Left or Up
        var reference = obj.records[obj.selectedCell[3]][obj.selectedCell[2]];

            // Reference
        const referenceRect = reference.getBoundingClientRect();
        var x2 = referenceRect.left;
        var y2 = referenceRect.top;
        var w2 = referenceRect.width;
        var h2 = referenceRect.height;

        // Direction
        if (direction == 0 || direction == 1) {
            var x = (x2 - x1) + obj.content.scrollLeft;
            var y = (y2 - y1) + obj.content.scrollTop - 2;
        } else {
            var x = (x2 - x1) + obj.content.scrollLeft + w2;
            var y = (y2 - y1) + obj.content.scrollTop + h2;
        }

        // Top position check
        if (y > (obj.content.scrollTop + 30) && y < (obj.content.scrollTop + h1)) {
            // In the viewport
        } else {
            // Out of viewport
            if (y < obj.content.scrollTop + 30) {
                obj.content.scrollTop = y - h2;
            } else {
                obj.content.scrollTop = y - (h1 - 2);
            }
        }

        // Left position check - TODO: change that to the bottom border of the element
        if (x > (obj.content.scrollLeft) && x < (obj.content.scrollLeft + w1)) {
            // In the viewport
        } else {
            // Out of viewport
            if (x < obj.content.scrollLeft + 30) {
                obj.content.scrollLeft = x;
                if (obj.content.scrollLeft < 50) {
                    obj.content.scrollLeft = 0;
                }
            } else {
                obj.content.scrollLeft = x - (w1 - 20);
            }
        }
    }

    /**
     * Get the column width
     * 
     * @param int column column number (first column is: 0)
     * @return int current width
     */
    obj.getWidth = function(column) {
        if (! column) {
            // Get all headers
            var data = [];
            for (var i = 0; i < obj.headers.length; i++) {
                data.push(obj.options.columns[i].width);
            }
        } else {
            // In case the column is an object
            if (typeof(column) == 'object') {
                column = $(column).getAttribute('data-x');
            }

            data = obj.colgroup[column].getAttribute('width')
        }

        return data;
    }

    /**
     * Set the column width
     * 
     * @param int column number (first column is: 0)
     * @param int new column width
     * @param int old column width
     */
    obj.setWidth = function (column, width, oldWidth) {
        if (width > 0) {
            // In case the column is an object
            if (typeof(column) == 'object') {
                column = column.getAttribute('data-x');
            }

            // Oldwidth
            if (! oldWidth) {
                oldWidth = obj.colgroup[column].getAttribute('width');
            }

            // Set width
            obj.colgroup[column].setAttribute('width', width);
            obj.options.columns[column].width = width;

            // Keeping history of changes
            obj.setHistory({
                action:'setWidth',
                column:column,
                oldValue:oldWidth,
                newValue:width,
            });

            // On resize column
            if (obj.ignoreEvents != true) {
                if (typeof(obj.options.onresizecolumn) == 'function') {
                    obj.options.onresizecolumn(el, column, width, oldWidth);
                }
            }

            // Update corner position
            obj.updateCornerPosition();
        }
    }

    /**
     * Set the row height
     * 
     * @param row - row number (first row is: 0)
     * @param height - new row height
     * @param oldHeight - old row height
     */
    obj.setHeight = function (row, height, oldHeight) {
        if (height > 0) {
            // In case the column is an object
            if (typeof(row) == 'object') {
                row = row.getAttribute('data-y');
            }

            // Oldwidth
            if (! oldHeight) {
                oldHeight = obj.rows[row].getAttribute('height');

                if (! oldHeight) {
                    var rect = obj.rows[row].getBoundingClientRect();
                    oldHeight = rect.height;
                }
            }

            // Integer
            height = parseInt(height);

            // Set width
            obj.rows[row].style.height = height + 'px';

            // Keep options updated
            if (! obj.options.rows[row]) {
                obj.options.rows[row] = {};
            }
            obj.options.rows[row].height = height;

            // Keeping history of changes
            obj.setHistory({
                action:'setHeight',
                row:row,
                oldValue:oldHeight,
                newValue:height,
            });

            // On resize column
            if (obj.ignoreEvents != true) {
                if (typeof(obj.options.onresizerow) == 'function') {
                    obj.options.onresizerow(el, row, height, oldHeight);
                }
            }

            // Update corner position
            obj.updateCornerPosition();
        }
    }

    /**
     * Get the row height
     * 
     * @param row - row number (first row is: 0)
     * @return height - current row height
     */
    obj.getHeight = function(row) {
        if (! row) {
            // Get height of all rows
            var data = [];
            for (var j = 0; j < obj.rows.length; j++) {
                var h = obj.rows[j].style.height;
                if (h) {
                    data[j] = h;
                }
            }
        } else {
            // In case the row is an object
            if (typeof(row) == 'object') {
                row = $(row).getAttribute('data-y');
            }

            var data = obj.rows[row].style.height;
        }

        return data;
    }

    /**
     * Get the column title
     * 
     * @param column - column number (first column is: 0)
     * @param title - new column title
     */
    obj.getHeader = function(column) {
        return obj.headers[column].innerText;
    }

    /**
     * Set the column title
     * 
     * @param column - column number (first column is: 0)
     * @param title - new column title
     */
    obj.setHeader = function(column, newValue) {
        if (obj.headers[column]) {
            var oldValue = obj.headers[column].innerText;

            if (! newValue) {
                newValue = prompt(obj.options.text.columnName, oldValue)
            }

            if (newValue) {
                obj.headers[column].innerHTML = newValue;
                // Keep the title property
                obj.headers[column].setAttribute('title', newValue);
            }

            obj.setHistory({
                action: 'setHeader',
                column: column,
                oldValue: oldValue,
                newValue: newValue
            });

            // On change
            if (! obj.ignoreEvents) {
                if (typeof(obj.options.onchangeheader) == 'function') {
                    obj.options.onchangeheader(el, column, oldValue, newValue);
                }
            }
        }
    }

    /**
     * Get the headers
     * 
     * @param asArray
     * @return mixed
     */
    obj.getHeaders = function (asArray) {
        var title = [];

        for (var i = 0; i < obj.headers.length; i++) {
            title.push(obj.getHeader(i));
        }

        return asArray ? title : title.join(obj.options.csvDelimiter);
    }

    /**
     * Get meta information from cell(s)
     * 
     * @return integer
     */
    obj.getMeta = function(cell, key) {
        if (! cell) {
            return obj.options.meta;
        } else {
            if (key) {
                return obj.options.meta[cell] && obj.options.meta[cell][key] ? obj.options.meta[cell][key] : null;
            } else {
                return obj.options.meta[cell] ? obj.options.meta[cell] : null;
            }
        }
    }

    /**
     * Set meta information to cell(s)
     * 
     * @return integer
     */
    obj.setMeta = function(o, k, v) {
        if (! obj.options.meta) {
            obj.options.meta = {}
        }

        if (k && v) {
            // Set data value
            if (! obj.options.meta[o]) {
                obj.options.meta[o] = {};
            }
            obj.options.meta[o][k] = v;
        } else {
            // Apply that for all cells
            var keys = Object.keys(o);
            for (var i = 0; i < keys.length; i++) {
                if (! obj.options.meta[keys[i]]) {
                    obj.options.meta[keys[i]] = {};
                }

                var prop = Object.keys(o[keys[i]]);
                for (var j = 0; j < prop.length; j++) {
                    obj.options.meta[keys[i]][prop[j]] = o[keys[i]][prop[j]];
                }
            }
        }

        if (obj.ignoreEvents != true) {
            if (typeof(obj.options.onchangemeta) == 'function') {
                obj.options.onchangemeta(el, o, k, v);
            }
        }
    }

    /**
     * Update meta information
     * 
     * @return integer
     */
    obj.updateMeta = function(affectedCells) {
        if (obj.options.meta) {
            var newMeta = {};
            var keys = Object.keys(obj.options.meta);
            for (var i = 0; i < keys.length; i++) {
                if (affectedCells[keys[i]]) {
                    newMeta[affectedCells[keys[i]]] = obj.options.meta[keys[i]];
                } else {
                    newMeta[keys[i]] = obj.options.meta[keys[i]];
                }
            }
            // Update meta information
            obj.options.meta = newMeta;
        }
    }

    /**
     * Get style information from cell(s)
     * 
     * @return integer
     */
    obj.getStyle = function(cell, key) {
        // Cell
        if (! cell) {
            // Control vars
            var data = {};

            // Column and row length
            var x = obj.options.data[0].length;
            var y = obj.options.data.length;

            // Go through the columns to get the data
            for (var j = 0; j < y; j++) {
                for (var i = 0; i < x; i++) {
                    // Value
                    var v = key ? obj.records[j][i].style[key] : obj.records[j][i].getAttribute('style');

                    // Any meta data for this column?
                    if (v) {
                        // Column name
                        var k = jexcel.getColumnNameFromId([i, j]);
                        // Value
                        data[k] = v;
                    }
                }
            }

           return data;
        } else {
            cell = jexcel.getIdFromColumnName(cell, true);

            return key ? obj.records[cell[1]][cell[0]].style[key] : obj.records[cell[1]][cell[0]].getAttribute('style');
        }
    },

    obj.resetStyle = function(o, ignoreHistoryAndEvents) {
        var keys = Object.keys(o);
        for (var i = 0; i < keys.length; i++) {
            // Position
            var cell = jexcel.getIdFromColumnName(keys[i], true);
            if (obj.records[cell[1]] && obj.records[cell[1]][cell[0]]) {
                obj.records[cell[1]][cell[0]].setAttribute('style', '');
            }
        }
        obj.setStyle(o, null, null, null, ignoreHistoryAndEvents);
    }

    /**
     * Set meta information to cell(s)
     * 
     * @return integer
     */
    obj.setStyle = function(o, k, v, force, ignoreHistoryAndEvents) {
        var newValue = {};
        var oldValue = {};

        // Apply style
        var applyStyle = function(cellId, key, value) {
            // Position
            var cell = jexcel.getIdFromColumnName(cellId, true);

            if (obj.records[cell[1]] && obj.records[cell[1]][cell[0]]) {
                // Current value
                var currentValue = obj.records[cell[1]][cell[0]].style[key];

                // Change layout
                if (currentValue == value && ! force) {
                    value = '';
                    obj.records[cell[1]][cell[0]].style[key] = '';
                } else {
                    obj.records[cell[1]][cell[0]].style[key] = value;
                }

                // History
                if (! oldValue[cellId]) {
                    oldValue[cellId] = [];
                }
                if (! newValue[cellId]) {
                    newValue[cellId] = [];
                }

                oldValue[cellId].push([key + ':' + currentValue]);
                newValue[cellId].push([key + ':' + value]);
            }
        }

        if (k && v) {
            // Get object from string
            if (typeof(o) == 'string') {
                applyStyle(o, k, v);
            } else {
                // Avoid duplications
                var oneApplication = [];
                // Apply that for all cells
                for (var i = 0; i < o.length; i++) {
                    var x = o[i].getAttribute('data-x');
                    var y = o[i].getAttribute('data-y');
                    var cellName = jexcel.getColumnNameFromId([x, y]);
                    // This happens when is a merged cell
                    if (! oneApplication[cellName]) {
                        applyStyle(cellName, k, v);
                        oneApplication[cellName] = true;
                    }
                }
            }
        } else {
            var keys = Object.keys(o);
            for (var i = 0; i < keys.length; i++) {
                var style = o[keys[i]];
                if (typeof(style) == 'string') {
                    style = style.split(';');
                }
                for (var j = 0; j < style.length; j++) {
                    if (typeof(style[j]) == 'string') {
                        style[j] = style[j].split(':');
                    }
                    // Apply value
                    if (style[j][0].trim()) {
                        applyStyle(keys[i], style[j][0].trim(), style[j][1]);
                    }
                }
            }
        }

        var keys = Object.keys(oldValue);
        for (var i = 0; i < keys.length; i++) {
            oldValue[keys[i]] = oldValue[keys[i]].join(';');
        }
        var keys = Object.keys(newValue);
        for (var i = 0; i < keys.length; i++) {
            newValue[keys[i]] = newValue[keys[i]].join(';');
        }

        if (! ignoreHistoryAndEvents) {
            // Keeping history of changes
            obj.setHistory({
                action: 'setStyle',
                oldValue: oldValue,
                newValue: newValue,
            });
        }

        if (obj.ignoreEvents != true) {
            if (typeof(obj.options.onchangestyle) == 'function') {
                obj.options.onchangestyle(el, o, k, v);
            }
        }
    }

    /**
     * Get cell comments, null cell for all
     */
    obj.getComments = function(cell, withAuthor) {
        if (cell) {
            if (typeof(cell) == 'string') {
              var cell = jexcel.getIdFromColumnName(cell, true);
            }

            if (withAuthor) {
                return [obj.records[cell[1]][cell[0]].getAttribute('title'), obj.records[cell[1]][cell[0]].getAttribute('author')];
            } else {
                return obj.records[cell[1]][cell[0]].getAttribute('title') || '';
            }
        } else {
            var data = {};
            for (var j = 0; j < obj.options.data.length; j++) {
                for (var i = 0; i < obj.options.columns.length; i++) {
                    var comments = obj.records[j][i].getAttribute('title');
                    if (comments) {
                        var cell = jexcel.getColumnNameFromId([i, j]);
                        data[cell] = comments;
                    }
                }
            }
            return data;
        }
    }

    /**
     * Set cell comments
     */
    obj.setComments = function(cellId, comments, author) {
        if (typeof(cellId) == 'string') {
            var cell = jexcel.getIdFromColumnName(cellId, true);
        } else {
            var cell = cellId;
        }

        // Keep old value
        var title = obj.records[cell[1]][cell[0]].getAttribute('title');
        var author = obj.records[cell[1]][cell[0]].getAttribute('data-author');
        var oldValue = [ title, author ];

        // Set new values
        obj.records[cell[1]][cell[0]].setAttribute('title', comments ? comments : '');
        obj.records[cell[1]][cell[0]].setAttribute('data-author', author ? author : '');

        // Remove class if there is no comment
        if (comments) {
            obj.records[cell[1]][cell[0]].classList.add('jexcel_comments');
        } else {
            obj.records[cell[1]][cell[0]].classList.remove('jexcel_comments');
        }

        // Save history
        obj.setHistory({
            action:'setComments',
            column: cellId,
            newValue: [ comments, author ],
            oldValue: oldValue,
        });
    }

    /**
     * Get table config information
     */
    obj.getConfig = function() {
        var options = obj.options;
        options.style = obj.getStyle();
        options.mergeCells = obj.getMerge();
        options.comments = obj.getComments();

        return options;
    }

    /**
     * Sort data and reload table
     */
    obj.orderBy = function(column, order) {
        if (column >= 0) {
            // Merged cells
            if (Object.keys(obj.options.mergeCells).length > 0) {
                if (! confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure)) {
                    return false;
                } else {
                    // Remove merged cells
                    obj.destroyMerged();
                }
            }

            // Direction
            if (order == null) {
                order = obj.headers[column].classList.contains('arrow-down') ? 1 : 0;
            } else {
                order = order ? 1 : 0;
            }

            // Filter
            Array.prototype.orderBy = function(p, o) {
                return this.slice(0).sort(function(a, b) {
                    var valueA = a[p] == '' ? '' : Number(a[p]) == a[p] ? Number(a[p]) : a[p].toLowerCase();
                    var valueB = b[p] == '' ? '' : Number(b[p]) == b[p] ? Number(b[p]) : b[p].toLowerCase();

                    if (! o) {
                        return (valueA == '' && valueB != '') ? 1 : (valueA != '' && valueB == '') ? -1 : (valueA > valueB) ? 1 : (valueA < valueB) ? -1 :  0;
                    } else {
                        return (valueA == '' && valueB != '') ? 1 : (valueA != '' && valueB == '') ? -1 : (valueA > valueB) ? -1 : (valueA < valueB) ? 1 :  0;
                    }
                });
            }

            // Test order
            var temp = [];
            if (obj.options.columns[column].type == 'calendar' ||
                obj.options.columns[column].type == 'checkbox' ||
                obj.options.columns[column].type == 'radio') {
                for (var j = 0; j < obj.options.data.length; j++) {
                    temp[j] = [ j, obj.options.data[j][column] ];
                }
            } else {
                for (var j = 0; j < obj.options.data.length; j++) {
                    temp[j] = [ j, obj.records[j][column].innerHTML ];
                }
            }
            temp = temp.orderBy(1, order);

            // Save history
            var newValue = [];
            for (var j = 0; j < temp.length; j++) {
                newValue[j] = temp[j][0];
            }

            // Save history
            obj.setHistory({
                action: 'orderBy',
                rows: newValue,
                column: column,
                order: order,
            });

            // Update order
            obj.updateOrderArrow(column, order);
            obj.updateOrder(newValue);

            // On sort event
            if (obj.ignoreEvents != true) {
                if (typeof(obj.options.onsort) == 'function') {
                    obj.options.onsort(el, column, order);
                }
            }

            return true;
        }
    }

    /**
     * Update order arrow
     */
    obj.updateOrderArrow = function(column, order) {
        // Remove order
        for (var i = 0; i < obj.headers.length; i++) {
            obj.headers[i].classList.remove('arrow-up');
            obj.headers[i].classList.remove('arrow-down');
        }

        // No order specified then toggle order
        if (order) {
            obj.headers[column].classList.add('arrow-up');
        } else {
            obj.headers[column].classList.add('arrow-down');
        }
    }

    /**
     * Update rows position
     */
    obj.updateOrder = function(rows) {
        // History
        var data = []
        for (var j = 0; j < rows.length; j++) {
            data[j] = obj.options.data[rows[j]];
        }
        obj.options.data = data;

        var data = []
        for (var j = 0; j < rows.length; j++) {
            data[j] = obj.records[rows[j]];
        }
        obj.records = data;

        var data = []
        for (var j = 0; j < rows.length; j++) {
            data[j] = obj.rows[rows[j]];
        }
        obj.rows = data;

        // Update references
        obj.updateTableReferences();

        // Redo search
        if (obj.searchInput.value) {
            obj.search(obj.searchInput.value);
        } else {
            // Create page
            obj.results = null;
            obj.pageNumber = 0;

            if (obj.options.pagination > 0) {
                obj.page(0);
            } else if (obj.options.lazyLoading == true) {
                obj.loadPage(0);
            } else {
                for (var j = 0; j < obj.rows.length; j++) {
                    obj.tbody.appendChild(obj.rows[j]);
                }
            }
        }
    }

    /**
     * Move row
     * 
     * @return void
     */
    obj.moveRow = function(o, d, ignoreDom) {
        if (Object.keys(obj.options.mergeCells).length > 0) {
           if (o > d) {
               var insertBefore = 1;
           } else {
               var insertBefore = 0;
           }

           if (obj.isRowMerged(o).length || obj.isRowMerged(d, insertBefore).length) {
                if (! confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure)) {
                    return false;
                } else {
                    obj.destroyMerged();
                }
            }
        }

        if (obj.options.search == true) {
            if (obj.results && obj.results.length != obj.rows.length) {
                if (confirm(obj.options.text.thisActionWillClearYourSearchResultsAreYouSure)) {
                    obj.resetSearch();
                } else {
                    return false;
                }
            }

            obj.results = null;
        }

        if (! ignoreDom) {
            if (Array.prototype.indexOf.call(obj.tbody.children, obj.rows[d]) >= 0) {
                if (o > d) {
                    obj.tbody.insertBefore(obj.rows[o], obj.rows[d]);
                } else {
                    obj.tbody.insertBefore(obj.rows[o], obj.rows[d].nextSibling);
                }
            } else {
                obj.tbody.removeChild(obj.rows[o]);
            }
        }

        // Place references in the correct position
        obj.rows.splice(d, 0, obj.rows.splice(o, 1)[0]);
        obj.records.splice(d, 0, obj.records.splice(o, 1)[0]);
        obj.options.data.splice(d, 0, obj.options.data.splice(o, 1)[0]);

        // Respect pagination
        if (obj.options.pagination > 0 && obj.tbody.children.length != obj.options.pagination) {
            obj.page(obj.pageNumber);
        }

        // Keeping history of changes
        obj.setHistory({
            action:'moveRow',
            oldValue: o,
            newValue: d,
        });

        // Update table references
        obj.updateTableReferences();

        // Events
        if (obj.ignoreEvents != true) {
            if (typeof(obj.options.onmoverow) == 'function') {
                obj.options.onmoverow(el, o, d);
            }
        }
    }

    /**
     * Insert a new row
     * 
     * @param mixed - number of blank lines to be insert or a single array with the data of the new row
     * @param rowNumber
     * @param insertBefore
     * @return void
     */
    obj.insertRow = function(mixed, rowNumber, insertBefore) {
        // Configuration
        if (obj.options.allowInsertRow == true) {
            // Records
            var records = [];

            // Data to be insert
            var data = [];

            // The insert could be lead by number of rows or the array of data
            if (mixed > 0) {
                var numOfRows = mixed;
            } else {
                var numOfRows = 1;

                if (mixed) {
                    data = mixed;
                }
            }

            // Direction
            var insertBefore = insertBefore ? true : false;

            // Current column number
            var lastRow = obj.options.data.length - 1;

            if (rowNumber == undefined || rowNumber >= parseInt(lastRow) || rowNumber < 0) {
                rowNumber = lastRow;
            }

            // Onbeforeinsertrow
            if (typeof(obj.options.onbeforeinsertrow) == 'function') {
                if (! obj.options.onbeforeinsertrow(el, rowNumber, numOfRows, insertBefore)) {
                    console.log('onbeforeinsertrow returned false');

                    return false;
                }
            }

            // Merged cells
            if (Object.keys(obj.options.mergeCells).length > 0) {
                if (obj.isRowMerged(rowNumber, insertBefore).length) {
                    if (! confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure)) {
                        return false;
                    } else {
                        obj.destroyMerged();
                    }
                }
            }

            // Clear any search
            if (obj.options.search == true) {
                if (obj.results && obj.results.length != obj.rows.length) {
                    if (confirm(obj.options.text.thisActionWillClearYourSearchResultsAreYouSure)) {
                        obj.resetSearch();
                    } else {
                        return false;
                    }
                }

                obj.results = null;
            }

            // Insertbefore
            var rowIndex = (! insertBefore) ? rowNumber + 1 : rowNumber;

            // Keep the current data
            var currentRecords = obj.records.splice(rowIndex);
            var currentData = obj.options.data.splice(rowIndex);
            var currentRows = obj.rows.splice(rowIndex);

            // Adding lines
            var rowRecords = [];
            var rowData = [];
            var rowNode = [];

            for (var row = rowIndex; row < (numOfRows + rowIndex); row++) {
                // Push data to the data container
                obj.options.data[row] = [];
                for (var col = 0; col < obj.options.columns.length; col++) {
                    obj.options.data[row][col]  = data[col] ? data[col] : '';
                }
                // Create row
                var tr = obj.createRow(row, obj.options.data[row]);
                // Append node
                if (currentRows[0]) {
                    if (Array.prototype.indexOf.call(obj.tbody.children, currentRows[0]) >= 0) {
                        obj.tbody.insertBefore(tr, currentRows[0]);
                    }
                } else {
                    if (Array.prototype.indexOf.call(obj.tbody.children, obj.rows[rowNumber]) >= 0) {
                        obj.tbody.appendChild(tr);
                    }
                }
                // Record History
                rowRecords.push(obj.records[row]);
                rowData.push(obj.options.data[row]);
                rowNode.push(tr);
            }

            // Copy the data back to the main data
            Array.prototype.push.apply(obj.records, currentRecords);
            Array.prototype.push.apply(obj.options.data, currentData);
            Array.prototype.push.apply(obj.rows, currentRows);

            // Respect pagination
            if (obj.options.pagination > 0) {
                obj.page(obj.pageNumber);
            }

            // Keep history
            obj.setHistory({
                action: 'insertRow',
                rowNumber: rowNumber,
                numOfRows: numOfRows,
                insertBefore: insertBefore,
                rowRecords: rowRecords,
                rowData: rowData,
                rowNode: rowNode,
            });

            // Remove table references
            obj.updateTableReferences();

            // Events
            if (obj.ignoreEvents != true) {
                if (typeof(obj.options.oninsertrow) == 'function') {
                    obj.options.oninsertrow(el, rowNumber, numOfRows, rowRecords, insertBefore);
                }
            }
        }
    }

    /**
     * Delete a row by number
     * 
     * @param integer rowNumber - row number to be excluded
     * @param integer numOfRows - number of lines
     * @return void
     */
    obj.deleteRow = function(rowNumber, numOfRows) {
        // Global Configuration
        if (obj.options.allowDeleteRow == true) {
            if (obj.options.allowDeletingAllRows == true || obj.options.data.length > 1) {
                // Delete row definitions
                if (rowNumber == undefined) {
                    var number = obj.getSelectedRows();

                    if (! number[0]) {
                        rowNumber = obj.options.data.length - 1;
                        numOfRows = 1;
                    } else {
                        rowNumber = parseInt(number[0].getAttribute('data-y'));
                        numOfRows = number.length;
                    }
                }

                // Last column
                var lastRow = obj.options.data.length - 1;

                if (rowNumber == undefined || rowNumber > lastRow || rowNumber < 0) {
                    rowNumber = lastRow;
                }

                if (! numOfRows) {
                    numOfRows = 1;
                }

                // Do not delete more than the number of recoreds
                if (rowNumber + numOfRows >= obj.options.data.length) {
                    numOfRows = obj.options.data.length - rowNumber;
                }

                // Onbeforedeleterow
                if (typeof(obj.options.onbeforedeleterow) == 'function') {
                    if (! obj.options.onbeforedeleterow(el, rowNumber, numOfRows)) {
                        console.log('onbeforedeleterow returned false');
                        return false;
                    }
                }

                if (parseInt(rowNumber) > -1) {
                    // Merged cells
                    var mergeExists = false;
                    if (Object.keys(obj.options.mergeCells).length > 0) {
                        for (var row = rowNumber; row < rowNumber + numOfRows; row++) {
                            if (obj.isRowMerged(row, false).length) {
                                mergeExists = true;
                            }
                        }
                    }
                    if (mergeExists) {
                        if (! confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure)) {
                            return false;
                        } else {
                            obj.destroyMerged();
                        }
                    }

                    // Clear any search
                    if (obj.options.search == true) {
                        if (obj.results && obj.results.length != obj.rows.length) {
                            if (confirm(obj.options.text.thisActionWillClearYourSearchResultsAreYouSure)) {
                                obj.resetSearch();
                            } else {
                                return false;
                            }
                        }

                        obj.results = null;
                    }

                    // Remove node
                    for (var row = rowNumber; row < rowNumber + numOfRows; row++) {
                        if (Array.prototype.indexOf.call(obj.tbody.children, obj.rows[row]) >= 0) {
                            obj.rows[row].className = '';
                            obj.rows[row].parentNode.removeChild(obj.rows[row]);
                        }
                    }

                    // Remove data
                    var rowRecords = obj.records.splice(rowNumber, numOfRows);
                    var rowData = obj.options.data.splice(rowNumber, numOfRows);
                    var rowNode = obj.rows.splice(rowNumber, numOfRows);

                    // Respect pagination
                    if (obj.options.pagination > 0 && obj.tbody.children.length != obj.options.pagination) {
                        obj.page(obj.pageNumber);
                    }

                    // Remove selection
                    obj.conditionalSelectionUpdate(1, rowNumber, (rowNumber + numOfRows) - 1);

                    // Keep history
                    obj.setHistory({
                        action: 'deleteRow',
                        rowNumber: rowNumber,
                        numOfRows: numOfRows,
                        insertBefore: 1,
                        rowRecords: rowRecords,
                        rowData: rowData,
                        rowNode: rowNode
                    });

                    // Remove table references
                    obj.updateTableReferences();

                    // Events
                    if (obj.ignoreEvents != true) {
                        if (typeof(obj.options.ondeleterow) == 'function') {
                            obj.options.ondeleterow(el, rowNumber, numOfRows, rowRecords);
                        }
                    }
                }
            } else {
                console.error('JEXCEL. It is not possible to delete the last row');
            }
        }
    }


    /**
     * Move column
     * 
     * @return void
     */
    obj.moveColumn = function(o, d) {
        if (Object.keys(obj.options.mergeCells).length > 0) {
            if (o > d) {
                var insertBefore = 1;
            } else {
                var insertBefore = 0;
            }

            if (obj.isColMerged(o).length || obj.isColMerged(d, insertBefore).length) {
                if (! confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure)) {
                    return false;
                } else {
                    obj.destroyMerged();
                }
            }
        }

        var o = parseInt(o);
        var d = parseInt(d);

        if (o > d) {
            obj.headerContainer.insertBefore(obj.headers[o], obj.headers[d]);
            obj.colgroupContainer.insertBefore(obj.colgroup[o], obj.colgroup[d]);

            for (var j = 0; j < obj.rows.length; j++) {
                obj.rows[j].insertBefore(obj.records[j][o], obj.records[j][d]);
            }
        } else {
            obj.headerContainer.insertBefore(obj.headers[o], obj.headers[d].nextSibling);
            obj.colgroupContainer.insertBefore(obj.colgroup[o], obj.colgroup[d].nextSibling);

            for (var j = 0; j < obj.rows.length; j++) {
                obj.rows[j].insertBefore(obj.records[j][o], obj.records[j][d].nextSibling);
            }
        }

        obj.options.columns.splice(d, 0, obj.options.columns.splice(o, 1)[0]);
        obj.headers.splice(d, 0, obj.headers.splice(o, 1)[0]);
        obj.colgroup.splice(d, 0, obj.colgroup.splice(o, 1)[0]);

        for (var j = 0; j < obj.rows.length; j++) {
            obj.options.data[j].splice(d, 0, obj.options.data[j].splice(o, 1)[0]);
            obj.records[j].splice(d, 0, obj.records[j].splice(o, 1)[0]);
        }

        // Keeping history of changes
        obj.setHistory({
            action:'moveColumn',
            oldValue: o,
            newValue: d,
        });

        // Update table references
        obj.updateTableReferences();

        // Events
        if (obj.ignoreEvents != true) {
            if (typeof(obj.options.onmovecolumn) == 'function') {
                obj.options.onmovecolumn(el, o, d);
            }
        }
    }


    /**
     * Insert a new column
     * 
     * @param mixed - num of columns to be added or data to be added in one single column
     * @param int columnNumber - number of columns to be created
     * @param bool insertBefore
     * @param object properties - column properties
     * @return void
     */
    obj.insertColumn = function(mixed, columnNumber, insertBefore, properties) {
        // Configuration
        if (obj.options.allowInsertColumn == true) {
            // Records
            var records = [];

            // Data to be insert
            var data = [];

            // The insert could be lead by number of rows or the array of data
            if (mixed > 0) {
                var numOfColumns = mixed;
            } else {
                var numOfColumns = 1;

                if (mixed) {
                    data = mixed;
                }
            }

            // Direction
            var insertBefore = insertBefore ? true : false;

            // Current column number
            var lastColumn = obj.options.columns.length - 1;

            // Confirm position
            if (columnNumber == undefined || columnNumber >= parseInt(lastColumn) || columnNumber < 0) {
                columnNumber = lastColumn;
            }

            // Onbeforeinsertcolumn
            if (typeof(obj.options.onbeforeinsertcolumn) == 'function') {
                if (! obj.options.onbeforeinsertcolumn(el, columnNumber, numOfColumns, insertBefore)) {
                    console.log('onbeforeinsertcolumn returned false');

                    return false;
                }
            }

            // Merged cells
            if (Object.keys(obj.options.mergeCells).length > 0) {
                if (obj.isColMerged(columnNumber, insertBefore).length) {
                    if (! confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure)) {
                        return false;
                    } else {
                        obj.destroyMerged();
                    }
                }
            }

            // Create default properties
            if (! properties) {
                properties = [];
            }

            for (var i = 0; i < numOfColumns; i++) {
                if (! properties[i]) {
                    properties[i] = { type:'text', source:[], options:[], width:obj.options.defaultColWidth, align:obj.options.defaultColAlign };
                }
            }

            // Insert before
            var columnIndex = (! insertBefore) ? columnNumber + 1 : columnNumber;
            obj.options.columns = jexcel.injectArray(obj.options.columns, columnIndex, properties);

            // Open space in the containers
            var currentHeaders = obj.headers.splice(columnIndex);
            var currentColgroup = obj.colgroup.splice(columnIndex);

            // History
            var historyHeaders = [];
            var historyColgroup = [];
            var historyRecords = [];
            var historyData = [];

            // Add new headers
            for (var col = columnIndex; col < (numOfColumns + columnIndex); col++) {
                obj.createCellHeader(col);
                obj.headerContainer.insertBefore(obj.headers[col], obj.headerContainer.children[col+1]);
                obj.colgroupContainer.insertBefore(obj.colgroup[col], obj.colgroupContainer.children[col+1]);

                historyHeaders.push(obj.headers[col]);
                historyColgroup.push(obj.colgroup[col]);
            }

            // Adding visual columns
            for (var row = 0; row < obj.options.data.length; row++) {
                // Keep the current data
                var currentData = obj.options.data[row].splice(columnIndex);
                var currentRecord = obj.records[row].splice(columnIndex);

                // History
                historyData[row] = [];
                historyRecords[row] = [];

                for (var col = columnIndex; col < (numOfColumns + columnIndex); col++) {
                    // New value
                    var value = data[row] ? data[row] : '';
                    obj.options.data[row][col] = value;
                    // New cell
                    var td = obj.createCell(col, row, obj.options.data[row][col]);
                    obj.records[row][col] = td;
                    // Add cell to the row
                    if (obj.rows[row]) {
                        obj.rows[row].insertBefore(td, obj.rows[row].children[col+1]);
                    }

                    // Record History
                    historyData[row].push(value);
                    historyRecords[row].push(td);
                }

                // Copy the data back to the main data
                Array.prototype.push.apply(obj.options.data[row], currentData);
                Array.prototype.push.apply(obj.records[row], currentRecord);
            }

            Array.prototype.push.apply(obj.headers, currentHeaders);
            Array.prototype.push.apply(obj.colgroup, currentColgroup);

            // Adjust nested headers
            if (obj.options.nestedHeaders && obj.options.nestedHeaders.length > 0) {
                // Flexible way to handle nestedheaders
                if (obj.options.nestedHeaders[0] && obj.options.nestedHeaders[0][0]) {
                    for (var j = 0; j < obj.options.nestedHeaders.length; j++) {
                        var colspan = parseInt(obj.options.nestedHeaders[j][obj.options.nestedHeaders[j].length-1].colspan) + numOfColumns;
                        obj.options.nestedHeaders[j][obj.options.nestedHeaders[j].length-1].colspan = colspan;
                        obj.thead.children[j].children[obj.thead.children[j].children.length-1].setAttribute('colspan', colspan);
                    }
                } else {
                    var colspan = parseInt(obj.options.nestedHeaders[0].colspan) + numOfColumns;
                    obj.options.nestedHeaders[0].colspan = colspan;
                    obj.thead.children[0].children[obj.thead.children[0].children.length-1].setAttribute('colspan', colspan);
                }
            }

            // Keep history
            obj.setHistory({
                action: 'insertColumn',
                columnNumber:columnNumber,
                numOfColumns:numOfColumns,
                insertBefore:insertBefore,
                columns:properties,
                headers:historyHeaders,
                colgroup:historyColgroup,
                records:historyRecords,
                data:historyData,
            });

            // Remove table references
            obj.updateTableReferences();

            // Events
            if (obj.ignoreEvents != true) {
                if (typeof(obj.options.oninsertcolumn) == 'function') {
                    obj.options.oninsertcolumn(el, columnNumber, numOfColumns, historyRecords, insertBefore);
                }
            }
        }
    }

    /**
     * Delete a column by number
     * 
     * @param integer columnNumber - reference column to be excluded
     * @param integer numOfColumns - number of columns to be excluded from the reference column
     * @return void
     */
    obj.deleteColumn = function(columnNumber, numOfColumns) {
        // Global Configuration
        if (obj.options.allowDeleteColumn == true) {
            if (obj.headers.length > 1) {
                // Delete column definitions
                if (columnNumber == undefined) {
                    var number = obj.getSelectedColumns(true);

                    if (! number.length) {
                        // Remove last column
                        columnNumber = obj.headers.length - 1;
                        numOfColumns = 1;
                    } else {
                        // Remove selected
                        columnNumber = parseInt(number[0]);
                        numOfColumns = parseInt(number.length);
                    }
                }

                // Lasat column
                var lastColumn = obj.options.data[0].length - 1;

                if (columnNumber == undefined || columnNumber > lastColumn || columnNumber < 0) {
                    columnNumber = lastColumn;
                }

                // Minimum of columns to be delete is 1
                if (! numOfColumns) {
                    numOfColumns = 1;
                }



                // Can't delete more than the limit of the table
                if (numOfColumns > obj.options.data[0].length - columnNumber) {
                    numOfColumns = obj.options.data[0].length - columnNumber;
                }

                // onbeforedeletecolumn
                if (typeof(obj.options.onbeforedeletecolumn) == 'function') {
                   if (! obj.options.onbeforedeletecolumn(el, columnNumber, numOfColumns)) {
                      console.log('onbeforedeletecolumn returned false');
                      return false;
                   }
                }

                // Can't remove the last column
                if (parseInt(columnNumber) > -1) {
                    // Merged cells
                    var mergeExists = false;
                    if (Object.keys(obj.options.mergeCells).length > 0) {
                        for (var col = columnNumber; col < columnNumber + numOfColumns; col++) {
                            if (obj.isColMerged(col, false).length) {
                                mergeExists = true;
                            }
                        }
                    }
                    if (mergeExists) {
                        if (! confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure)) {
                            return false;
                        } else {
                            obj.destroyMerged();
                        }
                    }

                    // Delete the column properties
                    var columns = obj.options.columns.splice(columnNumber, numOfColumns);

                    for (var col = columnNumber; col < columnNumber + numOfColumns; col++) {
                        obj.colgroup[col].className = '';
                        obj.headers[col].className = '';
                        obj.colgroup[col].parentNode.removeChild(obj.colgroup[col]);
                        obj.headers[col].parentNode.removeChild(obj.headers[col]);
                    }

                    var historyHeaders = obj.headers.splice(columnNumber, numOfColumns);
                    var historyColgroup = obj.colgroup.splice(columnNumber, numOfColumns);
                    var historyRecords = [];
                    var historyData = [];

                    for (var row = 0; row < obj.options.data.length; row++) {
                        for (var col = columnNumber; col < columnNumber + numOfColumns; col++) {
                            obj.records[row][col].className = '';
                            obj.records[row][col].parentNode.removeChild(obj.records[row][col]);
                        }
                    }

                    // Delete headers
                    for (var row = 0; row < obj.options.data.length; row++) {
                        // History
                        historyData[row] = obj.options.data[row].splice(columnNumber, numOfColumns);
                        historyRecords[row] = obj.records[row].splice(columnNumber, numOfColumns);
                    }

                    // Remove selection
                    obj.conditionalSelectionUpdate(0, columnNumber, (columnNumber + numOfColumns) - 1);

                    // Adjust nested headers
                    if (obj.options.nestedHeaders && obj.options.nestedHeaders.length > 0) {
                        // Flexible way to handle nestedheaders
                        if (obj.options.nestedHeaders[0] && obj.options.nestedHeaders[0][0]) {
                            for (var j = 0; j < obj.options.nestedHeaders.length; j++) {
                                var colspan = parseInt(obj.options.nestedHeaders[j][obj.options.nestedHeaders[j].length-1].colspan) - numOfColumns;
                                obj.options.nestedHeaders[j][obj.options.nestedHeaders[j].length-1].colspan = colspan;
                                obj.thead.children[j].children[obj.thead.children[j].children.length-1].setAttribute('colspan', colspan);
                            }
                        } else {
                            var colspan = parseInt(obj.options.nestedHeaders[0].colspan) - numOfColumns;
                            obj.options.nestedHeaders[0].colspan = colspan;
                            obj.thead.children[0].children[obj.thead.children[0].children.length-1].setAttribute('colspan', colspan);
                        }
                    }

                    // Keeping history of changes
                    obj.setHistory({
                        action:'deleteColumn',
                        columnNumber:columnNumber,
                        numOfColumns:numOfColumns,
                        insertBefore: 1,
                        columns:columns,
                        headers:historyHeaders,
                        colgroup:historyColgroup,
                        records:historyRecords,
                        data:historyData,
                    });

                    // Update table references
                    obj.updateTableReferences();

                    // Delete
                    if (obj.ignoreEvents != true) {
                        if (typeof(obj.options.ondeletecolumn) == 'function') {
                            obj.options.ondeletecolumn(el, columnNumber, numOfColumns, historyRecords);
                        }
                    }
                }
            } else {
                console.error('JEXCEL. It is not possible to delete the last column');
            }
        }
    }

    /**
     * Get seleted rows numbers
     * 
     * @return array
     */
    obj.getSelectedRows = function(asIds) {
        var rows = [];
        // Get all selected rows
        for (var j = 0; j < obj.rows.length; j++) {
            if (obj.rows[j].classList.contains('selected')) {
                if (asIds) {
                    rows.push(j);
                } else {
                    rows.push(obj.rows[j]);
                }
            }
        }

        return rows;
    },

    /**
     * Get seleted column numbers
     * 
     * @return array
     */
    obj.getSelectedColumns = function() {
        var cols = [];
        // Get all selected cols
        for (var i = 0; i < obj.headers.length; i++) {
            if (obj.headers[i].classList.contains('selected')) {
                cols.push(i);
            }
        }

        return cols;
    }

    /**
     * Get highlighted
     * 
     * @return array
     */
    obj.getHighlighted = function() {
        return obj.highlighted;
    }

    /**
     * Update cell references
     * 
     * @return void
     */
    obj.updateTableReferences = function() {
        // Update headers
        for (var i = 0; i < obj.headers.length; i++) {
            var x = obj.headers[i].getAttribute('data-x');

            if (x != i) {
                // Update coords
                obj.headers[i].setAttribute('data-x', i);
                // Title
                if (! obj.headers[i].getAttribute('title')) {
                    obj.headers[i].innerHTML = jexcel.getColumnName(i);
                }
            }
        }

        // Update all rows
        for (var j = 0; j < obj.rows.length; j++) {
            if (obj.rows[j]) {
                var y = obj.rows[j].getAttribute('data-y');

                if (y != j) {
                    // Update coords
                    obj.rows[j].setAttribute('data-y', j);
                    obj.rows[j].children[0].setAttribute('data-y', j);
                    // Row number
                    obj.rows[j].children[0].innerHTML = j + 1;
                }
            }
        }

        // Regular cells affected by this change
        var affectedTokens = [];
        var mergeCellUpdates = [];

        // Update cell
        var updatePosition = function(x,y,i,j) {
            if (x != i) {
                obj.records[j][i].setAttribute('data-x', i);
            }
            if (y != j) {
                obj.records[j][i].setAttribute('data-y', j);
            }

            // Other updates
            if (x != i || y != j) {
                var columnIdFrom = jexcel.getColumnNameFromId([x, y]);
                var columnIdTo = jexcel.getColumnNameFromId([i, j]);
                affectedTokens[columnIdFrom] = columnIdTo;
            }
        }

        for (var j = 0; j < obj.records.length; j++) {
            for (var i = 0; i < obj.records[0].length; i++) {
                if (obj.records[j][i]) {
                    // Current values
                    var x = obj.records[j][i].getAttribute('data-x');
                    var y = obj.records[j][i].getAttribute('data-y');

                    // Update column
                    if (obj.records[j][i].getAttribute('data-merged')) {
                        var columnIdFrom = jexcel.getColumnNameFromId([x, y]);
                        var columnIdTo = jexcel.getColumnNameFromId([i, j]);
                        if (mergeCellUpdates[columnIdFrom] == null) {
                            if (columnIdFrom == columnIdTo) {
                                mergeCellUpdates[columnIdFrom] = false;
                            } else {
                                var totalX = parseInt(i - x);
                                var totalY = parseInt(j - y);
                                mergeCellUpdates[columnIdFrom] = [ columnIdTo, totalX, totalY ];
                            }
                        }
                    } else {
                        updatePosition(x,y,i,j);
                    }
                }
            }
        }

        // Update merged if applicable
        var keys = Object.keys(mergeCellUpdates);
        if (keys.length) {
            for (var i = 0; i < keys.length; i++) {
                if (mergeCellUpdates[keys[i]]) {
                    var info = jexcel.getIdFromColumnName(keys[i], true)
                    var x = info[0];
                    var y = info[1];
                    updatePosition(x,y,x + mergeCellUpdates[keys[i]][1],y + mergeCellUpdates[keys[i]][2]);

                    var columnIdFrom = keys[i];
                    var columnIdTo = mergeCellUpdates[keys[i]][0];
                    for (var j = 0; j < obj.options.mergeCells[columnIdFrom][2].length; j++) {
                        var x = parseInt(obj.options.mergeCells[columnIdFrom][2][j].getAttribute('data-x'));
                        var y = parseInt(obj.options.mergeCells[columnIdFrom][2][j].getAttribute('data-y'));
                        obj.options.mergeCells[columnIdFrom][2][j].setAttribute('data-x', x + mergeCellUpdates[keys[i]][1]);
                        obj.options.mergeCells[columnIdFrom][2][j].setAttribute('data-y', y + mergeCellUpdates[keys[i]][2]);
                    }

                    obj.options.mergeCells[columnIdTo] = obj.options.mergeCells[columnIdFrom];
                    delete(obj.options.mergeCells[columnIdFrom]);
                }
            }
        }

        // Update formulas
        obj.updateFormulas(affectedTokens);

        // Update meta data
        obj.updateMeta(affectedTokens);

        // Refresh selection
        obj.refreshSelection();

        // Update table with custom configuration if applicable
        obj.updateTable();
    }

    /**
     * Custom settings for the cells
     */
    obj.updateTable = function() {
        // Check for spare
        if (obj.options.minSpareRows > 0) {
            var numBlankRows = 0;
            for (var j = obj.rows.length - 1; j >= 0; j--) {
                var test = false;
                for (var i = 0; i < obj.headers.length; i++) {
                    if (obj.options.data[j][i]) {
                        test = true;
                    }
                }
                if (test) {
                    break;
                } else {
                    numBlankRows++;
                }
            }

            if (obj.options.minSpareRows - numBlankRows > 0) {
                obj.insertRow(obj.options.minSpareRows - numBlankRows)
            }
        }

        if (obj.options.minSpareCols > 0) {
            var numBlankCols = 0;
            for (var i = obj.headers.length - 1; i >= 0 ; i--) {
                var test = false;
                for (var j = 0; j < obj.rows.length; j++) {
                    if (obj.options.data[j][i]) {
                        test = true;
                    }
                }
                if (test) {
                    break;
                } else {
                    numBlankCols++;
                }
            }

            if (obj.options.minSpareCols - numBlankCols > 0) {
                obj.insertColumn(obj.options.minSpareCols - numBlankCols)
            }
        }

        // Customizations by the developer
        if (typeof(obj.options.updateTable) == 'function') {
            if (obj.options.detachForUpdates) {
                el.removeChild(obj.content);
            }

            for (var j = 0; j < obj.rows.length; j++) {
                for (var i = 0; i < obj.headers.length; i++) {
                    obj.options.updateTable(el, obj.records[j][i], i, j, obj.options.data[j][i], obj.records[j][i].innerText, jexcel.getColumnNameFromId([i, j]));
                }
            }

            if (obj.options.detachForUpdates) {
                el.insertBefore(obj.content, obj.pagination);
            }
        }

        // Update corner position
        setTimeout(function() {
            obj.updateCornerPosition();
        },0);
    }

    /**
     * Show column
     */
    obj.showColumn = function(colNumber) {
        obj.headers[colNumber].style.display = '';
        obj.colgroup[colNumber].style.display = '';
        for (var j = 0; j < obj.options.data.length; j++) {
            obj.records[j][colNumber].style.display = '';
        }
    }

    /**
     * Hide column
     */
    obj.hideColumn = function(colNumber) {
        obj.headers[colNumber].style.display = 'none';
        obj.colgroup[colNumber].style.display = 'none';
        for (var j = 0; j < obj.options.data.length; j++) {
            obj.records[j][colNumber].style.display = 'none';
        }
    }

    /**
     * Show index column
     */
    obj.showIndex = function() {
        obj.table.classList.remove('jexcel_hidden_index');
    }

    /**
     * Hide index column
     */
    obj.hideIndex = function() {
        obj.table.classList.add('jexcel_hidden_index');
    }

    /**
     * Update all related cells in the chain
     */
    var chainLoopProtection = [];

    obj.updateFormulaChain = function(x, y, records) {
        var cellId = jexcel.getColumnNameFromId([x, y]);
        if (obj.formula[cellId] && obj.formula[cellId].length > 0) {
            if (chainLoopProtection[cellId]) {
                obj.records[y][x].innerHTML = '#ERROR';
                obj.formula[cellId] = '';
            } else {
                // Protection
                chainLoopProtection[cellId] = true;

                for (var i = 0; i < obj.formula[cellId].length; i++) {
                    var cell = jexcel.getIdFromColumnName(obj.formula[cellId][i], true);
                    // Update cell
                    var value = ''+obj.options.data[cell[1]][cell[0]];
                    if (value.substr(0,1) == '=') {
                        records.push(obj.updateCell(cell[0], cell[1], value, true));
                    } else {
                        // No longer a formula, remove from the chain
                        Object.keys(obj.formula)[i] = null;
                    }
                    obj.updateFormulaChain(cell[0], cell[1], records);
                }
            }
        }

        chainLoopProtection = [];
    }

    /**
     * Update formulas
     */
    obj.updateFormulas = function(referencesToUpdate) {
        // Update formulas
        for (var j = 0; j < obj.options.data.length; j++) {
            for (var i = 0; i < obj.options.data[0].length; i++) {
                var value = '' + obj.options.data[j][i];
                // Is formula
                if (value.substr(0,1) == '=') {
                    // Replace tokens
                    var newFormula = obj.updateFormula(value, referencesToUpdate);
                    if (newFormula != value) {
                        obj.options.data[j][i] = newFormula;
                    }
                }
            }
        }

        // Update formula chain
        var formula = [];
        var keys = Object.keys(obj.formula);
        for (var j = 0; j < keys.length; j++) {
            // Current key and values
            var key = keys[j];
            var value = obj.formula[key];
            // Update key
            if (referencesToUpdate[key]) {
                key = referencesToUpdate[key];
            }
            // Update values
            formula[key] = [];
            for (var i = 0; i < value.length; i++) {
                var letter = value[i];
                if (referencesToUpdate[letter]) {
                    letter = referencesToUpdate[letter];
                }
                formula[key].push(letter);
            }
        }
        obj.formula = formula;
    }

    /**
     * Update formula
     */
    obj.updateFormula = function(formula, referencesToUpdate) {
        var testLetter = /[A-Z]/;
        var testNumber = /[0-9]/;

        var newFormula = '';
        var letter = null;
        var number = null;
        var token = '';

        for (var index = 0; index < formula.length; index++) {
            if (testLetter.exec(formula[index])) {
                letter = 1;
                number = 0;
                token += formula[index];
            } else if (testNumber.exec(formula[index])) {
                number = letter ? 1 : 0;
                token += formula[index];
            } else {
                if (letter && number) {
                    token = referencesToUpdate[token] ? referencesToUpdate[token] : token;
                }
                newFormula += token;
                newFormula += formula[index];
                letter = 0;
                number = 0;
                token = '';
            }
        }

        if (token) {
            if (letter && number) {
                token = referencesToUpdate[token] ? referencesToUpdate[token] : token;
            }
            newFormula += token;
        }

        return newFormula;
    }

    /**
     * Parse formulas
     */
    obj.executeFormula = function(expression, x, y) {

        var formulaResults = [];
        var formulaLoopProtection = [];

        // Execute formula with loop protection
        var execute = function(expression, x, y) {
         // Parent column identification
            var parentId = jexcel.getColumnNameFromId([x, y]);

            // Code protection
            if (formulaLoopProtection[parentId]) {
                console.error('Reference loop detected');
                return '#ERROR';
            }

            formulaLoopProtection[parentId] = true;

            // Convert range tokens
            var tokensUpdate = function(tokens) {
                for (var index = 0; index < tokens.length; index++) {
                    var f = [];
                    var token = tokens[index].split(':');
                    var e1 = jexcel.getIdFromColumnName(token[0], true);
                    var e2 = jexcel.getIdFromColumnName(token[1], true);

                    if (e1[0] <= e2[0]) {
                        var x1 = e1[0];
                        var x2 = e2[0];
                    } else {
                        var x1 = e2[0];
                        var x2 = e1[0];
                    }

                    if (e1[1] <= e2[1]) {
                        var y1 = e1[1];
                        var y2 = e2[1];
                    } else {
                        var y1 = e2[1];
                        var y2 = e1[1];
                    }

                    for (var j = y1; j <= y2; j++) {
                        for (var i = x1; i <= x2; i++) {
                            f.push(jexcel.getColumnNameFromId([i, j]));
                        }
                    }

                    expression = expression.replace(tokens[index], f.join(','));
                }
            }

            var tokens = expression.match(/([A-Z]+[0-9]+)\:([A-Z]+[0-9]+)/g);
            if (tokens && tokens.length) {
                tokensUpdate(tokens);
            }

            // String
            var evalstring = '';

            // Get tokens
            var tokens = expression.match(/([A-Z]+[0-9]+)/g);

            // Direct self-reference protection
            if (tokens && tokens.indexOf(parentId) > -1) {
                console.error('Self Reference detected');
                return '#ERROR';
            } else {
                if (tokens) {
                    for (var i = 0; i < tokens.length; i++) {
                        // Keep chain
                        if (! obj.formula[tokens[i]]) {
                            obj.formula[tokens[i]] = [];
                        }
                        // Is already in the register
                        if (obj.formula[tokens[i]].indexOf(parentId) < 0) {
                            obj.formula[tokens[i]].push(parentId);
                        }

                        // Do not calculate again
                        if (eval('typeof(' + tokens[i] + ') == "undefined"')) {
                            // Coords
                            var position = jexcel.getIdFromColumnName(tokens[i], 1);
                            // Get value
                            if (typeof(obj.options.data[position[1]]) != 'undefined' && typeof(obj.options.data[position[1]][position[0]]) != 'undefined') {
                                var value = obj.options.data[position[1]][position[0]];
                            } else {
                                var value = '';
                            }
                            // Get column data
                            if ((''+value).substr(0,1) == '=') {
                                if (formulaResults[tokens[i]]) {
                                    value = formulaResults[tokens[i]];
                                } else {
                                    value = execute(value, position[0], position[1]);
                                    formulaResults[tokens[i]] = value;
                                }
                            }
                            // Type!
                            if ((''+value).trim() == '') {
                                // Null
                                evalstring += "var " + tokens[i] + " = null;";
                            } else {
                                if (value == Number(value) && obj.options.autoCasting == true) {
                                    // Number
                                    evalstring += "var " + tokens[i] + " = " + Number(value) + ";";
                                } else {
                                    // Trying any formatted number
                                    var number = obj.parseNumber(value, position[0])
                                    if (obj.options.autoCasting == true && number) {
                                        // Render as number
                                        evalstring += "var " + tokens[i] + " = " + number + ";";
                                    } else {
                                        // Render as string
                                        evalstring += "var " + tokens[i] + " = '" + value + "';";
                                    }
                                }
                            }
                        }
                    }
                }

                // Convert formula to javascript
                try {
                    evalstring += "function COLUMN() { return parseInt(x) + 1; }; function ROW() { return parseInt(y) + 1; }; function CELL() { return parentId; };";

                    var res = eval(evalstring + expression.substr(1));
                } catch (e) {
                    var res = '#ERROR';
                }

                return res;
            }
        }

        return execute(expression, x, y);
    }

    /**
     * Trying to extract a number from a string
     */
    obj.parseNumber = function(value, columnNumber) {
        // Decimal point
        var decimal = columnNumber && obj.options.columns[columnNumber].decimal ? obj.options.columns[columnNumber].decimal : '.';

        // Parse both parts of the number
        var number = ('' + value);
        number = number.split(decimal);
        number[0] = number[0].match(/[+-]?[0-9]/g);
        if (number[0]) {
            number[0] = number[0].join('');
        }
        if (number[1]) {
            number[1] = number[1].match(/[0-9]*/g).join('');
        }

        // Is a valid number
        if (number[0] && Number(number[0]) >= 0) {
            if (! number[1]) {
                var value = Number(number[0] + '.00');
            } else {
                var value = Number(number[0] + '.' + number[1]);
            }
        } else {
            var value = null;
        }

        return value;
    }

    /**
     * Get row number
     */
    obj.row = function(cell) {
    }

    /**
     * Get col number
     */
    obj.col = function(cell) {
    }

    obj.up = function(shiftKey, ctrlKey) {
        if (shiftKey) {
            if (obj.selectedCell[3] > 0) {
                obj.up.visible(1, ctrlKey ? 0 : 1)
            }
        } else {
            if (obj.selectedCell[1] > 0) {
                obj.up.visible(0, ctrlKey ? 0 : 1)
            }
            obj.selectedCell[2] = obj.selectedCell[0];
            obj.selectedCell[3] = obj.selectedCell[1];
        }

        // Update selection
        obj.updateSelectionFromCoords(obj.selectedCell[0], obj.selectedCell[1], obj.selectedCell[2], obj.selectedCell[3]);

        // Change page
        if (obj.options.lazyLoading == true) {
            if (obj.selectedCell[1] == 0 || obj.selectedCell[3] == 0) {
                obj.loadPage(0);
                obj.updateSelectionFromCoords(obj.selectedCell[0], obj.selectedCell[1], obj.selectedCell[2], obj.selectedCell[3]);
            } else {
                if (obj.loadValidation()) {
                    obj.updateSelectionFromCoords(obj.selectedCell[0], obj.selectedCell[1], obj.selectedCell[2], obj.selectedCell[3]);
                } else {
                    var item = parseInt(obj.tbody.firstChild.getAttribute('data-y'));
                    if (obj.selectedCell[1] - item < 30) {
                        obj.loadUp();
                        obj.updateSelectionFromCoords(obj.selectedCell[0], obj.selectedCell[1], obj.selectedCell[2], obj.selectedCell[3]);
                    }
                }
            }
        } else if (obj.options.pagination > 0) {
            var pageNumber = obj.whichPage(obj.selectedCell[3]);
            if (pageNumber != obj.pageNumber) {
                obj.page(pageNumber);
            }
        }

        obj.updateScroll(1);
    }

    obj.up.visible = function(group, direction) {
        if (group == 0) {
            var x = parseInt(obj.selectedCell[0]);
            var y = parseInt(obj.selectedCell[1]);
        } else {
            var x = parseInt(obj.selectedCell[2]);
            var y = parseInt(obj.selectedCell[3]);
        }

        if (direction == 0) {
            for (var j = 0; j < y; j++) {
                if (obj.records[j][x].style.display != 'none' && obj.rows[j].style.display != 'none') {
                    y = j;
                    break;
                }
            }
        } else {
            y = obj.up.get(x, y);
        }

        if (group == 0) {
            obj.selectedCell[0] = x;
            obj.selectedCell[1] = y;
        } else {
            obj.selectedCell[2] = x;
            obj.selectedCell[3] = y;
        }
    }

    obj.up.get = function(x, y) {
        var x = parseInt(x);
        var y = parseInt(y);
        for (var j = (y - 1); j >= 0; j--) {
            if (obj.records[j][x].style.display != 'none' && obj.rows[j].style.display != 'none') {
                if (obj.records[j][x].getAttribute('data-merged')) {
                    if (obj.records[j][x] == obj.records[y][x]) {
                        continue;
                    }
                }
                y = j;
                break;
            }
        }

        return y;
    }

    obj.down = function(shiftKey, ctrlKey) {
        if (shiftKey) {
            if (obj.selectedCell[3] < obj.records.length - 1) {
                obj.down.visible(1, ctrlKey ? 0 : 1)
            }
        } else {
            if (obj.selectedCell[1] < obj.records.length - 1) {
                obj.down.visible(0, ctrlKey ? 0 : 1)
            }
            obj.selectedCell[2] = obj.selectedCell[0];
            obj.selectedCell[3] = obj.selectedCell[1];
        }

        obj.updateSelectionFromCoords(obj.selectedCell[0], obj.selectedCell[1], obj.selectedCell[2], obj.selectedCell[3]);

        // Change page
        if (obj.options.lazyLoading == true) {
            if ((obj.selectedCell[1] == obj.records.length - 1 || obj.selectedCell[3] == obj.records.length - 1)) {
                obj.loadPage(-1);
                obj.updateSelectionFromCoords(obj.selectedCell[0], obj.selectedCell[1], obj.selectedCell[2], obj.selectedCell[3]);
            } else {
                if (obj.loadValidation()) {
                    obj.updateSelectionFromCoords(obj.selectedCell[0], obj.selectedCell[1], obj.selectedCell[2], obj.selectedCell[3]);
                } else {
                    var item = parseInt(obj.tbody.lastChild.getAttribute('data-y'));
                    if (item - obj.selectedCell[3] < 30) {
                        obj.loadDown();
                        obj.updateSelectionFromCoords(obj.selectedCell[0], obj.selectedCell[1], obj.selectedCell[2], obj.selectedCell[3]);
                    }
                }
            }
        } else if (obj.options.pagination > 0) {
            var pageNumber = obj.whichPage(obj.selectedCell[3]);
            if (pageNumber != obj.pageNumber) {
                obj.page(pageNumber);
            }
        }

        obj.updateScroll(3);
    }

    obj.down.visible = function(group, direction) {
        if (group == 0) {
            var x = parseInt(obj.selectedCell[0]);
            var y = parseInt(obj.selectedCell[1]);
        } else {
            var x = parseInt(obj.selectedCell[2]);
            var y = parseInt(obj.selectedCell[3]);
        }

        if (direction == 0) {
            for (var j = obj.rows.length - 1; j > y; j--) {
                if (obj.records[j][x].style.display != 'none' && obj.rows[j].style.display != 'none') {
                    y = j;
                    break;
                }
            }
        } else {
            y = obj.down.get(x, y);
        }

        if (group == 0) {
            obj.selectedCell[0] = x;
            obj.selectedCell[1] = y;
        } else {
            obj.selectedCell[2] = x;
            obj.selectedCell[3] = y;
        }
    }

    obj.down.get = function(x, y) {
        var x = parseInt(x);
        var y = parseInt(y);
        for (var j = (y + 1); j < obj.rows.length; j++) {
            if (obj.records[j][x].style.display != 'none' && obj.rows[j].style.display != 'none') {
                if (obj.records[j][x].getAttribute('data-merged')) {
                    if (obj.records[j][x] == obj.records[y][x]) {
                        continue;
                    }
                }
                y = j;
                break;
            }
        }

        return y;
    }

    obj.right = function(shiftKey, ctrlKey) {
        if (shiftKey) {
            if (obj.selectedCell[2] < obj.headers.length - 1) {
                obj.right.visible(1, ctrlKey ? 0 : 1)
            }
        } else {
            if (obj.selectedCell[0] < obj.headers.length - 1) {
                obj.right.visible(0, ctrlKey ? 0 : 1)
            }
            obj.selectedCell[2] = obj.selectedCell[0];
            obj.selectedCell[3] = obj.selectedCell[1];
        }

        obj.updateSelectionFromCoords(obj.selectedCell[0], obj.selectedCell[1], obj.selectedCell[2], obj.selectedCell[3]);
        obj.updateScroll(2);
    }

    obj.right.visible = function(group, direction) {
        if (group == 0) {
            var x = parseInt(obj.selectedCell[0]);
            var y = parseInt(obj.selectedCell[1]);
        } else {
            var x = parseInt(obj.selectedCell[2]);
            var y = parseInt(obj.selectedCell[3]);
        }

        if (direction == 0) {
            for (var i = obj.headers.length - 1; i > x; i--) {
                if (obj.records[y][i].style.display != 'none') {
                    x = i;
                    break;
                }
            }
        } else {
            x = obj.right.get(x, y);
        }

        if (group == 0) {
            obj.selectedCell[0] = x;
            obj.selectedCell[1] = y;
        } else {
            obj.selectedCell[2] = x;
            obj.selectedCell[3] = y;
        }
    }

    obj.right.get = function(x, y) {
        var x = parseInt(x);
        var y = parseInt(y);

        for (var i = (x + 1); i < obj.headers.length; i++) {
            if (obj.records[y][i].style.display != 'none') {
                if (obj.records[y][i].getAttribute('data-merged')) {
                    if (obj.records[y][i] == obj.records[y][x]) {
                        continue;
                    }
                }
                x = i;
                break;
            }
        }

        return x;
    }

    obj.left = function(shiftKey, ctrlKey) {
        if (shiftKey) {
            if (obj.selectedCell[2] > 0) {
                obj.left.visible(1, ctrlKey ? 0 : 1)
            }
        } else {
            if (obj.selectedCell[0] > 0) {
                obj.left.visible(0, ctrlKey ? 0 : 1)
            }
            obj.selectedCell[2] = obj.selectedCell[0];
            obj.selectedCell[3] = obj.selectedCell[1];
        }

        obj.updateSelectionFromCoords(obj.selectedCell[0], obj.selectedCell[1], obj.selectedCell[2], obj.selectedCell[3]);
        obj.updateScroll(0);
    }

    obj.left.visible = function(group, direction) {
        if (group == 0) {
            var x = parseInt(obj.selectedCell[0]);
            var y = parseInt(obj.selectedCell[1]);
        } else {
            var x = parseInt(obj.selectedCell[2]);
            var y = parseInt(obj.selectedCell[3]);
        }

        if (direction == 0) {
            for (var i = 0; i < x; i++) {
                if (obj.records[y][i].style.display != 'none') {
                    x = i;
                    break;
                }
            }
        } else {
            x = obj.left.get(x, y);
        }

        if (group == 0) {
            obj.selectedCell[0] = x;
            obj.selectedCell[1] = y;
        } else {
            obj.selectedCell[2] = x;
            obj.selectedCell[3] = y;
        }
    }

    obj.left.get = function(x, y) {
        var x = parseInt(x);
        var y = parseInt(y);
        for (var i = (x - 1); i >= 0; i--) {
            if (obj.records[y][i].style.display != 'none') {
                if (obj.records[y][i].getAttribute('data-merged')) {
                    if (obj.records[y][i] == obj.records[y][x]) {
                        continue;
                    }
                }
                x = i;
                break;
            }
        }

        return x;
    }

    obj.first = function(shiftKey, ctrlKey) {
        if (shiftKey) {
            if (ctrlKey) {
                obj.selectedCell[3] = 0;
            } else {
                obj.left.visible(1, 0);
            }
        } else {
            if (ctrlKey) {
                obj.selectedCell[1] = 0;
            } else {
                obj.left.visible(0, 0);
            }
            obj.selectedCell[2] = obj.selectedCell[0];
            obj.selectedCell[3] = obj.selectedCell[1];
        }

        // Change page
        if (obj.options.lazyLoading == true && (obj.selectedCell[1] == 0 || obj.selectedCell[3] == 0)) {
            obj.loadPage(0);
        } else if (obj.options.pagination > 0) {
            var pageNumber = obj.whichPage(obj.selectedCell[3]);
            if (pageNumber != obj.pageNumber) {
                obj.page(pageNumber);
            }
        }

        obj.updateSelectionFromCoords(obj.selectedCell[0], obj.selectedCell[1], obj.selectedCell[2], obj.selectedCell[3]);
        obj.updateScroll(1);
    }

    obj.last = function(shiftKey, ctrlKey) {
        if (shiftKey) {
            if (ctrlKey) {
                obj.selectedCell[3] = obj.records.length - 1;
            } else {
                obj.right.visible(1, 0);
            }
        } else {
            if (ctrlKey) {
                obj.selectedCell[1] = obj.records.length - 1;
            } else {
                obj.right.visible(0, 0);
            }
            obj.selectedCell[2] = obj.selectedCell[0];
            obj.selectedCell[3] = obj.selectedCell[1];
        }

        // Change page
        if (obj.options.lazyLoading == true && (obj.selectedCell[1] == obj.records.length - 1 || obj.selectedCell[3] == obj.records.length - 1)) {
            obj.loadPage(-1);
        } else if (obj.options.pagination > 0) {
            var pageNumber = obj.whichPage(obj.selectedCell[3]);
            if (pageNumber != obj.pageNumber) {
                obj.page(pageNumber);
            }
        }

        obj.updateSelectionFromCoords(obj.selectedCell[0], obj.selectedCell[1], obj.selectedCell[2], obj.selectedCell[3]);
        obj.updateScroll(3);
    }

    obj.selectAll = function() {
        if (! obj.selectedCell) {
            obj.selectedCell = [];
        }

        obj.selectedCell[0] = 0;
        obj.selectedCell[1] = 0;
        obj.selectedCell[2] = obj.headers.length - 1;
        obj.selectedCell[3] = obj.records.length - 1;

        obj.updateSelectionFromCoords(obj.selectedCell[0], obj.selectedCell[1], obj.selectedCell[2], obj.selectedCell[3]);
    }

    /**
     * Go to a page in a lazyLoading
     */
    obj.loadPage = function(pageNumber) {
        // Search
        if (obj.options.search == true && obj.results) {
            var results = obj.results;
        } else {
            var results = obj.rows;
        }

        // Per page
        var quantityPerPage = 100;

        // pageNumber
        if (pageNumber == null || pageNumber == -1) {
            // Last page
            pageNumber = Math.ceil(results.length / quantityPerPage); 
        }

        var startRow = (pageNumber * quantityPerPage);
        var finalRow = (pageNumber * quantityPerPage) + quantityPerPage;
        if (finalRow > results.length) {
            finalRow = results.length;
        }
        startRow = finalRow - 100;
        if (startRow < 0) {
            startRow = 0;
        }

        // Appeding items
        for (var j = startRow; j < finalRow; j++) {
            if (obj.options.search == true && obj.results) {
                obj.tbody.appendChild(obj.rows[results[j]]);
            } else {
                obj.tbody.appendChild(obj.rows[j]);
            }

            if (obj.tbody.children.length > quantityPerPage) {
                obj.tbody.removeChild(obj.tbody.firstChild);
            }
        }
    }

    obj.loadUp = function() {
        // Search
        if (obj.options.search == true && obj.results) {
            var results = obj.results;
        } else {
            var results = obj.rows;
        }
        var test = 0;
        if (results.length > 100) {
            // Get the first element in the page
            var item = parseInt(obj.tbody.firstChild.getAttribute('data-y'));
            if (obj.options.search == true && obj.results) {
                item = results.indexOf(item);
            }
            if (item > 0) {
                for (var j = 0; j < 30; j++) {
                    item = item - 1;
                    if (item > -1) {
                        if (obj.options.search == true && obj.results) {
                            obj.tbody.insertBefore(obj.rows[results[item]], obj.tbody.firstChild);
                        } else {
                            obj.tbody.insertBefore(obj.rows[item], obj.tbody.firstChild);
                        }
                        if (obj.tbody.children.length > 100) {
                            obj.tbody.removeChild(obj.tbody.lastChild);
                            test = 1;
                        }
                    }
                }
            }
        }
        return test;
    }

    obj.loadDown = function() {
        // Search
        if (obj.options.search == true && obj.results) {
            var results = obj.results;
        } else {
            var results = obj.rows;
        }
        var test = 0;
        if (results.length > 100) {
            // Get the last element in the page
            var item = parseInt(obj.tbody.lastChild.getAttribute('data-y'));
            if (obj.options.search == true && obj.results) {
                item = results.indexOf(item);
            }
            if (item < obj.rows.length - 1) {
                for (var j = 0; j <= 30; j++) {
                    if (item < results.length) {
                        if (obj.options.search == true && obj.results) {
                            obj.tbody.appendChild(obj.rows[results[item]]);
                        } else {
                            obj.tbody.appendChild(obj.rows[item]);
                        }
                        if (obj.tbody.children.length > 100) {
                            obj.tbody.removeChild(obj.tbody.firstChild);
                            test = 1;
                        }
                    }
                    item = item + 1;
                }
            }
        }

        return test;
    }

    obj.loadValidation = function() {
        if (obj.selectedCell) {
            var currentPage = parseInt(obj.tbody.firstChild.getAttribute('data-y')) / 100;
            var selectedPage = parseInt(obj.selectedCell[3] / 100);
            var totalPages = parseInt(obj.rows.length / 100);

            if (currentPage != selectedPage && selectedPage <= totalPages) {
                if (! Array.prototype.indexOf.call(obj.tbody.children, obj.rows[obj.selectedCell[3]])) {
                    obj.loadPage(selectedPage);
                    return true;
                }
            }
        }

        return false;
    }

    /**
     * Reset search
     */
    obj.resetSearch = function() {
        obj.searchInput.value = '';
        obj.search('');
        obj.results = null;
    }

    /**
     * Search
     */
    obj.search = function(query) {
        // Query
        if (query) {
            var query = query.toLowerCase();
        }

        // Reset selection
        obj.resetSelection();

        // Total of results
        obj.pageNumber = 0;
        obj.results = [];

        if (query) {
            // Search filter
            var search = function(item, query, index) {
                for (var i = 0; i < item.length; i++) {
                    if ((''+item[i]).toLowerCase().search(query) >= 0 ||
                        (''+obj.records[index][i].innerHTML).toLowerCase().search(query) >= 0) {
                        return true;
                    }
                }
                return false;
            }

            // Result
            var addToResult = function(k) {
                if (obj.results.indexOf(k) == -1) {
                    obj.results.push(k);
                }
            }

            // Filter
            var data = obj.options.data.filter(function(v, k) {
                if (search(v, query, k)) {
                    // Merged rows found
                    var rows = obj.isRowMerged(k);
                    if (rows.length) {
                        for (var i = 0; i < rows.length; i++) {
                            var row = jexcel.getIdFromColumnName(rows[i], true);
                            for (var j = 0; j < obj.options.mergeCells[rows[i]][1]; j++) {
                                addToResult(row[1]+j);
                            }
                        }
                    } else {
                        // Normal row found
                        addToResult(k);
                    }
                    return true;
                } else {
                    return false;
                }
            });
        } else {
            obj.results = null;
        }

        var total = 0;
        var index = 0;

        // Page 1
        if (obj.options.lazyLoading == true) {
            total = 100;
        } else if (obj.options.pagination > 0) {
            total = obj.options.pagination;
        } else {
            if (obj.results) {
                total = obj.results.length;
            } else {
                total = obj.rows.length;
            }
        }

        // Reset current nodes
        while (obj.tbody.firstChild) {
            obj.tbody.removeChild(obj.tbody.firstChild);
        }

        // Hide all records from the table
        for (var j = 0; j < obj.rows.length; j++) {
            if (! obj.results || obj.results.indexOf(j) > -1) {
                if (index < total) {
                    obj.tbody.appendChild(obj.rows[j]);
                    index++;
                }
                obj.rows[j].style.display = '';
            } else {
                obj.rows[j].style.display = 'none';
            }
        }

        // Update pagination
        if (obj.options.pagination > 0) {
            obj.updatePagination();
        }

        return total;
    }

    /**
     * Which page the cell is
     */
    obj.whichPage = function(cell) {
        // Search
        if (obj.options.search == true && obj.results) {
            cell = obj.results.indexOf(cell);
        }

        return (Math.ceil((parseInt(cell) + 1) / parseInt(obj.options.pagination))) - 1;
    }

    /**
     * Go to page
     */
    obj.page = function(pageNumber) {
        var oldPage = obj.pageNumber;

        // Search
        if (obj.options.search == true && obj.results) {
            var results = obj.results;
        } else {
            var results = obj.rows;
        }

        // Per page
        var quantityPerPage = parseInt(obj.options.pagination);

        // pageNumber
        if (pageNumber == null || pageNumber == -1) {
            // Last page
            pageNumber = Math.ceil(results.length / quantityPerPage); 
        }

        // Page number
        obj.pageNumber = pageNumber;

        var startRow = (pageNumber * quantityPerPage);
        var finalRow = (pageNumber * quantityPerPage) + quantityPerPage;
        if (finalRow > results.length) {
            finalRow = results.length;
        }
        if (startRow < 0) {
            startRow = 0;
        }

        // Reset container
        while (obj.tbody.firstChild) {
            obj.tbody.removeChild(obj.tbody.firstChild);
        }

        // Appeding items
        for (var j = startRow; j < finalRow; j++) {
            if (obj.options.search == true && obj.results) {
                obj.tbody.appendChild(obj.rows[results[j]]);
            } else {
                obj.tbody.appendChild(obj.rows[j]);
            }
        }

        if (obj.options.pagination > 0) {
            obj.updatePagination();
        }

        // Update corner position
        obj.updateCornerPosition();

        if (typeof(obj.options.onchangepage) == 'function') {
            obj.options.onchangepage(el, pageNumber, oldPage);
        }
    }

    /**
     * Update the pagination
     */
    obj.updatePagination = function() {
        // Reset container
        obj.pagination.children[0].innerHTML = '';
        obj.pagination.children[1].innerHTML = '';

        // Start pagination
        if (obj.options.pagination) {
            // Searchable
            if (obj.options.search == true && obj.results) {
                var results = obj.results.length;
            } else {
                var results = obj.rows.length;
            }

            if (! results) {
                // No records found
                obj.pagination.children[0].innerHTML = obj.options.text.noRecordsFound;
            } else {
                // Pagination container
                var quantyOfPages = Math.ceil(results / obj.options.pagination);

                if (obj.pageNumber < 6) {
                    var startNumber = 1;
                    var finalNumber = quantyOfPages < 10 ? quantyOfPages : 10;
                } else if (quantyOfPages - obj.pageNumber < 5) {
                    var startNumber = quantyOfPages - 9;
                    var finalNumber = quantyOfPages;
                    if (startNumber < 1) {
                        startNumber = 1;
                    }
                } else {
                    var startNumber = obj.pageNumber - 4;
                    var finalNumber = obj.pageNumber + 5;
                }

                // First
                if (startNumber > 1) {
                    var paginationItem = document.createElement('div');
                    paginationItem.className = 'jexcel_page';
                    paginationItem.innerHTML = '<';
                    paginationItem.title = 1;
                    obj.pagination.children[1].appendChild(paginationItem);
                }

                // Get page links
                for (var i = startNumber; i <= finalNumber; i++) {
                    var paginationItem = document.createElement('div');
                    paginationItem.className = 'jexcel_page';
                    paginationItem.innerHTML = i;
                    obj.pagination.children[1].appendChild(paginationItem);

                    if (obj.pageNumber == (i-1)) {
                        paginationItem.classList.add('jexcel_page_selected');
                    }
                }

                // Last
                if (finalNumber < quantyOfPages) {
                    var paginationItem = document.createElement('div');
                    paginationItem.className = 'jexcel_page';
                    paginationItem.innerHTML = '>';
                    paginationItem.title = quantyOfPages;
                    obj.pagination.children[1].appendChild(paginationItem);
                }

                // Text
                var format = function(format) {
                    var args = Array.prototype.slice.call(arguments, 1);
                    return format.replace(/{(\d+)}/g, function(match, number) {
                      return typeof args[number] != 'undefined'
                        ? args[number]
                        : match
                      ;
                    });
                };

                obj.pagination.children[0].innerHTML = format(obj.options.text.showingPage, obj.pageNumber + 1, quantyOfPages)
            }
        }
    }

    /**
     * Download CSV table
     * 
     * @return null
     */
    obj.download = function(includeHeaders) {
        if (obj.options.allowExport == false) {
            console.error('Export not allowed');
        } else {
            // Data
            var data = '';
            if (includeHeaders == true || obj.options.includeHeadersOnDownload == true) {
                data += obj.getHeaders();
                data += "\r\n";
            }

            // Get data
            data += obj.copy(false, obj.options.csvDelimiter, true);

            // Download element
            var blob = new Blob(["\uFEFF"+data], {type: 'text/csv;charset=utf-8;'});

            // IE Compatibility
            if (window.navigator && window.navigator.msSaveOrOpenBlob) {
                window.navigator.msSaveOrOpenBlob(blob, options.csvFileName + '.csv');
            } else {
                // Download element
                var pom = document.createElement('a');
                var url = URL.createObjectURL(blob);
                pom.href = url;
                pom.setAttribute('download', obj.options.csvFileName + '.csv');
                document.body.appendChild(pom);
                pom.click();
                pom.parentNode.removeChild(pom);
            }
        }
    }

    /**
     * Initializes a new history record for undo/redo
     * 
     * @return null
     */
    obj.setHistory = function(changes) {
        if (obj.ignoreHistory != true) {
            // Increment and get the current history index
            var index = ++obj.historyIndex;

            // Slice the array to discard undone changes
            obj.history = (obj.history = obj.history.slice(0, index + 1));

            // Keep history
            obj.history[index] = changes;
        }
    }

    /**
     * Copy method
     * 
     * @param bool highlighted - Get only highlighted cells
     * @param delimiter - \t default to keep compatibility with excel
     * @return string value
     */
    obj.copy = function(highlighted, delimiter, returnData) {
        if (! delimiter) {
            delimiter = "\t";
        }

        // Controls
        var col = [];
        var colLabel = [];
        var row = [];
        var rowLabel = [];
        var x = obj.options.data[0].length
        var y = obj.options.data.length
        var tmp = '';

        // Reset container
        obj.style = [];

        // Go through the columns to get the data
        for (var j = 0; j < y; j++) {
            col = [];
            colLabel = [];

            for (var i = 0; i < x; i++) {
                // If cell is highlighted
                if (! highlighted || obj.records[j][i].classList.contains('highlight')) {
                    // Values
                    var value = obj.options.data[j][i];
                    if (value.match && (value.match(/,/g) || value.match(/\n/) || value.match(/\"/))) {
                        value = value.replace(new RegExp('"', 'g'), '""');
                        value = '"' + value + '"';
                    }
                    col.push(value);

                    // Labels
                    if (obj.options.columns[i].type == 'checkbox' || obj.options.columns[i].type == 'radio') {
                        var label = value;
                    } else {
                        var label = obj.records[j][i].innerHTML;
                        if (label.match && (label.match(/,/g) || label.match(/\n/) || label.match(/\"/))) {
                            // Scape double quotes
                            label = label.replace(new RegExp('"', 'g'), '""');
                            label = '"' + label + '"';
                        }
                    }
                    colLabel.push(label);

                    // Get style
                    tmp = obj.records[j][i].getAttribute('style');
                    obj.style.push(tmp ? tmp : '');
                }
            }

            if (col.length) {
                row.push(col.join(delimiter));
            }
            if (colLabel.length) {
                rowLabel.push(colLabel.join(delimiter));
            }
        }

        // Final string
        var str = row.join("\r\n");
        var strLabel = rowLabel.join("\r\n");

        // Create a hidden textarea to copy the values
        if (! returnData) {
            if (obj.options.copyCompatibility == true) {
                obj.textarea.value = strLabel;
            } else {
                obj.textarea.value = str;
            }
            obj.textarea.select();
            document.execCommand("copy");
        }

        // Keep data
        if (obj.options.copyCompatibility == true) {
            obj.data = strLabel;
        } else {
        obj.data = str;
        }
        // Keep non visible information
        obj.hashString = obj.hash(obj.data);

        return obj.data;
    }

    /**
     * jExcel paste method
     * 
     * @param integer row number
     * @return string value
     */
    obj.paste = function(x, y, data) {
        // Paste filter
        if (typeof(obj.options.onbeforepaste) == 'function') {
            var data = obj.options.onbeforepaste(el, data);
        }

        // Controls
        var hash = obj.hash(data);
        var style = (hash == obj.hashString) ? obj.style : null;

        // Depending on the behavior
        if (obj.options.copyCompatibility == true && hash == obj.hashString) {
            var data = obj.data;
        }

        // Split new line
        var data = obj.parseCSV(data, "\t");

        if (x != null && y != null && data) {
            // Records
            var i = 0;
            var j = 0;
            var records = [];
            var newStyle = {};
            var oldStyle = {};
            var styleIndex = 0;

            // Index
            var colIndex = parseInt(x);
            var rowIndex = parseInt(y);
            var row = null;

            // Go through the columns to get the data
            while (row = data[j]) {
                i = 0;
                colIndex = parseInt(x);

                while (row[i] != null) {
                    // Update and keep history
                    var record = obj.updateCell(colIndex, rowIndex, row[i]);
                    // Keep history
                    records.push(record);
                    // Update all formulas in the chain
                    obj.updateFormulaChain(colIndex, rowIndex, records);
                    // Style
                    if (style && style[styleIndex]) {
                        var columnName = jexcel.getColumnNameFromId([colIndex, rowIndex]);
                        newStyle[columnName] = style[styleIndex];
                        oldStyle[columnName] = obj.getStyle(columnName);
                        obj.records[rowIndex][colIndex].setAttribute('style', style[styleIndex]);
                        styleIndex++
                    }
                    i++;
                    if (row[i] != null) {
                        if (colIndex >= obj.headers.length - 1) {
                            obj.insertColumn();
                        }
                        colIndex = obj.right.get(colIndex, rowIndex);
                    }
                }

                j++;
                if (data[j]) {
                    if (rowIndex >= obj.rows.length-1) {
                        obj.insertRow();
                    }
                    rowIndex = obj.down.get(x, rowIndex);
                }
            }

            // Select the new cells
            obj.updateSelectionFromCoords(x, y, colIndex, rowIndex);

            // Update history
            obj.setHistory({
                action:'setValue',
                records:records,
                selection:obj.selectedCell,
                newStyle:newStyle,
                oldStyle:oldStyle,
            });

            // Update table
            obj.updateTable();

            // Paste event
            if (typeof(obj.options.onpaste) == 'function') {
                obj.options.onpaste(el, records);
            }

            // On after changes
            obj.onafterchanges(el, records);
        }
    }

    /**
     * Process row
     */
    obj.historyProcessRow = function(type, historyRecord) {
        var rowIndex = (! historyRecord.insertBefore) ? historyRecord.rowNumber + 1 : historyRecord.rowNumber;

        if (obj.options.search == true) {
            if (obj.results && obj.results.length != obj.rows.length) {
                obj.resetSearch();
            }
        }

        // Remove row
        if (type == 1) {
            var numOfRows = historyRecord.numOfRows;
            // Remove nodes
            for (var j = rowIndex; j < (numOfRows + rowIndex); j++) {
                obj.rows[j].parentNode.removeChild(obj.rows[j]);
            }
            // Remove references
            obj.records.splice(rowIndex, numOfRows);
            obj.options.data.splice(rowIndex, numOfRows);
            obj.rows.splice(rowIndex, numOfRows);

            obj.conditionalSelectionUpdate(1, rowIndex, (numOfRows + rowIndex) - 1);
        } else {
            // Insert data
            obj.records = jexcel.injectArray(obj.records, rowIndex, historyRecord.rowRecords);
            obj.options.data = jexcel.injectArray(obj.options.data, rowIndex, historyRecord.rowData);
            obj.rows = jexcel.injectArray(obj.rows, rowIndex, historyRecord.rowNode);
            // Insert nodes
            var index = 0
            for (var j = rowIndex; j < (historyRecord.numOfRows + rowIndex); j++) {
                obj.tbody.insertBefore(historyRecord.rowNode[index], obj.tbody.children[j]);
                index++;
            }
        }

        // Respect pagination
        if (obj.options.pagination > 0) {
            obj.page(obj.pageNumber);
        }

        obj.updateTableReferences();
    }

    /**
     * Process column
     */
    obj.historyProcessColumn = function(type, historyRecord) {
        var columnIndex = (! historyRecord.insertBefore) ? historyRecord.columnNumber + 1 : historyRecord.columnNumber;

        // Remove column
        if (type == 1) {
            var numOfColumns = historyRecord.numOfColumns;

            obj.options.columns.splice(columnIndex, numOfColumns);
            for (var i = columnIndex; i < (numOfColumns + columnIndex); i++) {
                obj.headers[i].parentNode.removeChild(obj.headers[i]);
                obj.colgroup[i].parentNode.removeChild(obj.colgroup[i]);
            }
            obj.headers.splice(columnIndex, numOfColumns);
            obj.colgroup.splice(columnIndex, numOfColumns);
            for (var j = 0; j < historyRecord.data.length; j++) {
                for (var i = columnIndex; i < (numOfColumns + columnIndex); i++) {
                    obj.records[j][i].parentNode.removeChild(obj.records[j][i]);
                }
                obj.records[j].splice(columnIndex, numOfColumns);
                obj.options.data[j].splice(columnIndex, numOfColumns);
            }

            obj.conditionalSelectionUpdate(0, columnIndex, (numOfColumns + columnIndex) - 1);
        } else {
            // Insert data
            obj.options.columns = jexcel.injectArray(obj.options.columns, columnIndex, historyRecord.columns);
            obj.headers = jexcel.injectArray(obj.headers, columnIndex, historyRecord.headers);
            obj.colgroup = jexcel.injectArray(obj.colgroup, columnIndex, historyRecord.colgroup);

            var index = 0
            for (var i = columnIndex; i < (historyRecord.numOfColumns + columnIndex); i++) {
                obj.headerContainer.insertBefore(historyRecord.headers[index], obj.headerContainer.children[i+1]);
                obj.colgroupContainer.insertBefore(historyRecord.colgroup[index], obj.colgroupContainer.children[i+1]);
                index++;
            }

            for (var j = 0; j < historyRecord.data.length; j++) {
                obj.options.data[j] = jexcel.injectArray(obj.options.data[j], columnIndex, historyRecord.data[j]);
                obj.records[j] = jexcel.injectArray(obj.records[j], columnIndex, historyRecord.records[j]);
                var index = 0
                for (var i = columnIndex; i < (historyRecord.numOfColumns + columnIndex); i++) {
                    obj.rows[j].insertBefore(historyRecord.records[j][index], obj.rows[j].children[i+1]);
                    index++;
                }
            }
        }

        // Adjust nested headers
        if (obj.options.nestedHeaders && obj.options.nestedHeaders.length > 0) {
            // Flexible way to handle nestedheaders
            if (obj.options.nestedHeaders[0] && obj.options.nestedHeaders[0][0]) {
                for (var j = 0; j < obj.options.nestedHeaders.length; j++) {
                    if (type == 1) {
                        var colspan = parseInt(obj.options.nestedHeaders[j][obj.options.nestedHeaders[j].length-1].colspan) - historyRecord.numOfColumns;
                    } else {
                        var colspan = parseInt(obj.options.nestedHeaders[j][obj.options.nestedHeaders[j].length-1].colspan) + historyRecord.numOfColumns;
                    }
                    obj.options.nestedHeaders[j][obj.options.nestedHeaders[j].length-1].colspan = colspan;
                    obj.thead.children[j].children[obj.thead.children[j].children.length-1].setAttribute('colspan', colspan);
                }
            } else {
                if (type == 1) {
                    var colspan = parseInt(obj.options.nestedHeaders[0].colspan) - historyRecord.numOfColumns;
                } else {
                    var colspan = parseInt(obj.options.nestedHeaders[0].colspan) + historyRecord.numOfColumns;
                }
                obj.options.nestedHeaders[0].colspan = colspan;
                obj.thead.children[0].children[obj.thead.children[0].children.length-1].setAttribute('colspan', colspan);
            }
        }

        obj.updateTableReferences();
    }

    /**
     * Undo last action
     */
    obj.undo = function() {
        // Ignore events and history
        var ignoreEvents = obj.ignoreEvents ? true : false;
        var ignoreHistory = obj.ignoreHistory ? true : false;

        obj.ignoreEvents = true;
        obj.ignoreHistory = true;

        // Records
        var records = [];

        // Update cells
        if (obj.historyIndex >= 0) {
            // History
            var historyRecord = obj.history[obj.historyIndex--];

            if (historyRecord.action == 'insertRow') {
                obj.historyProcessRow(1, historyRecord);
            } else if (historyRecord.action == 'deleteRow') {
                obj.historyProcessRow(0, historyRecord);
            } else if (historyRecord.action == 'insertColumn') {
                obj.historyProcessColumn(1, historyRecord);
            } else if (historyRecord.action == 'deleteColumn') {
                obj.historyProcessColumn(0, historyRecord);
            } else if (historyRecord.action == 'moveRow') {
                obj.moveRow(historyRecord.newValue, historyRecord.oldValue);
            } else if (historyRecord.action == 'moveColumn') {
                obj.moveColumn(historyRecord.newValue, historyRecord.oldValue);
            } else if (historyRecord.action == 'setMerge') {
                obj.removeMerge(historyRecord.column, historyRecord.data);
            } else if (historyRecord.action == 'setStyle') {
                obj.setStyle(historyRecord.oldValue, null, null, 1);
            } else if (historyRecord.action == 'setWidth') {
                obj.setWidth(historyRecord.column, historyRecord.oldValue);
            } else if (historyRecord.action == 'setHeight') {
                obj.setHeight(historyRecord.row, historyRecord.oldValue);
            } else if (historyRecord.action == 'setHeader') {
                obj.setHeader(historyRecord.column, historyRecord.oldValue);
            } else if (historyRecord.action == 'setComments') {
                obj.setComments(historyRecord.column, historyRecord.oldValue[0], historyRecord.oldValue[1]);
            } else if (historyRecord.action == 'orderBy') {
                var rows = [];
                for (var j = 0; j < historyRecord.rows.length; j++) {
                    rows[historyRecord.rows[j]] = j;
                }
                obj.updateOrderArrow(historyRecord.column, historyRecord.order ? 0 : 1);
                obj.updateOrder(rows);
            } else if (historyRecord.action == 'setValue') {
                // Redo for changes in cells
                for (var i = 0; i < historyRecord.records.length; i++) {
                    obj.updateCell(historyRecord.records[i].col, historyRecord.records[i].row, historyRecord.records[i].oldValue);
                    obj.updateFormulaChain(historyRecord.records[i].col, historyRecord.records[i].row, records);
                    if (historyRecord.oldStyle) {
                        obj.resetStyle(historyRecord.oldStyle, true);
                    }
                }
                // Update selection
                if (! historyRecord.selection) {
                    historyRecord.selection = [historyRecord.records[0].col, historyRecord.records[0].row];
                }
                obj.updateSelectionFromCoords(historyRecord.selection[0], historyRecord.selection[1], historyRecord.selection[2], historyRecord.selection[3]);
                // Update table
                obj.updateTable();
            }
        }
        obj.ignoreEvents = ignoreEvents;
        obj.ignoreHistory = ignoreHistory;

        if (typeof(obj.options.onundo) == 'function') {
            obj.options.onundo(el, historyRecord);
        }
    }

    /**
     * Redo previously undone action
     */
    obj.redo = function() {
        // Ignore events and history
        var ignoreEvents = obj.ignoreEvents ? true : false;
        var ignoreHistory = obj.ignoreHistory ? true : false;

        obj.ignoreEvents = true;
        obj.ignoreHistory = true;

        // Records
        var records = [];

        // Update cells
        if (obj.historyIndex < obj.history.length - 1) {
            // History
            var historyRecord = obj.history[++obj.historyIndex];

            if (historyRecord.action == 'insertRow') {
                obj.historyProcessRow(0, historyRecord);
            } else if (historyRecord.action == 'deleteRow') {
                obj.historyProcessRow(1, historyRecord);
            } else if (historyRecord.action == 'insertColumn') {
                obj.historyProcessColumn(0, historyRecord);
            } else if (historyRecord.action == 'deleteColumn') {
                obj.historyProcessColumn(1, historyRecord);
            } else if (historyRecord.action == 'moveRow') {
                obj.moveRow(historyRecord.oldValue, historyRecord.newValue);
            } else if (historyRecord.action == 'moveColumn') {
                obj.moveColumn(historyRecord.oldValue, historyRecord.newValue);
            } else if (historyRecord.action == 'setMerge') {
                obj.setMerge(historyRecord.column, historyRecord.colspan, historyRecord.rowspan, 1);
            } else if (historyRecord.action == 'setStyle') {
                obj.setStyle(historyRecord.newValue, null, null, 1);
            } else if (historyRecord.action == 'setWidth') {
                obj.setWidth(historyRecord.column, historyRecord.newValue);
            } else if (historyRecord.action == 'setHeight') {
                obj.setHeight(historyRecord.row, historyRecord.newValue);
            } else if (historyRecord.action == 'setHeader') {
                obj.setHeader(historyRecord.column, historyRecord.newValue);
            } else if (historyRecord.action == 'setComments') {
                obj.setComments(historyRecord.column, historyRecord.newValue[0], historyRecord.newValue[1]);
            } else if (historyRecord.action == 'orderBy') {
                obj.updateOrderArrow(historyRecord.column, historyRecord.order);
                obj.updateOrder(historyRecord.rows);
            } else if (historyRecord.action == 'setValue') {
                // Redo for changes in cells
                for (var i = 0; i < historyRecord.records.length; i++) {
                    obj.updateCell(historyRecord.records[i].col, historyRecord.records[i].row, historyRecord.records[i].newValue);
                    obj.updateFormulaChain(historyRecord.records[i].col, historyRecord.records[i].row, records);
                    if (historyRecord.newStyle) {
                        obj.resetStyle(historyRecord.newStyle, true);
                    }
                }

                // Update selection
                if (! historyRecord.selection) {
                    historyRecord.selection = [historyRecord.records[0].col, historyRecord.records[0].row];
                }
                obj.updateSelectionFromCoords(historyRecord.selection[0], historyRecord.selection[1], historyRecord.selection[2], historyRecord.selection[3]);
                // Update table
                obj.updateTable();
            }
        }
        obj.ignoreEvents = ignoreEvents;
        obj.ignoreHistory = ignoreHistory;

        if (typeof(obj.options.onredo) == 'function') {
            obj.options.onredo(el, historyRecord);
        }
    }

    /**
     * Get dropdown value from key
     */
    obj.getDropDownValue = function(column, key) {
        var value = [];

        if (obj.options.columns[column] && obj.options.columns[column].source) {
            // Create array from source
            var combo = [];
            var source = obj.options.columns[column].source;

            for (var i = 0; i < source.length; i++) {
                if (typeof(source[i]) == 'object') {
                    combo[source[i].id] = source[i].name;
                } else {
                    combo[source[i]] = source[i];
                }
            }

            // Garante single multiple compatibily
            var keys = ('' + key).split(';')

            for (var i = 0; i < keys.length; i++) {
                if (combo[keys[i]]) {
                    value.push(combo[keys[i]]);
                }
            }
        } else {
            console.error('Invalid column');
        }

        return (value.length > 0) ? value.join('; ') : '';
    }

    /**
     * From starckoverflow contributions
     */
    obj.parseCSV = function(str, delimiter) {
        // Remove last line break
        str = str.replace(/\r?\n$|\r$|\n$/g, "");
        // Last caracter is the delimiter
        if (str.charCodeAt(str.length-1) == 9) {
            str += "\0";
        }
        // user-supplied delimeter or default comma
        delimiter = (delimiter || ",");

        var arr = [];
        var quote = false;  // true means we're inside a quoted field
        // iterate over each character, keep track of current row and column (of the returned array)
        for (var row = 0, col = 0, c = 0; c < str.length; c++) {
            var cc = str[c], nc = str[c+1];
            arr[row] = arr[row] || [];
            arr[row][col] = arr[row][col] || '';

            // If the current character is a quotation mark, and we're inside a quoted field, and the next character is also a quotation mark, add a quotation mark to the current column and skip the next character
            if (cc == '"' && quote && nc == '"') { arr[row][col] += cc; ++c; continue; }  

            // If it's just one quotation mark, begin/end quoted field
            if (cc == '"') { quote = !quote; continue; }

            // If it's a comma and we're not in a quoted field, move on to the next column
            if (cc == delimiter && !quote) { ++col; continue; }

            // If it's a newline (CRLF) and we're not in a quoted field, skip the next character and move on to the next row and move to column 0 of that new row
            if (cc == '\r' && nc == '\n' && !quote) { ++row; col = 0; ++c; continue; }

            // If it's a newline (LF or CR) and we're not in a quoted field, move on to the next row and move to column 0 of that new row
            if (cc == '\n' && !quote) { ++row; col = 0; continue; }
            if (cc == '\r' && !quote) { ++row; col = 0; continue; }

            // Otherwise, append the current character to the current column
            arr[row][col] += cc;
        }
        return arr;
    }

    obj.hash = function(str) {
        var hash = 0, i, chr;

        if (str.length === 0) {
            return hash;
        } else {
            for (i = 0; i < str.length; i++) {
              chr = str.charCodeAt(i);
              hash = ((hash << 5) - hash) + chr;
              hash |= 0;
            }
        }
        return hash;
    }

    obj.onafterchanges = function(el, records) {
        if (! obj.ignoreEvents) {
            // On after changes
            if (typeof(obj.options.onafterchanges) == 'function') {
                obj.options.onafterchanges(el, records);
            }
        }
    }

    obj.destroy = function() {
        jexcel.destroy(el);
    }

    /**
     * Initialization method
     */
    obj.init = function() {
        jexcel.current = obj;

        // Build handlers
        if (typeof(jexcel.build) == 'function') {
            jexcel.build();
            jexcel.build = null;
        }

        // Load the table data based on an CSV file
        if (obj.options.csv) {
            // Loading
            if (obj.options.loadingSpin == true) {
                jSuites.loading.show();
            }

            // Load CSV file
            jSuites.ajax({
                url: obj.options.csv,
                method: 'GET',
                dataType: 'text',
                success: function(result) {
                    // Convert data
                    var newData = obj.parseCSV(result, obj.options.csvDelimiter)

                    // Headers
                    if (obj.options.csvHeaders == true && newData.length > 0) {
                        var headers = newData.shift();
                        for(var i = 0; i < headers.length; i++) {
                            if (! obj.options.columns[i]) {
                                obj.options.columns[i] = { type:'text', align:obj.options.defaultColAlign, width:obj.options.defaultColWidth };
                            }
                            // Precedence over pre-configurated titles
                            if (typeof obj.options.columns[i].title === 'undefined') {
                              obj.options.columns[i].title = headers[i];
                            }
                        }
                    }
                    // Data
                    obj.options.data = newData;
                    // Prepare table
                    obj.prepareTable();
                    // Hide spin
                    if (obj.options.loadingSpin == true) {
                        jSuites.loading.hide();
                    }
                }
            });
        } else if (obj.options.url) {
            // Loading
            if (obj.options.loadingSpin == true) {
                jSuites.loading.show();
            }

            jSuites.ajax({
                url: obj.options.url,
                method: 'GET',
                dataType: 'json',
                success: function(result) {
                    // Data
                    obj.options.data = (result.data) ? result.data : result;
                    // Prepare table
                    obj.prepareTable();
                    // Hide spin
                    if (obj.options.loadingSpin == true) {
                        jSuites.loading.hide();
                    }
                }
            });
        } else {
            // Prepare table
            obj.prepareTable();
        }
    }

    // Context menu
    if (options && options.contextMenu != null) {
        obj.options.contextMenu = options.contextMenu;
    } else {
        obj.options.contextMenu = function(el, x, y, e) {
            var items = [];

            if (y == null) {
                // Insert a new column
                if (obj.options.allowInsertColumn == true) {
                    items.push({
                        title:obj.options.text.insertANewColumnBefore,
                        onclick:function() {
                            obj.insertColumn(1, parseInt(x), 1);
                        }
                    });
                }

                if (obj.options.allowInsertColumn == true) {
                    items.push({
                        title:obj.options.text.insertANewColumnAfter,
                        onclick:function() {
                            obj.insertColumn(1, parseInt(x), 0);
                        }
                    });
                }

                // Delete a column
                if (obj.options.allowDeleteColumn == true) {
                    items.push({
                        title:obj.options.text.deleteSelectedColumns,
                        onclick:function() {
                            obj.deleteColumn(obj.getSelectedColumns().length ? undefined : parseInt(x));
                        }
                    });
                }

                // Rename column
                if (obj.options.allowRenameColumn == true) {
                    items.push({
                        title:obj.options.text.renameThisColumn,
                        onclick:function() {
                            obj.setHeader(x);
                        }
                    });
                }

                // Sorting
                if (obj.options.columnSorting == true) {
                    // Line
                    items.push({ type:'line' });

                    items.push({
                        title:obj.options.text.orderAscending,
                        onclick:function() {
                            obj.orderBy(x, 0);
                        }
                    });
                    items.push({
                        title:obj.options.text.orderDescending,
                        onclick:function() {
                            obj.orderBy(x, 1);
                        }
                    });
                }
            } else {
                // Insert new row
                if (obj.options.allowInsertRow == true) {
                    items.push({
                        title:obj.options.text.insertANewRowBefore,
                        onclick:function() {
                            obj.insertRow(1, parseInt(y), 1);
                        }
                    });

                    items.push({
                        title:obj.options.text.insertANewRowAfter,
                        onclick:function() {
                            obj.insertRow(1, parseInt(y));
                        }
                    });
                }

                if (obj.options.allowDeleteRow == true) {
                    items.push({
                        title:obj.options.text.deleteSelectedRows,
                        onclick:function() {
                            obj.deleteRow(obj.getSelectedRows().length ? undefined : parseInt(y));
                        }
                    });
                }

                if (x) {
                    if (obj.options.allowComments == true) {
                        items.push({ type:'line' });

                        var title = obj.records[y][x].getAttribute('title') || '';

                        items.push({
                            title: title ? obj.options.text.editComments : obj.options.text.addComments,
                            onclick:function() {
                                var comment = prompt(obj.options.text.comments, title);
                                if (comment) {
                                    obj.setComments([ x, y ], comment);
                                }
                            }
                        });

                        if (title) {
                            items.push({
                                title:obj.options.text.clearComments,
                                onclick:function() {
                                    obj.setComments([ x, y ], '');
                                }
                            });
                        }
                    }
                }
            }

            // Line
            items.push({ type:'line' });

            // Copy
            items.push({
                title:obj.options.text.copy,
                shortcut:'Ctrl + C',
                onclick:function() {
                    obj.copy(true);
                }
            });

            // Paste
            if (navigator && navigator.clipboard) {
                items.push({
                    title:obj.options.text.paste,
                    shortcut:'Ctrl + V',
                    onclick:function() {
                        if (obj.selectedCell) {
                            navigator.clipboard.readText().then(function(text) {
                                if (text) {
                                    jexcel.current.paste(obj.selectedCell[0], obj.selectedCell[1], text);
                                }
                            });
                        }
                    }
                });
            }

            // Save
            if (obj.options.allowExport) {
                items.push({
                    title: obj.options.text.saveAs,
                    shortcut: 'Ctrl + S',
                    onclick: function () {
                        obj.download();
                    }
                });
            }

            // About
            if (obj.options.about) {
                items.push({
                    title:obj.options.text.about,
                    onclick:function() {
                        alert(obj.options.about);
                    }
                });
            }

            return items;
        }
    }

    obj.scrollControls = function(e) {
        if (obj.options.lazyLoading == true) {
            if (jexcel.timeControlLoading == null) {
                jexcel.timeControlLoading = setTimeout(function() {
                    if (obj.content.scrollTop + obj.content.clientHeight >= obj.content.scrollHeight) {
                        if (obj.loadDown()) {
                            if (obj.content.scrollTop + obj.content.clientHeight > obj.content.scrollHeight - 10) {
                                obj.content.scrollTop = obj.content.scrollTop - obj.content.clientHeight;
                            }
                            obj.updateCornerPosition();
                        }
                    } else if (obj.content.scrollTop <= obj.content.clientHeight) {
                        if (obj.loadUp()) {
                            if (obj.content.scrollTop < 10) {
                                obj.content.scrollTop = obj.content.scrollTop + obj.content.clientHeight;
                            }
                            obj.updateCornerPosition();
                        }
                    }

                    jexcel.timeControlLoading = null;
                }, 100);
            }
        }

        // Close editor
        if (obj.options.lazyLoading == true || obj.options.tableOverflow == true) {
            if (obj.edition && e.target.className.substr(0,9) != 'jdropdown') {
                obj.closeEditor(obj.edition[0], true);
            }
        }
    }

    el.addEventListener("DOMMouseScroll", obj.scrollControls);
    el.addEventListener("mousewheel", obj.scrollControls);

    el.jexcel = obj;

    obj.init();

    return obj;
});

jexcel.current = null;
jexcel.timeControl = null;
jexcel.timeControlLoading = null;

jexcel.destroy = function(element, destroyEventHandlers) {
    if (element.jexcel) {
        element.removeEventListener("DOMMouseScroll", element.jexcel.scrollControls);
        element.removeEventListener("mousewheel", element.jexcel.scrollControls);
        element.jexcel = null;
        element.innerHTML = '';

        if (destroyEventHandlers) {
            document.removeEventListener("keydown", jexcel.keyDownControls);
            document.removeEventListener("mouseup", jexcel.mouseUpControls);
            document.removeEventListener("mousedown", jexcel.mouseDownControls);
            document.removeEventListener("mousemove", jexcel.mouseMoveControls);
            document.removeEventListener("mouseover", jexcel.mouseOverControls);
            document.removeEventListener("dblclick", jexcel.doubleClickControls);
            document.removeEventListener("paste", jexcel.pasteControls);
            document.removeEventListener("contextmenu", jexcel.contextMenuControls);
            document.removeEventListener("touchstart", jexcel.touchStartControls);
            document.removeEventListener("touchend", jexcel.touchEndControls);
            document.removeEventListener("touchcancel", jexcel.touchEndControls);
            jexcel = null;
        }
    }
}

jexcel.build = function() {
    document.addEventListener("keydown", jexcel.keyDownControls);
    document.addEventListener("mouseup", jexcel.mouseUpControls);
    document.addEventListener("mousedown", jexcel.mouseDownControls);
    document.addEventListener("mousemove", jexcel.mouseMoveControls);
    document.addEventListener("mouseover", jexcel.mouseOverControls);
    document.addEventListener("dblclick", jexcel.doubleClickControls);
    document.addEventListener("paste", jexcel.pasteControls);
    document.addEventListener("contextmenu", jexcel.contextMenuControls);
    document.addEventListener("touchstart", jexcel.touchStartControls);
    document.addEventListener("touchend", jexcel.touchEndControls);
    document.addEventListener("touchcancel", jexcel.touchEndControls);
    document.addEventListener("touchmove", jexcel.touchEndControls);
}

/**
 * Events
 */
jexcel.keyDownControls = function(e) {
    if (jexcel.current) {
        if (jexcel.current.edition) {
            if (e.which == 27) {
                // Escape
                if (jexcel.current.edition) {
                    // Exit without saving
                    jexcel.current.closeEditor(jexcel.current.edition[0], false);
                }
                e.preventDefault();
            } else if (e.which == 13) {
                // Enter
                if (jexcel.current.options.columns[jexcel.current.edition[2]].type == 'calendar') {
                    jexcel.current.editor[0].children[0].calendar.close(1);
                } else if (jexcel.current.options.columns[jexcel.current.edition[2]].type == 'dropdown' ||
                           jexcel.current.options.columns[jexcel.current.edition[2]].type == 'autocomplete') {
                    // Do nothing
                } else {
                    // Alt enter -> do not close editor
                    if ((jexcel.current.options.wordWrap == true ||
                         jexcel.current.options.columns[jexcel.current.edition[2]].wordWrap == true ||
                         jexcel.current.options.data[jexcel.current.edition[3]][jexcel.current.edition[2]].length > 200) && e.altKey) {
                        // Add new line to the editor
                        var editorTextarea = jexcel.current.edition[0].children[0];
                        var editorValue = jexcel.current.edition[0].children[0].value;
                        var editorIndexOf = editorTextarea.selectionStart;
                        editorValue = editorValue.slice(0, editorIndexOf) + "\n" + editorValue.slice(editorIndexOf);
                        editorTextarea.value = editorValue;
                        editorTextarea.focus();
                        editorTextarea.selectionStart = editorIndexOf + 1;
                        editorTextarea.selectionEnd = editorIndexOf + 1;
                    } else {
                        jexcel.current.edition[0].children[0].blur();
                    }
                }
            } else if (e.which == 9) {
                // Tab
                if (jexcel.current.options.columns[jexcel.current.edition[2]].type == 'calendar') {
                    jexcel.current.edition[0].children[0].calendar.close(1);
                } else {
                    jexcel.current.edition[0].children[0].blur();
                }
            }
        }

        if (! jexcel.current.edition && jexcel.current.selectedCell) {
            // Which key
            if (e.which == 37) {
                jexcel.current.left(e.shiftKey, e.ctrlKey);
                e.preventDefault();
            } else if (e.which == 39) {
                jexcel.current.right(e.shiftKey, e.ctrlKey);
                e.preventDefault();
            } else if (e.which == 38) {
                jexcel.current.up(e.shiftKey, e.ctrlKey);
                e.preventDefault();
            } else if (e.which == 40) {
                jexcel.current.down(e.shiftKey, e.ctrlKey);
                e.preventDefault();
            } else if (e.which == 36) {
                jexcel.current.first(e.shiftKey, e.ctrlKey);
                e.preventDefault();
            } else if (e.which == 35) {
                jexcel.current.last(e.shiftKey, e.ctrlKey);
                e.preventDefault();
            } else if (e.which == 32) {
                if (jexcel.current.options.editable == true) {
                    jexcel.current.setCheckRadioValue();
                }
                e.preventDefault();
            } else if (e.which == 46) {
                // Delete
                if (jexcel.current.options.editable == true) {
                    if (jexcel.current.selectedRow) {
                        if (jexcel.current.options.allowDeleteRow == true) {
                            if (confirm(jexcel.current.options.text.areYouSureToDeleteTheSelectedRows)) {
                                jexcel.current.deleteRow();
                            }
                        }
                    } else if (jexcel.current.selectedHeader) {
                        if (jexcel.current.options.allowDeleteColumn == true) {
                            if (confirm(jexcel.current.options.text.areYouSureToDeleteTheSelectedColumns)) {
                                jexcel.current.deleteColumn();
                            }
                        }
                    } else {
                        // Change value
                        jexcel.current.setValue(jexcel.current.highlighted, '');
                    }
                }
            } else if (e.which == 13) {
                // Move cursor
                if (e.shiftKey) {
                    jexcel.current.up();
                } else {
                    if (jexcel.current.options.allowInsertRow == true) {
                        if (jexcel.current.options.allowManualInsertRow == true) {
                            if (jexcel.current.selectedCell[1] == jexcel.current.options.data.length - 1) {
                                // New record in case selectedCell in the last row
                                jexcel.current.insertRow();
                            }
                        }
                    }

                    jexcel.current.down();
                }
                e.preventDefault();
            } else if (e.which == 9) {
                // Tab
                if (e.shiftKey) {
                    jexcel.current.left();
                } else {
                    if (jexcel.current.options.allowInsertColumn == true) {
                        if (jexcel.current.options.allowManualInsertColumn == true) {
                            if (jexcel.current.selectedCell[0] == jexcel.current.options.data[0].length - 1) {
                                // New record in case selectedCell in the last column
                                jexcel.current.insertColumn();
                            }
                        }
                    }

                    jexcel.current.right();
                }
                e.preventDefault();
            } else {
                if ((e.ctrlKey || e.metaKey) && ! e.shiftKey) {
                    if (e.which == 65) {
                        // Ctrl + A
                        jexcel.current.selectAll();
                        e.preventDefault();
                    } else if (e.which == 83) {
                        // Ctrl + S
                        jexcel.current.download();
                        e.preventDefault();
                    } else if (e.which == 89) {
                        // Ctrl + Y
                        jexcel.current.redo();
                        e.preventDefault();
                    } else if (e.which == 90) {
                        // Ctrl + Z
                        jexcel.current.undo();
                        e.preventDefault();
                    } else if (e.which == 67) {
                        // Ctrl + C
                        jexcel.current.copy(true);
                        e.preventDefault();
                    } else if (e.which == 67) {
                        // Ctrl + C
                        jexcel.current.copy(true);
                        e.preventDefault();
                    } else if (e.which == 88) {
                        // Ctrl + X
                        if (jexcel.current.options.editable == true) {
                            jexcel.cutControls();
                        } else {
                            jexcel.copyControls();
                        }
                        e.preventDefault();
                    } else if (e.which == 86) {
                        // Ctrl + V
                        jexcel.pasteControls();
                    }
                } else {
                    if (jexcel.current.selectedCell) {
                        if (jexcel.current.options.editable == true) {
                            var rowId = jexcel.current.selectedCell[1];
                            var columnId = jexcel.current.selectedCell[0];

                            // If is not readonly
                            if (jexcel.current.options.columns[columnId].type != 'readonly') {
                                // Characters able to start a edition
                                if (e.keyCode == 32) {
                                    // Space
                                    if (jexcel.current.options.columns[columnId].type == 'checkbox' ||
                                        jexcel.current.options.columns[columnId].type == 'radio') {
                                        e.preventDefault();
                                    } else {
                                        // Start edition
                                        jexcel.current.openEditor(jexcel.current.records[rowId][columnId], true);
                                    }
                                } else if (e.keyCode == 113) {
                                    // Start edition with current content F2
                                    jexcel.current.openEditor(jexcel.current.records[rowId][columnId], false);
                                } else if ((e.keyCode == 8) ||
                                           (e.keyCode >= 48 && e.keyCode <= 57) ||
                                           (e.keyCode >= 96 && e.keyCode <= 111) ||
                                           (e.keyCode == 187) ||
                                           (e.keyCode == 189) ||
                                           ((String.fromCharCode(e.keyCode) == e.key || String.fromCharCode(e.keyCode).toLowerCase() == e.key.toLowerCase()) && jexcel.validLetter(String.fromCharCode(e.keyCode)))) {
                                    // Start edition
                                    jexcel.current.openEditor(jexcel.current.records[rowId][columnId], true);
                                    // Prevent entries in the calendar
                                    if (jexcel.current.options.columns[columnId].type == 'calendar') {
                                        e.preventDefault();
                                    }
                                }
                            }
                        }
                    }
                }
            }
        } else {
            if (e.target.classList.contains('jexcel_search')) {
                if (jexcel.timeControl) {
                    clearTimeout(jexcel.timeControl);
                }

                jexcel.timeControl = setTimeout(function() {
                    jexcel.current.search(e.target.value);
                }, 200);
            }
        }
    }
}

jexcel.isMouseAction = false;

jexcel.mouseDownControls = function(e) {
    e = e || window.event;
    if (e.buttons) {
        var mouseButton = e.buttons;
    } else if (e.button) {
        var mouseButton = e.button;
    } else {
        var mouseButton = e.which;
    }

    // Get elements
    var jexcelTable = jexcel.getElement(e.target);

    if (jexcelTable[0]) {
        if (jexcel.current != jexcelTable[0].jexcel) {
            if (jexcel.current) {
                jexcel.current.resetSelection();
            }
            jexcel.current = jexcelTable[0].jexcel;
        }
    } else {
        if (jexcel.current) {
            jexcel.current.resetSelection(true);
            jexcel.current = null;
        }
    }

    if (jexcel.current && mouseButton == 1) {
        if (e.target.classList.contains('jexcel_selectall')) {
            if (jexcel.current) {
                jexcel.current.selectAll();
            }
        } else if (e.target.classList.contains('jexcel_corner')) {
            if (jexcel.current.options.editable == true) {
                jexcel.current.selectedCorner = true;
            }
        } else {
            // Header found
            if (jexcelTable[1] == 1) {
                var columnId = e.target.getAttribute('data-x');
                if (columnId) {
                    // Update cursor
                    var info = e.target.getBoundingClientRect();
                    if (jexcel.current.options.columnResize == true && info.width - e.offsetX < 6) {
                        // Resize helper
                        jexcel.current.resizing = {
                            mousePosition: e.pageX,
                            column: columnId,
                            width: info.width,
                        };

                        // Border indication
                        jexcel.current.headers[columnId].classList.add('resizing');
                        for (var j = 0; j < jexcel.current.records.length; j++) {
                            if (jexcel.current.records[j][columnId]) {
                                jexcel.current.records[j][columnId].classList.add('resizing');
                            }
                        }
                    } else if (jexcel.current.options.columnDrag == true && info.height - e.offsetY < 6) {
                        if (jexcel.current.isColMerged(columnId).length) {
                            console.error('JEXCEL: This column is part of a merged cell.');
                        } else {
                            // Reset selection
                            jexcel.current.resetSelection();
                            // Drag helper
                            jexcel.current.dragging = {
                                element: e.target,
                                column:columnId,
                                destination:columnId,
                            };
                            // Border indication
                            jexcel.current.headers[columnId].classList.add('dragging');
                            for (var j = 0; j < jexcel.current.records.length; j++) {
                                if (jexcel.current.records[j][columnId]) {
                                    jexcel.current.records[j][columnId].classList.add('dragging');
                                }
                            }
                        }
                    } else {
                        if (jexcel.current.selectedHeader && (e.shiftKey || e.ctrlKey)) {
                            var o = jexcel.current.selectedHeader;
                            var d = columnId;
                        } else {
                            // Press to rename
                            if (jexcel.current.selectedHeader == columnId && jexcel.current.options.allowRenameColumn == true) {
                                jexcel.timeControl = setTimeout(function() {
                                    jexcel.current.setHeader(columnId);
                                }, 800);
                            }

                            // Keep track of which header was selected first
                            jexcel.current.selectedHeader = columnId;

                            // Update selection single column
                            var o = columnId;
                            var d = columnId;
                        }

                        // Update selection
                        jexcel.current.updateSelectionFromCoords(o, 0, d, jexcel.current.options.data.length - 1);
                    }
                } else {
                    if (e.target.parentNode.classList.contains('jexcel_nested')) {
                        if (e.target.getAttribute('data-column')) {
                            var column = e.target.getAttribute('data-column').split(',');
                            var c1 = parseInt(column[0]);
                            var c2 = parseInt(column[column.length-1]);
                        } else {
                            var c1 = 0;
                            var c2 = jexcel.current.options.columns.length - 1;
                        }
                        jexcel.current.updateSelectionFromCoords(c1, 0, c2, jexcel.current.options.data.length - 1);
                    }
                }
            } else {
                jexcel.current.selectedHeader = false;
            }

            // Body found
            if (jexcelTable[1] == 2) {
                var rowId = e.target.getAttribute('data-y');

                if (e.target.classList.contains('jexcel_row')) {
                    var info = e.target.getBoundingClientRect();
                    if (jexcel.current.options.rowResize == true && info.height - e.offsetY < 6) {
                        // Resize helper
                        jexcel.current.resizing = {
                            element: e.target.parentNode,
                            mousePosition: e.pageY,
                            row: rowId,
                            height: info.height,
                        };
                        // Border indication
                        e.target.parentNode.classList.add('resizing');
                    } else if (jexcel.current.options.rowDrag == true && info.width - e.offsetX < 6) {
                        if (jexcel.current.isRowMerged(rowId).length) {
                            console.error('JEXCEL: This row is part of a merged cell');
                        } else if (jexcel.current.options.search == true && jexcel.current.results) {
                            console.error('JEXCEL: Please clear your search before perform this action');
                        } else {
                            // Reset selection
                            jexcel.current.resetSelection();
                            // Drag helper
                            jexcel.current.dragging = {
                                element: e.target.parentNode,
                                row:rowId,
                                destination:rowId,
                            };
                            // Border indication
                            e.target.parentNode.classList.add('dragging');
                        }
                    } else {
                        if (jexcel.current.selectedRow && (e.shiftKey || e.ctrlKey)) {
                            var o = jexcel.current.selectedRow;
                            var d = rowId;
                        } else {
                            // Keep track of which header was selected first
                            jexcel.current.selectedRow = rowId;

                            // Update selection single column
                            var o = rowId;
                            var d = rowId;
                        }

                        // Update selection
                        jexcel.current.updateSelectionFromCoords(0, o, jexcel.current.options.data[0].length - 1, d);
                    }
                } else {
                    // Jclose
                    if (e.target.classList.contains('jclose') && e.target.clientWidth - e.offsetX < 50 && e.offsetY < 50) {
                        jexcel.current.closeEditor(jexcel.current.edition[0], true);
                    } else {
                        var getCellCoords = function(element) {
                            var x = element.getAttribute('data-x');
                            var y = element.getAttribute('data-y');
                            if (x && y) {
                                return [x, y];
                            } else {
                                if (element.parentNode) {
                                    return getCellCoords(element.parentNode);
                                }
                            }
                        };

                        var position = getCellCoords(e.target);
                        if (position) {
                            var columnId = position[0];
                            var rowId = position[1];
                            // Close edition
                            if (jexcel.current.edition) {
                                if (jexcel.current.edition[2] != columnId || jexcel.current.edition[3] != rowId) {
                                    jexcel.current.closeEditor(jexcel.current.edition[0], true);
                                }
                            }

                            if (! jexcel.current.edition) {
                                // Update cell selection
                                if (e.shiftKey) {
                                    jexcel.current.updateSelectionFromCoords(jexcel.current.selectedCell[0], jexcel.current.selectedCell[1], columnId, rowId);
                                } else {
                                    jexcel.current.updateSelectionFromCoords(columnId, rowId);
                                }
                            }

                            // No full row selected
                            jexcel.current.selectedHeader = null;
                            jexcel.current.selectedRow = null;
                        }
                    }
                }
            } else {
                jexcel.current.selectedRow = false;
            }

            // Pagination
            if (e.target.classList.contains('jexcel_page')) {
                if (e.target.innerText == '<') {
                    jexcel.current.page(0);
                } else if (e.target.innerText == '>') {
                    jexcel.current.page(e.target.getAttribute('title') - 1);
                } else {
                    jexcel.current.page(e.target.innerText - 1);
                }
            }
        }

        if (jexcel.current.edition) {
            jexcel.isMouseAction = false;
        } else {
            jexcel.isMouseAction = true;
        }
    } else {
        jexcel.isMouseAction = false;
    }
}

jexcel.mouseUpControls = function(e) {
    if (jexcel.current) {
        // Update cell size
        if (jexcel.current.resizing) {
            // Columns to be updated
            if (jexcel.current.resizing.column) {
                // Remove Class
                jexcel.current.headers[jexcel.current.resizing.column].classList.remove('resizing');
                var newWidth = jexcel.current.colgroup[jexcel.current.resizing.column].getAttribute('width');
                jexcel.current.setWidth(jexcel.current.resizing.column, newWidth, jexcel.current.resizing.width);
                // Remove border
                jexcel.current.headers[jexcel.current.resizing.column].classList.remove('resizing');
                for (var j = 0; j < jexcel.current.records.length; j++) {
                    if (jexcel.current.records[j][jexcel.current.resizing.column]){
                        jexcel.current.records[j][jexcel.current.resizing.column].classList.remove('resizing');
                    }
                }
            } else {
                // Remove Class
                jexcel.current.rows[jexcel.current.resizing.row].children[0].classList.remove('resizing');
                var newHeight = jexcel.current.rows[jexcel.current.resizing.row].getAttribute('height');
                jexcel.current.setHeight(jexcel.current.resizing.row, newHeight, jexcel.current.resizing.height);
                // Remove border
                jexcel.current.resizing.element.classList.remove('resizing');
            }
            // Reset resizing helper
            jexcel.current.resizing = null;
        } else if (jexcel.current.dragging) {
            // Reset dragging helper
            if (jexcel.current.dragging) {
                if (jexcel.current.dragging.column) {
                    // Target
                    var columnId = e.target.getAttribute('data-x');
                    // Remove move style
                    jexcel.current.headers[jexcel.current.dragging.column].classList.remove('dragging');
                    for (var j = 0; j < jexcel.current.rows.length; j++) {
                        if (jexcel.current.records[j][jexcel.current.dragging.column]) {
                            jexcel.current.records[j][jexcel.current.dragging.column].classList.remove('dragging');
                        }
                    }
                    for (var i = 0; i < jexcel.current.headers.length; i++) {
                        jexcel.current.headers[i].classList.remove('dragging-left');
                        jexcel.current.headers[i].classList.remove('dragging-right');
                    }
                    // Update position
                    if (columnId) {
                        if (jexcel.current.dragging.column != jexcel.current.dragging.destination) {
                            jexcel.current.moveColumn(jexcel.current.dragging.column, jexcel.current.dragging.destination);
                        }
                    }
                } else {
                    var position = Array.prototype.indexOf.call(jexcel.current.dragging.element.parentNode.children, jexcel.current.dragging.element);
                    if (jexcel.current.dragging.row != position) {
                        jexcel.current.moveRow(jexcel.current.dragging.row, position, true);
                    }
                    jexcel.current.dragging.element.classList.remove('dragging');
                }
                jexcel.current.dragging = null;
            }
        } else {
            // Close any corner selection
            if (jexcel.current.selectedCorner) {
                jexcel.current.selectedCorner = false;

                // Data to be copied
                if (jexcel.current.selection.length > 0) {
                    // Copy data
                    jexcel.current.copyData(jexcel.current.selection[0], jexcel.current.selection[jexcel.current.selection.length - 1]);

                    // Remove selection
                    jexcel.current.removeCopySelection();
                }
            }
        }
    }

    // Clear any time control
    if (jexcel.timeControl) {
        clearTimeout(jexcel.timeControl);
        jexcel.timeControl = null;
    }

    // Mouse up
    jexcel.isMouseAction = false;
}

// Mouse move controls
jexcel.mouseMoveControls = function(e) {
    e = e || window.event;
    if (e.buttons) {
        var mouseButton = e.buttons;
    } else if (e.button) {
        var mouseButton = e.button;
    } else {
        var mouseButton = e.which;
    }

    if (! mouseButton) {
        jexcel.isMouseAction = false;
    }

    if (jexcel.current) {
        if (jexcel.isMouseAction == true) {
            // Resizing is ongoing
            if (jexcel.current.resizing) {
                if (jexcel.current.resizing.column) {
                    var width = e.pageX - jexcel.current.resizing.mousePosition;

                    if (jexcel.current.resizing.width + width > 0) {
                        var tempWidth = jexcel.current.resizing.width + width;
                        jexcel.current.colgroup[jexcel.current.resizing.column].setAttribute('width', tempWidth);

                        jexcel.current.updateCornerPosition();
                    }
                } else {
                    var height = e.pageY - jexcel.current.resizing.mousePosition;

                    if (jexcel.current.resizing.height + height > 0) {
                        var tempHeight = jexcel.current.resizing.height + height;
                        jexcel.current.rows[jexcel.current.resizing.row].setAttribute('height', tempHeight);

                        jexcel.current.updateCornerPosition();
                    }
                }
            }
        } else {
            var x = e.target.getAttribute('data-x');
            var y = e.target.getAttribute('data-y');
            var rect = e.target.getBoundingClientRect();

            if (jexcel.current.cursor) {
                jexcel.current.cursor.style.cursor = '';
                jexcel.current.cursor = null;
            }

            if (e.target.parentNode.parentNode && e.target.parentNode.parentNode.className) {
                if (e.target.parentNode.parentNode.classList.contains('resizable')) {
                    if (e.target && x && ! y && (rect.width - (e.clientX - rect.left) < 6)) {
                        jexcel.current.cursor = e.target;
                        jexcel.current.cursor.style.cursor = 'col-resize';
                    } else if (e.target && ! x && y && (rect.height - (e.clientY - rect.top) < 6)) {
                        jexcel.current.cursor = e.target;
                        jexcel.current.cursor.style.cursor = 'row-resize';
                    }
                }

                if (e.target.parentNode.parentNode.classList.contains('draggable')) {
                    if (e.target && ! x && y && (rect.width - (e.clientX - rect.left) < 6)) {
                        jexcel.current.cursor = e.target;
                        jexcel.current.cursor.style.cursor = 'move';
                    } else if (e.target && x && ! y && (rect.height - (e.clientY - rect.top) < 6)) {
                        jexcel.current.cursor = e.target;
                        jexcel.current.cursor.style.cursor = 'move';
                    }
                }
            }
        }
    }
}

jexcel.mouseOverControls = function(e) {
    e = e || window.event;
    if (e.buttons) {
        var mouseButton = e.buttons;
    } else if (e.button) {
        var mouseButton = e.button;
    } else {
        var mouseButton = e.which;
    }

    if (! mouseButton) {
        jexcel.isMouseAction = false;
    }

    if (jexcel.current && jexcel.isMouseAction == true) {
        // Get elements
        var jexcelTable = jexcel.getElement(e.target);

        if (jexcelTable[0]) {
            // Avoid cross reference
            if (jexcel.current != jexcelTable[0].jexcel) {
                if (jexcel.current) {
                    return false;
                }
            }

            var columnId = e.target.getAttribute('data-x');
            var rowId = e.target.getAttribute('data-y');

            if (jexcel.current.dragging) {
                if (jexcel.current.dragging.column) {
                    if (columnId) {
                        if (jexcel.current.isColMerged(columnId).length) {
                            console.error('JEXCEL: This column is part of a merged cell.');
                        } else {
                            for (var i = 0; i < jexcel.current.headers.length; i++) {
                                jexcel.current.headers[i].classList.remove('dragging-left');
                                jexcel.current.headers[i].classList.remove('dragging-right');
                            }

                            if (jexcel.current.dragging.column == columnId) {
                                jexcel.current.dragging.destination = parseInt(columnId);
                            } else {
                                if (e.target.clientWidth / 2 > e.offsetX) {
                                    if (jexcel.current.dragging.column < columnId) {
                                        jexcel.current.dragging.destination = parseInt(columnId) - 1;
                                    } else {
                                        jexcel.current.dragging.destination = parseInt(columnId);
                                    }
                                    jexcel.current.headers[columnId].classList.add('dragging-left');
                                } else {
                                    if (jexcel.current.dragging.column < columnId) {
                                        jexcel.current.dragging.destination = parseInt(columnId);
                                    } else {
                                        jexcel.current.dragging.destination = parseInt(columnId) + 1;
                                    }
                                    jexcel.current.headers[columnId].classList.add('dragging-right');
                                }
                            }
                        }
                    }
                } else {
                    if (rowId) {
                        if (jexcel.current.isRowMerged(rowId).length) {
                            console.error('JEXCEL: This row is part of a merged cell.');
                        } else {
                            var target = (e.target.clientHeight / 2 > e.offsetY) ? e.target.parentNode.nextSibling : e.target.parentNode;
                            e.target.parentNode.parentNode.insertBefore(jexcel.current.dragging.element, target);
                        }
                    }
                }
            } else if (jexcel.current.resizing) {
            } else {
                // Header found
                if (jexcelTable[1] == 1) {
                    if (jexcel.current.selectedHeader) {
                        var columnId = e.target.getAttribute('data-x');
                        var o = jexcel.current.selectedHeader;
                        var d = columnId;
                        // Update selection
                        jexcel.current.updateSelectionFromCoords(o, 0, d, jexcel.current.options.data.length - 1);
                    }
                }

                // Body found
                if (jexcelTable[1] == 2) {
                    if (e.target.classList.contains('jexcel_row')) {
                        if (jexcel.current.selectedRow) {
                            var o = jexcel.current.selectedRow;
                            var d = rowId;
                            // Update selection
                            jexcel.current.updateSelectionFromCoords(0, o, jexcel.current.options.data[0].length - 1, d);
                        }
                    } else {
                        // Do not select edtion is in progress
                        if (! jexcel.current.edition) {
                            if (columnId && rowId) {
                                if (jexcel.current.selectedCorner) {
                                    jexcel.current.updateCopySelection(columnId, rowId);
                                } else {
                                    if (jexcel.current.selectedCell) {
                                        jexcel.current.updateSelectionFromCoords(jexcel.current.selectedCell[0], jexcel.current.selectedCell[1], columnId, rowId);
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }

    // Clear any time control
    if (jexcel.timeControl) {
        clearTimeout(jexcel.timeControl);
        jexcel.timeControl = null;
    }
}

/**
 * Double click event handler: controls the double click in the corner, cell edition or column re-ordering.
 */
jexcel.doubleClickControls = function(e) {
    // Jexcel is selected
    if (jexcel.current) {
        // Corner action
        if (e.target.classList.contains('jexcel_corner')) {
            // Any selected cells
            if (jexcel.current.highlighted.length > 0) {
                // Copy from this
                var x1 = jexcel.current.highlighted[0].getAttribute('data-x');
                var y1 = parseInt(jexcel.current.highlighted[jexcel.current.highlighted.length - 1].getAttribute('data-y')) + 1;
                // Until this
                var x2 = jexcel.current.highlighted[jexcel.current.highlighted.length - 1].getAttribute('data-x');
                var y2 = jexcel.current.records.length - 1
                // Execute copy
                jexcel.current.copyData(jexcel.current.records[y1][x1], jexcel.current.records[y2][x2]);
            }
        } else {
            // Get table
            var jexcelTable = jexcel.getElement(e.target);

            // Double click over header
            if (jexcelTable[1] == 1 && jexcel.current.options.columnSorting == true) {
                // Check valid column header coords
                var columnId = e.target.getAttribute('data-x');
                if (columnId) {
                    jexcel.current.orderBy(columnId);
                }
            }

            // Double click over body
            if (jexcelTable[1] == 2 && jexcel.current.options.editable == true) {
                if (! jexcel.current.edition) {
                    var getCellCoords = function(element) {
                        if (element.parentNode) {
                            var x = element.getAttribute('data-x');
                            var y = element.getAttribute('data-y');
                            if (x && y) {
                                return element;
                            } else {
                                return getCellCoords(element.parentNode);
                            }
                        }
                    }
                    var cell = getCellCoords(e.target);
                    if (cell && cell.classList.contains('highlight')) {
                        jexcel.current.openEditor(cell);
                    }
                }
            }
        }
    }
}

jexcel.copyControls = function(e) {
    if (jexcel.current && jexcel.copyControls.enabled) {
        if (! jexcel.current.edition) {
            jexcel.current.copy(true);
        }
    }
}

jexcel.cutControls = function(e) {
    if (jexcel.current) {
        if (! jexcel.current.edition) {
            jexcel.current.copy(true);
            if (jexcel.current.options.editable == true) {
                jexcel.current.setValue(jexcel.current.highlighted, '');
            }
        }
    }
}

jexcel.pasteControls = function(e) {
    if (jexcel.current && jexcel.current.selectedCell) {
        if (! jexcel.current.edition) {
            if (jexcel.current.options.editable == true) {
                if (e && e.clipboardData) {
                    jexcel.current.paste(jexcel.current.selectedCell[0], jexcel.current.selectedCell[1], e.clipboardData.getData('text'));
                    e.preventDefault();
                } else if (window.clipboardData) {
                    jexcel.current.paste(jexcel.current.selectedCell[0], jexcel.current.selectedCell[1], window.clipboardData.getData('text'));
                }
            }
        }
    }
}

jexcel.contextMenuControls = function(e) {
    e = e || window.event;
    if ("buttons" in e) {
        var mouseButton = e.buttons;
    } else {
        var mouseButton = e.which || e.button;
    }

    if (jexcel.current) {
        if (jexcel.current.edition) {
            e.preventDefault();
        } else if (jexcel.current.options.contextMenu) {
            jexcel.current.contextMenu.contextmenu.close();

            if (jexcel.current) {
                var x = e.target.getAttribute('data-x');
                var y = e.target.getAttribute('data-y');

                if (x || y) {
                    // Table found
                    var items = jexcel.current.options.contextMenu(jexcel.current, x, y, e);
                    // The id is depending on header and body
                    jexcel.current.contextMenu.contextmenu.open(e, items);
                    // Avoid the real one
                    e.preventDefault();
                }
            }
        }
    }
}

jexcel.touchStartControls = function(e) {
    var jexcelTable = jexcel.getElement(e.target);

    if (jexcelTable[0]) {
        if (jexcel.current != jexcelTable[0].jexcel) {
            if (jexcel.current) {
                jexcel.current.resetSelection();
            }
            jexcel.current = jexcelTable[0].jexcel;
        }
    } else {
        if (jexcel.current) {
            jexcel.current.resetSelection();
            jexcel.current = null;
        }
    }

    if (jexcel.current) {
        if (! jexcel.current.edition) {
            var columnId = e.target.getAttribute('data-x');
            var rowId = e.target.getAttribute('data-y');

            if (columnId && rowId) {
                jexcel.current.updateSelectionFromCoords(columnId, rowId);

                jexcel.timeControl = setTimeout(function() {
                    // Keep temporary reference to the element
                    if (jexcel.current.options.columns[columnId].type == 'color') {
                        jexcel.tmpElement = null;
                    } else {
                        jexcel.tmpElement = e.target;
                    }
                    jexcel.current.openEditor(e.target, false, e);
                }, 500);
            }
        }
    }
}

jexcel.touchEndControls = function(e) {
    // Clear any time control
    if (jexcel.timeControl) {
        clearTimeout(jexcel.timeControl);
        jexcel.timeControl = null;
        // Element
        if (jexcel.tmpElement && jexcel.tmpElement.children[0].tagName == 'INPUT') {
            jexcel.tmpElement.children[0].focus();
        }
        jexcel.tmpElement = null;
    }
}

/**
 * Jexcel extensions
 */

jexcel.createTabs = function(tabs, result) {
    // Create tab container
    tabs.innerHTML = '';
    tabs.classList.add('jexcel_tabs');
    var spreadsheet = []
    var link = [];
    for (var i = 0; i < result.length; i++) {
        // Spreadsheet container
        spreadsheet[i] = document.createElement('div');
        spreadsheet[i].classList.add('jexcel_tab');
        // Tab link
        link[i] = document.createElement('div');
        link[i].classList.add('jexcel_tab_link');
        link[i].setAttribute('data-spreadsheet', i);
        link[i].innerHTML = result[i].sheetName;
        link[i].onclick = function() {
            for (var j = 0; j < spreadsheet.length; j++) {
                spreadsheet[j].style.display = 'none';
                link[j].classList.remove('selected');
            }
            var i = this.getAttribute('data-spreadsheet');
            spreadsheet[i].style.display = 'block';
            link[i].classList.add('selected')
        }
        tabs.appendChild(link[i]);
    }

    // Append spreadsheet
    for (var i = 0; i < spreadsheet.length - 1; i++) {
        tabs.appendChild(spreadsheet[i]);
        jexcel(spreadsheet[i], result[i]);
    }

    // First tab
    spreadsheet[0].style.display = 'block';
    link[0].classList.add('selected')
}

jexcel.fromSpreadsheet = function(file, __callback) {
    var convert = function(workbook) {
        var spreadsheets = [];
        workbook.SheetNames.forEach(function(sheetName) {
            var spreadsheet = {};
            spreadsheet.rows = [];
            spreadsheet.columns = [];
            spreadsheet.data = [];
            spreadsheet.style = {};
            spreadsheet.sheetName = sheetName;

            // Column widths
            var temp = workbook.Sheets[sheetName]['!cols'];
            if (temp && temp.length) {
                for (var i = 0; i < temp.length; i++) {
                    spreadsheet.columns[i] = {};
                    if (temp[i] && temp[i].wpx) {
                        spreadsheet.columns[i].width = temp[i].wpx + 'px';
                    }
                }
            }
            // Rows heights
            var temp = workbook.Sheets[sheetName]['!rows'];
            if (temp && temp.length) {
                for (var i = 0; i < temp.length; i++) {
                    if (temp[i] && temp[i].hpx) {
                        spreadsheet.rows[i] = {};
                        spreadsheet.rows[i].height = temp[i].hpx + 'px';
                    }
                }
            }
            // Merge cells
            var temp = workbook.Sheets[sheetName]['!merges'];
            if (temp && temp.length > 0) {
                spreadsheet.mergeCells = [];
                for (var i = 0; i < temp.length; i++) {
                    var x1 = temp[i].s.c;
                    var y1 = temp[i].s.r;
                    var x2 = temp[i].e.c;
                    var y2 = temp[i].e.r;
                    var key = jexcel.getColumnNameFromId([x1,y1]);
                    spreadsheet.mergeCells[key] = [ x2-x1+1, y2-y1+1 ];
                }
            }
            // Data container
            var max_x = 0;
            var max_y = 0;
            var temp = Object.keys(workbook.Sheets[sheetName]);
            for (var i = 0; i < temp.length; i++) {
                if (temp[i].substr(0,1) != '!') {
                    var cell = workbook.Sheets[sheetName][temp[i]];
                    var info = jexcel.getIdFromColumnName(temp[i], true);
                    if (! spreadsheet.data[info[1]]) {
                        spreadsheet.data[info[1]] = [];
                    }
                    spreadsheet.data[info[1]][info[0]] = cell.f ? '=' + cell.f : cell.w;
                    if (max_x < info[0]) {
                        max_x = info[0];
                    }
                    if (max_y < info[1]) {
                        max_y = info[1];
                    }
                    // Style
                    if (cell.style && Object.keys(cell.style).length > 0) {
                        spreadsheet.style[temp[i]] = cell.style;
                    }
                    if (cell.s && cell.s.fgColor) {
                        if (spreadsheet.style[temp[i]]) {
                            spreadsheet.style[temp[i]] += ';';
                        }
                        spreadsheet.style[temp[i]] += 'background-color:#' + cell.s.fgColor.rgb;
                    }
                }
            }
            var numColumns = spreadsheet.columns;
            for (var j = 0; j <= max_y; j++) {
                for (var i = 0; i <= max_x; i++) {
                    if (! spreadsheet.data[j]) {
                        spreadsheet.data[j] = [];
                    }
                    if (! spreadsheet.data[j][i]) {
                        if (numColumns < i) {
                            spreadsheet.data[j][i] = '';
                        }
                    }
                }
            }
            spreadsheets.push(spreadsheet);
        });

        return spreadsheets;
    }

    var oReq;
    oReq = new XMLHttpRequest();
    oReq.open("GET", file, true);

    if(typeof Uint8Array !== 'undefined') {
        oReq.responseType = "arraybuffer";
        oReq.onload = function(e) {
            var arraybuffer = oReq.response;
            var data = new Uint8Array(arraybuffer);
            var wb = XLSX.read(data, {type:"array", cellFormula:true, cellStyles:true });
            __callback(convert(wb))
        };
    } else {
        oReq.setRequestHeader("Accept-Charset", "x-user-defined");  
        oReq.onreadystatechange = function() { if(oReq.readyState == 4 && oReq.status == 200) {
            var ff = convertResponseBodyToText(oReq.responseBody);
            var wb = XLSX.read(ff, {type:"binary", cellFormula:true, cellStyles:true });
            __callback(convert(wb))
        }};
    }

    oReq.send();
}

/**
 * Valid international letter
 */

jexcel.validLetter = function (text) {
    var regex = /([\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0\u08A2-\u08AC\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA697\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA793\uA7A0-\uA7AA\uA7F8-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC-\u0400-\u04FF']+)/g;
    return text.match(regex) ? 1 : 0;
}

/**
 * Helper injectArray
 */
jexcel.injectArray = function(o, idx, arr) {
    return o.slice(0, idx).concat(arr).concat(o.slice(idx));
}

/**
 * Get letter based on a number
 * 
 * @param integer i
 * @return string letter
 */
jexcel.getColumnName = function(i) {
    var letter = '';
    if (i > 701) {
        letter += String.fromCharCode(64 + parseInt(i / 676));
        letter += String.fromCharCode(64 + parseInt((i % 676) / 26));
    } else if (i > 25) {
        letter += String.fromCharCode(64 + parseInt(i / 26));
    }
    letter += String.fromCharCode(65 + (i % 26));

    return letter;
}

/**
 * Convert excel like column to jexcel id
 * 
 * @param string id
 * @return string id
 */
jexcel.getIdFromColumnName = function (id, arr) {
    // Get the letters
    var t = /^[a-zA-Z]+/.exec(id);

    if (t) {
        // Base 26 calculation
        var code = 0;
        for (var i = 0; i < t[0].length; i++) {
            code += parseInt(t[0].charCodeAt(i) - 64) * Math.pow(26, (t[0].length - 1 - i));
        }
        code--;
        // Make sure jexcel starts on zero
        if (code < 0) {
            code = 0;
        }

        // Number
        var number = parseInt(/[0-9]+$/.exec(id));
        if (number > 0) {
            number--;
        }

        if (arr == true) {
            id = [ code, number ];
        } else {
            id = code + '-' + number;
        }
    }

    return id;
}

/**
 * Convert jexcel id to excel like column name
 * 
 * @param string id
 * @return string id
 */
jexcel.getColumnNameFromId = function (cellId) {
    if (! Array.isArray(cellId)) {
        cellId = cellId.split('-');
    }

    return jexcel.getColumnName(parseInt(cellId[0])) + (parseInt(cellId[1]) + 1);
}

/**
 * Verify element inside jexcel table
 * 
 * @param string id
 * @return string id
 */
jexcel.getElement = function(element) {
    var jexcelSection = 0;
    var jexcelElement = 0;

    function path (element) {
        if (element.className) {
            if (element.classList.contains('jexcel_container')) {
                jexcelElement = element;
            }
        }

        if (element.tagName == 'THEAD') {
            jexcelSection = 1;
        } else if (element.tagName == 'TBODY') {
            jexcelSection = 2;
        }

        if (element.parentNode) {
            path(element.parentNode);
        }
    }

    path(element);

    return [ jexcelElement, jexcelSection ];
}

jexcel.doubleDigitFormat = function(v) {
    v = ''+v;
    if (v.length == 1) {
        v = '0'+v;
    }
    return v;
}

/**
 * Jquery Support
 */
if (typeof(jQuery) != 'undefined') {
    (function($){
        $.fn.jexcel = function(method) {
            var spreadsheetContainer = $(this).get(0);
            if (! spreadsheetContainer.jexcel) {
                return jexcel($(this).get(0), arguments[0]);
            } else {
                return spreadsheetContainer.jexcel[method].apply(this, Array.prototype.slice.call( arguments, 1 ));
            }
        };

    })(jQuery);
}


// Based on sutoiku work (https://github.com/sutoiku)

var error = (function() {
    var exports = {};

    exports.nil = new Error('#NULL!');
    exports.div0 = new Error('#DIV/0!');
    exports.value = new Error('#VALUE!');
    exports.ref = new Error('#REF!');
    exports.name = new Error('#NAME?');
    exports.num = new Error('#NUM!');
    exports.na = new Error('#N/A');
    exports.error = new Error('#ERROR!');
    exports.data = new Error('#GETTING_DATA');

    return exports;
})();

var utils = (function() {
    var exports = {};

    exports.flattenShallow = function(array) {
        if (!array || !array.reduce) {
            return array;
        }

        return array.reduce(function(a, b) {
            var aIsArray = Array.isArray(a);
            var bIsArray = Array.isArray(b);

            if (aIsArray && bIsArray) {
                return a.concat(b);
            }
            if (aIsArray) {
                a.push(b);

                return a;
            }
            if (bIsArray) {
                return [ a ].concat(b);
            }

            return [ a, b ];
        });
    };

    exports.isFlat = function(array) {
        if (!array) {
            return false;
        }

        for (var i = 0; i < array.length; ++i) {
            if (Array.isArray(array[i])) {
                return false;
            }
        }

        return true;
    };

    exports.flatten = function() {
        var result = exports.argsToArray.apply(null, arguments);

        while (!exports.isFlat(result)) {
            result = exports.flattenShallow(result);
        }

        return result;
    };

    exports.argsToArray = function(args) {
        var result = [];

        exports.arrayEach(args, function(value) {
            result.push(value);
        });

        return result;
    };

    exports.numbers = function() {
        var possibleNumbers = this.flatten.apply(null, arguments);
        return possibleNumbers.filter(function(el) {
            return typeof el === 'number';
        });
    };

    exports.cleanFloat = function(number) {
        var power = 1e14;
        return Math.round(number * power) / power;
    };

    exports.parseBool = function(bool) {
        if (typeof bool === 'boolean') {
            return bool;
        }

        if (bool instanceof Error) {
            return bool;
        }

        if (typeof bool === 'number') {
            return bool !== 0;
        }

        if (typeof bool === 'string') {
            var up = bool.toUpperCase();
            if (up === 'TRUE') {
                return true;
            }

            if (up === 'FALSE') {
                return false;
            }
        }

        if (bool instanceof Date && !isNaN(bool)) {
            return true;
        }

        return error.value;
    };

    exports.parseNumber = function(string) {
        if (string === undefined || string === '') {
            return error.value;
        }
        if (!isNaN(string)) {
            return parseFloat(string);
        }

        return error.value;
    };

    exports.parseNumberArray = function(arr) {
        var len;

        if (!arr || (len = arr.length) === 0) {
            return error.value;
        }

        var parsed;

        while (len--) {
            parsed = exports.parseNumber(arr[len]);
            if (parsed === error.value) {
                return parsed;
            }
            arr[len] = parsed;
        }

        return arr;
    };

    exports.parseMatrix = function(matrix) {
        var n;

        if (!matrix || (n = matrix.length) === 0) {
            return error.value;
        }
        var pnarr;

        for (var i = 0; i < matrix.length; i++) {
            pnarr = exports.parseNumberArray(matrix[i]);
            matrix[i] = pnarr;

            if (pnarr instanceof Error) {
                return pnarr;
            }
        }

        return matrix;
    };

    var d1900 = new Date(Date.UTC(1900, 0, 1));
    exports.parseDate = function(date) {
        if (!isNaN(date)) {
            if (date instanceof Date) {
                return new Date(date);
            }
            var d = parseInt(date, 10);
            if (d < 0) {
                return error.num;
            }
            if (d <= 60) {
                return new Date(d1900.getTime() + (d - 1) * 86400000);
            }
            return new Date(d1900.getTime() + (d - 2) * 86400000);
        }
        if (typeof date === 'string') {
            date = new Date(date);
            if (!isNaN(date)) {
                return date;
            }
        }
        return error.value;
    };

    exports.parseDateArray = function(arr) {
        var len = arr.length;
        var parsed;
        while (len--) {
            parsed = this.parseDate(arr[len]);
            if (parsed === error.value) {
                return parsed;
            }
            arr[len] = parsed;
        }
        return arr;
    };

    exports.anyIsError = function() {
        var n = arguments.length;
        while (n--) {
            if (arguments[n] instanceof Error) {
                return true;
            }
        }
        return false;
    };

    exports.arrayValuesToNumbers = function(arr) {
        var n = arr.length;
        var el;
        while (n--) {
            el = arr[n];
            if (typeof el === 'number') {
                continue;
            }
            if (el === true) {
                arr[n] = 1;
                continue;
            }
            if (el === false) {
                arr[n] = 0;
                continue;
            }
            if (typeof el === 'string') {
                var number = this.parseNumber(el);
                if (number instanceof Error) {
                    arr[n] = 0;
                } else {
                    arr[n] = number;
                }
            }
        }
        return arr;
    };

    exports.rest = function(array, idx) {
        idx = idx || 1;
        if (!array || typeof array.slice !== 'function') {
            return array;
        }
        return array.slice(idx);
    };

    exports.initial = function(array, idx) {
        idx = idx || 1;
        if (!array || typeof array.slice !== 'function') {
            return array;
        }
        return array.slice(0, array.length - idx);
    };

    exports.arrayEach = function(array, iteratee) {
        var index = -1, length = array.length;

        while (++index < length) {
            if (iteratee(array[index], index, array) === false) {
                break;
            }
        }

        return array;
    };

    exports.transpose = function(matrix) {
        if (!matrix) {
            return error.value;
        }

        return matrix[0].map(function(col, i) {
            return matrix.map(function(row) {
                return row[i];
            });
        });
    };

    return exports;
})();

jexcel.methods = {};

jexcel.methods.datetime = (function() {
    var exports = {};

    var d1900 = new Date(1900, 0, 1);
    var WEEK_STARTS = [
        undefined,
        0,
        1,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        1,
        2,
        3,
        4,
        5,
        6,
        0
    ];
    var WEEK_TYPES = [
        [],
        [1, 2, 3, 4, 5, 6, 7],
        [7, 1, 2, 3, 4, 5, 6],
        [6, 0, 1, 2, 3, 4, 5],
        [],
        [],
        [],
        [],
        [],
        [],
        [],
        [7, 1, 2, 3, 4, 5, 6],
        [6, 7, 1, 2, 3, 4, 5],
        [5, 6, 7, 1, 2, 3, 4],
        [4, 5, 6, 7, 1, 2, 3],
        [3, 4, 5, 6, 7, 1, 2],
        [2, 3, 4, 5, 6, 7, 1],
        [1, 2, 3, 4, 5, 6, 7]
    ];
    var WEEKEND_TYPES = [
        [],
        [6, 0],
        [0, 1],
        [1, 2],
        [2, 3],
        [3, 4],
        [4, 5],
        [5, 6],
        undefined,
        undefined,
        undefined, [0, 0],
        [1, 1],
        [2, 2],
        [3, 3],
        [4, 4],
        [5, 5],
        [6, 6]
    ];

    exports.DATE = function(year, month, day) {
        year = utils.parseNumber(year);
        month = utils.parseNumber(month);
        day = utils.parseNumber(day);
        if (utils.anyIsError(year, month, day)) {
            return error.value;
        }
        if (year < 0 || month < 0 || day < 0) {
            return error.num;
        }
        var date = new Date(year, month - 1, day);
        return date;
    };

    exports.DATEVALUE = function(date_text) {
        if (typeof date_text !== 'string') {
            return error.value;
        }
        var date = Date.parse(date_text);
        if (isNaN(date)) {
            return error.value;
        }
        if (date <= -2203891200000) {
            return (date - d1900) / 86400000 + 1;
        }
        return (date - d1900) / 86400000 + 2;
    };

    exports.DAY = function(serial_number) {
        var date = utils.parseDate(serial_number);
        if (date instanceof Error) {
            return date;
        }
        return date.getDate();
    };

    exports.DAYS = function(end_date, start_date) {
        end_date = utils.parseDate(end_date);
        start_date = utils.parseDate(start_date);
        if (end_date instanceof Error) {
            return end_date;
        }
        if (start_date instanceof Error) {
            return start_date;
        }
        return serial(end_date) - serial(start_date);
    };

    exports.DAYS360 = function(start_date, end_date, method) {
    };

    exports.EDATE = function(start_date, months) {
        start_date = utils.parseDate(start_date);
        if (start_date instanceof Error) {
            return start_date;
        }
        if (isNaN(months)) {
            return error.value;
        }
        months = parseInt(months, 10);
        start_date.setMonth(start_date.getMonth() + months);
        return serial(start_date);
    };

    exports.EOMONTH = function(start_date, months) {
        start_date = utils.parseDate(start_date);
        if (start_date instanceof Error) {
            return start_date;
        }
        if (isNaN(months)) {
            return error.value;
        }
        months = parseInt(months, 10);
        return serial(new Date(start_date.getFullYear(), start_date.getMonth() + months + 1, 0));
    };

    exports.HOUR = function(serial_number) {
        serial_number = utils.parseDate(serial_number);
        if (serial_number instanceof Error) {
            return serial_number;
        }
        return serial_number.getHours();
    };

    exports.INTERVAL = function(second) {
        if (typeof second !== 'number' && typeof second !== 'string') {
            return error.value;
        } else {
            second = parseInt(second, 10);
        }

        var year  = Math.floor(second/946080000);
        second    = second%946080000;
        var month = Math.floor(second/2592000);
        second    = second%2592000;
        var day   = Math.floor(second/86400);
        second    = second%86400;

        var hour  = Math.floor(second/3600);
        second    = second%3600;
        var min   = Math.floor(second/60);
        second    = second%60;
        var sec   = second;

        year  = (year  > 0) ? year  + 'Y' : '';
        month = (month > 0) ? month + 'M' : '';
        day   = (day   > 0) ? day   + 'D' : '';
        hour  = (hour  > 0) ? hour  + 'H' : '';
        min   = (min   > 0) ? min   + 'M' : '';
        sec   = (sec   > 0) ? sec   + 'S' : '';

        return 'P' + year + month + day + 'T' + hour + min + sec;
    };

    exports.ISOWEEKNUM = function(date) {
        date = utils.parseDate(date);
        if (date instanceof Error) {
            return date;
        }

        date.setHours(0, 0, 0);
        date.setDate(date.getDate() + 4 - (date.getDay() || 7));
        var yearStart = new Date(date.getFullYear(), 0, 1);
        return Math.ceil((((date - yearStart) / 86400000) + 1) / 7);
    };

    exports.MINUTE = function(serial_number) {
        serial_number = utils.parseDate(serial_number);
        if (serial_number instanceof Error) {
            return serial_number;
        }
        return serial_number.getMinutes();
    };

    exports.MONTH = function(serial_number) {
        serial_number = utils.parseDate(serial_number);
        if (serial_number instanceof Error) {
            return serial_number;
        }
        return serial_number.getMonth() + 1;
    };

    exports.NETWORKDAYS = function(start_date, end_date, holidays) {
    };

    exports.NETWORKDAYS.INTL = function(start_date, end_date, weekend, holidays) {
    };

    exports.NOW = function() {
        return new Date();
    };

    exports.SECOND = function(serial_number) {
        serial_number = utils.parseDate(serial_number);
        if (serial_number instanceof Error) {
            return serial_number;
        }
        return serial_number.getSeconds();
    };

    exports.TIME = function(hour, minute, second) {
        hour = utils.parseNumber(hour);
        minute = utils.parseNumber(minute);
        second = utils.parseNumber(second);
        if (utils.anyIsError(hour, minute, second)) {
            return error.value;
        }
        if (hour < 0 || minute < 0 || second < 0) {
            return error.num;
        }
        return (3600 * hour + 60 * minute + second) / 86400;
    };

    exports.TIMEVALUE = function(time_text) {
        time_text = utils.parseDate(time_text);
        if (time_text instanceof Error) {
            return time_text;
        }
        return (3600 * time_text.getHours() + 60 * time_text.getMinutes() + time_text.getSeconds()) / 86400;
    };

    exports.TODAY = function() {
        return new Date();
    };

    exports.WEEKDAY = function(serial_number, return_type) {
        serial_number = utils.parseDate(serial_number);
        if (serial_number instanceof Error) {
            return serial_number;
        }
        if (return_type === undefined) {
            return_type = 1;
        }
        var day = serial_number.getDay();
        return WEEK_TYPES[return_type][day];
    };

    exports.WEEKNUM = function(serial_number, return_type) {
    };

    exports.WORKDAY = function(start_date, days, holidays) {
    };

    exports.WORKDAY.INTL = function(start_date, days, weekend, holidays) {
    };

    exports.YEAR = function(serial_number) {
        serial_number = utils.parseDate(serial_number);
        if (serial_number instanceof Error) {
            return serial_number;
        }
        return serial_number.getFullYear();
    };

    function isLeapYear(year) {
        return new Date(year, 1, 29).getMonth() === 1;
    }

    exports.YEARFRAC = function(start_date, end_date, basis) {
    };

    function serial(date) {
        var addOn = (date > -2203891200000)?2:1;
        return (date - d1900) / 86400000 + addOn;
    }

    return exports;
})();

jexcel.methods.database = (function() {
    var exports = {};

    function compact(array) {
        if (!array) {
            return array;
        }
        var result = [];
        for (var i = 0; i < array.length; ++i) {
            if (!array[i]) {
                continue;
            }
            result.push(array[i]);
        }
        return result;
    }

    exports.FINDFIELD = function(database, title) {
        var index = null;
        for (var i = 0; i < database.length; i++) {
            if (database[i][0] === title) {
                index = i;
                break;
            }
        }

        // Return error if the input field title is incorrect
        if (index == null) {
            return error.value;
        }
        return index;
    };

    function findResultIndex(database, criterias) {
        var matches = {};
        for (var i = 1; i < database[0].length; ++i) {
            matches[i] = true;
        }
        var maxCriteriaLength = criterias[0].length;
        for (i = 1; i < criterias.length; ++i) {
            if (criterias[i].length > maxCriteriaLength) {
                maxCriteriaLength = criterias[i].length;
            }
        }

        for (var k = 1; k < database.length; ++k) {
            for (var l = 1; l < database[k].length; ++l) {
                var currentCriteriaResult = false;
                var hasMatchingCriteria = false;
                for (var j = 0; j < criterias.length; ++j) {
                    var criteria = criterias[j];
                    if (criteria.length < maxCriteriaLength) {
                        continue;
                    }

                    var criteriaField = criteria[0];
                    if (database[k][0] !== criteriaField) {
                        continue;
                    }
                    hasMatchingCriteria = true;
                    for (var p = 1; p < criteria.length; ++p) {
                        currentCriteriaResult = currentCriteriaResult
                                || eval(database[k][l] + criteria[p]); // jshint
                                                                        // ignore:line
                    }
                }
                if (hasMatchingCriteria) {
                    matches[l] = matches[l] && currentCriteriaResult;
                }
            }
        }

        var result = [];
        for (var n = 0; n < database[0].length; ++n) {
            if (matches[n]) {
                result.push(n - 1);
            }
        }
        return result;
    }

    // Database functions
    exports.DAVERAGE = function(database, field, criteria) {
        // Return error if field is not a number and not a string
        if (isNaN(field) && (typeof field !== "string")) {
            return error.value;
        }
        var resultIndexes = findResultIndex(database, criteria);
        var targetFields = [];
        if (typeof field === "string") {
            var index = exports.FINDFIELD(database, field);
            targetFields = utils.rest(database[index]);
        } else {
            targetFields = utils.rest(database[field]);
        }
        var sum = 0;
        for (var i = 0; i < resultIndexes.length; i++) {
            sum += targetFields[resultIndexes[i]];
        }
        return resultIndexes.length === 0 ? error.div0 : sum / resultIndexes.length;
    };

    exports.DCOUNT = function(database, field, criteria) {
    };

    exports.DCOUNTA = function(database, field, criteria) {
    };

    exports.DGET = function(database, field, criteria) {
        // Return error if field is not a number and not a string
        if (isNaN(field) && (typeof field !== "string")) {
            return error.value;
        }
        var resultIndexes = findResultIndex(database, criteria);
        var targetFields = [];
        if (typeof field === "string") {
            var index = exports.FINDFIELD(database, field);
            targetFields = utils.rest(database[index]);
        } else {
            targetFields = utils.rest(database[field]);
        }
        // Return error if no record meets the criteria
        if (resultIndexes.length === 0) {
            return error.value;
        }
        // Returns the #NUM! error value because more than one record meets the
        // criteria
        if (resultIndexes.length > 1) {
            return error.num;
        }

        return targetFields[resultIndexes[0]];
    };

    exports.DMAX = function(database, field, criteria) {
        // Return error if field is not a number and not a string
        if (isNaN(field) && (typeof field !== "string")) {
            return error.value;
        }
        var resultIndexes = findResultIndex(database, criteria);
        var targetFields = [];
        if (typeof field === "string") {
            var index = exports.FINDFIELD(database, field);
            targetFields = utils.rest(database[index]);
        } else {
            targetFields = utils.rest(database[field]);
        }
        var maxValue = targetFields[resultIndexes[0]];
        for (var i = 1; i < resultIndexes.length; i++) {
            if (maxValue < targetFields[resultIndexes[i]]) {
                maxValue = targetFields[resultIndexes[i]];
            }
        }
        return maxValue;
    };

    exports.DMIN = function(database, field, criteria) {
        // Return error if field is not a number and not a string
        if (isNaN(field) && (typeof field !== "string")) {
            return error.value;
        }
        var resultIndexes = findResultIndex(database, criteria);
        var targetFields = [];
        if (typeof field === "string") {
            var index = exports.FINDFIELD(database, field);
            targetFields = utils.rest(database[index]);
        } else {
            targetFields = utils.rest(database[field]);
        }
        var minValue = targetFields[resultIndexes[0]];
        for (var i = 1; i < resultIndexes.length; i++) {
            if (minValue > targetFields[resultIndexes[i]]) {
                minValue = targetFields[resultIndexes[i]];
            }
        }
        return minValue;
    };

    exports.DPRODUCT = function(database, field, criteria) {
        // Return error if field is not a number and not a string
        if (isNaN(field) && (typeof field !== "string")) {
            return error.value;
        }
        var resultIndexes = findResultIndex(database, criteria);
        var targetFields = [];
        if (typeof field === "string") {
            var index = exports.FINDFIELD(database, field);
            targetFields = utils.rest(database[index]);
        } else {
            targetFields = utils.rest(database[field]);
        }
        var targetValues = [];
        for (var i = 0; i < resultIndexes.length; i++) {
            targetValues[i] = targetFields[resultIndexes[i]];
        }
        targetValues = compact(targetValues);
        var result = 1;
        for (i = 0; i < targetValues.length; i++) {
            result *= targetValues[i];
        }
        return result;
    };

    exports.DSTDEV = function(database, field, criteria) {
    };

    exports.DSTDEVP = function(database, field, criteria) {
    };

    exports.DSUM = function(database, field, criteria) {
    };

    exports.DVAR = function(database, field, criteria) {
    };

    exports.DVARP = function(database, field, criteria) {
    };

    exports.MATCH = function(lookupValue, lookupArray, matchType) {
        if (!lookupValue && !lookupArray) {
            return error.na;
        }
        if (arguments.length === 2) {
            matchType = 1;
        }
        if (!(lookupArray instanceof Array)) {
            return error.na;
        }
        if (matchType !== -1 && matchType !== 0 && matchType !== 1) {
            return error.na;
        }

        var index;
        var indexValue;

        for (var idx = 0; idx < lookupArray.length; idx++) {
            if (matchType === 1) {
                if (lookupArray[idx] === lookupValue) {
                    return idx + 1;
                } else if (lookupArray[idx] < lookupValue) {
                    if (!indexValue) {
                        index = idx + 1;
                        indexValue = lookupArray[idx];
                    } else if (lookupArray[idx] > indexValue) {
                        index = idx + 1;
                        indexValue = lookupArray[idx];
                    }
                }
            } else if (matchType === 0) {
                if (typeof lookupValue === 'string') {
                    lookupValue = lookupValue.replace(/\?/g, '.');
                    if (lookupArray[idx].toLowerCase().match(lookupValue.toLowerCase())) {
                        return idx + 1;
                    }
                } else {
                    if (lookupArray[idx] === lookupValue) {
                        return idx + 1;
                    }
                }
            } else if (matchType === -1) {
                if (lookupArray[idx] === lookupValue) {
                    return idx + 1;
                } else if (lookupArray[idx] > lookupValue) {
                    if (!indexValue) {
                        index = idx + 1;
                        indexValue = lookupArray[idx];
                    } else if (lookupArray[idx] < indexValue) {
                        index = idx + 1;
                        indexValue = lookupArray[idx];
                    }
                }
            }
        }

        return index ? index : error.na;
    };

    return exports;
})();

jexcel.methods.engineering = (function() {
    var exports = {};

    function isValidBinaryNumber(number) {
        return (/^[01]{1,10}$/).test(number);
    }

    exports.BESSELI = function(x, n) {
    };

    exports.BESSELJ = function(x, n) {
    };

    exports.BESSELK = function(x, n) {
    };

    exports.BESSELY = function(x, n) {
    };

    exports.BIN2DEC = function(number) {
        // Return error if number is not binary or contains more than 10
        // characters (10 digits)
        if (!isValidBinaryNumber(number)) {
            return error.num;
        }

        // Convert binary number to decimal
        var result = parseInt(number, 2);

        // Handle negative numbers
        var stringified = number.toString();
        if (stringified.length === 10 && stringified.substring(0, 1) === '1') {
            return parseInt(stringified.substring(1), 2) - 512;
        } else {
            return result;
        }
    };

    exports.BIN2HEX = function(number, places) {
        // Return error if number is not binary or contains more than 10
        // characters (10 digits)
        if (!isValidBinaryNumber(number)) {
            return error.num;
        }

        // Ignore places and return a 10-character hexadecimal number if number
        // is negative
        var stringified = number.toString();
        if (stringified.length === 10 && stringified.substring(0, 1) === '1') {
            return (1099511627264 + parseInt(stringified.substring(1), 2)).toString(16);
        }

        // Convert binary number to hexadecimal
        var result = parseInt(number, 2).toString(16);

        // Return hexadecimal number using the minimum number of characters
        // necessary if places is undefined
        if (places === undefined) {
            return result;
        } else {
            // Return error if places is nonnumeric
            if (isNaN(places)) {
              return error.value;
            }

            // Return error if places is negative
            if (places < 0) {
              return error.num;
            }

            // Truncate places in case it is not an integer
            places = Math.floor(places);

            // Pad return value with leading 0s (zeros) if necessary (using
            // Underscore.string)
            return (places >= result.length) ? REPT('0', places - result.length) + result : error.num;
        }
    };

    exports.BIN2OCT = function(number, places) {
        // Return error if number is not binary or contains more than 10
        // characters (10 digits)
        if (!isValidBinaryNumber(number)) {
            return error.num;
        }

        // Ignore places and return a 10-character octal number if number is
        // negative
        var stringified = number.toString();
        if (stringified.length === 10 && stringified.substring(0, 1) === '1') {
            return (1073741312 + parseInt(stringified.substring(1), 2)).toString(8);
        }

        // Convert binary number to octal
        var result = parseInt(number, 2).toString(8);

        // Return octal number using the minimum number of characters necessary
        // if places is undefined
        if (places === undefined) {
            return result;
        } else {
            // Return error if places is nonnumeric
            if (isNaN(places)) {
              return error.value;
            }

            // Return error if places is negative
            if (places < 0) {
              return error.num;
            }

            // Truncate places in case it is not an integer
            places = Math.floor(places);

            // Pad return value with leading 0s (zeros) if necessary (using
            // Underscore.string)
            return (places >= result.length) ? REPT('0', places - result.length) + result : error.num;
        }
    };

    exports.BITAND = function(number1, number2) {
        // Return error if either number is a non-numeric value
        number1 = utils.parseNumber(number1);
        number2 = utils.parseNumber(number2);
        if (utils.anyIsError(number1, number2)) {
            return error.value;
        }

        // Return error if either number is less than 0
        if (number1 < 0 || number2 < 0) {
            return error.num;
        }

        // Return error if either number is a non-integer
        if (Math.floor(number1) !== number1 || Math.floor(number2) !== number2) {
            return error.num;
        }

        // Return error if either number is greater than (2^48)-1
        if (number1 > 281474976710655 || number2 > 281474976710655) {
            return error.num;
        }

        // Return bitwise AND of two numbers
        return number1 & number2;
    };

    exports.BITLSHIFT = function(number, shift) {
        number = utils.parseNumber(number);
        shift = utils.parseNumber(shift);
        if (utils.anyIsError(number, shift)) {
            return error.value;
        }

        // Return error if number is less than 0
        if (number < 0) {
            return error.num;
        }

        // Return error if number is a non-integer
        if (Math.floor(number) !== number) {
            return error.num;
        }

        // Return error if number is greater than (2^48)-1
        if (number > 281474976710655) {
            return error.num;
        }

        // Return error if the absolute value of shift is greater than 53
        if (Math.abs(shift) > 53) {
            return error.num;
        }

        // Return number shifted by shift bits to the left or to the right if
        // shift is negative
        return (shift >= 0) ? number << shift : number >> -shift;
    };

    exports.BITOR = function(number1, number2) {
        number1 = utils.parseNumber(number1);
        number2 = utils.parseNumber(number2);
        if (utils.anyIsError(number1, number2)) {
            return error.value;
        }

        // Return error if either number is less than 0
        if (number1 < 0 || number2 < 0) {
            return error.num;
        }

        // Return error if either number is a non-integer
        if (Math.floor(number1) !== number1 || Math.floor(number2) !== number2) {
            return error.num;
        }

        // Return error if either number is greater than (2^48)-1
        if (number1 > 281474976710655 || number2 > 281474976710655) {
            return error.num;
        }

        // Return bitwise OR of two numbers
        return number1 | number2;
    };

    exports.BITRSHIFT = function(number, shift) {
        number = utils.parseNumber(number);
        shift = utils.parseNumber(shift);
        if (utils.anyIsError(number, shift)) {
            return error.value;
        }

        // Return error if number is less than 0
        if (number < 0) {
            return error.num;
        }

        // Return error if number is a non-integer
        if (Math.floor(number) !== number) {
            return error.num;
        }

        // Return error if number is greater than (2^48)-1
        if (number > 281474976710655) {
            return error.num;
        }

        // Return error if the absolute value of shift is greater than 53
        if (Math.abs(shift) > 53) {
            return error.num;
        }

        // Return number shifted by shift bits to the right or to the left if
        // shift is negative
        return (shift >= 0) ? number >> shift : number << -shift;
    };

    exports.BITXOR = function(number1, number2) {
        number1 = utils.parseNumber(number1);
        number2 = utils.parseNumber(number2);
        if (utils.anyIsError(number1, number2)) {
            return error.value;
        }

        // Return error if either number is less than 0
        if (number1 < 0 || number2 < 0) {
            return error.num;
        }

        // Return error if either number is a non-integer
        if (Math.floor(number1) !== number1 || Math.floor(number2) !== number2) {
            return error.num;
        }

        // Return error if either number is greater than (2^48)-1
        if (number1 > 281474976710655 || number2 > 281474976710655) {
            return error.num;
        }

        // Return bitwise XOR of two numbers
        return number1 ^ number2;
    };

    exports.COMPLEX = function(real, imaginary, suffix) {
        real = utils.parseNumber(real);
        imaginary = utils.parseNumber(imaginary);
        if (utils.anyIsError(real, imaginary)) {
            return real;
        }

        // Set suffix
        suffix = (suffix === undefined) ? 'i' : suffix;

        // Return error if suffix is neither "i" nor "j"
        if (suffix !== 'i' && suffix !== 'j') {
            return error.value;
        }

        // Return complex number
        if (real === 0 && imaginary === 0) {
            return 0;
        } else if (real === 0) {
            return (imaginary === 1) ? suffix : imaginary.toString() + suffix;
        } else if (imaginary === 0) {
            return real.toString();
        } else {
            var sign = (imaginary > 0) ? '+' : '';
            return real.toString() + sign + ((imaginary === 1) ? suffix : imaginary.toString() + suffix);
        }
    };

    exports.CONVERT = function(number, from_unit, to_unit) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }

        // List of units supported by CONVERT and units defined by the
        // International System of Units
        // [Name, Symbol, Alternate symbols, Quantity, ISU, CONVERT, Conversion
        // ratio]
        var units = [
            ["a.u. of action", "?", null, "action", false, false, 1.05457168181818e-34],
            ["a.u. of charge", "e", null, "electric_charge", false, false, 1.60217653141414e-19],
            ["a.u. of energy", "Eh", null, "energy", false, false, 4.35974417757576e-18],
            ["a.u. of length", "a?", null, "length", false, false, 5.29177210818182e-11],
            ["a.u. of mass", "m?", null, "mass", false, false, 9.10938261616162e-31],
            ["a.u. of time", "?/Eh", null, "time", false, false, 2.41888432650516e-17],
            ["admiralty knot", "admkn", null, "speed", false, true, 0.514773333],
            ["ampere", "A", null, "electric_current", true, false, 1],
            ["ampere per meter", "A/m", null, "magnetic_field_intensity", true, false, 1],
            ["ångström", "Å", ["ang"], "length", false, true, 1e-10],
            ["are", "ar", null, "area", false, true, 100],
            ["astronomical unit", "ua", null, "length", false, false, 1.49597870691667e-11],
            ["bar", "bar", null, "pressure", false, false, 100000],
            ["barn", "b", null, "area", false, false, 1e-28],
            ["becquerel", "Bq", null, "radioactivity", true, false, 1],
            ["bit", "bit", ["b"], "information", false, true, 1],
            ["btu", "BTU", ["btu"], "energy", false, true, 1055.05585262],
            ["byte", "byte", null, "information", false, true, 8],
            ["candela", "cd", null, "luminous_intensity", true, false, 1],
            ["candela per square metre", "cd/m?", null, "luminance", true, false, 1],
            ["coulomb", "C", null, "electric_charge", true, false, 1],
            ["cubic ångström", "ang3", ["ang^3"], "volume", false, true, 1e-30],
            ["cubic foot", "ft3", ["ft^3"], "volume", false, true, 0.028316846592],
            ["cubic inch", "in3", ["in^3"], "volume", false, true, 0.000016387064],
            ["cubic light-year", "ly3", ["ly^3"], "volume", false, true, 8.46786664623715e-47],
            ["cubic metre", "m?", null, "volume", true, true, 1],
            ["cubic mile", "mi3", ["mi^3"], "volume", false, true, 4168181825.44058],
            ["cubic nautical mile", "Nmi3", ["Nmi^3"], "volume", false, true, 6352182208],
            ["cubic Pica", "Pica3", ["Picapt3", "Pica^3", "Picapt^3"], "volume", false, true, 7.58660370370369e-8],
            ["cubic yard", "yd3", ["yd^3"], "volume", false, true, 0.764554857984],
            ["cup", "cup", null, "volume", false, true, 0.0002365882365],
            ["dalton", "Da", ["u"], "mass", false, false, 1.66053886282828e-27],
            ["day", "d", ["day"], "time", false, true, 86400],
            ["degree", "°", null, "angle", false, false, 0.0174532925199433],
            ["degrees Rankine", "Rank", null, "temperature", false, true, 0.555555555555556],
            ["dyne", "dyn", ["dy"], "force", false, true, 0.00001],
            ["electronvolt", "eV", ["ev"], "energy", false, true, 1.60217656514141],
            ["ell", "ell", null, "length", false, true, 1.143],
            ["erg", "erg", ["e"], "energy", false, true, 1e-7],
            ["farad", "F", null, "electric_capacitance", true, false, 1],
            ["fluid ounce", "oz", null, "volume", false, true, 0.0000295735295625],
            ["foot", "ft", null, "length", false, true, 0.3048],
            ["foot-pound", "flb", null, "energy", false, true, 1.3558179483314],
            ["gal", "Gal", null, "acceleration", false, false, 0.01],
            ["gallon", "gal", null, "volume", false, true, 0.003785411784],
            ["gauss", "G", ["ga"], "magnetic_flux_density", false, true, 1],
            ["grain", "grain", null, "mass", false, true, 0.0000647989],
            ["gram", "g", null, "mass", false, true, 0.001],
            ["gray", "Gy", null, "absorbed_dose", true, false, 1],
            ["gross registered ton", "GRT", ["regton"], "volume", false, true, 2.8316846592],
            ["hectare", "ha", null, "area", false, true, 10000],
            ["henry", "H", null, "inductance", true, false, 1],
            ["hertz", "Hz", null, "frequency", true, false, 1],
            ["horsepower", "HP", ["h"], "power", false, true, 745.69987158227],
            ["horsepower-hour", "HPh", ["hh", "hph"], "energy", false, true, 2684519.538],
            ["hour", "h", ["hr"], "time", false, true, 3600],
            ["imperial gallon (U.K.)", "uk_gal", null, "volume", false, true, 0.00454609],
            ["imperial hundredweight", "lcwt", ["uk_cwt", "hweight"], "mass", false, true, 50.802345],
            ["imperial quart (U.K)", "uk_qt", null, "volume", false, true, 0.0011365225],
            ["imperial ton", "brton", ["uk_ton", "LTON"], "mass", false, true, 1016.046909],
            ["inch", "in", null, "length", false, true, 0.0254],
            ["international acre", "uk_acre", null, "area", false, true, 4046.8564224],
            ["IT calorie", "cal", null, "energy", false, true, 4.1868],
            ["joule", "J", null, "energy", true, true, 1],
            ["katal", "kat", null, "catalytic_activity", true, false, 1],
            ["kelvin", "K", ["kel"], "temperature", true, true, 1],
            ["kilogram", "kg", null, "mass", true, true, 1],
            ["knot", "kn", null, "speed", false, true, 0.514444444444444],
            ["light-year", "ly", null, "length", false, true, 9460730472580800],
            ["litre", "L", ["l", "lt"], "volume", false, true, 0.001],
            ["lumen", "lm", null, "luminous_flux", true, false, 1],
            ["lux", "lx", null, "illuminance", true, false, 1],
            ["maxwell", "Mx", null, "magnetic_flux", false, false, 1e-18],
            ["measurement ton", "MTON", null, "volume", false, true, 1.13267386368],
            ["meter per hour", "m/h", ["m/hr"], "speed", false, true, 0.00027777777777778],
            ["meter per second", "m/s", ["m/sec"], "speed", true, true, 1],
            ["meter per second squared", "m?s??", null, "acceleration", true, false, 1],
            ["parsec", "pc", ["parsec"], "length", false, true, 30856775814671900],
            ["meter squared per second", "m?/s", null, "kinematic_viscosity", true, false, 1],
            ["metre", "m", null, "length", true, true, 1],
            ["miles per hour", "mph", null, "speed", false, true, 0.44704],
            ["millimetre of mercury", "mmHg", null, "pressure", false, false, 133.322],
            ["minute", "?", null, "angle", false, false, 0.000290888208665722],
            ["minute", "min", ["mn"], "time", false, true, 60],
            ["modern teaspoon", "tspm", null, "volume", false, true, 0.000005],
            ["mole", "mol", null, "amount_of_substance", true, false, 1],
            ["morgen", "Morgen", null, "area", false, true, 2500],
            ["n.u. of action", "?", null, "action", false, false, 1.05457168181818e-34],
            ["n.u. of mass", "m?", null, "mass", false, false, 9.10938261616162e-31],
            ["n.u. of speed", "c?", null, "speed", false, false, 299792458],
            ["n.u. of time", "?/(me?c??)", null, "time", false, false, 1.28808866778687e-21],
            ["nautical mile", "M", ["Nmi"], "length", false, true, 1852],
            ["newton", "N", null, "force", true, true, 1],
            ["œrsted", "Oe ", null, "magnetic_field_intensity", false, false, 79.5774715459477],
            ["ohm", "Ω", null, "electric_resistance", true, false, 1],
            ["ounce mass", "ozm", null, "mass", false, true, 0.028349523125],
            ["pascal", "Pa", null, "pressure", true, false, 1],
            ["pascal second", "Pa?s", null, "dynamic_viscosity", true, false, 1],
            ["pferdestärke", "PS", null, "power", false, true, 735.49875],
            ["phot", "ph", null, "illuminance", false, false, 0.0001],
            ["pica (1/6 inch)", "pica", null, "length", false, true, 0.00035277777777778],
            ["pica (1/72 inch)", "Pica", ["Picapt"], "length", false, true, 0.00423333333333333],
            ["poise", "P", null, "dynamic_viscosity", false, false, 0.1],
            ["pond", "pond", null, "force", false, true, 0.00980665],
            ["pound force", "lbf", null, "force", false, true, 4.4482216152605],
            ["pound mass", "lbm", null, "mass", false, true, 0.45359237],
            ["quart", "qt", null, "volume", false, true, 0.000946352946],
            ["radian", "rad", null, "angle", true, false, 1],
            ["second", "?", null, "angle", false, false, 0.00000484813681109536],
            ["second", "s", ["sec"], "time", true, true, 1],
            ["short hundredweight", "cwt", ["shweight"], "mass", false, true, 45.359237],
            ["siemens", "S", null, "electrical_conductance", true, false, 1],
            ["sievert", "Sv", null, "equivalent_dose", true, false, 1],
            ["slug", "sg", null, "mass", false, true, 14.59390294],
            ["square ångström", "ang2", ["ang^2"], "area", false, true, 1e-20],
            ["square foot", "ft2", ["ft^2"], "area", false, true, 0.09290304],
            ["square inch", "in2", ["in^2"], "area", false, true, 0.00064516],
            ["square light-year", "ly2", ["ly^2"], "area", false, true, 8.95054210748189e+31],
            ["square meter", "m?", null, "area", true, true, 1],
            ["square mile", "mi2", ["mi^2"], "area", false, true, 2589988.110336],
            ["square nautical mile", "Nmi2", ["Nmi^2"], "area", false, true, 3429904],
            ["square Pica", "Pica2", ["Picapt2", "Pica^2", "Picapt^2"], "area", false, true, 0.00001792111111111],
            ["square yard", "yd2", ["yd^2"], "area", false, true, 0.83612736],
            ["statute mile", "mi", null, "length", false, true, 1609.344],
            ["steradian", "sr", null, "solid_angle", true, false, 1],
            ["stilb", "sb", null, "luminance", false, false, 0.0001],
            ["stokes", "St", null, "kinematic_viscosity", false, false, 0.0001],
            ["stone", "stone", null, "mass", false, true, 6.35029318],
            ["tablespoon", "tbs", null, "volume", false, true, 0.0000147868],
            ["teaspoon", "tsp", null, "volume", false, true, 0.00000492892],
            ["tesla", "T", null, "magnetic_flux_density", true, true, 1],
            ["thermodynamic calorie", "c", null, "energy", false, true, 4.184],
            ["ton", "ton", null, "mass", false, true, 907.18474],
            ["tonne", "t", null, "mass", false, false, 1000],
            ["U.K. pint", "uk_pt", null, "volume", false, true, 0.00056826125],
            ["U.S. bushel", "bushel", null, "volume", false, true, 0.03523907],
            ["U.S. oil barrel", "barrel", null, "volume", false, true, 0.158987295],
            ["U.S. pint", "pt", ["us_pt"], "volume", false, true, 0.000473176473],
            ["U.S. survey mile", "survey_mi", null, "length", false, true, 1609.347219],
            ["U.S. survey/statute acre", "us_acre", null, "area", false, true, 4046.87261],
            ["volt", "V", null, "voltage", true, false, 1],
            ["watt", "W", null, "power", true, true, 1],
            ["watt-hour", "Wh", ["wh"], "energy", false, true, 3600],
            ["weber", "Wb", null, "magnetic_flux", true, false, 1],
            ["yard", "yd", null, "length", false, true, 0.9144],
            ["year", "yr", null, "time", false, true, 31557600]
        ];

        // Binary prefixes
        // [Name, Prefix power of 2 value, Previx value, Abbreviation, Derived
        // from]
        var binary_prefixes = {
            Yi: ["yobi", 80, 1208925819614629174706176, "Yi", "yotta"],
            Zi: ["zebi", 70, 1180591620717411303424, "Zi", "zetta"],
            Ei: ["exbi", 60, 1152921504606846976, "Ei", "exa"],
            Pi: ["pebi", 50, 1125899906842624, "Pi", "peta"],
            Ti: ["tebi", 40, 1099511627776, "Ti", "tera"],
            Gi: ["gibi", 30, 1073741824, "Gi", "giga"],
            Mi: ["mebi", 20, 1048576, "Mi", "mega"],
            ki: ["kibi", 10, 1024, "ki", "kilo"]
        };

        // Unit prefixes
        // [Name, Multiplier, Abbreviation]
        var unit_prefixes = {
            Y: ["yotta", 1e+24, "Y"],
            Z: ["zetta", 1e+21, "Z"],
            E: ["exa", 1e+18, "E"],
            P: ["peta", 1e+15, "P"],
            T: ["tera", 1e+12, "T"],
            G: ["giga", 1e+09, "G"],
            M: ["mega", 1e+06, "M"],
            k: ["kilo", 1e+03, "k"],
            h: ["hecto", 1e+02, "h"],
            e: ["dekao", 1e+01, "e"],
            d: ["deci", 1e-01, "d"],
            c: ["centi", 1e-02, "c"],
            m: ["milli", 1e-03, "m"],
            u: ["micro", 1e-06, "u"],
            n: ["nano", 1e-09, "n"],
            p: ["pico", 1e-12, "p"],
            f: ["femto", 1e-15, "f"],
            a: ["atto", 1e-18, "a"],
            z: ["zepto", 1e-21, "z"],
            y: ["yocto", 1e-24, "y"]
        };

        // Initialize units and multipliers
        var from = null;
        var to = null;
        var base_from_unit = from_unit;
        var base_to_unit = to_unit;
        var from_multiplier = 1;
        var to_multiplier = 1;
        var alt;

        // Lookup from and to units
        for (var i = 0; i < units.length; i++) {
            alt = (units[i][2] === null) ? [] : units[i][2];
            if (units[i][1] === base_from_unit || alt.indexOf(base_from_unit) >= 0) {
              from = units[i];
            }
            if (units[i][1] === base_to_unit || alt.indexOf(base_to_unit) >= 0) {
              to = units[i];
            }
        }

        // Lookup from prefix
        if (from === null) {
            var from_binary_prefix = binary_prefixes[from_unit.substring(0, 2)];
            var from_unit_prefix = unit_prefixes[from_unit.substring(0, 1)];

            // Handle dekao unit prefix (only unit prefix with two characters)
            if (from_unit.substring(0, 2) === 'da') {
              from_unit_prefix = ["dekao", 1e+01, "da"];
            }

            // Handle binary prefixes first (so that 'Yi' is processed before
            // 'Y')
            if (from_binary_prefix) {
              from_multiplier = from_binary_prefix[2];
              base_from_unit = from_unit.substring(2);
            } else if (from_unit_prefix) {
              from_multiplier = from_unit_prefix[1];
              base_from_unit = from_unit.substring(from_unit_prefix[2].length);
            }

            // Lookup from unit
            for (var j = 0; j < units.length; j++) {
              alt = (units[j][2] === null) ? [] : units[j][2];
              if (units[j][1] === base_from_unit || alt.indexOf(base_from_unit) >= 0) {
                  from = units[j];
              }
            }
        }

        // Lookup to prefix
        if (to === null) {
            var to_binary_prefix = binary_prefixes[to_unit.substring(0, 2)];
            var to_unit_prefix = unit_prefixes[to_unit.substring(0, 1)];

            // Handle dekao unit prefix (only unit prefix with two characters)
            if (to_unit.substring(0, 2) === 'da') {
              to_unit_prefix = ["dekao", 1e+01, "da"];
            }

            // Handle binary prefixes first (so that 'Yi' is processed before
            // 'Y')
            if (to_binary_prefix) {
              to_multiplier = to_binary_prefix[2];
              base_to_unit = to_unit.substring(2);
            } else if (to_unit_prefix) {
              to_multiplier = to_unit_prefix[1];
              base_to_unit = to_unit.substring(to_unit_prefix[2].length);
            }

            // Lookup to unit
            for (var k = 0; k < units.length; k++) {
              alt = (units[k][2] === null) ? [] : units[k][2];
              if (units[k][1] === base_to_unit || alt.indexOf(base_to_unit) >= 0) {
                  to = units[k];
              }
            }
        }

        // Return error if a unit does not exist
        if (from === null || to === null) {
            return error.na;
        }

        // Return error if units represent different quantities
        if (from[3] !== to[3]) {
            return error.na;
        }

        // Return converted number
        return number * from[6] * from_multiplier / (to[6] * to_multiplier);
    };

    exports.DEC2BIN = function(number, places) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }

        // Return error if number is not decimal, is lower than -512, or is
        // greater than 511
        if (!/^-?[0-9]{1,3}$/.test(number) || number < -512 || number > 511) {
            return error.num;
        }

        // Ignore places and return a 10-character binary number if number is
        // negative
        if (number < 0) {
            return '1' + REPT('0', 9 - (512 + number).toString(2).length) + (512 + number).toString(2);
        }

        // Convert decimal number to binary
        var result = parseInt(number, 10).toString(2);

        // Return binary number using the minimum number of characters necessary
        // if places is undefined
        if (typeof places === 'undefined') {
            return result;
        } else {
            // Return error if places is nonnumeric
            if (isNaN(places)) {
              return error.value;
            }

            // Return error if places is negative
            if (places < 0) {
              return error.num;
            }

            // Truncate places in case it is not an integer
            places = Math.floor(places);

            // Pad return value with leading 0s (zeros) if necessary (using
            // Underscore.string)
            return (places >= result.length) ? REPT('0', places - result.length) + result : error.num;
        }
    };

    exports.DEC2HEX = function(number, places) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }

        // Return error if number is not decimal, is lower than -549755813888,
        // or is greater than 549755813887
        if (!/^-?[0-9]{1,12}$/.test(number) || number < -549755813888 || number > 549755813887) {
            return error.num;
        }

        // Ignore places and return a 10-character hexadecimal number if number
        // is negative
        if (number < 0) {
            return (1099511627776 + number).toString(16);
        }

        // Convert decimal number to hexadecimal
        var result = parseInt(number, 10).toString(16);

        // Return hexadecimal number using the minimum number of characters
        // necessary if places is undefined
        if (typeof places === 'undefined') {
            return result;
        } else {
            // Return error if places is nonnumeric
            if (isNaN(places)) {
              return error.value;
            }

            // Return error if places is negative
            if (places < 0) {
              return error.num;
            }

            // Truncate places in case it is not an integer
            places = Math.floor(places);

            // Pad return value with leading 0s (zeros) if necessary (using
            // Underscore.string)
            return (places >= result.length) ? REPT('0', places - result.length) + result : error.num;
        }
    };

    exports.DEC2OCT = function(number, places) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }

        // Return error if number is not decimal, is lower than -549755813888,
        // or is greater than 549755813887
        if (!/^-?[0-9]{1,9}$/.test(number) || number < -536870912 || number > 536870911) {
            return error.num;
        }

        // Ignore places and return a 10-character octal number if number is
        // negative
        if (number < 0) {
            return (1073741824 + number).toString(8);
        }

        // Convert decimal number to octal
        var result = parseInt(number, 10).toString(8);

        // Return octal number using the minimum number of characters necessary
        // if places is undefined
        if (typeof places === 'undefined') {
            return result;
        } else {
            // Return error if places is nonnumeric
            if (isNaN(places)) {
              return error.value;
            }

            // Return error if places is negative
            if (places < 0) {
              return error.num;
            }

            // Truncate places in case it is not an integer
            places = Math.floor(places);

            // Pad return value with leading 0s (zeros) if necessary (using
            // Underscore.string)
            return (places >= result.length) ? REPT('0', places - result.length) + result : error.num;
        }
    };

    exports.DELTA = function(number1, number2) {
        // Set number2 to zero if undefined
        number2 = (number2 === undefined) ? 0 : number2;
        number1 = utils.parseNumber(number1);
        number2 = utils.parseNumber(number2);
        if (utils.anyIsError(number1, number2)) {
            return error.value;
        }

        // Return delta
        return (number1 === number2) ? 1 : 0;
    };

    exports.ERF = function(lower_bound, upper_bound) {
    };

    exports.ERF.PRECISE = function() {
    };

    exports.ERFC = function(x) {
    };

    exports.ERFC.PRECISE = function() {
    };

    exports.GESTEP = function(number, step) {
        step = step || 0;
        number = utils.parseNumber(number);
        if (utils.anyIsError(step, number)) {
            return number;
        }

        // Return delta
        return (number >= step) ? 1 : 0;
    };

    exports.HEX2BIN = function(number, places) {
        // Return error if number is not hexadecimal or contains more than ten
        // characters (10 digits)
        if (!/^[0-9A-Fa-f]{1,10}$/.test(number)) {
            return error.num;
        }

        // Check if number is negative
        var negative = (number.length === 10 && number.substring(0, 1).toLowerCase() === 'f') ? true : false;

        // Convert hexadecimal number to decimal
        var decimal = (negative) ? parseInt(number, 16) - 1099511627776 : parseInt(number, 16);

        // Return error if number is lower than -512 or greater than 511
        if (decimal < -512 || decimal > 511) {
            return error.num;
        }

        // Ignore places and return a 10-character binary number if number is
        // negative
        if (negative) {
            return '1' + REPT('0', 9 - (512 + decimal).toString(2).length) + (512 + decimal).toString(2);
        }

        // Convert decimal number to binary
        var result = decimal.toString(2);

        // Return binary number using the minimum number of characters necessary
        // if places is undefined
        if (places === undefined) {
            return result;
        } else {
            // Return error if places is nonnumeric
            if (isNaN(places)) {
              return error.value;
            }

            // Return error if places is negative
            if (places < 0) {
              return error.num;
            }

            // Truncate places in case it is not an integer
            places = Math.floor(places);

            // Pad return value with leading 0s (zeros) if necessary (using
            // Underscore.string)
            return (places >= result.length) ? REPT('0', places - result.length) + result : error.num;
        }
    };

    exports.HEX2DEC = function(number) {
        // Return error if number is not hexadecimal or contains more than ten
        // characters (10 digits)
        if (!/^[0-9A-Fa-f]{1,10}$/.test(number)) {
            return error.num;
        }

        // Convert hexadecimal number to decimal
        var decimal = parseInt(number, 16);

        // Return decimal number
        return (decimal >= 549755813888) ? decimal - 1099511627776 : decimal;
    };

    exports.HEX2OCT = function(number, places) {
        // Return error if number is not hexadecimal or contains more than ten
        // characters (10 digits)
        if (!/^[0-9A-Fa-f]{1,10}$/.test(number)) {
            return error.num;
        }

        // Convert hexadecimal number to decimal
        var decimal = parseInt(number, 16);

        // Return error if number is positive and greater than 0x1fffffff
        // (536870911)
        if (decimal > 536870911 && decimal < 1098974756864) {
            return error.num;
        }

        // Ignore places and return a 10-character octal number if number is
        // negative
        if (decimal >= 1098974756864) {
            return (decimal - 1098437885952).toString(8);
        }

        // Convert decimal number to octal
        var result = decimal.toString(8);

        // Return octal number using the minimum number of characters necessary
        // if places is undefined
        if (places === undefined) {
            return result;
        } else {
            // Return error if places is nonnumeric
            if (isNaN(places)) {
              return error.value;
            }

            // Return error if places is negative
            if (places < 0) {
              return error.num;
            }

            // Truncate places in case it is not an integer
            places = Math.floor(places);

            // Pad return value with leading 0s (zeros) if necessary (using
            // Underscore.string)
            return (places >= result.length) ? REPT('0', places - result.length) + result : error.num;
        }
    };

    exports.IMABS = function(inumber) {
        // Lookup real and imaginary coefficients using exports.js
        // [http://formulajs.org]
        var x = exports.IMREAL(inumber);
        var y = exports.IMAGINARY(inumber);

        // Return error if either coefficient is not a number
        if (utils.anyIsError(x, y)) {
            return error.value;
        }

        // Return absolute value of complex number
        return Math.sqrt(Math.pow(x, 2) + Math.pow(y, 2));
    };

    exports.IMAGINARY = function(inumber) {
        if (inumber === undefined || inumber === true || inumber === false) {
            return error.value;
        }

        // Return 0 if inumber is equal to 0
        if (inumber === 0 || inumber === '0') {
            return 0;
        }

        // Handle special cases
        if (['i', 'j'].indexOf(inumber) >= 0) {
            return 1;
        }

        // Normalize imaginary coefficient
        inumber = inumber.replace('+i', '+1i').replace('-i', '-1i').replace('+j', '+1j').replace('-j', '-1j');

        // Lookup sign
        var plus = inumber.indexOf('+');
        var minus = inumber.indexOf('-');
        if (plus === 0) {
            plus = inumber.indexOf('+', 1);
        }

        if (minus === 0) {
            minus = inumber.indexOf('-', 1);
        }

        // Lookup imaginary unit
        var last = inumber.substring(inumber.length - 1, inumber.length);
        var unit = (last === 'i' || last === 'j');

        if (plus >= 0 || minus >= 0) {
            // Return error if imaginary unit is neither i nor j
            if (!unit) {
              return error.num;
            }

            // Return imaginary coefficient of complex number
            if (plus >= 0) {
              return (isNaN(inumber.substring(0, plus)) || isNaN(inumber.substring(plus + 1, inumber.length - 1))) ?
                  error.num :
                  Number(inumber.substring(plus + 1, inumber.length - 1));
            } else {
              return (isNaN(inumber.substring(0, minus)) || isNaN(inumber.substring(minus + 1, inumber.length - 1))) ?
                  error.num :
                  -Number(inumber.substring(minus + 1, inumber.length - 1));
            }
        } else {
            if (unit) {
              return (isNaN(inumber.substring(0, inumber.length - 1))) ? error.num : inumber.substring(0, inumber.length - 1);
            } else {
              return (isNaN(inumber)) ? error.num : 0;
            }
        }
    };

    exports.IMARGUMENT = function(inumber) {
        // Lookup real and imaginary coefficients using exports.js
        // [http://formulajs.org]
        var x = exports.IMREAL(inumber);
        var y = exports.IMAGINARY(inumber);

        // Return error if either coefficient is not a number
        if (utils.anyIsError(x, y)) {
            return error.value;
        }

        // Return error if inumber is equal to zero
        if (x === 0 && y === 0) {
            return error.div0;
        }

        // Return PI/2 if x is equal to zero and y is positive
        if (x === 0 && y > 0) {
            return Math.PI / 2;
        }

        // Return -PI/2 if x is equal to zero and y is negative
        if (x === 0 && y < 0) {
            return -Math.PI / 2;
        }

        // Return zero if x is negative and y is equal to zero
        if (y === 0 && x > 0) {
            return 0;
        }

        // Return zero if x is negative and y is equal to zero
        if (y === 0 && x < 0) {
            return -Math.PI;
        }

        // Return argument of complex number
        if (x > 0) {
            return Math.atan(y / x);
        } else if (x < 0 && y >= 0) {
            return Math.atan(y / x) + Math.PI;
        } else {
            return Math.atan(y / x) - Math.PI;
        }
    };

    exports.IMCONJUGATE = function(inumber) {
        // Lookup real and imaginary coefficients using exports.js
        // [http://formulajs.org]
        var x = exports.IMREAL(inumber);
        var y = exports.IMAGINARY(inumber);

        if (utils.anyIsError(x, y)) {
            return error.value;
        }

        // Lookup imaginary unit
        var unit = inumber.substring(inumber.length - 1);
        unit = (unit === 'i' || unit === 'j') ? unit : 'i';

        // Return conjugate of complex number
        return (y !== 0) ? exports.COMPLEX(x, -y, unit) : inumber;
    };

    exports.IMCOS = function(inumber) {
        // Lookup real and imaginary coefficients using exports.js
        // [http://formulajs.org]
        var x = exports.IMREAL(inumber);
        var y = exports.IMAGINARY(inumber);

        if (utils.anyIsError(x, y)) {
            return error.value;
        }

        // Lookup imaginary unit
        var unit = inumber.substring(inumber.length - 1);
        unit = (unit === 'i' || unit === 'j') ? unit : 'i';

        // Return cosine of complex number
        return exports.COMPLEX(Math.cos(x) * (Math.exp(y) + Math.exp(-y)) / 2, -Math.sin(x) * (Math.exp(y) - Math.exp(-y)) / 2, unit);
    };

    exports.IMCOSH = function(inumber) {
        // Lookup real and imaginary coefficients using exports.js
        // [http://formulajs.org]
        var x = exports.IMREAL(inumber);
        var y = exports.IMAGINARY(inumber);

        if (utils.anyIsError(x, y)) {
            return error.value;
        }

        // Lookup imaginary unit
        var unit = inumber.substring(inumber.length - 1);
        unit = (unit === 'i' || unit === 'j') ? unit : 'i';

        // Return hyperbolic cosine of complex number
        return exports.COMPLEX(Math.cos(y) * (Math.exp(x) + Math.exp(-x)) / 2, Math.sin(y) * (Math.exp(x) - Math.exp(-x)) / 2, unit);
    };

    exports.IMCOT = function(inumber) {
        // Lookup real and imaginary coefficients using Formula.js
        // [http://formulajs.org]
        var x = exports.IMREAL(inumber);
        var y = exports.IMAGINARY(inumber);

        if (utils.anyIsError(x, y)) {
            return error.value;
        }

        // Return cotangent of complex number
        return exports.IMDIV(exports.IMCOS(inumber), exports.IMSIN(inumber));
    };

    exports.IMDIV = function(inumber1, inumber2) {
        // Lookup real and imaginary coefficients using Formula.js
        // [http://formulajs.org]
        var a = exports.IMREAL(inumber1);
        var b = exports.IMAGINARY(inumber1);
        var c = exports.IMREAL(inumber2);
        var d = exports.IMAGINARY(inumber2);

        if (utils.anyIsError(a, b, c, d)) {
            return error.value;
        }

        // Lookup imaginary unit
        var unit1 = inumber1.substring(inumber1.length - 1);
        var unit2 = inumber2.substring(inumber2.length - 1);
        var unit = 'i';
        if (unit1 === 'j') {
            unit = 'j';
        } else if (unit2 === 'j') {
            unit = 'j';
        }

        // Return error if inumber2 is null
        if (c === 0 && d === 0) {
            return error.num;
        }

        // Return exponential of complex number
        var den = c * c + d * d;
        return exports.COMPLEX((a * c + b * d) / den, (b * c - a * d) / den, unit);
    };

    exports.IMEXP = function(inumber) {
        // Lookup real and imaginary coefficients using Formula.js
        // [http://formulajs.org]
        var x = exports.IMREAL(inumber);
        var y = exports.IMAGINARY(inumber);

        if (utils.anyIsError(x, y)) {
            return error.value;
        }

        // Lookup imaginary unit
        var unit = inumber.substring(inumber.length - 1);
        unit = (unit === 'i' || unit === 'j') ? unit : 'i';

        // Return exponential of complex number
        var e = Math.exp(x);
        return exports.COMPLEX(e * Math.cos(y), e * Math.sin(y), unit);
    };

    exports.IMLN = function(inumber) {
        // Lookup real and imaginary coefficients using Formula.js
        // [http://formulajs.org]
        var x = exports.IMREAL(inumber);
        var y = exports.IMAGINARY(inumber);

        if (utils.anyIsError(x, y)) {
            return error.value;
        }

        // Lookup imaginary unit
        var unit = inumber.substring(inumber.length - 1);
        unit = (unit === 'i' || unit === 'j') ? unit : 'i';

        // Return exponential of complex number
        return exports.COMPLEX(Math.log(Math.sqrt(x * x + y * y)), Math.atan(y / x), unit);
    };

    exports.IMLOG10 = function(inumber) {
        // Lookup real and imaginary coefficients using Formula.js
        // [http://formulajs.org]
        var x = exports.IMREAL(inumber);
        var y = exports.IMAGINARY(inumber);

        if (utils.anyIsError(x, y)) {
            return error.value;
        }

        // Lookup imaginary unit
        var unit = inumber.substring(inumber.length - 1);
        unit = (unit === 'i' || unit === 'j') ? unit : 'i';

        // Return exponential of complex number
        return exports.COMPLEX(Math.log(Math.sqrt(x * x + y * y)) / Math.log(10), Math.atan(y / x) / Math.log(10), unit);
    };

    exports.IMLOG2 = function(inumber) {
        // Lookup real and imaginary coefficients using Formula.js
        // [http://formulajs.org]
        var x = exports.IMREAL(inumber);
        var y = exports.IMAGINARY(inumber);

        if (utils.anyIsError(x, y)) {
            return error.value;
        }

        // Lookup imaginary unit
        var unit = inumber.substring(inumber.length - 1);
        unit = (unit === 'i' || unit === 'j') ? unit : 'i';

        // Return exponential of complex number
        return exports.COMPLEX(Math.log(Math.sqrt(x * x + y * y)) / Math.log(2), Math.atan(y / x) / Math.log(2), unit);
    };

    exports.IMPOWER = function(inumber, number) {
        number = utils.parseNumber(number);
        var x = exports.IMREAL(inumber);
        var y = exports.IMAGINARY(inumber);
        if (utils.anyIsError(number, x, y)) {
            return error.value;
        }

        // Lookup imaginary unit
        var unit = inumber.substring(inumber.length - 1);
        unit = (unit === 'i' || unit === 'j') ? unit : 'i';

        // Calculate power of modulus
        var p = Math.pow(exports.IMABS(inumber), number);

        // Calculate argument
        var t = exports.IMARGUMENT(inumber);

        // Return exponential of complex number
        return exports.COMPLEX(p * Math.cos(number * t), p * Math.sin(number * t), unit);
    };

    exports.IMPRODUCT = function() {
        // Initialize result
        var result = arguments[0];

        // Loop on all numbers
        for (var i = 1; i < arguments.length; i++) {
            // Lookup coefficients of two complex numbers
            var a = exports.IMREAL(result);
            var b = exports.IMAGINARY(result);
            var c = exports.IMREAL(arguments[i]);
            var d = exports.IMAGINARY(arguments[i]);

            if (utils.anyIsError(a, b, c, d)) {
              return error.value;
            }

            // Complute product of two complex numbers
            result = exports.COMPLEX(a * c - b * d, a * d + b * c);
        }

        // Return product of complex numbers
        return result;
    };

    exports.IMREAL = function(inumber) {
        if (inumber === undefined || inumber === true || inumber === false) {
            return error.value;
        }

        // Return 0 if inumber is equal to 0
        if (inumber === 0 || inumber === '0') {
            return 0;
        }

        // Handle special cases
        if (['i', '+i', '1i', '+1i', '-i', '-1i', 'j', '+j', '1j', '+1j', '-j', '-1j'].indexOf(inumber) >= 0) {
            return 0;
        }

        // Lookup sign
        var plus = inumber.indexOf('+');
        var minus = inumber.indexOf('-');
        if (plus === 0) {
            plus = inumber.indexOf('+', 1);
        }
        if (minus === 0) {
            minus = inumber.indexOf('-', 1);
        }

        // Lookup imaginary unit
        var last = inumber.substring(inumber.length - 1, inumber.length);
        var unit = (last === 'i' || last === 'j');

        if (plus >= 0 || minus >= 0) {
            // Return error if imaginary unit is neither i nor j
            if (!unit) {
              return error.num;
            }

            // Return real coefficient of complex number
            if (plus >= 0) {
              return (isNaN(inumber.substring(0, plus)) || isNaN(inumber.substring(plus + 1, inumber.length - 1))) ?
                  error.num :
                  Number(inumber.substring(0, plus));
            } else {
              return (isNaN(inumber.substring(0, minus)) || isNaN(inumber.substring(minus + 1, inumber.length - 1))) ?
                  error.num :
                  Number(inumber.substring(0, minus));
            }
        } else {
            if (unit) {
              return (isNaN(inumber.substring(0, inumber.length - 1))) ? error.num : 0;
            } else {
              return (isNaN(inumber)) ? error.num : inumber;
            }
        }
    };

    exports.IMSEC = function(inumber) {
        // Return error if inumber is a logical value
        if (inumber === true || inumber === false) {
            return error.value;
        }

        // Lookup real and imaginary coefficients using Formula.js
        // [http://formulajs.org]
        var x = exports.IMREAL(inumber);
        var y = exports.IMAGINARY(inumber);

        if (utils.anyIsError(x, y)) {
            return error.value;
        }

        // Return secant of complex number
        return exports.IMDIV('1', exports.IMCOS(inumber));
    };

    exports.IMSECH = function(inumber) {
        // Lookup real and imaginary coefficients using Formula.js
        // [http://formulajs.org]
        var x = exports.IMREAL(inumber);
        var y = exports.IMAGINARY(inumber);

        if (utils.anyIsError(x, y)) {
            return error.value;
        }

        // Return hyperbolic secant of complex number
        return exports.IMDIV('1', exports.IMCOSH(inumber));
    };

    exports.IMSIN = function(inumber) {
        // Lookup real and imaginary coefficients using Formula.js
        // [http://formulajs.org]
        var x = exports.IMREAL(inumber);
        var y = exports.IMAGINARY(inumber);

        if (utils.anyIsError(x, y)) {
            return error.value;
        }

        // Lookup imaginary unit
        var unit = inumber.substring(inumber.length - 1);
        unit = (unit === 'i' || unit === 'j') ? unit : 'i';

        // Return sine of complex number
        return exports.COMPLEX(Math.sin(x) * (Math.exp(y) + Math.exp(-y)) / 2, Math.cos(x) * (Math.exp(y) - Math.exp(-y)) / 2, unit);
    };

    exports.IMSINH = function(inumber) {
        // Lookup real and imaginary coefficients using Formula.js
        // [http://formulajs.org]
        var x = exports.IMREAL(inumber);
        var y = exports.IMAGINARY(inumber);

        if (utils.anyIsError(x, y)) {
            return error.value;
        }

        // Lookup imaginary unit
        var unit = inumber.substring(inumber.length - 1);
        unit = (unit === 'i' || unit === 'j') ? unit : 'i';

        // Return hyperbolic sine of complex number
        return exports.COMPLEX(Math.cos(y) * (Math.exp(x) - Math.exp(-x)) / 2, Math.sin(y) * (Math.exp(x) + Math.exp(-x)) / 2, unit);
    };

    exports.IMSQRT = function(inumber) {
        // Lookup real and imaginary coefficients using Formula.js
        // [http://formulajs.org]
        var x = exports.IMREAL(inumber);
        var y = exports.IMAGINARY(inumber);

        if (utils.anyIsError(x, y)) {
            return error.value;
        }

        // Lookup imaginary unit
        var unit = inumber.substring(inumber.length - 1);
        unit = (unit === 'i' || unit === 'j') ? unit : 'i';

        // Calculate power of modulus
        var s = Math.sqrt(exports.IMABS(inumber));

        // Calculate argument
        var t = exports.IMARGUMENT(inumber);

        // Return exponential of complex number
        return exports.COMPLEX(s * Math.cos(t / 2), s * Math.sin(t / 2), unit);
    };

    exports.IMCSC = function (inumber) {
        // Return error if inumber is a logical value
        if (inumber === true || inumber === false) {
            return error.value;
        }

        // Lookup real and imaginary coefficients using Formula.js
        // [http://formulajs.org]
        var x = exports.IMREAL(inumber);
        var y = exports.IMAGINARY(inumber);

        // Return error if either coefficient is not a number
        if (utils.anyIsError(x, y)) {
            return error.num;
        }

        // Return cosecant of complex number
        return exports.IMDIV('1', exports.IMSIN(inumber));
    };

    exports.IMCSCH = function (inumber) {
        // Return error if inumber is a logical value
        if (inumber === true || inumber === false) {
            return error.value;
        }

        // Lookup real and imaginary coefficients using Formula.js
        // [http://formulajs.org]
        var x = exports.IMREAL(inumber);
        var y = exports.IMAGINARY(inumber);

        // Return error if either coefficient is not a number
        if (utils.anyIsError(x, y)) {
            return error.num;
        }

        // Return hyperbolic cosecant of complex number
        return exports.IMDIV('1', exports.IMSINH(inumber));
    };

    exports.IMSUB = function(inumber1, inumber2) {
        // Lookup real and imaginary coefficients using Formula.js
        // [http://formulajs.org]
        var a = this.IMREAL(inumber1);
        var b = this.IMAGINARY(inumber1);
        var c = this.IMREAL(inumber2);
        var d = this.IMAGINARY(inumber2);

        if (utils.anyIsError(a, b, c, d)) {
            return error.value;
        }

        // Lookup imaginary unit
        var unit1 = inumber1.substring(inumber1.length - 1);
        var unit2 = inumber2.substring(inumber2.length - 1);
        var unit = 'i';
        if (unit1 === 'j') {
            unit = 'j';
        } else if (unit2 === 'j') {
            unit = 'j';
        }

        // Return _ of two complex numbers
        return this.COMPLEX(a - c, b - d, unit);
    };

    exports.IMSUM = function() {
        var args = utils.flatten(arguments);

        // Initialize result
        var result = args[0];

        // Loop on all numbers
        for (var i = 1; i < args.length; i++) {
            // Lookup coefficients of two complex numbers
            var a = this.IMREAL(result);
            var b = this.IMAGINARY(result);
            var c = this.IMREAL(args[i]);
            var d = this.IMAGINARY(args[i]);

            if (utils.anyIsError(a, b, c, d)) {
              return error.value;
            }

            // Complute product of two complex numbers
            result = this.COMPLEX(a + c, b + d);
        }

        // Return sum of complex numbers
        return result;
    };

    exports.IMTAN = function(inumber) {
        // Return error if inumber is a logical value
        if (inumber === true || inumber === false) {
            return error.value;
        }

        // Lookup real and imaginary coefficients using Formula.js
        // [http://formulajs.org]
        var x = exports.IMREAL(inumber);
        var y = exports.IMAGINARY(inumber);

        if (utils.anyIsError(x, y)) {
            return error.value;
        }

        // Return tangent of complex number
        return this.IMDIV(this.IMSIN(inumber), this.IMCOS(inumber));
    };

    exports.OCT2BIN = function(number, places) {
        // Return error if number is not hexadecimal or contains more than ten
        // characters (10 digits)
        if (!/^[0-7]{1,10}$/.test(number)) {
            return error.num;
        }

        // Check if number is negative
        var negative = (number.length === 10 && number.substring(0, 1) === '7') ? true : false;

        // Convert octal number to decimal
        var decimal = (negative) ? parseInt(number, 8) - 1073741824 : parseInt(number, 8);

        // Return error if number is lower than -512 or greater than 511
        if (decimal < -512 || decimal > 511) {
            return error.num;
        }

        // Ignore places and return a 10-character binary number if number is
        // negative
        if (negative) {
            return '1' + REPT('0', 9 - (512 + decimal).toString(2).length) + (512 + decimal).toString(2);
        }

        // Convert decimal number to binary
        var result = decimal.toString(2);

        // Return binary number using the minimum number of characters necessary
        // if places is undefined
        if (typeof places === 'undefined') {
            return result;
        } else {
            // Return error if places is nonnumeric
            if (isNaN(places)) {
              return error.value;
            }

            // Return error if places is negative
            if (places < 0) {
              return error.num;
            }

            // Truncate places in case it is not an integer
            places = Math.floor(places);

            // Pad return value with leading 0s (zeros) if necessary (using
            // Underscore.string)
            return (places >= result.length) ? REPT('0', places - result.length) + result : error.num;
        }
    };

    exports.OCT2DEC = function(number) {
        // Return error if number is not octal or contains more than ten
        // characters (10 digits)
        if (!/^[0-7]{1,10}$/.test(number)) {
            return error.num;
        }

        // Convert octal number to decimal
        var decimal = parseInt(number, 8);

        // Return decimal number
        return (decimal >= 536870912) ? decimal - 1073741824 : decimal;
    };

    exports.OCT2HEX = function(number, places) {
        // Return error if number is not octal or contains more than ten
        // characters (10 digits)
        if (!/^[0-7]{1,10}$/.test(number)) {
            return error.num;
        }

        // Convert octal number to decimal
        var decimal = parseInt(number, 8);

        // Ignore places and return a 10-character octal number if number is
        // negative
        if (decimal >= 536870912) {
            return 'ff' + (decimal + 3221225472).toString(16);
        }

        // Convert decimal number to hexadecimal
        var result = decimal.toString(16);

        // Return hexadecimal number using the minimum number of characters
        // necessary if places is undefined
        if (places === undefined) {
            return result;
        } else {
            // Return error if places is nonnumeric
            if (isNaN(places)) {
              return error.value;
            }

            // Return error if places is negative
            if (places < 0) {
              return error.num;
            }

            // Truncate places in case it is not an integer
            places = Math.floor(places);

            // Pad return value with leading 0s (zeros) if necessary (using
            // Underscore.string)
            return (places >= result.length) ? REPT('0', places - result.length) + result : error.num;
        }
    };

    return exports;
})();

jexcel.methods.financial = (function() {
    var exports = {};

    function validDate(d) {
        return d && d.getTime && !isNaN(d.getTime());
    }

    function ensureDate(d) {
        return (d instanceof Date)?d:new Date(d);
    }

    exports.ACCRINT = function(issue, first, settlement, rate, par, frequency, basis) {
        // Return error if either date is invalid
        issue        = ensureDate(issue);
        first        = ensureDate(first);
        settlement = ensureDate(settlement);
        if (!validDate(issue) || !validDate(first) || !validDate(settlement)) {
            return '#VALUE!';
        }

        // Return error if either rate or par are lower than or equal to zero
        if (rate <= 0 || par <= 0) {
            return '#NUM!';
        }

        // Return error if frequency is neither 1, 2, or 4
        if ([1, 2, 4].indexOf(frequency) === -1) {
            return '#NUM!';
        }

        // Return error if basis is neither 0, 1, 2, 3, or 4
        if ([0, 1, 2, 3, 4].indexOf(basis) === -1) {
            return '#NUM!';
        }

        // Return error if settlement is before or equal to issue
        if (settlement <= issue) {
            return '#NUM!';
        }

        // Set default values
        par   = par   || 0;
        basis = basis || 0;

        // Compute accrued interest
        return par * rate * YEARFRAC(issue, settlement, basis);
    };

    exports.ACCRINTM = null;

    exports.AMORDEGRC = null;

    exports.AMORLINC = null;

    exports.COUPDAYBS = null;

    exports.COUPDAYS = null;

    exports.COUPDAYSNC = null;

    exports.COUPNCD = null;

    exports.COUPNUM = null;

    exports.COUPPCD = null;

    exports.CUMIPMT = function(rate, periods, value, start, end, type) {
        // Credits: algorithm inspired by Apache OpenOffice
        // Credits: Hannes Stiebitzhofer for the translations of function and
            // variable names
        // Requires exports.FV() and exports.PMT() from exports.js
            // [http://stoic.com/exports/]

        rate = utils.parseNumber(rate);
        periods = utils.parseNumber(periods);
        value = utils.parseNumber(value);
        if (utils.anyIsError(rate, periods, value)) {
            return error.value;
        }

        // Return error if either rate, periods, or value are lower than or
            // equal to zero
        if (rate <= 0 || periods <= 0 || value <= 0) {
            return error.num;
        }

        // Return error if start < 1, end < 1, or start > end
        if (start < 1 || end < 1 || start > end) {
            return error.num;
        }

        // Return error if type is neither 0 nor 1
        if (type !== 0 && type !== 1) {
            return error.num;
        }

        // Compute cumulative interest
        var payment = exports.PMT(rate, periods, value, 0, type);
        var interest = 0;

        if (start === 1) {
            if (type === 0) {
                interest = -value;
                start++;
            }
        }

        for (var i = start; i <= end; i++) {
            if (type === 1) {
                interest += exports.FV(rate, i - 2, payment, value, 1) - payment;
            } else {
                interest += exports.FV(rate, i - 1, payment, value, 0);
            }
        }
        interest *= rate;

        // Return cumulative interest
        return interest;
    };

    exports.CUMPRINC = function(rate, periods, value, start, end, type) {
        // Credits: algorithm inspired by Apache OpenOffice
        // Credits: Hannes Stiebitzhofer for the translations of function and
            // variable names

        rate = utils.parseNumber(rate);
        periods = utils.parseNumber(periods);
        value = utils.parseNumber(value);
        if (utils.anyIsError(rate, periods, value)) {
            return error.value;
        }

        // Return error if either rate, periods, or value are lower than or
            // equal to zero
        if (rate <= 0 || periods <= 0 || value <= 0) {
            return error.num;
        }

        // Return error if start < 1, end < 1, or start > end
        if (start < 1 || end < 1 || start > end) {
            return error.num;
        }

        // Return error if type is neither 0 nor 1
        if (type !== 0 && type !== 1) {
            return error.num;
        }

        // Compute cumulative principal
        var payment = exports.PMT(rate, periods, value, 0, type);
        var principal = 0;
        if (start === 1) {
            if (type === 0) {
                principal = payment + value * rate;
            } else {
                principal = payment;
            }
            start++;
        }
        for (var i = start; i <= end; i++) {
            if (type > 0) {
                principal += payment - (exports.FV(rate, i - 2, payment, value, 1) - payment) * rate;
            } else {
                principal += payment - exports.FV(rate, i - 1, payment, value, 0) * rate;
            }
        }

        // Return cumulative principal
        return principal;
    };

    exports.DB = function(cost, salvage, life, period, month) {
        // Initialize month
        month = (month === undefined) ? 12 : month;

        cost = utils.parseNumber(cost);
        salvage = utils.parseNumber(salvage);
        life = utils.parseNumber(life);
        period = utils.parseNumber(period);
        month = utils.parseNumber(month);
        if (utils.anyIsError(cost, salvage, life, period, month)) {
            return error.value;
        }

        // Return error if any of the parameters is negative
        if (cost < 0 || salvage < 0 || life < 0 || period < 0) {
            return error.num;
        }

        // Return error if month is not an integer between 1 and 12
        if ([1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12].indexOf(month) === -1) {
            return error.num;
        }

        // Return error if period is greater than life
        if (period > life) {
            return error.num;
        }

        // Return 0 (zero) if salvage is greater than or equal to cost
        if (salvage >= cost) {
            return 0;
        }

        // Rate is rounded to three decimals places
        var rate = (1 - Math.pow(salvage / cost, 1 / life)).toFixed(3);

        // Compute initial depreciation
        var initial = cost * rate * month / 12;

        // Compute total depreciation
        var total = initial;
        var current = 0;
        var ceiling = (period === life) ? life - 1 : period;
        for (var i = 2; i <= ceiling; i++) {
            current = (cost - total) * rate;
            total += current;
        }

        // Depreciation for the first and last periods are special cases
        if (period === 1) {
            // First period
            return initial;
        } else if (period === life) {
            // Last period
            return (cost - total) * rate;
        } else {
            return current;
        }
    };

    exports.DDB = function(cost, salvage, life, period, factor) {
        // Initialize factor
        factor = (factor === undefined) ? 2 : factor;

        cost = utils.parseNumber(cost);
        salvage = utils.parseNumber(salvage);
        life = utils.parseNumber(life);
        period = utils.parseNumber(period);
        factor = utils.parseNumber(factor);
        if (utils.anyIsError(cost, salvage, life, period, factor)) {
            return error.value;
        }

        // Return error if any of the parameters is negative or if factor is
            // null
        if (cost < 0 || salvage < 0 || life < 0 || period < 0 || factor <= 0) {
            return error.num;
        }

        // Return error if period is greater than life
        if (period > life) {
            return error.num;
        }

        // Return 0 (zero) if salvage is greater than or equal to cost
        if (salvage >= cost) {
            return 0;
        }

        // Compute depreciation
        var total = 0;
        var current = 0;
        for (var i = 1; i <= period; i++) {
            current = Math.min((cost - total) * (factor / life), (cost - salvage - total));
            total += current;
        }

        // Return depreciation
        return current;
    };

    exports.DISC = null;

    exports.DOLLARDE = function(dollar, fraction) {
        // Credits: algorithm inspired by Apache OpenOffice

        dollar = utils.parseNumber(dollar);
        fraction = utils.parseNumber(fraction);
        if (utils.anyIsError(dollar, fraction)) {
            return error.value;
        }

        // Return error if fraction is negative
        if (fraction < 0) {
            return error.num;
        }

        // Return error if fraction is greater than or equal to 0 and less than
            // 1
        if (fraction >= 0 && fraction < 1) {
            return error.div0;
        }

        // Truncate fraction if it is not an integer
        fraction = parseInt(fraction, 10);

        // Compute integer part
        var result = parseInt(dollar, 10);

        // Add decimal part
        result += (dollar % 1) * Math.pow(10, Math.ceil(Math.log(fraction) / Math.LN10)) / fraction;

        // Round result
        var power = Math.pow(10, Math.ceil(Math.log(fraction) / Math.LN2) + 1);
        result = Math.round(result * power) / power;

        // Return converted dollar price
        return result;
    };

    exports.DOLLARFR = function(dollar, fraction) {
        // Credits: algorithm inspired by Apache OpenOffice

        dollar = utils.parseNumber(dollar);
        fraction = utils.parseNumber(fraction);
        if (utils.anyIsError(dollar, fraction)) {
            return error.value;
        }

        // Return error if fraction is negative
        if (fraction < 0) {
            return error.num;
        }

        // Return error if fraction is greater than or equal to 0 and less than
            // 1
        if (fraction >= 0 && fraction < 1) {
            return error.div0;
        }

        // Truncate fraction if it is not an integer
        fraction = parseInt(fraction, 10);

        // Compute integer part
        var result = parseInt(dollar, 10);

        // Add decimal part
        result += (dollar % 1) * Math.pow(10, -Math.ceil(Math.log(fraction) / Math.LN10)) * fraction;

        // Return converted dollar price
        return result;
    };

    exports.DURATION = null;

    exports.EFFECT = function(rate, periods) {
        rate = utils.parseNumber(rate);
        periods = utils.parseNumber(periods);
        if (utils.anyIsError(rate, periods)) {
            return error.value;
        }

        // Return error if rate <=0 or periods < 1
        if (rate <= 0 || periods < 1) {
            return error.num;
        }

        // Truncate periods if it is not an integer
        periods = parseInt(periods, 10);

        // Return effective annual interest rate
        return Math.pow(1 + rate / periods, periods) - 1;
    };

    exports.FV = function(rate, periods, payment, value, type) {
        // Credits: algorithm inspired by Apache OpenOffice

        value = value || 0;
        type = type || 0;

        rate = utils.parseNumber(rate);
        periods = utils.parseNumber(periods);
        payment = utils.parseNumber(payment);
        value = utils.parseNumber(value);
        type = utils.parseNumber(type);
        if (utils.anyIsError(rate, periods, payment, value, type)) {
            return error.value;
        }

        // Return future value
        var result;
        if (rate === 0) {
            result = value + payment * periods;
        } else {
            var term = Math.pow(1 + rate, periods);
            if (type === 1) {
                result = value * term + payment * (1 + rate) * (term - 1) / rate;
            } else {
                result = value * term + payment * (term - 1) / rate;
            }
        }
        return -result;
    };

    exports.FVSCHEDULE = function(principal, schedule) {
        principal = utils.parseNumber(principal);
        schedule = utils.parseNumberArray(utils.flatten(schedule));
        if (utils.anyIsError(principal, schedule)) {
            return error.value;
        }

        var n = schedule.length;
        var future = principal;

        // Apply all interests in schedule
        for (var i = 0; i < n; i++) {
            // Apply scheduled interest
            future *= 1 + schedule[i];
        }

        // Return future value
        return future;
    };

    exports.INTRATE = null;

    exports.IPMT = function(rate, period, periods, present, future, type) {
        // Credits: algorithm inspired by Apache OpenOffice

        future = future || 0;
        type = type || 0;

        rate = utils.parseNumber(rate);
        period = utils.parseNumber(period);
        periods = utils.parseNumber(periods);
        present = utils.parseNumber(present);
        future = utils.parseNumber(future);
        type = utils.parseNumber(type);
        if (utils.anyIsError(rate, period, periods, present, future, type)) {
            return error.value;
        }

        // Compute payment
        var payment = exports.PMT(rate, periods, present, future, type);

        // Compute interest
        var interest;
        if (period === 1) {
            if (type === 1) {
                interest = 0;
            } else {
                interest = -present;
            }
        } else {
            if (type === 1) {
                interest = exports.FV(rate, period - 2, payment, present, 1) - payment;
            } else {
                interest = exports.FV(rate, period - 1, payment, present, 0);
            }
        }

        // Return interest
        return interest * rate;
    };

    exports.IRR = function(values, guess) {
        // Credits: algorithm inspired by Apache OpenOffice

        guess = guess || 0;

        values = utils.parseNumberArray(utils.flatten(values));
        guess = utils.parseNumber(guess);
        if (utils.anyIsError(values, guess)) {
            return error.value;
        }

        // Calculates the resulting amount
        var irrResult = function(values, dates, rate) {
            var r = rate + 1;
            var result = values[0];
            for (var i = 1; i < values.length; i++) {
                result += values[i] / Math.pow(r, (dates[i] - dates[0]) / 365);
            }
            return result;
        };

        // Calculates the first derivation
        var irrResultDeriv = function(values, dates, rate) {
            var r = rate + 1;
            var result = 0;
            for (var i = 1; i < values.length; i++) {
                var frac = (dates[i] - dates[0]) / 365;
                result -= frac * values[i] / Math.pow(r, frac + 1);
            }
            return result;
        };

        // Initialize dates and check that values contains at least one positive
            // value and one negative value
        var dates = [];
        var positive = false;
        var negative = false;
        for (var i = 0; i < values.length; i++) {
            dates[i] = (i === 0) ? 0 : dates[i - 1] + 365;
            if (values[i] > 0) {
                positive = true;
            }
            if (values[i] < 0) {
                negative = true;
            }
        }

        // Return error if values does not contain at least one positive value
            // and one negative value
        if (!positive || !negative) {
            return error.num;
        }

        // Initialize guess and resultRate
        guess = (guess === undefined) ? 0.1 : guess;
        var resultRate = guess;

        // Set maximum epsilon for end of iteration
        var epsMax = 1e-10;

        // Implement Newton's method
        var newRate, epsRate, resultValue;
        var contLoop = true;
        do {
            resultValue = irrResult(values, dates, resultRate);
            newRate = resultRate - resultValue / irrResultDeriv(values, dates, resultRate);
            epsRate = Math.abs(newRate - resultRate);
            resultRate = newRate;
            contLoop = (epsRate > epsMax) && (Math.abs(resultValue) > epsMax);
        } while (contLoop);

        // Return internal rate of return
        return resultRate;
    };

    exports.ISPMT = function(rate, period, periods, value) {
        rate = utils.parseNumber(rate);
        period = utils.parseNumber(period);
        periods = utils.parseNumber(periods);
        value = utils.parseNumber(value);
        if (utils.anyIsError(rate, period, periods, value)) {
            return error.value;
        }

        // Return interest
        return value * rate * (period / periods - 1);
    };

    exports.MDURATION = null;

    exports.MIRR = function(values, finance_rate, reinvest_rate) {
        values = utils.parseNumberArray(utils.flatten(values));
        finance_rate = utils.parseNumber(finance_rate);
        reinvest_rate = utils.parseNumber(reinvest_rate);
        if (utils.anyIsError(values, finance_rate, reinvest_rate)) {
            return error.value;
        }

        // Initialize number of values
        var n = values.length;

        // Lookup payments (negative values) and incomes (positive values)
        var payments = [];
        var incomes = [];
        for (var i = 0; i < n; i++) {
            if (values[i] < 0) {
                payments.push(values[i]);
            } else {
                incomes.push(values[i]);
            }
        }

        // Return modified internal rate of return
        var num = -exports.NPV(reinvest_rate, incomes) * Math.pow(1 + reinvest_rate, n - 1);
        var den = exports.NPV(finance_rate, payments) * (1 + finance_rate);
        return Math.pow(num / den, 1 / (n - 1)) - 1;
    };

    exports.NOMINAL = function(rate, periods) {
        rate = utils.parseNumber(rate);
        periods = utils.parseNumber(periods);
        if (utils.anyIsError(rate, periods)) {
            return error.value;
        }

        // Return error if rate <=0 or periods < 1
        if (rate <= 0 || periods < 1) {
            return error.num;
        }

        // Truncate periods if it is not an integer
        periods = parseInt(periods, 10);

        // Return nominal annual interest rate
        return (Math.pow(rate + 1, 1 / periods) - 1) * periods;
    };

    exports.NPER = function(rate, payment, present, future, type) {
        type = (type === undefined) ? 0 : type;
        future = (future === undefined) ? 0 : future;

        rate = utils.parseNumber(rate);
        payment = utils.parseNumber(payment);
        present = utils.parseNumber(present);
        future = utils.parseNumber(future);
        type = utils.parseNumber(type);
        if (utils.anyIsError(rate, payment, present, future, type)) {
            return error.value;
        }

        // Return number of periods
        var num = payment * (1 + rate * type) - future * rate;
        var den = (present * rate + payment * (1 + rate * type));
        return Math.log(num / den) / Math.log(1 + rate);
    };

    exports.NPV = function() {
        var args = utils.parseNumberArray(utils.flatten(arguments));
        if (args instanceof Error) {
            return args;
        }

        // Lookup rate
        var rate = args[0];

        // Initialize net present value
        var value = 0;

        // Loop on all values
        for (var j = 1; j < args.length; j++) {
            value += args[j] / Math.pow(1 + rate, j);
        }

        // Return net present value
        return value;
    };

    exports.ODDFPRICE = null;

    exports.ODDFYIELD = null;

    exports.ODDLPRICE = null;

    exports.ODDLYIELD = null;

    exports.PDURATION = function(rate, present, future) {
        rate = utils.parseNumber(rate);
        present = utils.parseNumber(present);
        future = utils.parseNumber(future);
        if (utils.anyIsError(rate, present, future)) {
            return error.value;
        }

        // Return error if rate <=0
        if (rate <= 0) {
            return error.num;
        }

        // Return number of periods
        return (Math.log(future) - Math.log(present)) / Math.log(1 + rate);
    };

    exports.PMT = function(rate, periods, present, future, type) {
        // Credits: algorithm inspired by Apache OpenOffice

        future = future || 0;
        type = type || 0;

        rate = utils.parseNumber(rate);
        periods = utils.parseNumber(periods);
        present = utils.parseNumber(present);
        future = utils.parseNumber(future);
        type = utils.parseNumber(type);
        if (utils.anyIsError(rate, periods, present, future, type)) {
            return error.value;
        }

        // Return payment
        var result;
        if (rate === 0) {
            result = (present + future) / periods;
        } else {
            var term = Math.pow(1 + rate, periods);
            if (type === 1) {
                result = (future * rate / (term - 1) + present * rate / (1 - 1 / term)) / (1 + rate);
            } else {
                result = future * rate / (term - 1) + present * rate / (1 - 1 / term);
            }
        }
        return -result;
    };

    exports.PPMT = function(rate, period, periods, present, future, type) {
        future = future || 0;
        type = type || 0;

        rate = utils.parseNumber(rate);
        periods = utils.parseNumber(periods);
        present = utils.parseNumber(present);
        future = utils.parseNumber(future);
        type = utils.parseNumber(type);
        if (utils.anyIsError(rate, periods, present, future, type)) {
            return error.value;
        }

        return exports.PMT(rate, periods, present, future, type) - exports.IPMT(rate, period, periods, present, future, type);
    };

    exports.PRICE = null;

    exports.PRICEDISC = null;

    exports.PRICEMAT = null;

    exports.PV = function(rate, periods, payment, future, type) {
        future = future || 0;
        type = type || 0;

        rate = utils.parseNumber(rate);
        periods = utils.parseNumber(periods);
        payment = utils.parseNumber(payment);
        future = utils.parseNumber(future);
        type = utils.parseNumber(type);
        if (utils.anyIsError(rate, periods, payment, future, type)) {
            return error.value;
        }

        // Return present value
        if (rate === 0) {
            return -payment * periods - future;
        } else {
            return (((1 - Math.pow(1 + rate, periods)) / rate) * payment * (1 + rate * type) - future) / Math.pow(1 + rate, periods);
        }
    };

    exports.RATE = function(periods, payment, present, future, type, guess) {
        // Credits: rabugento

        guess = (guess === undefined) ? 0.01 : guess;
        future = (future === undefined) ? 0 : future;
        type = (type === undefined) ? 0 : type;

        periods = utils.parseNumber(periods);
        payment = utils.parseNumber(payment);
        present = utils.parseNumber(present);
        future = utils.parseNumber(future);
        type = utils.parseNumber(type);
        guess = utils.parseNumber(guess);
        if (utils.anyIsError(periods, payment, present, future, type, guess)) {
            return error.value;
        }

        // Set maximum epsilon for end of iteration
        var epsMax = 1e-6;

        // Set maximum number of iterations
        var iterMax = 100;
        var iter = 0;
        var close = false;
        var rate = guess;

        while (iter < iterMax && !close) {
            var t1 = Math.pow(rate + 1, periods);
            var t2 = Math.pow(rate + 1, periods - 1);

            var f1 = future + t1 * present + payment * (t1 - 1) * (rate * type + 1) / rate;
            var f2 = periods * t2 * present - payment * (t1 - 1) *(rate * type + 1) / Math.pow(rate,2);
            var f3 = periods * payment * t2 * (rate * type + 1) / rate + payment * (t1 - 1) * type / rate;

            var newRate = rate - f1 / (f2 + f3);

            if (Math.abs(newRate - rate) < epsMax) close = true;
            iter++
            rate = newRate;
        }

        if (!close) return Number.NaN + rate;
        return rate;
    };

    // TODO
    exports.RECEIVED = null;

    exports.RRI = function(periods, present, future) {
        periods = utils.parseNumber(periods);
        present = utils.parseNumber(present);
        future = utils.parseNumber(future);
        if (utils.anyIsError(periods, present, future)) {
            return error.value;
        }

        // Return error if periods or present is equal to 0 (zero)
        if (periods === 0 || present === 0) {
            return error.num;
        }

        // Return equivalent interest rate
        return Math.pow(future / present, 1 / periods) - 1;
    };

    exports.SLN = function(cost, salvage, life) {
        cost = utils.parseNumber(cost);
        salvage = utils.parseNumber(salvage);
        life = utils.parseNumber(life);
        if (utils.anyIsError(cost, salvage, life)) {
            return error.value;
        }

        // Return error if life equal to 0 (zero)
        if (life === 0) {
            return error.num;
        }

        // Return straight-line depreciation
        return (cost - salvage) / life;
    };

    exports.SYD = function(cost, salvage, life, period) {
        // Return error if any of the parameters is not a number
        cost = utils.parseNumber(cost);
        salvage = utils.parseNumber(salvage);
        life = utils.parseNumber(life);
        period = utils.parseNumber(period);
        if (utils.anyIsError(cost, salvage, life, period)) {
            return error.value;
        }

        // Return error if life equal to 0 (zero)
        if (life === 0) {
            return error.num;
        }

        // Return error if period is lower than 1 or greater than life
        if (period < 1 || period > life) {
            return error.num;
        }

        // Truncate period if it is not an integer
        period = parseInt(period, 10);

        // Return straight-line depreciation
        return ((cost - salvage) * (life - period + 1) * 2) / (life * (life + 1));
    };

    exports.TBILLEQ = function(settlement, maturity, discount) {
        settlement = utils.parseDate(settlement);
        maturity = utils.parseDate(maturity);
        discount = utils.parseNumber(discount);
        if (utils.anyIsError(settlement, maturity, discount)) {
            return error.value;
        }

        // Return error if discount is lower than or equal to zero
        if (discount <= 0) {
            return error.num;
        }

        // Return error if settlement is greater than maturity
        if (settlement > maturity) {
            return error.num;
        }

        // Return error if maturity is more than one year after settlement
        if (maturity - settlement > 365 * 24 * 60 * 60 * 1000) {
            return error.num;
        }

        // Return bond-equivalent yield
        return (365 * discount) / (360 - discount * DAYS360(settlement, maturity, false));
    };

    exports.TBILLPRICE = function(settlement, maturity, discount) {
        settlement = utils.parseDate(settlement);
        maturity = utils.parseDate(maturity);
        discount = utils.parseNumber(discount);
        if (utils.anyIsError(settlement, maturity, discount)) {
            return error.value;
        }

        // Return error if discount is lower than or equal to zero
        if (discount <= 0) {
            return error.num;
        }

        // Return error if settlement is greater than maturity
        if (settlement > maturity) {
            return error.num;
        }

        // Return error if maturity is more than one year after settlement
        if (maturity - settlement > 365 * 24 * 60 * 60 * 1000) {
            return error.num;
        }

        // Return bond-equivalent yield
        return 100 * (1 - discount * DAYS360(settlement, maturity, false) / 360);
    };

    exports.TBILLYIELD = function(settlement, maturity, price) {
        settlement = utils.parseDate(settlement);
        maturity = utils.parseDate(maturity);
        price = utils.parseNumber(price);
        if (utils.anyIsError(settlement, maturity, price)) {
            return error.value;
        }

        // Return error if price is lower than or equal to zero
        if (price <= 0) {
            return error.num;
        }

        // Return error if settlement is greater than maturity
        if (settlement > maturity) {
            return error.num;
        }

        // Return error if maturity is more than one year after settlement
        if (maturity - settlement > 365 * 24 * 60 * 60 * 1000) {
            return error.num;
        }

        // Return bond-equivalent yield
        return (100 - price) * 360 / (price * DAYS360(settlement, maturity, false));
    };

    exports.VDB = null;

    exports.XIRR = function(values, dates, guess) {
        // Credits: algorithm inspired by Apache OpenOffice

        values = utils.parseNumberArray(utils.flatten(values));
        dates = utils.parseDateArray(utils.flatten(dates));
        guess = utils.parseNumber(guess);
        if (utils.anyIsError(values, dates, guess)) {
            return error.value;
        }

        // Calculates the resulting amount
        var irrResult = function(values, dates, rate) {
            var r = rate + 1;
            var result = values[0];
            for (var i = 1; i < values.length; i++) {
                result += values[i] / Math.pow(r, DAYS(dates[i], dates[0]) / 365);
            }
            return result;
        };

        // Calculates the first derivation
        var irrResultDeriv = function(values, dates, rate) {
            var r = rate + 1;
            var result = 0;
            for (var i = 1; i < values.length; i++) {
                var frac = DAYS(dates[i], dates[0]) / 365;
                result -= frac * values[i] / Math.pow(r, frac + 1);
            }
            return result;
        };

        // Check that values contains at least one positive value and one
            // negative value
        var positive = false;
        var negative = false;
        for (var i = 0; i < values.length; i++) {
            if (values[i] > 0) {
                positive = true;
            }
            if (values[i] < 0) {
                negative = true;
            }
        }

        // Return error if values does not contain at least one positive value
            // and one negative value
        if (!positive || !negative) {
            return error.num;
        }

        // Initialize guess and resultRate
        guess = guess || 0.1;
        var resultRate = guess;

        // Set maximum epsilon for end of iteration
        var epsMax = 1e-10;

        // Implement Newton's method
        var newRate, epsRate, resultValue;
        var contLoop = true;
        do {
            resultValue = irrResult(values, dates, resultRate);
            newRate = resultRate - resultValue / irrResultDeriv(values, dates, resultRate);
            epsRate = Math.abs(newRate - resultRate);
            resultRate = newRate;
            contLoop = (epsRate > epsMax) && (Math.abs(resultValue) > epsMax);
        } while (contLoop);

        // Return internal rate of return
        return resultRate;
    };

    exports.XNPV = function(rate, values, dates) {
        rate = utils.parseNumber(rate);
        values = utils.parseNumberArray(utils.flatten(values));
        dates = utils.parseDateArray(utils.flatten(dates));
        if (utils.anyIsError(rate, values, dates)) {
            return error.value;
        }

        var result = 0;
        for (var i = 0; i < values.length; i++) {
            result += values[i] / Math.pow(1 + rate, DAYS(dates[i], dates[0]) / 365);
        }
        return result;
    };

    exports.YIELD = null;

    exports.YIELDDISC = null;

    exports.YIELDMAT = null;

    return exports;
})();

jexcel.methods.information = (function() {
    var exports = {};
    exports.CELL = null;

    exports.ERROR = {};
    exports.ERROR.TYPE = function(error_val) {
        switch (error_val) {
            case error.nil: return 1;
            case error.div0: return 2;
            case error.value: return 3;
            case error.ref: return 4;
            case error.name: return 5;
            case error.num: return 6;
            case error.na: return 7;
            case error.data: return 8;
        }
        return error.na;
    };

    exports.INFO = null;

    exports.ISBLANK = function(value) {
        return value === null;
    };

    exports.ISBINARY = function (number) {
        return (/^[01]{1,10}$/).test(number);
    };

    exports.ISERR = function(value) {
        return ([error.value, error.ref, error.div0, error.num, error.name, error.nil]).indexOf(value) >= 0 ||
            (typeof value === 'number' && (isNaN(value) || !isFinite(value)));
    };

    exports.ISERROR = function(value) {
        return exports.ISERR(value) || value === error.na;
    };

    exports.ISEVEN = function(number) {
        return (Math.floor(Math.abs(number)) & 1) ? false : true;
    };

    // TODO
    exports.ISFORMULA = null;

    exports.ISLOGICAL = function(value) {
        return value === true || value === false;
    };

    exports.ISNA = function(value) {
        return value === error.na;
    };

    exports.ISNONTEXT = function(value) {
        return typeof(value) !== 'string';
    };

    exports.ISNUMBER = function(value) {
        return typeof(value) === 'number' && !isNaN(value) && isFinite(value);
    };

    exports.ISODD = function(number) {
        return (Math.floor(Math.abs(number)) & 1) ? true : false;
    };

    exports.ISREF = null;

    exports.ISTEXT = function(value) {
        return typeof(value) === 'string';
    };

    exports.N = function(value) {
        if (this.ISNUMBER(value)) {
            return value;
        }
        if (value instanceof Date) {
            return value.getTime();
        }
        if (value === true) {
            return 1;
        }
        if (value === false) {
            return 0;
        }
        if (this.ISERROR(value)) {
            return value;
        }
        return 0;
    };

    exports.NA = function() {
        return error.na;
    };

    exports.SHEET = null;

    exports.SHEETS = null;

    exports.TYPE = function(value) {
        if (this.ISNUMBER(value)) {
            return 1;
        }
        if (this.ISTEXT(value)) {
            return 2;
        }
        if (this.ISLOGICAL(value)) {
            return 4;
        }
        if (this.ISERROR(value)) {
            return 16;
        }
        if (Array.isArray(value)) {
            return 64;
        }
    };

    return exports;
})();

jexcel.methods.logical = (function() {
    var exports = {};

    exports.AND = function() {
        var args = utils.flatten(arguments);
        var result = true;
        for (var i = 0; i < args.length; i++) {
            if (!args[i]) {
                result = false;
            }
        }
        return result;
    };

    exports.CHOOSE = function() {
        if (arguments.length < 2) {
            return error.na;
        }

        var index = arguments[0];
        if (index < 1 || index > 254) {
            return error.value;
        }

        if (arguments.length < index + 1) {
            return error.value;
        }

        return arguments[index];
    };

    exports.FALSE = function() {
        return false;
    };

    exports.IF = function(test, then_value, otherwise_value) {
        return test ? then_value : otherwise_value;
    };

    exports.IFERROR = function(value, valueIfError) {
        if (ISERROR(value)) {
            return valueIfError;
        }
        return value;
    };

    exports.IFNA = function(value, value_if_na) {
        return value === error.na ? value_if_na : value;
    };

    exports.NOT = function(logical) {
        return !logical;
    };

    exports.OR = function() {
        var args = utils.flatten(arguments);
        var result = false;
        for (var i = 0; i < args.length; i++) {
            if (args[i]) {
                result = true;
            }
        }
        return result;
    };

    exports.TRUE = function() {
        return true;
    };

    exports.XOR = function() {
        var args = utils.flatten(arguments);
        var result = 0;
        for (var i = 0; i < args.length; i++) {
            if (args[i]) {
                result++;
            }
        }
        return (Math.floor(Math.abs(result)) & 1) ? true : false;
    };

    exports.SWITCH = function() {
        var result;
        if (arguments.length > 0)  {
            var targetValue = arguments[0];
            var argc = arguments.length - 1;
            var switchCount = Math.floor(argc / 2);
            var switchSatisfied = false;
            var defaultClause = argc % 2 === 0 ? null : arguments[arguments.length - 1];

            if (switchCount) {
                for (var index = 0; index < switchCount; index++) {
                    if (targetValue === arguments[index * 2 + 1]) {
                      result = arguments[index * 2 + 2];
                      switchSatisfied = true;
                      break;
                    }
                }
            }

            if (!switchSatisfied && defaultClause) {
                result = defaultClause;
            }
        }

        return result;
    };

    return exports;
})();

jexcel.methods.math = (function() {
    var exports = {};

    exports.ABS = function(number) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }
        return Math.abs(utils.parseNumber(number));
    };

    exports.ACOS = function(number) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }
        return Math.acos(number);
    };

    exports.ACOSH = function(number) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }
        return Math.log(number + Math.sqrt(number * number - 1));
    };

    exports.ACOT = function(number) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }
        return Math.atan(1 / number);
    };

    exports.ACOTH = function(number) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }
        return 0.5 * Math.log((number + 1) / (number - 1));
    };

    exports.AGGREGATE = null

    exports.ARABIC = function(text) {
        // Credits: Rafa? Kukawski
        if (!/^M*(?:D?C{0,3}|C[MD])(?:L?X{0,3}|X[CL])(?:V?I{0,3}|I[XV])$/.test(text)) {
            return error.value;
        }
        var r = 0;
        text.replace(/[MDLV]|C[MD]?|X[CL]?|I[XV]?/g, function(i) {
            r += {
                M: 1000,
                CM: 900,
                D: 500,
                CD: 400,
                C: 100,
                XC: 90,
                L: 50,
                XL: 40,
                X: 10,
                IX: 9,
                V: 5,
                IV: 4,
                I: 1
            }[i];
        });
        return r;
    };

    exports.ASIN = function(number) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }
        return Math.asin(number);
    };

    exports.ASINH = function(number) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }
        return Math.log(number + Math.sqrt(number * number + 1));
    };

    exports.ATAN = function(number) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }
        return Math.atan(number);
    };

    exports.ATAN2 = function(number_x, number_y) {
        number_x = utils.parseNumber(number_x);
        number_y = utils.parseNumber(number_y);
        if (utils.anyIsError(number_x, number_y)) {
            return error.value;
        }
        return Math.atan2(number_x, number_y);
    };

    exports.ATANH = function(number) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }
        return Math.log((1 + number) / (1 - number)) / 2;
    };

    exports.BASE = function(number, radix, min_length) {
        min_length = min_length || 0;

        number = utils.parseNumber(number);
        radix = utils.parseNumber(radix);
        min_length = utils.parseNumber(min_length);
        if (utils.anyIsError(number, radix, min_length)) {
            return error.value;
        }
        min_length = (min_length === undefined) ? 0 : min_length;
        var result = number.toString(radix);
        return new Array(Math.max(min_length + 1 - result.length, 0)).join('0') + result;
    };

    exports.CEILING = function(number, significance, mode) {
        significance = (significance === undefined) ? 1 : significance;
        mode = (mode === undefined) ? 0 : mode;

        number = utils.parseNumber(number);
        significance = utils.parseNumber(significance);
        mode = utils.parseNumber(mode);
        if (utils.anyIsError(number, significance, mode)) {
            return error.value;
        }
        if (significance === 0) {
            return 0;
        }

        significance = Math.abs(significance);
        if (number >= 0) {
            return Math.ceil(number / significance) * significance;
        } else {
            if (mode === 0) {
                return -1 * Math.floor(Math.abs(number) / significance) * significance;
            } else {
                return -1 * Math.ceil(Math.abs(number) / significance) * significance;
            }
        }
    };

    exports.CEILING.MATH = exports.CEILING;

    exports.CEILING.PRECISE = exports.CEILING;

    exports.COMBIN = function(number, number_chosen) {
        number = utils.parseNumber(number);
        number_chosen = utils.parseNumber(number_chosen);
        if (utils.anyIsError(number, number_chosen)) {
            return error.value;
        }
        return exports.FACT(number) / (exports.FACT(number_chosen) * exports.FACT(number - number_chosen));
    };

    exports.COMBINA = function(number, number_chosen) {
        number = utils.parseNumber(number);
        number_chosen = utils.parseNumber(number_chosen);
        if (utils.anyIsError(number, number_chosen)) {
            return error.value;
        }
        return (number === 0 && number_chosen === 0) ? 1 : exports.COMBIN(number + number_chosen - 1, number - 1);
    };

    exports.COS = function(number) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }
        return Math.cos(number);
    };

    exports.COSH = function(number) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }
        return (Math.exp(number) + Math.exp(-number)) / 2;
    };

    exports.COT = function(number) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }
        return 1 / Math.tan(number);
    };

    exports.COTH = function(number) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }
        var e2 = Math.exp(2 * number);
        return (e2 + 1) / (e2 - 1);
    };

    exports.CSC = function(number) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }
        return 1 / Math.sin(number);
    };

    exports.CSCH = function(number) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }
        return 2 / (Math.exp(number) - Math.exp(-number));
    };

    exports.DECIMAL = function(number, radix) {
        if (arguments.length < 1) {
            return error.value;
        }


        return parseInt(number, radix);
    };

    exports.DEGREES = function(number) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }
        return number * 180 / Math.PI;
    };

    exports.EVEN = function(number) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }
        return exports.CEILING(number, -2, -1);
    };

    exports.EXP = Math.exp;

    var MEMOIZED_FACT = [];
    exports.FACT = function(number) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }
        var n = Math.floor(number);
        if (n === 0 || n === 1) {
            return 1;
        } else if (MEMOIZED_FACT[n] > 0) {
            return MEMOIZED_FACT[n];
        } else {
            MEMOIZED_FACT[n] = exports.FACT(n - 1) * n;
            return MEMOIZED_FACT[n];
        }
    };

    exports.FACTDOUBLE = function(number) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }
        var n = Math.floor(number);
        if (n <= 0) {
            return 1;
        } else {
            return n * exports.FACTDOUBLE(n - 2);
        }
    };

    exports.FLOOR = function(number, significance, mode) {
        significance = (significance === undefined) ? 1 : significance;
        mode = (mode === undefined) ? 0 : mode;

        number = utils.parseNumber(number);
        significance = utils.parseNumber(significance);
        mode = utils.parseNumber(mode);
        if (utils.anyIsError(number, significance, mode)) {
            return error.value;
        }
        if (significance === 0) {
            return 0;
        }

        significance = Math.abs(significance);
        if (number >= 0) {
            return Math.floor(number / significance) * significance;
        } else {
            if (mode === 0) {
                return -1 * Math.ceil(Math.abs(number) / significance) * significance;
            } else {
                return -1 * Math.floor(Math.abs(number) / significance) * significance;
            }
        }
    };

    exports.FLOOR.MATH = exports.FLOOR;

    exports.GCD = null;

    exports.INT = function(number) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }
        return Math.floor(number);
    };

    exports.LCM = function() {
        // Credits: Jonas Raoni Soares Silva
        var o = utils.parseNumberArray(utils.flatten(arguments));
        if (o instanceof Error) {
            return o;
        }
        for (var i, j, n, d, r = 1;
            (n = o.pop()) !== undefined;) {
            while (n > 1) {
                if (n % 2) {
                    for (i = 3, j = Math.floor(Math.sqrt(n)); i <= j && n % i; i += 2) {
                      //empty
                    }
                    d = (i <= j) ? i : n;
                } else {
                    d = 2;
                }
                for (n /= d, r *= d, i = o.length; i;
                    (o[--i] % d) === 0 && (o[i] /= d) === 1 && o.splice(i, 1)) {
                    //empty
                }
            }
        }
        return r;
    };

    exports.LN = function(number) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }
        return Math.log(number);
    };

    exports.LOG = function(number, base) {
        number = utils.parseNumber(number);
        base = (base === undefined) ? 10 : utils.parseNumber(base);

        if (utils.anyIsError(number, base)) {
            return error.value;
        }

        return Math.log(number) / Math.log(base);
    };

    exports.LOG10 = function(number) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }
        return Math.log(number) / Math.log(10);
    };

    exports.MDETERM = null;

    exports.MINVERSE = null;

    exports.MMULT = null;

    exports.MOD = function(dividend, divisor) {
        dividend = utils.parseNumber(dividend);
        divisor = utils.parseNumber(divisor);
        if (utils.anyIsError(dividend, divisor)) {
            return error.value;
        }
        if (divisor === 0) {
            return error.div0;
        }
        var modulus = Math.abs(dividend % divisor);
        return (divisor > 0) ? modulus : -modulus;
    };

    exports.MROUND = function(number, multiple) {
        number = utils.parseNumber(number);
        multiple = utils.parseNumber(multiple);
        if (utils.anyIsError(number, multiple)) {
            return error.value;
        }
        if (number * multiple < 0) {
            return error.num;
        }

        return Math.round(number / multiple) * multiple;
    };

    exports.MULTINOMIAL = function() {
        var args = utils.parseNumberArray(utils.flatten(arguments));
        if (args instanceof Error) {
            return args;
        }
        var sum = 0;
        var divisor = 1;
        for (var i = 0; i < args.length; i++) {
            sum += args[i];
            divisor *= exports.FACT(args[i]);
        }
        return exports.FACT(sum) / divisor;
    };

    exports.MUNIT = null;

    exports.ODD = function(number) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }
        var temp = Math.ceil(Math.abs(number));
        temp = (temp & 1) ? temp : temp + 1;
        return (number > 0) ? temp : -temp;
    };

    exports.PI = function() {
        return Math.PI;
    };

    exports.POWER = function(number, power) {
        number = utils.parseNumber(number);
        power = utils.parseNumber(power);
        if (utils.anyIsError(number, power)) {
            return error.value;
        }
        var result = Math.pow(number, power);
        if (isNaN(result)) {
            return error.num;
        }

        return result;
    };

    exports.PRODUCT = function() {
        var args = utils.parseNumberArray(utils.flatten(arguments));
        if (args instanceof Error) {
            return args;
        }
        var result = 1;
        for (var i = 0; i < args.length; i++) {
            result *= args[i];
        }
        return result;
    };

    exports.QUOTIENT = function(numerator, denominator) {
        numerator = utils.parseNumber(numerator);
        denominator = utils.parseNumber(denominator);
        if (utils.anyIsError(numerator, denominator)) {
            return error.value;
        }
        return parseInt(numerator / denominator, 10);
    };

    exports.RADIANS = function(number) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }
        return number * Math.PI / 180;
    };

    exports.RAND = function() {
        return Math.random();
    };

    exports.RANDBETWEEN = function(bottom, top) {
        bottom = utils.parseNumber(bottom);
        top = utils.parseNumber(top);
        if (utils.anyIsError(bottom, top)) {
            return error.value;
        }
        // Creative Commons Attribution 3.0 License
        // Copyright (c) 2012 eqcode
        return bottom + Math.ceil((top - bottom + 1) * Math.random()) - 1;
    };

    exports.ROMAN = null;

    exports.ROUND = function(number, digits) {
        number = utils.parseNumber(number);
        digits = utils.parseNumber(digits);
        if (utils.anyIsError(number, digits)) {
            return error.value;
        }
        return Math.round(number * Math.pow(10, digits)) / Math.pow(10, digits);
    };

    exports.ROUNDDOWN = function(number, digits) {
        number = utils.parseNumber(number);
        digits = utils.parseNumber(digits);
        if (utils.anyIsError(number, digits)) {
            return error.value;
        }
        var sign = (number > 0) ? 1 : -1;
        return sign * (Math.floor(Math.abs(number) * Math.pow(10, digits))) / Math.pow(10, digits);
    };

    exports.ROUNDUP = function(number, digits) {
        number = utils.parseNumber(number);
        digits = utils.parseNumber(digits);
        if (utils.anyIsError(number, digits)) {
            return error.value;
        }
        var sign = (number > 0) ? 1 : -1;
        return sign * (Math.ceil(Math.abs(number) * Math.pow(10, digits))) / Math.pow(10, digits);
    };

    exports.SEC = function(number) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }
        return 1 / Math.cos(number);
    };

    exports.SECH = function(number) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }
        return 2 / (Math.exp(number) + Math.exp(-number));
    };

    exports.SERIESSUM = function(x, n, m, coefficients) {
        x = utils.parseNumber(x);
        n = utils.parseNumber(n);
        m = utils.parseNumber(m);
        coefficients = utils.parseNumberArray(coefficients);
        if (utils.anyIsError(x, n, m, coefficients)) {
            return error.value;
        }
        var result = coefficients[0] * Math.pow(x, n);
        for (var i = 1; i < coefficients.length; i++) {
            result += coefficients[i] * Math.pow(x, n + i * m);
        }
        return result;
    };

    exports.SIGN = function(number) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }
        if (number < 0) {
            return -1;
        } else if (number === 0) {
            return 0;
        } else {
            return 1;
        }
    };

    exports.SIN = function(number) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }
        return Math.sin(number);
    };

    exports.SINH = function(number) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }
        return (Math.exp(number) - Math.exp(-number)) / 2;
    };

    exports.SQRT = function(number) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }
        if (number < 0) {
            return error.num;
        }
        return Math.sqrt(number);
    };

    exports.SQRTPI = function(number) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }
        return Math.sqrt(number * Math.PI);
    };

    exports.SUBTOTAL = null;

    exports.ADD = function (num1, num2) {
        if (arguments.length !== 2) {
            return error.na;
        }

        num1 = utils.parseNumber(num1);
        num2 = utils.parseNumber(num2);
        if (utils.anyIsError(num1, num2)) {
            return error.value;
        }

        return num1 + num2;
    };

    exports.MINUS = function (num1, num2) {
        if (arguments.length !== 2) {
            return error.na;
        }

        num1 = utils.parseNumber(num1);
        num2 = utils.parseNumber(num2);
        if (utils.anyIsError(num1, num2)) {
            return error.value;
        }

        return num1 - num2;
    };

    exports.DIVIDE = function (dividend, divisor) {
        if (arguments.length !== 2) {
            return error.na;
        }

        dividend = utils.parseNumber(dividend);
        divisor = utils.parseNumber(divisor);
        if (utils.anyIsError(dividend, divisor)) {
            return error.value;
        }

        if (divisor === 0) {
            return error.div0;
        }

        return dividend / divisor;
    };

    exports.MULTIPLY = function (factor1, factor2) {
        if (arguments.length !== 2) {
            return error.na;
        }

        factor1 = utils.parseNumber(factor1);
        factor2 = utils.parseNumber(factor2);
        if (utils.anyIsError(factor1, factor2)) {
            return error.value;
        }

        return factor1 * factor2;
    };

    exports.GTE = function (num1, num2) {
        if (arguments.length !== 2) {
            return error.na;
        }

        num1 = utils.parseNumber(num1);
        num2 = utils.parseNumber(num2);
        if (utils.anyIsError(num1, num2)) {
            return error.error;
        }

        return num1 >= num2;
    };

    exports.LT = function (num1, num2) {
        if (arguments.length !== 2) {
            return error.na;
        }

        num1 = utils.parseNumber(num1);
        num2 = utils.parseNumber(num2);
        if (utils.anyIsError(num1, num2)) {
            return error.error;
        }

        return num1 < num2;
    };

    exports.LTE = function (num1, num2) {
        if (arguments.length !== 2) {
            return error.na;
        }

        num1 = utils.parseNumber(num1);
        num2 = utils.parseNumber(num2);
        if (utils.anyIsError(num1, num2)) {
            return error.error;
        }

        return num1 <= num2;
    };

    exports.EQ = function (value1, value2) {
        if (arguments.length !== 2) {
            return error.na;
        }

        return value1 === value2;
    };

    exports.NE = function (value1, value2) {
        if (arguments.length !== 2) {
            return error.na;
        }

        return value1 !== value2;
    };

    exports.POW = function (base, exponent) {
        if (arguments.length !== 2) {
            return error.na;
        }

        base = utils.parseNumber(base);
        exponent = utils.parseNumber(exponent);
        if (utils.anyIsError(base, exponent)) {
            return error.error;
        }

        return exports.POWER(base, exponent);
    };

    exports.SUM = function() {
        var result = 0;
        var argsKeys = Object.keys(arguments);
        for (var i = 0; i < argsKeys.length; ++i) {
            var elt = arguments[argsKeys[i]];
            if (typeof elt === 'number') {
                result += elt;
            } else if (typeof elt === 'string') {
                var parsed = parseFloat(elt);
                !isNaN(parsed) && (result += parsed);
            } else if (Array.isArray(elt)) {
                result += exports.SUM.apply(null, elt);
            }
        }
        return result;
    };

    exports.SUMIF = function(range, criteria) {
        range = utils.parseNumberArray(utils.flatten(range));
        if (range instanceof Error) {
            return range;
        }
        var result = 0;
        for (var i = 0; i < range.length; i++) {
            result += (eval(range[i] + criteria)) ? range[i] : 0; // jshint ignore:line
        }
        return result;
    };

    exports.SUMIFS = function() {
        var args = utils.argsToArray(arguments);
        var range = utils.parseNumberArray(utils.flatten(args.shift()));
        if (range instanceof Error) {
            return range;
        }
        var criteria = args;

        var n_range_elements = range.length;
        var n_criterias = criteria.length;

        var result = 0;
        for (var i = 0; i < n_range_elements; i++) {
            var el = range[i];
            var condition = '';
            for (var c = 0; c < n_criterias; c++) {
                condition += el + criteria[c];
                if (c !== n_criterias - 1) {
                    condition += '&&';
                }
            }
            if (eval(condition)) { // jshint ignore:line
                result += el;
            }
        }
        return result;
    };

    exports.SUMPRODUCT = null;

    exports.SUMSQ = function() {
        var numbers = utils.parseNumberArray(utils.flatten(arguments));
        if (numbers instanceof Error) {
            return numbers;
        }
        var result = 0;
        var length = numbers.length;
        for (var i = 0; i < length; i++) {
            result += (ISNUMBER(numbers[i])) ? numbers[i] * numbers[i] : 0;
        }
        return result;
    };

    exports.SUMX2MY2 = function(array_x, array_y) {
        array_x = utils.parseNumberArray(utils.flatten(array_x));
        array_y = utils.parseNumberArray(utils.flatten(array_y));
        if (utils.anyIsError(array_x, array_y)) {
            return error.value;
        }
        var result = 0;
        for (var i = 0; i < array_x.length; i++) {
            result += array_x[i] * array_x[i] - array_y[i] * array_y[i];
        }
        return result;
    };

    exports.SUMX2PY2 = function(array_x, array_y) {
        array_x = utils.parseNumberArray(utils.flatten(array_x));
        array_y = utils.parseNumberArray(utils.flatten(array_y));
        if (utils.anyIsError(array_x, array_y)) {
            return error.value;
        }
        var result = 0;
        array_x = utils.parseNumberArray(utils.flatten(array_x));
        array_y = utils.parseNumberArray(utils.flatten(array_y));
        for (var i = 0; i < array_x.length; i++) {
            result += array_x[i] * array_x[i] + array_y[i] * array_y[i];
        }
        return result;
    };

    exports.SUMXMY2 = function(array_x, array_y) {
        array_x = utils.parseNumberArray(utils.flatten(array_x));
        array_y = utils.parseNumberArray(utils.flatten(array_y));
        if (utils.anyIsError(array_x, array_y)) {
            return error.value;
        }
        var result = 0;
        array_x = utils.flatten(array_x);
        array_y = utils.flatten(array_y);
        for (var i = 0; i < array_x.length; i++) {
            result += Math.pow(array_x[i] - array_y[i], 2);
        }
        return result;
    };

    exports.TAN = function(number) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }
        return Math.tan(number);
    };

    exports.TANH = function(number) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }
        var e2 = Math.exp(2 * number);
        return (e2 - 1) / (e2 + 1);
    };

    exports.TRUNC = function(number, digits) {
        digits = (digits === undefined) ? 0 : digits;
        number = utils.parseNumber(number);
        digits = utils.parseNumber(digits);
        if (utils.anyIsError(number, digits)) {
            return error.value;
        }
        var sign = (number > 0) ? 1 : -1;
        return sign * (Math.floor(Math.abs(number) * Math.pow(10, digits))) / Math.pow(10, digits);
    };

    return exports;
})();

jexcel.methods.misc = (function() {
    var exports = {};

    exports.UNIQUE = function () {
        var result = [];
        for (var i = 0; i < arguments.length; ++i) {
            var hasElement = false;
            var element = arguments[i];

            // Check if we've already seen this element.
            for (var j = 0; j < result.length; ++j) {
                hasElement = result[j] === element;
                if (hasElement) { break; }
            }

            // If we did not find it, add it to the result.
            if (!hasElement) {
                result.push(element);
            }
        }
        return result;
    };

    exports.FLATTEN = utils.flatten;

    exports.ARGS2ARRAY = function () {
        return Array.prototype.slice.call(arguments, 0);
    };

    exports.REFERENCE = function (context, reference) {
        try {
            var path = reference.split('.');
            var result = context;
            for (var i = 0; i < path.length; ++i) {
                var step = path[i];
                if (step[step.length - 1] === ']') {
                    var opening = step.indexOf('[');
                    var index = step.substring(opening + 1, step.length - 1);
                    result = result[step.substring(0, opening)][index];
                } else {
                    result = result[step];
                }
            }
            return result;
        } catch (error) {}
    };

    exports.JOIN = function (array, separator) {
        return array.join(separator);
    };

    exports.NUMBERS = function () {
        var possibleNumbers = utils.flatten(arguments);
        return possibleNumbers.filter(function (el) {
            return typeof el === 'number';
        });
    };

    exports.NUMERAL = null;

    return exports;
})();

jexcel.methods.text = (function() {
    var exports = {};

    exports.ASC = null;

    exports.BAHTTEXT = null;

    exports.CHAR = function(number) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }
        return String.fromCharCode(number);
    };

    exports.CLEAN = function(text) {
        text = text || '';
        var re = /[\0-\x1F]/g;
        return text.replace(re, "");
    };

    exports.CODE = function(text) {
        text = text || '';
        return text.charCodeAt(0);
    };

    exports.CONCATENATE = function() {
        var args = utils.flatten(arguments);

        var trueFound = 0;
        while ((trueFound = args.indexOf(true)) > -1) {
            args[trueFound] = 'TRUE';
        }

        var falseFound = 0;
        while ((falseFound = args.indexOf(false)) > -1) {
            args[falseFound] = 'FALSE';
        }

        return args.join('');
    };

    exports.DBCS = null;

    exports.DOLLAR = null;

    exports.EXACT = function(text1, text2) {
        return text1 === text2;
    };

    exports.FIND = function(find_text, within_text, position) {
        position = (position === undefined) ? 0 : position;
        return within_text ? within_text.indexOf(find_text, position - 1) + 1 : null;
    };

    exports.FIXED = null;

    exports.HTML2TEXT = function (value) {
        var result = '';

        if (value) {
            if (value instanceof Array) {
                value.forEach(function (line) {
                    if (result !== '') {
                      result += '\n';
                    }
                    result += (line.replace(/<(?:.|\n)*?>/gm, ''));
                });
            } else {
                result = value.replace(/<(?:.|\n)*?>/gm, '');
            }
        }

        return result;
    };

    exports.LEFT = function(text, number) {
        number = (number === undefined) ? 1 : number;
        number = utils.parseNumber(number);
        if (number instanceof Error || typeof text !== 'string') {
            return error.value;
        }
        return text ? text.substring(0, number) : null;
    };

    exports.LEN = function(text) {
        if (arguments.length === 0) {
            return error.error;
        }

        if (typeof text === 'string') {
            return text ? text.length : 0;
        }

        if (text.length) {
            return text.length;
        }

        return error.value;
    };

    exports.LOWER = function(text) {
        if (typeof text !== 'string') {
            return error.value;
        }
        return text ? text.toLowerCase() : text;
    };

    exports.MID = function(text, start, number) {
        start = utils.parseNumber(start);
        number = utils.parseNumber(number);
        if (utils.anyIsError(start, number) || typeof text !== 'string') {
            return number;
        }

        var begin = start - 1;
        var end = begin + number;

        return text.substring(begin, end);
    };

    exports.NUMBERVALUE = null;

    exports.PRONETIC = null;

    exports.PROPER = function(text) {
        if (text === undefined || text.length === 0) {
            return error.value;
        }
        if (text === true) {
            text = 'TRUE';
        }
        if (text === false) {
            text = 'FALSE';
        }
        if (isNaN(text) && typeof text === 'number') {
            return error.value;
        }
        if (typeof text === 'number') {
            text = '' + text;
        }

        return text.replace(/\w\S*/g, function(txt) {
            return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
        });
    };

    exports.REGEXEXTRACT = function (text, regular_expression) {
        var match = text.match(new RegExp(regular_expression));
        return match ? (match[match.length > 1 ? match.length - 1 : 0]) : null;
    };

    exports.REGEXMATCH = function (text, regular_expression, full) {
        var match = text.match(new RegExp(regular_expression));
        return full ? match : !!match;
    };

    exports.REGEXREPLACE = function (text, regular_expression, replacement) {
        return text.replace(new RegExp(regular_expression), replacement);
    };

    exports.REPLACE = function(text, position, length, new_text) {
        position = utils.parseNumber(position);
        length = utils.parseNumber(length);
        if (utils.anyIsError(position, length) ||
            typeof text !== 'string' ||
            typeof new_text !== 'string') {
            return error.value;
        }
        return text.substr(0, position - 1) + new_text + text.substr(position - 1 + length);
    };

    exports.REPT = function(text, number) {
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }
        return new Array(number + 1).join(text);
    };

    exports.RIGHT = function(text, number) {
        number = (number === undefined) ? 1 : number;
        number = utils.parseNumber(number);
        if (number instanceof Error) {
            return number;
        }
        return text ? text.substring(text.length - number) : null;
    };

    exports.SEARCH = function(find_text, within_text, position) {
        var foundAt;
        if (typeof find_text !== 'string' || typeof within_text !== 'string') {
            return error.value;
        }
        position = (position === undefined) ? 0 : position;
        foundAt = within_text.toLowerCase().indexOf(find_text.toLowerCase(), position - 1)+1;
        return (foundAt === 0)?error.value:foundAt;
    };

    exports.SPLIT = function (text, separator) {
        return text.split(separator);
    };

    exports.SUBSTITUTE = function(text, old_text, new_text, occurrence) {
        if (!text || !old_text || !new_text) {
            return text;
        } else if (occurrence === undefined) {
            return text.replace(new RegExp(old_text, 'g'), new_text);
        } else {
            var index = 0;
            var i = 0;
            while (text.indexOf(old_text, index) > 0) {
                index = text.indexOf(old_text, index + 1);
                i++;
                if (i === occurrence) {
                    return text.substring(0, index) + new_text + text.substring(index + old_text.length);
                }
            }
        }
    };

    exports.T = function(value) {
        return (typeof value === "string") ? value : '';
    };

    exports.TEXT = null;

    exports.TRIM = function(text) {
        if (typeof text !== 'string') {
            return error.value;
        }
        return text.replace(/ +/g, ' ').trim();
    };

    exports.UNICHAR = exports.CHAR;

    exports.UNICODE = exports.CODE;

    exports.UPPER = function(text) {
        if (typeof text !== 'string') {
            return error.value;
        }
        return text.toUpperCase();
    };

    exports.VALUE = null;

    return exports;
})();

jexcel.methods.stats = (function() {
    var exports = {};

    var SQRT2PI = 2.5066282746310002;

    exports.AVEDEV = null;

    exports.AVERAGE = function() {
        var range = utils.numbers(utils.flatten(arguments));
        var n = range.length;
        var sum = 0;
        var count = 0;
        for (var i = 0; i < n; i++) {
            sum += range[i];
            count += 1;
        }
        return sum / count;
    };

    exports.AVERAGEA = function() {
        var range = utils.flatten(arguments);
        var n = range.length;
        var sum = 0;
        var count = 0;
        for (var i = 0; i < n; i++) {
            var el = range[i];
            if (typeof el === 'number') {
                sum += el;
            }
            if (el === true) {
                sum++;
            }
            if (el !== null) {
                count++;
            }
        }
        return sum / count;
    };

    exports.AVERAGEIF = function(range, criteria, average_range) {
        average_range = average_range || range;
        range = utils.flatten(range);
        average_range = utils.parseNumberArray(utils.flatten(average_range));
        if (average_range instanceof Error) {
            return average_range;
        }
        var average_count = 0;
        var result = 0;
        for (var i = 0; i < range.length; i++) {
            if (eval(range[i] + criteria)) { // jshint ignore:line
                result += average_range[i];
                average_count++;
            }
        }
        return result / average_count;
    };

    exports.AVERAGEIFS = null;

    exports.COUNT = function() {
        return utils.numbers(utils.flatten(arguments)).length;
    };

    exports.COUNTA = function() {
        var range = utils.flatten(arguments);
        return range.length - exports.COUNTBLANK(range);
    };

    exports.COUNTIN = function (range, value) {
        var result = 0;
        for (var i = 0; i < range.length; i++) {
            if (range[i] === value) {
                result++;
            }
        }
        return result;
    };

    exports.COUNTBLANK = function() {
        var range = utils.flatten(arguments);
        var blanks = 0;
        var element;
        for (var i = 0; i < range.length; i++) {
            element = range[i];
            if (element === null || element === '') {
                blanks++;
            }
        }
        return blanks;
    };

    exports.COUNTIF = function(range, criteria) {
        range = utils.flatten(range);
        if (!/[<>=!]/.test(criteria)) {
            criteria = '=="' + criteria + '"';
        }
        var matches = 0;
        for (var i = 0; i < range.length; i++) {
            if (typeof range[i] !== 'string') {
                if (eval(range[i] + criteria)) { // jshint ignore:line
                    matches++;
                }
            } else {
                if (eval('"' + range[i] + '"' + criteria)) { // jshint ignore:line
                    matches++;
                }
            }
        }
        return matches;
    };

    exports.COUNTIFS = function() {
        var args = utils.argsToArray(arguments);
        var results = new Array(utils.flatten(args[0]).length);
        for (var i = 0; i < results.length; i++) {
            results[i] = true;
        }
        for (i = 0; i < args.length; i += 2) {
            var range = utils.flatten(args[i]);
            var criteria = args[i + 1];
            if (!/[<>=!]/.test(criteria)) {
                criteria = '=="' + criteria + '"';
            }
            for (var j = 0; j < range.length; j++) {
                if (typeof range[j] !== 'string') {
                    results[j] = results[j] && eval(range[j] + criteria); // jshint ignore:line
                } else {
                    results[j] = results[j] && eval('"' + range[j] + '"' + criteria); // jshint ignore:line
                }
            }
        }
        var result = 0;
        for (i = 0; i < results.length; i++) {
            if (results[i]) {
                result++;
            }
        }
        return result;
    };

    exports.COUNTUNIQUE = function () {
        return UNIQUE.apply(null, utils.flatten(arguments)).length;
    };

    exports.FISHER = function(x) {
        x = utils.parseNumber(x);
        if (x instanceof Error) {
            return x;
        }
        return Math.log((1 + x) / (1 - x)) / 2;
    };

    exports.FISHERINV = function(y) {
        y = utils.parseNumber(y);
        if (y instanceof Error) {
            return y;
        }
        var e2y = Math.exp(2 * y);
        return (e2y - 1) / (e2y + 1);
    };

    exports.FREQUENCY = function(data, bins) {
        data = utils.parseNumberArray(utils.flatten(data));
        bins = utils.parseNumberArray(utils.flatten(bins));
        if (utils.anyIsError(data, bins)) {
            return error.value;
        }
        var n = data.length;
        var b = bins.length;
        var r = [];
        for (var i = 0; i <= b; i++) {
            r[i] = 0;
            for (var j = 0; j < n; j++) {
                if (i === 0) {
                    if (data[j] <= bins[0]) {
                        r[0] += 1;
                    }
                } else if (i < b) {
                    if (data[j] > bins[i - 1] && data[j] <= bins[i]) {
                        r[i] += 1;
                    }
                } else if (i === b) {
                    if (data[j] > bins[b - 1]) {
                        r[b] += 1;
                    }
                }
            }
        }
        return r;
    };

    exports.LARGE = function(range, k) {
        range = utils.parseNumberArray(utils.flatten(range));
        k = utils.parseNumber(k);
        if (utils.anyIsError(range, k)) {
            return range;
        }
        return range.sort(function(a, b) {
            return b - a;
        })[k - 1];
    };

    exports.MAX = function() {
        var range = utils.numbers(utils.flatten(arguments));
        return (range.length === 0) ? 0 : Math.max.apply(Math, range);
    };

    exports.MAXA = function() {
        var range = utils.arrayValuesToNumbers(utils.flatten(arguments));
        return (range.length === 0) ? 0 : Math.max.apply(Math, range);
    };

    exports.MIN = function() {
        var range = utils.numbers(utils.flatten(arguments));
        return (range.length === 0) ? 0 : Math.min.apply(Math, range);
    };

    exports.MINA = function() {
        var range = utils.arrayValuesToNumbers(utils.flatten(arguments));
        return (range.length === 0) ? 0 : Math.min.apply(Math, range);
    };

    exports.MODE = {};

    exports.MODE.MULT = function() {
        // Credits: Roönaän
        var range = utils.parseNumberArray(utils.flatten(arguments));
        if (range instanceof Error) {
            return range;
        }
        var n = range.length;
        var count = {};
        var maxItems = [];
        var max = 0;
        var currentItem;

        for (var i = 0; i < n; i++) {
            currentItem = range[i];
            count[currentItem] = count[currentItem] ? count[currentItem] + 1 : 1;
            if (count[currentItem] > max) {
                max = count[currentItem];
                maxItems = [];
            }
            if (count[currentItem] === max) {
                maxItems[maxItems.length] = currentItem;
            }
        }
        return maxItems;
    };

    exports.MODE.SNGL = function() {
        var range = utils.parseNumberArray(utils.flatten(arguments));
        if (range instanceof Error) {
            return range;
        }
        return exports.MODE.MULT(range).sort(function(a, b) {
            return a - b;
        })[0];
    };

    exports.PERCENTILE = {};

    exports.PERCENTILE.EXC = function(array, k) {
        array = utils.parseNumberArray(utils.flatten(array));
        k = utils.parseNumber(k);
        if (utils.anyIsError(array, k)) {
            return error.value;
        }
        array = array.sort(function(a, b) {
            {
                return a - b;
            }
        });
        var n = array.length;
        if (k < 1 / (n + 1) || k > 1 - 1 / (n + 1)) {
            return error.num;
        }
        var l = k * (n + 1) - 1;
        var fl = Math.floor(l);
        return utils.cleanFloat((l === fl) ? array[l] : array[fl] + (l - fl) * (array[fl + 1] - array[fl]));
    };

    exports.PERCENTILE.INC = function(array, k) {
        array = utils.parseNumberArray(utils.flatten(array));
        k = utils.parseNumber(k);
        if (utils.anyIsError(array, k)) {
            return error.value;
        }
        array = array.sort(function(a, b) {
            return a - b;
        });
        var n = array.length;
        var l = k * (n - 1);
        var fl = Math.floor(l);
        return utils.cleanFloat((l === fl) ? array[l] : array[fl] + (l - fl) * (array[fl + 1] - array[fl]));
    };

    exports.PERCENTRANK = {};

    exports.PERCENTRANK.EXC = function(array, x, significance) {
        significance = (significance === undefined) ? 3 : significance;
        array = utils.parseNumberArray(utils.flatten(array));
        x = utils.parseNumber(x);
        significance = utils.parseNumber(significance);
        if (utils.anyIsError(array, x, significance)) {
            return error.value;
        }
        array = array.sort(function(a, b) {
            return a - b;
        });
        var uniques = UNIQUE.apply(null, array);
        var n = array.length;
        var m = uniques.length;
        var power = Math.pow(10, significance);
        var result = 0;
        var match = false;
        var i = 0;
        while (!match && i < m) {
            if (x === uniques[i]) {
                result = (array.indexOf(uniques[i]) + 1) / (n + 1);
                match = true;
            } else if (x >= uniques[i] && (x < uniques[i + 1] || i === m - 1)) {
                result = (array.indexOf(uniques[i]) + 1 + (x - uniques[i]) / (uniques[i + 1] - uniques[i])) / (n + 1);
                match = true;
            }
            i++;
        }
        return Math.floor(result * power) / power;
    };

    exports.PERCENTRANK.INC = function(array, x, significance) {
        significance = (significance === undefined) ? 3 : significance;
        array = utils.parseNumberArray(utils.flatten(array));
        x = utils.parseNumber(x);
        significance = utils.parseNumber(significance);
        if (utils.anyIsError(array, x, significance)) {
            return error.value;
        }
        array = array.sort(function(a, b) {
            return a - b;
        });
        var uniques = UNIQUE.apply(null, array);
        var n = array.length;
        var m = uniques.length;
        var power = Math.pow(10, significance);
        var result = 0;
        var match = false;
        var i = 0;
        while (!match && i < m) {
            if (x === uniques[i]) {
                result = array.indexOf(uniques[i]) / (n - 1);
                match = true;
            } else if (x >= uniques[i] && (x < uniques[i + 1] || i === m - 1)) {
                result = (array.indexOf(uniques[i]) + (x - uniques[i]) / (uniques[i + 1] - uniques[i])) / (n - 1);
                match = true;
            }
            i++;
        }
        return Math.floor(result * power) / power;
    };

    exports.PERMUT = function(number, number_chosen) {
        number = utils.parseNumber(number);
        number_chosen = utils.parseNumber(number_chosen);
        if (utils.anyIsError(number, number_chosen)) {
            return error.value;
        }
        return FACT(number) / FACT(number - number_chosen);
    };

    exports.PERMUTATIONA = function(number, number_chosen) {
        number = utils.parseNumber(number);
        number_chosen = utils.parseNumber(number_chosen);
        if (utils.anyIsError(number, number_chosen)) {
            return error.value;
        }
        return Math.pow(number, number_chosen);
    };

    exports.PHI = function(x) {
        x = utils.parseNumber(x);
        if (x instanceof Error) {
            return error.value;
        }
        return Math.exp(-0.5 * x * x) / SQRT2PI;
    };

    exports.PROB = function(range, probability, lower, upper) {
        if (lower === undefined) {
            return 0;
        }
        upper = (upper === undefined) ? lower : upper;

        range = utils.parseNumberArray(utils.flatten(range));
        probability = utils.parseNumberArray(utils.flatten(probability));
        lower = utils.parseNumber(lower);
        upper = utils.parseNumber(upper);
        if (utils.anyIsError(range, probability, lower, upper)) {
            return error.value;
        }

        if (lower === upper) {
            return (range.indexOf(lower) >= 0) ? probability[range.indexOf(lower)] : 0;
        }

        var sorted = range.sort(function(a, b) {
            return a - b;
        });
        var n = sorted.length;
        var result = 0;
        for (var i = 0; i < n; i++) {
            if (sorted[i] >= lower && sorted[i] <= upper) {
                result += probability[range.indexOf(sorted[i])];
            }
        }
        return result;
    };

    exports.QUARTILE = {};

    exports.QUARTILE.EXC = function(range, quart) {
        range = utils.parseNumberArray(utils.flatten(range));
        quart = utils.parseNumber(quart);
        if (utils.anyIsError(range, quart)) {
            return error.value;
        }
        switch (quart) {
            case 1:
                return exports.PERCENTILE.EXC(range, 0.25);
            case 2:
                return exports.PERCENTILE.EXC(range, 0.5);
            case 3:
                return exports.PERCENTILE.EXC(range, 0.75);
            default:
                return error.num;
        }
    };

    exports.QUARTILE.INC = function(range, quart) {
        range = utils.parseNumberArray(utils.flatten(range));
        quart = utils.parseNumber(quart);
        if (utils.anyIsError(range, quart)) {
            return error.value;
        }
        switch (quart) {
            case 1:
                return exports.PERCENTILE.INC(range, 0.25);
            case 2:
                return exports.PERCENTILE.INC(range, 0.5);
            case 3:
                return exports.PERCENTILE.INC(range, 0.75);
            default:
                return error.num;
        }
    };

    exports.RANK = {};

    exports.RANK.AVG = function(number, range, order) {
        number = utils.parseNumber(number);
        range = utils.parseNumberArray(utils.flatten(range));
        if (utils.anyIsError(number, range)) {
            return error.value;
        }
        range = utils.flatten(range);
        order = order || false;
        var sort = (order) ? function(a, b) {
            return a - b;
        } : function(a, b) {
            return b - a;
        };
        range = range.sort(sort);

        var length = range.length;
        var count = 0;
        for (var i = 0; i < length; i++) {
            if (range[i] === number) {
                count++;
            }
        }

        return (count > 1) ? (2 * range.indexOf(number) + count + 1) / 2 : range.indexOf(number) + 1;
    };

    exports.RANK.EQ = function(number, range, order) {
        number = utils.parseNumber(number);
        range = utils.parseNumberArray(utils.flatten(range));
        if (utils.anyIsError(number, range)) {
            return error.value;
        }
        order = order || false;
        var sort = (order) ? function(a, b) {
            return a - b;
        } : function(a, b) {
            return b - a;
        };
        range = range.sort(sort);
        return range.indexOf(number) + 1;
    };

    exports.RSQ = function(data_x, data_y) { // no need to flatten here, PEARSON will take care of that
        data_x = utils.parseNumberArray(utils.flatten(data_x));
        data_y = utils.parseNumberArray(utils.flatten(data_y));
        if (utils.anyIsError(data_x, data_y)) {
            return error.value;
        }
        return Math.pow(exports.PEARSON(data_x, data_y), 2);
    };

    exports.SMALL = function(range, k) {
        range = utils.parseNumberArray(utils.flatten(range));
        k = utils.parseNumber(k);
        if (utils.anyIsError(range, k)) {
            return range;
        }
        return range.sort(function(a, b) {
            return a - b;
        })[k - 1];
    };

    exports.STANDARDIZE = function(x, mean, sd) {
        x = utils.parseNumber(x);
        mean = utils.parseNumber(mean);
        sd = utils.parseNumber(sd);
        if (utils.anyIsError(x, mean, sd)) {
            return error.value;
        }
        return (x - mean) / sd;
    };

    exports.STDEV = {};

    exports.STDEV.P = function() {
        var v = exports.VAR.P.apply(this, arguments);
        return Math.sqrt(v);
    };

    exports.STDEV.S = function() {
        var v = exports.VAR.S.apply(this, arguments);
        return Math.sqrt(v);
    };

    exports.STDEVA = function() {
        var v = exports.VARA.apply(this, arguments);
        return Math.sqrt(v);
    };

    exports.STDEVPA = function() {
        var v = exports.VARPA.apply(this, arguments);
        return Math.sqrt(v);
    };

    exports.VAR = {};

    exports.VAR.P = function() {
        var range = utils.numbers(utils.flatten(arguments));
        var n = range.length;
        var sigma = 0;
        var mean = exports.AVERAGE(range);
        for (var i = 0; i < n; i++) {
            sigma += Math.pow(range[i] - mean, 2);
        }
        return sigma / n;
    };

    exports.VAR.S = function() {
        var range = utils.numbers(utils.flatten(arguments));
        var n = range.length;
        var sigma = 0;
        var mean = exports.AVERAGE(range);
        for (var i = 0; i < n; i++) {
            sigma += Math.pow(range[i] - mean, 2);
        }
        return sigma / (n - 1);
    };

    exports.VARA = function() {
        var range = utils.flatten(arguments);
        var n = range.length;
        var sigma = 0;
        var count = 0;
        var mean = exports.AVERAGEA(range);
        for (var i = 0; i < n; i++) {
            var el = range[i];
            if (typeof el === 'number') {
                sigma += Math.pow(el - mean, 2);
            } else if (el === true) {
                sigma += Math.pow(1 - mean, 2);
            } else {
                sigma += Math.pow(0 - mean, 2);
            }

            if (el !== null) {
                count++;
            }
        }
        return sigma / (count - 1);
    };

    exports.VARPA = function() {
        var range = utils.flatten(arguments);
        var n = range.length;
        var sigma = 0;
        var count = 0;
        var mean = exports.AVERAGEA(range);
        for (var i = 0; i < n; i++) {
            var el = range[i];
            if (typeof el === 'number') {
                sigma += Math.pow(el - mean, 2);
            } else if (el === true) {
                sigma += Math.pow(1 - mean, 2);
            } else {
                sigma += Math.pow(0 - mean, 2);
            }

            if (el !== null) {
                count++;
            }
        }
        return sigma / count;
    };

    exports.WEIBULL = {};

    exports.WEIBULL.DIST = function(x, alpha, beta, cumulative) {
        x = utils.parseNumber(x);
        alpha = utils.parseNumber(alpha);
        beta = utils.parseNumber(beta);
        if (utils.anyIsError(x, alpha, beta)) {
            return error.value;
        }
        return (cumulative) ? 1 - Math.exp(-Math.pow(x / beta, alpha)) : Math.pow(x, alpha - 1) * Math.exp(-Math.pow(x / beta, alpha)) * alpha / Math.pow(beta, alpha);
    };

    exports.Z = {};

    exports.Z.TEST = function(range, x, sd) {
        range = utils.parseNumberArray(utils.flatten(range));
        x = utils.parseNumber(x);
        if (utils.anyIsError(range, x)) {
            return error.value;
        }

        sd = sd || exports.STDEV.S(range);
        var n = range.length;
        return 1 - exports.NORM.S.DIST((exports.AVERAGE(range) - x) / (sd / Math.sqrt(n)), true);
    };

    return exports;
})();

for (var i = 0; i < Object.keys(jexcel.methods).length; i++) {
    var methods = jexcel.methods[Object.keys(jexcel.methods)[i]];
    for (var j = 0; j < Object.keys(methods).length; j++) {
        if (typeof(methods[Object.keys(methods)[j]]) == 'function') {
            window[Object.keys(methods)[j]] = methods[Object.keys(methods)[j]];
        } else {
            window[Object.keys(methods)[j]] = function() {
                return Object.keys(methods)[j] + 'Not implemented';
            }
        }
    }
}




    return jexcel;

})));

/***/ }),

/***/ 45551:
/*!**********************************************!*\
  !*** ./node_modules/jsuites/dist/jsuites.js ***!
  \**********************************************/
/***/ (function(module) {


/**
 * (c) jSuites Javascript Web Components (v2.8)
 *
 * Author: Paul Hodel <paul.hodel@gmail.com>
 * Website: https://bossanova.uk/jsuites/
 * Description: Create amazing web based applications.
 *
 * MIT License
 *
 */
;(function (global, factory) {
     true ? module.exports = factory() :
    0;
}(this, (function () {

    'use strict';

var jSuites = function(options) {
    var obj = {}

    obj.init = function() {
        // Find root element
        var app = document.querySelector('.japp');

        // Root element
        if (app) {
            obj.el = app;
        } else {
            obj.el = document.body;
        }

        // Loading modules
        var modules = document.querySelectorAll('[data-autoload]');
        for (var i = 0; i < modules.length; i++) {
            var m = modules[i].getAttribute('data-autoload');
            if (typeof(window[m]) == 'function') {
                window[m](modules[i]);
            }
        }
    }

    obj.guid = function() {
        var guid = '';
        for (var i = 0; i < 32; i++) {
            guid += Math.floor(Math.random()*0xF).toString(0xF);
        }
        return guid;
    }

    obj.getWindowWidth = function() {
        var w = window,
        d = document,
        e = d.documentElement,
        g = d.getElementsByTagName('body')[0],
        x = w.innerWidth || e.clientWidth || g.clientWidth;
        return x;
    }

    obj.getWindowHeight = function() {
        var w = window,
        d = document,
        e = d.documentElement,
        g = d.getElementsByTagName('body')[0],
        y = w.innerHeight|| e.clientHeight|| g.clientHeight;
        return  y;
    }

    obj.getPosition = function(e) {
        if (e.changedTouches && e.changedTouches[0]) {
            var x = e.changedTouches[0].pageX;
            var y = e.changedTouches[0].pageY;
        } else {
            var x = (window.Event) ? e.pageX : e.clientX + (document.documentElement.scrollLeft ? document.documentElement.scrollLeft : document.body.scrollLeft);
            var y = (window.Event) ? e.pageY : e.clientY + (document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop);
        }

        return [ x, y ];
    }

    obj.click = function(el) {
        if (el.click) {
            el.click();
        } else {
            var evt = new MouseEvent('click', {
                bubbles: true,
                cancelable: true,
                view: window
            });
            el.dispatchEvent(evt);
        }
    }

    obj.getElement = function(element, className) {
        var foundElement = false;

        function path (element) {
            if (element.className) {
                if (element.classList.contains(className)) {
                    foundElement = element;
                }
            }

            if (element.parentNode) {
                path(element.parentNode);
            }
        }

        path(element);

        return foundElement;
    }

    obj.getLinkElement = function(element) {
        var targetElement = false;

        function path (element) {
            if ((element.tagName == 'A' || element.tagName == 'DIV') && element.getAttribute('data-href')) {
                targetElement = element;
            }

            if (element.parentNode) {
                path(element.parentNode);
            }
        }

        path(element);

        return targetElement;
    }

    obj.getFormElements = function(formObject) {
        var ret = {};

        if (formObject) {
            var elements = formObject.querySelectorAll("input, select, textarea");
        } else {
            var elements = document.querySelectorAll("input, select, textarea");
        }

        for (var i = 0; i < elements.length; i++) {
            var element = elements[i];
            var name = element.name;
            var value = element.value;

            if (name) {
                ret[name] = value;
            }
        }

        return ret;
    }

    obj.exists = function(url, __callback) {
        var http = new XMLHttpRequest();
        http.open('HEAD', url, false);
        http.send();
        if (http.status) {
            __callback(http.status);
        }
    }

    obj.getFiles = function(element) {
        if (! element) {
            console.error('No element defined in the arguments of your method');
        }

        // Get attachments
        var files = element.querySelectorAll('.jfile');

        if (files.length > 0) {
            var data = [];
            for (var i = 0; i < files.length; i++) {
                var file = {};

                var src = files[i].getAttribute('src');

                if (files[i].classList.contains('jremove')) {
                    file.remove = 1;
                } else {
                    if (src.substr(0,4) == 'data') {
                        file.content = src.substr(src.indexOf(',') + 1);
                        file.extension = files[i].getAttribute('data-extension');
                    } else {
                        file.file = src;
                        file.extension = files[i].getAttribute('data-extension');
                        if (! file.extension) {
                            file.extension =  src.substr(src.lastIndexOf('.') + 1);
                        }
                        if (jSuites.files[file.file]) {
                            file.content = jSuites.files[file.file];
                        }
                    }

                    // Optional file information
                    if (files[i].getAttribute('data-name')) {
                        file.name = files[i].getAttribute('data-name');
                    }

                    if (files[i].getAttribute('data-file')) {
                        file.file = files[i].getAttribute('data-file');
                    }

                    if (files[i].getAttribute('data-size')) {
                        file.size = files[i].getAttribute('data-size');
                    }

                    if (files[i].getAttribute('data-date')) {
                        file.date = files[i].getAttribute('data-date');
                    }

                    if (files[i].getAttribute('data-cover')) {
                        file.cover = files[i].getAttribute('data-cover');
                    }
                }

                // TODO SMALL thumbs?

                data[i] = file;
            }

            return data;
        }
    }

    obj.ajax = function(options) {
        if (! options.data) {
            options.data = {};
        }

        if (options.type) {
            options.method = options.type;
        }

        if (options.data) {
            var data = [];
            var keys = Object.keys(options.data);

            if (keys.length) {
                for (var i = 0; i < keys.length; i++) {
                    if (typeof(options.data[keys[i]]) == 'object') {
                        var o = options.data[keys[i]];
                        for (var j = 0; j < o.length; j++) {
                            if (typeof(o[j]) == 'string') {
                                data.push(keys[i] + '[' + j + ']=' + encodeURIComponent(o[j]));
                            } else {
                                var prop = Object.keys(o[j]);
                                for (var z = 0; z < prop.length; z++) {
                                    data.push(keys[i] + '[' + j + '][' + prop[z] + ']=' + encodeURIComponent(o[j][prop[z]]));
                                }
                            }
                        }
                    } else {
                        data.push(keys[i] + '=' + encodeURIComponent(options.data[keys[i]]));
                    }
                }
            }

            if (options.method == 'GET' && data.length > 0) {
                if (options.url.indexOf('?') < 0) {
                    options.url += '?';
                }
                options.url += data.join('&');
            }
        }

        var httpRequest = new XMLHttpRequest();
        httpRequest.open(options.method, options.url, true);
        httpRequest.setRequestHeader('X-Requested-With', 'XMLHttpRequest');

        if (options.method == 'POST') {
            httpRequest.setRequestHeader('Accept', 'application/json');
            httpRequest.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        } else {
            if (options.dataType == 'json') {
                httpRequest.setRequestHeader('Content-Type', 'text/json');
            }
        }

        // No cache
        if (options.cache != true) {
            httpRequest.setRequestHeader('pragma', 'no-cache');
            httpRequest.setRequestHeader('cache-control', 'no-cache');
        }

        // Authentication
        if (options.withCredentials == true) {
            httpRequest.withCredentials = true
        }

        // Before send
        if (typeof(options.beforeSend) == 'function') {
            options.beforeSend(httpRequest);
        }

        httpRequest.onload = function() {
            if (httpRequest.status === 200) {
                if (options.dataType == 'json') {
                    try {
                        var result = JSON.parse(httpRequest.responseText);

                        if (options.success && typeof(options.success) == 'function') {
                            options.success(result);
                        }
                    } catch(err) {
                        if (options.error && typeof(options.error) == 'function') {
                            options.error(result);
                        }
                    }
                } else {
                    var result = httpRequest.responseText;

                    if (options.success && typeof(options.success) == 'function') {
                        options.success(result);
                    }
                }
            } else {
                if (options.error && typeof(options.error) == 'function') {
                    options.error(httpRequest.responseText);
                }
            }

            // Global complete method
            if (obj.ajax.requests && obj.ajax.requests.length) {
                // Get index of this request in the container
                var index = obj.ajax.requests.indexOf(httpRequest)
                // Remove from the ajax requests container
                obj.ajax.requests.splice(index, 1);
                // Last one?
                if (! obj.ajax.requests.length) {
                    if (options.complete && typeof(options.complete) == 'function') {
                        options.complete(result);
                    }
                }
            }
        }

        if (data) {
            httpRequest.send(data.join('&'));
        } else {
            httpRequest.send();
        }

        obj.ajax.requests.push(httpRequest);

        return httpRequest;
    }

    obj.ajax.requests = [];

    obj.slideLeft = function(element, direction, done) {
        if (direction == true) {
            element.classList.add('slide-left-in');
            setTimeout(function() {
                element.classList.remove('slide-left-in');
                if (typeof(done) == 'function') {
                    done();
                }
            }, 400);
        } else {
            element.classList.add('slide-left-out');
            setTimeout(function() {
                element.classList.remove('slide-left-out');
                if (typeof(done) == 'function') {
                    done();
                }
            }, 400);
        }
    }

    obj.slideRight = function(element, direction, done) {
        if (direction == true) {
            element.classList.add('slide-right-in');
            setTimeout(function() {
                element.classList.remove('slide-right-in');
                if (typeof(done) == 'function') {
                    done();
                }
            }, 400);
        } else {
            element.classList.add('slide-right-out');
            setTimeout(function() {
                element.classList.remove('slide-right-out');
                if (typeof(done) == 'function') {
                    done();
                }
            }, 400);
        }
    }

    obj.slideTop = function(element, direction, done) {
        if (direction == true) {
            element.classList.add('slide-top-in');
            setTimeout(function() {
                element.classList.remove('slide-top-in');
                if (typeof(done) == 'function') {
                    done();
                }
            }, 400);
        } else {
            element.classList.add('slide-top-out');
            setTimeout(function() {
                element.classList.remove('slide-top-out');
                if (typeof(done) == 'function') {
                    done();
                }
            }, 400);
        }
    }

    obj.slideBottom = function(element, direction, done) {
        if (direction == true) {
            element.classList.add('slide-bottom-in');
            setTimeout(function() {
                element.classList.remove('slide-bottom-in');
                if (typeof(done) == 'function') {
                    done();
                }
            }, 400);
        } else {
            element.classList.add('slide-bottom-out');
            setTimeout(function() {
                element.classList.remove('slide-bottom-out');
                if (typeof(done) == 'function') {
                    done();
                }
            }, 100);
        }
    }

    obj.fadeIn = function(element, done) {
        element.classList.add('fade-in');
        setTimeout(function() {
            element.classList.remove('fade-in');
            if (typeof(done) == 'function') {
                done();
            }
        }, 2000);
    }

    obj.fadeOut = function(element, done) {
        element.classList.add('fade-out');
        setTimeout(function() {
            element.classList.remove('fade-out');
            if (typeof(done) == 'function') {
                done();
            }
        }, 1000);
    }

    obj.keyDownControls = function(e) {
        if (e.which == 27) {
            var nodes = document.querySelectorAll('.jslider');
            if (nodes.length > 0) {
                for (var i = 0; i < nodes.length; i++) {
                    nodes[i].slider.close();
                }
            }

            if (document.querySelector('.jdialog')) {
                jSuites.dialog.close();
            }
        } else if (e.which == 13) {
            if (document.querySelector('.jdialog')) {
                if (typeof(jSuites.dialog.options.onconfirm) == 'function') {
                    jSuites.dialog.options.onconfirm();
                }
                jSuites.dialog.close();
            }
        }

        // Verify mask
        if (jSuites.mask) {
            jSuites.mask.apply(e);
        }
    }

    var actionUpControl = function(e) {
        var element = null;
        if (element = jSuites.getLinkElement(e.target)) {
            var link = element.getAttribute('data-href');
            if (link == '#back') {
                window.history.back();
            } else if (link == '#panel') {
                jSuites.panel();
            } else {
                jSuites.pages(link);
            }
        }
    }

    var controlSwipeLeft = function(e) {
        var element = jSuites.getElement(e.target, 'option');

        if (element && element.querySelector('.option-actions')) {
            element.scrollTo({
                left: 100,
                behavior: 'smooth'
            });
        } else {
            var element = jSuites.getElement(e.target, 'jcalendar');
            if (element && jSuites.calendar.current) {
                jSuites.calendar.current.prev();
            } else {
                if (jSuites.panel) {
                    var element = jSuites.panel.get();
                    if (element) {
                        if (element.style.display != 'none') {
                            jSuites.panel.close();
                        }
                    }
                }
            }
        }
    }

    var controlSwipeRight = function(e) {
        var element = jSuites.getElement(e.target, 'option');
        if (element && element.querySelector('.option-actions')) {
            element.scrollTo({
                left: 0,
                behavior: 'smooth'
            });
        } else {
            var element = jSuites.getElement(e.target, 'jcalendar');
            if (element && jSuites.calendar.current) {
                jSuites.calendar.current.next();
            } else {
                if (jSuites.panel) {
                    var element = jSuites.panel.get();
                    if (element) {
                        if (element.style.display == 'none') {
                            jSuites.panel();
                        }
                    }
                }
            }
        }
    }

    var actionOverControl = function(e) {
        // Tooltip
        if (jSuites.tooltip) {
            jSuites.tooltip(e);
        }
    }

    var actionOutControl = function(e) {
        // Tooltip
        if (jSuites.tooltip) {
            jSuites.tooltip.hide();
        }
    }

    // Create page container
    document.addEventListener('swipeleft', controlSwipeLeft);
    document.addEventListener('swiperight', controlSwipeRight);
    document.addEventListener('keydown', obj.keyDownControls);

    if ('ontouchend' in document.documentElement === true) {
        document.addEventListener('touchend', actionUpControl);
    } else {
        document.addEventListener('mouseup', actionUpControl);
    }

    // Onmouseover
    document.addEventListener('mouseover', actionOverControl);
    document.addEventListener('mouseout', actionOutControl);
    document.addEventListener('DOMContentLoaded', function() {
        obj.init();
    });

    // Pop state control
    window.onpopstate = function(e) {
        if (e.state && e.state.route) {
            if (jSuites.pages.get(e.state.route)) {
                jSuites.pages(e.state.route, { ignoreHistory:true });
            }
        }
    }

    return obj;
}();

jSuites.files = [];

jSuites.calendar = (function(el, options) {
    var obj = {};
    obj.options = {};

    // Global container
    if (! jSuites.calendar.current) {
        jSuites.calendar.current = null;
    }

    // Default configuration
    var defaults = {
        // Data
        data: null,
        // Inline or not
        type: null,
        // Restrictions
        validRange: null,
        // Starting weekday - 0 for sunday, 6 for saturday
        startingDay: null, 
        // Date format
        format: 'DD/MM/YYYY',
        // Allow keyboard date entry
        readonly: true,
        // Today is default
        today: false,
        // Show timepicker
        time: false,
        // Show the reset button
        resetButton: true,
        // Placeholder
        placeholder: '',
        // Translations can be done here
        months: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
        weekdays: ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],
        weekdays_short: ['S', 'M', 'T', 'W', 'T', 'F', 'S'],
        // Value
        value: null,
        // Events
        onclose: null,
        onchange: null,
        // Fullscreen (this is automatic set for screensize < 800)
        fullscreen: false,
        // Internal mode controller
        mode: null,
        position: null,
        // Create the calendar closed as default
        opened: false,
    };

    // Loop through our object
    for (var property in defaults) {
        if (options && options.hasOwnProperty(property)) {
            obj.options[property] = options[property];
        } else {
            obj.options[property] = defaults[property];
        }
    }

    // Value
    if (! obj.options.value) {
        if (el.tagName == 'INPUT' && el.value) {
            obj.options.value = el.value;
        }
    }

    // Make sure use upper case in the format
    obj.options.format = obj.options.format.toUpperCase();

    if (obj.options.value) {
        var date = obj.options.value.split(' ');
        var time = date[1];
        var date = date[0].split('-');
        var y = parseInt(date[0]);
        var m = parseInt(date[1]);
        var d = parseInt(date[2]);

        if (time) {
            var time = time.split(':');
            var h = parseInt(time[0]);
            var i = parseInt(time[1]);
        } else {
            var h = 0;
            var i = 0;
        }
    } else {
        var date = new Date();
        var y = date.getFullYear();
        var m = date.getMonth() + 1;
        var d = date.getDate();
        var h = date.getHours();
        var i = date.getMinutes();
    }

    // Current value
    obj.date = [ y, m, d, h, i, 0 ];

    // Two digits
    var two = function(value) {
        value = '' + value;
        if (value.length == 1) {
            value = '0' + value;
        }
        return value;
    }

    // Calendar elements
    var calendarReset = document.createElement('div');
    calendarReset.className = 'jcalendar-reset';
    calendarReset.innerHTML = 'Reset';

    var calendarConfirm = document.createElement('div');
    calendarConfirm.className = 'jcalendar-confirm';
    calendarConfirm.innerHTML = 'Done';

    var calendarControls = document.createElement('div');
    calendarControls.className = 'jcalendar-controls'
    if (obj.options.resetButton) {
        calendarControls.appendChild(calendarReset);
    }
    calendarControls.appendChild(calendarConfirm);

    var calendarContainer = document.createElement('div');
    calendarContainer.className = 'jcalendar-container';

    var calendarContent = document.createElement('div');
    calendarContent.className = 'jcalendar-content';
    calendarContent.appendChild(calendarControls);
    calendarContainer.appendChild(calendarContent);

    // Table container
    var calendarTableContainer = document.createElement('div');
    calendarTableContainer.className = 'jcalendar-table';
    calendarContent.appendChild(calendarTableContainer);

    // Main element
    if (el.tagName == 'INPUT') {
        var calendar = document.createElement('div');
    } else {
        var calendar = el;
    }
    calendar.className = 'jcalendar';
    calendar.appendChild(calendarContainer);

    // Previous button
    var calendarHeaderPrev = document.createElement('td');
    calendarHeaderPrev.setAttribute('colspan', '2');
    calendarHeaderPrev.className = 'jcalendar-prev';

    // Header with year and month
    var calendarLabelYear = document.createElement('span');
    calendarLabelYear.className = 'jcalendar-year';

    var calendarLabelMonth = document.createElement('span');
    calendarLabelMonth.className = 'jcalendar-month';

    var calendarHeaderTitle = document.createElement('td');
    calendarHeaderTitle.className = 'jcalendar-header';
    calendarHeaderTitle.setAttribute('colspan', '3');
    calendarHeaderTitle.appendChild(calendarLabelMonth);
    calendarHeaderTitle.appendChild(calendarLabelYear);

    var calendarHeaderNext = document.createElement('td');
    calendarHeaderNext.setAttribute('colspan', '2');
    calendarHeaderNext.className = 'jcalendar-next';

    var calendarHeaderRow = document.createElement('tr');
    calendarHeaderRow.appendChild(calendarHeaderPrev);
    calendarHeaderRow.appendChild(calendarHeaderTitle);
    calendarHeaderRow.appendChild(calendarHeaderNext);

    var calendarHeader = document.createElement('thead');
    calendarHeader.appendChild(calendarHeaderRow);

    var calendarBody = document.createElement('tbody');
    var calendarFooter = document.createElement('tfoot');

    // Calendar table
    var calendarTable = document.createElement('table');
    calendarTable.setAttribute('cellpadding', '0');
    calendarTable.setAttribute('cellspacing', '0');
    calendarTable.appendChild(calendarHeader);
    calendarTable.appendChild(calendarBody);
    calendarTable.appendChild(calendarFooter);
    calendarTableContainer.appendChild(calendarTable);

    var calendarSelectHour = document.createElement('select');
    calendarSelectHour.className = 'jcalendar-select';
    calendarSelectHour.onchange = function() {
        obj.date[3] = this.value; 
    }

    for (var i = 0; i < 24; i++) {
        var element = document.createElement('option');
        element.value = i;
        element.innerHTML = two(i);
        calendarSelectHour.appendChild(element);
    }

    var calendarSelectMin = document.createElement('select');
    calendarSelectMin.className = 'jcalendar-select';
    calendarSelectMin.onchange = function() {
        obj.date[4] = this.value; 
    }

    for (var i = 0; i < 60; i++) {
        var element = document.createElement('option');
        element.value = i;
        element.innerHTML = two(i);
        calendarSelectMin.appendChild(element);
    }

    // Footer controls
    var calendarControlsFooter = document.createElement('div');
    calendarControlsFooter.className = 'jcalendar-controls';

    var calendarControlsTime = document.createElement('div');
    calendarControlsTime.className = 'jcalendar-time';
    calendarControlsTime.style.maxWidth = '140px';
    calendarControlsTime.appendChild(calendarSelectHour);
    calendarControlsTime.appendChild(calendarSelectMin);

    var calendarControlsUpdateButton = document.createElement('input');
    calendarControlsUpdateButton.setAttribute('type', 'button');
    calendarControlsUpdateButton.className = 'jcalendar-update';
    calendarControlsUpdateButton.value = 'Update';

    var calendarControlsUpdate = document.createElement('div');
    calendarControlsUpdate.style.flexGrow = '10';
    calendarControlsUpdate.appendChild(calendarControlsUpdateButton);
    calendarControlsFooter.appendChild(calendarControlsTime);
    calendarControlsFooter.appendChild(calendarControlsUpdate);
    calendarContent.appendChild(calendarControlsFooter);

    var calendarBackdrop = document.createElement('div');
    calendarBackdrop.className = 'jcalendar-backdrop';
    calendar.appendChild(calendarBackdrop);

    // Update actions button
    var updateActions = function() {
        var currentDay = calendar.querySelector('.jcalendar-selected');

        if (currentDay && currentDay.classList.contains('jcalendar-disabled')) {
            calendarControlsUpdateButton.setAttribute('disabled', 'disabled');
            calendarSelectHour.setAttribute('disabled', 'disabled');
            calendarSelectMin.setAttribute('disabled', 'disabled');
        } else {
            calendarControlsUpdateButton.removeAttribute('disabled');
            calendarSelectHour.removeAttribute('disabled');
            calendarSelectMin.removeAttribute('disabled');
        }
    }

    // Methods
    obj.open = function (value) {
        if (! calendar.classList.contains('jcalendar-focus')) {
            if (jSuites.calendar.current) {
                jSuites.calendar.current.close();
            }
            // Current
            jSuites.calendar.current = obj;
            // Show calendar
            calendar.classList.add('jcalendar-focus');
            // Get days
            obj.getDays();
            // Hour
            if (obj.options.time) {
                calendarSelectHour.value = obj.date[3];
                calendarSelectMin.value = obj.date[4];
            }

            // Get the position of the corner helper
            if (jSuites.getWindowWidth() < 800 || obj.options.fullscreen) {
                // Full
                calendar.classList.add('jcalendar-fullsize');
                // Animation
                jSuites.slideBottom(calendarContent, 1);
            } else {
                const rect = el.getBoundingClientRect();
                const rectContent = calendarContent.getBoundingClientRect();

                if (obj.options.position) {
                    calendarContainer.style.position = 'fixed';
                    if (window.innerHeight < rect.bottom + rectContent.height) {
                        calendarContainer.style.top = (rect.top - (rectContent.height + 2)) + 'px';
                    } else {
                        calendarContainer.style.top = (rect.top + rect.height + 2) + 'px';
                    }
                    calendarContainer.style.left = rect.left + 'px';
                } else {
                    if (window.innerHeight < rect.bottom + rectContent.height) {
                        calendarContainer.style.bottom = (1 * rect.height + rectContent.height + 2) + 'px';
                    } else {
                        calendarContainer.style.top = 2 + 'px'; 
                    }
                }
            }
        }
    }

    obj.close = function (ignoreEvents, update) {
        if (jSuites.calendar.current) {
            // Current
            jSuites.calendar.current = null;

            if (update !== false) {
                var element = calendar.querySelector('.jcalendar-selected');

                if (typeof(update) == 'string') {
                    var value = update;
                } else if (element && element.classList.contains('jcalendar-disabled')) {
                    var value = obj.options.value
                } else {
                    var value = obj.getValue();
                }

                obj.setValue(value);
            }

            // Events
            if (! ignoreEvents && typeof(obj.options.onclose) == 'function') {
                obj.options.onclose(el);
            }

            // Hide
            calendar.classList.remove('jcalendar-focus');
        }

        return obj.options.value;
    }

    obj.prev = function() {
        // Check if the visualization is the days picker or years picker
        if (obj.options.mode == 'years') {
            obj.date[0] = obj.date[0] - 12;

            // Update picker table of days
            obj.getYears();
        } else {
            // Go to the previous month
            if (obj.date[1] < 2) {
                obj.date[0] = obj.date[0] - 1;
                obj.date[1] = 12;
            } else {
                obj.date[1] = obj.date[1] - 1;
            }

            // Update picker table of days
            obj.getDays();
        }
    }

    obj.next = function() {
        // Check if the visualization is the days picker or years picker
        if (obj.options.mode == 'years') {
            obj.date[0] = parseInt(obj.date[0]) + 12;

            // Update picker table of days
            obj.getYears();
        } else {
            // Go to the previous month
            if (obj.date[1] > 11) {
                obj.date[0] = parseInt(obj.date[0]) + 1;
                obj.date[1] = 1;
            } else {
                obj.date[1] = parseInt(obj.date[1]) + 1;
            }

            // Update picker table of days
            obj.getDays();
        }
    }

    obj.setValue = function(val) {
        if (! val) {
            val = '' + val;
        }
        // Values
        var newValue = val;
        var oldValue = obj.options.value;
        // Set label
        var value = obj.setLabel(newValue, obj.options.format);
        var date = newValue.split(' ');
        if (! date[1]) {
            date[1] = '00:00:00';
        }
        var time = date[1].split(':')
        var date = date[0].split('-');
        var y = parseInt(date[0]);
        var m = parseInt(date[1]);
        var d = parseInt(date[2]);
        var h = parseInt(time[0]);
        var i = parseInt(time[1]);
        obj.date = [ y, m, d, h, i, 0 ];
        var val = obj.setLabel(newValue, obj.options.format);

        if (oldValue != newValue) {
            // Input value
            if (el.tagName == 'INPUT') {
                el.value = val;
            }
            // New value
            obj.options.value = newValue;
            // On change
            if (typeof(obj.options.onchange) ==  'function') {
                obj.options.onchange(el, newValue, oldValue);
            }
        }

        obj.getDays();
    }

    obj.getValue = function() {
        if (obj.date) {
            if (obj.options.time) {
                return two(obj.date[0]) + '-' + two(obj.date[1]) + '-' + two(obj.date[2]) + ' ' + two(obj.date[3]) + ':' + two(obj.date[4]) + ':' + two(0);
            } else {
                return two(obj.date[0]) + '-' + two(obj.date[1]) + '-' + two(obj.date[2]) + ' ' + two(0) + ':' + two(0) + ':' + two(0);
            }
        } else {
            return "";
        }
    }

    /**
     *  Calendar
     */
    obj.update = function(element) {
        if (element.classList.contains('jcalendar-disabled')) {
            // Do nothing
        } else {
            obj.date[2] = element.innerText;

            if (! obj.options.time) {
                obj.close();
            } else {
                obj.date[3] = calendarSelectHour.value;
                obj.date[4] = calendarSelectMin.value;
            }

            var elements = calendar.querySelector('.jcalendar-selected');
            if (elements) {
                elements.classList.remove('jcalendar-selected');
            }
            element.classList.add('jcalendar-selected');
        }

        // Update
        updateActions();
    }

    /**
     * Set to blank
     */
    obj.reset = function() {
        // Close calendar
        obj.close(false, '');
    }

    /**
     * Get calendar days
     */
    obj.getDays = function() {
        // Mode
        obj.options.mode = 'days';

        // Setting current values in case of NULLs
        var date = new Date();

        // Current selection
        var year = obj.date && obj.date[0] ? obj.date[0] : parseInt(date.getFullYear());
        var month = obj.date && obj.date[1] ? obj.date[1] : parseInt(date.getMonth()) + 1;
        var day = obj.date && obj.date[2] ? obj.date[2] : parseInt(date.getDay());
        var hour = obj.date && obj.date[3] ? obj.date[3] : parseInt(date.getHours());
        var min = obj.date && obj.date[4] ? obj.date[4] : parseInt(date.getMinutes());

        // Selection container
        obj.date = [year, month, day, hour, min, 0 ];

        // Update title
        calendarLabelYear.innerHTML = year;
        calendarLabelMonth.innerHTML = obj.options.months[month - 1];

        // Current month and Year
        var isCurrentMonthAndYear = (date.getMonth() == month - 1) && (date.getFullYear() == year) ? true : false;
        var currentDay = date.getDate();

        // Number of days in the month
        var date = new Date(year, month, 0, 0, 0);
        var numberOfDays = date.getDate();

        // First day
        var date = new Date(year, month-1, 0, 0, 0);
        var firstDay = date.getDay() + 1;

        // Index value
        var index = obj.options.startingDay || 0;

        // First of day relative to the starting calendar weekday
        firstDay = firstDay - index;

        // Reset table
        calendarBody.innerHTML = '';

        // Weekdays Row
        var row = document.createElement('tr');
        row.setAttribute('align', 'center');
        calendarBody.appendChild(row);

        // Create weekdays row
        for (var i = 0; i < 7; i++) {
            var cell = document.createElement('td');
            cell.classList.add('jcalendar-weekday')
            cell.innerHTML = obj.options.weekdays_short[index];
            row.appendChild(cell);
            // Next week day
            index++;
            // Restart index
            if (index > 6) {
                index = 0;
            }
        }

        // Index of days
        var index = 0;
        var d = 0;
 
        // Calendar table
        for (var j = 0; j < 5; j++) {
            // Reset cells container
            var row = document.createElement('tr');
            row.setAttribute('align', 'center');
            // Data control
            var emptyRow = true;
            // Create cells
            for (var i = 0; i < 7; i++) {
                // Create cell
                var cell = document.createElement('td');
                cell.classList.add('jcalendar-set-day');

                if (index >= firstDay && index < (firstDay + numberOfDays)) {
                    // Day cell
                    d++;
                    cell.innerHTML = d;

                    // Selected
                    if (d == day) {
                        cell.classList.add('jcalendar-selected');
                    }

                    // Current selection day is today
                    if (isCurrentMonthAndYear && currentDay == d) {
                        cell.style.fontWeight = 'bold';
                    }

                    // Current selection day
                    var current = jSuites.calendar.now(new Date(year, month-1, d), true);

                    // Available ranges
                    if (obj.options.validRange) {
                        if (! obj.options.validRange[0] || current >= obj.options.validRange[0]) {
                            var test1 = true;
                        } else {
                            var test1 = false;
                        }

                        if (! obj.options.validRange[1] || current <= obj.options.validRange[1]) {
                            var test2 = true;
                        } else {
                            var test2 = false;
                        }

                        if (! (test1 && test2)) {
                            cell.classList.add('jcalendar-disabled');
                        }
                    }

                    // Control
                    emptyRow = false;
                }
                // Day cell
                row.appendChild(cell);
                // Index
                index++;
            }

            // Add cell to the calendar body
            if (emptyRow == false) {
                calendarBody.appendChild(row);
            }
        }

        // Show time controls
        if (obj.options.time) {
            calendarControlsTime.style.display = '';
        } else {
            calendarControlsTime.style.display = 'none';
        }

        // Update
        updateActions();
    }

    obj.getMonths = function() {
        // Mode
        obj.options.mode = 'months';

        // Loading month labels
        var months = obj.options.months;

        // Update title
        calendarLabelYear.innerHTML = obj.date[0];
        calendarLabelMonth.innerHTML = '';

        // Create months table
        var html = '<td colspan="7"><table width="100%"><tr align="center">';

        for (i = 0; i < 12; i++) {
            if ((i > 0) && (!(i % 4))) {
                html += '</tr><tr align="center">';
            }

            var month = parseInt(i) + 1;
            html += '<td class="jcalendar-set-month" data-value="' + month + '">' + months[i] +'</td>';
        }

        html += '</tr></table></td>';

        calendarBody.innerHTML = html;
    }

    obj.getYears = function() { 
        // Mode
        obj.options.mode = 'years';

        // Array of years
        var y = [];
        for (i = 0; i < 25; i++) {
            y[i] = parseInt(obj.date[0]) + (i - 12);
        }

        // Assembling the year tables
        var html = '<td colspan="7"><table width="100%"><tr align="center">';

        for (i = 0; i < 25; i++) {
            if ((i > 0) && (!(i % 5))) {
                html += '</tr><tr align="center">';
            }
            html += '<td class="jcalendar-set-year">'+ y[i] +'</td>';
        }

        html += '</tr></table></td>';

        calendarBody.innerHTML = html;
    }

    obj.setLabel = function(value, format) {
        return jSuites.calendar.getDateString(value, format);
    }

    obj.fromFormatted = function (value, format) {
        return jSuites.calendar.extractDateFromString(value, format);
    }

    var mouseUpControls = function(e) {
        var action = e.target.className;

        // Object id
        if (action == 'jcalendar-prev') {
            obj.prev();
            e.stopPropagation();
            e.preventDefault();
        } else if (action == 'jcalendar-next') {
            obj.next();
            e.stopPropagation();
            e.preventDefault();
        } else if (action == 'jcalendar-month') {
            obj.getMonths();
            e.stopPropagation();
            e.preventDefault();
        } else if (action == 'jcalendar-year') {
            obj.getYears();
            e.stopPropagation();
            e.preventDefault();
        } else if (action == 'jcalendar-set-year') {
            obj.date[0] = e.target.innerText;
            obj.getDays();
            e.stopPropagation();
            e.preventDefault();
        } else if (action == 'jcalendar-set-month') {
            obj.date[1] = parseInt(e.target.getAttribute('data-value'));
            obj.getDays();
            e.stopPropagation();
            e.preventDefault();
        } else if (action == 'jcalendar-confirm' || action == 'jcalendar-update') {
            obj.close();
            e.stopPropagation();
            e.preventDefault();
        } else if (action == 'jcalendar-close') {
            obj.close();
            e.stopPropagation();
            e.preventDefault();
        } else if (action == 'jcalendar-backdrop') {
            obj.close(false, false);
            e.stopPropagation();
            e.preventDefault();
        } else if (action == 'jcalendar-reset') {
            obj.reset();
            e.stopPropagation();
            e.preventDefault();
        } else if (e.target.classList.contains('jcalendar-set-day')) {
            if (e.target.innerText) {
                obj.update(e.target);
                e.stopPropagation();
                e.preventDefault();
            }
        }
    }

    var keyUpControls = function(e) {
        if (e.target.value && e.target.value.length > 3) {
            var test = jSuites.calendar.extractDateFromString(e.target.value, obj.options.format);
            if (test) {
                if (e.target.getAttribute('data-completed') == 'true') {
                    obj.setValue(test);
                }
            }
        }
    }

    // Handle events
    el.addEventListener("keyup", keyUpControls);

    // Add global events
    calendar.addEventListener("swipeleft", function(e) {
        jSuites.slideLeft(calendarTable, 0, function() {
            obj.next();
            jSuites.slideRight(calendarTable, 1);
        });
        e.preventDefault();
        e.stopPropagation();
    });

    calendar.addEventListener("swiperight", function(e) {
        jSuites.slideRight(calendarTable, 0, function() {
            obj.prev();
            jSuites.slideLeft(calendarTable, 1);
        });
        e.preventDefault();
        e.stopPropagation();
    });

    if ('ontouchend' in document.documentElement === true) {
        calendar.addEventListener("touchend", mouseUpControls);

        el.addEventListener("touchend", function(e) {
            obj.open();
        });
    } else {
        calendar.addEventListener("mouseup", mouseUpControls);

        el.addEventListener("mouseup", function(e) {
            obj.open();
        });
    }

    // Append element to the DOM
    if (el.tagName == 'INPUT') {
        el.parentNode.insertBefore(calendar, el.nextSibling);
        // Add properties
        el.setAttribute('autocomplete', 'off');
        el.setAttribute('data-mask', obj.options.format.toLowerCase());

        if (obj.options.readonly) {
            el.setAttribute('readonly', 'readonly');
        }
        if (obj.options.placeholder) {
            el.setAttribute('placeholder', obj.options.placeholder);
        }
        // Element
        el.classList.add('jcalendar-input');
        // Value
        el.value = obj.setLabel(obj.getValue(), obj.options.format);
    }

    // Keep object available from the node
    el.calendar = obj;

    if (obj.options.opened == true) {
        obj.open();
    }

    return obj;
});

jSuites.calendar.prettify = function(d, texts) {
    if (! texts) {
        var texts = {
            justNow: 'Just now',
            xMinutesAgo: '{0}m ago',
            xHoursAgo: '{0}h ago',
            xDaysAgo: '{0}d ago',
            xWeeksAgo: '{0}w ago',
            xMonthsAgo: '{0} mon ago',
            xYearsAgo: '{0}y ago',
        }
    }

    var d1 = new Date();
    var d2 = new Date(d);
    var total = parseInt((d1 - d2) / 1000 / 60);

    String.prototype.format = function(o) {
        return this.replace('{0}', o);
    }

    if (total == 0) {
        var text = texts.justNow;
    } else if (total < 90) {
        var text = texts.xMinutesAgo.format(total);
    } else if (total < 1440) { // One day
        var text = texts.xHoursAgo.format(Math.round(total/60));
    } else if (total < 20160) { // 14 days
        var text = texts.xDaysAgo.format(Math.round(total / 1440));
    } else if (total < 43200) { // 30 days
        var text = texts.xWeeksAgo.format(Math.round(total / 10080));
    } else if (total < 1036800) { // 24 months
        var text = texts.xMonthsAgo.format(Math.round(total / 43200));
    } else { // 24 months+
        var text = texts.xYearsAgo.format(Math.round(total / 525600));
    }

    return text;
}

jSuites.calendar.prettifyAll = function() {
    var elements = document.querySelectorAll('.prettydate');
    for (var i = 0; i < elements.length; i++) {
        if (elements[i].getAttribute('data-date')) {
            elements[i].innerHTML = jSuites.calendar.prettify(elements[i].getAttribute('data-date'));
        } else {
            elements[i].setAttribute('data-date', elements[i].innerHTML);
            elements[i].innerHTML = jSuites.calendar.prettify(elements[i].innerHTML);
        }
    }
}

jSuites.calendar.now = function(date, dateOnly) {
    if (! date) {
        var date = new Date();
    }
    var y = date.getFullYear();
    var m = date.getMonth() + 1;
    var d = date.getDate();
    var h = date.getHours();
    var i = date.getMinutes();
    var s = date.getSeconds();

    // Two digits
    var two = function(value) {
        value = '' + value;
        if (value.length == 1) {
            value = '0' + value;
        }
        return value;
    }

    if (dateOnly == true) {
        return two(y) + '-' + two(m) + '-' + two(d);
    } else {
        return two(y) + '-' + two(m) + '-' + two(d) + ' ' + two(h) + ':' + two(i) + ':' + two(s);
    }
}

// Helper to extract date from a string
jSuites.calendar.extractDateFromString = function(date, format) {
    var v1 = '' + date;
    var v2 = format.replace(/[0-9]/g,'');

    var test = 1;

    // Get year
    var y = v2.search("YYYY");
    y = v1.substr(y,4);
    if (parseInt(y) != y) {
        test = 0;
    }

    // Get month
    var m = v2.search("MM");
    m = v1.substr(m,2);
    if (parseInt(m) != m || d > 12) {
        test = 0;
    }

    // Get day
    var d = v2.search("DD");
    d = v1.substr(d,2);
    if (parseInt(d) != d  || d > 31) {
        test = 0;
    }

    // Get hour
    var h = v2.search("HH");
    if (h >= 0) {
        h = v1.substr(h,2);
        if (! parseInt(h) || h > 23) {
            h = '00';
        }
    } else {
        h = '00';
    }
    
    // Get minutes
    var i = v2.search("MI");
    if (i >= 0) {
        i = v1.substr(i,2);
        if (! parseInt(i) || i > 59) {
            i = '00';
        }
    } else {
        i = '00';
    }

    // Get seconds
    var s = v2.search("SS");
    if (s >= 0) {
        s = v1.substr(s,2);
        if (! parseInt(s) || s > 59) {
            s = '00';
        }
    } else {
        s = '00';
    }

    if (test == 1 && date.length == v2.length) {
        // Update source
        var data = y + '-' + m + '-' + d + ' ' + h + ':' +  i + ':' + s;

        return data;
    }

    return '';
}

// Helper to convert date into string
jSuites.calendar.getDateString = function(value, format) {
    // Default calendar
    if (! format) {
        var format = 'DD/MM/YYYY';
    }

    if (value) {
        var d = ''+value;
        d = d.split(' ');

        var h = '';
        var m = '';
        var s = '';

        if (d[1]) {
            h = d[1].split(':');
            m = h[1] ? h[1] : '00';
            s = h[2] ? h[2] : '00';
            h = h[0] ? h[0] : '00';
        } else {
            h = '00';
            m = '00';
            s = '00';
        }

        d = d[0].split('-');

        if (d[0] && d[1] && d[2] && d[0] > 0 && d[1] > 0 && d[1] < 13 && d[2] > 0 && d[2] < 32) {
            var calendar = new Date(d[0], d[1]-1, d[2]);
            var weekday = new Array('Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday');
            var months = new Array('Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec');

            d[1] = (d[1].length < 2 ? '0' : '') + d[1];
            d[2] = (d[2].length < 2 ? '0' : '') + d[2];
            h = (h.length < 2 ? '0' : '') + h;
            m = (m.length < 2 ? '0' : '') + m;
            s = (s.length < 2 ? '0' : '') + s;

            value = format;
            value = value.replace('WD', weekday[calendar.getDay()]);
            value = value.replace('DD', d[2]);
            value = value.replace('MM', d[1]);
            value = value.replace('YYYY', d[0]);
            value = value.replace('YY', d[0].substring(2,4));
            value = value.replace('MON', months[parseInt(d[1])-1].toUpperCase());

            if (h) {
                value = value.replace('HH24', h);
            }

            if (h > 12) {
                value = value.replace('HH12', h - 12);
                value = value.replace('HH', h);
            } else {
                value = value.replace('HH12', h);
                value = value.replace('HH', h);
            }

            value = value.replace('MI', m);
            value = value.replace('MM', m);
            value = value.replace('SS', s);
        } else {
            value = '';
        }
    }

    return value;
}

jSuites.calendar.isOpen = function(e) {
    if (jSuites.calendar.current) {
        if (! e.target.className || e.target.className.indexOf('jcalendar') == -1) {
            jSuites.calendar.current.close(false, false);
        }
    }
}

if ('ontouchstart' in document.documentElement === true) {
    document.addEventListener("touchstart", jSuites.calendar.isOpen);
} else {
    document.addEventListener("mousedown", jSuites.calendar.isOpen);
}

jSuites.color = (function(el, options) {
    var obj = {};
    obj.options = {};
    obj.values = [];

    // Global container
    if (! jSuites.color.current) {
        jSuites.color.current = null;
    }

    /**
     * @typedef {Object} defaults
     * @property {(string|Array)} value - Initial value of the compontent
     * @property {string} placeholder - The default instruction text on the element
     * @property {requestCallback} onchange - Method to be execute after any changes on the element
     * @property {requestCallback} onclose - Method to be execute when the element is closed
     */
    var defaults = {
        placeholder: '',
        value: null,
        onclose: null,
        onchange: null,
        closeOnChange: true,
    };

    // Loop through our object
    for (var property in defaults) {
        if (options && options.hasOwnProperty(property)) {
            obj.options[property] = options[property];
        } else {
            obj.options[property] = defaults[property];
        }
    }

    var palette = {
          "red": {
            "50": "#ffebee",
            "100": "#ffcdd2",
            "200": "#ef9a9a",
            "300": "#e57373",
            "400": "#ef5350",
            "500": "#f44336",
            "600": "#e53935",
            "700": "#d32f2f",
            "800": "#c62828",
            "900": "#b71c1c",
          },
          "pink": {
            "50": "#fce4ec",
            "100": "#f8bbd0",
            "200": "#f48fb1",
            "300": "#f06292",
            "400": "#ec407a",
            "500": "#e91e63",
            "600": "#d81b60",
            "700": "#c2185b",
            "800": "#ad1457",
            "900": "#880e4f",
          },
          "purple": {
            "50": "#f3e5f5",
            "100": "#e1bee7",
            "200": "#ce93d8",
            "300": "#ba68c8",
            "400": "#ab47bc",
            "500": "#9c27b0",
            "600": "#8e24aa",
            "700": "#7b1fa2",
            "800": "#6a1b9a",
            "900": "#4a148c",
          },
          "indigo": {
            "50": "#e8eaf6",
            "100": "#c5cae9",
            "200": "#9fa8da",
            "300": "#7986cb",
            "400": "#5c6bc0",
            "500": "#3f51b5",
            "600": "#3949ab",
            "700": "#303f9f",
            "800": "#283593",
            "900": "#1a237e",
          },
          "blue": {
            "50": "#e3f2fd",
            "100": "#bbdefb",
            "200": "#90caf9",
            "300": "#64b5f6",
            "400": "#42a5f5",
            "500": "#2196f3",
            "600": "#1e88e5",
            "700": "#1976d2",
            "800": "#1565c0",
            "900": "#0d47a1",
          },
          "cyan": {
            "50": "#e0f7fa",
            "100": "#b2ebf2",
            "200": "#80deea",
            "300": "#4dd0e1",
            "400": "#26c6da",
            "500": "#00bcd4",
            "600": "#00acc1",
            "700": "#0097a7",
            "800": "#00838f",
            "900": "#006064",
          },
          "teal": {
            "50": "#e0f2f1",
            "100": "#b2dfdb",
            "200": "#80cbc4",
            "300": "#4db6ac",
            "400": "#26a69a",
            "500": "#009688",
            "600": "#00897b",
            "700": "#00796b",
            "800": "#00695c",
            "900": "#004d40",
          },
          "green": {
            "50": "#e8f5e9",
            "100": "#c8e6c9",
            "200": "#a5d6a7",
            "300": "#81c784",
            "400": "#66bb6a",
            "500": "#4caf50",
            "600": "#43a047",
            "700": "#388e3c",
            "800": "#2e7d32",
            "900": "#1b5e20",
          },
          "lightgreen": {
            "50": "#f1f8e9",
            "100": "#dcedc8",
            "200": "#c5e1a5",
            "300": "#aed581",
            "400": "#9ccc65",
            "500": "#8bc34a",
            "600": "#7cb342",
            "700": "#689f38",
            "800": "#558b2f",
            "900": "#33691e",
          },
          "lime": {
            "50": "#f9fbe7",
            "100": "#f0f4c3",
            "200": "#e6ee9c",
            "300": "#dce775",
            "400": "#d4e157",
            "500": "#cddc39",
            "600": "#c0ca33",
            "700": "#afb42b",
            "800": "#9e9d24",
            "900": "#827717",
          },
          "yellow": {
            "50": "#fffde7",
            "100": "#fff9c4",
            "200": "#fff59d",
            "300": "#fff176",
            "400": "#ffee58",
            "500": "#ffeb3b",
            "600": "#fdd835",
            "700": "#fbc02d",
            "800": "#f9a825",
            "900": "#f57f17",
          },
          "amber": {
            "50": "#fff8e1",
            "100": "#ffecb3",
            "200": "#ffe082",
            "300": "#ffd54f",
            "400": "#ffca28",
            "500": "#ffc107",
            "600": "#ffb300",
            "700": "#ffa000",
            "800": "#ff8f00",
            "900": "#ff6f00",
          },
          "orange": {
            "50": "#fff3e0",
            "100": "#ffe0b2",
            "200": "#ffcc80",
            "300": "#ffb74d",
            "400": "#ffa726",
            "500": "#ff9800",
            "600": "#fb8c00",
            "700": "#f57c00",
            "800": "#ef6c00",
            "900": "#e65100",
          },
          "deeporange": {
            "50": "#fbe9e7",
            "100": "#ffccbc",
            "200": "#ffab91",
            "300": "#ff8a65",
            "400": "#ff7043",
            "500": "#ff5722",
            "600": "#f4511e",
            "700": "#e64a19",
            "800": "#d84315",
            "900": "#bf360c",
          },
          "brown": {
            "50": "#efebe9",
            "100": "#d7ccc8",
            "200": "#bcaaa4",
            "300": "#a1887f",
            "400": "#8d6e63",
            "500": "#795548",
            "600": "#6d4c41",
            "700": "#5d4037",
            "800": "#4e342e",
            "900": "#3e2723"
          },
          "grey": {
            "50": "#fafafa",
            "100": "#f5f5f5",
            "200": "#eeeeee",
            "300": "#e0e0e0",
            "400": "#bdbdbd",
            "500": "#9e9e9e",
            "600": "#757575",
            "700": "#616161",
            "800": "#424242",
            "900": "#212121"
          },
          "bluegrey": {
            "50": "#eceff1",
            "100": "#cfd8dc",
            "200": "#b0bec5",
            "300": "#90a4ae",
            "400": "#78909c",
            "500": "#607d8b",
            "600": "#546e7a",
            "700": "#455a64",
            "800": "#37474f",
            "900": "#263238"
          }
    };

    var x = 0;
    var y = 0;
    var colors = [];

    var col = Object.keys(palette);
    var shade = Object.keys(palette[col[0]]);

    for (var i = 0; i < col.length; i++) {
        for (var j = 0; j < shade.length; j++) {
            if (! colors[j]) {
                colors[j] = [];
            }
            colors[j][i] = palette[col[i]][shade[j]];
        }
    };

    // Value
    if (obj.options.value) {
        el.value = obj.options.value;
    }

    // Table container
    var container = document.createElement('div');
    container.className = 'jcolor';

    // Table container
    var backdrop = document.createElement('div');
    backdrop.className = 'jcolor-backdrop';
    container.appendChild(backdrop);

    // Content
    var content = document.createElement('div');
    content.className = 'jcolor-content';

    // Close button
    var closeButton  = document.createElement('div');
    closeButton.className = 'jcolor-close';
    closeButton.innerHTML = 'Done';
    closeButton.onclick = function() {
        obj.close();
    }
    content.appendChild(closeButton);

    // Table pallete
    var table = document.createElement('table');
    table.setAttribute('cellpadding', '7');
    table.setAttribute('cellspacing', '0');

    for (var i = 0; i < colors.length; i++) {
        var tr = document.createElement('tr');
        for (var j = 0; j < colors[i].length; j++) {
            var td = document.createElement('td');
            td.style.backgroundColor = colors[i][j];
            td.setAttribute('data-value', colors[i][j]);
            td.innerHTML = '';
            tr.appendChild(td);

            // Selected color
            if (obj.options.value == colors[i][j]) {
                td.classList.add('jcolor-selected');
            }

            // Possible values
            obj.values[colors[i][j]] = td;
        }
        table.appendChild(tr);
    }

    /**
     * Open color pallete
     */
    obj.open = function() {
        if (jSuites.color.current) {
            if (jSuites.color.current != obj) {
                jSuites.color.current.close();
            }
        }

        if (! jSuites.color.current) {
            // Persist element
            jSuites.color.current = obj;
            // Show colorpicker
            container.classList.add('jcolor-focus');

            const rectContent = content.getBoundingClientRect();

            if (jSuites.getWindowWidth() < 800) {
                content.style.top = '';
                content.classList.add('jcolor-fullscreen');
                jSuites.slideBottom(content, 1);
                backdrop.style.display = 'block';
            } else {
                if (content.classList.contains('jcolor-fullscreen')) {
                    content.classList.remove('jcolor-fullscreen');
                    backdrop.style.display = '';
                }

                const rect = el.getBoundingClientRect();

                if (window.innerHeight < rect.bottom + rectContent.height) {
                    content.style.top = -1 * (rectContent.height + rect.height + 2) + 'px';
                } else {
                    content.style.top = '2px';
                }
            }

            container.focus();
        }
    }

    /**
     * Close color pallete
     */
    obj.close = function(ignoreEvents) {
        if (jSuites.color.current) {
            jSuites.color.current = null;
            if (! ignoreEvents && typeof(obj.options.onclose) == 'function') {
                obj.options.onclose(el);
            }
            container.classList.remove('jcolor-focus');
        }

        // Make sure backdrop is hidden
        backdrop.style.display = '';

        return obj.options.value;
    }

    /**
     * Set value
     */
    obj.setValue = function(color) {
        if (color) {
            el.value = color;
            obj.options.value = color;
        }

        // Remove current selecded mark
        var selected = container.querySelector('.jcolor-selected');
        if (selected) {
            selected.classList.remove('jcolor-selected');
        }

        // Mark cell as selected
        obj.values[color].classList.add('jcolor-selected');

        // Onchange
        if (typeof(obj.options.onchange) == 'function') {
            obj.options.onchange(el, color);
        }

        if (obj.options.closeOnChange == true) {
            obj.close();
        }
    }

    /**
     * Get value
     */
    obj.getValue = function() {
        return obj.options.value;
    }

    /**
     * If element is focus open the picker
     */
    el.addEventListener("focus", function(e) {
        obj.open();
    });

    el.addEventListener("mousedown", function(e) {
        if (! jSuites.color.current) {
            setTimeout(function() {
        obj.open();
                e.preventDefault();
            }, 200);
        }
    });

    // Select color
    container.addEventListener("mouseup", function(e) {
        if (e.target.tagName == 'TD') {
            jSuites.color.current.setValue(e.target.getAttribute('data-value'));

            if (jSuites.color.current) {
                jSuites.color.current.close();
            }
        }
    });

    // Close controller
    document.addEventListener("mousedown", function(e) {
        if (jSuites.color.current) {
            var element = jSuites.getElement(e.target, 'jcolor');
            if (! element) {
                jSuites.color.current.close();
            }
        }
    });

    // Possible to focus the container
    container.setAttribute('tabindex', '900');

    // Placeholder
    if (obj.options.placeholder) {
        el.setAttribute('placeholder', obj.options.placeholder);
    }

    // Append to the table
    content.appendChild(table);
    container.appendChild(content);

    // Insert picker after the element
    if (el.tagName == 'INPUT') {
        el.parentNode.insertBefore(container, el.nextSibling);
    } else {
        el.appendChild(container);
    }

    // Keep object available from the node
    el.color = obj;

    return obj;
});


jSuites.contextmenu = (function(el, options) {
    var obj = {};
    obj.options = {};

    // Default configuration
    var defaults = {
        items: null,
        onclick: null,
    };

    // Loop through our object
    for (var property in defaults) {
        if (options && options.hasOwnProperty(property)) {
            obj.options[property] = options[property];
        } else {
            obj.options[property] = defaults[property];
        }
    }

    // Class definition
    el.classList.add('jcontextmenu');
    // Focusable
    el.setAttribute('tabindex', '900');

    /**
     * Open contextmenu
     */
    obj.open = function(e, items) {
        if (items) {
            // Update content
            obj.options.items = items;
            // Create items
            obj.create(items);
        }
        // Coordinates
        if (e.target) {
            var x = e.clientX;
            var y = e.clientY;
        } else {
            var x = e.x;
            var y = e.y;
        }

        el.classList.add('jcontextmenu-focus');
        el.focus();

        const rect = el.getBoundingClientRect();

        if (window.innerHeight < y + rect.height) {
            el.style.top = (y - rect.height) + 'px';
        } else {
            el.style.top = y + 'px';
        }

        if (window.innerWidth < x + rect.width) {
            if (x - rect.width > 0) {
                el.style.left = (x - rect.width) + 'px';
            } else {
                el.style.left = '10px';
            }
        } else {
            el.style.left = x + 'px';
        }
    }

    /**
     * Close menu
     */
    obj.close = function() {
        if (el.classList.contains('jcontextmenu-focus')) {
            el.classList.remove('jcontextmenu-focus');
        }
    }

    /**
     * Create items based on the declared objectd
     * @param {object} items - List of object
     */
    obj.create = function(items) {
        // Update content
        el.innerHTML = '';

        // Append items
        for (var i = 0; i < items.length; i++) {
            if (items[i].type && items[i].type == 'line') {
                var itemContainer = document.createElement('hr');
            } else {
                var itemContainer = document.createElement('div');
                var itemText = document.createElement('a');
                itemText.innerHTML = items[i].title;

                if (items[i].disabled) {
                    itemContainer.className = 'jcontextmenu-disabled';
                } else if (items[i].onclick) {
                    itemContainer.method = items[i].onclick;
                    itemContainer.addEventListener("mouseup", function() {
                        // Execute method
                        this.method(this);
                    });
                }
                itemContainer.appendChild(itemText);

                if (items[i].shortcut) {
                    var itemShortCut = document.createElement('span');
                    itemShortCut.innerHTML = items[i].shortcut;
                    itemContainer.appendChild(itemShortCut);
                }
            }

            el.appendChild(itemContainer);
        }
    }

    if (typeof(obj.options.onclick) == 'function') {
        el.addEventListener('click', function(e) {
            obj.options.onclick(obj);
        });
    }

    el.addEventListener('blur', function(e) {
        setTimeout(function() {
            obj.close();
        }, 120);
    });

    window.addEventListener("mousewheel", function() {
        obj.close();
    });

    // Create items
    if (obj.options.items) {
        obj.create(obj.options.items);
    }

    el.contextmenu = obj;

    return obj;
});

jSuites.contextmenu.getElement = function(element) {
    var foundId = 0;

    function path (element) {
        if (element.parentNode && element.getAttribute('aria-contextmenu-id')) {
            foundId = element.getAttribute('aria-contextmenu-id')
        } else {
            if (element.parentNode) {
                path(element.parentNode);
            }
        }
    }

    path(element);

    return foundId;
}

document.addEventListener("contextmenu", function(e) {
    var id = jSuites.contextmenu.getElement(e.target);
    if (id) {
        var element = document.querySelector('#' + id);
        if (! element) {
            console.error('JSUITES: Contextmenu id not found');
        } else {
            element.contextmenu.open(e);
            e.preventDefault();
        }
    }
});

/**
 * Dialog v1.0.1
 * Author: paul.hodel@gmail.com
 * https://github.com/paulhodel/jtools
 */
 
jSuites.dialog = (function() {
    var obj = {};
    obj.options = {};

    var dialog = document.createElement('div');
    dialog.setAttribute('tabindex', '901');
    dialog.className = 'jdialog';
    dialog.id = 'dialog';

    var dialogHeader = document.createElement('div');
    dialogHeader.className = 'jdialog-header';

    var dialogTitle = document.createElement('div');
    dialogTitle.className = 'jdialog-title';
    dialogHeader.appendChild(dialogTitle);

    var dialogMessage = document.createElement('div');
    dialogMessage.className = 'jdialog-message';
    dialogHeader.appendChild(dialogMessage);

    var dialogFooter = document.createElement('div');
    dialogFooter.className = 'jdialog-footer';

    var dialogContainer = document.createElement('div');
    dialogContainer.className = 'jdialog-container';
    dialogContainer.appendChild(dialogHeader);
    dialogContainer.appendChild(dialogFooter);

    // Confirm
    var dialogConfirm = document.createElement('div');
    var dialogConfirmButton = document.createElement('input');
    dialogConfirmButton.value = obj.options.confirmLabel;
    dialogConfirmButton.type = 'button';
    dialogConfirmButton.onclick = function() {
        if (typeof(obj.options.onconfirm) == 'function') {
            obj.options.onconfirm();
        }
        obj.close();
    };
    dialogConfirm.appendChild(dialogConfirmButton);
    dialogFooter.appendChild(dialogConfirm);

    // Cancel
    var dialogCancel = document.createElement('div');
    var dialogCancelButton = document.createElement('input');
    dialogCancelButton.value = obj.options.cancelLabel;
    dialogCancelButton.type = 'button';
    dialogCancelButton.onclick = function() {
        if (typeof(obj.options.oncancel) == 'function') {
            obj.options.oncancel();
        }
        obj.close();
    }
    dialogCancel.appendChild(dialogCancelButton);
    dialogFooter.appendChild(dialogCancel);

    // Dialog
    dialog.appendChild(dialogContainer);

    obj.open = function(options) {
        obj.options = options;

        if (obj.options.title) {
            dialogTitle.innerHTML = obj.options.title;
        }

        if (obj.options.message) {
            dialogMessage.innerHTML = obj.options.message;
        }

        if (! obj.options.confirmLabel) {
            obj.options.confirmLabel = 'OK';
        }
        dialogConfirmButton.value = obj.options.confirmLabel;

        if (! obj.options.cancelLabel) {
            obj.options.cancelLabel = 'Cancel';
        }
        dialogCancelButton.value = obj.options.cancelLabel;

        if (obj.options.type == 'confirm') {
            dialogCancelButton.parentNode.style.display = '';
        } else {
            dialogCancelButton.parentNode.style.display = 'none';
        }

        // Append element to the app
        dialog.style.opacity = 100;

        // Append to the page
        if (jSuites.el) {
            jSuites.el.appendChild(dialog);
        } else {
            document.body.appendChild(dialog);
        }

        // Focus
        dialog.focus();

        // Show
        setTimeout(function() {
            dialogContainer.style.opacity = 100;
        }, 0);
    };

    obj.close = function() {
        dialog.style.opacity = 0;
        dialogContainer.style.opacity = 0;
        setTimeout(function() {
            dialog.remove();
        }, 100);
    };

    return obj;
})();

jSuites.confirm = (function(message, onconfirm) {
    if (jSuites.getWindowWidth() < 800) {
        jSuites.dialog.open({
            type: 'confirm',
            message: message,
            title: 'Confirmation',
            onconfirm: onconfirm,
        });
    } else {
        if (confirm(message)) {
            onconfirm();
        }
    }
});

jSuites.alert = function(message) {
    if (jSuites.getWindowWidth() < 800) {
        jSuites.dialog.open({
            title:'Alert',
            message:message,
        });
    } else {
        alert(message);
    }
}


jSuites.dropdown = (function(el, options) {
    var obj = {};
    obj.options = {};

    // If the element is a SELECT tag, create a configuration object
    if (el.tagName == 'SELECT') {
        var ret = jSuites.dropdown.extractFromDom(el, options);
        el = ret.el;
        options = ret.options;
    }

    // Default configuration
    var defaults = {
        url: null,
        data: [],
        multiple: false,
        autocomplete: false,
        type: null,
        width: null,
        opened: false,
        value: null,
        placeholder: '',
        position: false,
        onchange: null,
        onload: null,
        onopen: null,
        onclose: null,
        onblur: null,
    };

    // Loop through our object
    for (var property in defaults) {
        if (options && options.hasOwnProperty(property)) {
            obj.options[property] = options[property];
        } else {
            obj.options[property] = defaults[property];
        }
    }

    // Global container
    if (! jSuites.dropdown.current) {
        jSuites.dropdown.current = null;
    }

    // Containers
    obj.items = [];
    obj.groups = [];
    obj.selected = [];

    // Create dropdown
    el.classList.add('jdropdown');
 
    if (obj.options.type == 'searchbar') {
        el.classList.add('jdropdown-searchbar');
    } else if (obj.options.type == 'list') {
        el.classList.add('jdropdown-list');
    } else if (obj.options.type == 'picker') {
        el.classList.add('jdropdown-picker');
    } else {
        if (jSuites.getWindowWidth() < 800) {
            el.classList.add('jdropdown-picker');
            obj.options.type = 'picker';
        } else {
            if (obj.options.width) {
                el.style.width = obj.options.width;
                el.style.minWidth = obj.options.width;
            }
            el.classList.add('jdropdown-default');
            obj.options.type = 'default';
        }
    }

    // Header container
    var containerHeader = document.createElement('div');
    containerHeader.className = 'jdropdown-container-header';

    // Header
    var header = document.createElement('input');
    header.className = 'jdropdown-header';
    if (typeof(obj.options.onblur) == 'function') {
        header.onblur = function() {
            obj.options.onblur(el);
        }
    }

    // Container
    var container = document.createElement('div');
    container.className = 'jdropdown-container';

    // Dropdown content
    var content = document.createElement('div');
    content.className = 'jdropdown-content';

    // Close button
    var closeButton  = document.createElement('div');
    closeButton.className = 'jdropdown-close';
    closeButton.innerHTML = 'Done';

    // Create backdrop
    var backdrop  = document.createElement('div');
    backdrop.className = 'jdropdown-backdrop';

    // Autocomplete
    if (obj.options.autocomplete == true) {
        el.setAttribute('data-autocomplete', true);

        // Handler
        var keyTimer = null;
        header.addEventListener('keyup', function(e) {
            if (keyTimer) {
                clearTimeout(keyTimer);
            }
            keyTimer = setTimeout(function() {
                obj.find(header.value);
                keyTimer = null;
            }, 500);

            if (! el.classList.contains('jdropdown-focus')) {
                if (e.which > 65) {
                    obj.open();
                }
            }
        });
    } else {
        header.setAttribute('readonly', 'readonly');
    }

    // Place holder
    if (! obj.options.placeholder && el.getAttribute('placeholder')) {
        obj.options.placeholder = el.getAttribute('placeholder');
    }

    if (obj.options.placeholder) {
        header.setAttribute('placeholder', obj.options.placeholder);
    }

    // Append elements
    containerHeader.appendChild(header);
    if (obj.options.type == 'searchbar') {
        containerHeader.appendChild(closeButton);
    } else {
        container.appendChild(closeButton);
    }
    container.appendChild(content);
    el.appendChild(containerHeader);
    el.appendChild(container);
    el.appendChild(backdrop);

    /**
     * Init dropdown
     */
    obj.init = function() {
        if (obj.options.url) {
            jSuites.ajax({
                url: obj.options.url,
                method: 'GET',
                dataType: 'json',
                success: function(data) {
                    if (data) {
                        // Set data
                        obj.setData(data);
                        // Set value
                        if (obj.options.value != null) {
                            obj.setValue(obj.options.value);
                        }
                        // Onload method
                        if (typeof(obj.options.onload) == 'function') {
                            obj.options.onload(el, obj, data);
                        }
                    }
                }
            });
        } else {
            // Set data
            obj.setData();
            // Set value
            if (obj.options.value != null) {
                obj.setValue(obj.options.value);
            }
            // Onload
            if (typeof(obj.options.onload) == 'function') {
                obj.options.onload(el, obj, data);
            }
        }

        // Open dropdown
        if (obj.options.opened == true) {
            obj.open();
        }
    }

    obj.getUrl = function() {
        return obj.options.url;
    }

    obj.setUrl = function(url) {
        obj.options.url = url;

        jSuites.ajax({
            url: obj.options.url,
            method: 'GET',
            dataType: 'json',
            success: function(data) {
                obj.setData(data);
            }
        });
    }

    /**
     * Create a new item
     */
    obj.createItem = function(data) {
        // Create item
        var item = {};
        item.element = document.createElement('div');
        item.element.className = 'jdropdown-item';
        item.value = data.id;
        item.text = data.name;
        item.textLowerCase = '' + data.name.toLowerCase();

        // Image
        if (data.image) {
            var image = document.createElement('img');
            image.className = 'jdropdown-image';
            image.src = data.image;
            if (! data.title) {
               image.classList.add('jdropdown-image-small');
            }
            item.element.appendChild(image);
        }

        // Set content
        var node = document.createElement('div');
        node.className = 'jdropdown-description';
        node.innerHTML = data.name;

        // Title
        if (data.title) {
            var title = document.createElement('div');
            title.className = 'jdropdown-title';
            title.innerHTML = data.title;
            node.appendChild(title);
        }

        // Add node to item
        item.element.appendChild(node);

        return item;
    }

    obj.setData = function(data) {
        // Update data
        if (data) {
            obj.options.data = data;
        }

        // Data
        var data = obj.options.data;

        // Remove content from the DOM
        container.removeChild(content);

        // Make sure the content container is blank
        content.innerHTML = '';

        // Reset
        obj.reset();

        // Reset items
        obj.items = [];

        // Helpers
        var items = [];
        var groups = [];

        // Create elements
        if (data.length) {
            // Prepare data
            for (var i = 0; i < data.length; i++) {
                // Compatibility
                if (typeof(data[i]) != 'object') {
                    // Correct format
                    obj.options.data[i] = data[i] = { id: data[i], name: data[i] };
                }

                // Process groups
                if (data[i].group) {
                    if (! groups[data[i].group]) {
                        groups[data[i].group] = [];
                    }
                    groups[data[i].group].push(i);
                } else {
                    items.push(i);
                }
            }

            // Groups
            var groupNames = Object.keys(groups);

            // Append groups in case exists
            if (groupNames.length > 0) {
                for (var i = 0; i < groupNames.length; i++) {
                    // Group container
                    var group = document.createElement('div');
                    group.className = 'jdropdown-group';
                    // Group name
                    var groupName = document.createElement('div');
                    groupName.className = 'jdropdown-group-name';
                    groupName.innerHTML = groupNames[i];
                    // Group arrow
                    var groupArrow = document.createElement('i');
                    groupArrow.className = 'jdropdown-group-arrow jdropdown-group-arrow-down';
                    groupName.appendChild(groupArrow);
                    // Group items
                    var groupContent = document.createElement('div');
                    groupContent.className = 'jdropdown-group-items';
                    for (var j = 0; j < groups[groupNames[i]].length; j++) {
                        var item = obj.createItem(data[groups[groupNames[i]][j]]);
                        groupContent.appendChild(item.element);
                        // Items
                        obj.items.push(item);
                    }
                    // Group itens
                    group.appendChild(groupName);
                    group.appendChild(groupArrow);
                    group.appendChild(groupContent);
                    content.appendChild(group);
                }
            }

            if (items.length) {
                for (var i = 0; i < items.length; i++) {
                    var item = obj.createItem(data[items[i]]);
                    obj.items.push(item);
                    content.appendChild(item.element);
                }
            }

            // Create the Indexes
            for (var i = 0; i < obj.items.length; i++) {
                obj.items[i].element.setAttribute('data-index', i);
            }
        }

        // Re-insert the content to the container
        container.appendChild(content);
    }

    obj.getText = function(asArray) {
        // Result
        var result = [];
        // Append options
        for (var i = 0; i < obj.selected.length; i++) {
            if (obj.items[obj.selected[i]]) {
                result.push(obj.items[obj.selected[i]].text);
            }
        }

        if (asArray) {
            return result;
        } else {
            return result.join('; ');
        }
    }

    obj.getValue = function(asArray) {
        // Result
        var result = [];
        // Append options
        for (var i = 0; i < obj.selected.length; i++) {
            if (obj.items[obj.selected[i]]) {
                result.push(obj.items[obj.selected[i]].value);
            }
        }

        if (asArray) {
            return result;
        } else {
            return result.join(';');
        }
    }

    obj.setValue = function(value) {
        // Remove values
        for (var i = 0; i < obj.selected.length; i++) {
            obj.items[obj.selected[i]].element.classList.remove('jdropdown-selected')
        } 

        // Reset selected
        obj.selected = [];

        // Set values
        if (value != null) {
            if (Array.isArray(value)) {
                for (var i = 0; i < obj.items.length; i++) {
                    for (var j = 0; j < value.length; j++) {
                        if (obj.items[i].value == value[j]) {
                            // Keep index of the selected item
                            obj.selected.push(i);
                            // Visual selection
                            obj.items[i].element.classList.add('jdropdown-selected');
                        }
                    }
                }
            } else {
                for (var i = 0; i < obj.items.length; i++) {
                    if (obj.items[i].value == value) {
                        // Keep index of the selected item
                        obj.selected.push(i);
                        // Visual selection
                        obj.items[i].element.classList.add('jdropdown-selected');
                    }
                }
            }
        }

        // Update labels
        obj.updateLabel();
    }

    obj.selectIndex = function(index) {
        // Only select those existing elements
        if (obj.items && obj.items[index]) {
            var index = index = parseInt(index);
            // Current selection
            var oldValue = obj.getValue();
            var oldLabel = obj.getText();

            // Remove cursor style
            if (obj.currentIndex != null) {
                obj.items[obj.currentIndex].element.classList.remove('jdropdown-cursor');
            }
            // Set cursor style
            obj.items[index].element.classList.add('jdropdown-cursor');

            // Update cursor position
            obj.currentIndex = index;

            // Focus behaviour
            if (! obj.options.multiple) {
                // Unselect option
                if (obj.items[index].element.classList.contains('jdropdown-selected')) {
                    // Reset selected
                    obj.resetSelected();
                } else {
                    // Reset selected
                    obj.resetSelected();
                    // Update selected item
                    obj.items[index].element.classList.add('jdropdown-selected');
                    // Add to the selected list
                    obj.selected.push(index);
                    // Close
                    obj.close();
                }
            } else {
                // Toggle option
                if (obj.items[index].element.classList.contains('jdropdown-selected')) {
                    obj.items[index].element.classList.remove('jdropdown-selected');
                    // Remove from selected list
                    var indexToRemove = obj.selected.indexOf(index);
                    // Remove select
                    obj.selected.splice(indexToRemove, 1);
                } else {
                    // Select element
                    obj.items[index].element.classList.add('jdropdown-selected');
                    // Add to the selected list
                    obj.selected.push(index);
                }

                // Update labels for multiple dropdown
                if (! obj.options.autocomplete) {
                    obj.updateLabel();
                }
            }

            // Current selection
            var newValue = obj.getValue();
            var newLabel = obj.getText();

            // Events
            if (typeof(obj.options.onchange) == 'function') {
                obj.options.onchange(el, index, oldValue, newValue, oldLabel, newLabel);
            }
        }
    }

    obj.selectItem = function(item) {
        if (jSuites.dropdown.current) {
            var index = item.getAttribute('data-index');
            if (index != null) {
                obj.selectIndex(index);
            }
        }
    }

    obj.find = function(str) {
        // Force lowercase
        var str = str ? str.toLowerCase() : null;

        // Append options
        for (var i = 0; i < obj.items.length; i++) {
            if (str == null || obj.items[i].textLowerCase.indexOf(str) != -1) {
                obj.items[i].element.style.display = '';
            } else {
                if (obj.selected.indexOf(i) == -1) {
                    obj.items[i].element.style.display = 'none';
                } else {
                    obj.items[i].element.style.display = '';
                }
            }
        }

        var numVisibleItems = function(items) {
            var visible = 0;
            for (var j = 0; j < items.length; j++) {
                if (items[j].style.display != 'none') {
                    visible++;
                }
            }
            return visible;
        }

        // Hide groups
        /*for (var i = 0; i < obj.groups.length; i++) {
            if (numVisibleItems(obj.groups[i].querySelectorAll('.jdropdown-item'))) {
                obj.groups[i].children[0].style.display = '';
            } else {
                obj.groups[i].children[0].style.display = 'none';
            }
        }*/
    }

    obj.updateLabel = function() {
        // Update label
        header.value = obj.getText();
    }

    obj.open = function() {
        if (jSuites.dropdown.current != el) {
            if (jSuites.dropdown.current) {
                jSuites.dropdown.current.dropdown.close();
            }
            jSuites.dropdown.current = el;
        }

        // Focus
        if (! el.classList.contains('jdropdown-focus')) {
            // Add focus
            el.classList.add('jdropdown-focus');

            // Animation
            if (jSuites.getWindowWidth() < 800) {
                if (obj.options.type == null || obj.options.type == 'picker') {
                    jSuites.slideBottom(container, 1);
                }
            }

            // Filter
            if (obj.options.autocomplete == true) {
                // Redo search
                obj.find();
                // Clear search field
                header.value = '';
                header.focus();
            }

            // Set cursor for the first or first selected element
            var cursor = (obj.selected && obj.selected[0]) ? obj.selected[0] : 0;
            obj.updateCursor(cursor);

            // Container Size
            if (! obj.options.type || obj.options.type == 'default') {
                const rect = el.getBoundingClientRect();
                const rectContainer = container.getBoundingClientRect();

                if (obj.options.position) {
                    container.style.position = 'fixed';
                    if (window.innerHeight < rect.bottom + rectContainer.height) {
                        container.style.top = '';
                        container.style.bottom = (window.innerHeight - rect.top ) + 1 + 'px';
                    } else {
                        container.style.top = rect.bottom + 'px';
                        container.style.bottom = '';
                    }
                    container.style.left = rect.left + 'px';
                } else {
                    if (window.innerHeight < rect.bottom + rectContainer.height) {
                        container.style.top = '';
                        container.style.bottom = rect.height + 1 + 'px';
                    } else {
                        container.style.top = '';
                        container.style.bottom = '';
                    }
                }

                container.style.minWidth = rect.width + 'px';
            }
        }

        // Events
        if (typeof(obj.options.onopen) == 'function') {
            obj.options.onopen(el);
        }
    }

    obj.close = function(ignoreEvents) {
        if (jSuites.dropdown.current) {
            // Remove controller
            jSuites.dropdown.current = null
            // Remove cursor
            obj.resetCursor();
            // Update labels
            obj.updateLabel();
            // Events
            if (! ignoreEvents && typeof(obj.options.onclose) == 'function') {
                obj.options.onclose(el);
            }
            // Blur
            if (header.blur) {
                header.blur();
            }
            // Remove focus
            el.classList.remove('jdropdown-focus');
        }

        return obj.getValue();
    }

    /**
     * Update position cursor
     */
    obj.updateCursor = function(index) {
        // Set new cursor
        if (obj.items && obj.items[index] && obj.items[index].element) {
            // Reset cursor
            obj.resetCursor();

            // Set new cursor
            obj.items[index].element.classList.add('jdropdown-cursor');

            // Update position
            obj.currentIndex = parseInt(index);
    
            // Update scroll to the cursor element
            var container = content.scrollTop;
            var element = obj.items[obj.currentIndex].element;
            content.scrollTop = element.offsetTop - element.scrollTop + element.clientTop - 95;
        }
    }

    /**
     * Reset cursor
     */
    obj.resetCursor = function() {
        // Remove current cursor
        if (obj.currentIndex != null) {
            // Remove visual cursor
            if (obj.items && obj.items[obj.currentIndex]) {
                obj.items[obj.currentIndex].element.classList.remove('jdropdown-cursor');
            }
            // Reset cursor
            obj.currentIndex = null;
        }
    }

    /**
     * Reset cursor
     */
    obj.resetSelected = function() {
        // Unselected all
        if (obj.selected) {
            // Remove visual selection
            for (var i = 0; i < obj.selected.length; i++) {
                if (obj.items[obj.selected[i]]) {
                    obj.items[obj.selected[i]].element.classList.remove('jdropdown-selected');
                }
            }
            // Reset current selected items
            obj.selected = [];
        }
    }

    /**
     * Reset cursor and selected items
     */
    obj.reset = function() {
        // Reset cursor
        obj.resetCursor();

        // Reset selected
        obj.resetSelected();

        // Update labels
        obj.updateLabel();
    }

    /**
     * First visible item
     */
    obj.firstVisible = function() {
        var newIndex = null;
        for (var i = 0; i < obj.items.length; i++) {
            if (obj.items[i].element.style.display != 'none') {
                newIndex = i;
                break;
            }
        }

        if (newIndex == null) {
            return false;
        }

        obj.updateCursor(newIndex);
    }

    /**
     * Navigation
     */
    obj.first = function() {
        var newIndex = null;
        for (var i = obj.currentIndex - 1; i >= 0; i--) {
            if (obj.items[i].element.style.display != 'none') {
                newIndex = i;
            }
        }

        if (newIndex == null) {
            return false;
        }

        obj.updateCursor(newIndex);
    }

    obj.last = function() {
        var newIndex = null;
        for (var i = obj.currentIndex + 1; i < obj.items.length; i++) {
            if (obj.items[i].element.style.display != 'none') {
                newIndex = i;
            }
        }

        if (newIndex == null) {
            return false;
        }

        obj.updateCursor(newIndex);
    }

    obj.next = function() {
        var newIndex = null;
        for (var i = obj.currentIndex + 1; i < obj.items.length; i++) {
            if (obj.items[i].element.style.display != 'none') {
                newIndex = i;
                break;
            }
        }

        if (newIndex == null) {
            return false;
        }

        obj.updateCursor(newIndex);
    }

    obj.prev = function() {
        var newIndex = null;
        for (var i = obj.currentIndex - 1; i >= 0; i--) {
            if (obj.items[i].element.style.display != 'none') {
                newIndex = i;
                break;
            }
        }

        if (newIndex == null) {
            return false;
        }

        obj.updateCursor(newIndex);
    }

    if (! jSuites.dropdown.hasEvents) {
        if ('ontouchsend' in document.documentElement === true) {
            document.addEventListener('touchsend', jSuites.dropdown.mouseup);
        } else {
            document.addEventListener('mouseup', jSuites.dropdown.mouseup);
        }
        document.addEventListener('keydown', jSuites.dropdown.onkeydown);

        jSuites.dropdown.hasEvents = true;
    }

    // Start dropdown
    obj.init();

    // Keep object available from the node
    el.dropdown = obj;

    return obj;
});

jSuites.dropdown.hasEvents = false;

jSuites.dropdown.mouseup = function(e) {
    var element = jSuites.getElement(e.target, 'jdropdown');
    if (element) {
        var dropdown = element.dropdown;
        if (e.target.classList.contains('jdropdown-header')) {
            if (element.classList.contains('jdropdown-focus') && element.classList.contains('jdropdown-default')) {
                dropdown.close();
            } else {
                dropdown.open();
            }
        } else if (e.target.classList.contains('jdropdown-group-name')) {
            var items = e.target.nextSibling.children;
            if (e.target.nextSibling.style.display != 'none') {
                for (var i = 0; i < items.length; i++) {
                    if (items[i].style.display != 'none') {
                        dropdown.selectItem(items[i]);
                    }
                }
            }
        } else if (e.target.classList.contains('jdropdown-group-arrow')) {
            if (e.target.classList.contains('jdropdown-group-arrow-down')) {
                e.target.classList.remove('jdropdown-group-arrow-down');
                e.target.classList.add('jdropdown-group-arrow-up');
                e.target.parentNode.nextSibling.style.display = 'none';
            } else {
                e.target.classList.remove('jdropdown-group-arrow-up');
                e.target.classList.add('jdropdown-group-arrow-down');
                e.target.parentNode.nextSibling.style.display = '';
            }
        } else if (e.target.classList.contains('jdropdown-item')) {
            dropdown.selectItem(e.target);
        } else if (e.target.classList.contains('jdropdown-image')) {
            dropdown.selectIndex(e.target.parentNode.getAttribute('data-index'));
        } else if (e.target.classList.contains('jdropdown-description')) {
            dropdown.selectIndex(e.target.parentNode.getAttribute('data-index'));
        } else if (e.target.classList.contains('jdropdown-title')) {
            dropdown.selectIndex(e.target.parentNode.parentNode.getAttribute('data-index'));
        } else if (e.target.classList.contains('jdropdown-close') || e.target.classList.contains('jdropdown-backdrop')) {
            // Close
            dropdown.close();
        }

        e.stopPropagation();
        e.preventDefault();
    } else {
        if (jSuites.dropdown.current) {
            jSuites.dropdown.current.dropdown.close();
        }
    }
}


// Keydown controls
jSuites.dropdown.onkeydown = function(e) {
    if (jSuites.dropdown.current) {
        // Element
        var element = jSuites.dropdown.current.dropdown;
        // Index
        var index = element.currentIndex;

        if (e.shiftKey) {

        } else {
            if (e.which == 13 || e.which == 27 || e.which == 35 || e.which == 36 || e.which == 38 || e.which == 40) {
                // Move cursor
                if (e.which == 13) {
                    element.selectIndex(index)
                } else if (e.which == 38) {
                    if (index == null) {
                        element.firstVisible();
                    } else if (index > 0) {
                        element.prev();
                    }
                } else if (e.which == 40) {
                    if (index == null) {
                        element.firstVisible();
                    } else if (index + 1 < element.options.data.length) {
                        element.next();
                    }
                } else if (e.which == 36) {
                    element.first();
                } else if (e.which == 35) {
                    element.last();
                } else if (e.which == 27) {
                    element.close();
                }

                e.stopPropagation();
                e.preventDefault();
            }
        }
    }
}

jSuites.dropdown.extractFromDom = function(el, options) {
    // Keep reference
    var select = el;
    if (! options) {
        options = {};
    }
    // Prepare configuration
    if (el.getAttribute('multiple') && (! options || options.multiple == undefined)) {
        options.multiple = true;
    }
    if (el.getAttribute('placeholder') && (! options || options.placeholder == undefined)) {
        options.placeholder = el.getAttribute('placeholder');
    }
    if (el.getAttribute('data-autocomplete') && (! options || options.autocomplete == undefined)) {
        options.autocomplete = true;
    }
    if (! options || options.width == undefined) {
        options.width = el.offsetWidth;
    }
    if (el.value && (! options || options.value == undefined)) {
        options.value = el.value;
    }
    if (! options || options.data == undefined) {
        options.data = [];
        for (var j = 0; j < el.children.length; j++) {
            if (el.children[j].tagName == 'OPTGROUP') {
                for (var i = 0; i < el.children[j].children.length; i++) {
                    options.data.push({
                        id: el.children[j].children[i].value,
                        name: el.children[j].children[i].innerHTML,
                        group: el.children[j].getAttribute('label'),
                    });
                }
            } else {
                options.data.push({
                    id: el.children[j].value,
                    name: el.children[j].innerHTML,
                });
            }
        }
    }
    if (! options || options.onchange == undefined) {
        options.onchange = function(a,b,c,d) {
            if (options.multiple == true) {
                if (obj.items[b].classList.contains('jdropdown-selected')) {
                    select.options[b].setAttribute('selected', 'selected');
                } else {
                    select.options[b].removeAttribute('selected');
                }
            } else {
                select.value = d;
            }
        }
    }
    // Create DIV
    var div = document.createElement('div');
    el.parentNode.insertBefore(div, el);
    el.style.display = 'none';
    el = div;

    return { el:el, options:options };
}

/**
 * (c) jTools Text Editor
 * https://github.com/paulhodel/jtools
 *
 * @author: Paul Hodel <paul.hodel@gmail.com>
 * @description: Inline richtext editor
 */

jSuites.editor = (function(el, options) {
    var obj = {};
    obj.options = {};

    // Default configuration
    var defaults = {
        // Initial HTML content
        value: null,
        // Initial snippet
        snippet: null,
        // Add toolbar
        toolbar: null,
        // Max height
        maxHeight: null,
        // Website parser is to read websites and images from cross domain
        remoteParser: null,
        // Key from youtube to read properties from URL
        youtubeKey: null,
        // User list
        userSearch: null,
        // Parse URL
        parseURL: false,
        // Accept drop files
        dropZone: true,
        dropAsAttachment: false,
        acceptImages: true,
        acceptFiles: false,
        maxFileSize: 5000000, 
        // Border
        border: true,
        padding: true,
        focus: false,
        // Events
        onclick: null,
        onfocus: null,
        onblur: null,
        onload: null,
        onenter: null,
        onkeyup: null,
        onkeydown: null,
    };

    // Loop through our object
    for (var property in defaults) {
        if (options && options.hasOwnProperty(property)) {
            obj.options[property] = options[property];
        } else {
            obj.options[property] = defaults[property];
        }
    }

    // Private controllers
    var imageResize = 0;
    var editorTimer = null;
    var editorAction = null;

    // Make sure element is empty
    el.innerHTML = '';

    // Prepare container
    el.classList.add('jeditor-container');

    // Padding
    if (obj.options.padding == true) {
        el.classList.add('jeditor-padding');
    }

    // Border
    if (obj.options.border == false) {
        el.style.border = '0px';
    }

    // Snippet
    var snippet = document.createElement('div');
    snippet.className = 'snippet';
    snippet.setAttribute('contenteditable', false);

    // Toolbar
    var toolbar = document.createElement('div');
    toolbar.className = 'jeditor-toolbar';

    // Create editor
    var editor = document.createElement('div');
    editor.setAttribute('contenteditable', true);
    editor.setAttribute('spellcheck', false);
    editor.className = 'jeditor';

    // Max height
    if (obj.options.maxHeight) {
        editor.style.overflowY = 'auto';
        editor.style.maxHeight = obj.options.maxHeight;
    }

    // Set editor initial value
    if (obj.options.value) {
        var value = obj.options.value;
    } else {
        var value = el.innerHTML ? el.innerHTML : ''; 
    }

    if (! value) {
        var value = '<br>';
    }

    /**
     * Extract images from a HTML string
     */
    var extractImageFromHtml = function(html) {
        // Create temp element
        var div = document.createElement('div');
        div.innerHTML = html;

        // Extract images
        var img = div.querySelectorAll('img');

        if (img.length) {
            for (var i = 0; i < img.length; i++) {
                obj.addImage(img[i].src);
            }
        }
    }

    /**
     * Insert node at caret
     */
    var insertNodeAtCaret = function(newNode) {
        var sel, range;

        if (window.getSelection) {
            sel = window.getSelection();
            if (sel.rangeCount) {
                range = sel.getRangeAt(0);
                var selectedText = range.toString();
                range.deleteContents();
                range.insertNode(newNode); 
                // move the cursor after element
                range.setStartAfter(newNode);
                range.setEndAfter(newNode); 
                sel.removeAllRanges();
                sel.addRange(range);
            }
        }
    }

    /**
     * Append snippet or thumbs in the editor
     * @Param object data
     */
    var appendElement = function(data) {
        // Reset snippet
        snippet.innerHTML = '';

        if (data.image) {
            var div = document.createElement('div');
            div.className = 'snippet-image';
            div.setAttribute('data-k', 'image');
            snippet.appendChild(div);

            var image = document.createElement('img');
            image.src = data.image;
            div.appendChild(image);
        }

        var div = document.createElement('div');
        div.className = 'snippet-title';
        div.setAttribute('data-k', 'title');
        div.innerHTML = data.title;
        snippet.appendChild(div);

        var div = document.createElement('div');
        div.className = 'snippet-description';
        div.setAttribute('data-k', 'description');
        div.innerHTML = data.description;
        snippet.appendChild(div);

        var div = document.createElement('div');
        div.className = 'snippet-host';
        div.setAttribute('data-k', 'host');
        div.innerHTML = data.host;
        snippet.appendChild(div);

        var div = document.createElement('div');
        div.className = 'snippet-url';
        div.setAttribute('data-k', 'url');
        div.innerHTML = data.url;
        snippet.appendChild(div);

        editor.appendChild(snippet);
    }

    var verifyEditor = function() {
        clearTimeout(editorTimer);
        editorTimer = setTimeout(function() {
            var snippet = editor.querySelector('.snippet');
            var thumbsContainer = el.querySelector('.jeditor-thumbs-container');

            if (! snippet && ! thumbsContainer) {
                var html = editor.innerHTML.replace(/\n/g, ' ');
                var container = document.createElement('div');
                container.innerHTML = html;
                var thumbsContainer = container.querySelector('.jeditor-thumbs-container');
                if (thumbsContainer) {
                    thumbsContainer.remove();
                }
                var text = container.innerText; 
                var url = jSuites.editor.detectUrl(text);

                if (url) {
                    if (url[0].substr(-3) == 'jpg' || url[0].substr(-3) == 'png' || url[0].substr(-3) == 'gif') {
                        if (jSuites.editor.getDomain(url[0]) == window.location.hostname) {
                            obj.importImage(url[0], '');
                        } else {
                            obj.importImage(obj.options.remoteParser + url[0], '');
                        }
                    } else {
                        var id = jSuites.editor.youtubeParser(url[0]);

                        if (id) {
                            obj.getYoutube(id);
                        } else {
                            obj.getWebsite(url[0]);
                        }
                    }
                }
            }
        }, 1000);
    }

    obj.parseContent = function() {
        verifyEditor();
    }

    /**
     * Get metadata from a youtube video
     */
    obj.getYoutube = function(id) {
        if (! obj.options.youtubeKey) {
            console.error('The youtubeKey is not defined');
        } else {
            jSuites.ajax({
                url: 'https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics&key=' + obj.options.youtubeKey + '&id=' + id,
                method: 'GET',
                dataType: 'json',
                success: function(result) {
                    // Only valid elements to be appended
                    if (result.items && result.items[0]) {
                        var p = {
                            title: '',
                            description: '',
                            image: '',
                            host: 'www.youtube.com',
                            url: 'https://www.youtube.com?watch=' + id,
                        }
                        if (result.items[0].snippet.title) {
                            p.title = result.items[0].snippet.title;
                        }
                        if (result.items[0].snippet.description) {
                            p.description = result.items[0].snippet.description;

                            if (p.description.length > 150) {
                                p.description = p.description.substr(0, 150) + '...';
                            }
                        }
                        if (result.items[0].snippet.thumbnails.medium.url) {
                            p.image = result.items[0].snippet.thumbnails.medium.url;
                        }

                        appendElement(p);
                    }
                }
            });
        }
    }

    /**
     * Get meta information from a website
     */
    obj.getWebsite = function(url) {
        if (! obj.options.remoteParser) {
            console.log('The remoteParser is not defined');
        } else {
            jSuites.ajax({
                url: obj.options.remoteParser + encodeURI(url.trim()),
                method: 'GET',
                dataType: 'json',
                success: function(result) {
                    var p = {
                        title: '',
                        description: '',
                        image: '',
                        host: url,
                        url: url,
                    }

                    if (result.title) {
                        p.title = result.title;
                    }
                    if (result.description) {
                        p.description = result.description;
                    }
                    if (result.image) {
                        p.image = result.image;
                    } else if (result['og:image']) {
                        p.image = result['og:image'];
                    }
                    if (result.host) {
                        p.host = result.host;
                    }
                    if (result.url) {
                        p.url = result.url;
                    }

                    appendElement(p);
                }
            });
        }
    }

    /**
     * Set editor value
     */
    obj.setData = function(html) {
        editor.innerHTML = html;
        cursor();
    }

    /**
     * Get editor data
     */
    obj.getData = function(json) {
        if (! json) {
            var data = editor.innerHTML;
        } else {
            var data = {
                content : '',
            }

            // Get tag users
            var tagged = editor.querySelectorAll('.post-tag');
            if (tagged.length) {
                data.users = [];
                for (var i = 0; i < tagged.length; i++) {
                    var userId = tagged[i].getAttribute('data-user');
                    if (userId) {
                        data.users.push(userId);
                    }
                }
                data.users = data.users.join(',');
            }

            if (snippet.innerHTML) {
                var index = 0;
                data.snippet = {};
                for (var i = 0; i < snippet.children.length; i++) {
                    // Get key from element
                    var key = snippet.children[i].getAttribute('data-k');
                    if (key) {
                        if (key == 'image') {
                            data.snippet.image = snippet.children[i].children[0].getAttribute('src');
                        } else {
                            data.snippet[key] = snippet.children[i].innerHTML;
                        }
                    }
                }

                snippet.innerHTML = '';
                snippet.remove();
            }

            var text = editor.innerHTML;
            text = text.replace(/<br>/g, "\n");
            text = text.replace(/<\/div>/g, "<\/div>\n");
            text = text.replace(/<(?:.|\n)*?>/gm, "");
            data.content = text.trim();
            data = JSON.stringify(data);
        }

        return data;
    }

    // Reset
    obj.reset = function() {
        editor.innerHTML = '';
    }

    obj.addPdf = function(data) {
        if (data.result.substr(0,4) != 'data') {
            console.error('Invalid source');
        } else {
            var canvas = document.createElement('canvas');
            canvas.width = 60;
            canvas.height = 60;

            var img = new Image();
            var ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

            canvas.toBlob(function(blob) {
                var newImage = document.createElement('img');
                newImage.src = window.URL.createObjectURL(blob);
                newImage.setAttribute('data-extension', 'pdf');
                if (data.name) {
                    newImage.setAttribute('data-name', data.name);
                }
                if (data.size) {
                    newImage.setAttribute('data-size', data.size);
                }
                if (data.date) {
                    newImage.setAttribute('data-date', data.date);
                }
                newImage.className = 'jfile pdf';

                insertNodeAtCaret(newImage);
                jSuites.files[newImage.src] = data.result.substr(data.result.indexOf(',') + 1);
            });
        }
    }

    obj.addImage = function(src, name, size, date) {
        if (src.substr(0,4) != 'data' && ! obj.options.remoteParser) {
            console.error('remoteParser not defined in your initialization');
        } else {
            // This is to process cross domain images
            if (src.substr(0,4) == 'data') {
                var extension = src.split(';')
                extension = extension[0].split('/');
                extension = extension[1];
            } else {
                var extension = src.substr(src.lastIndexOf('.') + 1);
                // Work for cross browsers
                src = obj.options.remoteParser + src;
            }

            var img = new Image();

            img.onload = function onload() {
                var canvas = document.createElement('canvas');
                canvas.width = img.width;
                canvas.height = img.height;

                var ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

                canvas.toBlob(function(blob) {
                    var newImage = document.createElement('img');
                    newImage.src = window.URL.createObjectURL(blob);
                    newImage.setAttribute('tabindex', '900');
                    newImage.setAttribute('data-extension', extension);
                    if (name) {
                        newImage.setAttribute('data-name', name);
                    }
                    if (size) {
                        newImage.setAttribute('data-size', size);
                    }
                    if (date) {
                        newImage.setAttribute('data-date', date);
                    }
                    newImage.className = 'jfile';
                    var content = canvas.toDataURL();
                    insertNodeAtCaret(newImage);

                    jSuites.files[newImage.src] = content.substr(content.indexOf(',') + 1);
                });
            };

            img.src = src;
        }
    }

    obj.addFile = function(files) {
        var reader = [];

        for (var i = 0; i < files.length; i++) {
            if (files[i].size > obj.options.maxFileSize) {
                alert('The file is too big');
            } else {
                // Only PDF or Images
                var type = files[i].type.split('/');

                if (type[0] == 'image') {
                    type = 1;
                } else if (type[1] == 'pdf') {
                    type = 2;
                } else {
                    type = 0;
                }

                if (type) {
                    // Create file
                    reader[i] = new FileReader();
                    reader[i].index = i;
                    reader[i].type = type;
                    reader[i].name = files[i].name;
                    reader[i].date = files[i].lastModified;
                    reader[i].size = files[i].size;
                    reader[i].addEventListener("load", function (data) {
                        // Get result
                        if (data.target.type == 2) {
                            if (obj.options.acceptFiles == true) {
                                obj.addPdf(data.target);
                            }
                        } else {
                            obj.addImage(data.target.result, data.target.name, data.total, data.target.lastModified);
                        }
                    }, false);

                    reader[i].readAsDataURL(files[i])
                } else {
                    alert('The extension is not allowed');
                }
            }
        }
    }

    // Destroy
    obj.destroy = function() {
        editor.removeEventListener('mouseup', editorMouseUp);
        editor.removeEventListener('mousedown', editorMouseDown);
        editor.removeEventListener('mousemove', editorMouseMove);
        editor.removeEventListener('keyup', editorKeyUp);
        editor.removeEventListener('keydown', editorKeyDown);
        editor.removeEventListener('dragstart', editorDragStart);
        editor.removeEventListener('dragenter', editorDragEnter);
        editor.removeEventListener('dragover', editorDragOver);
        editor.removeEventListener('drop', editorDrop);
        editor.removeEventListener('paste', editorPaste);

        if (typeof(obj.options.onblur) == 'function') {
            editor.removeEventListener('blur', editorBlur);
        }
        if (typeof(obj.options.onfocus) == 'function') {
            editor.removeEventListener('focus', editorFocus);
        }

        el.editor = null;
        el.classList.remove('jeditor-container');

        toolbar.remove();
        snippet.remove();
        editor.remove();
    }

    var isLetter = function (str) {
        var regex = /([\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0\u08A2-\u08AC\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA697\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA793\uA7A0-\uA7AA\uA7F8-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]+)/g;
        return str.match(regex) ? 1 : 0;
    }

    // Event handlers
    var editorMouseUp = function(e) {
        editorAction = false;
    }

    var editorMouseDown = function(e) {
        var close = function(snippet) {
            var rect = snippet.getBoundingClientRect();
            if (rect.width - (e.clientX - rect.left) < 40 && e.clientY - rect.top < 40) {
                snippet.innerHTML = '';
                snippet.remove();
            }
        }

        if (e.target.tagName == 'IMG') {
            if (e.target.style.cursor) {
                var rect = e.target.getBoundingClientRect();
                editorAction = {
                    e: e.target,
                    x: e.clientX,
                    y: e.clientY,
                    w: rect.width,
                    h: rect.height,
                    d: e.target.style.cursor,
                }

                if (! e.target.style.width) {
                    e.target.style.width = rect.width + 'px';
                }

                if (! e.target.style.height) {
                    e.target.style.height = rect.height + 'px';
                }

                var s = window.getSelection();
                if (s.rangeCount) {
                    for (var i = 0; i < s.rangeCount; i++) {
                        s.removeRange(s.getRangeAt(i));
                    }
                }
            } else {
                editorAction = true;
            }
        } else { 
            if (e.target.classList.contains('snippet')) {
                close(e.target);
            } else if (e.target.parentNode.classList.contains('snippet')) {
                close(e.target.parentNode);
            }

            editorAction = true;
        }
    }

    var editorMouseMove = function(e) {
        if (e.target.tagName == 'IMG') {
            if (e.target.getAttribute('tabindex')) {
                var rect = e.target.getBoundingClientRect();
                if (e.clientY - rect.top < 5) {
                    if (rect.width - (e.clientX - rect.left) < 5) {
                        e.target.style.cursor = 'ne-resize';
                    } else if (e.clientX - rect.left < 5) {
                        e.target.style.cursor = 'nw-resize';
                    } else {
                        e.target.style.cursor = 'n-resize';
                    }
                } else if (rect.height - (e.clientY - rect.top) < 5) {
                    if (rect.width - (e.clientX - rect.left) < 5) {
                        e.target.style.cursor = 'se-resize';
                    } else if (e.clientX - rect.left < 5) {
                        e.target.style.cursor = 'sw-resize';
                    } else {
                        e.target.style.cursor = 's-resize';
                    }
                } else if (rect.width - (e.clientX - rect.left) < 5) {
                    e.target.style.cursor = 'e-resize';
                } else if (e.clientX - rect.left < 5) {
                    e.target.style.cursor = 'w-resize';
                } else {
                    e.target.style.cursor = '';
                }
            }
        }

        // Move
        if (e.which == 1 && editorAction && editorAction.d) {
            if (editorAction.d == 'e-resize' || editorAction.d == 'ne-resize' ||  editorAction.d == 'se-resize') {
                editorAction.e.style.width = (editorAction.w + (e.clientX - editorAction.x)) + 'px';

                if (e.shiftKey) {
                    var newHeight = (e.clientX - editorAction.x) * (editorAction.h / editorAction.w);
                    editorAction.e.style.height = editorAction.h + newHeight + 'px';
                } else {
                    var newHeight =  null;
                }
            }

            if (! newHeight) {
                if (editorAction.d == 's-resize' || editorAction.d == 'se-resize' || editorAction.d == 'sw-resize') {
                    if (! e.shiftKey) {
                        editorAction.e.style.height = editorAction.h + (e.clientY - editorAction.y);
                    }
                }
            }
        }
    }

    var editorKeyUp = function(e) {
        if (! editor.innerHTML) {
            editor.innerHTML = '<div><br></div>';
        }

        if (typeof(obj.options.onkeyup) == 'function') { 
            obj.options.onkeyup(e, el);
        }
    }


    var editorKeyDown = function(e) {
        // Check for URL
        if (obj.options.parseURL == true) {
            verifyEditor();
        }

        // Closable
        if (typeof(obj.options.onenter) == 'function' && e.which == 13) {
            var data = obj.getData();
            obj.options.onenter(obj, el, data, e);
        }

        if (typeof(obj.options.onkeydown) == 'function') { 
            obj.options.onkeydown(e, el);
        }
    }

    var editorPaste = function(e) {
        if (e.clipboardData || e.originalEvent.clipboardData) {
            var html = (e.originalEvent || e).clipboardData.getData('text/html');
            var text = (e.originalEvent || e).clipboardData.getData('text/plain');
            var file = (e.originalEvent || e).clipboardData.files
        } else if (window.clipboardData) {
            var html = window.clipboardData.getData('Html');
            var text = window.clipboardData.getData('Text');
            var file = window.clipboardData.files
        }

        if (file.length) {
            // Paste a image from the clipboard
            obj.addFile(file);
        } else {
            // Paste text
            text = text.split('\r\n');
            var str = '';
            if (e.target.nodeName == 'DIV' && ! e.target.classList.contains('jeditor')) {
                for (var i = 0; i < text.length; i++) {
                    if (text[i]) {
                        str += text[i] + "<br>\r\n";
                    }
                }
            } else {
                for (var i = 0; i < text.length; i++) {
                    if (text[i]) {
                        str += '<div>' + text[i] + '</div>';
                    } else {
                        str += '<div><br></div>';
                    }
                }
            }
            // Insert text
            document.execCommand('insertHtml', false, str);

            // Extra images from the paste
            if (obj.options.acceptImages == true) {
                extractImageFromHtml(html);
            }
        }

        e.preventDefault();
    }

    var editorDragStart = function(e) {
        if (editorAction && editorAction.e) {
            e.preventDefault();
        }
    }

    var editorDragEnter = function(e) {
        if (editorAction || obj.options.dropZone == false) {
            // Do nothing
        } else {
            el.classList.add('jeditor-dragging');
        }
    }

    var editorDragOver = function(e) {
        if (editorAction || obj.options.dropZone == false) {
            // Do nothing
        } else {
            if (editorTimer) {
                clearTimeout(editorTimer);
            }

            editorTimer = setTimeout(function() {
                el.classList.remove('jeditor-dragging');
            }, 100);
        }
    }

    var editorDrop = function(e) {
        if (editorAction || obj.options.dropZone == false) {
            // Do nothing
        } else {
            // Position caret on the drop
            var range = null;
            if (document.caretRangeFromPoint) {
                range=document.caretRangeFromPoint(e.clientX, e.clientY);
            } else if (e.rangeParent) {
                range=document.createRange();
                range.setStart(e.rangeParent,e.rangeOffset);
            }
            var sel = window.getSelection();
            sel.removeAllRanges();
            sel.addRange(range);
            sel.anchorNode.parentNode.focus();

            var html = (e.originalEvent || e).dataTransfer.getData('text/html');
            var text = (e.originalEvent || e).dataTransfer.getData('text/plain');
            var file = (e.originalEvent || e).dataTransfer.files;
    
            if (file.length) {
                obj.addFile(file);
            } else if (text) {
                extractImageFromHtml(html);
            }

            el.classList.remove('jeditor-dragging');
            e.preventDefault();
        }
    }

    var editorBlur = function() {
        obj.options.onblur(obj, el, obj.getData());
    }

    var editorFocus = function() {
        obj.options.onfocus(obj, el, obj.getData());
    }

    editor.addEventListener('mouseup', editorMouseUp);
    editor.addEventListener('mousedown', editorMouseDown);
    editor.addEventListener('mousemove', editorMouseMove);
    editor.addEventListener('keyup', editorKeyUp);
    editor.addEventListener('keydown', editorKeyDown);
    editor.addEventListener('dragstart', editorDragStart);
    editor.addEventListener('dragenter', editorDragEnter);
    editor.addEventListener('dragover', editorDragOver);
    editor.addEventListener('drop', editorDrop);
    editor.addEventListener('paste', editorPaste);

    // Blur
    if (typeof(obj.options.onblur) == 'function') {
        editor.addEventListener('blur', editorBlur);
    }

    // Focus
    if (typeof(obj.options.onfocus) == 'function') {
        editor.addEventListener('focus', editorFocus);
    }

    // Onload
    if (typeof(obj.options.onload) == 'function') {
        obj.options.onload(el, editor);
    }

    // Set value to the editor
    editor.innerHTML = value;

    // Append editor to the containre
    el.appendChild(editor);

    // Snippet
    if (obj.options.snippet) {
        appendElement(obj.options.snippet);
    }

    // Default toolbar
    if (obj.options.toolbar == null) {
        obj.options.toolbar = jSuites.editor.getDefaultToolbar();
    }

    // Add toolbar
    if (obj.options.toolbar) {
        for (var i = 0; i < obj.options.toolbar.length; i++) {
            if (obj.options.toolbar[i].icon) {
                var item = document.createElement('div');
                item.style.userSelect = 'none';
                var itemIcon = document.createElement('i');
                itemIcon.className = 'material-icons';
                itemIcon.innerHTML = obj.options.toolbar[i].icon;
                itemIcon.onclick = (function (a) {
                    var b = a;
                    return function () {
                        obj.options.toolbar[b].onclick(el, obj, this)
                    };
                })(i);
                item.appendChild(itemIcon);
                toolbar.appendChild(item);
            } else {
                if (obj.options.toolbar[i].type == 'divisor') {
                    var item = document.createElement('div');
                    item.className = 'jeditor-toolbar-divisor';
                    toolbar.appendChild(item);
                } else if (obj.options.toolbar[i].type == 'button') {
                    var item = document.createElement('div');
                    item.classList.add('jeditor-toolbar-button');
                    item.innerHTML = obj.options.toolbar[i].value;
                    toolbar.appendChild(item);
                }
            }
        }

        el.appendChild(toolbar);
    }

    // Focus to the editor
    if (obj.options.focus) {
        jSuites.editor.setCursor(editor, obj.options.focus == 'initial' ? true : false);
    }

    el.editor = obj;

    return obj;
});

jSuites.editor.setCursor = function(element, first) {
    element.focus();
    document.execCommand('selectAll');
    var sel = window.getSelection();
    var range = sel.getRangeAt(0);
    if (first == true) {
        var node = range.startContainer;
        var size = 0;
    } else {
        var node = range.endContainer;
        var size = node.length;
    }
    range.setStart(node, size);
    range.setEnd(node, size);
    sel.removeAllRanges();
    sel.addRange(range);
}

jSuites.editor.getDomain = function(url) {
    return url.replace('http://','').replace('https://','').replace('www.','').split(/[/?#]/)[0].split(/:/g)[0];
}

jSuites.editor.detectUrl = function(text) {
    var expression = /(((https?:\/\/)|(www\.))[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|]+)/ig;
    var links = text.match(expression);

    if (links) {
        if (links[0].substr(0,3) == 'www') {
            links[0] = 'http://' + links[0];
        }
    }

    return links;
}

jSuites.editor.youtubeParser = function(url) {
    var regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/;
    var match = url.match(regExp);

    return (match && match[7].length == 11) ? match[7] : false;
}

jSuites.editor.getDefaultToolbar = function() { 
    return [
        {
            icon:'undo',
            onclick: function() {
                document.execCommand('undo');
            }
        },
        {
            icon:'redo',
            onclick: function() {
                document.execCommand('redo');
            }
        },
        {
            type:'divisor'
        },
        {
            icon:'format_bold',
            onclick: function(a,b,c) {
                document.execCommand('bold');

                if (document.queryCommandState("bold")) {
                    c.classList.add('selected');
                } else {
                    c.classList.remove('selected');
                }
            }
        },
        {
            icon:'format_italic',
            onclick: function(a,b,c) {
                document.execCommand('italic');

                if (document.queryCommandState("italic")) {
                    c.classList.add('selected');
                } else {
                    c.classList.remove('selected');
                }
            }
        },
        {
            icon:'format_underline',
            onclick: function(a,b,c) {
                document.execCommand('underline');

                if (document.queryCommandState("underline")) {
                    c.classList.add('selected');
                } else {
                    c.classList.remove('selected');
                }
            }
        },
        {
            type:'divisor'
        },
        {
            icon:'format_list_bulleted',
            onclick: function(a,b,c) {
                document.execCommand('insertUnorderedList');

                if (document.queryCommandState("insertUnorderedList")) {
                    c.classList.add('selected');
                } else {
                    c.classList.remove('selected');
                }
            }
        },
        {
            icon:'format_list_numbered',
            onclick: function(a,b,c) {
                document.execCommand('insertOrderedList');

                if (document.queryCommandState("insertOrderedList")) {
                    c.classList.add('selected');
                } else {
                    c.classList.remove('selected');
                }
            }
        },
        {
            icon:'format_indent_increase',
            onclick: function(a,b,c) {
                document.execCommand('indent', true, null);

                if (document.queryCommandState("indent")) {
                    c.classList.add('selected');
                } else {
                    c.classList.remove('selected');
                }
            }
        },
        {
            icon:'format_indent_decrease',
            onclick: function(a,b,c) {
                document.execCommand('outdent');

                if (document.queryCommandState("outdent")) {
                    c.classList.add('selected');
                } else {
                    c.classList.remove('selected');
                }
            }
        }
        /*{
            type:'select',
            items: ['Verdana','Arial','Courier New'],
            onchange: function() {
            }
        },
        {
            type:'select',
            items: ['10px','12px','14px','16px','18px','20px','22px'],
            onchange: function() {
            }
        },
        {
            icon:'format_align_left',
            onclick: function() {
                document.execCommand('JustifyLeft');

                if (document.queryCommandState("JustifyLeft")) {
                    this.classList.add('selected');
                } else {
                    this.classList.remove('selected');
                }
            }
        },
        {
            icon:'format_align_center',
            onclick: function() {
                document.execCommand('justifyCenter');

                if (document.queryCommandState("justifyCenter")) {
                    this.classList.add('selected');
                } else {
                    this.classList.remove('selected');
                }
            }
        },
        {
            icon:'format_align_right',
            onclick: function() {
                document.execCommand('justifyRight');

                if (document.queryCommandState("justifyRight")) {
                    this.classList.add('selected');
                } else {
                    this.classList.remove('selected');
                }
            }
        },
        {
            icon:'format_align_justify',
            onclick: function() {
                document.execCommand('justifyFull');

                if (document.queryCommandState("justifyFull")) {
                    this.classList.add('selected');
                } else {
                    this.classList.remove('selected');
                }
            }
        },
        {
            icon:'format_list_bulleted',
            onclick: function() {
                document.execCommand('insertUnorderedList');

                if (document.queryCommandState("insertUnorderedList")) {
                    this.classList.add('selected');
                } else {
                    this.classList.remove('selected');
                }
            }
        }*/
    ];
}


jSuites.image = (function(el, options) {
    var obj = {};
    obj.options = {};

    // Default configuration
    var defaults = {
        minWidth: false,
        onchange: null,
        singleFile: true,
        remoteParser: null,
        text:{
            extensionNotAllowed:'The extension is not allowed',
            imageTooSmall:'The resolution is too low, try a image with a better resolution. width > 800px',
        }
    };

    // Loop through our object
    for (var property in defaults) {
        if (options && options.hasOwnProperty(property)) {
            obj.options[property] = options[property];
        } else {
            obj.options[property] = defaults[property];
        }
    }

    // Upload icon
    el.classList.add('jupload');

    // Add image
    obj.addImage = function(file) {
        if (! file.date) {
            file.date = '';
        }
        var img = document.createElement('img');
        img.setAttribute('data-date', file.lastmodified ? file.lastmodified : file.date);
        img.setAttribute('data-name', file.name);
        img.setAttribute('data-size', file.size);
        img.setAttribute('data-small', file.small ? file.small : '');
        img.setAttribute('data-cover', file.cover ? 1 : 0);
        img.setAttribute('data-extension', file.extension);
        img.setAttribute('src', file.file);
        img.className = 'jfile';
        img.style.width = '100%';

        return img;
    }

    // Add image
    obj.addImages = function(files) {
        if (obj.options.singleFile == true) {
            el.innerHTML = '';
        }

        for (var i = 0; i < files.length; i++) {
            el.appendChild(obj.addImage(files[i]));
        }
    }

    obj.addFromFile = function(file) {
        var type = file.type.split('/');
        if (type[0] == 'image') {
            if (obj.options.singleFile == true) {
                el.innerHTML = '';
            }

            var imageFile = new FileReader();
            imageFile.addEventListener("load", function (v) {

                var img = new Image();

                img.onload = function onload() {
                    var canvas = document.createElement('canvas');
                    canvas.width = img.width;
                    canvas.height = img.height;

                    var ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

                    var data = {
                        file: canvas.toDataURL(),
                        extension: file.name.substr(file.name.lastIndexOf('.') + 1),
                        name: file.name,
                        size: file.size,
                        lastmodified: file.lastModified,
                    }
                    var newImage = obj.addImage(data);
                    el.appendChild(newImage);

                    // Onchange
                    if (typeof(obj.options.onchange) == 'function') {
                        obj.options.onchange(newImage);
                    }
                };

                img.src = v.srcElement.result;
            });

            imageFile.readAsDataURL(file);
        } else {
            alert(text.extentionNotAllowed);
        }
    }

    obj.addFromUrl = function(src) {
        if (src.substr(0,4) != 'data' && ! obj.options.remoteParser) {
            console.error('remoteParser not defined in your initialization');
        } else {
            // This is to process cross domain images
            if (src.substr(0,4) == 'data') {
                var extension = src.split(';')
                extension = extension[0].split('/');
                extension = extension[1];
            } else {
                var extension = src.substr(src.lastIndexOf('.') + 1);
                // Work for cross browsers
                src = obj.options.remoteParser + src;
            }

            var img = new Image();

            img.onload = function onload() {
                var canvas = document.createElement('canvas');
                canvas.width = img.width;
                canvas.height = img.height;

                var ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

                canvas.toBlob(function(blob) {
                    var data = {
                        file: window.URL.createObjectURL(blob),
                        extension: extension
                    }
                    var newImage = obj.addImage(data);
                    el.appendChild(newImage);

                    // Keep base64 ready to go
                    var content = canvas.toDataURL();
                    jSuites.files[data.file] = content.substr(content.indexOf(',') + 1);

                    // Onchange
                    if (typeof(obj.options.onchange) == 'function') {
                        obj.options.onchange(newImage);
                    }
                });
            };

            img.src = src;
        }
    }

    var attachmentInput = document.createElement('input');
    attachmentInput.type = 'file';
    attachmentInput.setAttribute('accept', 'image/*');
    attachmentInput.onchange = function() {
        for (var i = 0; i < this.files.length; i++) {
            obj.addFromFile(this.files[i]);
        }
    }

    el.addEventListener("dblclick", function(e) {
        jSuites.click(attachmentInput);
    });

    el.addEventListener('dragenter', function(e) {
        el.style.border = '1px dashed #000';
    });

    el.addEventListener('dragleave', function(e) {
        el.style.border = '1px solid #eee';
    });

    el.addEventListener('dragstop', function(e) {
        el.style.border = '1px solid #eee';
    });

    el.addEventListener('dragover', function(e) {
        e.preventDefault();
    });

    el.addEventListener('drop', function(e) {
        e.preventDefault();  
        e.stopPropagation();


        var html = (e.originalEvent || e).dataTransfer.getData('text/html');
        var file = (e.originalEvent || e).dataTransfer.files;

        if (file.length) {
            for (var i = 0; i < e.dataTransfer.files.length; i++) {
                obj.addFromFile(e.dataTransfer.files[i]);
            }
        } else if (html) {
            if (obj.options.singleFile == true) {
                el.innerHTML = '';
            }

            // Create temp element
            var div = document.createElement('div');
            div.innerHTML = html;

            // Extract images
            var img = div.querySelectorAll('img');

            if (img.length) {
                for (var i = 0; i < img.length; i++) {
                    obj.addFromUrl(img[i].src);
                }
            }
        }

        el.style.border = '1px solid #eee';

        return false;
    });

    el.image = obj;

    return obj;
});

/**
 * (c) jLoading
 * https://github.com/paulhodel/jtools
 *
 * @author: Paul Hodel <paul.hodel@gmail.com>
 * @description: Page loading spin
 */

jSuites.loading = (function() {
    var obj = {};

    var loading = document.createElement('div');
    loading.className = 'jloading';

    obj.show = function() {
        document.body.appendChild(loading);
    };

    obj.hide = function() {
        document.body.removeChild(loading);
    };

    return obj;
})();

/**
 * (c) jLogin
 * https://github.com/paulhodel/jtools
 *
 * @author: Paul Hodel <paul.hodel@gmail.com>
 * @description: Login helper
 */

jSuites.login = (function(el, options) {
    var obj = {};
    obj.options = {};

    // Default configuration
    var defaults = {
        url: window.location.href,
        prepareRequest: null,
        accessToken: null,
        deviceToken: null,
        facebookUrl: null,
        facebookAuthentication: null,
        maxHeight: null,
        onload: null,
        onsuccess: null,
        onerror: null,
        message: null,
        logo: null,
        newProfile: false,
        newProfileUrl: false,
        newProfileLogin: false,
        fullscreen: false,
        newPasswordValidation: null,
    };

    // Loop through our object
    for (var property in defaults) {
        if (options && options.hasOwnProperty(property)) {
            obj.options[property] = options[property];
        } else {
            obj.options[property] = defaults[property];
        }
    }

    // Message console container
    if (! obj.options.message) {
        var messageElement = document.querySelector('.message');
        if (messageElement) {
            obj.options.message = messageElement;
        }
    }

    // Action
    var action = null;

    // Container
    var container = document.createElement('form');
    el.appendChild(container);

    // Logo
    var divLogo = document.createElement('div');
    divLogo.className = 'jlogin-logo'
    container.appendChild(divLogo);

    if (obj.options.logo) {
        var logo = document.createElement('img');
        logo.src = obj.options.logo;
        divLogo.appendChild(logo);
    }

    // Code
    var labelCode = document.createElement('label');
    labelCode.innerHTML = 'Please enter here the code received';
    var inputCode = document.createElement('input');
    inputCode.type = 'number';
    inputCode.id = 'code';
    inputCode.setAttribute('maxlength', 6);
    var divCode = document.createElement('div');
    divCode.appendChild(labelCode);
    divCode.appendChild(inputCode);

    // Hash
    var inputHash = document.createElement('input');
    inputHash.type = 'hidden';
    inputHash.name = 'h';
    var divHash = document.createElement('div');
    divHash.appendChild(inputHash);

    // Recovery
    var inputRecovery = document.createElement('input');
    inputRecovery.type = 'hidden';
    inputRecovery.name = 'recovery';
    inputRecovery.value = '1';
    var divRecovery = document.createElement('div');
    divRecovery.appendChild(inputRecovery);

    // Login
    var labelLogin = document.createElement('label');
    labelLogin.innerHTML = 'Login';
    var inputLogin = document.createElement('input');
    inputLogin.type = 'text';
    inputLogin.name = 'login';
    inputLogin.setAttribute('autocomplete', 'off');
    inputLogin.onkeyup = function() {
        this.value = this.value.toLowerCase().replace(/[^a-zA-Z0-9_+]+/gi, '');
    } 
    var divLogin = document.createElement('div');
    divLogin.appendChild(labelLogin);
    divLogin.appendChild(inputLogin);

    // Name
    var labelName = document.createElement('label');
    labelName.innerHTML = 'Name';
    var inputName = document.createElement('input');
    inputName.type = 'text';
    inputName.name = 'name';
    var divName = document.createElement('div');
    divName.appendChild(labelName);
    divName.appendChild(inputName);

    // Email
    var labelUsername = document.createElement('label');
    labelUsername.innerHTML = 'E-mail';
    var inputUsername = document.createElement('input');
    inputUsername.type = 'text';
    inputUsername.name = 'username';
    inputUsername.setAttribute('autocomplete', 'new-username');
    var divUsername = document.createElement('div');
    divUsername.appendChild(labelUsername);
    divUsername.appendChild(inputUsername);

    // Password
    var labelPassword = document.createElement('label');
    labelPassword.innerHTML = 'New password';
    var inputPassword = document.createElement('input');
    inputPassword.type = 'password';
    inputPassword.name = 'password';
    inputPassword.setAttribute('autocomplete', 'new-password');
    var divPassword = document.createElement('div');
    divPassword.appendChild(labelPassword);
    divPassword.appendChild(inputPassword);
    divPassword.onkeydown = function(e) {
        if (e.keyCode == 13) {
            obj.execute();
        }
    }

    // Repeat password
    var labelRepeatPassword = document.createElement('label');
    labelRepeatPassword.innerHTML = 'Repeat the new password';
    var inputRepeatPassword = document.createElement('input');
    inputRepeatPassword.type = 'password';
    inputRepeatPassword.name = 'password';
    var divRepeatPassword = document.createElement('div');
    divRepeatPassword.appendChild(labelRepeatPassword);
    divRepeatPassword.appendChild(inputRepeatPassword);

    // Remember checkbox
    var labelRemember = document.createElement('label');
    labelRemember.innerHTML = 'Remember me on this device';
    var inputRemember = document.createElement('input');
    inputRemember.type = 'checkbox';
    inputRemember.name = 'remember';
    inputRemember.value = '1';
    labelRemember.appendChild(inputRemember);
    var divRememberButton = document.createElement('div');
    divRememberButton.className = 'rememberButton';
    divRememberButton.appendChild(labelRemember);

    // Login button
    var actionButton = document.createElement('input');
    actionButton.type = 'button';
    actionButton.value = 'Log In';
    actionButton.onclick = function() {
        obj.execute();
    }
    var divActionButton = document.createElement('div');
    divActionButton.appendChild(actionButton);

    // Cancel button
    var cancelButton = document.createElement('div');
    cancelButton.innerHTML = 'Cancel';
    cancelButton.className = 'cancelButton';
    cancelButton.onclick = function() {
        obj.requestAccess();
    }
    var divCancelButton = document.createElement('div');
    divCancelButton.appendChild(cancelButton);

    // Captcha
    var labelCaptcha = document.createElement('label');
    labelCaptcha.innerHTML = 'Please type here the code below';
    var inputCaptcha = document.createElement('input');
    inputCaptcha.type = 'text';
    inputCaptcha.name = 'captcha';
    var imageCaptcha = document.createElement('img');
    var divCaptcha = document.createElement('div');
    divCaptcha.className = 'jlogin-captcha';
    divCaptcha.appendChild(labelCaptcha);
    divCaptcha.appendChild(inputCaptcha);
    divCaptcha.appendChild(imageCaptcha);

    // Facebook
    var facebookButton = document.createElement('div');
    facebookButton.innerHTML = 'Login with Facebook';
    facebookButton.className = 'facebookButton';
    var divFacebookButton = document.createElement('div');
    divFacebookButton.appendChild(facebookButton);
    divFacebookButton.onclick = function() {
        obj.requestLoginViaFacebook();
    }
    // Forgot password
    var inputRequest = document.createElement('span');
    inputRequest.innerHTML = 'Request a new password';
    var divRequestButton = document.createElement('div');
    divRequestButton.className = 'requestButton';
    divRequestButton.appendChild(inputRequest);
    divRequestButton.onclick = function() {
        obj.requestNewPassword();
    }
    // Create a new Profile
    var inputNewProfile = document.createElement('span');
    inputNewProfile.innerHTML = 'Create a new profile';
    var divNewProfileButton = document.createElement('div');
    divNewProfileButton.className = 'newProfileButton';
    divNewProfileButton.appendChild(inputNewProfile);
    divNewProfileButton.onclick = function() {
        obj.newProfile();
    }

    el.className = 'jlogin';

    if (obj.options.fullscreen == true) {
        el.classList.add('jlogin-fullscreen');
    }

    /** 
     * Show message
     */
    obj.showMessage = function(data) {
        var message = (typeof(data) == 'object') ? data.message : data;

        if (typeof(obj.options.showMessage) == 'function') {
            obj.options.showMessage(data);
        } else {
            jSuites.alert(data);
        }
    }

    /**
     * New profile
     */
    obj.newProfile = function() {
        container.innerHTML = '';
        container.appendChild(divLogo);
        if (obj.options.newProfileLogin) {
            container.appendChild(divLogin);
        }
        container.appendChild(divName);
        container.appendChild(divUsername);
        container.appendChild(divActionButton);
        if (obj.options.facebookAuthentication == true) {
            container.appendChild(divFacebookButton);
        }
        container.appendChild(divCancelButton);

        // Reset inputs
        inputLogin.value = '';
        inputUsername.value = '';
        inputPassword.value = '';

        // Button
        actionButton.value = 'Create new profile';

        // Action
        action = 'newProfile';
    }

    /**
     * Request the email with the recovery instructions
     */
    obj.requestNewPassword = function() {
        if (Array.prototype.indexOf.call(container.children, divCaptcha) >= 0) {
            var captcha = true;
        }

        container.innerHTML = '';
        container.appendChild(divLogo);
        container.appendChild(divRecovery);
        container.appendChild(divUsername);
        if (captcha) {
            container.appendChild(divCaptcha);
        }
        container.appendChild(divActionButton);
        container.appendChild(divCancelButton);
        actionButton.value = 'Request a new password';
        inputRecovery.value = 1;

        // Action
        action = 'requestNewPassword';
    }

    /**
     * Confirm recovery code
     */
    obj.codeConfirmation = function() {
        container.innerHTML = '';
        container.appendChild(divLogo);
        container.appendChild(divHash);
        container.appendChild(divCode);
        container.appendChild(divActionButton);
        container.appendChild(divCancelButton);
        actionButton.value = 'Confirm code';
        inputRecovery.value = 2;

        // Action
        action = 'codeConfirmation';
    }

    /**
     * Update my password
     */
    obj.changeMyPassword = function(hash) {
        container.innerHTML = '';
        container.appendChild(divLogo);
        container.appendChild(divHash);
        container.appendChild(divPassword);
        container.appendChild(divRepeatPassword);
        container.appendChild(divActionButton);
        container.appendChild(divCancelButton);
        actionButton.value = 'Change my password';
        inputHash.value = hash;

        // Action
        action = 'changeMyPassword';
    }

    /**
     * Request access default method
     */
    obj.requestAccess = function() {
        container.innerHTML = '';
        container.appendChild(divLogo);
        container.appendChild(divUsername);
        container.appendChild(divPassword);
        container.appendChild(divActionButton);
        if (obj.options.facebookAuthentication == true) {
            container.appendChild(divFacebookButton);
        }
        container.appendChild(divRequestButton);
        container.appendChild(divRememberButton);
        container.appendChild(divRequestButton);
        if (obj.options.newProfile == true) {
            container.appendChild(divNewProfileButton);
        }

        // Button
        actionButton.value = 'Login';

        // Password
        inputPassword.value = '';

        // Email persistence
        if (window.localStorage.getItem('username')) {
            inputUsername.value = window.localStorage.getItem('username');
            inputPassword.focus();
        } else {
            inputUsername.focus();
        }

        // Action
        action = 'requestAccess';
    }

    /**
     * Request login via facebook
     */
    obj.requestLoginViaFacebook = function() {
        if (typeof(deviceNotificationToken) == 'undefined') {
            FB.getLoginStatus(function(response) {
                if (! response.status || response.status != 'connected') {
                    FB.login(function(response) {
                        if (response.authResponse) {
                            obj.execute({ f:response.authResponse.accessToken });
                        } else {
                            obj.showMessage('Not authorized by facebook');
                        }
                    }, {scope: 'public_profile,email'});
                } else {
                    obj.execute({ f:response.authResponse.accessToken });
                }
            }, true);
        } else {
            jDestroy = function() {
                fbLogin.removeEventListener('loadstart', jStart);
                fbLogin.removeEventListener('loaderror', jError);
                fbLogin.removeEventListener('exit', jExit);
                fbLogin.close();
                fbLogin = null;
            }

            jStart = function(event) {
                var url = event.url;
                if (url.indexOf("access_token") >= 0) {
                    setTimeout(function(){
                        var u = url.match(/=(.*?)&/);
                        if (u[1].length > 32) {
                            obj.execute({ f:u[1] });
                        }
                        jDestroy();
                   },500);
                }

                if (url.indexOf("error=access_denied") >= 0) {
                   setTimeout(jDestroy ,500);
                   // Not authorized by facebook
                   obj.showMessage('Not authorized by facebook');
                }
            }

            jError = function(event) {
                jDestroy();
            }
        
            jExit = function(event) {
                jDestroy();
            }

            fbLogin = window.open(obj.options.facebookUrl, "_blank", "location=no,closebuttoncaption=Exit,disallowoverscroll=yes,toolbar=no");
            fbLogin.addEventListener('loadstart', jStart);
            fbLogin.addEventListener('loaderror', jError);
            fbLogin.addEventListener('exit', jExit);
        }

        // Action
        action = 'requestLoginViaFacebook';
    }

    // Perform request
    obj.execute = function(data) {
        // New profile
        if (action == 'newProfile') {
            var pattern = new RegExp(/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/);
            if (! inputUsername.value || ! pattern.test(inputUsername.value)) {
                var message = 'Invalid e-mail address'; 
            }

            var pattern = new RegExp(/^[a-zA-Z0-9\_\-\.\s+]+$/);
            if (! inputLogin.value || ! pattern.test(inputLogin.value)) {
                var message = 'Invalid username, please use only characters and numbers';
            }

            if (message) {
                obj.showMessage(message);
                return false;
            }
        } else if (action == 'changeMyPassword') {
            if (inputPassword.value.length < 3) {
                var message = 'Password is too short';
            } else  if (inputPassword.value != inputRepeatPassword.value) {
                var message = 'Password should match';
            } else {
                if (typeof(obj.options.newPasswordValidation) == 'function') {
                    var val = obj.options.newPasswordValidation(obj, inputPassword.value, inputPassword.value);
                    if (val != undefined) {
                        message = val;
                    }
                }
            }

            if (message) {
                obj.showMessage(message);
                return false;
            }
        }

        // Keep email
        if (inputUsername.value != '') {
            window.localStorage.setItem('username', inputUsername.value);
        }

        // Captcha
        if (Array.prototype.indexOf.call(container.children, divCaptcha) >= 0) {
            if (inputCaptcha.value == '') {
                obj.showMessage('Please enter the captch code below');
                return false;
            }
        }

        // Url
        var url = obj.options.url;

        // Device token
        if (obj.options.deviceToken) {
            url += '?token=' + obj.options.deviceToken;
        }

        // Callback
        var onsuccess = function(result) {
            if (result) {
                // Successfully response
                if (result.success == 1) {
                    // Recovery process
                    if (action == 'requestNewPassword') {
                        obj.codeConfirmation();
                    } else if (action == 'codeConfirmation') {
                        obj.requestAccess();
                    } else if (action == 'newProfile') {
                        obj.requestAccess();
                        // New profile
                        result.newProfile = true;
                    }

                    // Token
                    if (result.token) {
                        // Set token
                        obj.options.accessToken = result.token;
                        // Save token
                        window.localStorage.setItem('Access-Token', result.token);
                    }
                }

                // Show message
                if (result.message) {
                    // Show message
                    obj.showMessage(result.message)
                }

                // Request captcha code
                if (! result.data) {
                    if (Array.prototype.indexOf.call(container.children, divCaptcha) >= 0) {
                        divCaptcha.remove();
                    }
                } else {
                    container.insertBefore(divCaptcha, divActionButton);
                    imageCaptcha.setAttribute('src', 'data:image/png;base64,' + result.data);
                }

                // Give time to user see the message
                if (result.hash) {
                    // Change password
                    obj.changeMyPassword(result.hash);
                } else if (result.url) {
                    // App initialization
                    if (result.success == 1) {
                        if (typeof(obj.options.onsuccess) == 'function') {
                            obj.options.onsuccess(result);
                        } else {
                            if (result.message) {
                                setTimeout(function() { window.location.href = result.url; }, 2000);
                            } else {
                                window.location.href = result.url;
                            }
                        }
                    } else {
                        if (typeof(obj.options.onerror) == 'function') {
                            obj.options.onerror(result);
                        }
                    }
                }
            }
        }

        // Password
        if (! data) {
            var data = jSuites.getFormElements(el);
            // Encode passworfd
            if (data.password) {
                data.password = jSuites.login.sha512(data.password);
            }
            // Recovery code
            if (Array.prototype.indexOf.call(container.children, divCode) >= 0 && inputCode.value) {
                data.h = jSuites.login.sha512(inputCode.value);
            }
        }

        // Loading
        el.classList.add('jlogin-loading');

        // Url
        var url = (action == 'newProfile' && obj.options.newProfileUrl) ? obj.options.newProfileUrl : obj.options.url;

        // Remote call
        jSuites.ajax({
            url: url,
            method: 'POST',
            dataType: 'json',
            data: data,
            success: function(result) {
                // Remove loading
                el.classList.remove('jlogin-loading');
                // Callback
                onsuccess(result);
            },
            error: function(result) {
                // Error
                el.classList.remove('jlogin-loading');

                if (typeof(obj.options.onerror) == 'function') {
                    obj.options.onerror(result);
                }
            }
        });
    }

    var queryString = window.location.href.split('?');
    if (queryString[1] && queryString[1].length == 130 && queryString[1].substr(0,2) == 'h=') {
        obj.changeMyPassword(queryString[1].substr(2));
    } else {
        obj.requestAccess();
    }

    return obj;
});

jSuites.login.sha512 = (function(str) {
    function int64(msint_32, lsint_32) {
        this.highOrder = msint_32;
        this.lowOrder = lsint_32;
    }

    var H = [new int64(0x6a09e667, 0xf3bcc908), new int64(0xbb67ae85, 0x84caa73b),
        new int64(0x3c6ef372, 0xfe94f82b), new int64(0xa54ff53a, 0x5f1d36f1),
        new int64(0x510e527f, 0xade682d1), new int64(0x9b05688c, 0x2b3e6c1f),
        new int64(0x1f83d9ab, 0xfb41bd6b), new int64(0x5be0cd19, 0x137e2179)];

    var K = [new int64(0x428a2f98, 0xd728ae22), new int64(0x71374491, 0x23ef65cd),
        new int64(0xb5c0fbcf, 0xec4d3b2f), new int64(0xe9b5dba5, 0x8189dbbc),
        new int64(0x3956c25b, 0xf348b538), new int64(0x59f111f1, 0xb605d019),
        new int64(0x923f82a4, 0xaf194f9b), new int64(0xab1c5ed5, 0xda6d8118),
        new int64(0xd807aa98, 0xa3030242), new int64(0x12835b01, 0x45706fbe),
        new int64(0x243185be, 0x4ee4b28c), new int64(0x550c7dc3, 0xd5ffb4e2),
        new int64(0x72be5d74, 0xf27b896f), new int64(0x80deb1fe, 0x3b1696b1),
        new int64(0x9bdc06a7, 0x25c71235), new int64(0xc19bf174, 0xcf692694),
        new int64(0xe49b69c1, 0x9ef14ad2), new int64(0xefbe4786, 0x384f25e3),
        new int64(0x0fc19dc6, 0x8b8cd5b5), new int64(0x240ca1cc, 0x77ac9c65),
        new int64(0x2de92c6f, 0x592b0275), new int64(0x4a7484aa, 0x6ea6e483),
        new int64(0x5cb0a9dc, 0xbd41fbd4), new int64(0x76f988da, 0x831153b5),
        new int64(0x983e5152, 0xee66dfab), new int64(0xa831c66d, 0x2db43210),
        new int64(0xb00327c8, 0x98fb213f), new int64(0xbf597fc7, 0xbeef0ee4),
        new int64(0xc6e00bf3, 0x3da88fc2), new int64(0xd5a79147, 0x930aa725),
        new int64(0x06ca6351, 0xe003826f), new int64(0x14292967, 0x0a0e6e70),
        new int64(0x27b70a85, 0x46d22ffc), new int64(0x2e1b2138, 0x5c26c926),
        new int64(0x4d2c6dfc, 0x5ac42aed), new int64(0x53380d13, 0x9d95b3df),
        new int64(0x650a7354, 0x8baf63de), new int64(0x766a0abb, 0x3c77b2a8),
        new int64(0x81c2c92e, 0x47edaee6), new int64(0x92722c85, 0x1482353b),
        new int64(0xa2bfe8a1, 0x4cf10364), new int64(0xa81a664b, 0xbc423001),
        new int64(0xc24b8b70, 0xd0f89791), new int64(0xc76c51a3, 0x0654be30),
        new int64(0xd192e819, 0xd6ef5218), new int64(0xd6990624, 0x5565a910),
        new int64(0xf40e3585, 0x5771202a), new int64(0x106aa070, 0x32bbd1b8),
        new int64(0x19a4c116, 0xb8d2d0c8), new int64(0x1e376c08, 0x5141ab53),
        new int64(0x2748774c, 0xdf8eeb99), new int64(0x34b0bcb5, 0xe19b48a8),
        new int64(0x391c0cb3, 0xc5c95a63), new int64(0x4ed8aa4a, 0xe3418acb),
        new int64(0x5b9cca4f, 0x7763e373), new int64(0x682e6ff3, 0xd6b2b8a3),
        new int64(0x748f82ee, 0x5defb2fc), new int64(0x78a5636f, 0x43172f60),
        new int64(0x84c87814, 0xa1f0ab72), new int64(0x8cc70208, 0x1a6439ec),
        new int64(0x90befffa, 0x23631e28), new int64(0xa4506ceb, 0xde82bde9),
        new int64(0xbef9a3f7, 0xb2c67915), new int64(0xc67178f2, 0xe372532b),
        new int64(0xca273ece, 0xea26619c), new int64(0xd186b8c7, 0x21c0c207),
        new int64(0xeada7dd6, 0xcde0eb1e), new int64(0xf57d4f7f, 0xee6ed178),
        new int64(0x06f067aa, 0x72176fba), new int64(0x0a637dc5, 0xa2c898a6),
        new int64(0x113f9804, 0xbef90dae), new int64(0x1b710b35, 0x131c471b),
        new int64(0x28db77f5, 0x23047d84), new int64(0x32caab7b, 0x40c72493),
        new int64(0x3c9ebe0a, 0x15c9bebc), new int64(0x431d67c4, 0x9c100d4c),
        new int64(0x4cc5d4be, 0xcb3e42b6), new int64(0x597f299c, 0xfc657e2a),
        new int64(0x5fcb6fab, 0x3ad6faec), new int64(0x6c44198c, 0x4a475817)];

    var W = new Array(64);
    var a, b, c, d, e, f, g, h, i, j;
    var T1, T2;
    var charsize = 8;

    function utf8_encode(str) {
        return unescape(encodeURIComponent(str));
    }

    function str2binb(str) {
        var bin = [];
        var mask = (1 << charsize) - 1;
        var len = str.length * charsize;
    
        for (var i = 0; i < len; i += charsize) {
            bin[i >> 5] |= (str.charCodeAt(i / charsize) & mask) << (32 - charsize - (i % 32));
        }
    
        return bin;
    }

    function binb2hex(binarray) {
        var hex_tab = "0123456789abcdef";
        var str = "";
        var length = binarray.length * 4;
        var srcByte;

        for (var i = 0; i < length; i += 1) {
            srcByte = binarray[i >> 2] >> ((3 - (i % 4)) * 8);
            str += hex_tab.charAt((srcByte >> 4) & 0xF) + hex_tab.charAt(srcByte & 0xF);
        }

        return str;
    }

    function safe_add_2(x, y) {
        var lsw, msw, lowOrder, highOrder;

        lsw = (x.lowOrder & 0xFFFF) + (y.lowOrder & 0xFFFF);
        msw = (x.lowOrder >>> 16) + (y.lowOrder >>> 16) + (lsw >>> 16);
        lowOrder = ((msw & 0xFFFF) << 16) | (lsw & 0xFFFF);

        lsw = (x.highOrder & 0xFFFF) + (y.highOrder & 0xFFFF) + (msw >>> 16);
        msw = (x.highOrder >>> 16) + (y.highOrder >>> 16) + (lsw >>> 16);
        highOrder = ((msw & 0xFFFF) << 16) | (lsw & 0xFFFF);

        return new int64(highOrder, lowOrder);
    }

    function safe_add_4(a, b, c, d) {
        var lsw, msw, lowOrder, highOrder;

        lsw = (a.lowOrder & 0xFFFF) + (b.lowOrder & 0xFFFF) + (c.lowOrder & 0xFFFF) + (d.lowOrder & 0xFFFF);
        msw = (a.lowOrder >>> 16) + (b.lowOrder >>> 16) + (c.lowOrder >>> 16) + (d.lowOrder >>> 16) + (lsw >>> 16);
        lowOrder = ((msw & 0xFFFF) << 16) | (lsw & 0xFFFF);

        lsw = (a.highOrder & 0xFFFF) + (b.highOrder & 0xFFFF) + (c.highOrder & 0xFFFF) + (d.highOrder & 0xFFFF) + (msw >>> 16);
        msw = (a.highOrder >>> 16) + (b.highOrder >>> 16) + (c.highOrder >>> 16) + (d.highOrder >>> 16) + (lsw >>> 16);
        highOrder = ((msw & 0xFFFF) << 16) | (lsw & 0xFFFF);

        return new int64(highOrder, lowOrder);
    }

    function safe_add_5(a, b, c, d, e) {
        var lsw, msw, lowOrder, highOrder;

        lsw = (a.lowOrder & 0xFFFF) + (b.lowOrder & 0xFFFF) + (c.lowOrder & 0xFFFF) + (d.lowOrder & 0xFFFF) + (e.lowOrder & 0xFFFF);
        msw = (a.lowOrder >>> 16) + (b.lowOrder >>> 16) + (c.lowOrder >>> 16) + (d.lowOrder >>> 16) + (e.lowOrder >>> 16) + (lsw >>> 16);
        lowOrder = ((msw & 0xFFFF) << 16) | (lsw & 0xFFFF);

        lsw = (a.highOrder & 0xFFFF) + (b.highOrder & 0xFFFF) + (c.highOrder & 0xFFFF) + (d.highOrder & 0xFFFF) + (e.highOrder & 0xFFFF) + (msw >>> 16);
        msw = (a.highOrder >>> 16) + (b.highOrder >>> 16) + (c.highOrder >>> 16) + (d.highOrder >>> 16) + (e.highOrder >>> 16) + (lsw >>> 16);
        highOrder = ((msw & 0xFFFF) << 16) | (lsw & 0xFFFF);

        return new int64(highOrder, lowOrder);
    }

    function maj(x, y, z) {
        return new int64(
            (x.highOrder & y.highOrder) ^ (x.highOrder & z.highOrder) ^ (y.highOrder & z.highOrder),
            (x.lowOrder & y.lowOrder) ^ (x.lowOrder & z.lowOrder) ^ (y.lowOrder & z.lowOrder)
        );
    }

    function ch(x, y, z) {
        return new int64(
            (x.highOrder & y.highOrder) ^ (~x.highOrder & z.highOrder),
            (x.lowOrder & y.lowOrder) ^ (~x.lowOrder & z.lowOrder)
        );
    }

    function rotr(x, n) {
        if (n <= 32) {
            return new int64(
             (x.highOrder >>> n) | (x.lowOrder << (32 - n)),
             (x.lowOrder >>> n) | (x.highOrder << (32 - n))
            );
        } else {
            return new int64(
             (x.lowOrder >>> n) | (x.highOrder << (32 - n)),
             (x.highOrder >>> n) | (x.lowOrder << (32 - n))
            );
        }
    }

    function sigma0(x) {
        var rotr28 = rotr(x, 28);
        var rotr34 = rotr(x, 34);
        var rotr39 = rotr(x, 39);

        return new int64(
            rotr28.highOrder ^ rotr34.highOrder ^ rotr39.highOrder,
            rotr28.lowOrder ^ rotr34.lowOrder ^ rotr39.lowOrder
        );
    }

    function sigma1(x) {
        var rotr14 = rotr(x, 14);
        var rotr18 = rotr(x, 18);
        var rotr41 = rotr(x, 41);

        return new int64(
            rotr14.highOrder ^ rotr18.highOrder ^ rotr41.highOrder,
            rotr14.lowOrder ^ rotr18.lowOrder ^ rotr41.lowOrder
        );
    }

    function gamma0(x) {
        var rotr1 = rotr(x, 1), rotr8 = rotr(x, 8), shr7 = shr(x, 7);

        return new int64(
            rotr1.highOrder ^ rotr8.highOrder ^ shr7.highOrder,
            rotr1.lowOrder ^ rotr8.lowOrder ^ shr7.lowOrder
        );
    }

    function gamma1(x) {
        var rotr19 = rotr(x, 19);
        var rotr61 = rotr(x, 61);
        var shr6 = shr(x, 6);

        return new int64(
            rotr19.highOrder ^ rotr61.highOrder ^ shr6.highOrder,
            rotr19.lowOrder ^ rotr61.lowOrder ^ shr6.lowOrder
        );
    }

    function shr(x, n) {
        if (n <= 32) {
            return new int64(
                x.highOrder >>> n,
                x.lowOrder >>> n | (x.highOrder << (32 - n))
            );
        } else {
            return new int64(
                0,
                x.highOrder << (32 - n)
            );
        }
    }

    var str = utf8_encode(str);
    var strlen = str.length*charsize;
    str = str2binb(str);

    str[strlen >> 5] |= 0x80 << (24 - strlen % 32);
    str[(((strlen + 128) >> 10) << 5) + 31] = strlen;

    for (var i = 0; i < str.length; i += 32) {
        a = H[0];
        b = H[1];
        c = H[2];
        d = H[3];
        e = H[4];
        f = H[5];
        g = H[6];
        h = H[7];

        for (var j = 0; j < 80; j++) {
            if (j < 16) {
                W[j] = new int64(str[j*2 + i], str[j*2 + i + 1]);
            } else {
                W[j] = safe_add_4(gamma1(W[j - 2]), W[j - 7], gamma0(W[j - 15]), W[j - 16]);
            }

            T1 = safe_add_5(h, sigma1(e), ch(e, f, g), K[j], W[j]);
            T2 = safe_add_2(sigma0(a), maj(a, b, c));
            h = g;
            g = f;
            f = e;
            e = safe_add_2(d, T1);
            d = c;
            c = b;
            b = a;
            a = safe_add_2(T1, T2);
        }

        H[0] = safe_add_2(a, H[0]);
        H[1] = safe_add_2(b, H[1]);
        H[2] = safe_add_2(c, H[2]);
        H[3] = safe_add_2(d, H[3]);
        H[4] = safe_add_2(e, H[4]);
        H[5] = safe_add_2(f, H[5]);
        H[6] = safe_add_2(g, H[6]);
        H[7] = safe_add_2(h, H[7]);
    }

    var binarray = [];
    for (var i = 0; i < H.length; i++) {
        binarray.push(H[i].highOrder);
        binarray.push(H[i].lowOrder);
    }

    return binb2hex(binarray);
});

/**
 * (c) jTools Input Mask
 * https://github.com/paulhodel/jtools
 *
 * @author: Paul Hodel <paul.hodel@gmail.com>
 * @description: Input mask
 */

jSuites.mask = (function() {
    var obj = {};
    var index = 0;
    var values = []
    var pieces = [];

    obj.run = function(value, mask, decimal) {
        if (value && mask) {
            if (! decimal) {
                decimal = '.';
            }
            if (value == Number(value)) {
                var number = (''+value).split('.');
                var value = number[0];
                var valueDecimal = number[1];
            } else {
                value = '' + value;
            }
            index = 0;
            values = [];
            // Create mask token
            obj.prepare(mask);
            // Current value
            var currentValue = value;
            if (currentValue) {
                // Checking current value
                for (var i = 0; i < currentValue.length; i++) {
                    if (currentValue[i] != null) {
                        obj.process(currentValue[i]);
                    }
                }
            }
            if (valueDecimal) {
                obj.process(decimal);
                var currentValue = valueDecimal;
                if (currentValue) {
                    // Checking current value
                    for (var i = 0; i < currentValue.length; i++) {
                        if (currentValue[i] != null) {
                            obj.process(currentValue[i]);
                        }
                    }
                }
            }
            // Formatted value
            return values.join('');
        } else {
            return '';
        }
    }

    obj.apply = function(e) {
        if (e.target && ! e.target.getAttribute('readonly')) {
            var mask = e.target.getAttribute('data-mask');
            if (mask && e.keyCode > 46) {
                index = 0;
                values = [];
                // Create mask token
                obj.prepare(mask);
                // Current value
                if (e.target.selectionStart < e.target.selectionEnd) {
                    var currentValue = e.target.value.substring(0, e.target.selectionStart); 
                } else {
                    var currentValue = e.target.value;
                }
                if (currentValue) {
                    // Checking current value
                    for (var i = 0; i < currentValue.length; i++) {
                        if (currentValue[i] != null) {
                            obj.process(currentValue[i]);
                        }
                    }
                }
                // New input
                obj.process(obj.fromKeyCode(e));
                // Update value to the element
                e.target.value = values.join('');
                if (pieces.length == values.length && pieces[pieces.length-1].length == values[values.length-1].length) {
                    e.target.setAttribute('data-completed', 'true');
                } else {
                    e.target.setAttribute('data-completed', 'false');
                }
                // Prevent default
                e.preventDefault();
            }
        }
    }

    /**
     * Process inputs and save to values
     */
    obj.process = function(input) {
        do {
            if (pieces[index] == 'mm') {
                if (values[index] == null || values[index] == '') {
                    if (parseInt(input) > 1 && parseInt(input) < 10) {
                        values[index] = '0' + input;
                        index++;
                        return true;
                    } else if (parseInt(input) < 10) {
                        values[index] = input;
                        return true;
                    } else {
                        return false;
                    }
                } else {
                    if (values[index] == 1 && values[index] < 2 && parseInt(input) < 3) {
                        values[index] += input;
                        index++;
                        return true;
                    } else if (values[index] == 0 && values[index] < 10) {
                        values[index] += input;
                        index++;
                        return true;
                    } else {
                        return false
                    }
                }
            } else if (pieces[index] == 'dd') {
                if (values[index] == null || values[index] == '') {
                    if (parseInt(input) > 3 && parseInt(input) < 10) {
                        values[index] = '0' + input;
                        index++;
                        return true;
                    } else if (parseInt(input) < 10) {
                        values[index] = input;
                        return true;
                    } else {
                        return false;
                    }
                } else {
                    if (values[index] == 3 && parseInt(input) < 2) {
                        values[index] += input;
                        index++;
                        return true;
                    } else if (values[index] < 3 && parseInt(input) < 10) {
                        values[index] += input;
                        index++;
                        return true;
                    } else {
                        return false
                    }
                }
            } else if (pieces[index] == 'hh24') {
                if (values[index] == null || values[index] == '') {
                    if (parseInt(input) > 2 && parseInt(input) < 10) {
                        values[index] = '0' + input;
                        index++;
                        return true;
                    } else if (parseInt(input) < 10) {
                        values[index] = input;
                        return true;
                    } else {
                        return false;
                    }
                } else {
                    if (values[index] == 2 && parseInt(input) < 4) {
                        values[index] += input;
                        index++;
                        return true;
                    } else if (values[index] < 2 && parseInt(input) < 10) {
                        values[index] += input;
                        index++;
                        return true;
                    } else {
                        return false
                    }
                }
            } else if (pieces[index] == 'hh') {
                if (values[index] == null || values[index] == '') {
                    if (parseInt(input) > 1 && parseInt(input) < 10) {
                        values[index] = '0' + input;
                        index++;
                        return true;
                    } else if (parseInt(input) < 10) {
                        values[index] = input;
                        return true;
                    } else {
                        return false;
                    }
                } else {
                    if (values[index] == 1 && parseInt(input) < 3) {
                        values[index] += input;
                        index++;
                        return true;
                    } else if (values[index] < 1 && parseInt(input) < 10) {
                        values[index] += input;
                        index++;
                        return true;
                    } else {
                        return false
                    }
                }
            } else if (pieces[index] == 'mi' || pieces[index] == 'ss') {
                if (values[index] == null || values[index] == '') {
                    if (parseInt(input) > 5 && parseInt(input) < 10) {
                        values[index] = '0' + input;
                        index++;
                        return true;
                    } else if (parseInt(input) < 10) {
                        values[index] = input;
                        return true;
                    } else {
                        return false;
                    }
                } else {
                    if (parseInt(input) < 10) {
                        values[index] += input;
                        index++;
                        return true;
                     } else {
                        return false
                    }
                }
            } else if (pieces[index] == 'yy' || pieces[index] == 'yyyy') {
                if (parseInt(input) < 10) {
                    if (values[index] == null || values[index] == '') {
                        values[index] = input;
                    } else {
                        values[index] += input;
                    }
                    
                    if (values[index].length == pieces[index].length) {
                        index++;
                    }
                    return true;
                } else {
                    return false;
                }
            } else if (pieces[index] == '#' || pieces[index] == '#.##' || pieces[index] == '#,##' || pieces[index] == '# ##') {
                if (input.match(/[0-9]/g)) {
                    if (pieces[index] == '#.##') {
                        var separator = '.';
                    } else if (pieces[index] == '#,##') {
                        var separator = ',';
                    } else if (pieces[index] == '# ##') {
                        var separator = ' ';
                    } else {
                        var separator = '';
                    }
                    if (values[index] == null || values[index] == '') {
                        values[index] = input;
                    } else {
                        values[index] += input;
                        if (separator) {
                            values[index] = values[index].match(/[0-9]/g).join('');
                            var t = [];
                            var s = 0;
                            for (var j = values[index].length - 1; j >= 0 ; j--) {
                                t.push(values[index][j]);
                                s++;
                                if (! (s % 3)) {
                                    t.push(separator);
                                }
                            }
                            t = t.reverse();
                            values[index] = t.join('');
                            if (values[index].substr(0,1) == separator) {
                                values[index] = values[index].substr(1);
                            } 
                        }
                    }
                    return true;
                } else {
                    if (pieces[index] == '#.##' && input == '.') {
                        // Do nothing
                    } else if (pieces[index] == '#,##' && input == ',') {
                        // Do nothing
                    } else if (pieces[index] == '# ##' && input == ' ') {
                        // Do nothing
                    } else {
                        if (values[index]) {
                            index++;
                            if (pieces[index]) {
                                if (pieces[index] == input) {
                                    values[index] = input;
                                    return true;
                                } else {
                                    if (pieces[index] == '0' && pieces[index+1] == input) {
                                        index++;
                                        values[index] = input;
                                        return true;
                                    }
                                }
                            }
                        }
                    }

                    return false;
                }
            } else if (pieces[index] == '0') {
                if (input.match(/[0-9]/g)) {
                    values[index] = input;
                    index++;
                    return true;
                } else {
                    return false;
                }
            } else if (pieces[index] == 'a') {
                if (input.match(/[a-zA-Z]/g)) {
                    values[index] = input;
                    index++;
                    return true;
                } else {
                    return false;
                }
            } else {
                if (pieces[index] != null) {
                    if (pieces[index] == '\\a') {
                        var v = 'a';
                    } else if (pieces[index] == '\\0') {
                        var v = '0';
                    } else if (pieces[index] == '[-]') {
                        if (input == '-' || input == '+') {
                            var v = input;
                        } else {
                            var v = ' ';
                        }
                    } else {
                        var v = pieces[index];
                    }
                    values[index] = v;
                    if (input == v) {
                        index++;
                        return true;
                    }
                }
            }

            index++;
        } while (pieces[index]);
    }

    /**
     * Create tokens for the mask
     */
    obj.prepare = function(mask) {
        pieces = [];
        for (var i = 0; i < mask.length; i++) {
            if (mask[i].match(/[0-9]|[a-z]|\\/g)) {
                if (mask[i] == 'y' && mask[i+1] == 'y' && mask[i+2] == 'y' && mask[i+3] == 'y') {
                    pieces.push('yyyy');
                    i += 3;
                } else if (mask[i] == 'y' && mask[i+1] == 'y') {
                    pieces.push('yy');
                    i++;
                } else if (mask[i] == 'm' && mask[i+1] == 'm' && mask[i+2] == 'm' && mask[i+3] == 'm') {
                    pieces.push('mmmm');
                    i += 3;
                } else if (mask[i] == 'm' && mask[i+1] == 'm' && mask[i+2] == 'm') {
                    pieces.push('mmm');
                    i += 2;
                } else if (mask[i] == 'm' && mask[i+1] == 'm') {
                    pieces.push('mm');
                    i++;
                } else if (mask[i] == 'd' && mask[i+1] == 'd') {
                    pieces.push('dd');
                    i++;
                } else if (mask[i] == 'h' && mask[i+1] == 'h' && mask[i+2] == '2' && mask[i+3] == '4') {
                    pieces.push('hh24');
                    i += 3;
                } else if (mask[i] == 'h' && mask[i+1] == 'h') {
                    pieces.push('hh');
                    i++;
                } else if (mask[i] == 'm' && mask[i+1] == 'i') {
                    pieces.push('mi');
                    i++;
                } else if (mask[i] == 's' && mask[i+1] == 's') {
                    pieces.push('ss');
                    i++;
                } else if (mask[i] == 'a' && mask[i+1] == 'm') {
                    pieces.push('am');
                    i++;
                } else if (mask[i] == 'p' && mask[i+1] == 'm') {
                    pieces.push('pm');
                    i++;
                } else if (mask[i] == '\\' && mask[i+1] == '0') {
                    pieces.push('\\0');
                    i++;
                } else if (mask[i] == '\\' && mask[i+1] == 'a') {
                    pieces.push('\\a');
                    i++;
                } else {
                    pieces.push(mask[i]);
                }
            } else {
                if (mask[i] == '#' && mask[i+1] == '.' && mask[i+2] == '#' && mask[i+3] == '#') {
                    pieces.push('#.##');
                    i += 3;
                } else if (mask[i] == '#' && mask[i+1] == ',' && mask[i+2] == '#' && mask[i+3] == '#') {
                    pieces.push('#,##');
                    i += 3;
                } else if (mask[i] == '#' && mask[i+1] == ' ' && mask[i+2] == '#' && mask[i+3] == '#') {
                    pieces.push('# ##');
                    i += 3;
                } else if (mask[i] == '[' && mask[i+1] == '-' && mask[i+2] == ']') {
                    pieces.push('[-]');
                    i += 2;
                } else {
                    pieces.push(mask[i]);
                }
            }
        }
    }

    /** 
     * Thanks for the collaboration
     */
    obj.fromKeyCode = function(e) {
        var _to_ascii = {
            '188': '44',
            '109': '45',
            '190': '46',
            '191': '47',
            '192': '96',
            '220': '92',
            '222': '39',
            '221': '93',
            '219': '91',
            '173': '45',
            '187': '61', //IE Key codes
            '186': '59', //IE Key codes
            '189': '45'  //IE Key codes
        }

        var shiftUps = {
            "96": "~",
            "49": "!",
            "50": "@",
            "51": "#",
            "52": "$",
            "53": "%",
            "54": "^",
            "55": "&",
            "56": "*",
            "57": "(",
            "48": ")",
            "45": "_",
            "61": "+",
            "91": "{",
            "93": "}",
            "92": "|",
            "59": ":",
            "39": "\"",
            "44": "<",
            "46": ">",
            "47": "?"
        };

        var c = e.which;

        if (_to_ascii.hasOwnProperty(c)) {
            c = _to_ascii[c];
        }

        if (!e.shiftKey && (c >= 65 && c <= 90)) {
            c = String.fromCharCode(c + 32);
        } else if (e.shiftKey && shiftUps.hasOwnProperty(c)) {
            c = shiftUps[c];
        } else if (96 <= c && c <= 105) {
            c = String.fromCharCode(c - 48);
        } else {
            c = String.fromCharCode(c);
        }

        return c;
    }

    return obj;
})();

jSuites.mobile = (function(el, options) {
    var obj = {};
    obj.options = {};

    if (jSuites.el) {
        jSuites.el.addEventListener('mousedown', function(e) {
            if (e.target.classList.contains('option-title')) {
                if (e.target.classList.contains('selected')) {
                    e.target.classList.remove('selected');
                } else {
                    e.target.classList.add('selected');
                }
            }
        });
    }

    return obj;
})();

jSuites.pages = (function() {
    var container = null;
    var current = null;

    // Create a page
    var createPage = function(options, callback) {
        // Create page
        var page = document.createElement('div');
        page.classList.add('page');

        // Always hidden
        page.style.display = 'none';

        // Keep options
        page.options = options ? options : {};

        if (! current) {
            container.appendChild(page);
        } else {
            container.insertBefore(page, current.nextSibling);
        }

        jSuites.ajax({
            url: page.options.url,
            method: 'GET',
            success: function(result) {
                // Push to refresh controls
                jSuites.refresh(page, page.options.onpush);

                // Open page
                page.innerHTML = result;
                // Get javascript
                var script = page.getElementsByTagName('script');
                // Run possible inline scripts
                for (var i = 0; i < script.length; i++) {
                    // Get type
                    var type = script[i].getAttribute('type');
                    if (! type || type == 'text/javascript') {
                        eval(script[i].innerHTML);
                    }
                }
                // Set title
                page.setTitle = function(text) {
                    this.children[0].children[0].children[1].innerHTML = text;
                }
                // Show page
                if (! page.options.closed) {
                    showPage(page);
                }
                // Onload callback
                if (typeof(page.options.onload) == 'function') {
                    page.options.onload(page);
                }
                // Force callback
                if (typeof(callback) == 'function') {
                    callback(page);
                }
            }
        });

        return page;
    }

    var showPage = function(page, ignoreHistory, callback) {
        if (current) {
            if (current == page) {
                current = page;
            } else {
                // Keep scroll in the top
                window.scrollTo({ top: 0 });

                // Show page
                page.style.display = '';

                var a = Array.prototype.indexOf.call(container.children, current);
                var b = Array.prototype.indexOf.call(container.children, page);

                // Leave
                if (typeof(current.options.onleave) == 'function') {
                    current.options.onleave(current, page, ignoreHistory);
                }

                jSuites.slideLeft(container, (a < b ? 0 : 1), function() {
                    current.style.display = 'none';
                    current = page;
                });

                // Enter
                if (typeof(page.options.onenter) == 'function') {
                    page.options.onenter(page, current, ignoreHistory);
                }
            }
        } else {
            // Show
            page.style.display = '';

            // Keep current
            current = page;

            // Enter
            if (typeof(page.options.onenter) == 'function') {
                page.options.onenter(page);
            }
        }

        // Add history
        if (! ignoreHistory) {
            // Add history
            window.history.pushState({ route: page.options.route }, page.options.title, page.options.route);
        }

        // Callback
        if (typeof(callback) == 'function') {
            callback(page);
        }
    }

    // Init method
    var obj = function(route, mixed) {

        // Create page container
        if (! container) {
            container = document.querySelector('.pages');
            if (! container) {
                container = document.createElement('div');
                container.className = 'pages';
            }

            // Append container to the application
            if (jSuites.el) {
                jSuites.el.appendChild(container);
            } else {
                document.body.appendChild(container);
            }
        }

        if (! obj.pages[route]) {
            if (! route) {
                alert('Error, no route provided');
            } else {
                if (typeof(mixed) == 'function') {
                    var options = {};
                    var callback = mixed;
                } else {
                    // Page options
                    var options = mixed ? mixed : {};
                }

                // Closed
                options.closed = mixed && mixed.closed ? 1 : 0;
                // Keep Route
                options.route = route;

                // New page url
                if (! options.url) {
                    var routePath = route.split('#');
                    options.url = jSuites.pages.path + routePath[0] + '.html';
                }
                // Title
                if (! options.title) {
                    options.title = 'Untitled';
                }

                // Create new page
                obj.pages[route] = createPage(options, callback ? callback : null);
            }
        } else {
            // Update config
            if (mixed) {
                // History
                var ignoreHistory = 0;

                if (typeof(mixed) == 'function') {
                    var callback = mixed;
                } else {
                    if (typeof(mixed.onenter) == 'function') {
                        obj.pages[route].options.onenter = mixed.onenter;
                    }
                    if (typeof(mixed.onleave) == 'function') {
                        obj.pages[route].options.onleave = mixed.onleave;
                    }

                    // Ignore history
                    ignoreHistory = mixed.ignoreHistory ? 1 : 0; 
                }
            }

            showPage(obj.pages[route], ignoreHistory, callback ? callback : null);
        }
    }

    obj.pages = {};

    // Get page
    obj.get = function(route) {
        if (obj.pages[route]) {
            return obj.pages[route]; 
        }
    }

    obj.getContainer = function() {
        return container;
    }

    obj.destroy = function() {
        // Current is null
        current = null;
        // Destroy containers
        obj.pages = {};
        // Reset container
        if (container) {
            container.innerHTML = '';
        }
    }

    return obj;
})();

// Path
jSuites.pages.path = 'pages';

// Panel
jSuites.panel = (function() {
    // No initial panel declared
    var panel = null;

    var obj = function(route) {
        if (! panel) {
            obj.create(jSuites.pages.path + route + '.html');
        }

        // Show panel
        panel.style.display = '';

        // Add animation
        if (panel.classList.contains('panel-left')) {
            jSuites.slideLeft(panel, 1);
        } else {
            jSuites.slideRight(panel, 1);
        }
    }

    obj.create = function(route) {
        if (! panel) {
            // Create element
            panel = document.createElement('div');
            panel.classList.add('panel');
            panel.classList.add('panel-left');
            panel.style.display = 'none';

            // Bind to the app
            if (jSuites.el) {
                jSuites.el.appendChild(panel);
            } else {
                document.body.appendChild(panel);
            }
        }

        // Remote content
        if (route) {
	        var url = jSuites.pages.path + route + '.html';

            jSuites.ajax({
                url: url,
                method: 'GET',
                success: function(result) {
                    // Set content
                    panel.innerHTML = result;
                    // Get javascript
                    var script = panel.getElementsByTagName('script');
                    // Run possible inline scripts
                    for (var i = 0; i < script.length; i++) {
                        // Get type
                        var type = script[i].getAttribute('type');
                        if (! type || type == 'text/javascript') {
                            eval(script[i].innerHTML);
                        }
                    }
                }
            });
        }
    }

    obj.close = function() {
        if (panel) {
            // Animation
            if (panel.classList.contains('panel-left')) {
                jSuites.slideLeft(panel, 0, function() {
                    panel.style.display = 'none';
                });
            } else {
                jSuites.slideRight(panel, 0, function() {
                    panel.style.display = 'none';
                });
            }
        }
    }

    obj.get = function() {
        return panel;
    }

    obj.destroy = function() {
        panel.remove();
        panel = null;
    }

    return obj;
})();

jSuites.toolbar = (function(el, options) {
    var obj = {};
    obj.options = options;

    obj.selectItem = function(element) {
        var elements = toolbarContent.children;
        for (var i = 0; i < elements.length; i++) {
            elements[i].classList.remove('selected');
        }
        element.classList.add('selected');
    }

    obj.hide = function() {
        jSuites.slideBottom(toolbar, 0, function() {
            toolbar.style.display = 'none';
        });
    }

    obj.show = function() {
        toolbar.style.display = '';
        jSuites.slideBottom(toolbar, 1);
    }

    obj.get = function() {
        return toolbar;
    }

    obj.setBadge = function(index, value) {
        toolbarContent.children[index].children[1].firstChild.innerHTML = value;
    }

    obj.destroy = function() {
        toolbar.remove();
        toolbar = null;
    }

    var toolbar = document.createElement('div');
    toolbar.classList.add('jtoolbar');
    toolbar.onclick = function(e) {
        var element = jSuites.getElement(e.target, 'jtoolbar-item');
        if (element) {
            obj.selectItem(element);
        }
    }

    var toolbarContent = document.createElement('div');
    toolbar.appendChild(toolbarContent);

    for (var i = 0; i < options.items.length; i++) {
        var toolbarItem = document.createElement('div');
        toolbarItem.classList.add('jtoolbar-item');
        if (options.items[i].route) {
            toolbarItem.setAttribute('data-href', options.items[i].route);
            jSuites.pages(options.items[i].route, {
                closed: true,
                onenter: function() {
                    obj.selectItem(toolbarItem);
                }
            });
        }

        if (options.items[i].icon) {
            var toolbarIcon = document.createElement('i');
            toolbarIcon.classList.add('material-icons');
            toolbarIcon.innerHTML = options.items[i].icon;
            toolbarItem.appendChild(toolbarIcon);
        }

        var toolbarBadge = document.createElement('div');
        toolbarBadge.classList.add('jbadge');
        var toolbarBadgeContent = document.createElement('div');
        toolbarBadgeContent.innerHTML = options.items[i].badge ? options.items[i].badge : '';
        toolbarBadge.appendChild(toolbarBadgeContent);
        toolbarItem.appendChild(toolbarBadge);

        if (options.items[i].title) {
            var toolbarTitle = document.createElement('span');
            toolbarTitle.innerHTML = options.items[i].title;
            toolbarItem.appendChild(toolbarTitle);
        }

        toolbarContent.appendChild(toolbarItem);
    }

    el.toolbar = obj;

    el.appendChild(toolbar);

    return obj;
});

jSuites.actionsheet = (function() {
    var actionsheet = document.createElement('div');
    actionsheet.className = 'jactionsheet';
    actionsheet.style.display = 'none';

    var actionContent = document.createElement('div');
    actionContent.className = 'jactionsheet-content';
    actionsheet.appendChild(actionContent);

    var obj = function(options) {
        if (options) {
            obj.options = options;
        }

        // Reset container
        actionContent.innerHTML = '';

        // Create new elements
        for (var i = 0; i < obj.options.length; i++) {
            var actionGroup = document.createElement('div');
            actionGroup.className = 'jactionsheet-group';

            for (var j = 0; j < obj.options[i].length; j++) {
                var v = obj.options[i][j];
                var actionItem = document.createElement('div');
                var actionInput = document.createElement('input');
                actionInput.type = 'button';
                actionInput.value = v.title;
                if (v.className) {
                    actionInput.className = v.className; 
                }
                if (v.onclick) {
                    actionInput.onclick = v.onclick; 
                }
                if (v.action == 'cancel') {
                    actionInput.style.color = 'red';
                }
                actionItem.appendChild(actionInput);
                actionGroup.appendChild(actionItem);
            }

            actionContent.appendChild(actionGroup);
        }

        // Show
        actionsheet.style.display = '';

        // Append
        jSuites.el.appendChild(actionsheet);

        // Animation
        jSuites.slideBottom(actionContent, true);
    }

    obj.close = function() {
        if (actionsheet.style.display != 'none') {
            // Remove any existing actionsheet
            jSuites.slideBottom(actionContent, false, function() {
                actionsheet.remove();
                actionsheet.style.display = 'none';
            });
        }
    }

    var mouseUp = function(e) {
        obj.close();
    }

    actionsheet.addEventListener('mouseup', mouseUp);

    obj.options = {};

    return obj;
})();

/**
 * (c) jSuites modal
 * https://github.com/paulhodel/jsuites
 *
 * @author: Paul Hodel <paul.hodel@gmail.com>
 * @description: Modal
 */

jSuites.modal = (function(el, options) {
    var obj = {};
    obj.options = {};

    // Default configuration
    var defaults = {
        url: null,
        onopen: null,
        onclose: null,
        closed: false,
        width: null,
        height: null,
        title: null,
    };

    // Loop through our object
    for (var property in defaults) {
        if (options && options.hasOwnProperty(property)) {
            obj.options[property] = options[property];
        } else {
            obj.options[property] = defaults[property];
        }
    }

    // Title
    if (! obj.options.title && el.getAttribute('title')) {
        obj.options.title = el.getAttribute('title');
    }

    var temp = document.createElement('div');
    for (var i = 0; i < el.children.length; i++) {
        temp.appendChild(el.children[i]);
    }

    obj.content = document.createElement('div');
    obj.content.className = 'jmodal_content';
    obj.content.innerHTML = el.innerHTML;

    for (var i = 0; i < temp.children.length; i++) {
        obj.content.appendChild(temp.children[i]);
    }

    obj.container = document.createElement('div');
    obj.container.className = 'jmodal';
    obj.container.appendChild(obj.content);

    if (obj.options.width) {
        obj.container.style.width = obj.options.width;
    }
    if (obj.options.height) {
        obj.container.style.height = obj.options.height;
    }
    if (obj.options.title) {
        obj.container.setAttribute('title', obj.options.title);
    } else {
        obj.container.classList.add('no-title');
    }
    el.innerHTML = '';
    el.style.display = 'none';
    el.appendChild(obj.container);

    // Backdrop
    var backdrop = document.createElement('div');
    backdrop.className = 'jmodal_backdrop';
    el.appendChild(backdrop);

    obj.open = function() {
        el.style.display = 'block';
        // Fullscreen
        const rect = obj.container.getBoundingClientRect();
        if (jSuites.getWindowWidth() < rect.width) {
            obj.container.style.top = '';
            obj.container.style.left = '';
            obj.container.classList.add('jmodal_fullscreen');
            jSuites.slideBottom(obj.container, 1);
        } else {
            backdrop.style.display = 'block';
        }
        // Current
        jSuites.modal.current = obj;
        // Event
        if (typeof(obj.options.onopen) == 'function') {
            obj.options.onopen(el, obj);
        }
    }

    obj.resetPosition = function() {
        obj.container.style.top = '';
        obj.container.style.left = '';
    }

    obj.isOpen = function() {
        return el.style.display != 'none' ? true : false;
    }

    obj.close = function() {
        el.style.display = 'none';
        // Backdrop
        backdrop.style.display = '';
        // Current
        jSuites.modal.current = null;
        // Remove fullscreen class
        obj.container.classList.remove('jmodal_fullscreen');
        // Event
        if (typeof(obj.options.onclose) == 'function') {
            obj.options.onclose(el, obj);
        }
    }

    if (! jSuites.modal.hasEvents) {
        jSuites.modal.current = obj;

        if ('ontouchstart' in document.documentElement === true) {
            document.addEventListener("touchstart", jSuites.modal.mouseDownControls);
        } else {
            document.addEventListener('mousedown', jSuites.modal.mouseDownControls);
            document.addEventListener('mousemove', jSuites.modal.mouseMoveControls);
            document.addEventListener('mouseup', jSuites.modal.mouseUpControls);
        }

        document.addEventListener('keydown', jSuites.modal.keyDownControls);

        jSuites.modal.hasEvents = true;
    }

    if (obj.options.url) {
        jSuites.ajax({
            url: obj.options.url,
            method: 'GET',
            success: function(data) {
                obj.content.innerHTML = data;

                if (! obj.options.closed) {
                    obj.open();
                }
            }
        });
    } else {
        if (! obj.options.closed) {
            obj.open();
        }
    }

    // Keep object available from the node
    el.modal = obj;

    return obj;
});

jSuites.modal.current = null;
jSuites.modal.position = null;

jSuites.modal.keyDownControls = function(e) {
    if (e.which == 27) {
        if (jSuites.modal.current) {
            jSuites.modal.current.close();
        }
    }
}

jSuites.modal.mouseUpControls = function(e) {
    if (jSuites.modal.current) {
        jSuites.modal.current.container.style.cursor = 'auto';
    }
    jSuites.modal.position = null;
}

jSuites.modal.mouseMoveControls = function(e) {
    if (jSuites.modal.current && jSuites.modal.position) {
        if (e.which == 1 || e.which == 3) {
            var position = jSuites.modal.position;
            jSuites.modal.current.container.style.top = (position[1] + (e.clientY - position[3]) + (position[5] / 2)) + 'px';
            jSuites.modal.current.container.style.left = (position[0] + (e.clientX - position[2]) + (position[4] / 2)) + 'px';
            jSuites.modal.current.container.style.cursor = 'move';
        } else {
            jSuites.modal.current.container.style.cursor = 'auto';
        }
    }
}

jSuites.modal.mouseDownControls = function(e) {
    jSuites.modal.position = [];

    if (e.target.classList.contains('jmodal')) {
        setTimeout(function() {
            // Get target info
            var rect = e.target.getBoundingClientRect();

            if (e.changedTouches && e.changedTouches[0]) {
                var x = e.changedTouches[0].clientX;
                var y = e.changedTouches[0].clientY;
            } else {
                var x = e.clientX;
                var y = e.clientY;
            }

            if (rect.width - (x - rect.left) < 50 && (y - rect.top) < 50) {
                setTimeout(function() {
                    jSuites.modal.current.close();
                }, 100);
            } else {
                if (e.target.getAttribute('title') && (y - rect.top) < 50) {
                    if (document.selection) {
                        document.selection.empty();
                    } else if ( window.getSelection ) {
                        window.getSelection().removeAllRanges();
                    }

                    jSuites.modal.position = [
                        rect.left,
                        rect.top,
                        e.clientX,
                        e.clientY,
                        rect.width,
                        rect.height,
                    ];
                }
            }
        }, 100);
    }
}


jSuites.notification = (function(options) {
    var obj = {};
    obj.options = {};

    // Default configuration
    var defaults = {
        icon: null,
        name: 'Notification',
        date: null,
        title: null,
        message: null,
        timeout: 4000,
        autoHide: true,
        closeable: true,
    };

    // Loop through our object
    for (var property in defaults) {
        if (options && options.hasOwnProperty(property)) {
            obj.options[property] = options[property];
        } else {
            obj.options[property] = defaults[property];
        }
    }

    var notification = document.createElement('div');
    notification.className = 'jnotification';

    var notificationContainer = document.createElement('div');
    notificationContainer.className = 'jnotification-container';
    notification.appendChild(notificationContainer);

    var notificationHeader = document.createElement('div');
    notificationHeader.className = 'jnotification-header';
    notificationContainer.appendChild(notificationHeader);

    var notificationImage = document.createElement('div');
    notificationImage.className = 'jnotification-image';
    notificationHeader.appendChild(notificationImage);

    if (obj.options.icon) {
        var notificationIcon = document.createElement('img');
        notificationIcon.src = obj.options.icon;
        notificationImage.appendChild(notificationIcon);
    }

    var notificationName = document.createElement('div');
    notificationName.className = 'jnotification-name';
    notificationName.innerHTML = obj.options.name;
    notificationHeader.appendChild(notificationName);

    if (obj.options.closeable == true) {
        var notificationClose = document.createElement('div');
        notificationClose.className = 'jnotification-close';
        notificationClose.onclick = function() {
            obj.hide();
        }
        notificationHeader.appendChild(notificationClose);
    }

    var notificationDate = document.createElement('div');
    notificationDate.className = 'jnotification-date';
    notificationHeader.appendChild(notificationDate);

    var notificationContent = document.createElement('div');
    notificationContent.className = 'jnotification-content';
    notificationContainer.appendChild(notificationContent);

    if (obj.options.title) {
        var notificationTitle = document.createElement('div');
        notificationTitle.className = 'jnotification-title';
        notificationTitle.innerHTML = obj.options.title;
        notificationContent.appendChild(notificationTitle);
    }

    var notificationMessage = document.createElement('div');
    notificationMessage.className = 'jnotification-message';
    notificationMessage.innerHTML = obj.options.message;
    notificationContent.appendChild(notificationMessage);

    obj.show = function() {
        document.body.appendChild(notification);
        if (jSuites.getWindowWidth() > 800) { 
            jSuites.fadeIn(notification);
        } else {
            jSuites.slideTop(notification, 1);
        }
    }

    obj.hide = function() {
        if (jSuites.getWindowWidth() > 800) { 
            jSuites.fadeOut(notification, function() {
                notification.parentNode.removeChild(notification);
            });
        } else {
            jSuites.slideTop(notification, 0, function() {
                notification.parentNode.removeChild(notification);
            });
        }
    };

    obj.show();

    if (obj.options.autoHide == true) {
        setTimeout(function() {
            obj.hide();
        }, obj.options.timeout);
    }

    if (jSuites.getWindowWidth() < 800) {
        notification.addEventListener("swipeup", function(e) {
            obj.hide();
            e.preventDefault();
            e.stopPropagation();
        });
    }

    return obj;
});

jSuites.rating = (function(el, options) {
    var obj = {};
    obj.options = {};

    // Default configuration
    var defaults = {
        number: 5,
        value: 0,
        tooltip: [ 'Very bad', 'Bad', 'Average', 'Good', 'Very good' ],
        onchange: null,
    };

    // Loop through the initial configuration
    for (var property in defaults) {
        if (options && options.hasOwnProperty(property)) {
            obj.options[property] = options[property];
        } else {
            obj.options[property] = defaults[property];
        }
    }

    // Class
    el.classList.add('jrating');

    // Add elements
    for (var i = 0; i < obj.options.number; i++) {
        var div = document.createElement('div');
        div.setAttribute('data-index', (i + 1))
        div.setAttribute('title', obj.options.tooltip[i])
        el.appendChild(div);
    }

    // Set value
    obj.setValue = function(index) {
        for (var i = 0; i < obj.options.number; i++) {
            if (i < index) {
                el.children[i].classList.add('jrating-selected');
            } else {
                el.children[i].classList.remove('jrating-over');
                el.children[i].classList.remove('jrating-selected');
            }
        }

        obj.options.value = index;

        if (typeof(obj.options.onchange) == 'function') {
            obj.options.onchange(el, index);
        }
    }

    obj.getValue = function() {
        return obj.options.value;
    }

    if (obj.options.value) {
        for (var i = 0; i < obj.options.number; i++) {
            if (i < obj.options.value) {
                el.children[i].classList.add('jrating-selected');
            }
        }
    }

    // Events
    el.addEventListener("click", function(e) {
        var index = e.target.getAttribute('data-index');
        if (index != undefined) {
            if (index == obj.options.value) {
                obj.setValue(0);
            } else {
                obj.setValue(index);
            }
        }
    });

    el.addEventListener("mouseover", function(e) {
        var index = e.target.getAttribute('data-index');
        for (var i = 0; i < obj.options.number; i++) {
            if (i < index) {
                el.children[i].classList.add('jrating-over');
            } else {
                el.children[i].classList.remove('jrating-over');
            }
        }
    });

    el.addEventListener("mouseout", function(e) {
        for (var i = 0; i < obj.options.number; i++) {
            el.children[i].classList.remove('jrating-over');
        }
    });

    el.rating = obj;

    return obj;
});


/**
 * (c) Image slider
 * https://github.com/paulhodel/jtools
 *
 * @author: Paul Hodel <paul.hodel@gmail.com>
 * @description: Image Slider
 */

jSuites.slider = (function(el, options) {
    var obj = {};
    obj.options = {};
    obj.currentImage = null;

    if (options) {
        obj.options = options;
    }

    // Items
    obj.options.items = [];

    if (! el.classList.contains('jslider')) {
        el.classList.add('jslider');

        // Create container
        var container = document.createElement('div');
        container.className = 'jslider-container';

        // Move children inside
        if (el.children.length > 0) {
            // Keep children items
            for (var i = 0; i < el.children.length; i++) {
                obj.options.items.push(el.children[i]);
            }
        }
        if (obj.options.items.length > 0) {
            for (var i = 0; i < obj.options.items.length; i++) {
                obj.options.items[i].classList.add('jfile');
                var index = obj.options.items[i].src.lastIndexOf('/');
                if (index < 0) {
                    obj.options.items[i].setAttribute('data-name', obj.options.items[i].src);
                } else {
                    obj.options.items[i].setAttribute('data-name', obj.options.items[i].src.substr(index + 1));
                }
                var index = obj.options.items[i].src.lastIndexOf('/');

                container.appendChild(obj.options.items[i]);
            }
        }
        el.appendChild(container);
        // Add close buttom
        var close = document.createElement('div');
        close.className = 'jslider-close';
        close.innerHTML = '';
        close.onclick =  function() {
            obj.close();
        }
        el.appendChild(close);
    } else {
        var container = el.querySelector('slider-container');
    }

    obj.show = function(target) {
        if (! target) {
            var target = container.children[0];
        }

        if (! container.classList.contains('jslider-preview')) {
            container.classList.add('jslider-preview');
            close.style.display = 'block';
        }

        // Hide all images
        for (var i = 0; i < container.children.length; i++) {
            container.children[i].style.display = 'none';
        }

        // Show clicked only
        target.style.display = 'block';

        // Is there any previous
        if (target.previousSibling) {
            container.classList.add('jslider-left');
        } else {
            container.classList.remove('jslider-left');
        }

        // Is there any next
        if (target.nextSibling) {
            container.classList.add('jslider-right');
        } else {
            container.classList.remove('jslider-right');
        }

        obj.currentImage = target;
    }

    obj.open = function() {
        obj.show();

        // Event
        if (typeof(obj.options.onopen) == 'function') {
            obj.options.onopen(el);
        }
    }

    obj.close = function() {
        container.classList.remove('jslider-preview');
        container.classList.remove('jslider-left');
        container.classList.remove('jslider-right');

        for (var i = 0; i < container.children.length; i++) {
            container.children[i].style.display = '';
        }

        close.style.display = '';

        obj.currentImage = null;

        // Event
        if (typeof(obj.options.onclose) == 'function') {
            obj.options.onclose(el);
        }
    }

    obj.reset = function() {
        container.innerHTML = '';
    }

    obj.addFile = function(v, ignoreEvents) {
        var img = document.createElement('img');
        img.setAttribute('data-lastmodified', v.lastmodified);
        img.setAttribute('data-name', v.name);
        img.setAttribute('data-size', v.size);
        img.setAttribute('data-extension', v.extension);
        img.setAttribute('data-cover', v.cover);
        img.setAttribute('src', v.file);
        img.className = 'jfile';
        container.appendChild(img);
        obj.options.items.push(img);

        // Onchange
        if (! ignoreEvents) {
            if (typeof(obj.options.onchange) == 'function') {
                obj.options.onchange(el, v);
            }
        }
    }

    obj.addFiles = function(files) {
        for (var i = 0; i < files.length; i++) {
            obj.addFile(files[i]);
        }
    }

    obj.next = function() {
        if (obj.currentImage.nextSibling) {
            obj.show(obj.currentImage.nextSibling);
        }
    }
    
    obj.prev = function() {
        if (obj.currentImage.previousSibling) {
            obj.show(obj.currentImage.previousSibling);
        }
    }

    obj.getData = function() {
        return jSuites.getFiles(container);
    }

    // Append data
    if (obj.options.data && obj.options.data.length) {
        for (var i = 0; i < obj.options.data.length; i++) {
            if (obj.options.data[i]) {
                obj.addFile(obj.options.data[i]);
            }
        }
    }

    // Allow insert
    if (obj.options.allowAttachment) {
        var attachmentInput = document.createElement('input');
        attachmentInput.type = 'file';
        attachmentInput.className = 'slider-attachment';
        attachmentInput.setAttribute('accept', 'image/*');
        attachmentInput.style.display = 'none';
        attachmentInput.onchange = function() {
            var reader = [];

            for (var i = 0; i < this.files.length; i++) {
                var type = this.files[i].type.split('/');

                if (type[0] == 'image') {
                    var extension = this.files[i].name;
                    extension = extension.split('.');
                    extension = extension[extension.length-1];

                    var file = {
                        size: this.files[i].size,
                        name: this.files[i].name,
                        extension: extension,
                        cover: 0,
                        lastmodified: this.files[i].lastModified,
                    }

                    reader[i] = new FileReader();
                    reader[i].addEventListener("load", function (e) {
                        file.file = e.target.result;
                        obj.addFile(file);
                    }, false);

                    reader[i].readAsDataURL(this.files[i]);
                } else {
                    alert('The extension is not allowed');
                }
            };
        }

        var attachmentIcon = document.createElement('i');
        attachmentIcon.innerHTML = 'attachment';
        attachmentIcon.className = 'jslider-attach material-icons';
        attachmentIcon.onclick = function() {
            jSuites.click(attachmentInput);
        }

        el.appendChild(attachmentInput);
        el.appendChild(attachmentIcon);
    }

    // Push to refresh
    var longTouchTimer = null;

    var mouseDown = function(e) {
        if (e.target.tagName == 'IMG') {
            // Remove
            var targetImage = e.target;
            longTouchTimer = setTimeout(function() {
                if (e.target.src.substr(0,4) == 'data') {
                    e.target.remove();
                } else {
                    if (e.target.classList.contains('jremove')) {
                        e.target.classList.remove('jremove');
                    } else {
                        e.target.classList.add('jremove');
                    }
                }

                // Onchange
                if (typeof(obj.options.onchange) == 'function') {
                    obj.options.onchange(el, e.target);
                }
            }, 1000);
        }
    }

    var mouseUp = function(e) {
        if (longTouchTimer) {
            clearTimeout(longTouchTimer);
        }

        // Open slider
        if (e.target.tagName == 'IMG') {
            if (! e.target.classList.contains('jremove')) {
                obj.show(e.target);
            }
        } else {
            // Arrow controls
            if (e.target.clientWidth - e.offsetX < 40) {
                // Show next image
                obj.next();
            } else if (e.offsetX < 40) {
                // Show previous image
                obj.prev();
            }
        }
    }

    container.addEventListener('mousedown', mouseDown);
    container.addEventListener('touchstart', mouseDown);
    container.addEventListener('mouseup', mouseUp);
    container.addEventListener('touchend', mouseUp);

    // Add global events
    el.addEventListener("swipeleft", function(e) {
        obj.next();
        e.preventDefault();
        e.stopPropagation();
    });

    el.addEventListener("swiperight", function(e) {
        obj.prev();
        e.preventDefault();
        e.stopPropagation();
    });


    el.slider = obj;

    return obj;
});

/**
 * (c) jTools v1.0.1 - Element sorting
 * https://github.com/paulhodel/jtools
 *
 * @author: Paul Hodel <paul.hodel@gmail.com>
 * @description: Element drag and drop sorting
 */

jSuites.sorting = (function(el, options) {
    el.classList.add('jsorting');

    el.addEventListener('dragstart', function(e) {
        e.target.classList.add('dragging');
    });

    el.addEventListener('dragover', function(e) {
        e.preventDefault();

        if (e.target.clientHeight / 2 > e.offsetY) {
            e.path[0].style.borderTop = '1px dotted #ccc';
            e.path[0].style.borderBottom = '';
        } else {
            e.path[0].style.borderTop = '';
            e.path[0].style.borderBottom = '1px dotted #ccc';
        }
    });

    el.addEventListener('dragleave', function(e) {
        e.path[0].style.borderTop = '';
        e.path[0].style.borderBottom = '';
    });

    el.addEventListener('dragend', function(e) {
        e.path[1].querySelector('.dragging').classList.remove('dragging');
    });

    el.addEventListener('drop', function(e) {
        var element = e.path[1].querySelector('.dragging');

        if (e.target.clientHeight / 2 > e.offsetY) {
            e.path[1].insertBefore(element, e.path[0]);
        } else {
            e.path[1].insertBefore(element, e.path[0].nextSibling);
        }

        e.path[0].style.borderTop = '';
        e.path[0].style.borderBottom = '';
    });

    for (var i = 0; i < el.children.length; i++) {
        el.children[i].setAttribute('draggable', 'true');
    };

    return el;
});

jSuites.tabs = (function(el, options) {
    var obj = {};
    obj.options = {};

    // Default configuration
    var defaults = {
        data: null,
        allowCreate: false,
        onload: null,
        onchange: null,
        oncreate: null,
        animation: false,
        create: null,
        autoName: false,
        prefixName: '',
        hideHeaders: false,
    };

    // Loop through the initial configuration
    for (var property in defaults) {
        if (options && options.hasOwnProperty(property)) {
            obj.options[property] = options[property];
        } else {
            obj.options[property] = defaults[property];
        }
    }

    // Class
    el.classList.add('jtabs');

    if (obj.options.animation == true) {
        // Border
        var border = document.createElement('div');
        border.className = 'jtabs-border';
        el.appendChild(border);

        var setBorder = function(index) {
            var rect = headers.children[index].getBoundingClientRect();
            var rectContent = content.children[index].getBoundingClientRect();
            border.style.width = rect.width + 'px';
            border.style.left = (rect.left - rectContent.left) + 'px';
            border.style.top = rect.height + 'px';
        }
    }

    // Set value
    obj.open = function(index) {
        for (var i = 0; i < headers.children.length; i++) {
            headers.children[i].classList.remove('jtabs-selected');
            if (content.children[i]) {
                content.children[i].classList.remove('jtabs-selected');
            }
        }

        headers.children[index].classList.add('jtabs-selected');
        if (content.children[index]) {
            content.children[index].classList.add('jtabs-selected');
        }

        // Hide
        if (obj.options.hideHeaders == true && (headers.children.length < 2 && obj.options.allowCreate == false)) {
            headers.style.display = 'none';
        } else {
            headers.style.display = '';
            // Set border
            if (obj.options.animation == true) {
                setTimeout(function() {
                    setBorder(index);
                }, 100);
            }
        }
    }

    obj.selectIndex = function(a) {
        var index = Array.prototype.indexOf.call(headers.children, a);
        if (index >= 0) {
            obj.open(index);
        }
    }

    obj.create = function(title, div) {
        if (typeof(obj.options.create) == 'function') {
            obj.options.create();
        } else {
            obj.appendElement(title, div);

            if (typeof(obj.options.oncreate) == 'function') {
                obj.options.oncreate(el, div)
            }
        }
    }

    obj.appendElement = function(title, div) {
        if (! title) {
            if (obj.options.autoName == true) {
                var title = obj.options.prefixName;
                title += ' ' + (parseInt(content.children.length) + 1);
            } else {
                var title = prompt('Title?', '');
            }
        }

        if (title) {
            // Add headers
            var header = document.createElement('div');
            header.innerHTML = title;
            if (obj.options.allowCreate) {
                headers.insertBefore(header, headers.lastChild);
            } else {
                headers.appendChild(header);
            }

            // Add content
            if (! div) {
                var div = document.createElement('div');
            }
            content.appendChild(div);

            // Open new tab
            obj.selectIndex(header);
        }
    }

    // Create from data
    if (obj.options.data) {
        // Make sure the component is blank
        el.innerHTML = '';
        var headers = document.createElement('div');
        var content = document.createElement('div');
        headers.classList.add('jtabs-headers');
        content.classList.add('jtabs-content');
        el.appendChild(headers);
        el.appendChild(content);

        for (var i = 0; i < obj.options.data.length; i++) {
            var headersItem = document.createElement('div');
            headers.appendChild(headersItem);
            var contentItem = document.createElement('div');
            content.appendChild(contentItem);

            headersItem.innerHTML = obj.options.data[i].title;
            if (obj.options.data[i].content) {
                contentItem.innerHTML = obj.options.data[i].content;
            } else if (obj.options.data[i].url) {
                jSuites.ajax({
                    url: obj.options.data[i].url,
                    type: 'GET',
                    success: function(result) {
                        contentItem.innerHTML = result;
                    },
                    complete: function() {
                        if (typeof(obj.options.onload) == 'function') {
                            obj.options.onload(el);

                            obj.open(0);
                        }
                    }
                });
            }
        }
    } else if (el.children[0] && el.children[1]) {
        // Create from existing elements
        var headers = el.children[0];
        var content = el.children[1];
        headers.classList.add('jtabs-headers');
        content.classList.add('jtabs-content');
    } else {
        el.innerHTML = '';
        var headers = document.createElement('div');
        var content = document.createElement('div');
        headers.classList.add('jtabs-headers');
        content.classList.add('jtabs-content');
        el.appendChild(headers);
        el.appendChild(content);
    }

    // New
    if (obj.options.allowCreate == true) {
        var add = document.createElement('i');
        add.className = 'jtabs-add';
        headers.appendChild(add);
    }

    // Events
    headers.addEventListener("click", function(e) {
        if (e.target.tagName == 'DIV') {
            obj.selectIndex(e.target);
        } else {
            obj.create();
        }
    });

    if (headers.children.length) {
        obj.open(0);
    }

    el.tabs = obj;

    return obj;
});

jSuites.tags = (function(el, options) {
    var obj = {};
    obj.options = {};

    /**
     * @typedef {Object} defaults
     * @property {(string|Array)} value - Initial value of the compontent
     * @property {number} limit - Max number of tags inside the element
     * @property {string} search - The URL for suggestions
     * @property {string} placeholder - The default instruction text on the element
     * @property {validation} validation - Method to validate the tags
     * @property {requestCallback} onbeforechange - Method to be execute before any changes on the element
     * @property {requestCallback} onchange - Method to be execute after any changes on the element
     * @property {requestCallback} onfocus - Method to be execute when on focus
     * @property {requestCallback} onblur - Method to be execute when on blur
     * @property {requestCallback} onload - Method to be execute when the element is loaded
     */
    var defaults = {
        value: null,
        limit: null,
        limitMessage: 'The limit of entries is: ',
        search: null,
        placeholder: null,
        validation: null,
        onbeforechange: null,
        onchange: null,
        onfocus: null,
        onblur: null,
        onload: null,
        colors: null,
    };

    // Loop through though the default configuration
    for (var property in defaults) {
        if (options && options.hasOwnProperty(property)) {
            obj.options[property] = options[property];
        } else {
            obj.options[property] = defaults[property];
        }
    }

    // Search helpers
    var searchContainer = null;
    var searchTerms = null;
    var searchIndex = 0;
    var searchTimer = 0;

    /**
     * Add a new tag to the element
     * @param {(?string|Array)} value - The value of the new element
     */
    obj.add = function(value, focus) {
        if (typeof(obj.options.onbeforechange) == 'function') {
            var v = obj.options.onbeforechange(el, obj, value);
            if (v != null) {
                value = v;
            }
        }

        // Close search
        if (searchContainer) {
            searchContainer.style.display = '';
        }

        if (obj.options.limit > 0 && el.children.length >= obj.options.limit) {
            alert(obj.options.limitMessage + ' ' + obj.options.limit);
        } else {
            // Get node
            var node = getSelectionStart();

            // Mix argument string or array
            if (! value || typeof(value) == 'string') {
                var div = document.createElement('div');
                div.innerHTML = value ? value : '<br>';
                if (node && node.parentNode.classList.contains('jtags')) {
                    el.insertBefore(div, node.nextSibling);
                } else {
                    el.appendChild(div);
                }
            } else {
                if (node && node.parentNode.classList.contains('jtags')) {
                    if (! node.innerText.replace("\n", "")) {
                        el.removeChild(node);
                    }
                }

                for (var i = 0; i <= value.length; i++) {
                    if (! obj.options.limit || el.children.length < obj.options.limit) {
                        var div = document.createElement('div');
                        div.innerHTML = value[i] ? value[i] : '<br>';
                        el.appendChild(div);
                    }
                }
            }

            // Place caret
            if (focus) {
                setTimeout(function() {
                    caret(div);
                }, 0);
            }

            // Filter
            filter();

            if (typeof(obj.options.onchange) == 'function') {
                obj.options.onchange(el, obj, value ? value : '');
            }
        }
    }

    /**
     * Get all tags in the element
     * @return {Array} data - All tags as an array
     */
    obj.getData = function() {
        var data = [];
        for (var i = 0; i < el.children.length; i++) {
            var value = obj.getValue(i);
            if (value) {
                var id = el.children[i].getAttribute('data-id');
                if (! id) {
                    id = value;
                }
                data.push({ id: id, value: value });
            }
        }
        return data;
    }

    /**
     * Get the value of one tag. Null for all tags
     * @param {?number} index - Tag index number. Null for all tags.
     * @return {string} value - All tags separated by comma
     */
    obj.getValue = function(index) {
        var value = null;

        if (index != null) {
            // Get one individual value
            value = el.children[index].innerText.replace("\n", "");
        } else {
            // Get all
            var data = [];
            for (var i = 0; i < el.children.length; i++) {
                value = el.children[i].innerText.replace("\n", "");
                if (value) {
                    data.push(obj.getValue(i));
                }
            }
            value = data.join(',');
        }

        return value;
    }

    /**
     * Set the value of the element based on a string separeted by (,|;|\r\n)
     * @param {string} value - A string with the tags
     */
    obj.setValue = function(text) {
        // Remove whitespaces
        text = text.trim();

        if (text) {
            // Tags
            var data = extractTags(text);
            // Add tags to the element
            obj.add(data);
        }
    }

    obj.reset = function() {
        el.innerHTML = '<div><br></div>';
    }

    /**
     * Verify if all tags in the element are valid
     * @return {boolean}
     */
    obj.isValid = function() {
        var test = 0;
        for (var i = 0; i < el.children.length; i++) {
            if (el.children[i].classList.contains('jtags_error')) {
                test++;
            }
        }
        return test == 0 ? true : false;
    }

    /**
     * Add one element from the suggestions to the element
     * @param {object} item - Node element in the suggestions container
     */ 
    obj.selectIndex = function(item) {
        // Reset terms
        searchTerms = '';
        var node = getSelectionStart();
        // Append text to the caret
        node.innerText = item.children[1].innerText;
        // Set node id
        if (item.children[1].getAttribute('data-id')) {
            node.setAttribute('data-id', item.children[1].getAttribute('data-id'));
        }
        // Close container
        if (searchContainer) {
            searchContainer.style.display = '';
            searchContainer.innerHTML = '';
        }
        // Remove any error
        node.classList.remove('jtags_error');
        // Add new item
        obj.add();
    }

    /**
     * Search for suggestions
     * @param {object} node - Target node for any suggestions
     */
    obj.search = function(node) {
        // Create and append search container to the DOM
        if (! searchContainer) {
            var div = document.createElement('div');
            div.style.position = 'relative';
            el.parentNode.insertBefore(div, el.nextSibling);

            // Create container
            searchContainer = document.createElement('div');
            searchContainer.classList.add('jtags_search');
            div.appendChild(searchContainer);
        }

        // Search for
        var terms = node.anchorNode.nodeValue;

        // Search
        if (node.anchorNode.nodeValue && terms != searchTerms) {
            // Terms
            searchTerms = node.anchorNode.nodeValue;
            // Reset index
            searchIndex = 0;
            // Get remove results
            jSuites.ajax({
                url: obj.options.search + searchTerms,
                method: 'GET',
                dataType: 'json',
                success: function(data) {
                    // Reset container
                    searchContainer.innerHTML = '';

                    // Print results
                    if (! data.length) {
                        // Show container
                        searchContainer.style.display = '';
                    } else {
                        // Show container
                        searchContainer.style.display = 'block';

                        // Show items
                        var len = data.length < 11 ? data.length : 10;
                        for (var i = 0; i < len; i++) {
                            var div = document.createElement('div');
                            if (i == 0) {
                                div.classList.add('selected');
                            }
                            var img = document.createElement('img');
                            if (data[i].image) {
                                img.src = data[i].image;
                            } else {
                                img.style.display = 'none';
                            }
                            div.appendChild(img);

                            var item = document.createElement('div');
                            item.setAttribute('data-id', data[i].id);
                            item.innerHTML = data[i].name;
                            div.onclick = function() {
                                // Add item
                                obj.selectIndex(this);
                            }
                            div.appendChild(item);
                            // Append item to the container
                            searchContainer.appendChild(div);
                        }
                    }
                }
            });
        }
    }

    // Destroy tags element
    obj.destroy = function() {
        // Bind events
        el.removeEventListener('mouseup', tagsMouseUp);
        el.removeEventListener('keydown', tagsKeyDown);
        el.removeEventListener('keyup', tagsKeyUp);
        el.removeEventListener('paste', tagsPaste);
        el.removeEventListener('focus', tagsFocus);
        el.removeEventListener('blur', tagsBlur);
        // Remove element
        el.parentNode.removeChild(el);
    }

    var getRandomColor = function(index) {
        var rand = function(min, max) {
            return min + Math.random() * (max - min);
        }
        return 'hsl(' + rand(1, 360) + ',' + rand(40, 70) + '%,' + rand(65, 72) + '%)';
    }

    /**
     * Filter tags
     */
    var filter = function() {
        for (var i = 0; i < el.children.length; i++) {
            // Create label design
            if (! obj.getValue(i)) {
                el.children[i].classList.remove('jtags_label');
            } else {
                el.children[i].classList.add('jtags_label');

                // Validation in place
                if (typeof(obj.options.validation) == 'function') {
                    if (obj.getValue(i)) {
                        if (! obj.options.validation(el.children[i], el.children[i].innerText, el.children[i].getAttribute('data-id'))) {
                            el.children[i].classList.add('jtags_error');
                        } else {
                            el.children[i].classList.remove('jtags_error');
                        }
                    } else {
                        el.children[i].classList.remove('jtags_error');
                    }
                }
            }
        }
    }

    /**
     * Place caret in the element node
     */
    var caret = function(e) {
        var range = document.createRange();
        var sel = window.getSelection();
        range.setStart(e, e.innerText.length);
        range.collapse(true);
        sel.removeAllRanges();
        sel.addRange(range);
    }

    /**
     * Selection
     */
    var getSelectionStart = function() {
        var node = document.getSelection().anchorNode;
        if (node) {
            return (node.nodeType == 3 ? node.parentNode : node);
        } else {
            return null;
        }
    }

    /**
     * Extract tags from a string
     * @param {string} text - Raw string
     * @return {Array} data - Array with extracted tags
     */
    var extractTags = function(text) {
        /** @type {Array} */
        var data = [];

        /** @type {string} */
        var word = '';

        // Remove whitespaces
        text = text.trim();

        if (text) {
            for (var i = 0; i < text.length; i++) {
                if (text[i] == ',' || text[i] == ';' || text[i] == '\r\n') {
                    if (word) {
                        data.push(word);
                        word = '';
                    }
                } else {
                    word += text[i];
                }
            }

            if (word) {
                data.push(word);
            }
        }

        return data;
    }

    /** @type {number} */
    var anchorOffset = 0;

    /**
     * Processing event keydown on the element
     * @param e {object}
     */
    var tagsKeyDown = function(e) {
        // Anchoroffset
        anchorOffset = window.getSelection().anchorOffset;

        // Verify content
        if (! el.children.length) {
            var div = document.createElement('div');
            div.innerHTML = '<br>';
            el.appendChild(div);
        }
        // Comma
        if (e.which == 9 || e.which == 186 || e.which == 188) {
            var n = window.getSelection().anchorOffset;
            if (n > 1) {
                if (! obj.options.limit || el.children.length < obj.options.limit) {
                    obj.add('', true);
                }
            }
            e.preventDefault();
        } else if (e.which == 13) {
            // Enter
            if (searchContainer && searchContainer.style.display != '') {
                obj.selectIndex(searchContainer.children[searchIndex]);
            } else {
                var n = window.getSelection().anchorOffset;
                if (n > 1) {
                    if (! obj.options.limit || el.children.length < obj.options.limit) {
                        obj.add('', true);
                    }
                }
            }
            e.preventDefault();
        } else if (e.which == 38) {
            // Up
            if (searchContainer && searchContainer.style.display != '') {
                searchContainer.children[searchIndex].classList.remove('selected');
                if (searchIndex > 0) {
                    searchIndex--;
                }
                searchContainer.children[searchIndex].classList.add('selected');
                e.preventDefault();
            }
        } else if (e.which == 40) {
            // Down
            if (searchContainer && searchContainer.style.display != '') {
                searchContainer.children[searchIndex].classList.remove('selected');
                if (searchIndex < 9) {
                    searchIndex++;
                }
                searchContainer.children[searchIndex].classList.add('selected');
                e.preventDefault();
            }
        }
    }

    /**
     * Processing event keyup on the element
     * @param e {object}
     */
    var tagsKeyUp = function(e) {
        if (e.which == 39) {
            var n = window.getSelection().anchorOffset;
            if (n > 1 && n == anchorOffset) {
                obj.add();
            }
        } else if (e.which == 13 || e.which == 38 || e.which == 40) {
            e.preventDefault();
        } else {
            if (searchTimer) {
                clearTimeout(searchTimer);
            }

            searchTimer = setTimeout(function() {
                // Current node
                var node = window.getSelection();
                // Search
                if (obj.options.search) {
                    obj.search(node);
                }
                searchTimer = null;
            }, 300);
        }

        filter();
    }

    /**
     * Processing event paste on the element
     * @param e {object}
     */
    var tagsPaste =  function(e) {
        if (e.clipboardData || e.originalEvent.clipboardData) {
            var html = (e.originalEvent || e).clipboardData.getData('text/html');
            var text = (e.originalEvent || e).clipboardData.getData('text/plain');
        } else if (window.clipboardData) {
            var html = window.clipboardData.getData('Html');
            var text = window.clipboardData.getData('Text');
        }

        obj.setValue(text);
        e.preventDefault();
    }

    /**
     * Processing event mouseup on the element
     * @param e {object}
     */
    var tagsMouseUp = function(e) {
        if (e.target.parentNode && e.target.parentNode.classList.contains('jtags')) {
            if (e.target.classList.contains('jtags_label') || e.target.classList.contains('jtags_error')) {
                const rect = e.target.getBoundingClientRect();
                if (rect.width - (e.clientX - rect.left) < 16) {
                    el.removeChild(e.target);
                    el.focus();
                }
            }
        }

        if (searchContainer) {
            searchContainer.style.display = '';
        }
    }

    /**
     * Processing event focus on the element
     * @param e {object}
     */
    var tagsFocus = function(e) {
        if (! el.children.length || obj.getValue(el.children.length - 1)) {
            if (! obj.options.limit || el.children.length < obj.options.limit) {
                var div = document.createElement('div');
                div.innerHTML = '<br>';
                el.appendChild(div);
            }
        }

        if (typeof(obj.options.onfocus) == 'function') {
            obj.options.onfocus(el, obj, obj.getValue());
        }
    }

    /**
     * Processing event blur on the element
     * @param e {object}
     */
    var tagsBlur = function(e) {
        if (searchContainer) {
            setTimeout(function() {
                searchContainer.style.display = '';
            }, 200);
        }

        for (var i = 0; i < el.children.length - 1; i++) {
            // Create label design
            if (! obj.getValue(i)) {
                el.removeChild(el.children[i]);
            }
        }

        if (typeof(obj.options.onblur) == 'function') {
            obj.options.onblur(el, obj, obj.getValue());
        }
    }

    // Bind events
    el.addEventListener('mouseup', tagsMouseUp);
    el.addEventListener('keydown', tagsKeyDown);
    el.addEventListener('keyup', tagsKeyUp);
    el.addEventListener('paste', tagsPaste);
    el.addEventListener('focus', tagsFocus);
    el.addEventListener('blur', tagsBlur);

    // Prepare container
    el.classList.add('jtags');
    el.setAttribute('contenteditable', true);
    el.setAttribute('spellcheck', false);

    if (obj.options.placeholder) {
        el.placeholder = obj.options.placeholder;
    }

    // Make sure element is empty
    if (obj.options.value) {
        obj.setValue(obj.options.value);
    } else {
        el.innerHTML = '<div><br></div>';
    }

    if (typeof(obj.options.onload) == 'function') {
        obj.options.onload(el, obj);
    }

    el.tags = obj;

    return obj;
});

jSuites.tracker = (function(el, options) {
    var obj = {};
    obj.options = {};

    // Default configuration
    var defaults = {
        url: null,
        message: 'Are you sure? There are unsaved information in your form',
        ignore: false,
        currentHash: null,
        submitButton:null,
        onload: null,
        onbeforesave: null,
        onsave: null,
    };

    // Loop through our object
    for (var property in defaults) {
        if (options && options.hasOwnProperty(property)) {
            obj.options[property] = options[property];
        } else {
            obj.options[property] = defaults[property];
        }
    }

    obj.setUrl = function(url) {
        obj.options.url = url;
    }

    obj.load = function() {
        jSuites.ajax({
            url: obj.options.url,
            method: 'GET',
            dataType: 'json',
            success: function(data) {
                var elements = el.querySelectorAll("input, select, textarea");
 
                for (var i = 0; i < elements.length; i++) {
                    var name = elements[i].getAttribute('name');
                    if (data[name]) {
                        elements[i].value = data[name];
                    }
                }

                if (typeof(obj.options.onload) == 'function') {
                    obj.options.onload(el, data);
                }
            }
        });
    }

    obj.save = function() {
        var test = obj.validate();

        if (test) {
            jSuites.alert(test);
        } else {
            var data = obj.getElements(true);

            if (typeof(obj.options.onbeforesave) == 'function') {
                var data = obj.options.onbeforesave(el, data);

                if (data === false) {
                    console.log('Onbeforesave returned false');
                    return; 
                }
            }

            jSuites.ajax({
                url: obj.options.url,
                method: 'POST',
                dataType: 'json',
                data: data,
                success: function(result) {
                    jSuites.alert(result.message);

                    if (typeof(obj.options.onsave) == 'function') {
                        var data = obj.options.onsave(el, result);
                    }

                    obj.reset();
                }
            });
        }
    }

    obj.validateElement = function(element) {
        var emailChecker = function(data) {
            var pattern = new RegExp(/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/);
            return pattern.test(data) ? true : false; 
        }

        var passwordChecker = function(data) {
            return (data.length > 5) ? true : false;
        }

        var addError = function(element) {
            // Add error in the element
            element.classList.add('error');
            // Submit button
            if (obj.options.submitButton) {
                obj.options.submitButton.setAttribute('disabled', true);
            }
            // Return error message
            return element.getAttribute('data-error') || 'There is an error in the form';
        }

        var delError = function(element) {
            var error = false;
            // Remove class from this element
            element.classList.remove('error');
            // Get elements in the form
            var elements = el.querySelectorAll("input, select, textarea");
            // Run all elements 
            for (var i = 0; i < elements.length; i++) {
                if (elements[i].getAttribute('data-validation')) {
                    if (elements[i].classList.contains('error')) {
                        error = true;
                    }
                }
            }

            if (obj.options.submitButton) {
                if (error) {
                    obj.options.submitButton.setAttribute('disabled', true);
                } else {
                    obj.options.submitButton.removeAttribute('disabled');
                }
            }
        }

        // Blank
        var test = '';
        if (! element.value) {
            test = addError(element);
        } else if (element.getAttribute('data-email') && ! emailChecker(element.value)) {
            test = addError(element);
        } else if (element.getAttribute('data-password') && ! emailChecker(element.value)) {
            test = addError(element);
        } else {
            if (element.classList.contains('error')) {
                delError(element);
            }
        }

        return test;
    }

    // Run form validation
    obj.validate = function() {
        var test = '';
        // Get elements in the form
        var elements = el.querySelectorAll("input, select, textarea");
        // Run all elements 
        for (var i = 0; i < elements.length; i++) {
            if (elements[i].getAttribute('data-validation')) {
                if (test) {
                    test += "<br>\r\n";
                }
                test += obj.validateElement(elements[i]);
            }
        }
        return test;
    }

    // Check the form
    obj.getError = function() {
        // Validation
        return obj.validation() ? true : false;
    }

    // Return the form hash
    obj.setHash = function() {
        return obj.getHash(obj.getElements());
    }

    // Get the form hash
    obj.getHash = function(str) {
        var hash = 0, i, chr;

        if (str.length === 0) {
            return hash;
        } else {
            for (i = 0; i < str.length; i++) {
              chr = str.charCodeAt(i);
              hash = ((hash << 5) - hash) + chr;
              hash |= 0;
            }
        }

        return hash;
    }

    // Is there any change in the form since start tracking?
    obj.isChanged = function() {
        var hash = obj.setHash();
        return (obj.options.currentHash != hash);
    }

    // Restart tracking
    obj.resetTracker = function() {
        obj.options.currentHash = obj.setHash();
        obj.options.ignore = false;
    }

    obj.reset = function() {
        obj.options.currentHash = obj.setHash();
        obj.options.ignore = false;
    }

    // Ignore flag
    obj.setIgnore = function(ignoreFlag) {
        obj.options.ignore = ignoreFlag ? true : false;
    }

    // Get form elements
    obj.getElements = function(asArray) {
        var data = {};
        var elements = el.querySelectorAll("input, select, textarea");

        for (var i = 0; i < elements.length; i++) {
            var element = elements[i];
            var name = element.name;
            var value = element.value;

            if (name) {
                data[name] = value;
            }
        }

        return asArray == true ? data : JSON.stringify(data);
    }

    // Start tracking in one second
    setTimeout(function() {
        obj.options.currentHash = obj.setHash();
    }, 1000);

    // Alert
    window.addEventListener("beforeunload", function (e) {
        if (obj.isChanged() && obj.options.ignore == false) {
            var confirmationMessage =  obj.options.message? obj.options.message : "\o/";

            if (confirmationMessage) {
                if (typeof e == 'undefined') {
                    e = window.event;
                }

                if (e) {
                    e.returnValue = confirmationMessage;
                }

                return confirmationMessage;
            } else {
                return void(0);
            }
        }
    });

    // Validations
    el.addEventListener("keyup", function(e) {
        if (e.target.getAttribute('data-validation')) {
            obj.validateElement(e.target);
        }
    });

    el.tracker = obj;

    return obj;
});



    return jSuites;

})));

/***/ }),

/***/ 72860:
/*!*********************************************!*\
  !*** ./node_modules/jexcel/dist/jexcel.css ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ 41892:
/*!***********************************************!*\
  !*** ./node_modules/jsuites/dist/jsuites.css ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9XZWJDb21wb25lbnRzLy4vbm9kZV9tb2R1bGVzL2pleGNlbC9kaXN0L2pleGNlbC5qcyIsIndlYnBhY2s6Ly9XZWJDb21wb25lbnRzLy4vbm9kZV9tb2R1bGVzL2pzdWl0ZXMvZGlzdC9qc3VpdGVzLmpzIiwid2VicGFjazovL1dlYkNvbXBvbmVudHMvLi9ub2RlX21vZHVsZXMvamV4Y2VsL2Rpc3QvamV4Y2VsLmNzcz82ZjE0Iiwid2VicGFjazovL1dlYkNvbXBvbmVudHMvLi9ub2RlX21vZHVsZXMvanN1aXRlcy9kaXN0L2pzdWl0ZXMuY3NzP2M2NDEiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLGtCQUFrQixVQUFlO0FBQ2pDLGtCQUFrQixtQkFBTyxDQUFDLG9CQUFTO0FBQ25DLElBQUksbUJBQU8sQ0FBQyxxQ0FBMEI7QUFDdEM7O0FBRUEsQ0FBQztBQUNELElBQUksS0FBNEQ7QUFDaEUsSUFBSSxDQUN5QjtBQUM3QixDQUFDOztBQUVEOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsUUFBUTtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3Q0FBd0MsRUFBRSxLQUFLLEVBQUU7QUFDakQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsaURBQWlELDJCQUEyQjtBQUM1RSxlQUFlLFFBQVE7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLFM7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSx1QkFBdUIsVUFBVTtBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsMENBQTBDO0FBQzFDLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQyxpQkFBaUI7QUFDNUQ7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLDJCQUEyQiwwQ0FBMEM7QUFDckU7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0Isc0NBQXNDO0FBQ3JFO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsdUJBQXVCLGdDQUFnQztBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLDZCQUE2QjtBQUN4RDtBQUNBLCtCQUErQixnQ0FBZ0M7QUFDL0Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsbUJBQW1CLFdBQVc7QUFDOUIsdUJBQXVCLFdBQVc7QUFDbEM7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBO0FBQ0EsbUJBQW1CLDZCQUE2QjtBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLGlCQUFpQjtBQUM1QztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSx1QkFBdUIsT0FBTztBQUM5QjtBQUNBLDJCQUEyQixPQUFPO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHVCQUF1QixPQUFPO0FBQzlCO0FBQ0EsMkJBQTJCLE9BQU87QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsd0JBQXdCO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLDZCQUE2QjtBQUNwRDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixxQkFBcUI7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxtQkFBbUIsZ0NBQWdDO0FBQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSx1QkFBdUIsOEJBQThCO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLHFCQUFxQjtBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBOztBQUVBLHVCQUF1QixvQkFBb0I7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCO0FBQ2hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2Qix5QkFBeUI7QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0EsaUNBQWlDLHVCQUF1QjtBQUN4RCxxQ0FBcUMsdUJBQXVCO0FBQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUMsdUJBQXVCO0FBQ3hELHFDQUFxQyx1QkFBdUI7QUFDNUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjs7QUFFakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixpQkFBaUI7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsMkJBQTJCLGFBQWE7QUFDeEMsK0JBQStCLGFBQWE7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixpQkFBaUI7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixpQkFBaUI7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLGlCQUFpQjtBQUM1QztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0VBQStFO0FBQy9FO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsbUNBQW1DLGlCQUFpQjtBQUNwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsaUJBQWlCO0FBQ3hDO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVDQUF1Qyw2QkFBNkI7QUFDcEU7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBLHdCQUF3QixTQUFTO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsU0FBUztBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsdURBQXVELHVCQUF1QjtBQUM5RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDs7QUFFQSwyQkFBMkIsNEJBQTRCO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxnQ0FBZ0MsU0FBUztBQUN6QztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGdDQUFnQyxTQUFTO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDRCQUE0QixTQUFTO0FBQ3JDLGdDQUFnQyxTQUFTO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsNEJBQTRCLFNBQVM7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSw0QkFBNEIsU0FBUztBQUNyQyxnQ0FBZ0MsU0FBUztBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0Msa0JBQWtCO0FBQ3REO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLG1DQUFtQyxtQkFBbUI7QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QiwwQkFBMEI7QUFDakQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTs7QUFFQSw0QkFBNEIsU0FBUztBQUNyQyxnQ0FBZ0MsU0FBUztBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsd0JBQXdCO0FBQ25EO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixxQkFBcUI7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsdUJBQXVCLHdCQUF3QjtBQUMvQztBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLDJCQUEyQixpQkFBaUI7QUFDNUM7QUFDQTtBQUNBOztBQUVBO0FBQ0EsK0JBQStCLGlCQUFpQjtBQUNoRDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLGlCQUFpQjtBQUM1QztBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDJCQUEyQixPQUFPO0FBQ2xDLCtCQUErQixPQUFPO0FBQ3RDO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsU0FBUztBQUNUOztBQUVBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQSx1QkFBdUIsaUJBQWlCO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsY0FBYztBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLDJCQUEyQixpQkFBaUI7QUFDNUM7QUFDQTtBQUNBLDBDQUEwQztBQUMxQztBQUNBLCtCQUErQixrQkFBa0I7QUFDakQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSx1QkFBdUIsaUJBQWlCO0FBQ3hDLHlEQUF5RDtBQUN6RDtBQUNBO0FBQ0EsdUJBQXVCLGlCQUFpQjtBQUN4Qyx5REFBeUQ7QUFDekQ7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLDJCQUEyQiw2QkFBNkI7QUFDeEQsK0JBQStCLGdDQUFnQztBQUMvRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQiw2QkFBNkI7QUFDNUQ7QUFDQTtBQUNBLGFBQWE7QUFDYiwrQkFBK0IsNkJBQTZCO0FBQzVEO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSwyQkFBMkIsaUJBQWlCO0FBQzVDO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLHdCQUF3QjtBQUMvQztBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsaUJBQWlCO0FBQ3hDO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHVCQUF1QixpQkFBaUI7QUFDeEM7QUFDQTtBQUNBOztBQUVBO0FBQ0EsdUJBQXVCLGlCQUFpQjtBQUN4QztBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxhQUFhO0FBQ2IsK0JBQStCLHFCQUFxQjtBQUNwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVk7QUFDWjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLG9DQUFvQyw4QkFBOEI7QUFDbEU7QUFDQTtBQUNBLGlDQUFpQyxrQ0FBa0M7QUFDbkU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpREFBaUQsNkJBQTZCO0FBQzlFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSw2Q0FBNkMsNkJBQTZCO0FBQzFFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7O0FBRXJCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQSwyQkFBMkIscUJBQXFCO0FBQ2hEO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTs7QUFFQSwyQkFBMkIscUJBQXFCO0FBQ2hEO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUEsdUJBQXVCLHFCQUFxQjtBQUM1QztBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsMkJBQTJCLGtCQUFrQjtBQUM3QztBQUNBLHFDQUFxQztBQUNyQztBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHVDQUF1QyxvQ0FBb0M7QUFDM0U7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDZCQUE2QiwrQkFBK0I7QUFDNUQ7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQSwyQ0FBMkMsb0NBQW9DO0FBQy9FO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQ0FBbUMsc0NBQXNDO0FBQ3pFO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvREFBb0QsbUNBQW1DO0FBQ3ZGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUEsZ0RBQWdELG1DQUFtQztBQUNuRjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLHFDQUFxQywrQkFBK0I7QUFDcEUsb0RBQW9ELG1DQUFtQztBQUN2RjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHFDQUFxQywrQkFBK0I7QUFDcEU7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQyxzQ0FBc0M7QUFDakY7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCOztBQUVyQjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIscUJBQXFCO0FBQzVDO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1Qix3QkFBd0I7QUFDL0M7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLHdCQUF3QjtBQUMvQzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSx1QkFBdUIscUJBQXFCO0FBQzVDO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLHVCQUF1Qix3QkFBd0I7QUFDL0MsMkJBQTJCLDJCQUEyQjtBQUN0RDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QjtBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLGlCQUFpQjtBQUM1QztBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxtQ0FBbUMsb0RBQW9EO0FBQ3ZGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2Q0FBNkMsUUFBUTtBQUNyRDtBQUNBLCtCQUErQix3QkFBd0I7QUFDdkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsZ0RBQWdELFNBQVM7QUFDekQ7QUFDQSwrQkFBK0IscUJBQXFCO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSwyQkFBMkIscUJBQXFCO0FBQ2hELCtCQUErQix3QkFBd0I7QUFDdkQ7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsNkJBQTZCO0FBQ3BEO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsNkJBQTZCO0FBQ3BEO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBOztBQUVBLCtCQUErQixnQ0FBZ0M7QUFDL0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsNkJBQTZCO0FBQ3BELDJCQUEyQixnQ0FBZ0M7QUFDM0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsaUJBQWlCO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixrQkFBa0I7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSwyQkFBMkIsd0JBQXdCO0FBQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxtQ0FBbUMsdUJBQXVCO0FBQzFEO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTs7QUFFQSxvQ0FBb0MsU0FBUztBQUM3Qyx3Q0FBd0MsU0FBUztBQUNqRDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLG1DQUFtQyxtQkFBbUI7QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QjtBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUM7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0RUFBNEU7QUFDNUUsNkJBQTZCO0FBQzdCO0FBQ0E7QUFDQSxpR0FBaUc7QUFDakcsaUNBQWlDO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEZBQThGO0FBQzlGLHFDQUFxQztBQUNyQztBQUNBLCtGQUErRjtBQUMvRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLHNEQUFzRCx3QkFBd0IsR0FBRyxpQkFBaUIsd0JBQXdCLEdBQUcsa0JBQWtCLGlCQUFpQixHQUFHOztBQUVuSztBQUNBLGlCQUFpQjtBQUNqQjtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDJCQUEyQixPQUFPO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCLFFBQVE7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDZDQUE2QyxPQUFPO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCLHFCQUFxQjtBQUNsRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxnREFBZ0QsT0FBTztBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQSw2QkFBNkIsd0JBQXdCO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDJCQUEyQixPQUFPO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCLFFBQVE7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLHFFO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsOEJBQThCLGNBQWM7QUFDNUM7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsUUFBUTtBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsU0FBUztBQUN4QztBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLGlCQUFpQjtBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDLGlCQUFpQjtBQUN4RDtBQUNBLDJDQUEyQyx3Q0FBd0M7QUFDbkY7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSx1QkFBdUIscUJBQXFCO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLHFFO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsOEJBQThCLGNBQWM7QUFDNUM7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EseUNBQXlDLGtCQUFrQjtBQUMzRDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLDRDQUE0QyxNQUFNO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxrREFBa0QsZ0JBQWdCLGNBQWMsRUFBRTs7QUFFbEY7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSx1QkFBdUIsT0FBTztBQUM5QjtBQUNBOztBQUVBLDJCQUEyQixPQUFPO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MsNEJBQTRCO0FBQzlEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MsMENBQTBDO0FBQzVFO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxxQ0FBcUMsa0NBQWtDO0FBQ3ZFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsK0JBQStCO0FBQzFELHlDQUF5QyxrQ0FBa0M7QUFDM0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHFDQUFxQyxnREFBZ0Q7QUFDckY7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsMkJBQTJCLCtCQUErQjtBQUMxRDtBQUNBO0FBQ0E7QUFDQSx5Q0FBeUMsZ0RBQWdEO0FBQ3pGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0Isc0NBQXNDO0FBQ3JFO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsK0JBQStCLCtCQUErQjtBQUM5RDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLCtCQUErQixrQ0FBa0M7QUFDakU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsK0JBQStCLGtDQUFrQztBQUNqRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLDJCQUEyQixtQkFBbUI7QUFDOUM7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQSwwQ0FBMEM7O0FBRTFDLDJCQUEyQixpQkFBaUI7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTs7QUFFQSxpREFBaUQ7QUFDakQ7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsMEJBQTBCO0FBQzFCO0FBQ0EseUNBQXlDLGdCQUFnQjtBQUN6RDtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxrREFBa0QscUJBQXFCLEtBQUssVUFBVSxFOztBQUV0RjtBQUNBLDRCQUE0QixnQkFBZ0IsVUFBVTs7QUFFdEQ7QUFDQSw0Q0FBNEMsT0FBTyxVQUFVOztBQUU3RDtBQUNBLHFEQUFxRCxPQUFPLFNBQVMsS0FBSyxVQUFVOztBQUVwRjtBQUNBLHVDQUF1QyxPQUFPLFNBQVMsVUFBVTtBQUNqRSx1Q0FBdUMsT0FBTyxTQUFTLFVBQVU7O0FBRWpFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsU0FBUztBQUNULHVCQUF1QixnQkFBZ0I7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQyxvQkFBb0I7QUFDMUQ7QUFDQSwwREFBMEQ7QUFDMUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQyxjQUFjOztBQUU5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7O0FBRXJCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCOztBQUVBO0FBQ0E7QUFDQSxvQ0FBb0MsY0FBYzs7QUFFbEQ7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5Qjs7QUFFekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0Esd0JBQXdCLGNBQWM7O0FBRXRDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxDQUFDOztBQUVEO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQztBQUNqQztBQUNBO0FBQ0EsaUNBQWlDO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsdUNBQXVDLG1DQUFtQztBQUMxRTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkNBQTJDLG1DQUFtQztBQUM5RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQztBQUNqQzs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QjtBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDO0FBQ2pDO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixtQ0FBbUM7QUFDbEU7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUNBQW1DLGdDQUFnQztBQUNuRTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQyxtQ0FBbUM7QUFDdEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCLDJDQUEyQyxtQ0FBbUM7QUFDOUU7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQTtBQUNBO0FBQ0EscUNBQXFDO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQztBQUNqQztBQUNBO0FBQ0EscUNBQXFDO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQztBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixtQkFBbUI7QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLHdCQUF3QjtBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxtQkFBbUIsNEJBQTRCO0FBQy9DO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsaUJBQWlCO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixpQkFBaUI7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsaUJBQWlCO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixpQkFBaUI7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0REFBNEQ7QUFDNUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLFlBQVk7QUFDdkMsK0JBQStCLFlBQVk7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQyxpREFBaUQ7QUFDdkY7QUFDQTtBQUNBLEtBQUs7QUFDTCxrRTtBQUNBLDhDQUE4QztBQUM5QztBQUNBLG9DQUFvQyxrREFBa0Q7QUFDdEY7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsaUJBQWlCO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTs7QUFFQSxLQUFLO0FBQ0w7OztBQUdBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxTQUFTO0FBQ1Q7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsdUJBQXVCLGtCQUFrQjtBQUN6QztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSx1QkFBdUIsbUJBQW1CO0FBQzFDO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDs7QUFFQTtBQUNBLENBQUM7O0FBRUQ7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsa0JBQWtCO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSx1QkFBdUIscUJBQXFCO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSx1QkFBdUIsd0JBQXdCO0FBQy9DO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixzQkFBc0I7QUFDekM7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsdUJBQXVCLHFCQUFxQjtBQUM1QywyQkFBMkIsd0JBQXdCO0FBQ25EO0FBQ0E7QUFDQSwrQkFBK0Isc0JBQXNCO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQ0FBbUMscUJBQXFCO0FBQ3hEO0FBQ0Esc0VBQXNFO0FBQ3RFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSx1QkFBdUIsd0JBQXdCO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QiwwQkFBMEI7QUFDakQ7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsMEJBQTBCO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsMEJBQTBCO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsMEJBQTBCO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLHlCQUF5QjtBQUM1QztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQSx5QkFBeUIsMEJBQTBCO0FBQ25EO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTs7QUFFQTtBQUNBLHVCQUF1QixLQUFLO0FBQzVCOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHVCQUF1QixrQkFBa0I7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDJCQUEyQixrQkFBa0I7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBOztBQUVBO0FBQ0EsMkJBQTJCLGtCQUFrQjtBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLHVCQUF1QixJQUFJO0FBQzNCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSx1QkFBdUIsS0FBSztBQUM1QjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsdUJBQXVCLElBQUk7QUFDM0I7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsS0FBSztBQUNoQztBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixLQUFLO0FBQ2hDO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLEtBQUs7QUFDaEM7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSx1QkFBdUIsc0JBQXNCO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLHVCQUF1QixpQkFBaUI7QUFDeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EscUJBQXFCLEtBQUs7QUFDMUI7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUIsS0FBSztBQUMxQjtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQixLQUFLO0FBQzFCO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLDJCQUEyQixVQUFVO0FBQ3JDO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixVQUFVO0FBQ3JDO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsY0FBYztBQUNyQztBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsYUFBYTtBQUNwQztBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLHVCQUF1QixPQUFPO0FBQzlCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLG1CQUFtQjtBQUM5QztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixtQkFBbUI7QUFDOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLG1CQUFtQjtBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsT0FBTztBQUM5QjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsdUJBQXVCLGlCQUFpQjtBQUN4QztBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixtQkFBbUI7QUFDOUM7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsbUJBQW1CO0FBQzlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsbUJBQW1CO0FBQzFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSx1QkFBdUIsbUJBQW1CO0FBQzFDO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSx1QkFBdUIsS0FBSztBQUM1Qjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixpQkFBaUI7QUFDeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLGlCQUFpQjtBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixpQkFBaUI7QUFDeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxtQ0FBbUMscUJBQXFCO0FBQ3hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxDQUFDOztBQUVEO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLHdCQUF3QixJQUFJLGNBQWMsSUFBSSxjQUFjLElBQUk7QUFDaEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDO0FBQ3hDO0FBQ0E7QUFDQSw2REFBNkQsaUJBQWlCO0FBQzlFO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0Esa0RBQWtEO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsaUJBQWlCO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixpQkFBaUI7QUFDeEM7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1Qix5QkFBeUI7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIscUJBQXFCO0FBQzVDO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLGtCQUFrQjtBQUN6QyxpRUFBaUU7QUFDakU7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSx1QkFBdUIsc0JBQXNCO0FBQzdDO0FBQ0E7QUFDQSwyQkFBMkIsaUJBQWlCO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0M7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixZQUFZO0FBQ25DO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLG9CQUFvQjtBQUMzQztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsb0JBQW9CO0FBQzNDO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixvQkFBb0I7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsdUJBQXVCLHNCQUFzQjtBQUM3QztBQUNBOztBQUVBO0FBQ0EsMkJBQTJCLG1CQUFtQjtBQUM5QztBQUNBLGlDQUFpQyxPQUFPO0FBQ3hDOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixpQkFBaUI7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7O0FBRUE7O0FBRUE7QUFDQSxDQUFDOztBQUVEO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLE9BQU87QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLE9BQU87QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLGtCQUFrQjtBQUN6Qyw0Q0FBNEM7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsdUJBQXVCLGtCQUFrQjtBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsa0JBQWtCO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixrQkFBa0I7QUFDekM7QUFDQSxnREFBZ0Q7QUFDaEQ7QUFDQTtBQUNBLGFBQWE7QUFDYiw0REFBNEQ7QUFDNUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixvQkFBb0I7QUFDM0M7QUFDQTtBQUNBLG1CQUFtQixpQkFBaUI7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixrQkFBa0I7QUFDN0M7QUFDQSx5RUFBeUU7QUFDekUsaUJBQWlCO0FBQ2pCLHFGQUFxRjtBQUNyRjtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixvQkFBb0I7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixRQUFRO0FBQy9CO0FBQ0EsMkJBQTJCLE9BQU87QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLHVCQUF1QixPQUFPO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLHVCQUF1QixPQUFPO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSx1QkFBdUIsWUFBWTtBQUNuQztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLDRDQUE0QztBQUM1QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLE9BQU87QUFDOUI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixPQUFPO0FBQzlCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixPQUFPO0FBQzlCO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsT0FBTztBQUM5QjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxhQUFhO0FBQ2I7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLENBQUM7O0FBRUQsZUFBZSx3Q0FBd0M7QUFDdkQ7QUFDQSxtQkFBbUIsaUNBQWlDO0FBQ3BEO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUtBOztBQUVBLENBQUMsSTs7Ozs7Ozs7Ozs7QUMxMlpEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNELElBQUksS0FBNEQ7QUFDaEUsSUFBSSxDQUMwQjtBQUM5QixDQUFDOztBQUVEOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBOztBQUVBO0FBQ0E7QUFDQSx1QkFBdUIsb0JBQW9CO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsdUJBQXVCLFFBQVE7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7O0FBRUEsdUJBQXVCLHFCQUFxQjtBQUM1QztBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLDJCQUEyQixrQkFBa0I7QUFDN0M7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSwrQkFBK0IsaUJBQWlCO0FBQ2hEO0FBQ0E7QUFDQSx1Q0FBdUMsY0FBYztBQUNyRDtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCO0FBQ0EsK0NBQStDLGlCQUFpQjtBQUNoRTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixrQkFBa0I7QUFDakQ7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOENBQThDLHFCQUFxQjtBQUNuRTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxDQUFDOztBQUVEOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxpQztBQUNBOztBQUVBLG1CQUFtQixRQUFRO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsaUM7QUFDQTs7QUFFQSxtQkFBbUIsUUFBUTtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQiwrRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDs7QUFFQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHVCQUF1QixPQUFPO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsdUJBQXVCLE9BQU87QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLE9BQU87QUFDbEM7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTs7QUFFQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQSxtQkFBbUIsUUFBUTtBQUMzQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUEsK0I7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxtQkFBbUIsUUFBUTtBQUMzQjtBQUNBOztBQUVBO0FBQ0E7O0FBRUEsbUJBQW1CLFFBQVE7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7QUFDTDs7QUFFQTtBQUNBO0FBQ0EsU0FBUztBQUNUOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixFQUFFO0FBQzdCLHlCQUF5QixFQUFFO0FBQzNCLHdCQUF3QixFQUFFO0FBQzFCLHlCQUF5QixFQUFFO0FBQzNCLDBCQUEwQixFQUFFO0FBQzVCLHlCQUF5QixFQUFFO0FBQzNCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsOEJBQThCLEVBQUU7QUFDaEM7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEtBQUsseUJBQXlCO0FBQzlCO0FBQ0EsS0FBSywwQkFBMEI7QUFDL0I7QUFDQSxLQUFLLDBCQUEwQjtBQUMvQjtBQUNBLEtBQUssNEJBQTRCO0FBQ2pDO0FBQ0EsS0FBSyxPQUFPO0FBQ1o7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxtQkFBbUIscUJBQXFCO0FBQ3hDO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxpQkFBaUIsT0FBTztBQUN4QixrQkFBa0IsZUFBZTtBQUNqQyxrQkFBa0IsT0FBTztBQUN6QixrQkFBa0IsZ0JBQWdCO0FBQ2xDLGtCQUFrQixnQkFBZ0I7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBLG1CQUFtQixnQkFBZ0I7QUFDbkMsdUJBQXVCLGtCQUFrQjtBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLG1CQUFtQixtQkFBbUI7QUFDdEM7QUFDQSx1QkFBdUIsc0JBQXNCO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxDQUFDOzs7QUFHRDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGVBQWUsT0FBTztBQUN0QjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHVCQUF1QixrQkFBa0I7QUFDekM7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxLQUFLOztBQUVMO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUOztBQUVBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDOztBQUVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsS0FBSztBQUNMO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEtBQUs7QUFDTDtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsaUJBQWlCO0FBQzVDO0FBQ0E7QUFDQTtBQUNBLHFEQUFxRDtBQUNyRDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLCtCQUErQix1QkFBdUI7QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQyxrQ0FBa0M7QUFDckU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsK0JBQStCLGtCQUFrQjtBQUNqRDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsMkJBQTJCLHNCQUFzQjtBQUNqRDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLHlCQUF5QjtBQUNoRDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsU0FBUztBQUNULGlDQUFpQztBQUNqQztBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLHlCQUF5QjtBQUNoRDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsU0FBUztBQUNULGlDQUFpQztBQUNqQztBQUNBOztBQUVBO0FBQ0E7QUFDQSx1QkFBdUIseUJBQXlCO0FBQ2hEO0FBQ0EsUzs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixzQkFBc0I7QUFDckQsbUNBQW1DLGtCQUFrQjtBQUNyRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLCtCQUErQixzQkFBc0I7QUFDckQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsdUJBQXVCLHNCQUFzQjtBQUM3QztBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLDJCQUEyQixrQkFBa0I7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EseUJBQXlCLHVCQUF1QjtBQUNoRDtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIseUJBQXlCO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsc0JBQXNCO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBDQUEwQyxRQUFRO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSwwQ0FBMEMsc0JBQXNCO0FBQ2hFO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSwwQ0FBMEMsc0JBQXNCO0FBQ2hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLDBDQUEwQyxRQUFRO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLENBQUM7O0FBRUQ7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsK0JBQStCLGtCQUFrQjtBQUNqRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1Qix3QkFBd0I7QUFDL0M7QUFDQSwrQkFBK0Isb0NBQW9DO0FBQ25FO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLFlBQVk7QUFDWjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxxRDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsMkJBQTJCLGdCQUFnQjtBQUMzQztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBDO0FBQ0E7QUFDQTtBQUNBLDJDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQztBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7O0FBRUE7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsbUJBQW1CO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQiw2QkFBNkI7QUFDNUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLDRDQUE0QztBQUM1QztBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGlCQUFpQjtBQUNqQjs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQSx1QkFBdUIsa0JBQWtCO0FBQ3pDO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0EscUJBQXFCOztBQUVyQjtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsbUNBQW1DLGtCQUFrQjtBQUNyRDtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLFNBQVMsTztBQUNUO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsd0Q7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSwwRDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixpQkFBaUI7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsK0JBQStCLGlCQUFpQjtBQUNoRDtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSx1QkFBdUIsZ0NBQWdDO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsdUVBQXVFO0FBQ3ZFOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQSwrQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsdUJBQXVCLGtCQUFrQjtBQUN6QztBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGFBQWE7O0FBRWI7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsNENBQTRDO0FBQzVDO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLHVCQUF1QjtBQUM5QztBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQSwyQjtBQUNBOzs7QUFHQTtBQUNBOztBQUVBO0FBQ0EsMkJBQTJCLGlDQUFpQztBQUM1RDtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLCtCQUErQixnQkFBZ0I7QUFDL0M7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxLQUFLOztBQUVMOztBQUVBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEs7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5Q0FBeUMsc0NBQXNDO0FBQy9FLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0EscUJBQXFCLEdBQUcsOEJBQThCO0FBQ3RELGlCQUFpQjtBQUNqQixpQ0FBaUMsc0NBQXNDO0FBQ3ZFO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5Q0FBeUMsU0FBUztBQUNsRDtBQUNBO0FBQ0Esb0JBQW9CO0FBQ3BCOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0VBQWtFLElBQUk7QUFDdEU7QUFDQSx1RDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxxRUFBcUU7QUFDckU7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQSx1REFBdUQsbUNBQW1DLEVBQUU7QUFDNUYsNkJBQTZCO0FBQzdCO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSx1QkFBdUIsU0FBUztBQUNoQztBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSx1QkFBdUIsWUFBWTtBQUNuQztBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUEsbUJBQW1CLGdCQUFnQjtBQUNuQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLHVCQUF1QixRQUFRO0FBQy9CO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLG1CQUFtQixjQUFjO0FBQ2pDO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IseUJBQXlCO0FBQ3hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUNBQW1DLHlCQUF5QjtBQUM1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRGO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUNBQW1DLHlCQUF5QjtBQUM1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrRUFBa0UsU0FBUztBQUMzRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQSxxQkFBcUI7QUFDckI7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFNBQVM7QUFDVDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLGlCQUFpQjtBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQjtBQUNwQixvQkFBb0I7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7O0FBRUE7QUFDQSxDQUFDOztBQUVEO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsbUJBQW1CO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxpQ0FBaUMsU0FBUzs7QUFFMUM7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjs7QUFFakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0MsNEJBQTRCO0FBQ2xFOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxnRTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLG9DO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxDQUFDOztBQUVEO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQyxtQkFBbUI7QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSx1QkFBdUIscUJBQXFCO0FBQzVDO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQSxtQkFBbUIsMEJBQTBCO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSx1QkFBdUIsd0JBQXdCO0FBQy9DO0FBQ0E7O0FBRUEsMkJBQTJCLDJCQUEyQjtBQUN0RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3RDtBQUNBO0FBQ0E7QUFDQSxvRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxDQUFDOztBQUVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxtQkFBbUIsd0JBQXdCO0FBQzNDO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBLG1CQUFtQiwwQkFBMEI7QUFDN0M7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTs7O0FBR0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSw2QztBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDZDO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUOztBQUVBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxtQkFBbUIsd0JBQXdCO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLHVCQUF1Qix3QkFBd0I7QUFDL0M7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSx1QkFBdUIsd0JBQXdCO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBLHVCQUF1Qix3QkFBd0I7QUFDL0M7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0EsdUJBQXVCLHdCQUF3QjtBQUMvQztBQUNBO0FBQ0EsS0FBSzs7QUFFTDs7QUFFQTtBQUNBLENBQUM7OztBQUdEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQix3QkFBd0I7QUFDbkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsOEJBQThCO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHVCQUF1QiwrQkFBK0I7QUFDdEQ7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLHVCQUF1QiwrQkFBK0I7QUFDdEQ7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsdUJBQXVCLGtCQUFrQjtBQUN6QztBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsdUJBQXVCLDZCQUE2QjtBQUNwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSwyQkFBMkIsdUJBQXVCO0FBQ2xEOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCOztBQUVyQjtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOzs7QUFHTDs7QUFFQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEtBQUs7O0FBRUwsbUJBQW1CLHdCQUF3QjtBQUMzQztBQUNBOztBQUVBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSx1QkFBdUIsNkJBQTZCO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLHVCQUF1Qiw2QkFBNkI7QUFDcEQ7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxpQkFBaUIsT0FBTztBQUN4QixrQkFBa0IsZUFBZTtBQUNqQyxrQkFBa0IsT0FBTztBQUN6QixrQkFBa0IsT0FBTztBQUN6QixrQkFBa0IsT0FBTztBQUN6QixrQkFBa0IsV0FBVztBQUM3QixrQkFBa0IsZ0JBQWdCO0FBQ2xDLGtCQUFrQixnQkFBZ0I7QUFDbEMsa0JBQWtCLGdCQUFnQjtBQUNsQyxrQkFBa0IsZ0JBQWdCO0FBQ2xDLGtCQUFrQixnQkFBZ0I7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxlQUFlLGdCQUFnQjtBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLCtCQUErQixtQkFBbUI7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxnQkFBZ0IsTUFBTTtBQUN0QjtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsd0JBQXdCO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQix1QkFBdUI7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGVBQWUsUUFBUTtBQUN2QixnQkFBZ0IsT0FBTztBQUN2QjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSwyQkFBMkIsd0JBQXdCO0FBQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSx1RUFBdUU7QUFDdkUsZUFBZSxPQUFPO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsZ0JBQWdCO0FBQ2hCO0FBQ0E7QUFDQTtBQUNBLHVCQUF1Qix3QkFBd0I7QUFDL0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxlQUFlLE9BQU87QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxlQUFlLE9BQU87QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsdUNBQXVDLFNBQVM7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1Qix3QkFBd0I7QUFDL0M7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGVBQWUsT0FBTztBQUN0QixnQkFBZ0IsTUFBTTtBQUN0QjtBQUNBO0FBQ0EsbUJBQW1CLE1BQU07QUFDekI7O0FBRUEsbUJBQW1CLE9BQU87QUFDMUI7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLDJCQUEyQixpQkFBaUI7QUFDNUMsbURBQW1EO0FBQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBLGVBQWUsT0FBTztBQUN0Qjs7QUFFQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjs7QUFFQSx1QkFBdUIsNEJBQTRCO0FBQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSwrQkFBK0IscUJBQXFCO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsU0FBUztBQUNUOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLDJCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBOztBQUVBO0FBQ0E7QUFDQSxrRUFBa0UsSUFBSTtBQUN0RSxxRDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixxQkFBcUI7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLFNBQVM7QUFDVDtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixxQkFBcUI7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsdUJBQXVCLGdCQUFnQjtBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLHVCQUF1QixxQkFBcUI7QUFDNUM7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDs7QUFFQTtBQUNBLENBQUM7Ozs7QUFJRDs7QUFFQSxDQUFDLEk7Ozs7Ozs7Ozs7OztBQ3J3UUQ7Ozs7Ozs7Ozs7Ozs7QUNBQSIsImZpbGUiOiJ2ZW5kb3JzLW5vZGVfbW9kdWxlc19qZXhjZWxfZGlzdF9qZXhjZWxfanMtbm9kZV9tb2R1bGVzX2pleGNlbF9kaXN0X2pleGNlbF9jc3MuYnVuZGxlLmpzP3Y9ZTkxNTQxZTM5ZGZjNjMyMjZkYWUiLCJzb3VyY2VzQ29udGVudCI6WyJcclxuLyoqXHJcbiAqIGpFeGNlbCB2My45LjFcclxuICpcclxuICogQXV0aG9yOiBQYXVsIEhvZGVsIDxwYXVsLmhvZGVsQGdtYWlsLmNvbT5cclxuICogV2Vic2l0ZTogaHR0cHM6Ly9ib3NzYW5vdmEudWsvamV4Y2VsL1xyXG4gKiBEZXNjcmlwdGlvbjogQ3JlYXRlIGFtYXppbmcgd2ViIGJhc2VkIHNwcmVhZHNoZWV0cy5cclxuICpcclxuICogVGhpcyBzb2Z0d2FyZSBpcyBkaXN0cmlidXRlIHVuZGVyIE1JVCBMaWNlbnNlXHJcbiAqL1xyXG5cclxuIGlmICghIGpTdWl0ZXMgJiYgdHlwZW9mKHJlcXVpcmUpID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICB2YXIgalN1aXRlcyA9IHJlcXVpcmUoJ2pzdWl0ZXMnKTtcclxuICAgIHJlcXVpcmUoJ2pzdWl0ZXMvZGlzdC9qc3VpdGVzLmNzcycpO1xyXG59XHJcblxyXG47KGZ1bmN0aW9uIChnbG9iYWwsIGZhY3RvcnkpIHtcclxuICAgIHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyA/IG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpIDpcclxuICAgIHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCA/IGRlZmluZShmYWN0b3J5KSA6XHJcbiAgICBnbG9iYWwuamV4Y2VsID0gZmFjdG9yeSgpO1xyXG59KHRoaXMsIChmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuLy8gSmV4Y2VsIGNvcmUgb2JqZWN0XG5cbnZhciBqZXhjZWwgPSAoZnVuY3Rpb24oZWwsIG9wdGlvbnMpIHtcbiAgICAvLyBDcmVhdGUgamV4Y2VsIG9iamVjdFxuICAgIHZhciBvYmogPSB7fTtcbiAgICBvYmoub3B0aW9ucyA9IHt9O1xuXG4gICAgaWYgKCEgKGVsIGluc3RhbmNlb2YgRWxlbWVudCB8fCBlbCBpbnN0YW5jZW9mIEhUTUxEb2N1bWVudCkpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdKRVhDRUw6IGVsIGlzIG5vdCBhIHZhbGlkIERPTSBlbGVtZW50Jyk7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cbiAgICAvLyBMb2FkaW5nIGRlZmF1bHQgY29uZmlndXJhdGlvblxuICAgIHZhciBkZWZhdWx0cyA9IHtcbiAgICAgICAgLy8gRXh0ZXJuYWwgZGF0YVxuICAgICAgICB1cmw6bnVsbCxcbiAgICAgICAgLy8gRGF0YVxuICAgICAgICBkYXRhOm51bGwsXG4gICAgICAgIC8vIENvcHkgYmVoYXZpb3JcbiAgICAgICAgY29weUNvbXBhdGliaWxpdHk6ZmFsc2UsXG4gICAgICAgIC8vIFJvd3MgYW5kIGNvbHVtbnMgZGVmaW5pdGlvbnNcbiAgICAgICAgcm93czpbXSxcbiAgICAgICAgY29sdW1uczpbXSxcbiAgICAgICAgLy8gRGVwcmVjdGVkIGxlZ2FjeSBvcHRpb25zXG4gICAgICAgIGNvbEhlYWRlcnM6W10sXG4gICAgICAgIGNvbFdpZHRoczpbXSxcbiAgICAgICAgY29sQWxpZ25tZW50czpbXSxcbiAgICAgICAgbmVzdGVkSGVhZGVyczpudWxsLFxuICAgICAgICAvLyBDb2x1bW4gd2lkdGggdGhhdCBpcyB1c2VkIGJ5IGRlZmF1bHRcbiAgICAgICAgZGVmYXVsdENvbFdpZHRoOjUwLFxuICAgICAgICBkZWZhdWx0Q29sQWxpZ246J2NlbnRlcicsXG4gICAgICAgIC8vIFNwYXJlIHJvd3MgYW5kIGNvbHVtbnNcbiAgICAgICAgbWluU3BhcmVSb3dzOjAsXG4gICAgICAgIG1pblNwYXJlQ29sczowLFxuICAgICAgICAvLyBNaW5pbWFsIHRhYmxlIGRpbWVuc2lvbnNcbiAgICAgICAgbWluRGltZW5zaW9uczpbMCwwXSxcbiAgICAgICAgLy8gQWxsb3cgRXhwb3J0XG4gICAgICAgIGFsbG93RXhwb3J0OnRydWUsXHJcbiAgICAgICAgLy8gQHR5cGUge2Jvb2xlYW59IC0gSW5jbHVkZSB0aGUgaGVhZGVyIHRpdGxlcyBvbiBkb3dubG9hZFxuICAgICAgICBpbmNsdWRlSGVhZGVyc09uRG93bmxvYWQ6ZmFsc2UsXG4gICAgICAgIC8vIEFsbG93IGNvbHVtbiBzb3J0aW5nXG4gICAgICAgIGNvbHVtblNvcnRpbmc6dHJ1ZSxcbiAgICAgICAgLy8gQWxsb3cgY29sdW1uIGRyYWdnaW5nXG4gICAgICAgIGNvbHVtbkRyYWc6ZmFsc2UsXG4gICAgICAgIC8vIEFsbG93IGNvbHVtbiByZXNpemluZ1xuICAgICAgICBjb2x1bW5SZXNpemU6dHJ1ZSxcbiAgICAgICAgLy8gQWxsb3cgcm93IHJlc2l6aW5nXG4gICAgICAgIHJvd1Jlc2l6ZTpmYWxzZSxcbiAgICAgICAgLy8gQWxsb3cgcm93IGRyYWdnaW5nXG4gICAgICAgIHJvd0RyYWc6dHJ1ZSxcbiAgICAgICAgLy8gQWxsb3cgdGFibGUgZWRpdGlvblxuICAgICAgICBlZGl0YWJsZTp0cnVlLFxuICAgICAgICAvLyBBbGxvdyBuZXcgcm93c1xuICAgICAgICBhbGxvd0luc2VydFJvdzp0cnVlLFxuICAgICAgICAvLyBBbGxvdyBuZXcgcm93c1xuICAgICAgICBhbGxvd01hbnVhbEluc2VydFJvdzp0cnVlLFxuICAgICAgICAvLyBBbGxvdyBuZXcgY29sdW1uc1xuICAgICAgICBhbGxvd0luc2VydENvbHVtbjp0cnVlLFxuICAgICAgICAvLyBBbGxvdyBuZXcgcm93c1xuICAgICAgICBhbGxvd01hbnVhbEluc2VydENvbHVtbjp0cnVlLFxuICAgICAgICAvLyBBbGxvdyByb3cgZGVsZXRlXG4gICAgICAgIGFsbG93RGVsZXRlUm93OnRydWUsXG4gICAgICAgIC8vIEFsbG93IGRlbGV0aW5nIG9mIGFsbCByb3dzXG4gICAgICAgIGFsbG93RGVsZXRpbmdBbGxSb3dzOmZhbHNlLFxuICAgICAgICAvLyBBbGxvdyBjb2x1bW4gZGVsZXRlXG4gICAgICAgIGFsbG93RGVsZXRlQ29sdW1uOnRydWUsXG4gICAgICAgIC8vIEFsbG93IHJlbmFtZSBjb2x1bW5cbiAgICAgICAgYWxsb3dSZW5hbWVDb2x1bW46dHJ1ZSxcbiAgICAgICAgLy8gQWxsb3cgY29tbWVudHNcbiAgICAgICAgYWxsb3dDb21tZW50czpmYWxzZSxcbiAgICAgICAgLy8gR2xvYmFsIHdyYXBcbiAgICAgICAgd29yZFdyYXA6ZmFsc2UsXG4gICAgICAgIC8vIEltYWdlIG9wdGlvbnNcbiAgICAgICAgaW1hZ2VPcHRpb25zOiBudWxsLFxuICAgICAgICAvLyBDU1Ygc291cmNlXG4gICAgICAgIGNzdjpudWxsLFxuICAgICAgICAvLyBGaWxlbmFtZVxuICAgICAgICBjc3ZGaWxlTmFtZTonamV4Y2VsJyxcbiAgICAgICAgLy8gQ29uc2lkZXIgZmlyc3QgbGluZSBhcyBoZWFkZXJcbiAgICAgICAgY3N2SGVhZGVyczp0cnVlLFxuICAgICAgICAvLyBEZWxpbWl0ZXJzXG4gICAgICAgIGNzdkRlbGltaXRlcjonLCcsXG4gICAgICAgIC8vIERpc2FibGUgY29ybmVyIHNlbGVjdGlvblxuICAgICAgICBzZWxlY3Rpb25Db3B5OnRydWUsXG4gICAgICAgIC8vIE1lcmdlZCBjZWxsc1xuICAgICAgICBtZXJnZUNlbGxzOnt9LFxuICAgICAgICAvLyBDcmVhdGUgdG9vbGJhclxuICAgICAgICB0b29sYmFyOm51bGwsXG4gICAgICAgIC8vIEFsbG93IHNlYXJjaFxuICAgICAgICBzZWFyY2g6ZmFsc2UsXG4gICAgICAgIC8vIENyZWF0ZSBwYWdpbmF0aW9uXG4gICAgICAgIHBhZ2luYXRpb246ZmFsc2UsXG4gICAgICAgIHBhZ2luYXRpb25PcHRpb25zOm51bGwsXG4gICAgICAgIC8vIEZ1bGwgc2NyZWVuXG4gICAgICAgIGZ1bGxzY3JlZW46ZmFsc2UsXG4gICAgICAgIC8vIExhenkgbG9hZGluZ1xuICAgICAgICBsYXp5TG9hZGluZzpmYWxzZSxcbiAgICAgICAgbG9hZGluZ1NwaW46ZmFsc2UsXG4gICAgICAgIC8vIFRhYmxlIG92ZXJmbG93XG4gICAgICAgIHRhYmxlT3ZlcmZsb3c6ZmFsc2UsXG4gICAgICAgIHRhYmxlSGVpZ2h0OiczMDBweCcsXG4gICAgICAgIHRhYmxlV2lkdGg6bnVsbCxcbiAgICAgICAgLy8gTWV0YVxuICAgICAgICBtZXRhOiBudWxsLFxuICAgICAgICAvLyBTdHlsZVxuICAgICAgICBzdHlsZTpudWxsLFxuICAgICAgICAvLyBFeGVjdXRlIGZvcm11bGFzXG4gICAgICAgIHBhcnNlRm9ybXVsYXM6dHJ1ZSxcbiAgICAgICAgYXV0b0luY3JlbWVudDp0cnVlLFxuICAgICAgICBhdXRvQ2FzdGluZzp0cnVlLFxuICAgICAgICAvLyBFdmVudCBoYW5kbGVzXG4gICAgICAgIG9udW5kbzpudWxsLFxuICAgICAgICBvbnJlZG86bnVsbCxcbiAgICAgICAgb25sb2FkOm51bGwsXG4gICAgICAgIG9uY2hhbmdlOm51bGwsXG4gICAgICAgIG9uYmVmb3JlY2hhbmdlOm51bGwsXG4gICAgICAgIG9uYWZ0ZXJjaGFuZ2VzOm51bGwsXG4gICAgICAgIG9uYmVmb3JlaW5zZXJ0cm93OiBudWxsLFxuICAgICAgICBvbmluc2VydHJvdzpudWxsLFxuICAgICAgICBvbmJlZm9yZWluc2VydGNvbHVtbjogbnVsbCxcbiAgICAgICAgb25pbnNlcnRjb2x1bW46bnVsbCxcbiAgICAgICAgb25iZWZvcmVkZWxldGVyb3c6bnVsbCxcbiAgICAgICAgb25kZWxldGVyb3c6bnVsbCxcbiAgICAgICAgb25iZWZvcmVkZWxldGVjb2x1bW46bnVsbCxcbiAgICAgICAgb25kZWxldGVjb2x1bW46bnVsbCxcbiAgICAgICAgb25tb3Zlcm93Om51bGwsXG4gICAgICAgIG9ubW92ZWNvbHVtbjpudWxsLFxuICAgICAgICBvbnJlc2l6ZXJvdzpudWxsLFxuICAgICAgICBvbnJlc2l6ZWNvbHVtbjpudWxsLFxuICAgICAgICBvbnNvcnQ6bnVsbCxcbiAgICAgICAgb25zZWxlY3Rpb246bnVsbCxcbiAgICAgICAgb25wYXN0ZTpudWxsLFxuICAgICAgICBvbmJlZm9yZXBhc3RlOm51bGwsXG4gICAgICAgIG9ubWVyZ2U6bnVsbCxcbiAgICAgICAgb25mb2N1czpudWxsLFxuICAgICAgICBvbmJsdXI6bnVsbCxcbiAgICAgICAgb25jaGFuZ2VoZWFkZXI6bnVsbCxcbiAgICAgICAgb25lZGl0aW9uc3RhcnQ6bnVsbCxcbiAgICAgICAgb25lZGl0aW9uZW5kOm51bGwsXG4gICAgICAgIG9uY2hhbmdlc3R5bGU6bnVsbCxcbiAgICAgICAgb25jaGFuZ2VtZXRhOm51bGwsXG4gICAgICAgIG9uY2hhbmdlcGFnZTpudWxsLFxuICAgICAgICAvLyBDdXN0b21pemUgYW55IGNlbGwgYmVoYXZpb3JcbiAgICAgICAgdXBkYXRlVGFibGU6bnVsbCxcbiAgICAgICAgLy8gRGV0YWNoIHRoZSBIVE1MIHRhYmxlIHdoZW4gY2FsbGluZyB1cGRhdGVUYWJsZVxyXG4gICAgICAgIGRldGFjaEZvclVwZGF0ZXM6IGZhbHNlLFxuICAgICAgICAvLyBUZXh0c1xuICAgICAgICB0ZXh0OntcbiAgICAgICAgICAgIG5vUmVjb3Jkc0ZvdW5kOiAnTm8gcmVjb3JkcyBmb3VuZCcsXG4gICAgICAgICAgICBzaG93aW5nUGFnZTogJ1Nob3dpbmcgcGFnZSB7MH0gb2YgezF9IGVudHJpZXMnLFxuICAgICAgICAgICAgc2hvdzogJ1Nob3cgJyxcbiAgICAgICAgICAgIHNlYXJjaDogJ1NlYXJjaCcsXG4gICAgICAgICAgICBlbnRyaWVzOiAnIGVudHJpZXMnLFxuICAgICAgICAgICAgY29sdW1uTmFtZTogJ0NvbHVtbiBuYW1lJyxcbiAgICAgICAgICAgIGluc2VydEFOZXdDb2x1bW5CZWZvcmU6ICdJbnNlcnQgYSBuZXcgY29sdW1uIGJlZm9yZScsXG4gICAgICAgICAgICBpbnNlcnRBTmV3Q29sdW1uQWZ0ZXI6ICdJbnNlcnQgYSBuZXcgY29sdW1uIGFmdGVyJyxcbiAgICAgICAgICAgIGRlbGV0ZVNlbGVjdGVkQ29sdW1uczogJ0RlbGV0ZSBzZWxlY3RlZCBjb2x1bW5zJyxcbiAgICAgICAgICAgIHJlbmFtZVRoaXNDb2x1bW46ICdSZW5hbWUgdGhpcyBjb2x1bW4nLFxuICAgICAgICAgICAgb3JkZXJBc2NlbmRpbmc6ICdPcmRlciBhc2NlbmRpbmcnLFxuICAgICAgICAgICAgb3JkZXJEZXNjZW5kaW5nOiAnT3JkZXIgZGVzY2VuZGluZycsXG4gICAgICAgICAgICBpbnNlcnRBTmV3Um93QmVmb3JlOiAnSW5zZXJ0IGEgbmV3IHJvdyBiZWZvcmUnLFxuICAgICAgICAgICAgaW5zZXJ0QU5ld1Jvd0FmdGVyOiAnSW5zZXJ0IGEgbmV3IHJvdyBhZnRlcicsXG4gICAgICAgICAgICBkZWxldGVTZWxlY3RlZFJvd3M6ICdEZWxldGUgc2VsZWN0ZWQgcm93cycsXG4gICAgICAgICAgICBlZGl0Q29tbWVudHM6ICdFZGl0IGNvbW1lbnRzJyxcbiAgICAgICAgICAgIGFkZENvbW1lbnRzOiAnQWRkIGNvbW1lbnRzJyxcbiAgICAgICAgICAgIGNvbW1lbnRzOiAnQ29tbWVudHMnLFxuICAgICAgICAgICAgY2xlYXJDb21tZW50czogJ0NsZWFyIGNvbW1lbnRzJyxcbiAgICAgICAgICAgIGNvcHk6ICdDb3B5Li4uJyxcbiAgICAgICAgICAgIHBhc3RlOiAnUGFzdGUuLi4nLFxuICAgICAgICAgICAgc2F2ZUFzOiAnU2F2ZSBhcy4uLicsXG4gICAgICAgICAgICBhYm91dDogJ0Fib3V0JyxcbiAgICAgICAgICAgIGFyZVlvdVN1cmVUb0RlbGV0ZVRoZVNlbGVjdGVkUm93czogJ0FyZSB5b3Ugc3VyZSB0byBkZWxldGUgdGhlIHNlbGVjdGVkIHJvd3M/JyxcbiAgICAgICAgICAgIGFyZVlvdVN1cmVUb0RlbGV0ZVRoZVNlbGVjdGVkQ29sdW1uczogJ0FyZSB5b3Ugc3VyZSB0byBkZWxldGUgdGhlIHNlbGVjdGVkIGNvbHVtbnM/JyxcbiAgICAgICAgICAgIHRoaXNBY3Rpb25XaWxsRGVzdHJveUFueUV4aXN0aW5nTWVyZ2VkQ2VsbHNBcmVZb3VTdXJlOiAnVGhpcyBhY3Rpb24gd2lsbCBkZXN0cm95IGFueSBleGlzdGluZyBtZXJnZWQgY2VsbHMuIEFyZSB5b3Ugc3VyZT8nLFxuICAgICAgICAgICAgdGhpc0FjdGlvbldpbGxDbGVhcllvdXJTZWFyY2hSZXN1bHRzQXJlWW91U3VyZTogJ1RoaXMgYWN0aW9uIHdpbGwgY2xlYXIgeW91ciBzZWFyY2ggcmVzdWx0cy4gQXJlIHlvdSBzdXJlPycsXG4gICAgICAgICAgICB0aGVyZUlzQUNvbmZsaWN0V2l0aEFub3RoZXJNZXJnZWRDZWxsOiAnVGhlcmUgaXMgYSBjb25mbGljdCB3aXRoIGFub3RoZXIgbWVyZ2VkIGNlbGwnLFxuICAgICAgICAgICAgaW52YWxpZE1lcmdlUHJvcGVydGllczogJ0ludmFsaWQgbWVyZ2VkIHByb3BlcnRpZXMnLFxuICAgICAgICAgICAgY2VsbEFscmVhZHlNZXJnZWQ6ICdDZWxsIGFscmVhZHkgbWVyZ2VkJyxcbiAgICAgICAgICAgIG5vQ2VsbHNTZWxlY3RlZDogJ05vIGNlbGxzIHNlbGVjdGVkJyxcbiAgICAgICAgfSxcbiAgICAgICAgLy8gQWJvdXQgbWVzc2FnZVxuICAgICAgICBhYm91dDpcImpFeGNlbCBDRSBTcHJlYWRzaGVldFxcblZlcnNpb24gMy45LjFcXG5BdXRob3I6IFBhdWwgSG9kZWwgPHBhdWwuaG9kZWxAZ21haWwuY29tPlxcbldlYnNpdGU6IGh0dHBzOi8vYm9zc2Fub3ZhLnVrL2pleGNlbC92M1wiLFxuICAgIH07XG5cbiAgICAvLyBMb2FkaW5nIGluaXRpYWwgY29uZmlndXJhdGlvbiBmcm9tIHVzZXJcbiAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBkZWZhdWx0cykge1xuICAgICAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmhhc093blByb3BlcnR5KHByb3BlcnR5KSkge1xuICAgICAgICAgICAgaWYgKHByb3BlcnR5ID09PSAndGV4dCcpIHtcclxuICAgICAgICAgICAgICAgIG9iai5vcHRpb25zW3Byb3BlcnR5XSA9IGRlZmF1bHRzW3Byb3BlcnR5XTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIHRleHRLZXkgaW4gb3B0aW9uc1twcm9wZXJ0eV0pIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9uc1twcm9wZXJ0eV0uaGFzT3duUHJvcGVydHkodGV4dEtleSkpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9uc1twcm9wZXJ0eV1bdGV4dEtleV0gPSBvcHRpb25zW3Byb3BlcnR5XVt0ZXh0S2V5XTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBvYmoub3B0aW9uc1twcm9wZXJ0eV0gPSBvcHRpb25zW3Byb3BlcnR5XTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG9iai5vcHRpb25zW3Byb3BlcnR5XSA9IGRlZmF1bHRzW3Byb3BlcnR5XTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIEdsb2JhbCBlbGVtZW50c1xuICAgIG9iai5lbCA9IGVsO1xuICAgIG9iai5jb3JuZXIgPSBudWxsO1xuICAgIG9iai5jb250ZXh0TWVudSA9IG51bGw7XG4gICAgb2JqLnRleHRhcmVhID0gbnVsbDtcbiAgICBvYmouYWRzID0gbnVsbDtcbiAgICBvYmouY29udGVudCA9IG51bGw7XG4gICAgb2JqLnRhYmxlID0gbnVsbDtcbiAgICBvYmoudGhlYWQgPSBudWxsO1xuICAgIG9iai50Ym9keSA9IG51bGw7XG4gICAgb2JqLnJvd3MgPSBbXTtcbiAgICBvYmoucmVzdWx0cyA9IG51bGw7XG4gICAgb2JqLnNlYXJjaElucHV0ID0gbnVsbDtcbiAgICBvYmoudG9vbGJhciA9IG51bGw7XG4gICAgb2JqLnBhZ2luYXRpb24gPSBudWxsO1xuICAgIG9iai5wYWdlTnVtYmVyID0gbnVsbDtcbiAgICBvYmouaGVhZGVyQ29udGFpbmVyID0gbnVsbDtcbiAgICBvYmouY29sZ3JvdXBDb250YWluZXIgPSBudWxsO1xuXG4gICAgLy8gQ29udGFpbmVyc1xuICAgIG9iai5oZWFkZXJzID0gW107XG4gICAgb2JqLnJlY29yZHMgPSBbXTtcbiAgICBvYmouaGlzdG9yeSA9IFtdO1xuICAgIG9iai5mb3JtdWxhID0gW107XG4gICAgb2JqLmNvbGdyb3VwID0gW107XG4gICAgb2JqLnNlbGVjdGlvbiA9IFtdO1xuICAgIG9iai5oaWdobGlnaHRlZCAgPSBbXTtcbiAgICBvYmouc2VsZWN0ZWRDZWxsID0gbnVsbDtcbiAgICBvYmouc2VsZWN0ZWRDb250YWluZXIgPSBudWxsO1xuICAgIG9iai5zdHlsZSA9IFtdO1xuICAgIG9iai5kYXRhID0gbnVsbDtcblxuICAgIC8vIEludGVybmFsIGNvbnRyb2xsZXJzXG4gICAgb2JqLmN1cnNvciA9IG51bGw7XG4gICAgb2JqLmhpc3RvcnlJbmRleCA9IC0xO1xuICAgIG9iai5pZ25vcmVFdmVudHMgPSBmYWxzZTtcbiAgICBvYmouaWdub3JlSGlzdG9yeSA9IGZhbHNlO1xuICAgIG9iai5lZGl0aW9uID0gbnVsbDtcbiAgICBvYmouaGFzaFN0cmluZyA9IG51bGw7XG4gICAgb2JqLnJlc2l6aW5nID0gbnVsbDtcbiAgICBvYmouZHJhZ2dpbmcgPSBudWxsO1xuXG4gICAgLy8gTGF6eSBsb2FkaW5nXG4gICAgaWYgKG9iai5vcHRpb25zLmxhenlMb2FkaW5nID09IHRydWUgJiYgKG9iai5vcHRpb25zLnRhYmxlT3ZlcmZsb3cgPT0gZmFsc2UgJiYgb2JqLm9wdGlvbnMuZnVsbHNjcmVlbiA9PSBmYWxzZSkpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignSkVYQ0VMOiBUaGUgbGF6eWxvYWRpbmcgb25seSB3b3JrcyB3aGVuIHRhYmxlT3ZlcmZsb3cgPSB5ZXMgb3IgZnVsbHNjcmVlbiA9IHllcycpO1xuICAgICAgICBvYmoub3B0aW9ucy5sYXp5TG9hZGluZyA9IGZhbHNlO1xuICAgIH1cbiAgICBcbiAgICAvKipcbiAgICAgKiBBY3RpdmF0ZS9EaXNhYmxlIGZ1bGxzY3JlZW4gXG4gICAgICogdXNlIHByb2dyYW1tYXRpY2FsbHkgOiB0YWJsZS5mdWxsc2NyZWVuKCk7IG9yIHRhYmxlLmZ1bGxzY3JlZW4odHJ1ZSk7IG9yIHRhYmxlLmZ1bGxzY3JlZW4oZmFsc2UpO1xuICAgICAqIEBQYXJhbSB7Ym9vbGVhbn0gYWN0aXZhdGVcbiAgICAgKi9cbiAgICBvYmouZnVsbHNjcmVlbiA9IGZ1bmN0aW9uKGFjdGl2YXRlKSB7XG4gICAgICAgIC8vIElmIGFjdGl2YXRlIG5vdCBkZWZpbmVkLCBnZXQgcmV2ZXJzZSBvcHRpb25zLmZ1bGxzY3JlZW5cbiAgICAgICAgaWYgKGFjdGl2YXRlID09IG51bGwpIHtcbiAgICAgICAgICAgIGFjdGl2YXRlID0gISBvYmoub3B0aW9ucy5mdWxsc2NyZWVuO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gSWYgY2hhbmdlXG4gICAgICAgIGlmIChvYmoub3B0aW9ucy5mdWxsc2NyZWVuICE9IGFjdGl2YXRlKSB7XG4gICAgICAgICAgICBvYmoub3B0aW9ucy5mdWxsc2NyZWVuID0gYWN0aXZhdGU7XG5cbiAgICAgICAgICAgIC8vIFRlc3QgTGF6eUxvYWRpbmcgY29uZmxpY3RcbiAgICAgICAgICAgIGlmIChhY3RpdmF0ZSA9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgZWwuY2xhc3NMaXN0LmFkZCgnZnVsbHNjcmVlbicpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBlbC5jbGFzc0xpc3QucmVtb3ZlKCdmdWxsc2NyZWVuJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUHJlcGFyZSB0aGUgamV4Y2VsIHRhYmxlXG4gICAgICogXG4gICAgICogQFBhcmFtIGNvbmZpZ1xuICAgICAqL1xuICAgIG9iai5wcmVwYXJlVGFibGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gTG9hZGluZyBpbml0aWFsIGRhdGEgZnJvbSByZW1vdGUgc291cmNlc1xuICAgICAgICB2YXIgcmVzdWx0cyA9IFtdO1xuXG4gICAgICAgIC8vIE51bWJlciBvZiBjb2x1bW5zXG4gICAgICAgIHZhciBzaXplID0gb2JqLm9wdGlvbnMuY29sdW1ucy5sZW5ndGg7XG5cbiAgICAgICAgaWYgKG9iai5vcHRpb25zLmRhdGEgJiYgdHlwZW9mKG9iai5vcHRpb25zLmRhdGFbMF0pICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgLy8gRGF0YSBrZXlzXG4gICAgICAgICAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iai5vcHRpb25zLmRhdGFbMF0pO1xuXG4gICAgICAgICAgICBpZiAoa2V5cy5sZW5ndGggPiBzaXplKSB7XG4gICAgICAgICAgICAgICAgc2l6ZSA9IGtleXMubGVuZ3RoO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gTWluaW1hbCBkaW1lbnNpb25zXG4gICAgICAgIGlmIChvYmoub3B0aW9ucy5taW5EaW1lbnNpb25zWzBdID4gc2l6ZSkge1xuICAgICAgICAgICAgc2l6ZSA9IG9iai5vcHRpb25zLm1pbkRpbWVuc2lvbnNbMF07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBSZXF1ZXN0c1xuICAgICAgICB2YXIgbXVsdGlwbGUgPSBbXTtcblxuICAgICAgICAvLyBQcmVwYXJhdGlvbnNcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaXplOyBpKyspIHtcbiAgICAgICAgICAgIC8vIERlcHJlY3RlZCBvcHRpb25zLiBZb3Ugc2hvdWxkIHVzZSBvbmx5IGNvbHVtbnNcbiAgICAgICAgICAgIGlmICghIG9iai5vcHRpb25zLmNvbEhlYWRlcnNbaV0pIHtcbiAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5jb2xIZWFkZXJzW2ldID0gJyc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoISBvYmoub3B0aW9ucy5jb2xXaWR0aHNbaV0pIHtcbiAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5jb2xXaWR0aHNbaV0gPSBvYmoub3B0aW9ucy5kZWZhdWx0Q29sV2lkdGg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoISBvYmoub3B0aW9ucy5jb2xBbGlnbm1lbnRzW2ldKSB7XG4gICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMuY29sQWxpZ25tZW50c1tpXSA9IG9iai5vcHRpb25zLmRlZmF1bHRDb2xBbGlnbjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gRGVmYXVsdCBjb2x1bW4gZGVzY3JpcHRpb25cbiAgICAgICAgICAgIGlmICghIG9iai5vcHRpb25zLmNvbHVtbnNbaV0pIHtcbiAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5jb2x1bW5zW2ldID0geyB0eXBlOid0ZXh0JyB9O1xuICAgICAgICAgICAgfSBlbHNlIGlmICghIG9iai5vcHRpb25zLmNvbHVtbnNbaV0udHlwZSkge1xuICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmNvbHVtbnNbaV0udHlwZSA9ICd0ZXh0JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghIG9iai5vcHRpb25zLmNvbHVtbnNbaV0ubmFtZSkge1xuICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmNvbHVtbnNbaV0ubmFtZSA9IGtleXMgJiYga2V5c1tpXSA/IGtleXNbaV0gOiBpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCEgb2JqLm9wdGlvbnMuY29sdW1uc1tpXS5zb3VyY2UpIHtcbiAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5jb2x1bW5zW2ldLnNvdXJjZSA9IFtdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCEgb2JqLm9wdGlvbnMuY29sdW1uc1tpXS5vcHRpb25zKSB7XG4gICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMuY29sdW1uc1tpXS5vcHRpb25zID0gW107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoISBvYmoub3B0aW9ucy5jb2x1bW5zW2ldLmVkaXRvcikge1xuICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmNvbHVtbnNbaV0uZWRpdG9yID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghIG9iai5vcHRpb25zLmNvbHVtbnNbaV0uYWxsb3dFbXB0eSkge1xuICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmNvbHVtbnNbaV0uYWxsb3dFbXB0eSA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCEgb2JqLm9wdGlvbnMuY29sdW1uc1tpXS50aXRsZSkge1xuICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmNvbHVtbnNbaV0udGl0bGUgPSBvYmoub3B0aW9ucy5jb2xIZWFkZXJzW2ldID8gb2JqLm9wdGlvbnMuY29sSGVhZGVyc1tpXSA6ICcnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCEgb2JqLm9wdGlvbnMuY29sdW1uc1tpXS53aWR0aCkge1xuICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmNvbHVtbnNbaV0ud2lkdGggPSBvYmoub3B0aW9ucy5jb2xXaWR0aHNbaV0gPyBvYmoub3B0aW9ucy5jb2xXaWR0aHNbaV0gOiBvYmoub3B0aW9ucy5kZWZhdWx0Q29sV2lkdGg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoISBvYmoub3B0aW9ucy5jb2x1bW5zW2ldLmFsaWduKSB7XG4gICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMuY29sdW1uc1tpXS5hbGlnbiA9IG9iai5vcHRpb25zLmNvbEFsaWdubWVudHNbaV0gPyBvYmoub3B0aW9ucy5jb2xBbGlnbm1lbnRzW2ldIDogJ2NlbnRlcic7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFByZS1sb2FkIGluaXRpYWwgc291cmNlIGZvciBqc29uIGF1dG9jb21wbGV0ZVxuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbaV0udHlwZSA9PSAnYXV0b2NvbXBsZXRlJyB8fCBvYmoub3B0aW9ucy5jb2x1bW5zW2ldLnR5cGUgPT0gJ2Ryb3Bkb3duJykge1xuICAgICAgICAgICAgICAgIC8vIGlmIHJlbW90ZSBjb250ZW50XG4gICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbaV0udXJsKSB7XG4gICAgICAgICAgICAgICAgICAgIG11bHRpcGxlLnB1c2goalN1aXRlcy5hamF4KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogb2JqLm9wdGlvbnMuY29sdW1uc1tpXS51cmwsXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmRleDogaSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgICAgICAgICAgICAgbXVsdGlwbGU6IG11bHRpcGxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzb3VyY2UgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMuY29sdW1uc1t0aGlzLmluZGV4XS5zb3VyY2UucHVzaChkYXRhW2ldKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5jcmVhdGVUYWJsZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmIChvYmoub3B0aW9ucy5jb2x1bW5zW2ldLnR5cGUgPT0gJ2NhbGVuZGFyJykge1xuICAgICAgICAgICAgICAgIC8vIERlZmF1bHQgZm9ybWF0IGZvciBkYXRlIGNvbHVtbnNcbiAgICAgICAgICAgICAgICBpZiAoISBvYmoub3B0aW9ucy5jb2x1bW5zW2ldLm9wdGlvbnMuZm9ybWF0KSB7XG4gICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmNvbHVtbnNbaV0ub3B0aW9ucy5mb3JtYXQgPSAnREQvTU0vWVlZWSc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gT24gY29tcGxldGVcbiAgICAgICAgaWYgKCEgbXVsdGlwbGUubGVuZ3RoKSB7XG4gICAgICAgICAgICBvYmouY3JlYXRlVGFibGUoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG9iai5jcmVhdGVUYWJsZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBFbGVtZW50c1xuICAgICAgICBvYmoudGFibGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0YWJsZScpO1xuICAgICAgICBvYmoudGhlYWQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0aGVhZCcpO1xuICAgICAgICBvYmoudGJvZHkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0Ym9keScpO1xuXG4gICAgICAgIC8vIENyZWF0ZSBoZWFkZXJzIGNvbnRyb2xsZXJzXG4gICAgICAgIG9iai5oZWFkZXJzID0gW107XG4gICAgICAgIG9iai5jb2xncm91cCA9IFtdO1xuXG4gICAgICAgIC8vIENyZWF0ZSB0YWJsZSBjb250YWluZXJcbiAgICAgICAgb2JqLmNvbnRlbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgb2JqLmNvbnRlbnQuY2xhc3NMaXN0LmFkZCgnamV4Y2VsX2NvbnRlbnQnKTtcblxuICAgICAgICAvLyBDcmVhdGUgdG9vbGJhciBvYmplY3RcbiAgICAgICAgb2JqLnRvb2xiYXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgb2JqLnRvb2xiYXIuY2xhc3NMaXN0LmFkZCgnamV4Y2VsX3Rvb2xiYXInKTtcblxuICAgICAgICAvLyBTZWFyY2hcbiAgICAgICAgdmFyIHNlYXJjaENvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB2YXIgc2VhcmNoVGV4dCA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKChvYmoub3B0aW9ucy50ZXh0LnNlYXJjaCkgKyAnOiAnKTtcbiAgICAgICAgb2JqLnNlYXJjaElucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgICAgICAgb2JqLnNlYXJjaElucHV0LmNsYXNzTGlzdC5hZGQoJ2pleGNlbF9zZWFyY2gnKTtcbiAgICAgICAgc2VhcmNoQ29udGFpbmVyLmFwcGVuZENoaWxkKHNlYXJjaFRleHQpO1xuICAgICAgICBzZWFyY2hDb250YWluZXIuYXBwZW5kQ2hpbGQob2JqLnNlYXJjaElucHV0KTtcbiAgICAgICAgb2JqLnNlYXJjaElucHV0Lm9uZm9jdXMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG9iai5yZXNldFNlbGVjdGlvbigpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gUGFnaW5hdGlvbiBzZWxlY3Qgb3B0aW9uXG4gICAgICAgIHZhciBwYWdpbmF0aW9uVXBkYXRlQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG5cbiAgICAgICAgaWYgKG9iai5vcHRpb25zLnBhZ2luYXRpb24gPiAwICYmIG9iai5vcHRpb25zLnBhZ2luYXRpb25PcHRpb25zICYmIG9iai5vcHRpb25zLnBhZ2luYXRpb25PcHRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIG9iai5wYWdpbmF0aW9uRHJvcGRvd24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzZWxlY3QnKTtcbiAgICAgICAgICAgIG9iai5wYWdpbmF0aW9uRHJvcGRvd24uY2xhc3NMaXN0LmFkZCgnamV4Y2VsX3BhZ2luYXRpb25fZHJvcGRvd24nKTtcbiAgICAgICAgICAgIG9iai5wYWdpbmF0aW9uRHJvcGRvd24ub25jaGFuZ2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5wYWdpbmF0aW9uID0gcGFyc2VJbnQodGhpcy52YWx1ZSk7XG4gICAgICAgICAgICAgICAgb2JqLnBhZ2UoMCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2JqLm9wdGlvbnMucGFnaW5hdGlvbk9wdGlvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgdGVtcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xuICAgICAgICAgICAgICAgIHRlbXAudmFsdWUgPSBvYmoub3B0aW9ucy5wYWdpbmF0aW9uT3B0aW9uc1tpXTtcbiAgICAgICAgICAgICAgICB0ZW1wLmlubmVySFRNTCA9IG9iai5vcHRpb25zLnBhZ2luYXRpb25PcHRpb25zW2ldO1xuICAgICAgICAgICAgICAgIG9iai5wYWdpbmF0aW9uRHJvcGRvd24uYXBwZW5kQ2hpbGQodGVtcCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHBhZ2luYXRpb25VcGRhdGVDb250YWluZXIuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUob2JqLm9wdGlvbnMudGV4dC5zaG93KSk7XG4gICAgICAgICAgICBwYWdpbmF0aW9uVXBkYXRlQ29udGFpbmVyLmFwcGVuZENoaWxkKG9iai5wYWdpbmF0aW9uRHJvcGRvd24pO1xuICAgICAgICAgICAgcGFnaW5hdGlvblVwZGF0ZUNvbnRhaW5lci5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShvYmoub3B0aW9ucy50ZXh0LmVudHJpZXMpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEZpbHRlciBhbmQgcGFnaW5hdGlvbiBjb250YWluZXJcbiAgICAgICAgb2JqLmZpbHRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBvYmouZmlsdGVyLmNsYXNzTGlzdC5hZGQoJ2pleGNlbF9maWx0ZXInKTtcbiAgICAgICAgb2JqLmZpbHRlci5hcHBlbmRDaGlsZChwYWdpbmF0aW9uVXBkYXRlQ29udGFpbmVyKTtcbiAgICAgICAgb2JqLmZpbHRlci5hcHBlbmRDaGlsZChzZWFyY2hDb250YWluZXIpO1xuXG4gICAgICAgIC8vIENvbHNncm91cFxuICAgICAgICBvYmouY29sZ3JvdXBDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjb2xncm91cCcpO1xuICAgICAgICB2YXIgdGVtcENvbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NvbCcpO1xuICAgICAgICB0ZW1wQ29sLnNldEF0dHJpYnV0ZSgnd2lkdGgnLCAnNTAnKTtcbiAgICAgICAgb2JqLmNvbGdyb3VwQ29udGFpbmVyLmFwcGVuZENoaWxkKHRlbXBDb2wpO1xuXG4gICAgICAgIC8vIE5lc3RlZFxuICAgICAgICBpZiAob2JqLm9wdGlvbnMubmVzdGVkSGVhZGVycyAmJiBvYmoub3B0aW9ucy5uZXN0ZWRIZWFkZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIC8vIEZsZXhpYmxlIHdheSB0byBoYW5kbGUgbmVzdGVkaGVhZGVyc1xuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLm5lc3RlZEhlYWRlcnNbMF0gJiYgb2JqLm9wdGlvbnMubmVzdGVkSGVhZGVyc1swXVswXSkge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgb2JqLm9wdGlvbnMubmVzdGVkSGVhZGVycy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICBvYmoudGhlYWQuYXBwZW5kQ2hpbGQob2JqLmNyZWF0ZU5lc3RlZEhlYWRlcihvYmoub3B0aW9ucy5uZXN0ZWRIZWFkZXJzW2pdKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBvYmoudGhlYWQuYXBwZW5kQ2hpbGQob2JqLmNyZWF0ZU5lc3RlZEhlYWRlcihvYmoub3B0aW9ucy5uZXN0ZWRIZWFkZXJzKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBSb3dcbiAgICAgICAgb2JqLmhlYWRlckNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7XG4gICAgICAgIHZhciB0ZW1wQ29sID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcbiAgICAgICAgdGVtcENvbC5jbGFzc0xpc3QuYWRkKCdqZXhjZWxfc2VsZWN0YWxsJyk7XG4gICAgICAgIG9iai5oZWFkZXJDb250YWluZXIuYXBwZW5kQ2hpbGQodGVtcENvbCk7XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvYmoub3B0aW9ucy5jb2x1bW5zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAvLyBDcmVhdGUgaGVhZGVyXG4gICAgICAgICAgICBvYmouY3JlYXRlQ2VsbEhlYWRlcihpKTtcbiAgICAgICAgICAgIC8vIEFwcGVuZCBjZWxsIHRvIHRoZSBjb250YWluZXJcbiAgICAgICAgICAgIG9iai5oZWFkZXJDb250YWluZXIuYXBwZW5kQ2hpbGQob2JqLmhlYWRlcnNbaV0pO1xuICAgICAgICAgICAgb2JqLmNvbGdyb3VwQ29udGFpbmVyLmFwcGVuZENoaWxkKG9iai5jb2xncm91cFtpXSk7XG4gICAgICAgIH1cblxuICAgICAgICBvYmoudGhlYWQuYXBwZW5kQ2hpbGQob2JqLmhlYWRlckNvbnRhaW5lcik7XG5cbiAgICAgICAgLy8gQ29udGVudCB0YWJsZVxuICAgICAgICBvYmoudGFibGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0YWJsZScpO1xuICAgICAgICBvYmoudGFibGUuY2xhc3NMaXN0LmFkZCgnamV4Y2VsJyk7XG4gICAgICAgIG9iai50YWJsZS5zZXRBdHRyaWJ1dGUoJ2NlbGxwYWRkaW5nJywgJzAnKTtcbiAgICAgICAgb2JqLnRhYmxlLnNldEF0dHJpYnV0ZSgnY2VsbHNwYWNpbmcnLCAnMCcpO1xuICAgICAgICBvYmoudGFibGUuc2V0QXR0cmlidXRlKCd1bnNlbGVjdGFibGUnLCAneWVzJyk7XG4gICAgICAgIG9iai50YWJsZS5zZXRBdHRyaWJ1dGUoJ29uc2VsZWN0c3RhcnQnLCAncmV0dXJuIGZhbHNlJyk7XG4gICAgICAgIG9iai50YWJsZS5hcHBlbmRDaGlsZChvYmouY29sZ3JvdXBDb250YWluZXIpO1xuICAgICAgICBvYmoudGFibGUuYXBwZW5kQ2hpbGQob2JqLnRoZWFkKTtcbiAgICAgICAgb2JqLnRhYmxlLmFwcGVuZENoaWxkKG9iai50Ym9keSk7XG5cbiAgICAgICAgLy8gU3ByZWFkc2hlZXQgY29ybmVyXG4gICAgICAgIG9iai5jb3JuZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgb2JqLmNvcm5lci5jbGFzc05hbWUgPSAnamV4Y2VsX2Nvcm5lcic7XG4gICAgICAgIG9iai5jb3JuZXIuc2V0QXR0cmlidXRlKCd1bnNlbGVjdGFibGUnLCAnb24nKTtcbiAgICAgICAgb2JqLmNvcm5lci5zZXRBdHRyaWJ1dGUoJ29uc2VsZWN0c3RhcnQnLCAncmV0dXJuIGZhbHNlJyk7XG5cbiAgICAgICAgaWYgKG9iai5vcHRpb25zLnNlbGVjdGlvbkNvcHkgPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIG9iai5jb3JuZXIuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFRleHRhcmVhIGhlbHBlclxuICAgICAgICBvYmoudGV4dGFyZWEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZXh0YXJlYScpO1xuICAgICAgICBvYmoudGV4dGFyZWEuY2xhc3NOYW1lID0gJ2pleGNlbF90ZXh0YXJlYSc7XG4gICAgICAgIG9iai50ZXh0YXJlYS5pZCA9ICdqZXhjZWxfdGV4dGFyZWEnO1xuICAgICAgICBvYmoudGV4dGFyZWEudGFiSW5kZXggPSAnLTEnO1xyXG5cbiAgICAgICAgLy8gQ29udGV4dG1lbnUgY29udGFpbmVyXG4gICAgICAgIG9iai5jb250ZXh0TWVudSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBvYmouY29udGV4dE1lbnUuY2xhc3NOYW1lID0gJ2pleGNlbF9jb250ZXh0bWVudSc7XG5cbiAgICAgICAgLy8gQ3JlYXRlIGVsZW1lbnRcbiAgICAgICAgalN1aXRlcy5jb250ZXh0bWVudShvYmouY29udGV4dE1lbnUsIHtcbiAgICAgICAgICAgIG9uY2xpY2s6ZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgb2JqLmNvbnRleHRNZW51LmNvbnRleHRtZW51LmNsb3NlKGZhbHNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gUG93ZXJlZCBieSBqRXhjZWxcclxuICAgICAgICB2YXIgYWRzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xyXG4gICAgICAgIGFkcy5zZXRBdHRyaWJ1dGUoJ2hyZWYnLCAnaHR0cHM6Ly9ib3NzYW5vdmEudWsvamV4Y2VsLycpO1xyXG4gICAgICAgIG9iai5hZHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICBvYmouYWRzLmNsYXNzTmFtZSA9ICdqZXhjZWxfYWJvdXQnO1xyXG4gICAgICAgIGlmICh0eXBlb2Yoc2Vzc2lvblN0b3JhZ2UpICE9PSBcInVuZGVmaW5lZFwiICYmICEgc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgnamV4Y2VsJykpIHtcclxuICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgnamV4Y2VsJywgdHJ1ZSk7XHJcbiAgICAgICAgICAgIHZhciBpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcclxuICAgICAgICAgICAgaW1nLnNyYyA9ICcvL2Jvc3Nhbm92YS51ay9qZXhjZWwvbG9nby5wbmcnO1xyXG4gICAgICAgICAgICBhZHMuYXBwZW5kQ2hpbGQoaW1nKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIHNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XHJcbiAgICAgICAgc3Bhbi5pbm5lckhUTUwgPSAnSmV4Y2VsIHNwcmVhZHNoZWV0JztcclxuICAgICAgICBhZHMuYXBwZW5kQ2hpbGQoc3Bhbik7XHJcbiAgICAgICAgb2JqLmFkcy5hcHBlbmRDaGlsZChhZHMpO1xuXG4gICAgICAgIC8vIENyZWF0ZSB0YWJsZSBjb250YWluZXIgVE9ETzogZnJvemVuIGNvbHVtbnNcbiAgICAgICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZCgnamV4Y2VsX3RhYmxlJyk7XG5cbiAgICAgICAgLy8gUGFnaW5hdGlvblxuICAgICAgICBvYmoucGFnaW5hdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBvYmoucGFnaW5hdGlvbi5jbGFzc0xpc3QuYWRkKCdqZXhjZWxfcGFnaW5hdGlvbicpO1xuICAgICAgICB2YXIgcGFnaW5hdGlvbkluZm8gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdmFyIHBhZ2luYXRpb25QYWdlcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBvYmoucGFnaW5hdGlvbi5hcHBlbmRDaGlsZChwYWdpbmF0aW9uSW5mbyk7XG4gICAgICAgIG9iai5wYWdpbmF0aW9uLmFwcGVuZENoaWxkKHBhZ2luYXRpb25QYWdlcyk7XG5cbiAgICAgICAgLy8gSGlkZSBwYWdpbmF0aW9uIGlmIG5vdCBpbiB1c2VcclxuICAgICAgICBpZiAoISBvYmoub3B0aW9ucy5wYWdpbmF0aW9uKSB7XHJcbiAgICAgICAgICAgIG9iai5wYWdpbmF0aW9uLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XHJcbiAgICAgICAgfVxyXG5cbiAgICAgICAgLy8gQXBwZW5kIGNvbnRhaW5lcnMgdG8gdGhlIHRhYmxlXG4gICAgICAgIGlmIChvYmoub3B0aW9ucy5zZWFyY2ggPT0gdHJ1ZSkge1xuICAgICAgICAgICAgZWwuYXBwZW5kQ2hpbGQob2JqLmZpbHRlcik7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBFbGVtZW50c1xuICAgICAgICBvYmouY29udGVudC5hcHBlbmRDaGlsZChvYmoudGFibGUpO1xuICAgICAgICBvYmouY29udGVudC5hcHBlbmRDaGlsZChvYmouY29ybmVyKTtcbiAgICAgICAgb2JqLmNvbnRlbnQuYXBwZW5kQ2hpbGQob2JqLnRleHRhcmVhKTtcblxuICAgICAgICBlbC5hcHBlbmRDaGlsZChvYmoudG9vbGJhcik7XG4gICAgICAgIGVsLmFwcGVuZENoaWxkKG9iai5jb250ZW50KTtcbiAgICAgICAgZWwuYXBwZW5kQ2hpbGQob2JqLnBhZ2luYXRpb24pO1xuICAgICAgICBlbC5hcHBlbmRDaGlsZChvYmouY29udGV4dE1lbnUpO1xuICAgICAgICBlbC5hcHBlbmRDaGlsZChvYmouYWRzKTtcbiAgICAgICAgZWwuY2xhc3NMaXN0LmFkZCgnamV4Y2VsX2NvbnRhaW5lcicpO1xuXG4gICAgICAgIC8vIENyZWF0ZSB0b29sYmFyXG4gICAgICAgIGlmIChvYmoub3B0aW9ucy50b29sYmFyICYmIG9iai5vcHRpb25zLnRvb2xiYXIubGVuZ3RoKSB7XG4gICAgICAgICAgICBvYmouY3JlYXRlVG9vbGJhcigpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRnVsbHNjcmVlblxuICAgICAgICBpZiAob2JqLm9wdGlvbnMuZnVsbHNjcmVlbiA9PSB0cnVlKSB7XG4gICAgICAgICAgICBlbC5jbGFzc0xpc3QuYWRkKCdmdWxsc2NyZWVuJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBPdmVyZmxvd1xuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLnRhYmxlT3ZlcmZsb3cgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy50YWJsZUhlaWdodCkge1xuICAgICAgICAgICAgICAgICAgICBvYmouY29udGVudC5zdHlsZVsnb3ZlcmZsb3cteSddID0gJ2F1dG8nO1xuICAgICAgICAgICAgICAgICAgICBvYmouY29udGVudC5zdHlsZS5tYXhIZWlnaHQgPSBvYmoub3B0aW9ucy50YWJsZUhlaWdodDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLnRhYmxlV2lkdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgb2JqLmNvbnRlbnQuc3R5bGVbJ292ZXJmbG93LXgnXSA9ICdhdXRvJztcbiAgICAgICAgICAgICAgICAgICAgb2JqLmNvbnRlbnQuc3R5bGUud2lkdGggPSBvYmoub3B0aW9ucy50YWJsZVdpZHRoO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFdpdGggdG9vbGJhcnNcbiAgICAgICAgaWYgKG9iai5vcHRpb25zLnRhYmxlT3ZlcmZsb3cgIT0gdHJ1ZSAmJiBvYmoub3B0aW9ucy50b29sYmFyKSB7XG4gICAgICAgICAgICBlbC5jbGFzc0xpc3QuYWRkKCd3aXRoLXRvb2xiYXInKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEFjdGlvbnNcbiAgICAgICAgaWYgKG9iai5vcHRpb25zLmNvbHVtbkRyYWcgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgb2JqLnRoZWFkLmNsYXNzTGlzdC5hZGQoJ2RyYWdnYWJsZScpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvYmoub3B0aW9ucy5jb2x1bW5SZXNpemUgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgb2JqLnRoZWFkLmNsYXNzTGlzdC5hZGQoJ3Jlc2l6YWJsZScpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvYmoub3B0aW9ucy5yb3dEcmFnID09IHRydWUpIHtcbiAgICAgICAgICAgIG9iai50Ym9keS5jbGFzc0xpc3QuYWRkKCdkcmFnZ2FibGUnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob2JqLm9wdGlvbnMucm93UmVzaXplID09IHRydWUpIHtcbiAgICAgICAgICAgIG9iai50Ym9keS5jbGFzc0xpc3QuYWRkKCdyZXNpemFibGUnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIExvYWQgZGF0YVxuICAgICAgICBvYmouc2V0RGF0YSgpO1xuXG4gICAgICAgIC8vIFN0eWxlXG4gICAgICAgIGlmIChvYmoub3B0aW9ucy5zdHlsZSkge1xuICAgICAgICAgICAgb2JqLnNldFN0eWxlKG9iai5vcHRpb25zLnN0eWxlLCBudWxsLCBudWxsLCAxLCAxKTtcbiAgICAgICAgfVxuICAgIH1cblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZWZyZXNoIHRoZSBkYXRhXHJcbiAgICAgKiBcclxuICAgICAqIEByZXR1cm4gdm9pZFxyXG4gICAgICovXHJcbiAgICBvYmoucmVmcmVzaCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGlmIChvYmoub3B0aW9ucy51cmwpIHtcclxuICAgICAgICAgICAgLy8gTG9hZGluZ1xyXG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMubG9hZGluZ1NwaW4gPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgalN1aXRlcy5sb2FkaW5nLnNob3coKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgalN1aXRlcy5hamF4KHtcclxuICAgICAgICAgICAgICAgIHVybDogb2JqLm9wdGlvbnMudXJsLFxyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXHJcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBEYXRhXHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMuZGF0YSA9IChyZXN1bHQuZGF0YSkgPyByZXN1bHQuZGF0YSA6IHJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICAvLyBQcmVwYXJlIHRhYmxlXHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLnNldERhdGEoKTtcclxuICAgICAgICAgICAgICAgICAgICAvLyBIaWRlIHNwaW5cclxuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMubG9hZGluZ1NwaW4gPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBqU3VpdGVzLmxvYWRpbmcuaGlkZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgb2JqLnNldERhdGEoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxuICAgIC8qKlxuICAgICAqIFNldCBkYXRhXG4gICAgICogXG4gICAgICogQHBhcmFtIGFycmF5IGRhdGEgSW4gY2FzZSBubyBkYXRhIGlzIHNlbnQsIGRlZmF1bHQgaXMgcmVsb2FkZWRcbiAgICAgKiBAcmV0dXJuIHZvaWRcbiAgICAgKi9cbiAgICBvYmouc2V0RGF0YSA9IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgLy8gVXBkYXRlIGRhdGFcbiAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YoZGF0YSkgPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICBkYXRhID0gSlNPTi5wYXJzZShkYXRhKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgb2JqLm9wdGlvbnMuZGF0YSA9IGRhdGE7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBEYXRhXG4gICAgICAgIGlmICghIG9iai5vcHRpb25zLmRhdGEpIHtcbiAgICAgICAgICAgIG9iai5vcHRpb25zLmRhdGEgPSBbXTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFByZXBhcmUgZGF0YVxuICAgICAgICBpZiAob2JqLm9wdGlvbnMuZGF0YSkge1xuICAgICAgICAgICAgdmFyIGRhdGEgPSBbXTtcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgb2JqLm9wdGlvbnMuZGF0YS5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgIHZhciByb3cgPSBbXTtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iai5vcHRpb25zLmNvbHVtbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgcm93W2ldID0gb2JqLm9wdGlvbnMuZGF0YVtqXVtvYmoub3B0aW9ucy5jb2x1bW5zW2ldLm5hbWVdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBkYXRhLnB1c2gocm93KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgb2JqLm9wdGlvbnMuZGF0YSA9IGRhdGE7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBBZGp1c3QgbWluaW1hbCBkaW1lbnNpb25zXG4gICAgICAgIHZhciBqID0gMDtcbiAgICAgICAgdmFyIGkgPSAwO1xuICAgICAgICB2YXIgc2l6ZV9pID0gb2JqLm9wdGlvbnMuY29sdW1ucy5sZW5ndGg7XG4gICAgICAgIHZhciBzaXplX2ogPSBvYmoub3B0aW9ucy5kYXRhLmxlbmd0aDtcbiAgICAgICAgdmFyIG1pbl9pID0gb2JqLm9wdGlvbnMubWluRGltZW5zaW9uc1swXTtcbiAgICAgICAgdmFyIG1pbl9qID0gb2JqLm9wdGlvbnMubWluRGltZW5zaW9uc1sxXTtcbiAgICAgICAgdmFyIG1heF9pID0gbWluX2kgPiBzaXplX2kgPyBtaW5faSA6IHNpemVfaTtcbiAgICAgICAgdmFyIG1heF9qID0gbWluX2ogPiBzaXplX2ogPyBtaW5faiA6IHNpemVfajtcblxuICAgICAgICBmb3IgKGogPSAwOyBqIDwgbWF4X2o7IGorKykge1xuICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IG1heF9pOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuZGF0YVtqXSA9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMuZGF0YVtqXSA9IFtdO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5kYXRhW2pdW2ldID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5kYXRhW2pdW2ldID0gJyc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gUmVzZXQgY29udGFpbmVyc1xuICAgICAgICBvYmoucm93cyA9IFtdO1xuICAgICAgICBvYmoucmVzdWx0cyA9IG51bGw7XG4gICAgICAgIG9iai5yZWNvcmRzID0gW107XG4gICAgICAgIG9iai5oaXN0b3J5ID0gW107XG5cbiAgICAgICAgLy8gUmVzZXQgaW50ZXJuYWwgY29udHJvbGxlcnNcbiAgICAgICAgb2JqLmhpc3RvcnlJbmRleCA9IC0xO1xuXG4gICAgICAgIC8vIFJlc2V0IGRhdGFcbiAgICAgICAgb2JqLnRib2R5LmlubmVySFRNTCA9ICcnO1xuXG4gICAgICAgIC8vIExhenkgbG9hZGluZ1xuICAgICAgICBpZiAob2JqLm9wdGlvbnMubGF6eUxvYWRpbmcgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgLy8gTG9hZCBvbmx5IDEwMCByZWNvcmRzXG4gICAgICAgICAgICB2YXIgc3RhcnROdW1iZXIgPSAwXG4gICAgICAgICAgICB2YXIgZmluYWxOdW1iZXIgPSBvYmoub3B0aW9ucy5kYXRhLmxlbmd0aCA8IDEwMCA/IG9iai5vcHRpb25zLmRhdGEubGVuZ3RoIDogMTAwO1xuXG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMucGFnaW5hdGlvbikge1xuICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLnBhZ2luYXRpb24gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdKRVhDRUw6IFBhZ2luYXRpb24gd2lsbCBiZSBkaXNhYmxlIGR1ZSB0aGUgbGF6eUxvYWRpbmcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChvYmoub3B0aW9ucy5wYWdpbmF0aW9uKSB7XG4gICAgICAgICAgICAvLyBQYWdpbmF0aW9uXG4gICAgICAgICAgICBpZiAoISBvYmoucGFnZU51bWJlcikge1xuICAgICAgICAgICAgICAgIG9iai5wYWdlTnVtYmVyID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBxdWFudGl0eVBlclBhZ2UgPSBvYmoub3B0aW9ucy5wYWdpbmF0aW9uO1xuICAgICAgICAgICAgc3RhcnROdW1iZXIgPSAob2JqLm9wdGlvbnMucGFnaW5hdGlvbiAqIG9iai5wYWdlTnVtYmVyKTtcbiAgICAgICAgICAgIGZpbmFsTnVtYmVyID0gKG9iai5vcHRpb25zLnBhZ2luYXRpb24gKiBvYmoucGFnZU51bWJlcikgKyBvYmoub3B0aW9ucy5wYWdpbmF0aW9uO1xuXG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuZGF0YS5sZW5ndGggPCBmaW5hbE51bWJlcikge1xuICAgICAgICAgICAgICAgIGZpbmFsTnVtYmVyID0gb2JqLm9wdGlvbnMuZGF0YS5sZW5ndGg7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgc3RhcnROdW1iZXIgPSAwO1xuICAgICAgICAgICAgdmFyIGZpbmFsTnVtYmVyID0gb2JqLm9wdGlvbnMuZGF0YS5sZW5ndGg7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBBcHBlbmQgbm9kZXMgdG8gdGhlIEhUTUxcbiAgICAgICAgZm9yIChqID0gMDsgaiA8IG9iai5vcHRpb25zLmRhdGEubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgIC8vIENyZWF0ZSByb3dcbiAgICAgICAgICAgIHZhciB0ciA9IG9iai5jcmVhdGVSb3coaiwgb2JqLm9wdGlvbnMuZGF0YVtqXSk7XG4gICAgICAgICAgICAvLyBBcHBlbmQgbGluZSB0byB0aGUgdGFibGVcbiAgICAgICAgICAgIGlmIChqID49IHN0YXJ0TnVtYmVyICYmIGogPCBmaW5hbE51bWJlcikge1xuICAgICAgICAgICAgICAgIG9iai50Ym9keS5hcHBlbmRDaGlsZCh0cik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAob2JqLm9wdGlvbnMubGF6eUxvYWRpbmcgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgLy8gRG8gbm90IGNyZWF0ZSBwYWdpbmF0aW9uIHdpdGggbGF6eWxvYWRpbmcgYWN0aXZhdGVkXG4gICAgICAgIH0gZWxzZSBpZiAob2JqLm9wdGlvbnMucGFnaW5hdGlvbikge1xuICAgICAgICAgICAgb2JqLnVwZGF0ZVBhZ2luYXRpb24oKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIE1lcmdlIGNlbGxzXG4gICAgICAgIGlmIChvYmoub3B0aW9ucy5tZXJnZUNlbGxzKSB7XG4gICAgICAgICAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iai5vcHRpb25zLm1lcmdlQ2VsbHMpO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIG51bSA9IG9iai5vcHRpb25zLm1lcmdlQ2VsbHNba2V5c1tpXV07XG4gICAgICAgICAgICAgICAgb2JqLnNldE1lcmdlKGtleXNbaV0sIG51bVswXSwgbnVtWzFdLCAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFVwZGF0YSB0YWJsZSB3aXRoIGN1c3RvbSBjb25maWd1cmF0aW9ucyBpZiBhcHBsaWNhYmxlXG4gICAgICAgIG9iai51cGRhdGVUYWJsZSgpO1xuXG4gICAgICAgIC8vIE9ubG9hZFxuICAgICAgICBpZiAoISBvYmouaWdub3JlRXZlbnRzKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mKG9iai5vcHRpb25zLm9ubG9hZCkgPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLm9ubG9hZChlbCwgb2JqKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgd2hvbGUgdGFibGUgZGF0YVxuICAgICAqIFxuICAgICAqIEBwYXJhbSBib29sIGdldCBoaWdobGlnaHRlZCBjZWxscyBvbmx5XG4gICAgICogQHJldHVybiBhcnJheSBkYXRhXG4gICAgICovXG4gICAgICAgIG9iai5nZXREYXRhID0gZnVuY3Rpb24oaGlnaGxpZ2h0ZWQsIGRhdGFPbmx5KSB7XG4gICAgICAgIC8vIENvbnRyb2wgdmFyc1xuICAgICAgICB2YXIgZGF0YXNldCA9IFtdO1xuICAgICAgICB2YXIgcHggPSAwO1xuICAgICAgICB2YXIgcHkgPSAwO1xuXG4gICAgICAgIC8vIERhdGEgdHlwZVxyXG4gICAgICAgIHZhciBkYXRhVHlwZSA9IGRhdGFPbmx5ID09IHRydWUgfHwgb2JqLm9wdGlvbnMuY29weUNvbXBhdGliaWxpdHkgPT0gZmFsc2UgPyB0cnVlIDogZmFsc2U7XHJcblxuICAgICAgICAvLyBDb2x1bW4gYW5kIHJvdyBsZW5ndGhcbiAgICAgICAgdmFyIHggPSBvYmoub3B0aW9ucy5jb2x1bW5zLmxlbmd0aFxuICAgICAgICB2YXIgeSA9IG9iai5vcHRpb25zLmRhdGEubGVuZ3RoXG5cbiAgICAgICAgLy8gR28gdGhyb3VnaCB0aGUgY29sdW1ucyB0byBnZXQgdGhlIGRhdGFcbiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB5OyBqKyspIHtcbiAgICAgICAgICAgIHB4ID0gMDtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgeDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgLy8gQ2VsbCBzZWxlY3RlZCBvciBmdWxsc2V0XG4gICAgICAgICAgICAgICAgaWYgKCEgaGlnaGxpZ2h0ZWQgfHwgb2JqLnJlY29yZHNbal1baV0uY2xhc3NMaXN0LmNvbnRhaW5zKCdoaWdobGlnaHQnKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBHZXQgdmFsdWVcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEgZGF0YXNldFtweV0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFzZXRbcHldID0gW107XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKCEgZGF0YVR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFzZXRbcHldW3B4XSA9IG9iai5yZWNvcmRzW2pdW2ldLmlubmVySFRNTDtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFzZXRbcHldW3B4XSA9IG9iai5vcHRpb25zLmRhdGFbal1baV07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcHgrKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocHggPiAwKSB7XG4gICAgICAgICAgICAgICAgcHkrKztcbiAgICAgICAgICAgIH1cbiAgICAgICB9XG5cbiAgICAgICByZXR1cm4gZGF0YXNldDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIHdob2xlIHRhYmxlIGRhdGFcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0gaW50ZWdlciByb3cgbnVtYmVyXG4gICAgICogQHJldHVybiBzdHJpbmcgdmFsdWVcbiAgICAgKi9cbiAgICBvYmouZ2V0SnNvbiA9IGZ1bmN0aW9uKGhpZ2hsaWdodGVkKSB7XG4gICAgICAgIC8vIENvbnRyb2wgdmFyc1xuICAgICAgICB2YXIgZGF0YSA9IFtdO1xuXG4gICAgICAgIC8vIENvbHVtbiBhbmQgcm93IGxlbmd0aFxuICAgICAgICB2YXIgeCA9IG9iai5vcHRpb25zLmNvbHVtbnMubGVuZ3RoXG4gICAgICAgIHZhciB5ID0gb2JqLm9wdGlvbnMuZGF0YS5sZW5ndGhcblxuICAgICAgICAvLyBHbyB0aHJvdWdoIHRoZSBjb2x1bW5zIHRvIGdldCB0aGUgZGF0YVxuICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHk7IGorKykge1xuICAgICAgICAgICAgdmFyIHJvdyA9IG51bGw7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHg7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmICghIGhpZ2hsaWdodGVkIHx8IG9iai5yZWNvcmRzW2pdW2ldLmNsYXNzTGlzdC5jb250YWlucygnaGlnaGxpZ2h0JykpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJvdyA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByb3cgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByb3dbb2JqLm9wdGlvbnMuY29sdW1uc1tpXS5uYW1lXSA9IG9iai5vcHRpb25zLmRhdGFbal1baV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocm93ICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBkYXRhLnB1c2gocm93KTtcbiAgICAgICAgICAgIH1cbiAgICAgICB9XG5cbiAgICAgICByZXR1cm4gZGF0YTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgYSByb3cgZGF0YSBieSByb3dOdW1iZXJcbiAgICAgKi9cbiAgICBvYmouZ2V0Um93RGF0YSA9IGZ1bmN0aW9uKHJvd051bWJlcikge1xuICAgICAgICByZXR1cm4gb2JqLm9wdGlvbnMuZGF0YVtyb3dOdW1iZXJdO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldCBhIHJvdyBkYXRhIGJ5IHJvd051bWJlclxuICAgICAqL1xuICAgIG9iai5zZXRSb3dEYXRhID0gZnVuY3Rpb24ocm93TnVtYmVyLCBkYXRhKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2JqLmhlYWRlcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIC8vIFVwZGF0ZSBjZWxsXG4gICAgICAgICAgICB2YXIgY29sdW1uTmFtZSA9IGpleGNlbC5nZXRDb2x1bW5OYW1lRnJvbUlkKFsgaSwgcm93TnVtYmVyIF0pO1xuICAgICAgICAgICAgLy8gU2V0IHZhbHVlXG4gICAgICAgICAgICBpZiAoZGF0YVtpXSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgb2JqLnNldFZhbHVlKGNvbHVtbk5hbWUsIGRhdGFbaV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IGEgY29sdW1uIGRhdGEgYnkgY29sdW1uTnVtYmVyXG4gICAgICovXG4gICAgb2JqLmdldENvbHVtbkRhdGEgPSBmdW5jdGlvbihjb2x1bW5OdW1iZXIpIHtcbiAgICAgICAgdmFyIGRhdGFzZXQgPSBbXTtcbiAgICAgICAgLy8gR28gdGhyb3VnaCB0aGUgcm93cyB0byBnZXQgdGhlIGRhdGFcbiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBvYmoub3B0aW9ucy5kYXRhLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICBkYXRhc2V0LnB1c2gob2JqLm9wdGlvbnMuZGF0YVtqXVtjb2x1bW5OdW1iZXJdKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGF0YXNldDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXQgYSBjb2x1bW4gZGF0YSBieSBjb2xOdW1iZXJcbiAgICAgKi9cbiAgICBvYmouc2V0Q29sdW1uRGF0YSA9IGZ1bmN0aW9uKGNvbE51bWJlciwgZGF0YSkge1xuICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG9iai5yb3dzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAvLyBVcGRhdGUgY2VsbFxuICAgICAgICAgICAgdmFyIGNvbHVtbk5hbWUgPSBqZXhjZWwuZ2V0Q29sdW1uTmFtZUZyb21JZChbIGNvbE51bWJlciwgaiBdKTtcbiAgICAgICAgICAgIC8vIFNldCB2YWx1ZVxuICAgICAgICAgICAgaWYgKGRhdGFbal0gIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIG9iai5zZXRWYWx1ZShjb2x1bW5OYW1lLCBkYXRhW2pdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSByb3dcbiAgICAgKi9cbiAgICBvYmouY3JlYXRlUm93ID0gZnVuY3Rpb24oaiwgZGF0YSkge1xuICAgICAgICAvLyBDcmVhdGUgY29udGFpbmVyXG4gICAgICAgIGlmICghIG9iai5yZWNvcmRzW2pdKSB7XG4gICAgICAgICAgICBvYmoucmVjb3Jkc1tqXSA9IFtdO1xuICAgICAgICB9XG4gICAgICAgIC8vIERlZmF1bHQgZGF0YVxuICAgICAgICBpZiAoISBkYXRhKSB7XG4gICAgICAgICAgICB2YXIgZGF0YSA9IG9iai5vcHRpb25zLmRhdGFbal07XG4gICAgICAgIH1cbiAgICAgICAgLy8gTmV3IGxpbmUgb2YgZGF0YSB0byBiZSBhcHBlbmQgaW4gdGhlIHRhYmxlXG4gICAgICAgIG9iai5yb3dzW2pdID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcbiAgICAgICAgb2JqLnJvd3Nbal0uc2V0QXR0cmlidXRlKCdkYXRhLXknLCBqKTtcbiAgICAgICAgLy8gRGVmaW5pdGlvbnNcbiAgICAgICAgaWYgKG9iai5vcHRpb25zLnJvd3Nbal0pIHtcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5yb3dzW2pdLmhlaWdodCkge1xuICAgICAgICAgICAgICAgIG9iai5yb3dzW2pdLnN0eWxlLmhlaWdodCA9IG9iai5vcHRpb25zLnJvd3Nbal0uaGVpZ2h0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIFJvdyBudW1iZXIgbGFiZWxcbiAgICAgICAgdmFyIHRkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcbiAgICAgICAgdGQuaW5uZXJIVE1MID0gcGFyc2VJbnQoaiArIDEpO1xuICAgICAgICB0ZC5zZXRBdHRyaWJ1dGUoJ2RhdGEteScsIGopO1xuICAgICAgICB0ZC5jbGFzc05hbWUgPSAnamV4Y2VsX3Jvdyc7XG4gICAgICAgIG9iai5yb3dzW2pdLmFwcGVuZENoaWxkKHRkKTtcblxuICAgICAgICAvLyBEYXRhIGNvbHVtbnNcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IG9iai5vcHRpb25zLmNvbHVtbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIC8vIE5ldyBjb2x1bW4gb2YgZGF0YSB0byBiZSBhcHBlbmQgaW4gdGhlIGxpbmVcbiAgICAgICAgICAgIG9iai5yZWNvcmRzW2pdW2ldID0gb2JqLmNyZWF0ZUNlbGwoaSwgaiwgZGF0YVtpXSk7XG4gICAgICAgICAgICAvLyBBZGQgY29sdW1uIHRvIHRoZSByb3dcbiAgICAgICAgICAgIG9iai5yb3dzW2pdLmFwcGVuZENoaWxkKG9iai5yZWNvcmRzW2pdW2ldKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEFkZCByb3cgdG8gdGhlIHRhYmxlIGJvZHlcbiAgICAgICAgcmV0dXJuIG9iai5yb3dzW2pdO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBjZWxsXG4gICAgICovXG4gICAgb2JqLmNyZWF0ZUNlbGwgPSBmdW5jdGlvbihpLCBqLCB2YWx1ZSkge1xuICAgICAgICAvLyBDcmVhdGUgY2VsbCBhbmQgcHJvcGVydGllc1xuICAgICAgICB2YXIgdGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuICAgICAgICB0ZC5zZXRBdHRyaWJ1dGUoJ2RhdGEteCcsIGkpO1xuICAgICAgICB0ZC5zZXRBdHRyaWJ1dGUoJ2RhdGEteScsIGopO1xuICAgICAgICAvLyBIaWRkZW4gY29sdW1uXG4gICAgICAgIGlmIChvYmoub3B0aW9ucy5jb2x1bW5zW2ldLnR5cGUgPT0gJ2hpZGRlbicpIHtcbiAgICAgICAgICAgIHRkLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgICAgICAgICB0ZC5pbm5lckhUTUwgPSB2YWx1ZTtcbiAgICAgICAgfSBlbHNlIGlmIChvYmoub3B0aW9ucy5jb2x1bW5zW2ldLnR5cGUgPT0gJ2NoZWNrYm94JyB8fCBvYmoub3B0aW9ucy5jb2x1bW5zW2ldLnR5cGUgPT0gJ3JhZGlvJykge1xuICAgICAgICAgICAgLy8gQ3JlYXRlIGlucHV0XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gICAgICAgICAgICBlbGVtZW50LnR5cGUgPSBvYmoub3B0aW9ucy5jb2x1bW5zW2ldLnR5cGU7XG4gICAgICAgICAgICBlbGVtZW50Lm5hbWUgPSAnYycgKyBpO1xuICAgICAgICAgICAgZWxlbWVudC5jaGVja2VkID0gKHZhbHVlID09IDEgfHwgdmFsdWUgPT0gdHJ1ZSB8fCB2YWx1ZSA9PSAndHJ1ZScpID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICAgICAgZWxlbWVudC5vbmNsaWNrID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgb2JqLnNldFZhbHVlKHRkLCB0aGlzLmNoZWNrZWQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuY29sdW1uc1tpXS5yZWFkT25seSA9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIEFwcGVuZCB0byB0aGUgdGFibGVcbiAgICAgICAgICAgIHRkLmFwcGVuZENoaWxkKGVsZW1lbnQpO1xuICAgICAgICAgICAgLy8gTWFrZSBzdXJlIHRoZSB2YWx1ZXMgYXJlIGNvcnJlY3RcbiAgICAgICAgICAgIG9iai5vcHRpb25zLmRhdGFbal1baV0gPSBlbGVtZW50LmNoZWNrZWQ7XG4gICAgICAgIH0gZWxzZSBpZiAob2JqLm9wdGlvbnMuY29sdW1uc1tpXS50eXBlID09ICdjYWxlbmRhcicpIHtcbiAgICAgICAgICAgIC8vIFRyeSBmb3JtYXR0ZWQgZGF0ZVxuICAgICAgICAgICAgdmFyIGZvcm1hdHRlZCA9IGpTdWl0ZXMuY2FsZW5kYXIuZXh0cmFjdERhdGVGcm9tU3RyaW5nKHZhbHVlLCBvYmoub3B0aW9ucy5jb2x1bW5zW2ldLm9wdGlvbnMuZm9ybWF0KTtcbiAgICAgICAgICAgIC8vIENyZWF0ZSBjYWxlbmRhciBjZWxsXG4gICAgICAgICAgICB0ZC5pbm5lckhUTUwgPSBqU3VpdGVzLmNhbGVuZGFyLmdldERhdGVTdHJpbmcoZm9ybWF0dGVkID8gZm9ybWF0dGVkIDogdmFsdWUsIG9iai5vcHRpb25zLmNvbHVtbnNbaV0ub3B0aW9ucy5mb3JtYXQpO1xuICAgICAgICB9IGVsc2UgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbaV0udHlwZSA9PSAnZHJvcGRvd24nIHx8IG9iai5vcHRpb25zLmNvbHVtbnNbaV0udHlwZSA9PSAnYXV0b2NvbXBsZXRlJykge1xuICAgICAgICAgICAgLy8gQ3JlYXRlIGRyb3Bkb3duIGNlbGxcbiAgICAgICAgICAgIHRkLmNsYXNzTGlzdC5hZGQoJ2pleGNlbF9kcm9wZG93bicpO1xuICAgICAgICAgICAgdGQuaW5uZXJIVE1MID0gb2JqLmdldERyb3BEb3duVmFsdWUoaSwgdmFsdWUpO1xuICAgICAgICB9IGVsc2UgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbaV0udHlwZSA9PSAnY29sb3InKSB7XG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuY29sdW1uc1tpXS5yZW5kZXIgPT0gJ3NxdWFyZScpIHtcbiAgICAgICAgICAgICAgICB2YXIgY29sb3IgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgICAgICBjb2xvci5jbGFzc05hbWUgPSAnY29sb3InO1xuICAgICAgICAgICAgICAgIGNvbG9yLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIHRkLmFwcGVuZENoaWxkKGNvbG9yKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGQuc3R5bGUuY29sb3IgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICB0ZC5pbm5lckhUTUwgPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChvYmoub3B0aW9ucy5jb2x1bW5zW2ldLnR5cGUgPT0gJ2ltYWdlJykge1xuICAgICAgICAgICAgaWYgKHZhbHVlICYmIHZhbHVlLnN1YnN0cigwLCAxMCkgPT0gJ2RhdGE6aW1hZ2UnKSB7XG4gICAgICAgICAgICAgICAgdmFyIGltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xuICAgICAgICAgICAgICAgIGltZy5zcmMgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICB0ZC5hcHBlbmRDaGlsZChpbWcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKCgnJyt2YWx1ZSkuc3Vic3RyKDAsMSkgPT0gJz0nICYmIG9iai5vcHRpb25zLnBhcnNlRm9ybXVsYXMgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHZhbHVlID0gb2JqLmV4ZWN1dGVGb3JtdWxhKHZhbHVlLCBpLCBqKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbaV0ubWFzaykge1xuICAgICAgICAgICAgICAgIHZhciBkZWNpbWFsID0gb2JqLm9wdGlvbnMuY29sdW1uc1tpXS5kZWNpbWFsIHx8ICcuJztcbiAgICAgICAgICAgICAgICB2YWx1ZSA9ICcnICsgalN1aXRlcy5tYXNrLnJ1bih2YWx1ZSwgb2JqLm9wdGlvbnMuY29sdW1uc1tpXS5tYXNrLCBkZWNpbWFsKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGQuaW5uZXJIVE1MID0gdmFsdWU7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBSZWFkb25seVxuICAgICAgICBpZiAob2JqLm9wdGlvbnMuY29sdW1uc1tpXS5yZWFkT25seSA9PSB0cnVlKSB7XG4gICAgICAgICAgICB0ZC5jbGFzc05hbWUgPSAncmVhZG9ubHknO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVGV4dCBhbGlnblxuICAgICAgICB2YXIgY29sQWxpZ24gPSBvYmoub3B0aW9ucy5jb2x1bW5zW2ldLmFsaWduID8gb2JqLm9wdGlvbnMuY29sdW1uc1tpXS5hbGlnbiA6ICdjZW50ZXInO1xuICAgICAgICB0ZC5zdHlsZS50ZXh0QWxpZ24gPSBjb2xBbGlnbjtcblxuICAgICAgICAvLyBXcmFwIG9wdGlvblxuICAgICAgICBpZiAob2JqLm9wdGlvbnMuY29sdW1uc1tpXS53b3JkV3JhcCAhPSBmYWxzZSAmJiAob2JqLm9wdGlvbnMud29yZFdyYXAgPT0gdHJ1ZSB8fCBvYmoub3B0aW9ucy5jb2x1bW5zW2ldLndvcmRXcmFwID09IHRydWUgfHwgdGQuaW5uZXJIVE1MLmxlbmd0aCA+IDIwMCkpIHtcbiAgICAgICAgICAgIHRkLnN0eWxlLndoaXRlU3BhY2UgPSAncHJlLXdyYXAnO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gT3ZlcmZsb3dcbiAgICAgICAgaWYgKGkgPiAwKSB7XG4gICAgICAgICAgICBpZiAodmFsdWUgfHwgdGQuaW5uZXJIVE1MKSB7XG4gICAgICAgICAgICAgICAgb2JqLnJlY29yZHNbal1baS0xXS5zdHlsZS5vdmVyZmxvdyA9ICdoaWRkZW4nO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoaSA9PSBvYmoub3B0aW9ucy5jb2x1bW5zLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgICAgICAgICAgdGQuc3R5bGUub3ZlcmZsb3cgPSAnaGlkZGVuJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGQ7XG4gICAgfVxuXG4gICAgb2JqLmNyZWF0ZUNlbGxIZWFkZXIgPSBmdW5jdGlvbihjb2xOdW1iZXIpIHtcbiAgICAgICAgLy8gQ3JlYXRlIGNvbCBnbG9iYWwgY29udHJvbFxuICAgICAgICB2YXIgY29sV2lkdGggPSBvYmoub3B0aW9ucy5jb2x1bW5zW2NvbE51bWJlcl0ud2lkdGggPyBvYmoub3B0aW9ucy5jb2x1bW5zW2NvbE51bWJlcl0ud2lkdGggOiBvYmoub3B0aW9ucy5kZWZhdWx0Q29sV2lkdGg7XG4gICAgICAgIHZhciBjb2xBbGlnbiA9IG9iai5vcHRpb25zLmNvbHVtbnNbY29sTnVtYmVyXS5hbGlnbiA/IG9iai5vcHRpb25zLmNvbHVtbnNbY29sTnVtYmVyXS5hbGlnbiA6IG9iai5vcHRpb25zLmRlZmF1bHRDb2xBbGlnbjtcblxuICAgICAgICAvLyBDcmVhdGUgaGVhZGVyIGNlbGxcbiAgICAgICAgb2JqLmhlYWRlcnNbY29sTnVtYmVyXSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgICAgIG9iai5oZWFkZXJzW2NvbE51bWJlcl0uaW5uZXJIVE1MID0gb2JqLm9wdGlvbnMuY29sdW1uc1tjb2xOdW1iZXJdLnRpdGxlID8gb2JqLm9wdGlvbnMuY29sdW1uc1tjb2xOdW1iZXJdLnRpdGxlIDogamV4Y2VsLmdldENvbHVtbk5hbWUoY29sTnVtYmVyKTtcbiAgICAgICAgb2JqLmhlYWRlcnNbY29sTnVtYmVyXS5zZXRBdHRyaWJ1dGUoJ2RhdGEteCcsIGNvbE51bWJlcik7XG4gICAgICAgIG9iai5oZWFkZXJzW2NvbE51bWJlcl0uc3R5bGUudGV4dEFsaWduID0gY29sQWxpZ247XG4gICAgICAgIGlmIChvYmoub3B0aW9ucy5jb2x1bW5zW2NvbE51bWJlcl0udGl0bGUpIHtcbiAgICAgICAgICAgIG9iai5oZWFkZXJzW2NvbE51bWJlcl0uc2V0QXR0cmlidXRlKCd0aXRsZScsIG9iai5vcHRpb25zLmNvbHVtbnNbY29sTnVtYmVyXS50aXRsZSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBXaWR0aCBjb250cm9sXG4gICAgICAgIG9iai5jb2xncm91cFtjb2xOdW1iZXJdID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY29sJyk7XG4gICAgICAgIG9iai5jb2xncm91cFtjb2xOdW1iZXJdLnNldEF0dHJpYnV0ZSgnd2lkdGgnLCBjb2xXaWR0aCk7XG5cbiAgICAgICAgLy8gSGlkZGVuIGNvbHVtblxuICAgICAgICBpZiAob2JqLm9wdGlvbnMuY29sdW1uc1tjb2xOdW1iZXJdLnR5cGUgPT0gJ2hpZGRlbicpIHtcbiAgICAgICAgICAgIG9iai5oZWFkZXJzW2NvbE51bWJlcl0uc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgICAgIG9iai5jb2xncm91cFtjb2xOdW1iZXJdLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBvYmouY3JlYXRlTmVzdGVkSGVhZGVyID0gZnVuY3Rpb24obmVzdGVkSW5mb3JtYXRpb24pIHtcbiAgICAgICAgdmFyIHRyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcbiAgICAgICAgdHIuY2xhc3NMaXN0LmFkZCgnamV4Y2VsX25lc3RlZCcpO1xuICAgICAgICB2YXIgdGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuICAgICAgICB0ci5hcHBlbmRDaGlsZCh0ZCk7XG5cbiAgICAgICAgdmFyIGhlYWRlckluZGV4ID0gMDtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuZXN0ZWRJbmZvcm1hdGlvbi5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgLy8gRGVmYXVsdCB2YWx1ZXNcbiAgICAgICAgICAgIGlmICghIG5lc3RlZEluZm9ybWF0aW9uW2ldLmNvbHNwYW4pIHtcbiAgICAgICAgICAgICAgICBuZXN0ZWRJbmZvcm1hdGlvbltpXS5jb2xzcGFuID0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghIG5lc3RlZEluZm9ybWF0aW9uW2ldLmFsaWduKSB7XG4gICAgICAgICAgICAgICAgbmVzdGVkSW5mb3JtYXRpb25baV0uYWxpZ24gPSAnY2VudGVyJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghIG5lc3RlZEluZm9ybWF0aW9uW2ldLnRpdGxlKSB7XG4gICAgICAgICAgICAgICAgbmVzdGVkSW5mb3JtYXRpb25baV0udGl0bGUgPSAnJztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gTnVtYmVyIG9mIGNvbHVtbnNcbiAgICAgICAgICAgIHZhciBudW1iZXJPZkNvbHVtbnMgPSBuZXN0ZWRJbmZvcm1hdGlvbltpXS5jb2xzcGFuO1xuXG4gICAgICAgICAgICAvLyBDbGFzc2VzIGNvbnRhaW5lclxuICAgICAgICAgICAgdmFyIGNvbHVtbiA9IFtdO1xuICAgICAgICAgICAgLy8gSGVhZGVyIGNsYXNzZXMgZm9yIHRoaXMgY2VsbFxuICAgICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBudW1iZXJPZkNvbHVtbnM7IHgrKykge1xuICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5jb2x1bW5zW2hlYWRlckluZGV4XSAmJiBvYmoub3B0aW9ucy5jb2x1bW5zW2hlYWRlckluZGV4XS50eXBlID09ICdoaWRkZW4nKSB7XG4gICAgICAgICAgICAgICAgICAgIG51bWJlck9mQ29sdW1ucysrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb2x1bW4ucHVzaChoZWFkZXJJbmRleCk7XG4gICAgICAgICAgICAgICAgaGVhZGVySW5kZXgrKztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQ3JlYXRlZCB0aGUgbmVzdGVkIGNlbGxcbiAgICAgICAgICAgIHZhciB0ZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgICAgICAgICB0ZC5zZXRBdHRyaWJ1dGUoJ2RhdGEtY29sdW1uJywgY29sdW1uLmpvaW4oJywnKSk7XG4gICAgICAgICAgICB0ZC5zZXRBdHRyaWJ1dGUoJ2NvbHNwYW4nLCBuZXN0ZWRJbmZvcm1hdGlvbltpXS5jb2xzcGFuKTtcbiAgICAgICAgICAgIHRkLnNldEF0dHJpYnV0ZSgnYWxpZ24nLCBuZXN0ZWRJbmZvcm1hdGlvbltpXS5hbGlnbik7XG4gICAgICAgICAgICB0ZC5pbm5lckhUTUwgPSBuZXN0ZWRJbmZvcm1hdGlvbltpXS50aXRsZTtcbiAgICAgICAgICAgIHRyLmFwcGVuZENoaWxkKHRkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0cjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgdG9vbGJhclxuICAgICAqL1xuICAgIG9iai5jcmVhdGVUb29sYmFyID0gZnVuY3Rpb24odG9vbGJhcikge1xuICAgICAgICBpZiAodG9vbGJhcikge1xuICAgICAgICAgICAgb2JqLm9wdGlvbnMudG9vbGJhciA9IHRvb2xiYXI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgdG9vbGJhciA9IG9iai5vcHRpb25zLnRvb2xiYXI7XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRvb2xiYXIubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmICh0b29sYmFyW2ldLnR5cGUgPT0gJ2knKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRvb2xiYXJJdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaScpO1xuICAgICAgICAgICAgICAgIHRvb2xiYXJJdGVtLmNsYXNzTGlzdC5hZGQoJ2pleGNlbF90b29sYmFyX2l0ZW0nKTtcbiAgICAgICAgICAgICAgICB0b29sYmFySXRlbS5jbGFzc0xpc3QuYWRkKCdtYXRlcmlhbC1pY29ucycpO1xuICAgICAgICAgICAgICAgIHRvb2xiYXJJdGVtLnNldEF0dHJpYnV0ZSgnZGF0YS1rJywgdG9vbGJhcltpXS5rKTtcbiAgICAgICAgICAgICAgICB0b29sYmFySXRlbS5zZXRBdHRyaWJ1dGUoJ2RhdGEtdicsIHRvb2xiYXJbaV0udik7XG4gICAgICAgICAgICAgICAgLy8gVG9vbHRpcFxuICAgICAgICAgICAgICAgIGlmICh0b29sYmFyW2ldLnRvb2x0aXApIHtcbiAgICAgICAgICAgICAgICAgICAgdG9vbGJhckl0ZW0uc2V0QXR0cmlidXRlKCd0aXRsZScsIHRvb2xiYXJbaV0udG9vbHRpcCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIEhhbmRsZSBjbGlja1xuICAgICAgICAgICAgICAgIGlmICh0b29sYmFyW2ldLm9uY2xpY2sgJiYgdHlwZW9mKHRvb2xiYXJbaV0ub25jbGljaykpIHtcbiAgICAgICAgICAgICAgICAgICAgdG9vbGJhckl0ZW0ub25jbGljayA9IHRvb2xiYXJbaV0ub25jbGljaztcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0b29sYmFySXRlbS5vbmNsaWNrID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgayA9IHRoaXMuZ2V0QXR0cmlidXRlKCdkYXRhLWsnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2ID0gdGhpcy5nZXRBdHRyaWJ1dGUoJ2RhdGEtdicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnNldFN0eWxlKG9iai5oaWdobGlnaHRlZCwgaywgdik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gQXBwZW5kIGVsZW1lbnRcbiAgICAgICAgICAgICAgICB0b29sYmFySXRlbS5pbm5lckhUTUwgPSB0b29sYmFyW2ldLmNvbnRlbnQ7XG4gICAgICAgICAgICAgICAgb2JqLnRvb2xiYXIuYXBwZW5kQ2hpbGQodG9vbGJhckl0ZW0pO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0b29sYmFyW2ldLnR5cGUgPT0gJ3NlbGVjdCcpIHtcbiAgICAgICAgICAgICAgIHZhciB0b29sYmFySXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NlbGVjdCcpO1xuICAgICAgICAgICAgICAgdG9vbGJhckl0ZW0uY2xhc3NMaXN0LmFkZCgnamV4Y2VsX3Rvb2xiYXJfaXRlbScpO1xuICAgICAgICAgICAgICAgdG9vbGJhckl0ZW0uc2V0QXR0cmlidXRlKCdkYXRhLWsnLCB0b29sYmFyW2ldLmspO1xuICAgICAgICAgICAgICAgLy8gVG9vbHRpcFxuICAgICAgICAgICAgICAgaWYgKHRvb2xiYXJbaV0udG9vbHRpcCkge1xuICAgICAgICAgICAgICAgICAgIHRvb2xiYXJJdGVtLnNldEF0dHJpYnV0ZSgndGl0bGUnLCB0b29sYmFyW2ldLnRvb2x0aXApO1xuICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgLy8gSGFuZGxlIG9uY2hhbmdlXG4gICAgICAgICAgICAgICBpZiAodG9vbGJhcltpXS5vbmNoYW5nZSAmJiB0eXBlb2YodG9vbGJhcltpXS5vbmNoYW5nZSkpIHtcbiAgICAgICAgICAgICAgICAgICB0b29sYmFySXRlbS5vbmNoYW5nZSA9IHRvb2xiYXJbaV0ub25jaGFuZ2U7XG4gICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgIHRvb2xiYXJJdGVtLm9uY2hhbmdlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgIHZhciBrID0gdGhpcy5nZXRBdHRyaWJ1dGUoJ2RhdGEtaycpO1xuICAgICAgICAgICAgICAgICAgICAgICBvYmouc2V0U3R5bGUob2JqLmhpZ2hsaWdodGVkLCBrLCB0aGlzLnZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAvLyBBZGQgb3B0aW9ucyB0byB0aGUgZHJvcGRvd25cbiAgICAgICAgICAgICAgIGZvcih2YXIgaiA9IDA7IGogPCB0b29sYmFyW2ldLnYubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRvb2xiYXJEcm9wZG93bk9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xuICAgICAgICAgICAgICAgICAgICB0b29sYmFyRHJvcGRvd25PcHRpb24udmFsdWUgPSB0b29sYmFyW2ldLnZbal07XG4gICAgICAgICAgICAgICAgICAgIHRvb2xiYXJEcm9wZG93bk9wdGlvbi5pbm5lckhUTUwgPSB0b29sYmFyW2ldLnZbal07XG4gICAgICAgICAgICAgICAgICAgIHRvb2xiYXJJdGVtLmFwcGVuZENoaWxkKHRvb2xiYXJEcm9wZG93bk9wdGlvbik7XG4gICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICBvYmoudG9vbGJhci5hcHBlbmRDaGlsZCh0b29sYmFySXRlbSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRvb2xiYXJbaV0udHlwZSA9PSAnY29sb3InKSB7XG4gICAgICAgICAgICAgICAgIHZhciB0b29sYmFySXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2knKTtcbiAgICAgICAgICAgICAgICAgdG9vbGJhckl0ZW0uY2xhc3NMaXN0LmFkZCgnamV4Y2VsX3Rvb2xiYXJfaXRlbScpO1xuICAgICAgICAgICAgICAgICB0b29sYmFySXRlbS5jbGFzc0xpc3QuYWRkKCdtYXRlcmlhbC1pY29ucycpO1xuICAgICAgICAgICAgICAgICB0b29sYmFySXRlbS5zZXRBdHRyaWJ1dGUoJ2RhdGEtaycsIHRvb2xiYXJbaV0uayk7XG4gICAgICAgICAgICAgICAgIHRvb2xiYXJJdGVtLnNldEF0dHJpYnV0ZSgnZGF0YS12JywgJycpO1xuICAgICAgICAgICAgICAgICAvLyBUb29sdGlwXG4gICAgICAgICAgICAgICAgIGlmICh0b29sYmFyW2ldLnRvb2x0aXApIHtcbiAgICAgICAgICAgICAgICAgICAgIHRvb2xiYXJJdGVtLnNldEF0dHJpYnV0ZSgndGl0bGUnLCB0b29sYmFyW2ldLnRvb2x0aXApO1xuICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgIG9iai50b29sYmFyLmFwcGVuZENoaWxkKHRvb2xiYXJJdGVtKTtcbiAgICAgICAgICAgICAgICAgdG9vbGJhckl0ZW0ub25jbGljayA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb2xvci5vcGVuKCk7XG4gICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgdG9vbGJhckl0ZW0uaW5uZXJIVE1MID0gdG9vbGJhcltpXS5jb250ZW50O1xuICAgICAgICAgICAgICAgICBqU3VpdGVzLmNvbG9yKHRvb2xiYXJJdGVtLCB7XG4gICAgICAgICAgICAgICAgICAgICBvbmNoYW5nZTpmdW5jdGlvbihvLCB2KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGsgPSBvLmdldEF0dHJpYnV0ZSgnZGF0YS1rJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnNldFN0eWxlKG9iai5oaWdobGlnaHRlZCwgaywgdik7XG4gICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTWVyZ2UgY2VsbHNcbiAgICAgKiBAcGFyYW0gY2VsbE5hbWVcbiAgICAgKiBAcGFyYW0gY29sc3BhblxuICAgICAqIEBwYXJhbSByb3dzcGFuXG4gICAgICogQHBhcmFtIGlnbm9yZUhpc3RvcnlBbmRFdmVudHNcbiAgICAgKi9cbiAgICBvYmouc2V0TWVyZ2UgPSBmdW5jdGlvbihjZWxsTmFtZSwgY29sc3Bhbiwgcm93c3BhbiwgaWdub3JlSGlzdG9yeUFuZEV2ZW50cykge1xuICAgICAgICB2YXIgdGVzdCA9IGZhbHNlO1xuXG4gICAgICAgIGlmICghIGNlbGxOYW1lKSB7XG4gICAgICAgICAgICBpZiAoISBvYmouaGlnaGxpZ2h0ZWQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgYWxlcnQob2JqLm9wdGlvbnMudGV4dC5ub0NlbGxzU2VsZWN0ZWQpO1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgeDEgPSBwYXJzZUludChvYmouaGlnaGxpZ2h0ZWRbMF0uZ2V0QXR0cmlidXRlKCdkYXRhLXgnKSk7XG4gICAgICAgICAgICAgICAgdmFyIHkxID0gcGFyc2VJbnQob2JqLmhpZ2hsaWdodGVkWzBdLmdldEF0dHJpYnV0ZSgnZGF0YS15JykpO1xuICAgICAgICAgICAgICAgIHZhciB4MiA9IHBhcnNlSW50KG9iai5oaWdobGlnaHRlZFtvYmouaGlnaGxpZ2h0ZWQubGVuZ3RoLTFdLmdldEF0dHJpYnV0ZSgnZGF0YS14JykpO1xuICAgICAgICAgICAgICAgIHZhciB5MiA9IHBhcnNlSW50KG9iai5oaWdobGlnaHRlZFtvYmouaGlnaGxpZ2h0ZWQubGVuZ3RoLTFdLmdldEF0dHJpYnV0ZSgnZGF0YS15JykpO1xuICAgICAgICAgICAgICAgIHZhciBjZWxsTmFtZSA9IGpleGNlbC5nZXRDb2x1bW5OYW1lRnJvbUlkKFsgeDEsIHkxIF0pO1xuICAgICAgICAgICAgICAgIHZhciBjb2xzcGFuID0gKHgyIC0geDEpICsgMTtcbiAgICAgICAgICAgICAgICB2YXIgcm93c3BhbiA9ICh5MiAtIHkxKSArIDE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgY2VsbCA9IGpleGNlbC5nZXRJZEZyb21Db2x1bW5OYW1lKGNlbGxOYW1lLCB0cnVlKTtcblxuICAgICAgICBpZiAob2JqLm9wdGlvbnMubWVyZ2VDZWxsc1tjZWxsTmFtZV0pIHtcbiAgICAgICAgICAgIGlmIChvYmoucmVjb3Jkc1tjZWxsWzFdXVtjZWxsWzBdXS5nZXRBdHRyaWJ1dGUoJ2RhdGEtbWVyZ2VkJykpIHtcbiAgICAgICAgICAgICAgICB0ZXN0ID0gb2JqLm9wdGlvbnMudGV4dC5jZWxsQWxyZWFkeU1lcmdlZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICgoISBjb2xzcGFuIHx8IGNvbHNwYW4gPCAyKSAmJiAoISByb3dzcGFuIHx8IHJvd3NwYW4gPCAyKSkge1xuICAgICAgICAgICAgdGVzdCA9IG9iai5vcHRpb25zLnRleHQuaW52YWxpZE1lcmdlUHJvcGVydGllcztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciBjZWxscyA9IFtdO1xuICAgICAgICAgICAgZm9yICh2YXIgaiA9IGNlbGxbMV07IGogPCBjZWxsWzFdICsgcm93c3BhbjsgaisrKSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IGNlbGxbMF07IGkgPCBjZWxsWzBdICsgY29sc3BhbjsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjb2x1bW5OYW1lID0gamV4Y2VsLmdldENvbHVtbk5hbWVGcm9tSWQoW2ksIGpdKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5yZWNvcmRzW2pdW2ldLmdldEF0dHJpYnV0ZSgnZGF0YS1tZXJnZWQnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGVzdCA9IG9iai5vcHRpb25zLnRleHQudGhlcmVJc0FDb25mbGljdFdpdGhBbm90aGVyTWVyZ2VkQ2VsbDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0ZXN0KSB7XG4gICAgICAgICAgICBhbGVydCh0ZXN0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIEFkZCBwcm9wZXJ0eVxuICAgICAgICAgICAgaWYgKGNvbHNwYW4gPiAxKSB7XG4gICAgICAgICAgICAgICAgb2JqLnJlY29yZHNbY2VsbFsxXV1bY2VsbFswXV0uc2V0QXR0cmlidXRlKCdjb2xzcGFuJywgY29sc3Bhbik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbHNwYW4gPSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHJvd3NwYW4gPiAxKSB7XG4gICAgICAgICAgICAgICAgb2JqLnJlY29yZHNbY2VsbFsxXV1bY2VsbFswXV0uc2V0QXR0cmlidXRlKCdyb3dzcGFuJywgcm93c3Bhbik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJvd3NwYW4gPSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gS2VlcCBsaW5rcyB0byB0aGUgZXhpc3Rpbmcgbm9kZXNcbiAgICAgICAgICAgIG9iai5vcHRpb25zLm1lcmdlQ2VsbHNbY2VsbE5hbWVdID0gWyBjb2xzcGFuLCByb3dzcGFuLCBbXSBdO1xuICAgICAgICAgICAgLy8gTWFyayBjZWxsIGFzIG1lcmdlZFxuICAgICAgICAgICAgb2JqLnJlY29yZHNbY2VsbFsxXV1bY2VsbFswXV0uc2V0QXR0cmlidXRlKCdkYXRhLW1lcmdlZCcsICd0cnVlJyk7XG4gICAgICAgICAgICAvLyBPdmVyZmxvd1xuICAgICAgICAgICAgb2JqLnJlY29yZHNbY2VsbFsxXV1bY2VsbFswXV0uc3R5bGUub3ZlcmZsb3cgPSAnaGlkZGVuJztcbiAgICAgICAgICAgIC8vIEhpc3RvcnkgZGF0YVxuICAgICAgICAgICAgdmFyIGRhdGEgPSBbXTtcbiAgICAgICAgICAgIC8vIEFkanVzdCB0aGUgbm9kZXNcbiAgICAgICAgICAgIGZvciAodmFyIHkgPSBjZWxsWzFdOyB5IDwgY2VsbFsxXSArIHJvd3NwYW47IHkrKykge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIHggPSBjZWxsWzBdOyB4IDwgY2VsbFswXSArIGNvbHNwYW47IHgrKykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoISAoY2VsbFswXSA9PSB4ICYmIGNlbGxbMV0gPT0geSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEucHVzaChvYmoub3B0aW9ucy5kYXRhW3ldW3hdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai51cGRhdGVDZWxsKHgsIHksICcnLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLm1lcmdlQ2VsbHNbY2VsbE5hbWVdWzJdLnB1c2gob2JqLnJlY29yZHNbeV1beF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJlY29yZHNbeV1beF0uc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW3ldW3hdID0gb2JqLnJlY29yZHNbY2VsbFsxXV1bY2VsbFswXV07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBJbiB0aGUgaW5pdGlhbGl6YXRpb24gaXMgbm90IG5lY2Vzc2FyeSBrZWVwIHRoZSBoaXN0b3J5XG4gICAgICAgICAgICBvYmoudXBkYXRlU2VsZWN0aW9uKG9iai5yZWNvcmRzW2NlbGxbMV1dW2NlbGxbMF1dKTtcblxuICAgICAgICAgICAgaWYgKCEgaWdub3JlSGlzdG9yeUFuZEV2ZW50cykge1xuICAgICAgICAgICAgICAgIG9iai5zZXRIaXN0b3J5KHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOidzZXRNZXJnZScsXG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbjpjZWxsTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgY29sc3Bhbjpjb2xzcGFuLFxuICAgICAgICAgICAgICAgICAgICByb3dzcGFuOnJvd3NwYW4sXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6ZGF0YSxcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2Yob2JqLm9wdGlvbnMub25tZXJnZSkgPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5vbm1lcmdlKGVsLCBjZWxsTmFtZSwgY29sc3Bhbiwgcm93c3Bhbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTWVyZ2UgY2VsbHNcbiAgICAgKiBAcGFyYW0gY2VsbE5hbWVcbiAgICAgKiBAcGFyYW0gY29sc3BhblxuICAgICAqIEBwYXJhbSByb3dzcGFuXG4gICAgICogQHBhcmFtIGlnbm9yZUhpc3RvcnlBbmRFdmVudHNcbiAgICAgKi9cbiAgICBvYmouZ2V0TWVyZ2UgPSBmdW5jdGlvbihjZWxsTmFtZSkge1xuICAgICAgICB2YXIgZGF0YSA9IHt9O1xuICAgICAgICBpZiAoY2VsbE5hbWUpIHtcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5tZXJnZUNlbGxzW2NlbGxOYW1lXSkge1xuICAgICAgICAgICAgICAgIGRhdGEgPSBbIG9iai5vcHRpb25zLm1lcmdlQ2VsbHNbY2VsbE5hbWVdWzBdLCBvYmoub3B0aW9ucy5tZXJnZUNlbGxzW2NlbGxOYW1lXVsxXSBdO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBkYXRhID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5tZXJnZUNlbGxzKSB7XG4gICAgICAgICAgICAgICAgdmFyIG1lcmdlZENlbGxzID0gb2JqLm9wdGlvbnMubWVyZ2VDZWxscztcbiAgICAgICAgICAgICAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iai5vcHRpb25zLm1lcmdlQ2VsbHMpO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBkYXRhW2tleXNbaV1dID0gWyBvYmoub3B0aW9ucy5tZXJnZUNlbGxzW2tleXNbaV1dWzBdLCBvYmoub3B0aW9ucy5tZXJnZUNlbGxzW2tleXNbaV1dWzFdIF07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlIG1lcmdlIGJ5IGNlbGxuYW1lXG4gICAgICogQHBhcmFtIGNlbGxOYW1lXG4gICAgICovXG4gICAgb2JqLnJlbW92ZU1lcmdlID0gZnVuY3Rpb24oY2VsbE5hbWUsIGRhdGEsIGtlZXBPcHRpb25zKSB7XG4gICAgICAgIGlmIChvYmoub3B0aW9ucy5tZXJnZUNlbGxzW2NlbGxOYW1lXSkge1xuICAgICAgICAgICAgdmFyIGNlbGwgPSBqZXhjZWwuZ2V0SWRGcm9tQ29sdW1uTmFtZShjZWxsTmFtZSwgdHJ1ZSk7XG4gICAgICAgICAgICBvYmoucmVjb3Jkc1tjZWxsWzFdXVtjZWxsWzBdXS5yZW1vdmVBdHRyaWJ1dGUoJ2NvbHNwYW4nKTtcbiAgICAgICAgICAgIG9iai5yZWNvcmRzW2NlbGxbMV1dW2NlbGxbMF1dLnJlbW92ZUF0dHJpYnV0ZSgncm93c3BhbicpO1xuICAgICAgICAgICAgb2JqLnJlY29yZHNbY2VsbFsxXV1bY2VsbFswXV0ucmVtb3ZlQXR0cmlidXRlKCdkYXRhLW1lcmdlZCcpO1xuICAgICAgICAgICAgdmFyIGluZm8gPSBvYmoub3B0aW9ucy5tZXJnZUNlbGxzW2NlbGxOYW1lXTtcblxuICAgICAgICAgICAgdmFyIGluZGV4ID0gMDtcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgaW5mb1sxXTsgaisrKSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbmZvWzBdOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGogPiAwIHx8IGkgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVjb3Jkc1tjZWxsWzFdK2pdW2NlbGxbMF0raV0gPSBpbmZvWzJdW2luZGV4XTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW2NlbGxbMV0ral1bY2VsbFswXStpXS5zdHlsZS5kaXNwbGF5ID0gJyc7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBSZWNvdmVyIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhICYmIGRhdGFbaW5kZXhdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnVwZGF0ZUNlbGwoY2VsbFswXStpLCBjZWxsWzFdK2osIGRhdGFbaW5kZXhdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4Kys7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFVwZGF0ZSBzZWxlY3Rpb25cbiAgICAgICAgICAgIG9iai51cGRhdGVTZWxlY3Rpb24ob2JqLnJlY29yZHNbY2VsbFsxXV1bY2VsbFswXV0sIG9iai5yZWNvcmRzW2NlbGxbMV0rai0xXVtjZWxsWzBdK2ktMV0pO1xuXG4gICAgICAgICAgICBpZiAoISBrZWVwT3B0aW9ucykge1xuICAgICAgICAgICAgICAgIGRlbGV0ZShvYmoub3B0aW9ucy5tZXJnZUNlbGxzW2NlbGxOYW1lXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmUgYWxsIG1lcmdlZCBjZWxsc1xuICAgICAqL1xuICAgIG9iai5kZXN0cm95TWVyZ2VkID0gZnVuY3Rpb24oa2VlcE9wdGlvbnMpIHtcbiAgICAgICAgLy8gUmVtb3ZlIGFueSBtZXJnZWQgY2VsbHNcbiAgICAgICAgaWYgKG9iai5vcHRpb25zLm1lcmdlQ2VsbHMpIHtcbiAgICAgICAgICAgIHZhciBtZXJnZWRDZWxscyA9IG9iai5vcHRpb25zLm1lcmdlQ2VsbHM7XG4gICAgICAgICAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iai5vcHRpb25zLm1lcmdlQ2VsbHMpO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgb2JqLnJlbW92ZU1lcmdlKGtleXNbaV0sIG51bGwsIGtlZXBPcHRpb25zKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIElzIGNvbHVtbiBtZXJnZWRcbiAgICAgKi9cbiAgICBvYmouaXNDb2xNZXJnZWQgPSBmdW5jdGlvbih4LCBpbnNlcnRCZWZvcmUpIHtcbiAgICAgICAgdmFyIGNvbHMgPSBbXTtcbiAgICAgICAgLy8gUmVtb3ZlIGFueSBtZXJnZWQgY2VsbHNcbiAgICAgICAgaWYgKG9iai5vcHRpb25zLm1lcmdlQ2VsbHMpIHtcbiAgICAgICAgICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqLm9wdGlvbnMubWVyZ2VDZWxscyk7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgaW5mbyA9IGpleGNlbC5nZXRJZEZyb21Db2x1bW5OYW1lKGtleXNbaV0sIHRydWUpO1xuICAgICAgICAgICAgICAgIHZhciBjb2xzcGFuID0gb2JqLm9wdGlvbnMubWVyZ2VDZWxsc1trZXlzW2ldXVswXTtcbiAgICAgICAgICAgICAgICB2YXIgeDEgPSBpbmZvWzBdO1xuICAgICAgICAgICAgICAgIHZhciB4MiA9IGluZm9bMF0gKyAoY29sc3BhbiA+IDEgPyBjb2xzcGFuIC0gMSA6IDApO1xuXG4gICAgICAgICAgICAgICAgaWYgKGluc2VydEJlZm9yZSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICgoeDEgPD0geCAmJiB4MiA+PSB4KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29scy5wdXNoKGtleXNbaV0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluc2VydEJlZm9yZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh4MSA8IHggJiYgeDIgPj0geCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xzLnB1c2goa2V5c1tpXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoKHgxIDw9IHggJiYgeDIgPiB4KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHMucHVzaChrZXlzW2ldKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBjb2xzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIElzIHJvd3MgbWVyZ2VkXG4gICAgICovXG4gICAgb2JqLmlzUm93TWVyZ2VkID0gZnVuY3Rpb24oeSwgaW5zZXJ0QmVmb3JlKSB7XG4gICAgICAgIHZhciByb3dzID0gW107XG4gICAgICAgIC8vIFJlbW92ZSBhbnkgbWVyZ2VkIGNlbGxzXG4gICAgICAgIGlmIChvYmoub3B0aW9ucy5tZXJnZUNlbGxzKSB7XG4gICAgICAgICAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iai5vcHRpb25zLm1lcmdlQ2VsbHMpO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIGluZm8gPSBqZXhjZWwuZ2V0SWRGcm9tQ29sdW1uTmFtZShrZXlzW2ldLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB2YXIgcm93c3BhbiA9IG9iai5vcHRpb25zLm1lcmdlQ2VsbHNba2V5c1tpXV1bMV07XG4gICAgICAgICAgICAgICAgdmFyIHkxID0gaW5mb1sxXTtcbiAgICAgICAgICAgICAgICB2YXIgeTIgPSBpbmZvWzFdICsgKHJvd3NwYW4gPiAxID8gcm93c3BhbiAtIDEgOiAwKTtcblxuICAgICAgICAgICAgICAgIGlmIChpbnNlcnRCZWZvcmUgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoKHkxIDw9IHkgJiYgeTIgPj0geSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvd3MucHVzaChrZXlzW2ldKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpbnNlcnRCZWZvcmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoeTEgPCB5ICYmIHkyID49IHkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93cy5wdXNoKGtleXNbaV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh5MSA8PSB5ICYmIHkyID4geSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3dzLnB1c2goa2V5c1tpXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcm93cztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPcGVuIHRoZSBlZGl0b3JcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0gb2JqZWN0IGNlbGxcbiAgICAgKiBAcmV0dXJuIHZvaWRcbiAgICAgKi9cbiAgICBvYmoub3BlbkVkaXRvciA9IGZ1bmN0aW9uKGNlbGwsIGVtcHR5LCBlKSB7XG4gICAgICAgIC8vIEdldCBjZWxsIHBvc2l0aW9uXG4gICAgICAgIHZhciB5ID0gY2VsbC5nZXRBdHRyaWJ1dGUoJ2RhdGEteScpO1xuICAgICAgICB2YXIgeCA9IGNlbGwuZ2V0QXR0cmlidXRlKCdkYXRhLXgnKTtcblxuICAgICAgICAvLyBPbiBlZGl0aW9uIHN0YXJ0XG4gICAgICAgIGlmICghIG9iai5pZ25vcmVFdmVudHMpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2Yob2JqLm9wdGlvbnMub25lZGl0aW9uc3RhcnQpID09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5vbmVkaXRpb25zdGFydChlbCwgY2VsbCwgeCwgeSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBPdmVyZmxvd1xuICAgICAgICBpZiAoeCA+IDApIHtcbiAgICAgICAgICAgIG9iai5yZWNvcmRzW3ldW3gtMV0uc3R5bGUub3ZlcmZsb3cgPSAnaGlkZGVuJztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENyZWF0ZSBlZGl0b3JcbiAgICAgICAgdmFyIGNyZWF0ZUVkaXRvciA9IGZ1bmN0aW9uKHR5cGUpIHtcbiAgICAgICAgICAgIC8vIENlbGwgaW5mb3JtYXRpb25cbiAgICAgICAgICAgIHZhciBpbmZvID0gY2VsbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAgICAgICAgICAgLy8gQ3JlYXRlIGRyb3Bkb3duXG4gICAgICAgICAgICB2YXIgZWRpdG9yID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0eXBlKTtcbiAgICAgICAgICAgIGVkaXRvci5zdHlsZS53aWR0aCA9IChpbmZvLndpZHRoKSArICdweCc7XG4gICAgICAgICAgICBlZGl0b3Iuc3R5bGUuaGVpZ2h0ID0gKGluZm8uaGVpZ2h0IC0gMikgKyAncHgnO1xuICAgICAgICAgICAgZWRpdG9yLnN0eWxlLm1pbkhlaWdodCA9IChpbmZvLmhlaWdodCAtIDIpICsgJ3B4JztcblxuICAgICAgICAgICAgLy8gRWRpdCBjZWxsXG4gICAgICAgICAgICBjZWxsLmNsYXNzTGlzdC5hZGQoJ2VkaXRvcicpO1xuICAgICAgICAgICAgY2VsbC5pbm5lckhUTUwgPSAnJztcbiAgICAgICAgICAgIGNlbGwuYXBwZW5kQ2hpbGQoZWRpdG9yKTtcblxuICAgICAgICAgICAgcmV0dXJuIGVkaXRvcjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFJlYWRvbmx5XG4gICAgICAgIGlmIChjZWxsLmNsYXNzTGlzdC5jb250YWlucygncmVhZG9ubHknKSA9PSB0cnVlKSB7XG4gICAgICAgICAgICAvLyBEbyBub3RoaW5nXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBIb2xkZXJcbiAgICAgICAgICAgIG9iai5lZGl0aW9uID0gWyBvYmoucmVjb3Jkc1t5XVt4XSwgb2JqLnJlY29yZHNbeV1beF0uaW5uZXJIVE1MLCB4LCB5IF07XG5cbiAgICAgICAgICAgIC8vIElmIHRoZXJlIGlzIGEgY3VzdG9tIGVkaXRvciBmb3IgaXRcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5jb2x1bW5zW3hdLmVkaXRvcikge1xuICAgICAgICAgICAgICAgIC8vIEN1c3RvbSBlZGl0b3JzXG4gICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMuY29sdW1uc1t4XS5lZGl0b3Iub3BlbkVkaXRvcihjZWxsLCBlbCwgZW1wdHksIGUpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBOYXRpdmUgZnVuY3Rpb25zXG4gICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbeF0udHlwZSA9PSAnaGlkZGVuJykge1xuICAgICAgICAgICAgICAgICAgICAvLyBEbyBub3RoaW5nXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvYmoub3B0aW9ucy5jb2x1bW5zW3hdLnR5cGUgPT0gJ2NoZWNrYm94JyB8fCBvYmoub3B0aW9ucy5jb2x1bW5zW3hdLnR5cGUgPT0gJ3JhZGlvJykge1xuICAgICAgICAgICAgICAgICAgICAvLyBHZXQgdmFsdWVcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gY2VsbC5jaGlsZHJlblswXS5jaGVja2VkID8gZmFsc2UgOiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAvLyBUb29nbGUgdmFsdWVcbiAgICAgICAgICAgICAgICAgICAgb2JqLnNldFZhbHVlKGNlbGwsIHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gRG8gbm90IGtlZXAgZWRpdGlvbiBvcGVuXG4gICAgICAgICAgICAgICAgICAgIG9iai5lZGl0aW9uID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbeF0udHlwZSA9PSAnZHJvcGRvd24nIHx8IG9iai5vcHRpb25zLmNvbHVtbnNbeF0udHlwZSA9PSAnYXV0b2NvbXBsZXRlJykge1xuICAgICAgICAgICAgICAgICAgICAvLyBHZXQgY3VycmVudCB2YWx1ZVxuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBvYmoub3B0aW9ucy5kYXRhW3ldW3hdO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBkcm9wZG93blxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mKG9iai5vcHRpb25zLmNvbHVtbnNbeF0uZmlsdGVyKSA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc291cmNlID0gb2JqLm9wdGlvbnMuY29sdW1uc1t4XS5maWx0ZXIoZWwsIGNlbGwsIHgsIHksIG9iai5vcHRpb25zLmNvbHVtbnNbeF0uc291cmNlKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzb3VyY2UgPSBvYmoub3B0aW9ucy5jb2x1bW5zW3hdLnNvdXJjZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBlZGl0b3JcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVkaXRvciA9IGNyZWF0ZUVkaXRvcignZGl2Jyk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogc291cmNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgbXVsdGlwbGU6IG9iai5vcHRpb25zLmNvbHVtbnNbeF0ubXVsdGlwbGUgPyB0cnVlIDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBhdXRvY29tcGxldGU6IG9iai5vcHRpb25zLmNvbHVtbnNbeF0uYXV0b2NvbXBsZXRlIHx8IG9iai5vcHRpb25zLmNvbHVtbnNbeF0udHlwZSA9PSAnYXV0b2NvbXBsZXRlJyA/IHRydWUgOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5lZDp0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IG9iai5vcHRpb25zLmNvbHVtbnNbeF0ubXVsdGlwbGUgPyB2YWx1ZS5zcGxpdCgnOycpIDogdmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDonMTAwJScsXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6ZWRpdG9yLnN0eWxlLm1pbkhlaWdodCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAob2JqLm9wdGlvbnMudGFibGVPdmVyZmxvdyA9PSB0cnVlIHx8IG9iai5vcHRpb25zLmZ1bGxzY3JlZW4gPT0gdHJ1ZSkgPyB0cnVlIDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBvbmNsb3NlOmZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5jbG9zZUVkaXRvcihjZWxsLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbeF0ub3B0aW9ucyAmJiBvYmoub3B0aW9ucy5jb2x1bW5zW3hdLm9wdGlvbnMudHlwZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy50eXBlID0gb2JqLm9wdGlvbnMuY29sdW1uc1t4XS5vcHRpb25zLnR5cGU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgalN1aXRlcy5kcm9wZG93bihlZGl0b3IsIG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob2JqLm9wdGlvbnMuY29sdW1uc1t4XS50eXBlID09ICdjYWxlbmRhcicgfHwgb2JqLm9wdGlvbnMuY29sdW1uc1t4XS50eXBlID09ICdjb2xvcicpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVmFsdWVcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gb2JqLm9wdGlvbnMuZGF0YVt5XVt4XTtcbiAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGVkaXRvclxuICAgICAgICAgICAgICAgICAgICB2YXIgZWRpdG9yID0gY3JlYXRlRWRpdG9yKCdpbnB1dCcpO1xuICAgICAgICAgICAgICAgICAgICBlZGl0b3IudmFsdWUgPSB2YWx1ZTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMudGFibGVPdmVyZmxvdyA9PSB0cnVlIHx8IG9iai5vcHRpb25zLmZ1bGxzY3JlZW4gPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMuY29sdW1uc1t4XS5vcHRpb25zLnBvc2l0aW9uID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5jb2x1bW5zW3hdLm9wdGlvbnMudmFsdWUgPSBvYmoub3B0aW9ucy5kYXRhW3ldW3hdO1xuICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5jb2x1bW5zW3hdLm9wdGlvbnMub3BlbmVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMuY29sdW1uc1t4XS5vcHRpb25zLm9uY2xvc2UgPSBmdW5jdGlvbihlbCwgdmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5jbG9zZUVkaXRvcihjZWxsLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyBDdXJyZW50IHZhbHVlXG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5jb2x1bW5zW3hdLnR5cGUgPT0gJ2NvbG9yJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgalN1aXRlcy5jb2xvcihlZGl0b3IsIG9iai5vcHRpb25zLmNvbHVtbnNbeF0ub3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2FsZW5kYXIgPSBqU3VpdGVzLmNhbGVuZGFyKGVkaXRvciwgb2JqLm9wdGlvbnMuY29sdW1uc1t4XS5vcHRpb25zKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGVuZGFyLnNldFZhbHVlKHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyBGb2N1cyBvbiBlZGl0b3JcbiAgICAgICAgICAgICAgICAgICAgZWRpdG9yLmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvYmoub3B0aW9ucy5jb2x1bW5zW3hdLnR5cGUgPT0gJ2ltYWdlJykge1xuICAgICAgICAgICAgICAgICAgICAvLyBWYWx1ZVxuICAgICAgICAgICAgICAgICAgICB2YXIgaW1nID0gY2VsbC5jaGlsZHJlblswXTtcbiAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGVkaXRvclxuICAgICAgICAgICAgICAgICAgICB2YXIgZWRpdG9yID0gY3JlYXRlRWRpdG9yKCdkaXYnKTtcbiAgICAgICAgICAgICAgICAgICAgZWRpdG9yLnN0eWxlLnBvc2l0aW9uID0gJ3JlbGF0aXZlJztcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgICAgICAgICBkaXYuY2xhc3NMaXN0LmFkZCgnamNsb3NlJyk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpbWcgJiYgaW1nLnNyYykge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGl2LmFwcGVuZENoaWxkKGltZyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWRpdG9yLmFwcGVuZENoaWxkKGRpdik7XG4gICAgICAgICAgICAgICAgICAgIGpTdWl0ZXMuaW1hZ2UoZGl2LCBvYmoub3B0aW9ucy5pbWFnZU9wdGlvbnMpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCByZWN0ID0gY2VsbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVjdENvbnRlbnQgPSBkaXYuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuaW5uZXJIZWlnaHQgPCByZWN0LmJvdHRvbSArIHJlY3RDb250ZW50LmhlaWdodCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGl2LnN0eWxlLnRvcCA9IChyZWN0LnRvcCAtIChyZWN0Q29udGVudC5oZWlnaHQgKyAyKSkgKyAncHgnO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGl2LnN0eWxlLnRvcCA9IChyZWN0LnRvcCkgKyAncHgnO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVmFsdWVcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gZW1wdHkgPT0gdHJ1ZSA/ICcnIDogb2JqLm9wdGlvbnMuZGF0YVt5XVt4XTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBCYXNpYyBlZGl0b3JcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbeF0ud29yZFdyYXAgIT0gZmFsc2UgJiYgKG9iai5vcHRpb25zLndvcmRXcmFwID09IHRydWUgfHwgb2JqLm9wdGlvbnMuY29sdW1uc1t4XS53b3JkV3JhcCA9PSB0cnVlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVkaXRvciA9IGNyZWF0ZUVkaXRvcigndGV4dGFyZWEnKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlZGl0b3IgPSBjcmVhdGVFZGl0b3IoJ2lucHV0Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBNYXNrXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuY29sdW1uc1t4XS5tYXNrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdG9yLnNldEF0dHJpYnV0ZSgnZGF0YS1tYXNrJywgb2JqLm9wdGlvbnMuY29sdW1uc1t4XS5tYXNrKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGVkaXRvci52YWx1ZSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBlZGl0b3Iub25ibHVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouY2xvc2VFZGl0b3IoY2VsbCwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIGVkaXRvci5mb2N1cygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENsb3NlIHRoZSBlZGl0b3IgYW5kIHNhdmUgdGhlIGluZm9ybWF0aW9uXG4gICAgICogXG4gICAgICogQHBhcmFtIG9iamVjdCBjZWxsXG4gICAgICogQHBhcmFtIGJvb2xlYW4gc2F2ZVxuICAgICAqIEByZXR1cm4gdm9pZFxuICAgICAqL1xuICAgIG9iai5jbG9zZUVkaXRvciA9IGZ1bmN0aW9uKGNlbGwsIHNhdmUpIHtcbiAgICAgICAgdmFyIHggPSBwYXJzZUludChjZWxsLmdldEF0dHJpYnV0ZSgnZGF0YS14JykpO1xuICAgICAgICB2YXIgeSA9IHBhcnNlSW50KGNlbGwuZ2V0QXR0cmlidXRlKCdkYXRhLXknKSk7XG5cbiAgICAgICAgLy8gR2V0IGNlbGwgcHJvcGVydGllc1xuICAgICAgICBpZiAoc2F2ZSA9PSB0cnVlKSB7XG4gICAgICAgICAgICAvLyBJZiBjdXN0b20gZWRpdG9yXG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuY29sdW1uc1t4XS5lZGl0b3IpIHtcbiAgICAgICAgICAgICAgICAvLyBDdXN0b20gZWRpdG9yXG4gICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gb2JqLm9wdGlvbnMuY29sdW1uc1t4XS5lZGl0b3IuY2xvc2VFZGl0b3IoY2VsbCwgc2F2ZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIE5hdGl2ZSBmdW5jdGlvbnNcbiAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuY29sdW1uc1t4XS50eXBlID09ICdjaGVja2JveCcgfHwgb2JqLm9wdGlvbnMuY29sdW1uc1t4XS50eXBlID09ICdyYWRpbycgfHwgb2JqLm9wdGlvbnMuY29sdW1uc1t4XS50eXBlID09ICdoaWRkZW4nKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIERvIG5vdGhpbmdcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbeF0udHlwZSA9PSAnZHJvcGRvd24nIHx8IG9iai5vcHRpb25zLmNvbHVtbnNbeF0udHlwZSA9PSAnYXV0b2NvbXBsZXRlJykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBjZWxsLmNoaWxkcmVuWzBdLmRyb3Bkb3duLmNsb3NlKHRydWUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob2JqLm9wdGlvbnMuY29sdW1uc1t4XS50eXBlID09ICdjYWxlbmRhcicpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gY2VsbC5jaGlsZHJlblswXS5jYWxlbmRhci5jbG9zZSh0cnVlKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbeF0udHlwZSA9PSAnY29sb3InKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IGNlbGwuY2hpbGRyZW5bMV0uY29sb3IuY2xvc2UodHJ1ZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvYmoub3B0aW9ucy5jb2x1bW5zW3hdLnR5cGUgPT0gJ2ltYWdlJykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaW1nID0gY2VsbC5jaGlsZHJlblswXS5jaGlsZHJlblswXS5jaGlsZHJlblswXTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gaW1nICYmIGltZy50YWdOYW1lID09ICdJTUcnID8gaW1nLnNyYyA6ICcnO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob2JqLm9wdGlvbnMuY29sdW1uc1t4XS50eXBlID09ICdudW1lcmljJykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBjZWxsLmNoaWxkcmVuWzBdLnZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUuc3Vic3RyKDAsMSkgIT0gJz0nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IG9iai5vcHRpb25zLmNvbHVtbnNbeF0uYWxsb3dFbXB0eSA/ICcnIDogMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjZWxsLmNoaWxkcmVuWzBdLm9uYmx1ciA9IG51bGw7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gY2VsbC5jaGlsZHJlblswXS52YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgY2VsbC5jaGlsZHJlblswXS5vbmJsdXIgPSBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gSWdub3JlIGNoYW5nZXMgaWYgdGhlIHZhbHVlIGlzIHRoZSBzYW1lXG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuZGF0YVt5XVt4XSA9PSB2YWx1ZSkge1xuICAgICAgICAgICAgICAgIGNlbGwuaW5uZXJIVE1MID0gb2JqLmVkaXRpb25bMV07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG9iai5zZXRWYWx1ZShjZWxsLCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuY29sdW1uc1t4XS5lZGl0b3IpIHtcbiAgICAgICAgICAgICAgICAvLyBDdXN0b20gZWRpdG9yXG4gICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMuY29sdW1uc1t4XS5lZGl0b3IuY2xvc2VFZGl0b3IoY2VsbCwgc2F2ZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5jb2x1bW5zW3hdLnR5cGUgPT0gJ2Ryb3Bkb3duJyB8fCBvYmoub3B0aW9ucy5jb2x1bW5zW3hdLnR5cGUgPT0gJ2F1dG9jb21wbGV0ZScpIHtcbiAgICAgICAgICAgICAgICAgICAgY2VsbC5jaGlsZHJlblswXS5kcm9wZG93bi5jbG9zZSh0cnVlKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbeF0udHlwZSA9PSAnY2FsZW5kYXInKSB7XG4gICAgICAgICAgICAgICAgICAgIGNlbGwuY2hpbGRyZW5bMF0uY2FsZW5kYXIuY2xvc2UodHJ1ZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvYmoub3B0aW9ucy5jb2x1bW5zW3hdLnR5cGUgPT0gJ2NvbG9yJykge1xuICAgICAgICAgICAgICAgICAgICBjZWxsLmNoaWxkcmVuWzFdLmNvbG9yLmNsb3NlKHRydWUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNlbGwuY2hpbGRyZW5bMF0ub25ibHVyID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFJlc3RvcmUgdmFsdWVcbiAgICAgICAgICAgIGNlbGwuaW5uZXJIVE1MID0gb2JqLmVkaXRpb24gJiYgb2JqLmVkaXRpb25bMV0gPyBvYmouZWRpdGlvblsxXSA6ICcnO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gT24gZWRpdGlvbiBlbmRcbiAgICAgICAgaWYgKCEgb2JqLmlnbm9yZUV2ZW50cykge1xuICAgICAgICAgICAgaWYgKHR5cGVvZihvYmoub3B0aW9ucy5vbmVkaXRpb25lbmQpID09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5vbmVkaXRpb25lbmQoZWwsIGNlbGwsIHgsIHksIHZhbHVlLCBzYXZlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFJlbW92ZSBlZGl0b3IgY2xhc3NcbiAgICAgICAgY2VsbC5jbGFzc0xpc3QucmVtb3ZlKCdlZGl0b3InKTtcblxuICAgICAgICAvLyBGaW5pc2ggZWRpdGlvblxuICAgICAgICBvYmouZWRpdGlvbiA9IG51bGw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IHRoZSBjZWxsIG9iamVjdFxuICAgICAqIFxuICAgICAqIEBwYXJhbSBvYmplY3QgY2VsbFxuICAgICAqIEByZXR1cm4gc3RyaW5nIHZhbHVlXG4gICAgICovXG4gICAgb2JqLmdldENlbGwgPSBmdW5jdGlvbihjZWxsKSB7XG4gICAgICAgIC8vIENvbnZlcnQgaW4gY2FzZSBuYW1lIGlzIGV4Y2VsIGxpa2VkIGV4LiBBMTAsIEJCOTJcbiAgICAgICAgY2VsbCA9IGpleGNlbC5nZXRJZEZyb21Db2x1bW5OYW1lKGNlbGwsIHRydWUpO1xuICAgICAgICB2YXIgeCA9IGNlbGxbMF07XG4gICAgICAgIHZhciB5ID0gY2VsbFsxXTtcblxuICAgICAgICByZXR1cm4gb2JqLnJlY29yZHNbeV1beF07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IHRoZSBjZWxsIG9iamVjdCBmcm9tIGNvb3Jkc1xuICAgICAqIFxuICAgICAqIEBwYXJhbSBvYmplY3QgY2VsbFxuICAgICAqIEByZXR1cm4gc3RyaW5nIHZhbHVlXG4gICAgICovXG4gICAgb2JqLmdldENlbGxGcm9tQ29vcmRzID0gZnVuY3Rpb24oeCwgeSkge1xuICAgICAgICByZXR1cm4gb2JqLnJlY29yZHNbeV1beF07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IGxhYmVsXG4gICAgICogXG4gICAgICogQHBhcmFtIG9iamVjdCBjZWxsXG4gICAgICogQHJldHVybiBzdHJpbmcgdmFsdWVcbiAgICAgKi9cbiAgICBvYmouZ2V0TGFiZWwgPSBmdW5jdGlvbihjZWxsKSB7XG4gICAgICAgIC8vIENvbnZlcnQgaW4gY2FzZSBuYW1lIGlzIGV4Y2VsIGxpa2VkIGV4LiBBMTAsIEJCOTJcbiAgICAgICAgY2VsbCA9IGpleGNlbC5nZXRJZEZyb21Db2x1bW5OYW1lKGNlbGwsIHRydWUpO1xuICAgICAgICB2YXIgeCA9IGNlbGxbMF07XG4gICAgICAgIHZhciB5ID0gY2VsbFsxXTtcblxuICAgICAgICByZXR1cm4gb2JqLnJlY29yZHNbeV1beF0uaW5uZXJIVE1MO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBsYWJlbGZyb20gY29vcmRzXG4gICAgICogXG4gICAgICogQHBhcmFtIG9iamVjdCBjZWxsXG4gICAgICogQHJldHVybiBzdHJpbmcgdmFsdWVcbiAgICAgKi9cbiAgICBvYmouZ2V0TGFiZWxGcm9tQ29vcmRzID0gZnVuY3Rpb24oeCwgeSkge1xuICAgICAgICByZXR1cm4gb2JqLnJlY29yZHNbeV1beF0uaW5uZXJIVE1MO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgdmFsdWUgZnJvbSBhIGNlbGxcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0gb2JqZWN0IGNlbGxcbiAgICAgKiBAcmV0dXJuIHN0cmluZyB2YWx1ZVxuICAgICAqL1xuICAgIG9iai5nZXRWYWx1ZSA9IGZ1bmN0aW9uKGNlbGwsIHByb2Nlc3NlZFZhbHVlKSB7XG4gICAgICAgIGlmICh0eXBlb2YoY2VsbCkgPT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgIHZhciB4ID0gY2VsbC5nZXRBdHRyaWJ1dGUoJ2RhdGEteCcpO1xuICAgICAgICAgICAgdmFyIHkgPSBjZWxsLmdldEF0dHJpYnV0ZSgnZGF0YS15Jyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjZWxsID0gamV4Y2VsLmdldElkRnJvbUNvbHVtbk5hbWUoY2VsbCwgdHJ1ZSk7XG4gICAgICAgICAgICB2YXIgeCA9IGNlbGxbMF07XG4gICAgICAgICAgICB2YXIgeSA9IGNlbGxbMV07XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgdmFsdWUgPSBudWxsO1xuXG4gICAgICAgIGlmICh4ICE9IG51bGwgJiYgeSAhPSBudWxsKSB7XG4gICAgICAgICAgICBpZiAob2JqLnJlY29yZHNbeV0gJiYgb2JqLnJlY29yZHNbeV1beF0gJiYgKHByb2Nlc3NlZFZhbHVlIHx8IG9iai5vcHRpb25zLmNvcHlDb21wYXRpYmlsaXR5ID09IHRydWUpKSB7XG4gICAgICAgICAgICAgICAgdmFsdWUgPSBvYmoucmVjb3Jkc1t5XVt4XS5pbm5lckhUTUw7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5kYXRhW3ldICYmIG9iai5vcHRpb25zLmRhdGFbeV1beF0gIT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBvYmoub3B0aW9ucy5kYXRhW3ldW3hdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIHZhbHVlIGZyb20gYSBjb29yZHNcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0gaW50IHhcbiAgICAgKiBAcGFyYW0gaW50IHlcbiAgICAgKiBAcmV0dXJuIHN0cmluZyB2YWx1ZVxuICAgICAqL1xuICAgIG9iai5nZXRWYWx1ZUZyb21Db29yZHMgPSBmdW5jdGlvbih4LCB5LCBwcm9jZXNzZWRWYWx1ZSkge1xuICAgICAgICB2YXIgdmFsdWUgPSBudWxsO1xuXG4gICAgICAgIGlmICh4ICE9IG51bGwgJiYgeSAhPSBudWxsKSB7XG4gICAgICAgICAgICBpZiAoKG9iai5yZWNvcmRzW3ldICYmIG9iai5yZWNvcmRzW3ldW3hdKSAmJiBwcm9jZXNzZWRWYWx1ZSB8fCBvYmoub3B0aW9ucy5jb3B5Q29tcGF0aWJpbGl0eSA9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgdmFsdWUgPSBvYmoucmVjb3Jkc1t5XVt4XS5pbm5lckhUTUw7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5kYXRhW3ldICYmIG9iai5vcHRpb25zLmRhdGFbeV1beF0gIT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBvYmoub3B0aW9ucy5kYXRhW3ldW3hdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXQgYSBjZWxsIHZhbHVlXG4gICAgICogXG4gICAgICogQHBhcmFtIG1peGVkIGNlbGwgZGVzdGluYXRpb24gY2VsbFxuICAgICAqIEBwYXJhbSBzdHJpbmcgdmFsdWUgdmFsdWVcbiAgICAgKiBAcmV0dXJuIHZvaWRcbiAgICAgKi9cbiAgICBvYmouc2V0VmFsdWUgPSBmdW5jdGlvbihjZWxsLCB2YWx1ZSwgZm9yY2UpIHtcbiAgICAgICAgdmFyIHJlY29yZHMgPSBbXTtcblxuICAgICAgICBpZiAodHlwZW9mKGNlbGwpID09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICB2YXIgY29sdW1uSWQgPSBqZXhjZWwuZ2V0SWRGcm9tQ29sdW1uTmFtZShjZWxsLCB0cnVlKTtcbiAgICAgICAgICAgIHZhciB4ID0gY29sdW1uSWRbMF07XG4gICAgICAgICAgICB2YXIgeSA9IGNvbHVtbklkWzFdO1xuXG4gICAgICAgICAgICAvLyBVcGRhdGUgY2VsbFxuICAgICAgICAgICAgcmVjb3Jkcy5wdXNoKG9iai51cGRhdGVDZWxsKHgsIHksIHZhbHVlLCBmb3JjZSkpO1xuXG4gICAgICAgICAgICAvLyBVcGRhdGUgYWxsIGZvcm11bGFzIGluIHRoZSBjaGFpblxuICAgICAgICAgICAgb2JqLnVwZGF0ZUZvcm11bGFDaGFpbih4LCB5LCByZWNvcmRzKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciB4ID0gbnVsbDtcbiAgICAgICAgICAgIHZhciB5ID0gbnVsbDtcbiAgICAgICAgICAgIGlmIChjZWxsICYmIGNlbGwuZ2V0QXR0cmlidXRlKSB7XG4gICAgICAgICAgICAgICAgdmFyIHggPSBjZWxsLmdldEF0dHJpYnV0ZSgnZGF0YS14Jyk7XG4gICAgICAgICAgICAgICAgdmFyIHkgPSBjZWxsLmdldEF0dHJpYnV0ZSgnZGF0YS15Jyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFVwZGF0ZSBjZWxsXG4gICAgICAgICAgICBpZiAoeCAhPSBudWxsICYmIHkgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHJlY29yZHMucHVzaChvYmoudXBkYXRlQ2VsbCh4LCB5LCB2YWx1ZSwgZm9yY2UpKTtcblxuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBhbGwgZm9ybXVsYXMgaW4gdGhlIGNoYWluXG4gICAgICAgICAgICAgICAgb2JqLnVwZGF0ZUZvcm11bGFDaGFpbih4LCB5LCByZWNvcmRzKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhjZWxsKTtcbiAgICAgICAgICAgICAgICBpZiAoa2V5cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZihjZWxsW2ldKSA9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb2x1bW5JZCA9IGpleGNlbC5nZXRJZEZyb21Db2x1bW5OYW1lKGNlbGxbaV0sIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB4ID0gY29sdW1uSWRbMF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHkgPSBjb2x1bW5JZFsxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHggPSBjZWxsW2ldLmdldEF0dHJpYnV0ZSgnZGF0YS14Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHkgPSBjZWxsW2ldLmdldEF0dHJpYnV0ZSgnZGF0YS15Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgY2VsbFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHggIT0gbnVsbCAmJiB5ICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWNvcmRzLnB1c2gob2JqLnVwZGF0ZUNlbGwoeCwgeSwgdmFsdWUsIGZvcmNlKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgYWxsIGZvcm11bGFzIGluIHRoZSBjaGFpblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai51cGRhdGVGb3JtdWxhQ2hhaW4oeCwgeSwgcmVjb3Jkcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBVcGRhdGUgaGlzdG9yeVxuICAgICAgICBvYmouc2V0SGlzdG9yeSh7XG4gICAgICAgICAgICBhY3Rpb246J3NldFZhbHVlJyxcbiAgICAgICAgICAgIHJlY29yZHM6cmVjb3JkcyxcbiAgICAgICAgICAgIHNlbGVjdGlvbjpvYmouc2VsZWN0ZWRDZWxsLFxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBVcGRhdGUgdGFibGUgd2l0aCBjdXN0b20gY29uZmlndXJhdGlvbnMgaWYgYXBwbGljYWJsZVxuICAgICAgICBvYmoudXBkYXRlVGFibGUoKTtcblxuICAgICAgICAvLyBPbiBhZnRlciBjaGFuZ2VzXG4gICAgICAgIG9iai5vbmFmdGVyY2hhbmdlcyhlbCwgcmVjb3Jkcyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0IGEgY2VsbCB2YWx1ZSBiYXNlZCBvbiBjb29yZGluYXRlc1xuICAgICAqIFxuICAgICAqIEBwYXJhbSBpbnQgeCBkZXN0aW5hdGlvbiBjZWxsXG4gICAgICogQHBhcmFtIGludCB5IGRlc3RpbmF0aW9uIGNlbGxcbiAgICAgKiBAcGFyYW0gc3RyaW5nIHZhbHVlXG4gICAgICogQHJldHVybiB2b2lkXG4gICAgICovXG4gICAgb2JqLnNldFZhbHVlRnJvbUNvb3JkcyA9IGZ1bmN0aW9uKHgsIHksIHZhbHVlLCBmb3JjZSkge1xuICAgICAgICB2YXIgcmVjb3JkcyA9IFtdO1xuICAgICAgICByZWNvcmRzLnB1c2gob2JqLnVwZGF0ZUNlbGwoeCwgeSwgdmFsdWUsIGZvcmNlKSk7XG5cbiAgICAgICAgLy8gVXBkYXRlIGFsbCBmb3JtdWxhcyBpbiB0aGUgY2hhaW5cbiAgICAgICAgb2JqLnVwZGF0ZUZvcm11bGFDaGFpbih4LCB5LCByZWNvcmRzKTtcblxuICAgICAgICAvLyBVcGRhdGUgaGlzdG9yeVxuICAgICAgICBvYmouc2V0SGlzdG9yeSh7XG4gICAgICAgICAgICBhY3Rpb246J3NldFZhbHVlJyxcbiAgICAgICAgICAgIHJlY29yZHM6cmVjb3JkcyxcbiAgICAgICAgICAgIHNlbGVjdGlvbjpvYmouc2VsZWN0ZWRDZWxsLFxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBVcGRhdGUgdGFibGUgd2l0aCBjdXN0b20gY29uZmlndXJhdGlvbnMgaWYgYXBwbGljYWJsZVxuICAgICAgICBvYmoudXBkYXRlVGFibGUoKTtcblxuICAgICAgICAvLyBPbiBhZnRlciBjaGFuZ2VzXG4gICAgICAgIG9iai5vbmFmdGVyY2hhbmdlcyhlbCwgcmVjb3Jkcyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVG9vZ2xlXG4gICAgICovXG4gICAgb2JqLnNldENoZWNrUmFkaW9WYWx1ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcmVjb3JkcyA9IFtdO1xuICAgICAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iai5oaWdobGlnaHRlZCk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIHggPSBvYmouaGlnaGxpZ2h0ZWRbaV0uZ2V0QXR0cmlidXRlKCdkYXRhLXgnKTtcbiAgICAgICAgICAgIHZhciB5ID0gb2JqLmhpZ2hsaWdodGVkW2ldLmdldEF0dHJpYnV0ZSgnZGF0YS15Jyk7XG5cbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5jb2x1bW5zW3hdLnR5cGUgPT0gJ2NoZWNrYm94JyB8fCBvYmoub3B0aW9ucy5jb2x1bW5zW3hdLnR5cGUgPT0gJ3JhZGlvJykge1xuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBjZWxsXG4gICAgICAgICAgICAgICAgcmVjb3Jkcy5wdXNoKG9iai51cGRhdGVDZWxsKHgsIHksICEgb2JqLm9wdGlvbnMuZGF0YVt5XVt4XSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHJlY29yZHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAvLyBVcGRhdGUgaGlzdG9yeVxuICAgICAgICAgICAgb2JqLnNldEhpc3Rvcnkoe1xuICAgICAgICAgICAgICAgIGFjdGlvbjonc2V0VmFsdWUnLFxuICAgICAgICAgICAgICAgIHJlY29yZHM6cmVjb3JkcyxcbiAgICAgICAgICAgICAgICBzZWxlY3Rpb246b2JqLnNlbGVjdGVkQ2VsbCxcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBPbiBhZnRlciBjaGFuZ2VzXG4gICAgICAgICAgICBvYmoub25hZnRlcmNoYW5nZXMoZWwsIHJlY29yZHMpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVXBkYXRlIGNlbGwgY29udGVudFxuICAgICAqIFxuICAgICAqIEBwYXJhbSBvYmplY3QgY2VsbFxuICAgICAqIEByZXR1cm4gdm9pZFxuICAgICAqL1xuICAgIG9iai51cGRhdGVDZWxsID0gZnVuY3Rpb24oeCwgeSwgdmFsdWUsIGZvcmNlKSB7XG4gICAgICAgIC8vIENoYW5naW5nIHZhbHVlIGRlcGVuZGluZyBvbiB0aGUgY29sdW1uIHR5cGVcbiAgICAgICAgaWYgKG9iai5yZWNvcmRzW3ldW3hdLmNsYXNzTGlzdC5jb250YWlucygncmVhZG9ubHknKSA9PSB0cnVlICYmICEgZm9yY2UpIHtcbiAgICAgICAgICAgIC8vIERvIG5vdGhpbmdcclxuICAgICAgICAgICAgdmFyIHJlY29yZCA9IHtcclxuICAgICAgICAgICAgICAgIHg6IHgsXHJcbiAgICAgICAgICAgICAgICB5OiB5LFxyXG4gICAgICAgICAgICAgICAgY29sOiB4LFxyXG4gICAgICAgICAgICAgICAgcm93OiB5XHJcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIE9uIGNoYW5nZVxuICAgICAgICAgICAgaWYgKCEgb2JqLmlnbm9yZUV2ZW50cykge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2Yob2JqLm9wdGlvbnMub25iZWZvcmVjaGFuZ2UpID09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gT3ZlcndyaXRlIGEgdmFsdWVcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbCA9IG9iai5vcHRpb25zLm9uYmVmb3JlY2hhbmdlKGVsLCBvYmoucmVjb3Jkc1t5XVt4XSwgeCwgeSwgdmFsdWUpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIElmIHlvdSByZXR1cm4gc29tZXRoaW5nIHRoaXMgd2lsbCBvdmVyd3JpdGUgdGhlIHZhbHVlXG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWwgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gSGlzdG9yeSBmb3JtYXRcbiAgICAgICAgICAgIHZhciByZWNvcmQgPSB7XG4gICAgICAgICAgICAgICAgeDogeCxcclxuICAgICAgICAgICAgICAgIHk6IHksXG4gICAgICAgICAgICAgICAgY29sOiB4LFxuICAgICAgICAgICAgICAgIHJvdzogeSxcbiAgICAgICAgICAgICAgICBuZXdWYWx1ZTogdmFsdWUsXG4gICAgICAgICAgICAgICAgb2xkVmFsdWU6IG9iai5vcHRpb25zLmRhdGFbeV1beF0sXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5jb2x1bW5zW3hdLmVkaXRvcikge1xuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBkYXRhIGFuZCBjZWxsXG4gICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMuZGF0YVt5XVt4XSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmNvbHVtbnNbeF0uZWRpdG9yLnNldFZhbHVlKG9iai5yZWNvcmRzW3ldW3hdLCB2YWx1ZSwgZm9yY2UpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBOYXRpdmUgZnVuY3Rpb25zXG4gICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbeF0udHlwZSA9PSAnY2hlY2tib3gnIHx8IG9iai5vcHRpb25zLmNvbHVtbnNbeF0udHlwZSA9PSAncmFkaW8nKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFVuY2hlY2tlZCBhbGwgb3B0aW9uc1xuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuY29sdW1uc1t4XS50eXBlID09ICdyYWRpbycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgb2JqLm9wdGlvbnMuZGF0YS5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmRhdGFbal1beF0gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBkYXRhIGFuZCBjZWxsXG4gICAgICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW3ldW3hdLmNoaWxkcmVuWzBdLmNoZWNrZWQgPSAodmFsdWUgPT0gMSB8fCB2YWx1ZSA9PSB0cnVlIHx8IHZhbHVlID09ICd0cnVlJyB8fCB2YWx1ZSA9PSAnVFJVRScpID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5kYXRhW3ldW3hdID0gb2JqLnJlY29yZHNbeV1beF0uY2hpbGRyZW5bMF0uY2hlY2tlZDtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbeF0udHlwZSA9PSAnZHJvcGRvd24nIHx8IG9iai5vcHRpb25zLmNvbHVtbnNbeF0udHlwZSA9PSAnYXV0b2NvbXBsZXRlJykge1xuICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgZGF0YSBhbmQgY2VsbFxuICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5kYXRhW3ldW3hdID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW3ldW3hdLmlubmVySFRNTCA9IG9iai5nZXREcm9wRG93blZhbHVlKHgsIHZhbHVlKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbeF0udHlwZSA9PSAnY2FsZW5kYXInKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBjYWxlbmRhclxuICAgICAgICAgICAgICAgICAgICB2YXIgZm9ybWF0dGVkID0galN1aXRlcy5jYWxlbmRhci5leHRyYWN0RGF0ZUZyb21TdHJpbmcodmFsdWUsIG9iai5vcHRpb25zLmNvbHVtbnNbeF0ub3B0aW9ucy5mb3JtYXQpO1xuICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgZGF0YSBhbmQgY2VsbFxuICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5kYXRhW3ldW3hdID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW3ldW3hdLmlubmVySFRNTCA9IGpTdWl0ZXMuY2FsZW5kYXIuZ2V0RGF0ZVN0cmluZyhmb3JtYXR0ZWQgPyBmb3JtYXR0ZWQgOiB2YWx1ZSwgb2JqLm9wdGlvbnMuY29sdW1uc1t4XS5vcHRpb25zLmZvcm1hdCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvYmoub3B0aW9ucy5jb2x1bW5zW3hdLnR5cGUgPT0gJ2NvbG9yJykge1xuICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgY29sb3JcbiAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMuZGF0YVt5XVt4XSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAvLyBSZW5kZXJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbeF0ucmVuZGVyID09ICdzcXVhcmUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29sb3IgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yLmNsYXNzTmFtZSA9ICdjb2xvcic7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xvci5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW3ldW3hdLmlubmVySFRNTCA9ICcnO1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJlY29yZHNbeV1beF0uYXBwZW5kQ2hpbGQoY29sb3IpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBvYmoucmVjb3Jkc1t5XVt4XS5zdHlsZS5jb2xvciA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJlY29yZHNbeV1beF0uaW5uZXJIVE1MID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbeF0udHlwZSA9PSAnaW1hZ2UnKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gJycrdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmRhdGFbeV1beF0gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgb2JqLnJlY29yZHNbeV1beF0uaW5uZXJIVE1MID0gJyc7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5zdWJzdHIoMCwgMTApID09ICdkYXRhOmltYWdlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaW1nLnNyYyA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJlY29yZHNbeV1beF0uYXBwZW5kQ2hpbGQoaW1nKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBkYXRhIGFuZCBjZWxsXG4gICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmRhdGFbeV1beF0gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgLy8gTGFiZWxcbiAgICAgICAgICAgICAgICAgICAgaWYgKCgnJyArIHZhbHVlKS5zdWJzdHIoMCwxKSA9PSAnPScgICYmIG9iai5vcHRpb25zLnBhcnNlRm9ybXVsYXMgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBvYmouZXhlY3V0ZUZvcm11bGEodmFsdWUsIHgsIHkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5jb2x1bW5zW3hdLm1hc2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkZWNpbWFsID0gb2JqLm9wdGlvbnMuY29sdW1uc1t4XS5kZWNpbWFsIHx8ICcuJztcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gJycgKyBqU3VpdGVzLm1hc2sucnVuKHZhbHVlLCBvYmoub3B0aW9ucy5jb2x1bW5zW3hdLm1hc2ssIGRlY2ltYWwpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW3ldW3hdLmlubmVySFRNTCA9IHZhbHVlO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIEhhbmRsZSBiaWcgdGV4dCBpbnNpZGUgYSBjZWxsXG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5jb2x1bW5zW3hdLndvcmRXcmFwICE9IGZhbHNlICYmIChvYmoub3B0aW9ucy53b3JkV3JhcCA9PSB0cnVlIHx8IG9iai5vcHRpb25zLmNvbHVtbnNbeF0ud29yZFdyYXAgPT0gdHJ1ZSB8fCBvYmoucmVjb3Jkc1t5XVt4XS5pbm5lckhUTUwubGVuZ3RoID4gMjAwKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJlY29yZHNbeV1beF0uc3R5bGUud2hpdGVTcGFjZSA9ICdwcmUtd3JhcCc7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVjb3Jkc1t5XVt4XS5zdHlsZS53aGl0ZVNwYWNlID0gJyc7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIE92ZXJmbG93XG4gICAgICAgICAgICBpZiAoeCA+IDApIHtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgb2JqLnJlY29yZHNbeV1beC0xXS5zdHlsZS5vdmVyZmxvdyA9ICdoaWRkZW4nO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW3ldW3gtMV0uc3R5bGUub3ZlcmZsb3cgPSAnJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIE9uIGNoYW5nZVxuICAgICAgICAgICAgaWYgKCEgb2JqLmlnbm9yZUV2ZW50cykge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2Yob2JqLm9wdGlvbnMub25jaGFuZ2UpID09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMub25jaGFuZ2UoZWwsIChvYmoucmVjb3Jkc1t5XSAmJiBvYmoucmVjb3Jkc1t5XVt4XSA/IG9iai5yZWNvcmRzW3ldW3hdIDogbnVsbCksIHgsIHksIHZhbHVlLCByZWNvcmQub2xkVmFsdWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZWNvcmQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSGVscGVyIGZ1bmN0aW9uIHRvIGNvcHkgZGF0YSB1c2luZyB0aGUgY29ybmVyIGljb25cbiAgICAgKi9cbiAgICBvYmouY29weURhdGEgPSBmdW5jdGlvbihvLCBkKSB7XG4gICAgICAgIC8vIEdldCBkYXRhIGZyb20gYWxsIHNlbGVjdGVkIGNlbGxzXG4gICAgICAgIHZhciBkYXRhID0gb2JqLmdldERhdGEodHJ1ZSwgdHJ1ZSk7XG5cbiAgICAgICAgLy8gU2VsZWN0ZWQgY2VsbHNcclxuICAgICAgICB2YXIgaCA9IG9iai5zZWxlY3RlZENvbnRhaW5lcjtcblxuICAgICAgICAvLyBDZWxsc1xuICAgICAgICB2YXIgeDEgPSBwYXJzZUludChvLmdldEF0dHJpYnV0ZSgnZGF0YS14JykpO1xuICAgICAgICB2YXIgeTEgPSBwYXJzZUludChvLmdldEF0dHJpYnV0ZSgnZGF0YS15JykpO1xuICAgICAgICB2YXIgeDIgPSBwYXJzZUludChkLmdldEF0dHJpYnV0ZSgnZGF0YS14JykpO1xuICAgICAgICB2YXIgeTIgPSBwYXJzZUludChkLmdldEF0dHJpYnV0ZSgnZGF0YS15JykpO1xuXG4gICAgICAgIC8vIFJlY29yZHNcbiAgICAgICAgdmFyIHJlY29yZHMgPSBbXTtcbiAgICAgICAgdmFyIGJyZWFrQ29udHJvbCA9IGZhbHNlO1xuXG4gICAgICAgIGlmIChoWzBdID09IHgxKSB7XHJcbiAgICAgICAgICAgIC8vIFZlcnRpY2FsIGNvcHlcclxuICAgICAgICAgICAgaWYgKHkxIDwgaFsxXSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJvd051bWJlciA9IHkxIC0gaFsxXTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHZhciByb3dOdW1iZXIgPSAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBjb2xOdW1iZXIgPSAwO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICh4MSA8IGhbMF0pIHtcclxuICAgICAgICAgICAgICAgIHZhciBjb2xOdW1iZXIgPSB4MSAtIGhbMF07XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY29sTnVtYmVyID0gMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgcm93TnVtYmVyID0gMDtcclxuICAgICAgICB9XHJcblxuICAgICAgICAvLyBDb3B5IGRhdGEgcHJvY2VkdXJlXG4gICAgICAgIHZhciBwb3N4ID0gMDtcbiAgICAgICAgdmFyIHBvc3kgPSAwO1xuXG4gICAgICAgIGZvciAodmFyIGogPSB5MTsgaiA8PSB5MjsgaisrKSB7XG4gICAgICAgICAgICAvLyBTa2lwIGhpZGRlbiByb3dzXG4gICAgICAgICAgICBpZiAob2JqLnJvd3Nbal0gJiYgb2JqLnJvd3Nbal0uc3R5bGUuZGlzcGxheSA9PSAnbm9uZScpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQ29udHJvbHNcbiAgICAgICAgICAgIGlmIChkYXRhW3Bvc3ldID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHBvc3kgPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcG9zeCA9IDA7XG5cbiAgICAgICAgICAgIC8vIERhdGEgY29sdW1uc1xuICAgICAgICAgICAgaWYgKGhbMF0gIT0geDEpIHtcclxuICAgICAgICAgICAgICAgIGlmICh4MSA8IGhbMF0pIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY29sTnVtYmVyID0geDEgLSBoWzBdO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY29sTnVtYmVyID0gMTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gRGF0YSBjb2x1bW5zXG4gICAgICAgICAgICBmb3IgKHZhciBpID0geDE7IGkgPD0geDI7IGkrKykge1xuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBub24tcmVhZG9ubHlcbiAgICAgICAgICAgICAgICBpZiAob2JqLnJlY29yZHNbal1baV0gJiYgISBvYmoucmVjb3Jkc1tqXVtpXS5jbGFzc0xpc3QuY29udGFpbnMoJ3JlYWRvbmx5JykgJiYgb2JqLnJlY29yZHNbal1baV0uc3R5bGUuZGlzcGxheSAhPSAnbm9uZScgJiYgYnJlYWtDb250cm9sID09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFN0b3AgaWYgY29udGFpbnMgdmFsdWVcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEgb2JqLnNlbGVjdGlvbi5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5kYXRhW2pdW2ldICE9ICcnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWtDb250cm9sID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIENvbHVtblxuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YVtwb3N5XSA9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvc3ggPSAwO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRhdGFbcG9zeV1bcG9zeF0gPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwb3N4ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBWYWx1ZVxyXG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IGRhdGFbcG9zeV1bcG9zeF07XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAmJiAhIGRhdGFbMV0gJiYgb2JqLm9wdGlvbnMuYXV0b0luY3JlbWVudCA9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuY29sdW1uc1tpXS50eXBlID09ICd0ZXh0JyB8fCBvYmoub3B0aW9ucy5jb2x1bW5zW2ldLnR5cGUgPT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKCcnK3ZhbHVlKS5zdWJzdHIoMCwxKSA9PSAnPScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRva2VucyA9IHZhbHVlLm1hdGNoKC8oW0EtWl0rWzAtOV0rKS9nKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodG9rZW5zKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWZmZWN0ZWRUb2tlbnMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCB0b2tlbnMubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBvc2l0aW9uID0gamV4Y2VsLmdldElkRnJvbUNvbHVtbk5hbWUodG9rZW5zW2luZGV4XSwgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb25bMF0gKz0gY29sTnVtYmVyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb25bMV0gKz0gcm93TnVtYmVyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBvc2l0aW9uWzFdIDwgMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uWzFdID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG9rZW4gPSBqZXhjZWwuZ2V0Q29sdW1uTmFtZUZyb21JZChbcG9zaXRpb25bMF0sIHBvc2l0aW9uWzFdXSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodG9rZW4gIT0gdG9rZW5zW2luZGV4XSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZmZlY3RlZFRva2Vuc1t0b2tlbnNbaW5kZXhdXSA9IHRva2VuO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBmb3JtdWxhXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWZmZWN0ZWRUb2tlbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IG9iai51cGRhdGVGb3JtdWxhKHZhbHVlLCBhZmZlY3RlZFRva2VucylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PSBOdW1iZXIodmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IE51bWJlcih2YWx1ZSkgKyByb3dOdW1iZXI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbaV0udHlwZSA9PSAnY2FsZW5kYXInKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZS5zZXREYXRlKGRhdGUuZ2V0RGF0ZSgpICsgcm93TnVtYmVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGRhdGUuZ2V0RnVsbFllYXIoKSArICctJyArIGpleGNlbC5kb3VibGVEaWdpdEZvcm1hdChwYXJzZUludChkYXRlLmdldE1vbnRoKCkgKyAxKSkgKyAnLScgKyBqZXhjZWwuZG91YmxlRGlnaXRGb3JtYXQoZGF0ZS5nZXREYXRlKCkpICsgJyAnICsgJzAwOjAwOjAwJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHJlY29yZHMucHVzaChvYmoudXBkYXRlQ2VsbChpLCBqLCB2YWx1ZSkpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBhbGwgZm9ybXVsYXMgaW4gdGhlIGNoYWluXG4gICAgICAgICAgICAgICAgICAgIG9iai51cGRhdGVGb3JtdWxhQ2hhaW4oaSwgaiwgcmVjb3Jkcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHBvc3grKztcbiAgICAgICAgICAgICAgICBpZiAoaFswXSAhPSB4MSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbE51bWJlcisrO1xyXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcG9zeSsrO1xuICAgICAgICAgICAgcm93TnVtYmVyKys7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBVcGRhdGUgaGlzdG9yeVxuICAgICAgICBvYmouc2V0SGlzdG9yeSh7XG4gICAgICAgICAgICBhY3Rpb246J3NldFZhbHVlJyxcbiAgICAgICAgICAgIHJlY29yZHM6cmVjb3JkcyxcbiAgICAgICAgICAgIHNlbGVjdGlvbjpvYmouc2VsZWN0ZWRDZWxsLFxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBVcGRhdGUgdGFibGUgd2l0aCBjdXN0b20gY29uZmlndXJhdGlvbiBpZiBhcHBsaWNhYmxlXG4gICAgICAgIG9iai51cGRhdGVUYWJsZSgpO1xuXG4gICAgICAgIC8vIE9uIGFmdGVyIGNoYW5nZXNcbiAgICAgICAgb2JqLm9uYWZ0ZXJjaGFuZ2VzKGVsLCByZWNvcmRzKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZWZyZXNoIGN1cnJlbnQgc2VsZWN0aW9uXG4gICAgICovXG4gICAgb2JqLnJlZnJlc2hTZWxlY3Rpb24gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKG9iai5zZWxlY3RlZENlbGwpIHtcbiAgICAgICAgICAgIG9iai51cGRhdGVTZWxlY3Rpb25Gcm9tQ29vcmRzKG9iai5zZWxlY3RlZENlbGxbMF0sIG9iai5zZWxlY3RlZENlbGxbMV0sIG9iai5zZWxlY3RlZENlbGxbMl0sIG9iai5zZWxlY3RlZENlbGxbM10pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTW92ZSBjb29yZHMgdG8gQTEgaW4gY2FzZSBvdmVsYXBzIHdpdGggYW4gZXhjbHVkZWQgY2VsbFxuICAgICAqL1xuICAgIG9iai5jb25kaXRpb25hbFNlbGVjdGlvblVwZGF0ZSA9IGZ1bmN0aW9uKHR5cGUsIG8sIGQpIHtcbiAgICAgICAgaWYgKHR5cGUgPT0gMSkge1xuICAgICAgICAgICAgaWYgKG9iai5zZWxlY3RlZENlbGwgJiYgKChvID49IG9iai5zZWxlY3RlZENlbGxbMV0gJiYgbyA8PSBvYmouc2VsZWN0ZWRDZWxsWzNdKSB8fCAoZCA+PSBvYmouc2VsZWN0ZWRDZWxsWzFdICYmIGQgPD0gb2JqLnNlbGVjdGVkQ2VsbFszXSkpKSB7XG4gICAgICAgICAgICAgICAgb2JqLnJlc2V0U2VsZWN0aW9uKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKG9iai5zZWxlY3RlZENlbGwgJiYgKChvID49IG9iai5zZWxlY3RlZENlbGxbMF0gJiYgbyA8PSBvYmouc2VsZWN0ZWRDZWxsWzJdKSB8fCAoZCA+PSBvYmouc2VsZWN0ZWRDZWxsWzBdICYmIGQgPD0gb2JqLnNlbGVjdGVkQ2VsbFsyXSkpKSB7XG4gICAgICAgICAgICAgICAgb2JqLnJlc2V0U2VsZWN0aW9uKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2xlYXIgdGFibGUgc2VsZWN0aW9uXG4gICAgICovXG4gICAgb2JqLnJlc2V0U2VsZWN0aW9uID0gZnVuY3Rpb24oYmx1cikge1xuICAgICAgICAvLyBSZW1vdmUgc3R5bGVcbiAgICAgICAgaWYgKCEgb2JqLmhpZ2hsaWdodGVkLmxlbmd0aCkge1xuICAgICAgICAgICAgdmFyIHByZXZpb3VzU3RhdHVzID0gMDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciBwcmV2aW91c1N0YXR1cyA9IDE7XG5cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2JqLmhpZ2hsaWdodGVkLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgb2JqLmhpZ2hsaWdodGVkW2ldLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZ2hsaWdodCcpO1xuICAgICAgICAgICAgICAgIG9iai5oaWdobGlnaHRlZFtpXS5jbGFzc0xpc3QucmVtb3ZlKCdoaWdobGlnaHQtbGVmdCcpO1xuICAgICAgICAgICAgICAgIG9iai5oaWdobGlnaHRlZFtpXS5jbGFzc0xpc3QucmVtb3ZlKCdoaWdobGlnaHQtcmlnaHQnKTtcbiAgICAgICAgICAgICAgICBvYmouaGlnaGxpZ2h0ZWRbaV0uY2xhc3NMaXN0LnJlbW92ZSgnaGlnaGxpZ2h0LXRvcCcpO1xuICAgICAgICAgICAgICAgIG9iai5oaWdobGlnaHRlZFtpXS5jbGFzc0xpc3QucmVtb3ZlKCdoaWdobGlnaHQtYm90dG9tJyk7XG4gICAgICAgICAgICAgICAgb2JqLmhpZ2hsaWdodGVkW2ldLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZ2hsaWdodC1zZWxlY3RlZCcpO1xuXG4gICAgICAgICAgICAgICAgdmFyIHB4ID0gcGFyc2VJbnQob2JqLmhpZ2hsaWdodGVkW2ldLmdldEF0dHJpYnV0ZSgnZGF0YS14JykpO1xuICAgICAgICAgICAgICAgIHZhciBweSA9IHBhcnNlSW50KG9iai5oaWdobGlnaHRlZFtpXS5nZXRBdHRyaWJ1dGUoJ2RhdGEteScpKTtcblxuICAgICAgICAgICAgICAgIC8vIENoZWNrIGZvciBtZXJnZWQgY2VsbHNcbiAgICAgICAgICAgICAgICBpZiAob2JqLmhpZ2hsaWdodGVkW2ldLmdldEF0dHJpYnV0ZSgnZGF0YS1tZXJnZWQnKSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgY29sc3BhbiA9IHBhcnNlSW50KG9iai5oaWdobGlnaHRlZFtpXS5nZXRBdHRyaWJ1dGUoJ2NvbHNwYW4nKSk7XG4gICAgICAgICAgICAgICAgICAgIHZhciByb3dzcGFuID0gcGFyc2VJbnQob2JqLmhpZ2hsaWdodGVkW2ldLmdldEF0dHJpYnV0ZSgncm93c3BhbicpKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHV4ID0gY29sc3BhbiA+IDAgPyBweCArIChjb2xzcGFuIC0gMSkgOiBweDtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHV5ID0gcm93c3BhbiA+IDAgPyBweSArIChyb3dzcGFuIC0gMSk6IHB5O1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB1eCA9IHB4O1xuICAgICAgICAgICAgICAgICAgICB2YXIgdXkgPSBweTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBSZW1vdmUgc2VsZWN0ZWQgZnJvbSBoZWFkZXJzXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IHB4OyBqIDw9IHV4OyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5oZWFkZXJzW2pdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouaGVhZGVyc1tqXS5jbGFzc0xpc3QucmVtb3ZlKCdzZWxlY3RlZCcpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gUmVtb3ZlIHNlbGVjdGVkIGZyb20gcm93c1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSBweTsgaiA8PSB1eTsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmoucm93c1tqXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJvd3Nbal0uY2xhc3NMaXN0LnJlbW92ZSgnc2VsZWN0ZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFJlc2V0IGhpZ2hsaWdoZWQgY2VsbHNcbiAgICAgICAgb2JqLmhpZ2hsaWdodGVkID0gW107XG5cbiAgICAgICAgLy8gUmVzZXRcbiAgICAgICAgb2JqLnNlbGVjdGVkQ2VsbCA9IG51bGw7XG5cbiAgICAgICAgLy8gSGlkZSBjb3JuZXJcbiAgICAgICAgb2JqLmNvcm5lci5zdHlsZS50b3AgPSAnLTIwMDBweCc7XG4gICAgICAgIG9iai5jb3JuZXIuc3R5bGUubGVmdCA9ICctMjAwMHB4JztcblxuICAgICAgICBpZiAob2JqLmlnbm9yZUV2ZW50cyAhPSB0cnVlICYmIGJsdXIgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLm9uYmx1cikge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2Yob2JqLm9wdGlvbnMub25ibHVyKSA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwcmV2aW91c1N0YXR1cyA9PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5vbmJsdXIoZWwpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHByZXZpb3VzU3RhdHVzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZSBzZWxlY3Rpb24gYmFzZWQgb24gdHdvIGNlbGxzXG4gICAgICovXG4gICAgb2JqLnVwZGF0ZVNlbGVjdGlvbiA9IGZ1bmN0aW9uKGVsMSwgZWwyLCBvcmlnaW4pIHtcbiAgICAgICAgdmFyIHgxID0gZWwxLmdldEF0dHJpYnV0ZSgnZGF0YS14Jyk7XG4gICAgICAgIHZhciB5MSA9IGVsMS5nZXRBdHRyaWJ1dGUoJ2RhdGEteScpO1xuICAgICAgICBpZiAoZWwyKSB7XG4gICAgICAgICAgICB2YXIgeDIgPSBlbDIuZ2V0QXR0cmlidXRlKCdkYXRhLXgnKTtcbiAgICAgICAgICAgIHZhciB5MiA9IGVsMi5nZXRBdHRyaWJ1dGUoJ2RhdGEteScpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIHgyID0geDE7XG4gICAgICAgICAgICB2YXIgeTIgPSB5MTtcbiAgICAgICAgfVxuXG4gICAgICAgIG9iai51cGRhdGVTZWxlY3Rpb25Gcm9tQ29vcmRzKHgxLCB5MSwgeDIsIHkyLCBvcmlnaW4pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZSBzZWxlY3Rpb24gZnJvbSBjb29yZHNcbiAgICAgKi9cbiAgICBvYmoudXBkYXRlU2VsZWN0aW9uRnJvbUNvb3JkcyA9IGZ1bmN0aW9uKHgxLCB5MSwgeDIsIHkyLCBvcmlnaW4pIHtcbiAgICAgICAgLy8gUmVzZXQgU2VsZWN0aW9uXG4gICAgICAgIHZhciB1cGRhdGVkID0gbnVsbDtcbiAgICAgICAgdmFyIHByZXZpb3VzU3RhdGUgPSBvYmoucmVzZXRTZWxlY3Rpb24oKTtcblxuICAgICAgICAvLyBTYW1lIGVsZW1lbnRcbiAgICAgICAgaWYgKHgyID09IG51bGwpIHtcbiAgICAgICAgICAgIHgyID0geDE7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHkyID09IG51bGwpIHtcbiAgICAgICAgICAgIHkyID0geTE7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBTZWxlY3Rpb24gbXVzdCBiZSB3aXRoaW4gdGhlIGV4aXN0aW5nIGRhdGFcbiAgICAgICAgaWYgKHgxID49IG9iai5oZWFkZXJzLmxlbmd0aCkge1xuICAgICAgICAgICAgeDEgPSBvYmouaGVhZGVycy5sZW5ndGggLSAxO1xuICAgICAgICB9XG4gICAgICAgIGlmICh5MSA+PSBvYmoucm93cy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHkxID0gb2JqLnJvd3MubGVuZ3RoIC0gMTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoeDIgPj0gb2JqLmhlYWRlcnMubGVuZ3RoKSB7XG4gICAgICAgICAgICB4MiA9IG9iai5oZWFkZXJzLmxlbmd0aCAtIDE7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHkyID49IG9iai5yb3dzLmxlbmd0aCkge1xuICAgICAgICAgICAgeTIgPSBvYmoucm93cy5sZW5ndGggLSAxO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gS2VlcCBzZWxlY3RlZCBjZWxsXG4gICAgICAgIG9iai5zZWxlY3RlZENlbGwgPSBbeDEsIHkxLCB4MiwgeTJdO1xuXG4gICAgICAgIC8vIFNlbGVjdCBjZWxsc1xuICAgICAgICBpZiAoeDEgIT0gbnVsbCkge1xuICAgICAgICAgICAgLy8gQWRkIHNlbGVjdGVkIGNlbGxcbiAgICAgICAgICAgIGlmIChvYmoucmVjb3Jkc1t5MV1beDFdKSB7XG4gICAgICAgICAgICAgICAgb2JqLnJlY29yZHNbeTFdW3gxXS5jbGFzc0xpc3QuYWRkKCdoaWdobGlnaHQtc2VsZWN0ZWQnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gT3JpZ2luICYgRGVzdGluYXRpb25cbiAgICAgICAgICAgIGlmIChwYXJzZUludCh4MSkgPCBwYXJzZUludCh4MikpIHtcbiAgICAgICAgICAgICAgICB2YXIgcHggPSBwYXJzZUludCh4MSk7XG4gICAgICAgICAgICAgICAgdmFyIHV4ID0gcGFyc2VJbnQoeDIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgcHggPSBwYXJzZUludCh4Mik7XG4gICAgICAgICAgICAgICAgdmFyIHV4ID0gcGFyc2VJbnQoeDEpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocGFyc2VJbnQoeTEpIDwgcGFyc2VJbnQoeTIpKSB7XG4gICAgICAgICAgICAgICAgdmFyIHB5ID0gcGFyc2VJbnQoeTEpO1xuICAgICAgICAgICAgICAgIHZhciB1eSA9IHBhcnNlSW50KHkyKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIHB5ID0gcGFyc2VJbnQoeTIpO1xuICAgICAgICAgICAgICAgIHZhciB1eSA9IHBhcnNlSW50KHkxKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gVmVyaWZ5IG1lcmdlZCBjb2x1bW5zXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gcHg7IGkgPD0gdXg7IGkrKykge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSBweTsgaiA8PSB1eTsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmoucmVjb3Jkc1tqXVtpXSAmJiBvYmoucmVjb3Jkc1tqXVtpXS5nZXRBdHRyaWJ1dGUoJ2RhdGEtbWVyZ2VkJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB4ID0gcGFyc2VJbnQob2JqLnJlY29yZHNbal1baV0uZ2V0QXR0cmlidXRlKCdkYXRhLXgnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgeSA9IHBhcnNlSW50KG9iai5yZWNvcmRzW2pdW2ldLmdldEF0dHJpYnV0ZSgnZGF0YS15JykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbHNwYW4gPSBwYXJzZUludChvYmoucmVjb3Jkc1tqXVtpXS5nZXRBdHRyaWJ1dGUoJ2NvbHNwYW4nKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcm93c3BhbiA9IHBhcnNlSW50KG9iai5yZWNvcmRzW2pdW2ldLmdldEF0dHJpYnV0ZSgncm93c3BhbicpKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbHNwYW4gPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHggPCBweCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBweCA9IHg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh4ICsgY29sc3BhbiA+IHV4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV4ID0geCArIGNvbHNwYW4gLSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJvd3NwYW4pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoeSA8IHB5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB5ID0geTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoeSArIHJvd3NwYW4gPiB1eSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1eSA9IHkgKyByb3dzcGFuIC0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIExpbWl0c1xuICAgICAgICAgICAgdmFyIGJvcmRlckxlZnQgPSBudWxsO1xuICAgICAgICAgICAgdmFyIGJvcmRlclJpZ2h0ID0gbnVsbDtcbiAgICAgICAgICAgIHZhciBib3JkZXJUb3AgPSBudWxsO1xuICAgICAgICAgICAgdmFyIGJvcmRlckJvdHRvbSA9IG51bGw7XG5cbiAgICAgICAgICAgIC8vIFZlcnRpY2FsIGxpbWl0c1xuICAgICAgICAgICAgZm9yICh2YXIgaiA9IHB5OyBqIDw9IHV5OyBqKyspIHtcbiAgICAgICAgICAgICAgICBpZiAob2JqLnJvd3Nbal0uc3R5bGUuZGlzcGxheSAhPSAnbm9uZScpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJvcmRlclRvcCA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBib3JkZXJUb3AgPSBqO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJvcmRlckJvdHRvbSA9IGo7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBSZWRlZmluaW5nIHN0eWxlc1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IHB4OyBpIDw9IHV4OyBpKyspIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gcHk7IGogPD0gdXk7IGorKykge1xuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLnJvd3Nbal0uc3R5bGUuZGlzcGxheSAhPSAnbm9uZScgJiYgb2JqLnJlY29yZHNbal1baV0uc3R5bGUuZGlzcGxheSAhPSAnbm9uZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW2pdW2ldLmNsYXNzTGlzdC5hZGQoJ2hpZ2hsaWdodCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmhpZ2hsaWdodGVkLnB1c2gob2JqLnJlY29yZHNbal1baV0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gSG9yaXpvbnRhbCBsaW1pdHNcbiAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuY29sdW1uc1tpXS50eXBlICE9ICdoaWRkZW4nKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChib3JkZXJMZWZ0ID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJvcmRlckxlZnQgPSBpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJvcmRlclJpZ2h0ID0gaTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIENyZWF0ZSBib3JkZXJzXG4gICAgICAgICAgICBpZiAoISBib3JkZXJMZWZ0KSB7XG4gICAgICAgICAgICAgICAgYm9yZGVyTGVmdCA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoISBib3JkZXJSaWdodCkge1xuICAgICAgICAgICAgICAgIGJvcmRlclJpZ2h0ID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSBib3JkZXJMZWZ0OyBpIDw9IGJvcmRlclJpZ2h0OyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuY29sdW1uc1tpXS50eXBlICE9ICdoaWRkZW4nKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFRvcCBib3JkZXJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5yZWNvcmRzW2JvcmRlclRvcF1baV0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW2JvcmRlclRvcF1baV0uY2xhc3NMaXN0LmFkZCgnaGlnaGxpZ2h0LXRvcCcpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIEJvdHRvbSBib3JkZXJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5yZWNvcmRzW2JvcmRlckJvdHRvbV1baV0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW2JvcmRlckJvdHRvbV1baV0uY2xhc3NMaXN0LmFkZCgnaGlnaGxpZ2h0LWJvdHRvbScpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIEFkZCBzZWxlY3RlZCBmcm9tIGhlYWRlcnNcbiAgICAgICAgICAgICAgICAgICAgb2JqLmhlYWRlcnNbaV0uY2xhc3NMaXN0LmFkZCgnc2VsZWN0ZWQnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZvciAodmFyIGogPSBib3JkZXJUb3A7IGogPD0gYm9yZGVyQm90dG9tOyBqKyspIHtcbiAgICAgICAgICAgICAgICBpZiAob2JqLnJvd3Nbal0uc3R5bGUuZGlzcGxheSAhPSAnbm9uZScpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gTGVmdCBib3JkZXJcbiAgICAgICAgICAgICAgICAgICAgb2JqLnJlY29yZHNbal1bYm9yZGVyTGVmdF0uY2xhc3NMaXN0LmFkZCgnaGlnaGxpZ2h0LWxlZnQnKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gUmlnaHQgYm9yZGVyXG4gICAgICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW2pdW2JvcmRlclJpZ2h0XS5jbGFzc0xpc3QuYWRkKCdoaWdobGlnaHQtcmlnaHQnKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gQWRkIHNlbGVjdGVkIGZyb20gcm93c1xuICAgICAgICAgICAgICAgICAgICBvYmoucm93c1tqXS5jbGFzc0xpc3QuYWRkKCdzZWxlY3RlZCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgb2JqLnNlbGVjdGVkQ29udGFpbmVyID0gWyBib3JkZXJMZWZ0LCBib3JkZXJUb3AsIGJvcmRlclJpZ2h0LCBib3JkZXJCb3R0b20gXTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEhhbmRsZSBldmVudHNcbiAgICAgICAgaWYgKG9iai5pZ25vcmVFdmVudHMgIT0gdHJ1ZSkge1xuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLm9uZm9jdXMpIHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mKG9iai5vcHRpb25zLm9uZm9jdXMpID09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHByZXZpb3VzU3RhdGUgPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMub25mb2N1cyhlbCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2Yob2JqLm9wdGlvbnMub25zZWxlY3Rpb24pID09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5vbnNlbGVjdGlvbihlbCwgYm9yZGVyTGVmdCwgYm9yZGVyVG9wLCBib3JkZXJSaWdodCwgYm9yZGVyQm90dG9tLCBvcmlnaW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gRmluZCBjb3JuZXIgY2VsbFxuICAgICAgICBvYmoudXBkYXRlQ29ybmVyUG9zaXRpb24oKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmUgY29weSBzZWxlY3Rpb25cbiAgICAgKiBcbiAgICAgKiBAcmV0dXJuIHZvaWRcbiAgICAgKi9cbiAgICBvYmoucmVtb3ZlQ29weVNlbGVjdGlvbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBSZW1vdmUgY3VycmVudCBzZWxlY3Rpb25cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvYmouc2VsZWN0aW9uLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBvYmouc2VsZWN0aW9uW2ldLmNsYXNzTGlzdC5yZW1vdmUoJ3NlbGVjdGlvbicpO1xuICAgICAgICAgICAgb2JqLnNlbGVjdGlvbltpXS5jbGFzc0xpc3QucmVtb3ZlKCdzZWxlY3Rpb24tbGVmdCcpO1xuICAgICAgICAgICAgb2JqLnNlbGVjdGlvbltpXS5jbGFzc0xpc3QucmVtb3ZlKCdzZWxlY3Rpb24tcmlnaHQnKTtcbiAgICAgICAgICAgIG9iai5zZWxlY3Rpb25baV0uY2xhc3NMaXN0LnJlbW92ZSgnc2VsZWN0aW9uLXRvcCcpO1xuICAgICAgICAgICAgb2JqLnNlbGVjdGlvbltpXS5jbGFzc0xpc3QucmVtb3ZlKCdzZWxlY3Rpb24tYm90dG9tJyk7XG4gICAgICAgIH1cblxuICAgICAgICBvYmouc2VsZWN0aW9uID0gW107XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVXBkYXRlIGNvcHkgc2VsZWN0aW9uXG4gICAgICogXG4gICAgICogQHBhcmFtIGludCB4LCB5XG4gICAgICogQHJldHVybiB2b2lkXG4gICAgICovXG4gICAgb2JqLnVwZGF0ZUNvcHlTZWxlY3Rpb24gPSBmdW5jdGlvbih4MywgeTMpIHtcbiAgICAgICAgLy8gUmVtb3ZlIHNlbGVjdGlvblxuICAgICAgICBvYmoucmVtb3ZlQ29weVNlbGVjdGlvbigpO1xuXG4gICAgICAgIC8vIEdldCBlbGVtZW50cyBmaXJzdCBhbmQgbGFzdFxuICAgICAgICB2YXIgeDEgPSBvYmouc2VsZWN0ZWRDb250YWluZXJbMF07XG4gICAgICAgIHZhciB5MSA9IG9iai5zZWxlY3RlZENvbnRhaW5lclsxXTtcbiAgICAgICAgdmFyIHgyID0gb2JqLnNlbGVjdGVkQ29udGFpbmVyWzJdO1xuICAgICAgICB2YXIgeTIgPSBvYmouc2VsZWN0ZWRDb250YWluZXJbM107XG5cbiAgICAgICAgaWYgKHgzICE9IG51bGwgJiYgeTMgIT0gbnVsbCkge1xuICAgICAgICAgICAgaWYgKHgzIC0geDIgPiAwKSB7XG4gICAgICAgICAgICAgICAgdmFyIHB4ID0gcGFyc2VJbnQoeDIpICsgMTtcbiAgICAgICAgICAgICAgICB2YXIgdXggPSBwYXJzZUludCh4Myk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciBweCA9IHBhcnNlSW50KHgzKTtcbiAgICAgICAgICAgICAgICB2YXIgdXggPSBwYXJzZUludCh4MSkgLSAxO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoeTMgLSB5MiA+IDApIHtcbiAgICAgICAgICAgICAgICB2YXIgcHkgPSBwYXJzZUludCh5MikgKyAxO1xuICAgICAgICAgICAgICAgIHZhciB1eSA9IHBhcnNlSW50KHkzKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIHB5ID0gcGFyc2VJbnQoeTMpO1xuICAgICAgICAgICAgICAgIHZhciB1eSA9IHBhcnNlSW50KHkxKSAtIDE7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh1eCAtIHB4IDwgdXkgLSBweSkge1xuICAgICAgICAgICAgICAgIHZhciBweCA9IHBhcnNlSW50KHgxKTtcbiAgICAgICAgICAgICAgICB2YXIgdXggPSBwYXJzZUludCh4Mik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciBweSA9IHBhcnNlSW50KHkxKTtcbiAgICAgICAgICAgICAgICB2YXIgdXkgPSBwYXJzZUludCh5Mik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZvciAodmFyIGogPSBweTsgaiA8PSB1eTsgaisrKSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IHB4OyBpIDw9IHV4OyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5yZWNvcmRzW2pdW2ldICYmIG9iai5yb3dzW2pdLnN0eWxlLmRpc3BsYXkgIT0gJ25vbmUnICYmIG9iai5yZWNvcmRzW2pdW2ldLnN0eWxlLmRpc3BsYXkgIT0gJ25vbmUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVjb3Jkc1tqXVtpXS5jbGFzc0xpc3QuYWRkKCdzZWxlY3Rpb24nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW3B5XVtpXS5jbGFzc0xpc3QuYWRkKCdzZWxlY3Rpb24tdG9wJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVjb3Jkc1t1eV1baV0uY2xhc3NMaXN0LmFkZCgnc2VsZWN0aW9uLWJvdHRvbScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJlY29yZHNbal1bcHhdLmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGlvbi1sZWZ0Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVjb3Jkc1tqXVt1eF0uY2xhc3NMaXN0LmFkZCgnc2VsZWN0aW9uLXJpZ2h0Jyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFBlcnNpc3Qgc2VsZWN0ZWQgZWxlbWVudHNcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5zZWxlY3Rpb24ucHVzaChvYmoucmVjb3Jkc1tqXVtpXSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVcGRhdGUgY29ybmVyIHBvc2l0aW9uXG4gICAgICogXG4gICAgICogQHJldHVybiB2b2lkXG4gICAgICovXG4gICAgb2JqLnVwZGF0ZUNvcm5lclBvc2l0aW9uID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIElmIGFueSBzZWxlY3RlZCBjZWxsc1xuICAgICAgICBpZiAoISBvYmouaGlnaGxpZ2h0ZWQubGVuZ3RoKSB7XG4gICAgICAgICAgICBvYmouY29ybmVyLnN0eWxlLnRvcCA9ICctMjAwMHB4JztcbiAgICAgICAgICAgIG9iai5jb3JuZXIuc3R5bGUubGVmdCA9ICctMjAwMHB4JztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIEdldCBsYXN0IGNlbGxcbiAgICAgICAgICAgIHZhciBsYXN0ID0gb2JqLmhpZ2hsaWdodGVkW29iai5oaWdobGlnaHRlZC5sZW5ndGgtMV07XG5cclxuICAgICAgICAgICAgY29uc3QgY29udGVudFJlY3QgPSBvYmouY29udGVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgICAgICAgdmFyIHgxID0gY29udGVudFJlY3QubGVmdDtcclxuICAgICAgICAgICAgdmFyIHkxID0gY29udGVudFJlY3QudG9wO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgbGFzdFJlY3QgPSBsYXN0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICAgICAgICB2YXIgeDIgPSBsYXN0UmVjdC5sZWZ0O1xyXG4gICAgICAgICAgICB2YXIgeTIgPSBsYXN0UmVjdC50b3A7XHJcbiAgICAgICAgICAgIHZhciB3MiA9IGxhc3RSZWN0LndpZHRoO1xyXG4gICAgICAgICAgICB2YXIgaDIgPSBsYXN0UmVjdC5oZWlnaHQ7XHJcblxuICAgICAgICAgICAgdmFyIHggPSAoeDIgLSB4MSkgKyBvYmouY29udGVudC5zY3JvbGxMZWZ0ICsgdzIgLSA0O1xuICAgICAgICAgICAgdmFyIHkgPSAoeTIgLSB5MSkgKyBvYmouY29udGVudC5zY3JvbGxUb3AgKyBoMiAtIDQ7XG5cbiAgICAgICAgICAgIC8vIFBsYWNlIHRoZSBjb3JuZXIgaW4gdGhlIGNvcnJlY3QgcGxhY2VcbiAgICAgICAgICAgIG9iai5jb3JuZXIuc3R5bGUudG9wID0geSArICdweCc7XG4gICAgICAgICAgICBvYmouY29ybmVyLnN0eWxlLmxlZnQgPSB4ICsgJ3B4JztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZSBzY3JvbGwgcG9zaXRpb24gYmFzZWQgb24gdGhlIHNlbGVjdGlvblxuICAgICAqL1xuICAgIG9iai51cGRhdGVTY3JvbGwgPSBmdW5jdGlvbihkaXJlY3Rpb24pIHtcbiAgICAgICAgLy8gakV4Y2VsIENvbnRhaW5lciBpbmZvcm1hdGlvblxuICAgICAgICBjb25zdCBjb250ZW50UmVjdCA9IG9iai5jb250ZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICAgIHZhciB4MSA9IGNvbnRlbnRSZWN0LmxlZnQ7XHJcbiAgICAgICAgdmFyIHkxID0gY29udGVudFJlY3QudG9wO1xyXG4gICAgICAgIHZhciB3MSA9IGNvbnRlbnRSZWN0LndpZHRoO1xyXG4gICAgICAgIHZhciBoMSA9IGNvbnRlbnRSZWN0LmhlaWdodDtcclxuXG4gICAgICAgIC8vIERpcmVjdGlvbiBMZWZ0IG9yIFVwXG4gICAgICAgIHZhciByZWZlcmVuY2UgPSBvYmoucmVjb3Jkc1tvYmouc2VsZWN0ZWRDZWxsWzNdXVtvYmouc2VsZWN0ZWRDZWxsWzJdXTtcblxuICAgICAgICAgICAgLy8gUmVmZXJlbmNlXHJcbiAgICAgICAgY29uc3QgcmVmZXJlbmNlUmVjdCA9IHJlZmVyZW5jZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgICB2YXIgeDIgPSByZWZlcmVuY2VSZWN0LmxlZnQ7XHJcbiAgICAgICAgdmFyIHkyID0gcmVmZXJlbmNlUmVjdC50b3A7XHJcbiAgICAgICAgdmFyIHcyID0gcmVmZXJlbmNlUmVjdC53aWR0aDtcclxuICAgICAgICB2YXIgaDIgPSByZWZlcmVuY2VSZWN0LmhlaWdodDtcblxuICAgICAgICAvLyBEaXJlY3Rpb25cbiAgICAgICAgaWYgKGRpcmVjdGlvbiA9PSAwIHx8IGRpcmVjdGlvbiA9PSAxKSB7XG4gICAgICAgICAgICB2YXIgeCA9ICh4MiAtIHgxKSArIG9iai5jb250ZW50LnNjcm9sbExlZnQ7XG4gICAgICAgICAgICB2YXIgeSA9ICh5MiAtIHkxKSArIG9iai5jb250ZW50LnNjcm9sbFRvcCAtIDI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgeCA9ICh4MiAtIHgxKSArIG9iai5jb250ZW50LnNjcm9sbExlZnQgKyB3MjtcbiAgICAgICAgICAgIHZhciB5ID0gKHkyIC0geTEpICsgb2JqLmNvbnRlbnQuc2Nyb2xsVG9wICsgaDI7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBUb3AgcG9zaXRpb24gY2hlY2tcbiAgICAgICAgaWYgKHkgPiAob2JqLmNvbnRlbnQuc2Nyb2xsVG9wICsgMzApICYmIHkgPCAob2JqLmNvbnRlbnQuc2Nyb2xsVG9wICsgaDEpKSB7XG4gICAgICAgICAgICAvLyBJbiB0aGUgdmlld3BvcnRcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIE91dCBvZiB2aWV3cG9ydFxuICAgICAgICAgICAgaWYgKHkgPCBvYmouY29udGVudC5zY3JvbGxUb3AgKyAzMCkge1xuICAgICAgICAgICAgICAgIG9iai5jb250ZW50LnNjcm9sbFRvcCA9IHkgLSBoMjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgb2JqLmNvbnRlbnQuc2Nyb2xsVG9wID0geSAtIChoMSAtIDIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gTGVmdCBwb3NpdGlvbiBjaGVjayAtIFRPRE86IGNoYW5nZSB0aGF0IHRvIHRoZSBib3R0b20gYm9yZGVyIG9mIHRoZSBlbGVtZW50XG4gICAgICAgIGlmICh4ID4gKG9iai5jb250ZW50LnNjcm9sbExlZnQpICYmIHggPCAob2JqLmNvbnRlbnQuc2Nyb2xsTGVmdCArIHcxKSkge1xuICAgICAgICAgICAgLy8gSW4gdGhlIHZpZXdwb3J0XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBPdXQgb2Ygdmlld3BvcnRcbiAgICAgICAgICAgIGlmICh4IDwgb2JqLmNvbnRlbnQuc2Nyb2xsTGVmdCArIDMwKSB7XG4gICAgICAgICAgICAgICAgb2JqLmNvbnRlbnQuc2Nyb2xsTGVmdCA9IHg7XG4gICAgICAgICAgICAgICAgaWYgKG9iai5jb250ZW50LnNjcm9sbExlZnQgPCA1MCkge1xuICAgICAgICAgICAgICAgICAgICBvYmouY29udGVudC5zY3JvbGxMZWZ0ID0gMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG9iai5jb250ZW50LnNjcm9sbExlZnQgPSB4IC0gKHcxIC0gMjApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IHRoZSBjb2x1bW4gd2lkdGhcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0gaW50IGNvbHVtbiBjb2x1bW4gbnVtYmVyIChmaXJzdCBjb2x1bW4gaXM6IDApXG4gICAgICogQHJldHVybiBpbnQgY3VycmVudCB3aWR0aFxuICAgICAqL1xuICAgIG9iai5nZXRXaWR0aCA9IGZ1bmN0aW9uKGNvbHVtbikge1xuICAgICAgICBpZiAoISBjb2x1bW4pIHtcbiAgICAgICAgICAgIC8vIEdldCBhbGwgaGVhZGVyc1xuICAgICAgICAgICAgdmFyIGRhdGEgPSBbXTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2JqLmhlYWRlcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBkYXRhLnB1c2gob2JqLm9wdGlvbnMuY29sdW1uc1tpXS53aWR0aCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBJbiBjYXNlIHRoZSBjb2x1bW4gaXMgYW4gb2JqZWN0XG4gICAgICAgICAgICBpZiAodHlwZW9mKGNvbHVtbikgPT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgICAgICBjb2x1bW4gPSAkKGNvbHVtbikuZ2V0QXR0cmlidXRlKCdkYXRhLXgnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZGF0YSA9IG9iai5jb2xncm91cFtjb2x1bW5dLmdldEF0dHJpYnV0ZSgnd2lkdGgnKVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0IHRoZSBjb2x1bW4gd2lkdGhcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0gaW50IGNvbHVtbiBudW1iZXIgKGZpcnN0IGNvbHVtbiBpczogMClcbiAgICAgKiBAcGFyYW0gaW50IG5ldyBjb2x1bW4gd2lkdGhcbiAgICAgKiBAcGFyYW0gaW50IG9sZCBjb2x1bW4gd2lkdGhcbiAgICAgKi9cbiAgICBvYmouc2V0V2lkdGggPSBmdW5jdGlvbiAoY29sdW1uLCB3aWR0aCwgb2xkV2lkdGgpIHtcbiAgICAgICAgaWYgKHdpZHRoID4gMCkge1xuICAgICAgICAgICAgLy8gSW4gY2FzZSB0aGUgY29sdW1uIGlzIGFuIG9iamVjdFxuICAgICAgICAgICAgaWYgKHR5cGVvZihjb2x1bW4pID09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICAgICAgY29sdW1uID0gY29sdW1uLmdldEF0dHJpYnV0ZSgnZGF0YS14Jyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIE9sZHdpZHRoXG4gICAgICAgICAgICBpZiAoISBvbGRXaWR0aCkge1xuICAgICAgICAgICAgICAgIG9sZFdpZHRoID0gb2JqLmNvbGdyb3VwW2NvbHVtbl0uZ2V0QXR0cmlidXRlKCd3aWR0aCcpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBTZXQgd2lkdGhcbiAgICAgICAgICAgIG9iai5jb2xncm91cFtjb2x1bW5dLnNldEF0dHJpYnV0ZSgnd2lkdGgnLCB3aWR0aCk7XG4gICAgICAgICAgICBvYmoub3B0aW9ucy5jb2x1bW5zW2NvbHVtbl0ud2lkdGggPSB3aWR0aDtcblxuICAgICAgICAgICAgLy8gS2VlcGluZyBoaXN0b3J5IG9mIGNoYW5nZXNcbiAgICAgICAgICAgIG9iai5zZXRIaXN0b3J5KHtcbiAgICAgICAgICAgICAgICBhY3Rpb246J3NldFdpZHRoJyxcbiAgICAgICAgICAgICAgICBjb2x1bW46Y29sdW1uLFxuICAgICAgICAgICAgICAgIG9sZFZhbHVlOm9sZFdpZHRoLFxuICAgICAgICAgICAgICAgIG5ld1ZhbHVlOndpZHRoLFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIE9uIHJlc2l6ZSBjb2x1bW5cbiAgICAgICAgICAgIGlmIChvYmouaWdub3JlRXZlbnRzICE9IHRydWUpIHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mKG9iai5vcHRpb25zLm9ucmVzaXplY29sdW1uKSA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLm9ucmVzaXplY29sdW1uKGVsLCBjb2x1bW4sIHdpZHRoLCBvbGRXaWR0aCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBVcGRhdGUgY29ybmVyIHBvc2l0aW9uXG4gICAgICAgICAgICBvYmoudXBkYXRlQ29ybmVyUG9zaXRpb24oKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldCB0aGUgcm93IGhlaWdodFxuICAgICAqIFxuICAgICAqIEBwYXJhbSByb3cgLSByb3cgbnVtYmVyIChmaXJzdCByb3cgaXM6IDApXG4gICAgICogQHBhcmFtIGhlaWdodCAtIG5ldyByb3cgaGVpZ2h0XG4gICAgICogQHBhcmFtIG9sZEhlaWdodCAtIG9sZCByb3cgaGVpZ2h0XG4gICAgICovXG4gICAgb2JqLnNldEhlaWdodCA9IGZ1bmN0aW9uIChyb3csIGhlaWdodCwgb2xkSGVpZ2h0KSB7XG4gICAgICAgIGlmIChoZWlnaHQgPiAwKSB7XG4gICAgICAgICAgICAvLyBJbiBjYXNlIHRoZSBjb2x1bW4gaXMgYW4gb2JqZWN0XG4gICAgICAgICAgICBpZiAodHlwZW9mKHJvdykgPT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgICAgICByb3cgPSByb3cuZ2V0QXR0cmlidXRlKCdkYXRhLXknKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gT2xkd2lkdGhcbiAgICAgICAgICAgIGlmICghIG9sZEhlaWdodCkge1xuICAgICAgICAgICAgICAgIG9sZEhlaWdodCA9IG9iai5yb3dzW3Jvd10uZ2V0QXR0cmlidXRlKCdoZWlnaHQnKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoISBvbGRIZWlnaHQpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVjdCA9IG9iai5yb3dzW3Jvd10uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgb2xkSGVpZ2h0ID0gcmVjdC5oZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIEludGVnZXJcclxuICAgICAgICAgICAgaGVpZ2h0ID0gcGFyc2VJbnQoaGVpZ2h0KTtcclxuXG4gICAgICAgICAgICAvLyBTZXQgd2lkdGhcbiAgICAgICAgICAgIG9iai5yb3dzW3Jvd10uc3R5bGUuaGVpZ2h0ID0gaGVpZ2h0ICsgJ3B4JztcblxuICAgICAgICAgICAgLy8gS2VlcCBvcHRpb25zIHVwZGF0ZWRcbiAgICAgICAgICAgIGlmICghIG9iai5vcHRpb25zLnJvd3Nbcm93XSkge1xuICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLnJvd3Nbcm93XSA9IHt9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb2JqLm9wdGlvbnMucm93c1tyb3ddLmhlaWdodCA9IGhlaWdodDtcblxuICAgICAgICAgICAgLy8gS2VlcGluZyBoaXN0b3J5IG9mIGNoYW5nZXNcbiAgICAgICAgICAgIG9iai5zZXRIaXN0b3J5KHtcbiAgICAgICAgICAgICAgICBhY3Rpb246J3NldEhlaWdodCcsXG4gICAgICAgICAgICAgICAgcm93OnJvdyxcbiAgICAgICAgICAgICAgICBvbGRWYWx1ZTpvbGRIZWlnaHQsXG4gICAgICAgICAgICAgICAgbmV3VmFsdWU6aGVpZ2h0LFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIE9uIHJlc2l6ZSBjb2x1bW5cbiAgICAgICAgICAgIGlmIChvYmouaWdub3JlRXZlbnRzICE9IHRydWUpIHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mKG9iai5vcHRpb25zLm9ucmVzaXplcm93KSA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLm9ucmVzaXplcm93KGVsLCByb3csIGhlaWdodCwgb2xkSGVpZ2h0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFVwZGF0ZSBjb3JuZXIgcG9zaXRpb25cbiAgICAgICAgICAgIG9iai51cGRhdGVDb3JuZXJQb3NpdGlvbigpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IHRoZSByb3cgaGVpZ2h0XG4gICAgICogXG4gICAgICogQHBhcmFtIHJvdyAtIHJvdyBudW1iZXIgKGZpcnN0IHJvdyBpczogMClcbiAgICAgKiBAcmV0dXJuIGhlaWdodCAtIGN1cnJlbnQgcm93IGhlaWdodFxuICAgICAqL1xuICAgIG9iai5nZXRIZWlnaHQgPSBmdW5jdGlvbihyb3cpIHtcbiAgICAgICAgaWYgKCEgcm93KSB7XG4gICAgICAgICAgICAvLyBHZXQgaGVpZ2h0IG9mIGFsbCByb3dzXG4gICAgICAgICAgICB2YXIgZGF0YSA9IFtdO1xuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBvYmoucm93cy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgIHZhciBoID0gb2JqLnJvd3Nbal0uc3R5bGUuaGVpZ2h0O1xuICAgICAgICAgICAgICAgIGlmIChoKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFbal0gPSBoO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIEluIGNhc2UgdGhlIHJvdyBpcyBhbiBvYmplY3RcbiAgICAgICAgICAgIGlmICh0eXBlb2Yocm93KSA9PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAgIHJvdyA9ICQocm93KS5nZXRBdHRyaWJ1dGUoJ2RhdGEteScpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgZGF0YSA9IG9iai5yb3dzW3Jvd10uc3R5bGUuaGVpZ2h0O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IHRoZSBjb2x1bW4gdGl0bGVcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0gY29sdW1uIC0gY29sdW1uIG51bWJlciAoZmlyc3QgY29sdW1uIGlzOiAwKVxuICAgICAqIEBwYXJhbSB0aXRsZSAtIG5ldyBjb2x1bW4gdGl0bGVcbiAgICAgKi9cbiAgICBvYmouZ2V0SGVhZGVyID0gZnVuY3Rpb24oY29sdW1uKSB7XG4gICAgICAgIHJldHVybiBvYmouaGVhZGVyc1tjb2x1bW5dLmlubmVyVGV4dDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXQgdGhlIGNvbHVtbiB0aXRsZVxuICAgICAqIFxuICAgICAqIEBwYXJhbSBjb2x1bW4gLSBjb2x1bW4gbnVtYmVyIChmaXJzdCBjb2x1bW4gaXM6IDApXG4gICAgICogQHBhcmFtIHRpdGxlIC0gbmV3IGNvbHVtbiB0aXRsZVxuICAgICAqL1xuICAgIG9iai5zZXRIZWFkZXIgPSBmdW5jdGlvbihjb2x1bW4sIG5ld1ZhbHVlKSB7XG4gICAgICAgIGlmIChvYmouaGVhZGVyc1tjb2x1bW5dKSB7XG4gICAgICAgICAgICB2YXIgb2xkVmFsdWUgPSBvYmouaGVhZGVyc1tjb2x1bW5dLmlubmVyVGV4dDtcblxuICAgICAgICAgICAgaWYgKCEgbmV3VmFsdWUpIHtcbiAgICAgICAgICAgICAgICBuZXdWYWx1ZSA9IHByb21wdChvYmoub3B0aW9ucy50ZXh0LmNvbHVtbk5hbWUsIG9sZFZhbHVlKVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAobmV3VmFsdWUpIHtcbiAgICAgICAgICAgICAgICBvYmouaGVhZGVyc1tjb2x1bW5dLmlubmVySFRNTCA9IG5ld1ZhbHVlO1xuICAgICAgICAgICAgICAgIC8vIEtlZXAgdGhlIHRpdGxlIHByb3BlcnR5XHJcbiAgICAgICAgICAgICAgICBvYmouaGVhZGVyc1tjb2x1bW5dLnNldEF0dHJpYnV0ZSgndGl0bGUnLCBuZXdWYWx1ZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIG9iai5zZXRIaXN0b3J5KHtcbiAgICAgICAgICAgICAgICBhY3Rpb246ICdzZXRIZWFkZXInLFxuICAgICAgICAgICAgICAgIGNvbHVtbjogY29sdW1uLFxuICAgICAgICAgICAgICAgIG9sZFZhbHVlOiBvbGRWYWx1ZSxcbiAgICAgICAgICAgICAgICBuZXdWYWx1ZTogbmV3VmFsdWVcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBPbiBjaGFuZ2VcbiAgICAgICAgICAgIGlmICghIG9iai5pZ25vcmVFdmVudHMpIHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mKG9iai5vcHRpb25zLm9uY2hhbmdlaGVhZGVyKSA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLm9uY2hhbmdlaGVhZGVyKGVsLCBjb2x1bW4sIG9sZFZhbHVlLCBuZXdWYWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IHRoZSBoZWFkZXJzXG4gICAgICogXG4gICAgICogQHBhcmFtIGFzQXJyYXlcbiAgICAgKiBAcmV0dXJuIG1peGVkXG4gICAgICovXG4gICAgb2JqLmdldEhlYWRlcnMgPSBmdW5jdGlvbiAoYXNBcnJheSkge1xuICAgICAgICB2YXIgdGl0bGUgPSBbXTtcblxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iai5oZWFkZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB0aXRsZS5wdXNoKG9iai5nZXRIZWFkZXIoaSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGFzQXJyYXkgPyB0aXRsZSA6IHRpdGxlLmpvaW4ob2JqLm9wdGlvbnMuY3N2RGVsaW1pdGVyKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgbWV0YSBpbmZvcm1hdGlvbiBmcm9tIGNlbGwocylcbiAgICAgKiBcbiAgICAgKiBAcmV0dXJuIGludGVnZXJcbiAgICAgKi9cbiAgICBvYmouZ2V0TWV0YSA9IGZ1bmN0aW9uKGNlbGwsIGtleSkge1xuICAgICAgICBpZiAoISBjZWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gb2JqLm9wdGlvbnMubWV0YTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChrZXkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gb2JqLm9wdGlvbnMubWV0YVtjZWxsXSAmJiBvYmoub3B0aW9ucy5tZXRhW2NlbGxdW2tleV0gPyBvYmoub3B0aW9ucy5tZXRhW2NlbGxdW2tleV0gOiBudWxsO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gb2JqLm9wdGlvbnMubWV0YVtjZWxsXSA/IG9iai5vcHRpb25zLm1ldGFbY2VsbF0gOiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0IG1ldGEgaW5mb3JtYXRpb24gdG8gY2VsbChzKVxuICAgICAqIFxuICAgICAqIEByZXR1cm4gaW50ZWdlclxuICAgICAqL1xuICAgIG9iai5zZXRNZXRhID0gZnVuY3Rpb24obywgaywgdikge1xuICAgICAgICBpZiAoISBvYmoub3B0aW9ucy5tZXRhKSB7XG4gICAgICAgICAgICBvYmoub3B0aW9ucy5tZXRhID0ge31cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChrICYmIHYpIHtcbiAgICAgICAgICAgIC8vIFNldCBkYXRhIHZhbHVlXG4gICAgICAgICAgICBpZiAoISBvYmoub3B0aW9ucy5tZXRhW29dKSB7XG4gICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMubWV0YVtvXSA9IHt9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb2JqLm9wdGlvbnMubWV0YVtvXVtrXSA9IHY7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBBcHBseSB0aGF0IGZvciBhbGwgY2VsbHNcbiAgICAgICAgICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMobyk7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoISBvYmoub3B0aW9ucy5tZXRhW2tleXNbaV1dKSB7XG4gICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLm1ldGFba2V5c1tpXV0gPSB7fTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgcHJvcCA9IE9iamVjdC5rZXlzKG9ba2V5c1tpXV0pO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgcHJvcC5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5tZXRhW2tleXNbaV1dW3Byb3Bbal1dID0gb1trZXlzW2ldXVtwcm9wW2pdXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAob2JqLmlnbm9yZUV2ZW50cyAhPSB0cnVlKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mKG9iai5vcHRpb25zLm9uY2hhbmdlbWV0YSkgPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLm9uY2hhbmdlbWV0YShlbCwgbywgaywgdik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVcGRhdGUgbWV0YSBpbmZvcm1hdGlvblxuICAgICAqIFxuICAgICAqIEByZXR1cm4gaW50ZWdlclxuICAgICAqL1xuICAgIG9iai51cGRhdGVNZXRhID0gZnVuY3Rpb24oYWZmZWN0ZWRDZWxscykge1xuICAgICAgICBpZiAob2JqLm9wdGlvbnMubWV0YSkge1xuICAgICAgICAgICAgdmFyIG5ld01ldGEgPSB7fTtcbiAgICAgICAgICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqLm9wdGlvbnMubWV0YSk7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoYWZmZWN0ZWRDZWxsc1trZXlzW2ldXSkge1xuICAgICAgICAgICAgICAgICAgICBuZXdNZXRhW2FmZmVjdGVkQ2VsbHNba2V5c1tpXV1dID0gb2JqLm9wdGlvbnMubWV0YVtrZXlzW2ldXTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBuZXdNZXRhW2tleXNbaV1dID0gb2JqLm9wdGlvbnMubWV0YVtrZXlzW2ldXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBVcGRhdGUgbWV0YSBpbmZvcm1hdGlvblxuICAgICAgICAgICAgb2JqLm9wdGlvbnMubWV0YSA9IG5ld01ldGE7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgc3R5bGUgaW5mb3JtYXRpb24gZnJvbSBjZWxsKHMpXG4gICAgICogXG4gICAgICogQHJldHVybiBpbnRlZ2VyXG4gICAgICovXG4gICAgb2JqLmdldFN0eWxlID0gZnVuY3Rpb24oY2VsbCwga2V5KSB7XG4gICAgICAgIC8vIENlbGxcbiAgICAgICAgaWYgKCEgY2VsbCkge1xuICAgICAgICAgICAgLy8gQ29udHJvbCB2YXJzXG4gICAgICAgICAgICB2YXIgZGF0YSA9IHt9O1xuXG4gICAgICAgICAgICAvLyBDb2x1bW4gYW5kIHJvdyBsZW5ndGhcbiAgICAgICAgICAgIHZhciB4ID0gb2JqLm9wdGlvbnMuZGF0YVswXS5sZW5ndGg7XG4gICAgICAgICAgICB2YXIgeSA9IG9iai5vcHRpb25zLmRhdGEubGVuZ3RoO1xuXG4gICAgICAgICAgICAvLyBHbyB0aHJvdWdoIHRoZSBjb2x1bW5zIHRvIGdldCB0aGUgZGF0YVxuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB5OyBqKyspIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAvLyBWYWx1ZVxuICAgICAgICAgICAgICAgICAgICB2YXIgdiA9IGtleSA/IG9iai5yZWNvcmRzW2pdW2ldLnN0eWxlW2tleV0gOiBvYmoucmVjb3Jkc1tqXVtpXS5nZXRBdHRyaWJ1dGUoJ3N0eWxlJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gQW55IG1ldGEgZGF0YSBmb3IgdGhpcyBjb2x1bW4/XG4gICAgICAgICAgICAgICAgICAgIGlmICh2KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBDb2x1bW4gbmFtZVxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGsgPSBqZXhjZWwuZ2V0Q29sdW1uTmFtZUZyb21JZChbaSwgal0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVmFsdWVcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFba10gPSB2O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY2VsbCA9IGpleGNlbC5nZXRJZEZyb21Db2x1bW5OYW1lKGNlbGwsIHRydWUpO1xuXG4gICAgICAgICAgICByZXR1cm4ga2V5ID8gb2JqLnJlY29yZHNbY2VsbFsxXV1bY2VsbFswXV0uc3R5bGVba2V5XSA6IG9iai5yZWNvcmRzW2NlbGxbMV1dW2NlbGxbMF1dLmdldEF0dHJpYnV0ZSgnc3R5bGUnKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBvYmoucmVzZXRTdHlsZSA9IGZ1bmN0aW9uKG8sIGlnbm9yZUhpc3RvcnlBbmRFdmVudHMpIHtcbiAgICAgICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvKTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAvLyBQb3NpdGlvblxuICAgICAgICAgICAgdmFyIGNlbGwgPSBqZXhjZWwuZ2V0SWRGcm9tQ29sdW1uTmFtZShrZXlzW2ldLCB0cnVlKTtcbiAgICAgICAgICAgIGlmIChvYmoucmVjb3Jkc1tjZWxsWzFdXSAmJiBvYmoucmVjb3Jkc1tjZWxsWzFdXVtjZWxsWzBdXSkge1xuICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW2NlbGxbMV1dW2NlbGxbMF1dLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgb2JqLnNldFN0eWxlKG8sIG51bGwsIG51bGwsIG51bGwsIGlnbm9yZUhpc3RvcnlBbmRFdmVudHMpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldCBtZXRhIGluZm9ybWF0aW9uIHRvIGNlbGwocylcbiAgICAgKiBcbiAgICAgKiBAcmV0dXJuIGludGVnZXJcbiAgICAgKi9cbiAgICBvYmouc2V0U3R5bGUgPSBmdW5jdGlvbihvLCBrLCB2LCBmb3JjZSwgaWdub3JlSGlzdG9yeUFuZEV2ZW50cykge1xuICAgICAgICB2YXIgbmV3VmFsdWUgPSB7fTtcbiAgICAgICAgdmFyIG9sZFZhbHVlID0ge307XG5cbiAgICAgICAgLy8gQXBwbHkgc3R5bGVcbiAgICAgICAgdmFyIGFwcGx5U3R5bGUgPSBmdW5jdGlvbihjZWxsSWQsIGtleSwgdmFsdWUpIHtcbiAgICAgICAgICAgIC8vIFBvc2l0aW9uXG4gICAgICAgICAgICB2YXIgY2VsbCA9IGpleGNlbC5nZXRJZEZyb21Db2x1bW5OYW1lKGNlbGxJZCwgdHJ1ZSk7XG5cbiAgICAgICAgICAgIGlmIChvYmoucmVjb3Jkc1tjZWxsWzFdXSAmJiBvYmoucmVjb3Jkc1tjZWxsWzFdXVtjZWxsWzBdXSkge1xuICAgICAgICAgICAgICAgIC8vIEN1cnJlbnQgdmFsdWVcbiAgICAgICAgICAgICAgICB2YXIgY3VycmVudFZhbHVlID0gb2JqLnJlY29yZHNbY2VsbFsxXV1bY2VsbFswXV0uc3R5bGVba2V5XTtcblxuICAgICAgICAgICAgICAgIC8vIENoYW5nZSBsYXlvdXRcbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudFZhbHVlID09IHZhbHVlICYmICEgZm9yY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSAnJztcbiAgICAgICAgICAgICAgICAgICAgb2JqLnJlY29yZHNbY2VsbFsxXV1bY2VsbFswXV0uc3R5bGVba2V5XSA9ICcnO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW2NlbGxbMV1dW2NlbGxbMF1dLnN0eWxlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBIaXN0b3J5XG4gICAgICAgICAgICAgICAgaWYgKCEgb2xkVmFsdWVbY2VsbElkXSkge1xuICAgICAgICAgICAgICAgICAgICBvbGRWYWx1ZVtjZWxsSWRdID0gW107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICghIG5ld1ZhbHVlW2NlbGxJZF0pIHtcbiAgICAgICAgICAgICAgICAgICAgbmV3VmFsdWVbY2VsbElkXSA9IFtdO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIG9sZFZhbHVlW2NlbGxJZF0ucHVzaChba2V5ICsgJzonICsgY3VycmVudFZhbHVlXSk7XG4gICAgICAgICAgICAgICAgbmV3VmFsdWVbY2VsbElkXS5wdXNoKFtrZXkgKyAnOicgKyB2YWx1ZV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGsgJiYgdikge1xuICAgICAgICAgICAgLy8gR2V0IG9iamVjdCBmcm9tIHN0cmluZ1xuICAgICAgICAgICAgaWYgKHR5cGVvZihvKSA9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIGFwcGx5U3R5bGUobywgaywgdik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIEF2b2lkIGR1cGxpY2F0aW9uc1xuICAgICAgICAgICAgICAgIHZhciBvbmVBcHBsaWNhdGlvbiA9IFtdO1xuICAgICAgICAgICAgICAgIC8vIEFwcGx5IHRoYXQgZm9yIGFsbCBjZWxsc1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgby5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgeCA9IG9baV0uZ2V0QXR0cmlidXRlKCdkYXRhLXgnKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHkgPSBvW2ldLmdldEF0dHJpYnV0ZSgnZGF0YS15Jyk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjZWxsTmFtZSA9IGpleGNlbC5nZXRDb2x1bW5OYW1lRnJvbUlkKFt4LCB5XSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgaGFwcGVucyB3aGVuIGlzIGEgbWVyZ2VkIGNlbGxcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEgb25lQXBwbGljYXRpb25bY2VsbE5hbWVdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcHBseVN0eWxlKGNlbGxOYW1lLCBrLCB2KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uZUFwcGxpY2F0aW9uW2NlbGxOYW1lXSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG8pO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIHN0eWxlID0gb1trZXlzW2ldXTtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mKHN0eWxlKSA9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgICAgICBzdHlsZSA9IHN0eWxlLnNwbGl0KCc7Jyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgc3R5bGUubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZihzdHlsZVtqXSkgPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlW2pdID0gc3R5bGVbal0uc3BsaXQoJzonKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyBBcHBseSB2YWx1ZVxuICAgICAgICAgICAgICAgICAgICBpZiAoc3R5bGVbal1bMF0udHJpbSgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcHBseVN0eWxlKGtleXNbaV0sIHN0eWxlW2pdWzBdLnRyaW0oKSwgc3R5bGVbal1bMV0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvbGRWYWx1ZSk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgb2xkVmFsdWVba2V5c1tpXV0gPSBvbGRWYWx1ZVtrZXlzW2ldXS5qb2luKCc7Jyk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhuZXdWYWx1ZSk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgbmV3VmFsdWVba2V5c1tpXV0gPSBuZXdWYWx1ZVtrZXlzW2ldXS5qb2luKCc7Jyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoISBpZ25vcmVIaXN0b3J5QW5kRXZlbnRzKSB7XG4gICAgICAgICAgICAvLyBLZWVwaW5nIGhpc3Rvcnkgb2YgY2hhbmdlc1xuICAgICAgICAgICAgb2JqLnNldEhpc3Rvcnkoe1xuICAgICAgICAgICAgICAgIGFjdGlvbjogJ3NldFN0eWxlJyxcbiAgICAgICAgICAgICAgICBvbGRWYWx1ZTogb2xkVmFsdWUsXG4gICAgICAgICAgICAgICAgbmV3VmFsdWU6IG5ld1ZhbHVlLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAob2JqLmlnbm9yZUV2ZW50cyAhPSB0cnVlKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mKG9iai5vcHRpb25zLm9uY2hhbmdlc3R5bGUpID09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5vbmNoYW5nZXN0eWxlKGVsLCBvLCBrLCB2KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBjZWxsIGNvbW1lbnRzLCBudWxsIGNlbGwgZm9yIGFsbFxuICAgICAqL1xuICAgIG9iai5nZXRDb21tZW50cyA9IGZ1bmN0aW9uKGNlbGwsIHdpdGhBdXRob3IpIHtcbiAgICAgICAgaWYgKGNlbGwpIHtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZihjZWxsKSA9PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgIHZhciBjZWxsID0gamV4Y2VsLmdldElkRnJvbUNvbHVtbk5hbWUoY2VsbCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh3aXRoQXV0aG9yKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gW29iai5yZWNvcmRzW2NlbGxbMV1dW2NlbGxbMF1dLmdldEF0dHJpYnV0ZSgndGl0bGUnKSwgb2JqLnJlY29yZHNbY2VsbFsxXV1bY2VsbFswXV0uZ2V0QXR0cmlidXRlKCdhdXRob3InKV07XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb2JqLnJlY29yZHNbY2VsbFsxXV1bY2VsbFswXV0uZ2V0QXR0cmlidXRlKCd0aXRsZScpIHx8ICcnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdmFyIGRhdGEgPSB7fTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBvYmoub3B0aW9ucy5kYXRhLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iai5vcHRpb25zLmNvbHVtbnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY29tbWVudHMgPSBvYmoucmVjb3Jkc1tqXVtpXS5nZXRBdHRyaWJ1dGUoJ3RpdGxlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbW1lbnRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjZWxsID0gamV4Y2VsLmdldENvbHVtbk5hbWVGcm9tSWQoW2ksIGpdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVtjZWxsXSA9IGNvbW1lbnRzO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0IGNlbGwgY29tbWVudHNcbiAgICAgKi9cbiAgICBvYmouc2V0Q29tbWVudHMgPSBmdW5jdGlvbihjZWxsSWQsIGNvbW1lbnRzLCBhdXRob3IpIHtcbiAgICAgICAgaWYgKHR5cGVvZihjZWxsSWQpID09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICB2YXIgY2VsbCA9IGpleGNlbC5nZXRJZEZyb21Db2x1bW5OYW1lKGNlbGxJZCwgdHJ1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgY2VsbCA9IGNlbGxJZDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEtlZXAgb2xkIHZhbHVlXG4gICAgICAgIHZhciB0aXRsZSA9IG9iai5yZWNvcmRzW2NlbGxbMV1dW2NlbGxbMF1dLmdldEF0dHJpYnV0ZSgndGl0bGUnKTtcbiAgICAgICAgdmFyIGF1dGhvciA9IG9iai5yZWNvcmRzW2NlbGxbMV1dW2NlbGxbMF1dLmdldEF0dHJpYnV0ZSgnZGF0YS1hdXRob3InKTtcbiAgICAgICAgdmFyIG9sZFZhbHVlID0gWyB0aXRsZSwgYXV0aG9yIF07XG5cbiAgICAgICAgLy8gU2V0IG5ldyB2YWx1ZXNcbiAgICAgICAgb2JqLnJlY29yZHNbY2VsbFsxXV1bY2VsbFswXV0uc2V0QXR0cmlidXRlKCd0aXRsZScsIGNvbW1lbnRzID8gY29tbWVudHMgOiAnJyk7XG4gICAgICAgIG9iai5yZWNvcmRzW2NlbGxbMV1dW2NlbGxbMF1dLnNldEF0dHJpYnV0ZSgnZGF0YS1hdXRob3InLCBhdXRob3IgPyBhdXRob3IgOiAnJyk7XG5cbiAgICAgICAgLy8gUmVtb3ZlIGNsYXNzIGlmIHRoZXJlIGlzIG5vIGNvbW1lbnRcbiAgICAgICAgaWYgKGNvbW1lbnRzKSB7XG4gICAgICAgICAgICBvYmoucmVjb3Jkc1tjZWxsWzFdXVtjZWxsWzBdXS5jbGFzc0xpc3QuYWRkKCdqZXhjZWxfY29tbWVudHMnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG9iai5yZWNvcmRzW2NlbGxbMV1dW2NlbGxbMF1dLmNsYXNzTGlzdC5yZW1vdmUoJ2pleGNlbF9jb21tZW50cycpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gU2F2ZSBoaXN0b3J5XG4gICAgICAgIG9iai5zZXRIaXN0b3J5KHtcbiAgICAgICAgICAgIGFjdGlvbjonc2V0Q29tbWVudHMnLFxuICAgICAgICAgICAgY29sdW1uOiBjZWxsSWQsXG4gICAgICAgICAgICBuZXdWYWx1ZTogWyBjb21tZW50cywgYXV0aG9yIF0sXG4gICAgICAgICAgICBvbGRWYWx1ZTogb2xkVmFsdWUsXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCB0YWJsZSBjb25maWcgaW5mb3JtYXRpb25cbiAgICAgKi9cbiAgICBvYmouZ2V0Q29uZmlnID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBvcHRpb25zID0gb2JqLm9wdGlvbnM7XG4gICAgICAgIG9wdGlvbnMuc3R5bGUgPSBvYmouZ2V0U3R5bGUoKTtcbiAgICAgICAgb3B0aW9ucy5tZXJnZUNlbGxzID0gb2JqLmdldE1lcmdlKCk7XHJcbiAgICAgICAgb3B0aW9ucy5jb21tZW50cyA9IG9iai5nZXRDb21tZW50cygpO1xuXG4gICAgICAgIHJldHVybiBvcHRpb25zO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNvcnQgZGF0YSBhbmQgcmVsb2FkIHRhYmxlXG4gICAgICovXG4gICAgb2JqLm9yZGVyQnkgPSBmdW5jdGlvbihjb2x1bW4sIG9yZGVyKSB7XG4gICAgICAgIGlmIChjb2x1bW4gPj0gMCkge1xuICAgICAgICAgICAgLy8gTWVyZ2VkIGNlbGxzXG4gICAgICAgICAgICBpZiAoT2JqZWN0LmtleXMob2JqLm9wdGlvbnMubWVyZ2VDZWxscykubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGlmICghIGNvbmZpcm0ob2JqLm9wdGlvbnMudGV4dC50aGlzQWN0aW9uV2lsbERlc3Ryb3lBbnlFeGlzdGluZ01lcmdlZENlbGxzQXJlWW91U3VyZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBtZXJnZWQgY2VsbHNcbiAgICAgICAgICAgICAgICAgICAgb2JqLmRlc3Ryb3lNZXJnZWQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIERpcmVjdGlvblxuICAgICAgICAgICAgaWYgKG9yZGVyID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBvcmRlciA9IG9iai5oZWFkZXJzW2NvbHVtbl0uY2xhc3NMaXN0LmNvbnRhaW5zKCdhcnJvdy1kb3duJykgPyAxIDogMDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgb3JkZXIgPSBvcmRlciA/IDEgOiAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBGaWx0ZXJcbiAgICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5vcmRlckJ5ID0gZnVuY3Rpb24ocCwgbykge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNsaWNlKDApLnNvcnQoZnVuY3Rpb24oYSwgYikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWVBID0gYVtwXSA9PSAnJyA/ICcnIDogTnVtYmVyKGFbcF0pID09IGFbcF0gPyBOdW1iZXIoYVtwXSkgOiBhW3BdLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZUIgPSBiW3BdID09ICcnID8gJycgOiBOdW1iZXIoYltwXSkgPT0gYltwXSA/IE51bWJlcihiW3BdKSA6IGJbcF0udG9Mb3dlckNhc2UoKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoISBvKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKHZhbHVlQSA9PSAnJyAmJiB2YWx1ZUIgIT0gJycpID8gMSA6ICh2YWx1ZUEgIT0gJycgJiYgdmFsdWVCID09ICcnKSA/IC0xIDogKHZhbHVlQSA+IHZhbHVlQikgPyAxIDogKHZhbHVlQSA8IHZhbHVlQikgPyAtMSA6ICAwO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICh2YWx1ZUEgPT0gJycgJiYgdmFsdWVCICE9ICcnKSA/IDEgOiAodmFsdWVBICE9ICcnICYmIHZhbHVlQiA9PSAnJykgPyAtMSA6ICh2YWx1ZUEgPiB2YWx1ZUIpID8gLTEgOiAodmFsdWVBIDwgdmFsdWVCKSA/IDEgOiAgMDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBUZXN0IG9yZGVyXG4gICAgICAgICAgICB2YXIgdGVtcCA9IFtdO1xuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbY29sdW1uXS50eXBlID09ICdjYWxlbmRhcicgfHxcbiAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5jb2x1bW5zW2NvbHVtbl0udHlwZSA9PSAnY2hlY2tib3gnIHx8XG4gICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMuY29sdW1uc1tjb2x1bW5dLnR5cGUgPT0gJ3JhZGlvJykge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgb2JqLm9wdGlvbnMuZGF0YS5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICB0ZW1wW2pdID0gWyBqLCBvYmoub3B0aW9ucy5kYXRhW2pdW2NvbHVtbl0gXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgb2JqLm9wdGlvbnMuZGF0YS5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICB0ZW1wW2pdID0gWyBqLCBvYmoucmVjb3Jkc1tqXVtjb2x1bW5dLmlubmVySFRNTCBdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRlbXAgPSB0ZW1wLm9yZGVyQnkoMSwgb3JkZXIpO1xuXG4gICAgICAgICAgICAvLyBTYXZlIGhpc3RvcnlcbiAgICAgICAgICAgIHZhciBuZXdWYWx1ZSA9IFtdO1xuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB0ZW1wLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgbmV3VmFsdWVbal0gPSB0ZW1wW2pdWzBdO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBTYXZlIGhpc3RvcnlcbiAgICAgICAgICAgIG9iai5zZXRIaXN0b3J5KHtcbiAgICAgICAgICAgICAgICBhY3Rpb246ICdvcmRlckJ5JyxcbiAgICAgICAgICAgICAgICByb3dzOiBuZXdWYWx1ZSxcbiAgICAgICAgICAgICAgICBjb2x1bW46IGNvbHVtbixcbiAgICAgICAgICAgICAgICBvcmRlcjogb3JkZXIsXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gVXBkYXRlIG9yZGVyXG4gICAgICAgICAgICBvYmoudXBkYXRlT3JkZXJBcnJvdyhjb2x1bW4sIG9yZGVyKTtcbiAgICAgICAgICAgIG9iai51cGRhdGVPcmRlcihuZXdWYWx1ZSk7XG5cbiAgICAgICAgICAgIC8vIE9uIHNvcnQgZXZlbnRcbiAgICAgICAgICAgIGlmIChvYmouaWdub3JlRXZlbnRzICE9IHRydWUpIHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mKG9iai5vcHRpb25zLm9uc29ydCkgPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5vbnNvcnQoZWwsIGNvbHVtbiwgb3JkZXIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVcGRhdGUgb3JkZXIgYXJyb3dcbiAgICAgKi9cbiAgICBvYmoudXBkYXRlT3JkZXJBcnJvdyA9IGZ1bmN0aW9uKGNvbHVtbiwgb3JkZXIpIHtcbiAgICAgICAgLy8gUmVtb3ZlIG9yZGVyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2JqLmhlYWRlcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIG9iai5oZWFkZXJzW2ldLmNsYXNzTGlzdC5yZW1vdmUoJ2Fycm93LXVwJyk7XG4gICAgICAgICAgICBvYmouaGVhZGVyc1tpXS5jbGFzc0xpc3QucmVtb3ZlKCdhcnJvdy1kb3duJyk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBObyBvcmRlciBzcGVjaWZpZWQgdGhlbiB0b2dnbGUgb3JkZXJcbiAgICAgICAgaWYgKG9yZGVyKSB7XG4gICAgICAgICAgICBvYmouaGVhZGVyc1tjb2x1bW5dLmNsYXNzTGlzdC5hZGQoJ2Fycm93LXVwJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBvYmouaGVhZGVyc1tjb2x1bW5dLmNsYXNzTGlzdC5hZGQoJ2Fycm93LWRvd24nKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZSByb3dzIHBvc2l0aW9uXG4gICAgICovXG4gICAgb2JqLnVwZGF0ZU9yZGVyID0gZnVuY3Rpb24ocm93cykge1xuICAgICAgICAvLyBIaXN0b3J5XG4gICAgICAgIHZhciBkYXRhID0gW11cbiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCByb3dzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICBkYXRhW2pdID0gb2JqLm9wdGlvbnMuZGF0YVtyb3dzW2pdXTtcbiAgICAgICAgfVxuICAgICAgICBvYmoub3B0aW9ucy5kYXRhID0gZGF0YTtcblxuICAgICAgICB2YXIgZGF0YSA9IFtdXG4gICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgcm93cy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgZGF0YVtqXSA9IG9iai5yZWNvcmRzW3Jvd3Nbal1dO1xuICAgICAgICB9XG4gICAgICAgIG9iai5yZWNvcmRzID0gZGF0YTtcblxuICAgICAgICB2YXIgZGF0YSA9IFtdXG4gICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgcm93cy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgZGF0YVtqXSA9IG9iai5yb3dzW3Jvd3Nbal1dO1xuICAgICAgICB9XG4gICAgICAgIG9iai5yb3dzID0gZGF0YTtcblxuICAgICAgICAvLyBVcGRhdGUgcmVmZXJlbmNlc1xuICAgICAgICBvYmoudXBkYXRlVGFibGVSZWZlcmVuY2VzKCk7XG5cbiAgICAgICAgLy8gUmVkbyBzZWFyY2hcbiAgICAgICAgaWYgKG9iai5zZWFyY2hJbnB1dC52YWx1ZSkge1xuICAgICAgICAgICAgb2JqLnNlYXJjaChvYmouc2VhcmNoSW5wdXQudmFsdWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gQ3JlYXRlIHBhZ2VcbiAgICAgICAgICAgIG9iai5yZXN1bHRzID0gbnVsbDtcbiAgICAgICAgICAgIG9iai5wYWdlTnVtYmVyID0gMDtcblxuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLnBhZ2luYXRpb24gPiAwKSB7XG4gICAgICAgICAgICAgICAgb2JqLnBhZ2UoMCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG9iai5vcHRpb25zLmxhenlMb2FkaW5nID09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBvYmoubG9hZFBhZ2UoMCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgb2JqLnJvd3MubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgb2JqLnRib2R5LmFwcGVuZENoaWxkKG9iai5yb3dzW2pdKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBNb3ZlIHJvd1xuICAgICAqIFxuICAgICAqIEByZXR1cm4gdm9pZFxuICAgICAqL1xuICAgIG9iai5tb3ZlUm93ID0gZnVuY3Rpb24obywgZCwgaWdub3JlRG9tKSB7XG4gICAgICAgIGlmIChPYmplY3Qua2V5cyhvYmoub3B0aW9ucy5tZXJnZUNlbGxzKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgIGlmIChvID4gZCkge1xyXG4gICAgICAgICAgICAgICB2YXIgaW5zZXJ0QmVmb3JlID0gMTtcclxuICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICB2YXIgaW5zZXJ0QmVmb3JlID0gMDtcclxuICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgIGlmIChvYmouaXNSb3dNZXJnZWQobykubGVuZ3RoIHx8IG9iai5pc1Jvd01lcmdlZChkLCBpbnNlcnRCZWZvcmUpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGlmICghIGNvbmZpcm0ob2JqLm9wdGlvbnMudGV4dC50aGlzQWN0aW9uV2lsbERlc3Ryb3lBbnlFeGlzdGluZ01lcmdlZENlbGxzQXJlWW91U3VyZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIG9iai5kZXN0cm95TWVyZ2VkKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG9iai5vcHRpb25zLnNlYXJjaCA9PSB0cnVlKSB7XG4gICAgICAgICAgICBpZiAob2JqLnJlc3VsdHMgJiYgb2JqLnJlc3VsdHMubGVuZ3RoICE9IG9iai5yb3dzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGlmIChjb25maXJtKG9iai5vcHRpb25zLnRleHQudGhpc0FjdGlvbldpbGxDbGVhcllvdXJTZWFyY2hSZXN1bHRzQXJlWW91U3VyZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgb2JqLnJlc2V0U2VhcmNoKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgb2JqLnJlc3VsdHMgPSBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCEgaWdub3JlRG9tKSB7XG4gICAgICAgICAgICBpZiAoQXJyYXkucHJvdG90eXBlLmluZGV4T2YuY2FsbChvYmoudGJvZHkuY2hpbGRyZW4sIG9iai5yb3dzW2RdKSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKG8gPiBkKSB7XG4gICAgICAgICAgICAgICAgICAgIG9iai50Ym9keS5pbnNlcnRCZWZvcmUob2JqLnJvd3Nbb10sIG9iai5yb3dzW2RdKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBvYmoudGJvZHkuaW5zZXJ0QmVmb3JlKG9iai5yb3dzW29dLCBvYmoucm93c1tkXS5uZXh0U2libGluZyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBvYmoudGJvZHkucmVtb3ZlQ2hpbGQob2JqLnJvd3Nbb10pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gUGxhY2UgcmVmZXJlbmNlcyBpbiB0aGUgY29ycmVjdCBwb3NpdGlvblxuICAgICAgICBvYmoucm93cy5zcGxpY2UoZCwgMCwgb2JqLnJvd3Muc3BsaWNlKG8sIDEpWzBdKTtcbiAgICAgICAgb2JqLnJlY29yZHMuc3BsaWNlKGQsIDAsIG9iai5yZWNvcmRzLnNwbGljZShvLCAxKVswXSk7XG4gICAgICAgIG9iai5vcHRpb25zLmRhdGEuc3BsaWNlKGQsIDAsIG9iai5vcHRpb25zLmRhdGEuc3BsaWNlKG8sIDEpWzBdKTtcblxuICAgICAgICAvLyBSZXNwZWN0IHBhZ2luYXRpb25cbiAgICAgICAgaWYgKG9iai5vcHRpb25zLnBhZ2luYXRpb24gPiAwICYmIG9iai50Ym9keS5jaGlsZHJlbi5sZW5ndGggIT0gb2JqLm9wdGlvbnMucGFnaW5hdGlvbikge1xuICAgICAgICAgICAgb2JqLnBhZ2Uob2JqLnBhZ2VOdW1iZXIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gS2VlcGluZyBoaXN0b3J5IG9mIGNoYW5nZXNcbiAgICAgICAgb2JqLnNldEhpc3Rvcnkoe1xuICAgICAgICAgICAgYWN0aW9uOidtb3ZlUm93JyxcbiAgICAgICAgICAgIG9sZFZhbHVlOiBvLFxuICAgICAgICAgICAgbmV3VmFsdWU6IGQsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFVwZGF0ZSB0YWJsZSByZWZlcmVuY2VzXG4gICAgICAgIG9iai51cGRhdGVUYWJsZVJlZmVyZW5jZXMoKTtcblxuICAgICAgICAvLyBFdmVudHNcbiAgICAgICAgaWYgKG9iai5pZ25vcmVFdmVudHMgIT0gdHJ1ZSkge1xuICAgICAgICAgICAgaWYgKHR5cGVvZihvYmoub3B0aW9ucy5vbm1vdmVyb3cpID09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5vbm1vdmVyb3coZWwsIG8sIGQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSW5zZXJ0IGEgbmV3IHJvd1xuICAgICAqIFxuICAgICAqIEBwYXJhbSBtaXhlZCAtIG51bWJlciBvZiBibGFuayBsaW5lcyB0byBiZSBpbnNlcnQgb3IgYSBzaW5nbGUgYXJyYXkgd2l0aCB0aGUgZGF0YSBvZiB0aGUgbmV3IHJvd1xuICAgICAqIEBwYXJhbSByb3dOdW1iZXJcbiAgICAgKiBAcGFyYW0gaW5zZXJ0QmVmb3JlXG4gICAgICogQHJldHVybiB2b2lkXG4gICAgICovXG4gICAgb2JqLmluc2VydFJvdyA9IGZ1bmN0aW9uKG1peGVkLCByb3dOdW1iZXIsIGluc2VydEJlZm9yZSkge1xuICAgICAgICAvLyBDb25maWd1cmF0aW9uXG4gICAgICAgIGlmIChvYmoub3B0aW9ucy5hbGxvd0luc2VydFJvdyA9PSB0cnVlKSB7XG4gICAgICAgICAgICAvLyBSZWNvcmRzXG4gICAgICAgICAgICB2YXIgcmVjb3JkcyA9IFtdO1xuXG4gICAgICAgICAgICAvLyBEYXRhIHRvIGJlIGluc2VydFxuICAgICAgICAgICAgdmFyIGRhdGEgPSBbXTtcblxuICAgICAgICAgICAgLy8gVGhlIGluc2VydCBjb3VsZCBiZSBsZWFkIGJ5IG51bWJlciBvZiByb3dzIG9yIHRoZSBhcnJheSBvZiBkYXRhXG4gICAgICAgICAgICBpZiAobWl4ZWQgPiAwKSB7XG4gICAgICAgICAgICAgICAgdmFyIG51bU9mUm93cyA9IG1peGVkO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgbnVtT2ZSb3dzID0gMTtcblxuICAgICAgICAgICAgICAgIGlmIChtaXhlZCkge1xuICAgICAgICAgICAgICAgICAgICBkYXRhID0gbWl4ZWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBEaXJlY3Rpb25cbiAgICAgICAgICAgIHZhciBpbnNlcnRCZWZvcmUgPSBpbnNlcnRCZWZvcmUgPyB0cnVlIDogZmFsc2U7XG5cbiAgICAgICAgICAgIC8vIEN1cnJlbnQgY29sdW1uIG51bWJlclxuICAgICAgICAgICAgdmFyIGxhc3RSb3cgPSBvYmoub3B0aW9ucy5kYXRhLmxlbmd0aCAtIDE7XG5cbiAgICAgICAgICAgIGlmIChyb3dOdW1iZXIgPT0gdW5kZWZpbmVkIHx8IHJvd051bWJlciA+PSBwYXJzZUludChsYXN0Um93KSB8fCByb3dOdW1iZXIgPCAwKSB7XG4gICAgICAgICAgICAgICAgcm93TnVtYmVyID0gbGFzdFJvdztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gT25iZWZvcmVpbnNlcnRyb3dcbiAgICAgICAgICAgIGlmICh0eXBlb2Yob2JqLm9wdGlvbnMub25iZWZvcmVpbnNlcnRyb3cpID09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBpZiAoISBvYmoub3B0aW9ucy5vbmJlZm9yZWluc2VydHJvdyhlbCwgcm93TnVtYmVyLCBudW1PZlJvd3MsIGluc2VydEJlZm9yZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ29uYmVmb3JlaW5zZXJ0cm93IHJldHVybmVkIGZhbHNlJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gTWVyZ2VkIGNlbGxzXG4gICAgICAgICAgICBpZiAoT2JqZWN0LmtleXMob2JqLm9wdGlvbnMubWVyZ2VDZWxscykubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGlmIChvYmouaXNSb3dNZXJnZWQocm93TnVtYmVyLCBpbnNlcnRCZWZvcmUpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoISBjb25maXJtKG9iai5vcHRpb25zLnRleHQudGhpc0FjdGlvbldpbGxEZXN0cm95QW55RXhpc3RpbmdNZXJnZWRDZWxsc0FyZVlvdVN1cmUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouZGVzdHJveU1lcmdlZCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBDbGVhciBhbnkgc2VhcmNoXG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuc2VhcmNoID09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBpZiAob2JqLnJlc3VsdHMgJiYgb2JqLnJlc3VsdHMubGVuZ3RoICE9IG9iai5yb3dzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlybShvYmoub3B0aW9ucy50ZXh0LnRoaXNBY3Rpb25XaWxsQ2xlYXJZb3VyU2VhcmNoUmVzdWx0c0FyZVlvdVN1cmUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVzZXRTZWFyY2goKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIG9iai5yZXN1bHRzID0gbnVsbDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gSW5zZXJ0YmVmb3JlXG4gICAgICAgICAgICB2YXIgcm93SW5kZXggPSAoISBpbnNlcnRCZWZvcmUpID8gcm93TnVtYmVyICsgMSA6IHJvd051bWJlcjtcblxuICAgICAgICAgICAgLy8gS2VlcCB0aGUgY3VycmVudCBkYXRhXG4gICAgICAgICAgICB2YXIgY3VycmVudFJlY29yZHMgPSBvYmoucmVjb3Jkcy5zcGxpY2Uocm93SW5kZXgpO1xuICAgICAgICAgICAgdmFyIGN1cnJlbnREYXRhID0gb2JqLm9wdGlvbnMuZGF0YS5zcGxpY2Uocm93SW5kZXgpO1xuICAgICAgICAgICAgdmFyIGN1cnJlbnRSb3dzID0gb2JqLnJvd3Muc3BsaWNlKHJvd0luZGV4KTtcblxuICAgICAgICAgICAgLy8gQWRkaW5nIGxpbmVzXG4gICAgICAgICAgICB2YXIgcm93UmVjb3JkcyA9IFtdO1xuICAgICAgICAgICAgdmFyIHJvd0RhdGEgPSBbXTtcbiAgICAgICAgICAgIHZhciByb3dOb2RlID0gW107XG5cbiAgICAgICAgICAgIGZvciAodmFyIHJvdyA9IHJvd0luZGV4OyByb3cgPCAobnVtT2ZSb3dzICsgcm93SW5kZXgpOyByb3crKykge1xuICAgICAgICAgICAgICAgIC8vIFB1c2ggZGF0YSB0byB0aGUgZGF0YSBjb250YWluZXJcbiAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5kYXRhW3Jvd10gPSBbXTtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBjb2wgPSAwOyBjb2wgPCBvYmoub3B0aW9ucy5jb2x1bW5zLmxlbmd0aDsgY29sKyspIHtcbiAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMuZGF0YVtyb3ddW2NvbF0gID0gZGF0YVtjb2xdID8gZGF0YVtjb2xdIDogJyc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIENyZWF0ZSByb3dcbiAgICAgICAgICAgICAgICB2YXIgdHIgPSBvYmouY3JlYXRlUm93KHJvdywgb2JqLm9wdGlvbnMuZGF0YVtyb3ddKTtcbiAgICAgICAgICAgICAgICAvLyBBcHBlbmQgbm9kZVxuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Um93c1swXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChBcnJheS5wcm90b3R5cGUuaW5kZXhPZi5jYWxsKG9iai50Ym9keS5jaGlsZHJlbiwgY3VycmVudFJvd3NbMF0pID49IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnRib2R5Lmluc2VydEJlZm9yZSh0ciwgY3VycmVudFJvd3NbMF0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoQXJyYXkucHJvdG90eXBlLmluZGV4T2YuY2FsbChvYmoudGJvZHkuY2hpbGRyZW4sIG9iai5yb3dzW3Jvd051bWJlcl0pID49IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnRib2R5LmFwcGVuZENoaWxkKHRyKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gUmVjb3JkIEhpc3RvcnlcbiAgICAgICAgICAgICAgICByb3dSZWNvcmRzLnB1c2gob2JqLnJlY29yZHNbcm93XSk7XG4gICAgICAgICAgICAgICAgcm93RGF0YS5wdXNoKG9iai5vcHRpb25zLmRhdGFbcm93XSk7XG4gICAgICAgICAgICAgICAgcm93Tm9kZS5wdXNoKHRyKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQ29weSB0aGUgZGF0YSBiYWNrIHRvIHRoZSBtYWluIGRhdGFcbiAgICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KG9iai5yZWNvcmRzLCBjdXJyZW50UmVjb3Jkcyk7XG4gICAgICAgICAgICBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShvYmoub3B0aW9ucy5kYXRhLCBjdXJyZW50RGF0YSk7XG4gICAgICAgICAgICBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShvYmoucm93cywgY3VycmVudFJvd3MpO1xuXG4gICAgICAgICAgICAvLyBSZXNwZWN0IHBhZ2luYXRpb25cbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5wYWdpbmF0aW9uID4gMCkge1xuICAgICAgICAgICAgICAgIG9iai5wYWdlKG9iai5wYWdlTnVtYmVyKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gS2VlcCBoaXN0b3J5XG4gICAgICAgICAgICBvYmouc2V0SGlzdG9yeSh7XG4gICAgICAgICAgICAgICAgYWN0aW9uOiAnaW5zZXJ0Um93JyxcbiAgICAgICAgICAgICAgICByb3dOdW1iZXI6IHJvd051bWJlcixcbiAgICAgICAgICAgICAgICBudW1PZlJvd3M6IG51bU9mUm93cyxcbiAgICAgICAgICAgICAgICBpbnNlcnRCZWZvcmU6IGluc2VydEJlZm9yZSxcbiAgICAgICAgICAgICAgICByb3dSZWNvcmRzOiByb3dSZWNvcmRzLFxuICAgICAgICAgICAgICAgIHJvd0RhdGE6IHJvd0RhdGEsXG4gICAgICAgICAgICAgICAgcm93Tm9kZTogcm93Tm9kZSxcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBSZW1vdmUgdGFibGUgcmVmZXJlbmNlc1xuICAgICAgICAgICAgb2JqLnVwZGF0ZVRhYmxlUmVmZXJlbmNlcygpO1xuXG4gICAgICAgICAgICAvLyBFdmVudHNcbiAgICAgICAgICAgIGlmIChvYmouaWdub3JlRXZlbnRzICE9IHRydWUpIHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mKG9iai5vcHRpb25zLm9uaW5zZXJ0cm93KSA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLm9uaW5zZXJ0cm93KGVsLCByb3dOdW1iZXIsIG51bU9mUm93cywgcm93UmVjb3JkcywgaW5zZXJ0QmVmb3JlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEZWxldGUgYSByb3cgYnkgbnVtYmVyXG4gICAgICogXG4gICAgICogQHBhcmFtIGludGVnZXIgcm93TnVtYmVyIC0gcm93IG51bWJlciB0byBiZSBleGNsdWRlZFxuICAgICAqIEBwYXJhbSBpbnRlZ2VyIG51bU9mUm93cyAtIG51bWJlciBvZiBsaW5lc1xuICAgICAqIEByZXR1cm4gdm9pZFxuICAgICAqL1xuICAgIG9iai5kZWxldGVSb3cgPSBmdW5jdGlvbihyb3dOdW1iZXIsIG51bU9mUm93cykge1xuICAgICAgICAvLyBHbG9iYWwgQ29uZmlndXJhdGlvblxuICAgICAgICBpZiAob2JqLm9wdGlvbnMuYWxsb3dEZWxldGVSb3cgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmFsbG93RGVsZXRpbmdBbGxSb3dzID09IHRydWUgfHwgb2JqLm9wdGlvbnMuZGF0YS5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgLy8gRGVsZXRlIHJvdyBkZWZpbml0aW9uc1xuICAgICAgICAgICAgICAgIGlmIChyb3dOdW1iZXIgPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBudW1iZXIgPSBvYmouZ2V0U2VsZWN0ZWRSb3dzKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCEgbnVtYmVyWzBdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByb3dOdW1iZXIgPSBvYmoub3B0aW9ucy5kYXRhLmxlbmd0aCAtIDE7XG4gICAgICAgICAgICAgICAgICAgICAgICBudW1PZlJvd3MgPSAxO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcm93TnVtYmVyID0gcGFyc2VJbnQobnVtYmVyWzBdLmdldEF0dHJpYnV0ZSgnZGF0YS15JykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbnVtT2ZSb3dzID0gbnVtYmVyLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIExhc3QgY29sdW1uXG4gICAgICAgICAgICAgICAgdmFyIGxhc3RSb3cgPSBvYmoub3B0aW9ucy5kYXRhLmxlbmd0aCAtIDE7XG5cbiAgICAgICAgICAgICAgICBpZiAocm93TnVtYmVyID09IHVuZGVmaW5lZCB8fCByb3dOdW1iZXIgPiBsYXN0Um93IHx8IHJvd051bWJlciA8IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcm93TnVtYmVyID0gbGFzdFJvdztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoISBudW1PZlJvd3MpIHtcbiAgICAgICAgICAgICAgICAgICAgbnVtT2ZSb3dzID0gMTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBEbyBub3QgZGVsZXRlIG1vcmUgdGhhbiB0aGUgbnVtYmVyIG9mIHJlY29yZWRzXG4gICAgICAgICAgICAgICAgaWYgKHJvd051bWJlciArIG51bU9mUm93cyA+PSBvYmoub3B0aW9ucy5kYXRhLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBudW1PZlJvd3MgPSBvYmoub3B0aW9ucy5kYXRhLmxlbmd0aCAtIHJvd051bWJlcjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBPbmJlZm9yZWRlbGV0ZXJvd1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2Yob2JqLm9wdGlvbnMub25iZWZvcmVkZWxldGVyb3cpID09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEgb2JqLm9wdGlvbnMub25iZWZvcmVkZWxldGVyb3coZWwsIHJvd051bWJlciwgbnVtT2ZSb3dzKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ29uYmVmb3JlZGVsZXRlcm93IHJldHVybmVkIGZhbHNlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAocGFyc2VJbnQocm93TnVtYmVyKSA+IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIE1lcmdlZCBjZWxsc1xuICAgICAgICAgICAgICAgICAgICB2YXIgbWVyZ2VFeGlzdHMgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5rZXlzKG9iai5vcHRpb25zLm1lcmdlQ2VsbHMpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHJvdyA9IHJvd051bWJlcjsgcm93IDwgcm93TnVtYmVyICsgbnVtT2ZSb3dzOyByb3crKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmouaXNSb3dNZXJnZWQocm93LCBmYWxzZSkubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lcmdlRXhpc3RzID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lcmdlRXhpc3RzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoISBjb25maXJtKG9iai5vcHRpb25zLnRleHQudGhpc0FjdGlvbldpbGxEZXN0cm95QW55RXhpc3RpbmdNZXJnZWRDZWxsc0FyZVlvdVN1cmUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouZGVzdHJveU1lcmdlZCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gQ2xlYXIgYW55IHNlYXJjaFxuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuc2VhcmNoID09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmoucmVzdWx0cyAmJiBvYmoucmVzdWx0cy5sZW5ndGggIT0gb2JqLnJvd3MubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpcm0ob2JqLm9wdGlvbnMudGV4dC50aGlzQWN0aW9uV2lsbENsZWFyWW91clNlYXJjaFJlc3VsdHNBcmVZb3VTdXJlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVzZXRTZWFyY2goKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVzdWx0cyA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgbm9kZVxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciByb3cgPSByb3dOdW1iZXI7IHJvdyA8IHJvd051bWJlciArIG51bU9mUm93czsgcm93KyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChBcnJheS5wcm90b3R5cGUuaW5kZXhPZi5jYWxsKG9iai50Ym9keS5jaGlsZHJlbiwgb2JqLnJvd3Nbcm93XSkgPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5yb3dzW3Jvd10uY2xhc3NOYW1lID0gJyc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJvd3Nbcm93XS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG9iai5yb3dzW3Jvd10pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJvd1JlY29yZHMgPSBvYmoucmVjb3Jkcy5zcGxpY2Uocm93TnVtYmVyLCBudW1PZlJvd3MpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgcm93RGF0YSA9IG9iai5vcHRpb25zLmRhdGEuc3BsaWNlKHJvd051bWJlciwgbnVtT2ZSb3dzKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJvd05vZGUgPSBvYmoucm93cy5zcGxpY2Uocm93TnVtYmVyLCBudW1PZlJvd3MpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIFJlc3BlY3QgcGFnaW5hdGlvblxuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMucGFnaW5hdGlvbiA+IDAgJiYgb2JqLnRib2R5LmNoaWxkcmVuLmxlbmd0aCAhPSBvYmoub3B0aW9ucy5wYWdpbmF0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoucGFnZShvYmoucGFnZU51bWJlcik7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgc2VsZWN0aW9uXG4gICAgICAgICAgICAgICAgICAgIG9iai5jb25kaXRpb25hbFNlbGVjdGlvblVwZGF0ZSgxLCByb3dOdW1iZXIsIChyb3dOdW1iZXIgKyBudW1PZlJvd3MpIC0gMSk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gS2VlcCBoaXN0b3J5XG4gICAgICAgICAgICAgICAgICAgIG9iai5zZXRIaXN0b3J5KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ2RlbGV0ZVJvdycsXG4gICAgICAgICAgICAgICAgICAgICAgICByb3dOdW1iZXI6IHJvd051bWJlcixcbiAgICAgICAgICAgICAgICAgICAgICAgIG51bU9mUm93czogbnVtT2ZSb3dzLFxuICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0QmVmb3JlOiAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgcm93UmVjb3Jkczogcm93UmVjb3JkcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvd0RhdGE6IHJvd0RhdGEsXG4gICAgICAgICAgICAgICAgICAgICAgICByb3dOb2RlOiByb3dOb2RlXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSB0YWJsZSByZWZlcmVuY2VzXG4gICAgICAgICAgICAgICAgICAgIG9iai51cGRhdGVUYWJsZVJlZmVyZW5jZXMoKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBFdmVudHNcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5pZ25vcmVFdmVudHMgIT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZihvYmoub3B0aW9ucy5vbmRlbGV0ZXJvdykgPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLm9uZGVsZXRlcm93KGVsLCByb3dOdW1iZXIsIG51bU9mUm93cywgcm93UmVjb3Jkcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0pFWENFTC4gSXQgaXMgbm90IHBvc3NpYmxlIHRvIGRlbGV0ZSB0aGUgbGFzdCByb3cnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuXG4gICAgLyoqXG4gICAgICogTW92ZSBjb2x1bW5cbiAgICAgKiBcbiAgICAgKiBAcmV0dXJuIHZvaWRcbiAgICAgKi9cbiAgICBvYmoubW92ZUNvbHVtbiA9IGZ1bmN0aW9uKG8sIGQpIHtcbiAgICAgICAgaWYgKE9iamVjdC5rZXlzKG9iai5vcHRpb25zLm1lcmdlQ2VsbHMpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGlmIChvID4gZCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGluc2VydEJlZm9yZSA9IDE7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaW5zZXJ0QmVmb3JlID0gMDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKG9iai5pc0NvbE1lcmdlZChvKS5sZW5ndGggfHwgb2JqLmlzQ29sTWVyZ2VkKGQsIGluc2VydEJlZm9yZSkubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoISBjb25maXJtKG9iai5vcHRpb25zLnRleHQudGhpc0FjdGlvbldpbGxEZXN0cm95QW55RXhpc3RpbmdNZXJnZWRDZWxsc0FyZVlvdVN1cmUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBvYmouZGVzdHJveU1lcmdlZCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBvID0gcGFyc2VJbnQobyk7XG4gICAgICAgIHZhciBkID0gcGFyc2VJbnQoZCk7XG5cbiAgICAgICAgaWYgKG8gPiBkKSB7XG4gICAgICAgICAgICBvYmouaGVhZGVyQ29udGFpbmVyLmluc2VydEJlZm9yZShvYmouaGVhZGVyc1tvXSwgb2JqLmhlYWRlcnNbZF0pO1xuICAgICAgICAgICAgb2JqLmNvbGdyb3VwQ29udGFpbmVyLmluc2VydEJlZm9yZShvYmouY29sZ3JvdXBbb10sIG9iai5jb2xncm91cFtkXSk7XG5cbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgb2JqLnJvd3MubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICBvYmoucm93c1tqXS5pbnNlcnRCZWZvcmUob2JqLnJlY29yZHNbal1bb10sIG9iai5yZWNvcmRzW2pdW2RdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG9iai5oZWFkZXJDb250YWluZXIuaW5zZXJ0QmVmb3JlKG9iai5oZWFkZXJzW29dLCBvYmouaGVhZGVyc1tkXS5uZXh0U2libGluZyk7XG4gICAgICAgICAgICBvYmouY29sZ3JvdXBDb250YWluZXIuaW5zZXJ0QmVmb3JlKG9iai5jb2xncm91cFtvXSwgb2JqLmNvbGdyb3VwW2RdLm5leHRTaWJsaW5nKTtcblxuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBvYmoucm93cy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgIG9iai5yb3dzW2pdLmluc2VydEJlZm9yZShvYmoucmVjb3Jkc1tqXVtvXSwgb2JqLnJlY29yZHNbal1bZF0ubmV4dFNpYmxpbmcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgb2JqLm9wdGlvbnMuY29sdW1ucy5zcGxpY2UoZCwgMCwgb2JqLm9wdGlvbnMuY29sdW1ucy5zcGxpY2UobywgMSlbMF0pO1xuICAgICAgICBvYmouaGVhZGVycy5zcGxpY2UoZCwgMCwgb2JqLmhlYWRlcnMuc3BsaWNlKG8sIDEpWzBdKTtcbiAgICAgICAgb2JqLmNvbGdyb3VwLnNwbGljZShkLCAwLCBvYmouY29sZ3JvdXAuc3BsaWNlKG8sIDEpWzBdKTtcblxuICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG9iai5yb3dzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICBvYmoub3B0aW9ucy5kYXRhW2pdLnNwbGljZShkLCAwLCBvYmoub3B0aW9ucy5kYXRhW2pdLnNwbGljZShvLCAxKVswXSk7XG4gICAgICAgICAgICBvYmoucmVjb3Jkc1tqXS5zcGxpY2UoZCwgMCwgb2JqLnJlY29yZHNbal0uc3BsaWNlKG8sIDEpWzBdKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEtlZXBpbmcgaGlzdG9yeSBvZiBjaGFuZ2VzXG4gICAgICAgIG9iai5zZXRIaXN0b3J5KHtcbiAgICAgICAgICAgIGFjdGlvbjonbW92ZUNvbHVtbicsXG4gICAgICAgICAgICBvbGRWYWx1ZTogbyxcbiAgICAgICAgICAgIG5ld1ZhbHVlOiBkLFxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBVcGRhdGUgdGFibGUgcmVmZXJlbmNlc1xuICAgICAgICBvYmoudXBkYXRlVGFibGVSZWZlcmVuY2VzKCk7XG5cbiAgICAgICAgLy8gRXZlbnRzXG4gICAgICAgIGlmIChvYmouaWdub3JlRXZlbnRzICE9IHRydWUpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2Yob2JqLm9wdGlvbnMub25tb3ZlY29sdW1uKSA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMub25tb3ZlY29sdW1uKGVsLCBvLCBkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuXG4gICAgLyoqXG4gICAgICogSW5zZXJ0IGEgbmV3IGNvbHVtblxuICAgICAqIFxuICAgICAqIEBwYXJhbSBtaXhlZCAtIG51bSBvZiBjb2x1bW5zIHRvIGJlIGFkZGVkIG9yIGRhdGEgdG8gYmUgYWRkZWQgaW4gb25lIHNpbmdsZSBjb2x1bW5cbiAgICAgKiBAcGFyYW0gaW50IGNvbHVtbk51bWJlciAtIG51bWJlciBvZiBjb2x1bW5zIHRvIGJlIGNyZWF0ZWRcbiAgICAgKiBAcGFyYW0gYm9vbCBpbnNlcnRCZWZvcmVcbiAgICAgKiBAcGFyYW0gb2JqZWN0IHByb3BlcnRpZXMgLSBjb2x1bW4gcHJvcGVydGllc1xuICAgICAqIEByZXR1cm4gdm9pZFxuICAgICAqL1xuICAgIG9iai5pbnNlcnRDb2x1bW4gPSBmdW5jdGlvbihtaXhlZCwgY29sdW1uTnVtYmVyLCBpbnNlcnRCZWZvcmUsIHByb3BlcnRpZXMpIHtcbiAgICAgICAgLy8gQ29uZmlndXJhdGlvblxuICAgICAgICBpZiAob2JqLm9wdGlvbnMuYWxsb3dJbnNlcnRDb2x1bW4gPT0gdHJ1ZSkge1xuICAgICAgICAgICAgLy8gUmVjb3Jkc1xuICAgICAgICAgICAgdmFyIHJlY29yZHMgPSBbXTtcblxuICAgICAgICAgICAgLy8gRGF0YSB0byBiZSBpbnNlcnRcbiAgICAgICAgICAgIHZhciBkYXRhID0gW107XG5cbiAgICAgICAgICAgIC8vIFRoZSBpbnNlcnQgY291bGQgYmUgbGVhZCBieSBudW1iZXIgb2Ygcm93cyBvciB0aGUgYXJyYXkgb2YgZGF0YVxuICAgICAgICAgICAgaWYgKG1peGVkID4gMCkge1xuICAgICAgICAgICAgICAgIHZhciBudW1PZkNvbHVtbnMgPSBtaXhlZDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIG51bU9mQ29sdW1ucyA9IDE7XG5cbiAgICAgICAgICAgICAgICBpZiAobWl4ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IG1peGVkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gRGlyZWN0aW9uXG4gICAgICAgICAgICB2YXIgaW5zZXJ0QmVmb3JlID0gaW5zZXJ0QmVmb3JlID8gdHJ1ZSA6IGZhbHNlO1xuXG4gICAgICAgICAgICAvLyBDdXJyZW50IGNvbHVtbiBudW1iZXJcbiAgICAgICAgICAgIHZhciBsYXN0Q29sdW1uID0gb2JqLm9wdGlvbnMuY29sdW1ucy5sZW5ndGggLSAxO1xuXG4gICAgICAgICAgICAvLyBDb25maXJtIHBvc2l0aW9uXG4gICAgICAgICAgICBpZiAoY29sdW1uTnVtYmVyID09IHVuZGVmaW5lZCB8fCBjb2x1bW5OdW1iZXIgPj0gcGFyc2VJbnQobGFzdENvbHVtbikgfHwgY29sdW1uTnVtYmVyIDwgMCkge1xuICAgICAgICAgICAgICAgIGNvbHVtbk51bWJlciA9IGxhc3RDb2x1bW47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIE9uYmVmb3JlaW5zZXJ0Y29sdW1uXG4gICAgICAgICAgICBpZiAodHlwZW9mKG9iai5vcHRpb25zLm9uYmVmb3JlaW5zZXJ0Y29sdW1uKSA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgaWYgKCEgb2JqLm9wdGlvbnMub25iZWZvcmVpbnNlcnRjb2x1bW4oZWwsIGNvbHVtbk51bWJlciwgbnVtT2ZDb2x1bW5zLCBpbnNlcnRCZWZvcmUpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdvbmJlZm9yZWluc2VydGNvbHVtbiByZXR1cm5lZCBmYWxzZScpO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIE1lcmdlZCBjZWxsc1xuICAgICAgICAgICAgaWYgKE9iamVjdC5rZXlzKG9iai5vcHRpb25zLm1lcmdlQ2VsbHMpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBpZiAob2JqLmlzQ29sTWVyZ2VkKGNvbHVtbk51bWJlciwgaW5zZXJ0QmVmb3JlKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEgY29uZmlybShvYmoub3B0aW9ucy50ZXh0LnRoaXNBY3Rpb25XaWxsRGVzdHJveUFueUV4aXN0aW5nTWVyZ2VkQ2VsbHNBcmVZb3VTdXJlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmRlc3Ryb3lNZXJnZWQoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQ3JlYXRlIGRlZmF1bHQgcHJvcGVydGllc1xuICAgICAgICAgICAgaWYgKCEgcHJvcGVydGllcykge1xuICAgICAgICAgICAgICAgIHByb3BlcnRpZXMgPSBbXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW1PZkNvbHVtbnM7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmICghIHByb3BlcnRpZXNbaV0pIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvcGVydGllc1tpXSA9IHsgdHlwZTondGV4dCcsIHNvdXJjZTpbXSwgb3B0aW9uczpbXSwgd2lkdGg6b2JqLm9wdGlvbnMuZGVmYXVsdENvbFdpZHRoLCBhbGlnbjpvYmoub3B0aW9ucy5kZWZhdWx0Q29sQWxpZ24gfTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIEluc2VydCBiZWZvcmVcbiAgICAgICAgICAgIHZhciBjb2x1bW5JbmRleCA9ICghIGluc2VydEJlZm9yZSkgPyBjb2x1bW5OdW1iZXIgKyAxIDogY29sdW1uTnVtYmVyO1xuICAgICAgICAgICAgb2JqLm9wdGlvbnMuY29sdW1ucyA9IGpleGNlbC5pbmplY3RBcnJheShvYmoub3B0aW9ucy5jb2x1bW5zLCBjb2x1bW5JbmRleCwgcHJvcGVydGllcyk7XG5cbiAgICAgICAgICAgIC8vIE9wZW4gc3BhY2UgaW4gdGhlIGNvbnRhaW5lcnNcbiAgICAgICAgICAgIHZhciBjdXJyZW50SGVhZGVycyA9IG9iai5oZWFkZXJzLnNwbGljZShjb2x1bW5JbmRleCk7XG4gICAgICAgICAgICB2YXIgY3VycmVudENvbGdyb3VwID0gb2JqLmNvbGdyb3VwLnNwbGljZShjb2x1bW5JbmRleCk7XG5cbiAgICAgICAgICAgIC8vIEhpc3RvcnlcbiAgICAgICAgICAgIHZhciBoaXN0b3J5SGVhZGVycyA9IFtdO1xuICAgICAgICAgICAgdmFyIGhpc3RvcnlDb2xncm91cCA9IFtdO1xuICAgICAgICAgICAgdmFyIGhpc3RvcnlSZWNvcmRzID0gW107XG4gICAgICAgICAgICB2YXIgaGlzdG9yeURhdGEgPSBbXTtcblxuICAgICAgICAgICAgLy8gQWRkIG5ldyBoZWFkZXJzXG4gICAgICAgICAgICBmb3IgKHZhciBjb2wgPSBjb2x1bW5JbmRleDsgY29sIDwgKG51bU9mQ29sdW1ucyArIGNvbHVtbkluZGV4KTsgY29sKyspIHtcbiAgICAgICAgICAgICAgICBvYmouY3JlYXRlQ2VsbEhlYWRlcihjb2wpO1xuICAgICAgICAgICAgICAgIG9iai5oZWFkZXJDb250YWluZXIuaW5zZXJ0QmVmb3JlKG9iai5oZWFkZXJzW2NvbF0sIG9iai5oZWFkZXJDb250YWluZXIuY2hpbGRyZW5bY29sKzFdKTtcbiAgICAgICAgICAgICAgICBvYmouY29sZ3JvdXBDb250YWluZXIuaW5zZXJ0QmVmb3JlKG9iai5jb2xncm91cFtjb2xdLCBvYmouY29sZ3JvdXBDb250YWluZXIuY2hpbGRyZW5bY29sKzFdKTtcblxuICAgICAgICAgICAgICAgIGhpc3RvcnlIZWFkZXJzLnB1c2gob2JqLmhlYWRlcnNbY29sXSk7XG4gICAgICAgICAgICAgICAgaGlzdG9yeUNvbGdyb3VwLnB1c2gob2JqLmNvbGdyb3VwW2NvbF0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBBZGRpbmcgdmlzdWFsIGNvbHVtbnNcbiAgICAgICAgICAgIGZvciAodmFyIHJvdyA9IDA7IHJvdyA8IG9iai5vcHRpb25zLmRhdGEubGVuZ3RoOyByb3crKykge1xuICAgICAgICAgICAgICAgIC8vIEtlZXAgdGhlIGN1cnJlbnQgZGF0YVxuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50RGF0YSA9IG9iai5vcHRpb25zLmRhdGFbcm93XS5zcGxpY2UoY29sdW1uSW5kZXgpO1xuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50UmVjb3JkID0gb2JqLnJlY29yZHNbcm93XS5zcGxpY2UoY29sdW1uSW5kZXgpO1xuXG4gICAgICAgICAgICAgICAgLy8gSGlzdG9yeVxuICAgICAgICAgICAgICAgIGhpc3RvcnlEYXRhW3Jvd10gPSBbXTtcbiAgICAgICAgICAgICAgICBoaXN0b3J5UmVjb3Jkc1tyb3ddID0gW107XG5cbiAgICAgICAgICAgICAgICBmb3IgKHZhciBjb2wgPSBjb2x1bW5JbmRleDsgY29sIDwgKG51bU9mQ29sdW1ucyArIGNvbHVtbkluZGV4KTsgY29sKyspIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gTmV3IHZhbHVlXG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IGRhdGFbcm93XSA/IGRhdGFbcm93XSA6ICcnO1xuICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5kYXRhW3Jvd11bY29sXSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAvLyBOZXcgY2VsbFxuICAgICAgICAgICAgICAgICAgICB2YXIgdGQgPSBvYmouY3JlYXRlQ2VsbChjb2wsIHJvdywgb2JqLm9wdGlvbnMuZGF0YVtyb3ddW2NvbF0pO1xuICAgICAgICAgICAgICAgICAgICBvYmoucmVjb3Jkc1tyb3ddW2NvbF0gPSB0ZDtcbiAgICAgICAgICAgICAgICAgICAgLy8gQWRkIGNlbGwgdG8gdGhlIHJvd1xuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLnJvd3Nbcm93XSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJvd3Nbcm93XS5pbnNlcnRCZWZvcmUodGQsIG9iai5yb3dzW3Jvd10uY2hpbGRyZW5bY29sKzFdKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIFJlY29yZCBIaXN0b3J5XG4gICAgICAgICAgICAgICAgICAgIGhpc3RvcnlEYXRhW3Jvd10ucHVzaCh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIGhpc3RvcnlSZWNvcmRzW3Jvd10ucHVzaCh0ZCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gQ29weSB0aGUgZGF0YSBiYWNrIHRvIHRoZSBtYWluIGRhdGFcbiAgICAgICAgICAgICAgICBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShvYmoub3B0aW9ucy5kYXRhW3Jvd10sIGN1cnJlbnREYXRhKTtcbiAgICAgICAgICAgICAgICBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShvYmoucmVjb3Jkc1tyb3ddLCBjdXJyZW50UmVjb3JkKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgQXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkob2JqLmhlYWRlcnMsIGN1cnJlbnRIZWFkZXJzKTtcbiAgICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KG9iai5jb2xncm91cCwgY3VycmVudENvbGdyb3VwKTtcblxuICAgICAgICAgICAgLy8gQWRqdXN0IG5lc3RlZCBoZWFkZXJzXG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMubmVzdGVkSGVhZGVycyAmJiBvYmoub3B0aW9ucy5uZXN0ZWRIZWFkZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAvLyBGbGV4aWJsZSB3YXkgdG8gaGFuZGxlIG5lc3RlZGhlYWRlcnNcbiAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMubmVzdGVkSGVhZGVyc1swXSAmJiBvYmoub3B0aW9ucy5uZXN0ZWRIZWFkZXJzWzBdWzBdKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgb2JqLm9wdGlvbnMubmVzdGVkSGVhZGVycy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbHNwYW4gPSBwYXJzZUludChvYmoub3B0aW9ucy5uZXN0ZWRIZWFkZXJzW2pdW29iai5vcHRpb25zLm5lc3RlZEhlYWRlcnNbal0ubGVuZ3RoLTFdLmNvbHNwYW4pICsgbnVtT2ZDb2x1bW5zO1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMubmVzdGVkSGVhZGVyc1tqXVtvYmoub3B0aW9ucy5uZXN0ZWRIZWFkZXJzW2pdLmxlbmd0aC0xXS5jb2xzcGFuID0gY29sc3BhbjtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai50aGVhZC5jaGlsZHJlbltqXS5jaGlsZHJlbltvYmoudGhlYWQuY2hpbGRyZW5bal0uY2hpbGRyZW4ubGVuZ3RoLTFdLnNldEF0dHJpYnV0ZSgnY29sc3BhbicsIGNvbHNwYW4pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbHNwYW4gPSBwYXJzZUludChvYmoub3B0aW9ucy5uZXN0ZWRIZWFkZXJzWzBdLmNvbHNwYW4pICsgbnVtT2ZDb2x1bW5zO1xuICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5uZXN0ZWRIZWFkZXJzWzBdLmNvbHNwYW4gPSBjb2xzcGFuO1xuICAgICAgICAgICAgICAgICAgICBvYmoudGhlYWQuY2hpbGRyZW5bMF0uY2hpbGRyZW5bb2JqLnRoZWFkLmNoaWxkcmVuWzBdLmNoaWxkcmVuLmxlbmd0aC0xXS5zZXRBdHRyaWJ1dGUoJ2NvbHNwYW4nLCBjb2xzcGFuKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIEtlZXAgaGlzdG9yeVxuICAgICAgICAgICAgb2JqLnNldEhpc3Rvcnkoe1xuICAgICAgICAgICAgICAgIGFjdGlvbjogJ2luc2VydENvbHVtbicsXG4gICAgICAgICAgICAgICAgY29sdW1uTnVtYmVyOmNvbHVtbk51bWJlcixcbiAgICAgICAgICAgICAgICBudW1PZkNvbHVtbnM6bnVtT2ZDb2x1bW5zLFxuICAgICAgICAgICAgICAgIGluc2VydEJlZm9yZTppbnNlcnRCZWZvcmUsXG4gICAgICAgICAgICAgICAgY29sdW1uczpwcm9wZXJ0aWVzLFxuICAgICAgICAgICAgICAgIGhlYWRlcnM6aGlzdG9yeUhlYWRlcnMsXG4gICAgICAgICAgICAgICAgY29sZ3JvdXA6aGlzdG9yeUNvbGdyb3VwLFxuICAgICAgICAgICAgICAgIHJlY29yZHM6aGlzdG9yeVJlY29yZHMsXG4gICAgICAgICAgICAgICAgZGF0YTpoaXN0b3J5RGF0YSxcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBSZW1vdmUgdGFibGUgcmVmZXJlbmNlc1xuICAgICAgICAgICAgb2JqLnVwZGF0ZVRhYmxlUmVmZXJlbmNlcygpO1xuXG4gICAgICAgICAgICAvLyBFdmVudHNcbiAgICAgICAgICAgIGlmIChvYmouaWdub3JlRXZlbnRzICE9IHRydWUpIHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mKG9iai5vcHRpb25zLm9uaW5zZXJ0Y29sdW1uKSA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLm9uaW5zZXJ0Y29sdW1uKGVsLCBjb2x1bW5OdW1iZXIsIG51bU9mQ29sdW1ucywgaGlzdG9yeVJlY29yZHMsIGluc2VydEJlZm9yZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGVsZXRlIGEgY29sdW1uIGJ5IG51bWJlclxuICAgICAqIFxuICAgICAqIEBwYXJhbSBpbnRlZ2VyIGNvbHVtbk51bWJlciAtIHJlZmVyZW5jZSBjb2x1bW4gdG8gYmUgZXhjbHVkZWRcbiAgICAgKiBAcGFyYW0gaW50ZWdlciBudW1PZkNvbHVtbnMgLSBudW1iZXIgb2YgY29sdW1ucyB0byBiZSBleGNsdWRlZCBmcm9tIHRoZSByZWZlcmVuY2UgY29sdW1uXG4gICAgICogQHJldHVybiB2b2lkXG4gICAgICovXG4gICAgb2JqLmRlbGV0ZUNvbHVtbiA9IGZ1bmN0aW9uKGNvbHVtbk51bWJlciwgbnVtT2ZDb2x1bW5zKSB7XG4gICAgICAgIC8vIEdsb2JhbCBDb25maWd1cmF0aW9uXG4gICAgICAgIGlmIChvYmoub3B0aW9ucy5hbGxvd0RlbGV0ZUNvbHVtbiA9PSB0cnVlKSB7XG4gICAgICAgICAgICBpZiAob2JqLmhlYWRlcnMubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgIC8vIERlbGV0ZSBjb2x1bW4gZGVmaW5pdGlvbnNcbiAgICAgICAgICAgICAgICBpZiAoY29sdW1uTnVtYmVyID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbnVtYmVyID0gb2JqLmdldFNlbGVjdGVkQ29sdW1ucyh0cnVlKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoISBudW1iZXIubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgbGFzdCBjb2x1bW5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbk51bWJlciA9IG9iai5oZWFkZXJzLmxlbmd0aCAtIDE7XG4gICAgICAgICAgICAgICAgICAgICAgICBudW1PZkNvbHVtbnMgPSAxO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIHNlbGVjdGVkXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5OdW1iZXIgPSBwYXJzZUludChudW1iZXJbMF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgbnVtT2ZDb2x1bW5zID0gcGFyc2VJbnQobnVtYmVyLmxlbmd0aCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBMYXNhdCBjb2x1bW5cbiAgICAgICAgICAgICAgICB2YXIgbGFzdENvbHVtbiA9IG9iai5vcHRpb25zLmRhdGFbMF0ubGVuZ3RoIC0gMTtcblxuICAgICAgICAgICAgICAgIGlmIChjb2x1bW5OdW1iZXIgPT0gdW5kZWZpbmVkIHx8IGNvbHVtbk51bWJlciA+IGxhc3RDb2x1bW4gfHwgY29sdW1uTnVtYmVyIDwgMCkge1xuICAgICAgICAgICAgICAgICAgICBjb2x1bW5OdW1iZXIgPSBsYXN0Q29sdW1uO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIE1pbmltdW0gb2YgY29sdW1ucyB0byBiZSBkZWxldGUgaXMgMVxuICAgICAgICAgICAgICAgIGlmICghIG51bU9mQ29sdW1ucykge1xuICAgICAgICAgICAgICAgICAgICBudW1PZkNvbHVtbnMgPSAxO1xuICAgICAgICAgICAgICAgIH1cblxuXG5cbiAgICAgICAgICAgICAgICAvLyBDYW4ndCBkZWxldGUgbW9yZSB0aGFuIHRoZSBsaW1pdCBvZiB0aGUgdGFibGVcbiAgICAgICAgICAgICAgICBpZiAobnVtT2ZDb2x1bW5zID4gb2JqLm9wdGlvbnMuZGF0YVswXS5sZW5ndGggLSBjb2x1bW5OdW1iZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgbnVtT2ZDb2x1bW5zID0gb2JqLm9wdGlvbnMuZGF0YVswXS5sZW5ndGggLSBjb2x1bW5OdW1iZXI7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gb25iZWZvcmVkZWxldGVjb2x1bW5cbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mKG9iai5vcHRpb25zLm9uYmVmb3JlZGVsZXRlY29sdW1uKSA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgaWYgKCEgb2JqLm9wdGlvbnMub25iZWZvcmVkZWxldGVjb2x1bW4oZWwsIGNvbHVtbk51bWJlciwgbnVtT2ZDb2x1bW5zKSkge1xuICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdvbmJlZm9yZWRlbGV0ZWNvbHVtbiByZXR1cm5lZCBmYWxzZScpO1xuICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gQ2FuJ3QgcmVtb3ZlIHRoZSBsYXN0IGNvbHVtblxuICAgICAgICAgICAgICAgIGlmIChwYXJzZUludChjb2x1bW5OdW1iZXIpID4gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gTWVyZ2VkIGNlbGxzXG4gICAgICAgICAgICAgICAgICAgIHZhciBtZXJnZUV4aXN0cyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmtleXMob2JqLm9wdGlvbnMubWVyZ2VDZWxscykubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgY29sID0gY29sdW1uTnVtYmVyOyBjb2wgPCBjb2x1bW5OdW1iZXIgKyBudW1PZkNvbHVtbnM7IGNvbCsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5pc0NvbE1lcmdlZChjb2wsIGZhbHNlKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVyZ2VFeGlzdHMgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAobWVyZ2VFeGlzdHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghIGNvbmZpcm0ob2JqLm9wdGlvbnMudGV4dC50aGlzQWN0aW9uV2lsbERlc3Ryb3lBbnlFeGlzdGluZ01lcmdlZENlbGxzQXJlWW91U3VyZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5kZXN0cm95TWVyZ2VkKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBEZWxldGUgdGhlIGNvbHVtbiBwcm9wZXJ0aWVzXG4gICAgICAgICAgICAgICAgICAgIHZhciBjb2x1bW5zID0gb2JqLm9wdGlvbnMuY29sdW1ucy5zcGxpY2UoY29sdW1uTnVtYmVyLCBudW1PZkNvbHVtbnMpO1xuXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGNvbCA9IGNvbHVtbk51bWJlcjsgY29sIDwgY29sdW1uTnVtYmVyICsgbnVtT2ZDb2x1bW5zOyBjb2wrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmNvbGdyb3VwW2NvbF0uY2xhc3NOYW1lID0gJyc7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouaGVhZGVyc1tjb2xdLmNsYXNzTmFtZSA9ICcnO1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmNvbGdyb3VwW2NvbF0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChvYmouY29sZ3JvdXBbY29sXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouaGVhZGVyc1tjb2xdLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQob2JqLmhlYWRlcnNbY29sXSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB2YXIgaGlzdG9yeUhlYWRlcnMgPSBvYmouaGVhZGVycy5zcGxpY2UoY29sdW1uTnVtYmVyLCBudW1PZkNvbHVtbnMpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgaGlzdG9yeUNvbGdyb3VwID0gb2JqLmNvbGdyb3VwLnNwbGljZShjb2x1bW5OdW1iZXIsIG51bU9mQ29sdW1ucyk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBoaXN0b3J5UmVjb3JkcyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICB2YXIgaGlzdG9yeURhdGEgPSBbXTtcblxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciByb3cgPSAwOyByb3cgPCBvYmoub3B0aW9ucy5kYXRhLmxlbmd0aDsgcm93KyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGNvbCA9IGNvbHVtbk51bWJlcjsgY29sIDwgY29sdW1uTnVtYmVyICsgbnVtT2ZDb2x1bW5zOyBjb2wrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW3Jvd11bY29sXS5jbGFzc05hbWUgPSAnJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVjb3Jkc1tyb3ddW2NvbF0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChvYmoucmVjb3Jkc1tyb3ddW2NvbF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gRGVsZXRlIGhlYWRlcnNcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgcm93ID0gMDsgcm93IDwgb2JqLm9wdGlvbnMuZGF0YS5sZW5ndGg7IHJvdysrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBIaXN0b3J5XG4gICAgICAgICAgICAgICAgICAgICAgICBoaXN0b3J5RGF0YVtyb3ddID0gb2JqLm9wdGlvbnMuZGF0YVtyb3ddLnNwbGljZShjb2x1bW5OdW1iZXIsIG51bU9mQ29sdW1ucyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBoaXN0b3J5UmVjb3Jkc1tyb3ddID0gb2JqLnJlY29yZHNbcm93XS5zcGxpY2UoY29sdW1uTnVtYmVyLCBudW1PZkNvbHVtbnMpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIHNlbGVjdGlvblxuICAgICAgICAgICAgICAgICAgICBvYmouY29uZGl0aW9uYWxTZWxlY3Rpb25VcGRhdGUoMCwgY29sdW1uTnVtYmVyLCAoY29sdW1uTnVtYmVyICsgbnVtT2ZDb2x1bW5zKSAtIDEpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIEFkanVzdCBuZXN0ZWQgaGVhZGVyc1xuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMubmVzdGVkSGVhZGVycyAmJiBvYmoub3B0aW9ucy5uZXN0ZWRIZWFkZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZsZXhpYmxlIHdheSB0byBoYW5kbGUgbmVzdGVkaGVhZGVyc1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLm5lc3RlZEhlYWRlcnNbMF0gJiYgb2JqLm9wdGlvbnMubmVzdGVkSGVhZGVyc1swXVswXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgb2JqLm9wdGlvbnMubmVzdGVkSGVhZGVycy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29sc3BhbiA9IHBhcnNlSW50KG9iai5vcHRpb25zLm5lc3RlZEhlYWRlcnNbal1bb2JqLm9wdGlvbnMubmVzdGVkSGVhZGVyc1tqXS5sZW5ndGgtMV0uY29sc3BhbikgLSBudW1PZkNvbHVtbnM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLm5lc3RlZEhlYWRlcnNbal1bb2JqLm9wdGlvbnMubmVzdGVkSGVhZGVyc1tqXS5sZW5ndGgtMV0uY29sc3BhbiA9IGNvbHNwYW47XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai50aGVhZC5jaGlsZHJlbltqXS5jaGlsZHJlbltvYmoudGhlYWQuY2hpbGRyZW5bal0uY2hpbGRyZW4ubGVuZ3RoLTFdLnNldEF0dHJpYnV0ZSgnY29sc3BhbicsIGNvbHNwYW4pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbHNwYW4gPSBwYXJzZUludChvYmoub3B0aW9ucy5uZXN0ZWRIZWFkZXJzWzBdLmNvbHNwYW4pIC0gbnVtT2ZDb2x1bW5zO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLm5lc3RlZEhlYWRlcnNbMF0uY29sc3BhbiA9IGNvbHNwYW47XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnRoZWFkLmNoaWxkcmVuWzBdLmNoaWxkcmVuW29iai50aGVhZC5jaGlsZHJlblswXS5jaGlsZHJlbi5sZW5ndGgtMV0uc2V0QXR0cmlidXRlKCdjb2xzcGFuJywgY29sc3Bhbik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBLZWVwaW5nIGhpc3Rvcnkgb2YgY2hhbmdlc1xuICAgICAgICAgICAgICAgICAgICBvYmouc2V0SGlzdG9yeSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb246J2RlbGV0ZUNvbHVtbicsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5OdW1iZXI6Y29sdW1uTnVtYmVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgbnVtT2ZDb2x1bW5zOm51bU9mQ29sdW1ucyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydEJlZm9yZTogMSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbnM6Y29sdW1ucyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6aGlzdG9yeUhlYWRlcnMsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xncm91cDpoaXN0b3J5Q29sZ3JvdXAsXG4gICAgICAgICAgICAgICAgICAgICAgICByZWNvcmRzOmhpc3RvcnlSZWNvcmRzLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTpoaXN0b3J5RGF0YSxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIHRhYmxlIHJlZmVyZW5jZXNcbiAgICAgICAgICAgICAgICAgICAgb2JqLnVwZGF0ZVRhYmxlUmVmZXJlbmNlcygpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIERlbGV0ZVxuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLmlnbm9yZUV2ZW50cyAhPSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mKG9iai5vcHRpb25zLm9uZGVsZXRlY29sdW1uKSA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMub25kZWxldGVjb2x1bW4oZWwsIGNvbHVtbk51bWJlciwgbnVtT2ZDb2x1bW5zLCBoaXN0b3J5UmVjb3Jkcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0pFWENFTC4gSXQgaXMgbm90IHBvc3NpYmxlIHRvIGRlbGV0ZSB0aGUgbGFzdCBjb2x1bW4nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBzZWxldGVkIHJvd3MgbnVtYmVyc1xuICAgICAqIFxuICAgICAqIEByZXR1cm4gYXJyYXlcbiAgICAgKi9cbiAgICBvYmouZ2V0U2VsZWN0ZWRSb3dzID0gZnVuY3Rpb24oYXNJZHMpIHtcbiAgICAgICAgdmFyIHJvd3MgPSBbXTtcbiAgICAgICAgLy8gR2V0IGFsbCBzZWxlY3RlZCByb3dzXG4gICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgb2JqLnJvd3MubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgIGlmIChvYmoucm93c1tqXS5jbGFzc0xpc3QuY29udGFpbnMoJ3NlbGVjdGVkJykpIHtcbiAgICAgICAgICAgICAgICBpZiAoYXNJZHMpIHtcbiAgICAgICAgICAgICAgICAgICAgcm93cy5wdXNoKGopO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJvd3MucHVzaChvYmoucm93c1tqXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJvd3M7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEdldCBzZWxldGVkIGNvbHVtbiBudW1iZXJzXG4gICAgICogXG4gICAgICogQHJldHVybiBhcnJheVxuICAgICAqL1xuICAgIG9iai5nZXRTZWxlY3RlZENvbHVtbnMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGNvbHMgPSBbXTtcbiAgICAgICAgLy8gR2V0IGFsbCBzZWxlY3RlZCBjb2xzXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2JqLmhlYWRlcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChvYmouaGVhZGVyc1tpXS5jbGFzc0xpc3QuY29udGFpbnMoJ3NlbGVjdGVkJykpIHtcbiAgICAgICAgICAgICAgICBjb2xzLnB1c2goaSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gY29scztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgaGlnaGxpZ2h0ZWRcbiAgICAgKiBcbiAgICAgKiBAcmV0dXJuIGFycmF5XG4gICAgICovXG4gICAgb2JqLmdldEhpZ2hsaWdodGVkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBvYmouaGlnaGxpZ2h0ZWQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVXBkYXRlIGNlbGwgcmVmZXJlbmNlc1xuICAgICAqIFxuICAgICAqIEByZXR1cm4gdm9pZFxuICAgICAqL1xuICAgIG9iai51cGRhdGVUYWJsZVJlZmVyZW5jZXMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gVXBkYXRlIGhlYWRlcnNcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvYmouaGVhZGVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIHggPSBvYmouaGVhZGVyc1tpXS5nZXRBdHRyaWJ1dGUoJ2RhdGEteCcpO1xuXG4gICAgICAgICAgICBpZiAoeCAhPSBpKSB7XG4gICAgICAgICAgICAgICAgLy8gVXBkYXRlIGNvb3Jkc1xuICAgICAgICAgICAgICAgIG9iai5oZWFkZXJzW2ldLnNldEF0dHJpYnV0ZSgnZGF0YS14JywgaSk7XG4gICAgICAgICAgICAgICAgLy8gVGl0bGVcbiAgICAgICAgICAgICAgICBpZiAoISBvYmouaGVhZGVyc1tpXS5nZXRBdHRyaWJ1dGUoJ3RpdGxlJykpIHtcbiAgICAgICAgICAgICAgICAgICAgb2JqLmhlYWRlcnNbaV0uaW5uZXJIVE1MID0gamV4Y2VsLmdldENvbHVtbk5hbWUoaSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gVXBkYXRlIGFsbCByb3dzXG4gICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgb2JqLnJvd3MubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgIGlmIChvYmoucm93c1tqXSkge1xuICAgICAgICAgICAgICAgIHZhciB5ID0gb2JqLnJvd3Nbal0uZ2V0QXR0cmlidXRlKCdkYXRhLXknKTtcblxuICAgICAgICAgICAgICAgIGlmICh5ICE9IGopIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIGNvb3Jkc1xuICAgICAgICAgICAgICAgICAgICBvYmoucm93c1tqXS5zZXRBdHRyaWJ1dGUoJ2RhdGEteScsIGopO1xuICAgICAgICAgICAgICAgICAgICBvYmoucm93c1tqXS5jaGlsZHJlblswXS5zZXRBdHRyaWJ1dGUoJ2RhdGEteScsIGopO1xuICAgICAgICAgICAgICAgICAgICAvLyBSb3cgbnVtYmVyXG4gICAgICAgICAgICAgICAgICAgIG9iai5yb3dzW2pdLmNoaWxkcmVuWzBdLmlubmVySFRNTCA9IGogKyAxO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFJlZ3VsYXIgY2VsbHMgYWZmZWN0ZWQgYnkgdGhpcyBjaGFuZ2VcbiAgICAgICAgdmFyIGFmZmVjdGVkVG9rZW5zID0gW107XG4gICAgICAgIHZhciBtZXJnZUNlbGxVcGRhdGVzID0gW107XG5cbiAgICAgICAgLy8gVXBkYXRlIGNlbGxcbiAgICAgICAgdmFyIHVwZGF0ZVBvc2l0aW9uID0gZnVuY3Rpb24oeCx5LGksaikge1xuICAgICAgICAgICAgaWYgKHggIT0gaSkge1xuICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW2pdW2ldLnNldEF0dHJpYnV0ZSgnZGF0YS14JywgaSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoeSAhPSBqKSB7XG4gICAgICAgICAgICAgICAgb2JqLnJlY29yZHNbal1baV0uc2V0QXR0cmlidXRlKCdkYXRhLXknLCBqKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gT3RoZXIgdXBkYXRlc1xuICAgICAgICAgICAgaWYgKHggIT0gaSB8fCB5ICE9IGopIHtcbiAgICAgICAgICAgICAgICB2YXIgY29sdW1uSWRGcm9tID0gamV4Y2VsLmdldENvbHVtbk5hbWVGcm9tSWQoW3gsIHldKTtcbiAgICAgICAgICAgICAgICB2YXIgY29sdW1uSWRUbyA9IGpleGNlbC5nZXRDb2x1bW5OYW1lRnJvbUlkKFtpLCBqXSk7XG4gICAgICAgICAgICAgICAgYWZmZWN0ZWRUb2tlbnNbY29sdW1uSWRGcm9tXSA9IGNvbHVtbklkVG87XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG9iai5yZWNvcmRzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iai5yZWNvcmRzWzBdLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKG9iai5yZWNvcmRzW2pdW2ldKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEN1cnJlbnQgdmFsdWVzXG4gICAgICAgICAgICAgICAgICAgIHZhciB4ID0gb2JqLnJlY29yZHNbal1baV0uZ2V0QXR0cmlidXRlKCdkYXRhLXgnKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHkgPSBvYmoucmVjb3Jkc1tqXVtpXS5nZXRBdHRyaWJ1dGUoJ2RhdGEteScpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBjb2x1bW5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5yZWNvcmRzW2pdW2ldLmdldEF0dHJpYnV0ZSgnZGF0YS1tZXJnZWQnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbHVtbklkRnJvbSA9IGpleGNlbC5nZXRDb2x1bW5OYW1lRnJvbUlkKFt4LCB5XSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29sdW1uSWRUbyA9IGpleGNlbC5nZXRDb2x1bW5OYW1lRnJvbUlkKFtpLCBqXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobWVyZ2VDZWxsVXBkYXRlc1tjb2x1bW5JZEZyb21dID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29sdW1uSWRGcm9tID09IGNvbHVtbklkVG8pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVyZ2VDZWxsVXBkYXRlc1tjb2x1bW5JZEZyb21dID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRvdGFsWCA9IHBhcnNlSW50KGkgLSB4KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRvdGFsWSA9IHBhcnNlSW50KGogLSB5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVyZ2VDZWxsVXBkYXRlc1tjb2x1bW5JZEZyb21dID0gWyBjb2x1bW5JZFRvLCB0b3RhbFgsIHRvdGFsWSBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZVBvc2l0aW9uKHgseSxpLGopO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gVXBkYXRlIG1lcmdlZCBpZiBhcHBsaWNhYmxlXG4gICAgICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMobWVyZ2VDZWxsVXBkYXRlcyk7XG4gICAgICAgIGlmIChrZXlzLmxlbmd0aCkge1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKG1lcmdlQ2VsbFVwZGF0ZXNba2V5c1tpXV0pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGluZm8gPSBqZXhjZWwuZ2V0SWRGcm9tQ29sdW1uTmFtZShrZXlzW2ldLCB0cnVlKVxuICAgICAgICAgICAgICAgICAgICB2YXIgeCA9IGluZm9bMF07XG4gICAgICAgICAgICAgICAgICAgIHZhciB5ID0gaW5mb1sxXTtcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlUG9zaXRpb24oeCx5LHggKyBtZXJnZUNlbGxVcGRhdGVzW2tleXNbaV1dWzFdLHkgKyBtZXJnZUNlbGxVcGRhdGVzW2tleXNbaV1dWzJdKTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgY29sdW1uSWRGcm9tID0ga2V5c1tpXTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbHVtbklkVG8gPSBtZXJnZUNlbGxVcGRhdGVzW2tleXNbaV1dWzBdO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG9iai5vcHRpb25zLm1lcmdlQ2VsbHNbY29sdW1uSWRGcm9tXVsyXS5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHggPSBwYXJzZUludChvYmoub3B0aW9ucy5tZXJnZUNlbGxzW2NvbHVtbklkRnJvbV1bMl1bal0uZ2V0QXR0cmlidXRlKCdkYXRhLXgnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgeSA9IHBhcnNlSW50KG9iai5vcHRpb25zLm1lcmdlQ2VsbHNbY29sdW1uSWRGcm9tXVsyXVtqXS5nZXRBdHRyaWJ1dGUoJ2RhdGEteScpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLm1lcmdlQ2VsbHNbY29sdW1uSWRGcm9tXVsyXVtqXS5zZXRBdHRyaWJ1dGUoJ2RhdGEteCcsIHggKyBtZXJnZUNlbGxVcGRhdGVzW2tleXNbaV1dWzFdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLm1lcmdlQ2VsbHNbY29sdW1uSWRGcm9tXVsyXVtqXS5zZXRBdHRyaWJ1dGUoJ2RhdGEteScsIHkgKyBtZXJnZUNlbGxVcGRhdGVzW2tleXNbaV1dWzJdKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLm1lcmdlQ2VsbHNbY29sdW1uSWRUb10gPSBvYmoub3B0aW9ucy5tZXJnZUNlbGxzW2NvbHVtbklkRnJvbV07XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZShvYmoub3B0aW9ucy5tZXJnZUNlbGxzW2NvbHVtbklkRnJvbV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFVwZGF0ZSBmb3JtdWxhc1xuICAgICAgICBvYmoudXBkYXRlRm9ybXVsYXMoYWZmZWN0ZWRUb2tlbnMpO1xuXG4gICAgICAgIC8vIFVwZGF0ZSBtZXRhIGRhdGFcbiAgICAgICAgb2JqLnVwZGF0ZU1ldGEoYWZmZWN0ZWRUb2tlbnMpO1xuXG4gICAgICAgIC8vIFJlZnJlc2ggc2VsZWN0aW9uXG4gICAgICAgIG9iai5yZWZyZXNoU2VsZWN0aW9uKCk7XG5cbiAgICAgICAgLy8gVXBkYXRlIHRhYmxlIHdpdGggY3VzdG9tIGNvbmZpZ3VyYXRpb24gaWYgYXBwbGljYWJsZVxuICAgICAgICBvYmoudXBkYXRlVGFibGUoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDdXN0b20gc2V0dGluZ3MgZm9yIHRoZSBjZWxsc1xuICAgICAqL1xuICAgIG9iai51cGRhdGVUYWJsZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBDaGVjayBmb3Igc3BhcmVcbiAgICAgICAgaWYgKG9iai5vcHRpb25zLm1pblNwYXJlUm93cyA+IDApIHtcbiAgICAgICAgICAgIHZhciBudW1CbGFua1Jvd3MgPSAwO1xuICAgICAgICAgICAgZm9yICh2YXIgaiA9IG9iai5yb3dzLmxlbmd0aCAtIDE7IGogPj0gMDsgai0tKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRlc3QgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iai5oZWFkZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5kYXRhW2pdW2ldKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXN0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodGVzdCkge1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBudW1CbGFua1Jvd3MrKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5taW5TcGFyZVJvd3MgLSBudW1CbGFua1Jvd3MgPiAwKSB7XG4gICAgICAgICAgICAgICAgb2JqLmluc2VydFJvdyhvYmoub3B0aW9ucy5taW5TcGFyZVJvd3MgLSBudW1CbGFua1Jvd3MpXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAob2JqLm9wdGlvbnMubWluU3BhcmVDb2xzID4gMCkge1xuICAgICAgICAgICAgdmFyIG51bUJsYW5rQ29scyA9IDA7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gb2JqLmhlYWRlcnMubGVuZ3RoIC0gMTsgaSA+PSAwIDsgaS0tKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRlc3QgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG9iai5yb3dzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5kYXRhW2pdW2ldKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXN0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodGVzdCkge1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBudW1CbGFua0NvbHMrKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5taW5TcGFyZUNvbHMgLSBudW1CbGFua0NvbHMgPiAwKSB7XG4gICAgICAgICAgICAgICAgb2JqLmluc2VydENvbHVtbihvYmoub3B0aW9ucy5taW5TcGFyZUNvbHMgLSBudW1CbGFua0NvbHMpXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDdXN0b21pemF0aW9ucyBieSB0aGUgZGV2ZWxvcGVyXG4gICAgICAgIGlmICh0eXBlb2Yob2JqLm9wdGlvbnMudXBkYXRlVGFibGUpID09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5kZXRhY2hGb3JVcGRhdGVzKSB7XHJcbiAgICAgICAgICAgICAgICBlbC5yZW1vdmVDaGlsZChvYmouY29udGVudCk7XHJcbiAgICAgICAgICAgIH1cclxuXG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG9iai5yb3dzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvYmouaGVhZGVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy51cGRhdGVUYWJsZShlbCwgb2JqLnJlY29yZHNbal1baV0sIGksIGosIG9iai5vcHRpb25zLmRhdGFbal1baV0sIG9iai5yZWNvcmRzW2pdW2ldLmlubmVyVGV4dCwgamV4Y2VsLmdldENvbHVtbk5hbWVGcm9tSWQoW2ksIGpdKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXHJcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5kZXRhY2hGb3JVcGRhdGVzKSB7XHJcbiAgICAgICAgICAgICAgICBlbC5pbnNlcnRCZWZvcmUob2JqLmNvbnRlbnQsIG9iai5wYWdpbmF0aW9uKTtcclxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gVXBkYXRlIGNvcm5lciBwb3NpdGlvblxuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgb2JqLnVwZGF0ZUNvcm5lclBvc2l0aW9uKCk7XG4gICAgICAgIH0sMCk7XG4gICAgfVxuXHJcbiAgICAvKipcclxuICAgICAqIFNob3cgY29sdW1uXHJcbiAgICAgKi9cclxuICAgIG9iai5zaG93Q29sdW1uID0gZnVuY3Rpb24oY29sTnVtYmVyKSB7XHJcbiAgICAgICAgb2JqLmhlYWRlcnNbY29sTnVtYmVyXS5zdHlsZS5kaXNwbGF5ID0gJyc7XHJcbiAgICAgICAgb2JqLmNvbGdyb3VwW2NvbE51bWJlcl0uc3R5bGUuZGlzcGxheSA9ICcnO1xyXG4gICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgb2JqLm9wdGlvbnMuZGF0YS5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICBvYmoucmVjb3Jkc1tqXVtjb2xOdW1iZXJdLnN0eWxlLmRpc3BsYXkgPSAnJztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBIaWRlIGNvbHVtblxyXG4gICAgICovXHJcbiAgICBvYmouaGlkZUNvbHVtbiA9IGZ1bmN0aW9uKGNvbE51bWJlcikge1xyXG4gICAgICAgIG9iai5oZWFkZXJzW2NvbE51bWJlcl0uc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICAgICAgICBvYmouY29sZ3JvdXBbY29sTnVtYmVyXS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG4gICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgb2JqLm9wdGlvbnMuZGF0YS5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICBvYmoucmVjb3Jkc1tqXVtjb2xOdW1iZXJdLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cbiAgICAvKipcbiAgICAgKiBTaG93IGluZGV4IGNvbHVtblxuICAgICAqL1xuICAgIG9iai5zaG93SW5kZXggPSBmdW5jdGlvbigpIHtcbiAgICAgICAgb2JqLnRhYmxlLmNsYXNzTGlzdC5yZW1vdmUoJ2pleGNlbF9oaWRkZW5faW5kZXgnKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBIaWRlIGluZGV4IGNvbHVtblxuICAgICAqL1xuICAgIG9iai5oaWRlSW5kZXggPSBmdW5jdGlvbigpIHtcbiAgICAgICAgb2JqLnRhYmxlLmNsYXNzTGlzdC5hZGQoJ2pleGNlbF9oaWRkZW5faW5kZXgnKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVcGRhdGUgYWxsIHJlbGF0ZWQgY2VsbHMgaW4gdGhlIGNoYWluXG4gICAgICovXG4gICAgdmFyIGNoYWluTG9vcFByb3RlY3Rpb24gPSBbXTtcblxuICAgIG9iai51cGRhdGVGb3JtdWxhQ2hhaW4gPSBmdW5jdGlvbih4LCB5LCByZWNvcmRzKSB7XG4gICAgICAgIHZhciBjZWxsSWQgPSBqZXhjZWwuZ2V0Q29sdW1uTmFtZUZyb21JZChbeCwgeV0pO1xuICAgICAgICBpZiAob2JqLmZvcm11bGFbY2VsbElkXSAmJiBvYmouZm9ybXVsYVtjZWxsSWRdLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGlmIChjaGFpbkxvb3BQcm90ZWN0aW9uW2NlbGxJZF0pIHtcbiAgICAgICAgICAgICAgICBvYmoucmVjb3Jkc1t5XVt4XS5pbm5lckhUTUwgPSAnI0VSUk9SJztcbiAgICAgICAgICAgICAgICBvYmouZm9ybXVsYVtjZWxsSWRdID0gJyc7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIFByb3RlY3Rpb25cbiAgICAgICAgICAgICAgICBjaGFpbkxvb3BQcm90ZWN0aW9uW2NlbGxJZF0gPSB0cnVlO1xuXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvYmouZm9ybXVsYVtjZWxsSWRdLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjZWxsID0gamV4Y2VsLmdldElkRnJvbUNvbHVtbk5hbWUob2JqLmZvcm11bGFbY2VsbElkXVtpXSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBjZWxsXG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9ICcnK29iai5vcHRpb25zLmRhdGFbY2VsbFsxXV1bY2VsbFswXV07XG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5zdWJzdHIoMCwxKSA9PSAnPScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlY29yZHMucHVzaChvYmoudXBkYXRlQ2VsbChjZWxsWzBdLCBjZWxsWzFdLCB2YWx1ZSwgdHJ1ZSkpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gTm8gbG9uZ2VyIGEgZm9ybXVsYSwgcmVtb3ZlIGZyb20gdGhlIGNoYWluXG4gICAgICAgICAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhvYmouZm9ybXVsYSlbaV0gPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIG9iai51cGRhdGVGb3JtdWxhQ2hhaW4oY2VsbFswXSwgY2VsbFsxXSwgcmVjb3Jkcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgY2hhaW5Mb29wUHJvdGVjdGlvbiA9IFtdO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZSBmb3JtdWxhc1xuICAgICAqL1xuICAgIG9iai51cGRhdGVGb3JtdWxhcyA9IGZ1bmN0aW9uKHJlZmVyZW5jZXNUb1VwZGF0ZSkge1xuICAgICAgICAvLyBVcGRhdGUgZm9ybXVsYXNcbiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBvYmoub3B0aW9ucy5kYXRhLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iai5vcHRpb25zLmRhdGFbMF0ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSAnJyArIG9iai5vcHRpb25zLmRhdGFbal1baV07XG4gICAgICAgICAgICAgICAgLy8gSXMgZm9ybXVsYVxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5zdWJzdHIoMCwxKSA9PSAnPScpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gUmVwbGFjZSB0b2tlbnNcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5ld0Zvcm11bGEgPSBvYmoudXBkYXRlRm9ybXVsYSh2YWx1ZSwgcmVmZXJlbmNlc1RvVXBkYXRlKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5ld0Zvcm11bGEgIT0gdmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmRhdGFbal1baV0gPSBuZXdGb3JtdWxhO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gVXBkYXRlIGZvcm11bGEgY2hhaW5cbiAgICAgICAgdmFyIGZvcm11bGEgPSBbXTtcbiAgICAgICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmouZm9ybXVsYSk7XG4gICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwga2V5cy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgLy8gQ3VycmVudCBrZXkgYW5kIHZhbHVlc1xuICAgICAgICAgICAgdmFyIGtleSA9IGtleXNbal07XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBvYmouZm9ybXVsYVtrZXldO1xuICAgICAgICAgICAgLy8gVXBkYXRlIGtleVxuICAgICAgICAgICAgaWYgKHJlZmVyZW5jZXNUb1VwZGF0ZVtrZXldKSB7XG4gICAgICAgICAgICAgICAga2V5ID0gcmVmZXJlbmNlc1RvVXBkYXRlW2tleV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBVcGRhdGUgdmFsdWVzXG4gICAgICAgICAgICBmb3JtdWxhW2tleV0gPSBbXTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmFsdWUubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgbGV0dGVyID0gdmFsdWVbaV07XG4gICAgICAgICAgICAgICAgaWYgKHJlZmVyZW5jZXNUb1VwZGF0ZVtsZXR0ZXJdKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldHRlciA9IHJlZmVyZW5jZXNUb1VwZGF0ZVtsZXR0ZXJdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmb3JtdWxhW2tleV0ucHVzaChsZXR0ZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIG9iai5mb3JtdWxhID0gZm9ybXVsYTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVcGRhdGUgZm9ybXVsYVxuICAgICAqL1xuICAgIG9iai51cGRhdGVGb3JtdWxhID0gZnVuY3Rpb24oZm9ybXVsYSwgcmVmZXJlbmNlc1RvVXBkYXRlKSB7XG4gICAgICAgIHZhciB0ZXN0TGV0dGVyID0gL1tBLVpdLztcbiAgICAgICAgdmFyIHRlc3ROdW1iZXIgPSAvWzAtOV0vO1xuXG4gICAgICAgIHZhciBuZXdGb3JtdWxhID0gJyc7XG4gICAgICAgIHZhciBsZXR0ZXIgPSBudWxsO1xuICAgICAgICB2YXIgbnVtYmVyID0gbnVsbDtcbiAgICAgICAgdmFyIHRva2VuID0gJyc7XG5cbiAgICAgICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IGZvcm11bGEubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICAgICAgICBpZiAodGVzdExldHRlci5leGVjKGZvcm11bGFbaW5kZXhdKSkge1xuICAgICAgICAgICAgICAgIGxldHRlciA9IDE7XG4gICAgICAgICAgICAgICAgbnVtYmVyID0gMDtcbiAgICAgICAgICAgICAgICB0b2tlbiArPSBmb3JtdWxhW2luZGV4XTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGVzdE51bWJlci5leGVjKGZvcm11bGFbaW5kZXhdKSkge1xuICAgICAgICAgICAgICAgIG51bWJlciA9IGxldHRlciA/IDEgOiAwO1xuICAgICAgICAgICAgICAgIHRva2VuICs9IGZvcm11bGFbaW5kZXhdO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAobGV0dGVyICYmIG51bWJlcikge1xuICAgICAgICAgICAgICAgICAgICB0b2tlbiA9IHJlZmVyZW5jZXNUb1VwZGF0ZVt0b2tlbl0gPyByZWZlcmVuY2VzVG9VcGRhdGVbdG9rZW5dIDogdG9rZW47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG5ld0Zvcm11bGEgKz0gdG9rZW47XG4gICAgICAgICAgICAgICAgbmV3Rm9ybXVsYSArPSBmb3JtdWxhW2luZGV4XTtcbiAgICAgICAgICAgICAgICBsZXR0ZXIgPSAwO1xuICAgICAgICAgICAgICAgIG51bWJlciA9IDA7XG4gICAgICAgICAgICAgICAgdG9rZW4gPSAnJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0b2tlbikge1xuICAgICAgICAgICAgaWYgKGxldHRlciAmJiBudW1iZXIpIHtcbiAgICAgICAgICAgICAgICB0b2tlbiA9IHJlZmVyZW5jZXNUb1VwZGF0ZVt0b2tlbl0gPyByZWZlcmVuY2VzVG9VcGRhdGVbdG9rZW5dIDogdG9rZW47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBuZXdGb3JtdWxhICs9IHRva2VuO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG5ld0Zvcm11bGE7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUGFyc2UgZm9ybXVsYXNcbiAgICAgKi9cbiAgICBvYmouZXhlY3V0ZUZvcm11bGEgPSBmdW5jdGlvbihleHByZXNzaW9uLCB4LCB5KSB7XG5cbiAgICAgICAgdmFyIGZvcm11bGFSZXN1bHRzID0gW107XG4gICAgICAgIHZhciBmb3JtdWxhTG9vcFByb3RlY3Rpb24gPSBbXTtcblxuICAgICAgICAvLyBFeGVjdXRlIGZvcm11bGEgd2l0aCBsb29wIHByb3RlY3Rpb25cbiAgICAgICAgdmFyIGV4ZWN1dGUgPSBmdW5jdGlvbihleHByZXNzaW9uLCB4LCB5KSB7XG4gICAgICAgICAvLyBQYXJlbnQgY29sdW1uIGlkZW50aWZpY2F0aW9uXG4gICAgICAgICAgICB2YXIgcGFyZW50SWQgPSBqZXhjZWwuZ2V0Q29sdW1uTmFtZUZyb21JZChbeCwgeV0pO1xuXG4gICAgICAgICAgICAvLyBDb2RlIHByb3RlY3Rpb25cbiAgICAgICAgICAgIGlmIChmb3JtdWxhTG9vcFByb3RlY3Rpb25bcGFyZW50SWRdKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignUmVmZXJlbmNlIGxvb3AgZGV0ZWN0ZWQnKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gJyNFUlJPUic7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZvcm11bGFMb29wUHJvdGVjdGlvbltwYXJlbnRJZF0gPSB0cnVlO1xuXG4gICAgICAgICAgICAvLyBDb252ZXJ0IHJhbmdlIHRva2Vuc1xuICAgICAgICAgICAgdmFyIHRva2Vuc1VwZGF0ZSA9IGZ1bmN0aW9uKHRva2Vucykge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCB0b2tlbnMubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBmID0gW107XG4gICAgICAgICAgICAgICAgICAgIHZhciB0b2tlbiA9IHRva2Vuc1tpbmRleF0uc3BsaXQoJzonKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGUxID0gamV4Y2VsLmdldElkRnJvbUNvbHVtbk5hbWUodG9rZW5bMF0sIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZTIgPSBqZXhjZWwuZ2V0SWRGcm9tQ29sdW1uTmFtZSh0b2tlblsxXSwgdHJ1ZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGUxWzBdIDw9IGUyWzBdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgeDEgPSBlMVswXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB4MiA9IGUyWzBdO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHgxID0gZTJbMF07XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgeDIgPSBlMVswXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChlMVsxXSA8PSBlMlsxXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHkxID0gZTFbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgeTIgPSBlMlsxXTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB5MSA9IGUyWzFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHkyID0gZTFbMV07XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0geTE7IGogPD0geTI7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IHgxOyBpIDw9IHgyOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLnB1c2goamV4Y2VsLmdldENvbHVtbk5hbWVGcm9tSWQoW2ksIGpdKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBleHByZXNzaW9uID0gZXhwcmVzc2lvbi5yZXBsYWNlKHRva2Vuc1tpbmRleF0sIGYuam9pbignLCcpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciB0b2tlbnMgPSBleHByZXNzaW9uLm1hdGNoKC8oW0EtWl0rWzAtOV0rKVxcOihbQS1aXStbMC05XSspL2cpO1xuICAgICAgICAgICAgaWYgKHRva2VucyAmJiB0b2tlbnMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdG9rZW5zVXBkYXRlKHRva2Vucyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFN0cmluZ1xuICAgICAgICAgICAgdmFyIGV2YWxzdHJpbmcgPSAnJztcblxuICAgICAgICAgICAgLy8gR2V0IHRva2Vuc1xuICAgICAgICAgICAgdmFyIHRva2VucyA9IGV4cHJlc3Npb24ubWF0Y2goLyhbQS1aXStbMC05XSspL2cpO1xuXG4gICAgICAgICAgICAvLyBEaXJlY3Qgc2VsZi1yZWZlcmVuY2UgcHJvdGVjdGlvblxuICAgICAgICAgICAgaWYgKHRva2VucyAmJiB0b2tlbnMuaW5kZXhPZihwYXJlbnRJZCkgPiAtMSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1NlbGYgUmVmZXJlbmNlIGRldGVjdGVkJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuICcjRVJST1InO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAodG9rZW5zKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdG9rZW5zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBLZWVwIGNoYWluXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoISBvYmouZm9ybXVsYVt0b2tlbnNbaV1dKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmZvcm11bGFbdG9rZW5zW2ldXSA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSXMgYWxyZWFkeSBpbiB0aGUgcmVnaXN0ZXJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmouZm9ybXVsYVt0b2tlbnNbaV1dLmluZGV4T2YocGFyZW50SWQpIDwgMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5mb3JtdWxhW3Rva2Vuc1tpXV0ucHVzaChwYXJlbnRJZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIERvIG5vdCBjYWxjdWxhdGUgYWdhaW5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChldmFsKCd0eXBlb2YoJyArIHRva2Vuc1tpXSArICcpID09IFwidW5kZWZpbmVkXCInKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENvb3Jkc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwb3NpdGlvbiA9IGpleGNlbC5nZXRJZEZyb21Db2x1bW5OYW1lKHRva2Vuc1tpXSwgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gR2V0IHZhbHVlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZihvYmoub3B0aW9ucy5kYXRhW3Bvc2l0aW9uWzFdXSkgIT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mKG9iai5vcHRpb25zLmRhdGFbcG9zaXRpb25bMV1dW3Bvc2l0aW9uWzBdXSkgIT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gb2JqLm9wdGlvbnMuZGF0YVtwb3NpdGlvblsxXV1bcG9zaXRpb25bMF1dO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9ICcnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBHZXQgY29sdW1uIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKCcnK3ZhbHVlKS5zdWJzdHIoMCwxKSA9PSAnPScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZvcm11bGFSZXN1bHRzW3Rva2Vuc1tpXV0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gZm9ybXVsYVJlc3VsdHNbdG9rZW5zW2ldXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gZXhlY3V0ZSh2YWx1ZSwgcG9zaXRpb25bMF0sIHBvc2l0aW9uWzFdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm11bGFSZXN1bHRzW3Rva2Vuc1tpXV0gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUeXBlIVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoJycrdmFsdWUpLnRyaW0oKSA9PSAnJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBOdWxsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2YWxzdHJpbmcgKz0gXCJ2YXIgXCIgKyB0b2tlbnNbaV0gKyBcIiA9IG51bGw7XCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlID09IE51bWJlcih2YWx1ZSkgJiYgb2JqLm9wdGlvbnMuYXV0b0Nhc3RpbmcgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTnVtYmVyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmFsc3RyaW5nICs9IFwidmFyIFwiICsgdG9rZW5zW2ldICsgXCIgPSBcIiArIE51bWJlcih2YWx1ZSkgKyBcIjtcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRyeWluZyBhbnkgZm9ybWF0dGVkIG51bWJlclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG51bWJlciA9IG9iai5wYXJzZU51bWJlcih2YWx1ZSwgcG9zaXRpb25bMF0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuYXV0b0Nhc3RpbmcgPT0gdHJ1ZSAmJiBudW1iZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZW5kZXIgYXMgbnVtYmVyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZhbHN0cmluZyArPSBcInZhciBcIiArIHRva2Vuc1tpXSArIFwiID0gXCIgKyBudW1iZXIgKyBcIjtcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVuZGVyIGFzIHN0cmluZ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2YWxzdHJpbmcgKz0gXCJ2YXIgXCIgKyB0b2tlbnNbaV0gKyBcIiA9ICdcIiArIHZhbHVlICsgXCInO1wiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gQ29udmVydCBmb3JtdWxhIHRvIGphdmFzY3JpcHRcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBldmFsc3RyaW5nICs9IFwiZnVuY3Rpb24gQ09MVU1OKCkgeyByZXR1cm4gcGFyc2VJbnQoeCkgKyAxOyB9OyBmdW5jdGlvbiBST1coKSB7IHJldHVybiBwYXJzZUludCh5KSArIDE7IH07IGZ1bmN0aW9uIENFTEwoKSB7IHJldHVybiBwYXJlbnRJZDsgfTtcIjtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVzID0gZXZhbChldmFsc3RyaW5nICsgZXhwcmVzc2lvbi5zdWJzdHIoMSkpO1xuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlcyA9ICcjRVJST1InO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiByZXM7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZXhlY3V0ZShleHByZXNzaW9uLCB4LCB5KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUcnlpbmcgdG8gZXh0cmFjdCBhIG51bWJlciBmcm9tIGEgc3RyaW5nXG4gICAgICovXG4gICAgb2JqLnBhcnNlTnVtYmVyID0gZnVuY3Rpb24odmFsdWUsIGNvbHVtbk51bWJlcikge1xuICAgICAgICAvLyBEZWNpbWFsIHBvaW50XG4gICAgICAgIHZhciBkZWNpbWFsID0gY29sdW1uTnVtYmVyICYmIG9iai5vcHRpb25zLmNvbHVtbnNbY29sdW1uTnVtYmVyXS5kZWNpbWFsID8gb2JqLm9wdGlvbnMuY29sdW1uc1tjb2x1bW5OdW1iZXJdLmRlY2ltYWwgOiAnLic7XG5cbiAgICAgICAgLy8gUGFyc2UgYm90aCBwYXJ0cyBvZiB0aGUgbnVtYmVyXG4gICAgICAgIHZhciBudW1iZXIgPSAoJycgKyB2YWx1ZSk7XG4gICAgICAgIG51bWJlciA9IG51bWJlci5zcGxpdChkZWNpbWFsKTtcbiAgICAgICAgbnVtYmVyWzBdID0gbnVtYmVyWzBdLm1hdGNoKC9bKy1dP1swLTldL2cpO1xuICAgICAgICBpZiAobnVtYmVyWzBdKSB7XG4gICAgICAgICAgICBudW1iZXJbMF0gPSBudW1iZXJbMF0uam9pbignJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG51bWJlclsxXSkge1xuICAgICAgICAgICAgbnVtYmVyWzFdID0gbnVtYmVyWzFdLm1hdGNoKC9bMC05XSovZykuam9pbignJyk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBJcyBhIHZhbGlkIG51bWJlclxuICAgICAgICBpZiAobnVtYmVyWzBdICYmIE51bWJlcihudW1iZXJbMF0pID49IDApIHtcbiAgICAgICAgICAgIGlmICghIG51bWJlclsxXSkge1xuICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IE51bWJlcihudW1iZXJbMF0gKyAnLjAwJyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IE51bWJlcihudW1iZXJbMF0gKyAnLicgKyBudW1iZXJbMV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgcm93IG51bWJlclxuICAgICAqL1xuICAgIG9iai5yb3cgPSBmdW5jdGlvbihjZWxsKSB7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IGNvbCBudW1iZXJcbiAgICAgKi9cbiAgICBvYmouY29sID0gZnVuY3Rpb24oY2VsbCkge1xuICAgIH1cblxuICAgIG9iai51cCA9IGZ1bmN0aW9uKHNoaWZ0S2V5LCBjdHJsS2V5KSB7XG4gICAgICAgIGlmIChzaGlmdEtleSkge1xuICAgICAgICAgICAgaWYgKG9iai5zZWxlY3RlZENlbGxbM10gPiAwKSB7XG4gICAgICAgICAgICAgICAgb2JqLnVwLnZpc2libGUoMSwgY3RybEtleSA/IDAgOiAxKVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKG9iai5zZWxlY3RlZENlbGxbMV0gPiAwKSB7XG4gICAgICAgICAgICAgICAgb2JqLnVwLnZpc2libGUoMCwgY3RybEtleSA/IDAgOiAxKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb2JqLnNlbGVjdGVkQ2VsbFsyXSA9IG9iai5zZWxlY3RlZENlbGxbMF07XG4gICAgICAgICAgICBvYmouc2VsZWN0ZWRDZWxsWzNdID0gb2JqLnNlbGVjdGVkQ2VsbFsxXTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFVwZGF0ZSBzZWxlY3Rpb25cbiAgICAgICAgb2JqLnVwZGF0ZVNlbGVjdGlvbkZyb21Db29yZHMob2JqLnNlbGVjdGVkQ2VsbFswXSwgb2JqLnNlbGVjdGVkQ2VsbFsxXSwgb2JqLnNlbGVjdGVkQ2VsbFsyXSwgb2JqLnNlbGVjdGVkQ2VsbFszXSk7XG5cbiAgICAgICAgLy8gQ2hhbmdlIHBhZ2VcbiAgICAgICAgaWYgKG9iai5vcHRpb25zLmxhenlMb2FkaW5nID09IHRydWUpIHtcbiAgICAgICAgICAgIGlmIChvYmouc2VsZWN0ZWRDZWxsWzFdID09IDAgfHwgb2JqLnNlbGVjdGVkQ2VsbFszXSA9PSAwKSB7XG4gICAgICAgICAgICAgICAgb2JqLmxvYWRQYWdlKDApO1xuICAgICAgICAgICAgICAgIG9iai51cGRhdGVTZWxlY3Rpb25Gcm9tQ29vcmRzKG9iai5zZWxlY3RlZENlbGxbMF0sIG9iai5zZWxlY3RlZENlbGxbMV0sIG9iai5zZWxlY3RlZENlbGxbMl0sIG9iai5zZWxlY3RlZENlbGxbM10pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAob2JqLmxvYWRWYWxpZGF0aW9uKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgb2JqLnVwZGF0ZVNlbGVjdGlvbkZyb21Db29yZHMob2JqLnNlbGVjdGVkQ2VsbFswXSwgb2JqLnNlbGVjdGVkQ2VsbFsxXSwgb2JqLnNlbGVjdGVkQ2VsbFsyXSwgb2JqLnNlbGVjdGVkQ2VsbFszXSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBwYXJzZUludChvYmoudGJvZHkuZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUoJ2RhdGEteScpKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5zZWxlY3RlZENlbGxbMV0gLSBpdGVtIDwgMzApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5sb2FkVXAoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai51cGRhdGVTZWxlY3Rpb25Gcm9tQ29vcmRzKG9iai5zZWxlY3RlZENlbGxbMF0sIG9iai5zZWxlY3RlZENlbGxbMV0sIG9iai5zZWxlY3RlZENlbGxbMl0sIG9iai5zZWxlY3RlZENlbGxbM10pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKG9iai5vcHRpb25zLnBhZ2luYXRpb24gPiAwKSB7XG4gICAgICAgICAgICB2YXIgcGFnZU51bWJlciA9IG9iai53aGljaFBhZ2Uob2JqLnNlbGVjdGVkQ2VsbFszXSk7XG4gICAgICAgICAgICBpZiAocGFnZU51bWJlciAhPSBvYmoucGFnZU51bWJlcikge1xuICAgICAgICAgICAgICAgIG9iai5wYWdlKHBhZ2VOdW1iZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgb2JqLnVwZGF0ZVNjcm9sbCgxKTtcbiAgICB9XG5cbiAgICBvYmoudXAudmlzaWJsZSA9IGZ1bmN0aW9uKGdyb3VwLCBkaXJlY3Rpb24pIHtcbiAgICAgICAgaWYgKGdyb3VwID09IDApIHtcbiAgICAgICAgICAgIHZhciB4ID0gcGFyc2VJbnQob2JqLnNlbGVjdGVkQ2VsbFswXSk7XG4gICAgICAgICAgICB2YXIgeSA9IHBhcnNlSW50KG9iai5zZWxlY3RlZENlbGxbMV0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIHggPSBwYXJzZUludChvYmouc2VsZWN0ZWRDZWxsWzJdKTtcbiAgICAgICAgICAgIHZhciB5ID0gcGFyc2VJbnQob2JqLnNlbGVjdGVkQ2VsbFszXSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGlyZWN0aW9uID09IDApIHtcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgeTsgaisrKSB7XG4gICAgICAgICAgICAgICAgaWYgKG9iai5yZWNvcmRzW2pdW3hdLnN0eWxlLmRpc3BsYXkgIT0gJ25vbmUnICYmIG9iai5yb3dzW2pdLnN0eWxlLmRpc3BsYXkgIT0gJ25vbmUnKSB7XG4gICAgICAgICAgICAgICAgICAgIHkgPSBqO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB5ID0gb2JqLnVwLmdldCh4LCB5KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChncm91cCA9PSAwKSB7XG4gICAgICAgICAgICBvYmouc2VsZWN0ZWRDZWxsWzBdID0geDtcbiAgICAgICAgICAgIG9iai5zZWxlY3RlZENlbGxbMV0gPSB5O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgb2JqLnNlbGVjdGVkQ2VsbFsyXSA9IHg7XG4gICAgICAgICAgICBvYmouc2VsZWN0ZWRDZWxsWzNdID0geTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG9iai51cC5nZXQgPSBmdW5jdGlvbih4LCB5KSB7XG4gICAgICAgIHZhciB4ID0gcGFyc2VJbnQoeCk7XG4gICAgICAgIHZhciB5ID0gcGFyc2VJbnQoeSk7XG4gICAgICAgIGZvciAodmFyIGogPSAoeSAtIDEpOyBqID49IDA7IGotLSkge1xuICAgICAgICAgICAgaWYgKG9iai5yZWNvcmRzW2pdW3hdLnN0eWxlLmRpc3BsYXkgIT0gJ25vbmUnICYmIG9iai5yb3dzW2pdLnN0eWxlLmRpc3BsYXkgIT0gJ25vbmUnKSB7XG4gICAgICAgICAgICAgICAgaWYgKG9iai5yZWNvcmRzW2pdW3hdLmdldEF0dHJpYnV0ZSgnZGF0YS1tZXJnZWQnKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLnJlY29yZHNbal1beF0gPT0gb2JqLnJlY29yZHNbeV1beF0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHkgPSBqO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHk7XG4gICAgfVxuXG4gICAgb2JqLmRvd24gPSBmdW5jdGlvbihzaGlmdEtleSwgY3RybEtleSkge1xuICAgICAgICBpZiAoc2hpZnRLZXkpIHtcbiAgICAgICAgICAgIGlmIChvYmouc2VsZWN0ZWRDZWxsWzNdIDwgb2JqLnJlY29yZHMubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgICAgIG9iai5kb3duLnZpc2libGUoMSwgY3RybEtleSA/IDAgOiAxKVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKG9iai5zZWxlY3RlZENlbGxbMV0gPCBvYmoucmVjb3Jkcy5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICAgICAgb2JqLmRvd24udmlzaWJsZSgwLCBjdHJsS2V5ID8gMCA6IDEpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvYmouc2VsZWN0ZWRDZWxsWzJdID0gb2JqLnNlbGVjdGVkQ2VsbFswXTtcbiAgICAgICAgICAgIG9iai5zZWxlY3RlZENlbGxbM10gPSBvYmouc2VsZWN0ZWRDZWxsWzFdO1xuICAgICAgICB9XG5cbiAgICAgICAgb2JqLnVwZGF0ZVNlbGVjdGlvbkZyb21Db29yZHMob2JqLnNlbGVjdGVkQ2VsbFswXSwgb2JqLnNlbGVjdGVkQ2VsbFsxXSwgb2JqLnNlbGVjdGVkQ2VsbFsyXSwgb2JqLnNlbGVjdGVkQ2VsbFszXSk7XG5cbiAgICAgICAgLy8gQ2hhbmdlIHBhZ2VcbiAgICAgICAgaWYgKG9iai5vcHRpb25zLmxhenlMb2FkaW5nID09IHRydWUpIHtcbiAgICAgICAgICAgIGlmICgob2JqLnNlbGVjdGVkQ2VsbFsxXSA9PSBvYmoucmVjb3Jkcy5sZW5ndGggLSAxIHx8IG9iai5zZWxlY3RlZENlbGxbM10gPT0gb2JqLnJlY29yZHMubGVuZ3RoIC0gMSkpIHtcbiAgICAgICAgICAgICAgICBvYmoubG9hZFBhZ2UoLTEpO1xuICAgICAgICAgICAgICAgIG9iai51cGRhdGVTZWxlY3Rpb25Gcm9tQ29vcmRzKG9iai5zZWxlY3RlZENlbGxbMF0sIG9iai5zZWxlY3RlZENlbGxbMV0sIG9iai5zZWxlY3RlZENlbGxbMl0sIG9iai5zZWxlY3RlZENlbGxbM10pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAob2JqLmxvYWRWYWxpZGF0aW9uKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgb2JqLnVwZGF0ZVNlbGVjdGlvbkZyb21Db29yZHMob2JqLnNlbGVjdGVkQ2VsbFswXSwgb2JqLnNlbGVjdGVkQ2VsbFsxXSwgb2JqLnNlbGVjdGVkQ2VsbFsyXSwgb2JqLnNlbGVjdGVkQ2VsbFszXSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBwYXJzZUludChvYmoudGJvZHkubGFzdENoaWxkLmdldEF0dHJpYnV0ZSgnZGF0YS15JykpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbSAtIG9iai5zZWxlY3RlZENlbGxbM10gPCAzMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmxvYWREb3duKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoudXBkYXRlU2VsZWN0aW9uRnJvbUNvb3JkcyhvYmouc2VsZWN0ZWRDZWxsWzBdLCBvYmouc2VsZWN0ZWRDZWxsWzFdLCBvYmouc2VsZWN0ZWRDZWxsWzJdLCBvYmouc2VsZWN0ZWRDZWxsWzNdKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChvYmoub3B0aW9ucy5wYWdpbmF0aW9uID4gMCkge1xuICAgICAgICAgICAgdmFyIHBhZ2VOdW1iZXIgPSBvYmoud2hpY2hQYWdlKG9iai5zZWxlY3RlZENlbGxbM10pO1xuICAgICAgICAgICAgaWYgKHBhZ2VOdW1iZXIgIT0gb2JqLnBhZ2VOdW1iZXIpIHtcbiAgICAgICAgICAgICAgICBvYmoucGFnZShwYWdlTnVtYmVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIG9iai51cGRhdGVTY3JvbGwoMyk7XG4gICAgfVxuXG4gICAgb2JqLmRvd24udmlzaWJsZSA9IGZ1bmN0aW9uKGdyb3VwLCBkaXJlY3Rpb24pIHtcbiAgICAgICAgaWYgKGdyb3VwID09IDApIHtcbiAgICAgICAgICAgIHZhciB4ID0gcGFyc2VJbnQob2JqLnNlbGVjdGVkQ2VsbFswXSk7XG4gICAgICAgICAgICB2YXIgeSA9IHBhcnNlSW50KG9iai5zZWxlY3RlZENlbGxbMV0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIHggPSBwYXJzZUludChvYmouc2VsZWN0ZWRDZWxsWzJdKTtcbiAgICAgICAgICAgIHZhciB5ID0gcGFyc2VJbnQob2JqLnNlbGVjdGVkQ2VsbFszXSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGlyZWN0aW9uID09IDApIHtcbiAgICAgICAgICAgIGZvciAodmFyIGogPSBvYmoucm93cy5sZW5ndGggLSAxOyBqID4geTsgai0tKSB7XG4gICAgICAgICAgICAgICAgaWYgKG9iai5yZWNvcmRzW2pdW3hdLnN0eWxlLmRpc3BsYXkgIT0gJ25vbmUnICYmIG9iai5yb3dzW2pdLnN0eWxlLmRpc3BsYXkgIT0gJ25vbmUnKSB7XG4gICAgICAgICAgICAgICAgICAgIHkgPSBqO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB5ID0gb2JqLmRvd24uZ2V0KHgsIHkpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGdyb3VwID09IDApIHtcbiAgICAgICAgICAgIG9iai5zZWxlY3RlZENlbGxbMF0gPSB4O1xuICAgICAgICAgICAgb2JqLnNlbGVjdGVkQ2VsbFsxXSA9IHk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBvYmouc2VsZWN0ZWRDZWxsWzJdID0geDtcbiAgICAgICAgICAgIG9iai5zZWxlY3RlZENlbGxbM10gPSB5O1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgb2JqLmRvd24uZ2V0ID0gZnVuY3Rpb24oeCwgeSkge1xuICAgICAgICB2YXIgeCA9IHBhcnNlSW50KHgpO1xuICAgICAgICB2YXIgeSA9IHBhcnNlSW50KHkpO1xuICAgICAgICBmb3IgKHZhciBqID0gKHkgKyAxKTsgaiA8IG9iai5yb3dzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICBpZiAob2JqLnJlY29yZHNbal1beF0uc3R5bGUuZGlzcGxheSAhPSAnbm9uZScgJiYgb2JqLnJvd3Nbal0uc3R5bGUuZGlzcGxheSAhPSAnbm9uZScpIHtcbiAgICAgICAgICAgICAgICBpZiAob2JqLnJlY29yZHNbal1beF0uZ2V0QXR0cmlidXRlKCdkYXRhLW1lcmdlZCcpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmoucmVjb3Jkc1tqXVt4XSA9PSBvYmoucmVjb3Jkc1t5XVt4XSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgeSA9IGo7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geTtcbiAgICB9XG5cbiAgICBvYmoucmlnaHQgPSBmdW5jdGlvbihzaGlmdEtleSwgY3RybEtleSkge1xuICAgICAgICBpZiAoc2hpZnRLZXkpIHtcbiAgICAgICAgICAgIGlmIChvYmouc2VsZWN0ZWRDZWxsWzJdIDwgb2JqLmhlYWRlcnMubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgICAgIG9iai5yaWdodC52aXNpYmxlKDEsIGN0cmxLZXkgPyAwIDogMSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChvYmouc2VsZWN0ZWRDZWxsWzBdIDwgb2JqLmhlYWRlcnMubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgICAgIG9iai5yaWdodC52aXNpYmxlKDAsIGN0cmxLZXkgPyAwIDogMSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG9iai5zZWxlY3RlZENlbGxbMl0gPSBvYmouc2VsZWN0ZWRDZWxsWzBdO1xuICAgICAgICAgICAgb2JqLnNlbGVjdGVkQ2VsbFszXSA9IG9iai5zZWxlY3RlZENlbGxbMV07XG4gICAgICAgIH1cblxuICAgICAgICBvYmoudXBkYXRlU2VsZWN0aW9uRnJvbUNvb3JkcyhvYmouc2VsZWN0ZWRDZWxsWzBdLCBvYmouc2VsZWN0ZWRDZWxsWzFdLCBvYmouc2VsZWN0ZWRDZWxsWzJdLCBvYmouc2VsZWN0ZWRDZWxsWzNdKTtcbiAgICAgICAgb2JqLnVwZGF0ZVNjcm9sbCgyKTtcbiAgICB9XG5cbiAgICBvYmoucmlnaHQudmlzaWJsZSA9IGZ1bmN0aW9uKGdyb3VwLCBkaXJlY3Rpb24pIHtcbiAgICAgICAgaWYgKGdyb3VwID09IDApIHtcbiAgICAgICAgICAgIHZhciB4ID0gcGFyc2VJbnQob2JqLnNlbGVjdGVkQ2VsbFswXSk7XG4gICAgICAgICAgICB2YXIgeSA9IHBhcnNlSW50KG9iai5zZWxlY3RlZENlbGxbMV0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIHggPSBwYXJzZUludChvYmouc2VsZWN0ZWRDZWxsWzJdKTtcbiAgICAgICAgICAgIHZhciB5ID0gcGFyc2VJbnQob2JqLnNlbGVjdGVkQ2VsbFszXSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGlyZWN0aW9uID09IDApIHtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSBvYmouaGVhZGVycy5sZW5ndGggLSAxOyBpID4geDsgaS0tKSB7XG4gICAgICAgICAgICAgICAgaWYgKG9iai5yZWNvcmRzW3ldW2ldLnN0eWxlLmRpc3BsYXkgIT0gJ25vbmUnKSB7XG4gICAgICAgICAgICAgICAgICAgIHggPSBpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB4ID0gb2JqLnJpZ2h0LmdldCh4LCB5KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChncm91cCA9PSAwKSB7XG4gICAgICAgICAgICBvYmouc2VsZWN0ZWRDZWxsWzBdID0geDtcbiAgICAgICAgICAgIG9iai5zZWxlY3RlZENlbGxbMV0gPSB5O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgb2JqLnNlbGVjdGVkQ2VsbFsyXSA9IHg7XG4gICAgICAgICAgICBvYmouc2VsZWN0ZWRDZWxsWzNdID0geTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG9iai5yaWdodC5nZXQgPSBmdW5jdGlvbih4LCB5KSB7XG4gICAgICAgIHZhciB4ID0gcGFyc2VJbnQoeCk7XG4gICAgICAgIHZhciB5ID0gcGFyc2VJbnQoeSk7XG5cbiAgICAgICAgZm9yICh2YXIgaSA9ICh4ICsgMSk7IGkgPCBvYmouaGVhZGVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKG9iai5yZWNvcmRzW3ldW2ldLnN0eWxlLmRpc3BsYXkgIT0gJ25vbmUnKSB7XG4gICAgICAgICAgICAgICAgaWYgKG9iai5yZWNvcmRzW3ldW2ldLmdldEF0dHJpYnV0ZSgnZGF0YS1tZXJnZWQnKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLnJlY29yZHNbeV1baV0gPT0gb2JqLnJlY29yZHNbeV1beF0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHggPSBpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHg7XG4gICAgfVxuXG4gICAgb2JqLmxlZnQgPSBmdW5jdGlvbihzaGlmdEtleSwgY3RybEtleSkge1xuICAgICAgICBpZiAoc2hpZnRLZXkpIHtcbiAgICAgICAgICAgIGlmIChvYmouc2VsZWN0ZWRDZWxsWzJdID4gMCkge1xuICAgICAgICAgICAgICAgIG9iai5sZWZ0LnZpc2libGUoMSwgY3RybEtleSA/IDAgOiAxKVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKG9iai5zZWxlY3RlZENlbGxbMF0gPiAwKSB7XG4gICAgICAgICAgICAgICAgb2JqLmxlZnQudmlzaWJsZSgwLCBjdHJsS2V5ID8gMCA6IDEpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvYmouc2VsZWN0ZWRDZWxsWzJdID0gb2JqLnNlbGVjdGVkQ2VsbFswXTtcbiAgICAgICAgICAgIG9iai5zZWxlY3RlZENlbGxbM10gPSBvYmouc2VsZWN0ZWRDZWxsWzFdO1xuICAgICAgICB9XG5cbiAgICAgICAgb2JqLnVwZGF0ZVNlbGVjdGlvbkZyb21Db29yZHMob2JqLnNlbGVjdGVkQ2VsbFswXSwgb2JqLnNlbGVjdGVkQ2VsbFsxXSwgb2JqLnNlbGVjdGVkQ2VsbFsyXSwgb2JqLnNlbGVjdGVkQ2VsbFszXSk7XG4gICAgICAgIG9iai51cGRhdGVTY3JvbGwoMCk7XG4gICAgfVxuXG4gICAgb2JqLmxlZnQudmlzaWJsZSA9IGZ1bmN0aW9uKGdyb3VwLCBkaXJlY3Rpb24pIHtcbiAgICAgICAgaWYgKGdyb3VwID09IDApIHtcbiAgICAgICAgICAgIHZhciB4ID0gcGFyc2VJbnQob2JqLnNlbGVjdGVkQ2VsbFswXSk7XG4gICAgICAgICAgICB2YXIgeSA9IHBhcnNlSW50KG9iai5zZWxlY3RlZENlbGxbMV0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIHggPSBwYXJzZUludChvYmouc2VsZWN0ZWRDZWxsWzJdKTtcbiAgICAgICAgICAgIHZhciB5ID0gcGFyc2VJbnQob2JqLnNlbGVjdGVkQ2VsbFszXSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGlyZWN0aW9uID09IDApIHtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgeDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKG9iai5yZWNvcmRzW3ldW2ldLnN0eWxlLmRpc3BsYXkgIT0gJ25vbmUnKSB7XG4gICAgICAgICAgICAgICAgICAgIHggPSBpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB4ID0gb2JqLmxlZnQuZ2V0KHgsIHkpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGdyb3VwID09IDApIHtcbiAgICAgICAgICAgIG9iai5zZWxlY3RlZENlbGxbMF0gPSB4O1xuICAgICAgICAgICAgb2JqLnNlbGVjdGVkQ2VsbFsxXSA9IHk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBvYmouc2VsZWN0ZWRDZWxsWzJdID0geDtcbiAgICAgICAgICAgIG9iai5zZWxlY3RlZENlbGxbM10gPSB5O1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgb2JqLmxlZnQuZ2V0ID0gZnVuY3Rpb24oeCwgeSkge1xuICAgICAgICB2YXIgeCA9IHBhcnNlSW50KHgpO1xuICAgICAgICB2YXIgeSA9IHBhcnNlSW50KHkpO1xuICAgICAgICBmb3IgKHZhciBpID0gKHggLSAxKTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICAgIGlmIChvYmoucmVjb3Jkc1t5XVtpXS5zdHlsZS5kaXNwbGF5ICE9ICdub25lJykge1xuICAgICAgICAgICAgICAgIGlmIChvYmoucmVjb3Jkc1t5XVtpXS5nZXRBdHRyaWJ1dGUoJ2RhdGEtbWVyZ2VkJykpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5yZWNvcmRzW3ldW2ldID09IG9iai5yZWNvcmRzW3ldW3hdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB4ID0gaTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB4O1xuICAgIH1cblxuICAgIG9iai5maXJzdCA9IGZ1bmN0aW9uKHNoaWZ0S2V5LCBjdHJsS2V5KSB7XG4gICAgICAgIGlmIChzaGlmdEtleSkge1xuICAgICAgICAgICAgaWYgKGN0cmxLZXkpIHtcbiAgICAgICAgICAgICAgICBvYmouc2VsZWN0ZWRDZWxsWzNdID0gMDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgb2JqLmxlZnQudmlzaWJsZSgxLCAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChjdHJsS2V5KSB7XG4gICAgICAgICAgICAgICAgb2JqLnNlbGVjdGVkQ2VsbFsxXSA9IDA7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG9iai5sZWZ0LnZpc2libGUoMCwgMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvYmouc2VsZWN0ZWRDZWxsWzJdID0gb2JqLnNlbGVjdGVkQ2VsbFswXTtcbiAgICAgICAgICAgIG9iai5zZWxlY3RlZENlbGxbM10gPSBvYmouc2VsZWN0ZWRDZWxsWzFdO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2hhbmdlIHBhZ2VcbiAgICAgICAgaWYgKG9iai5vcHRpb25zLmxhenlMb2FkaW5nID09IHRydWUgJiYgKG9iai5zZWxlY3RlZENlbGxbMV0gPT0gMCB8fCBvYmouc2VsZWN0ZWRDZWxsWzNdID09IDApKSB7XG4gICAgICAgICAgICBvYmoubG9hZFBhZ2UoMCk7XG4gICAgICAgIH0gZWxzZSBpZiAob2JqLm9wdGlvbnMucGFnaW5hdGlvbiA+IDApIHtcbiAgICAgICAgICAgIHZhciBwYWdlTnVtYmVyID0gb2JqLndoaWNoUGFnZShvYmouc2VsZWN0ZWRDZWxsWzNdKTtcbiAgICAgICAgICAgIGlmIChwYWdlTnVtYmVyICE9IG9iai5wYWdlTnVtYmVyKSB7XG4gICAgICAgICAgICAgICAgb2JqLnBhZ2UocGFnZU51bWJlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBvYmoudXBkYXRlU2VsZWN0aW9uRnJvbUNvb3JkcyhvYmouc2VsZWN0ZWRDZWxsWzBdLCBvYmouc2VsZWN0ZWRDZWxsWzFdLCBvYmouc2VsZWN0ZWRDZWxsWzJdLCBvYmouc2VsZWN0ZWRDZWxsWzNdKTtcbiAgICAgICAgb2JqLnVwZGF0ZVNjcm9sbCgxKTtcbiAgICB9XG5cbiAgICBvYmoubGFzdCA9IGZ1bmN0aW9uKHNoaWZ0S2V5LCBjdHJsS2V5KSB7XG4gICAgICAgIGlmIChzaGlmdEtleSkge1xuICAgICAgICAgICAgaWYgKGN0cmxLZXkpIHtcbiAgICAgICAgICAgICAgICBvYmouc2VsZWN0ZWRDZWxsWzNdID0gb2JqLnJlY29yZHMubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgb2JqLnJpZ2h0LnZpc2libGUoMSwgMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoY3RybEtleSkge1xuICAgICAgICAgICAgICAgIG9iai5zZWxlY3RlZENlbGxbMV0gPSBvYmoucmVjb3Jkcy5sZW5ndGggLSAxO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBvYmoucmlnaHQudmlzaWJsZSgwLCAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG9iai5zZWxlY3RlZENlbGxbMl0gPSBvYmouc2VsZWN0ZWRDZWxsWzBdO1xuICAgICAgICAgICAgb2JqLnNlbGVjdGVkQ2VsbFszXSA9IG9iai5zZWxlY3RlZENlbGxbMV07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDaGFuZ2UgcGFnZVxuICAgICAgICBpZiAob2JqLm9wdGlvbnMubGF6eUxvYWRpbmcgPT0gdHJ1ZSAmJiAob2JqLnNlbGVjdGVkQ2VsbFsxXSA9PSBvYmoucmVjb3Jkcy5sZW5ndGggLSAxIHx8IG9iai5zZWxlY3RlZENlbGxbM10gPT0gb2JqLnJlY29yZHMubGVuZ3RoIC0gMSkpIHtcbiAgICAgICAgICAgIG9iai5sb2FkUGFnZSgtMSk7XG4gICAgICAgIH0gZWxzZSBpZiAob2JqLm9wdGlvbnMucGFnaW5hdGlvbiA+IDApIHtcbiAgICAgICAgICAgIHZhciBwYWdlTnVtYmVyID0gb2JqLndoaWNoUGFnZShvYmouc2VsZWN0ZWRDZWxsWzNdKTtcbiAgICAgICAgICAgIGlmIChwYWdlTnVtYmVyICE9IG9iai5wYWdlTnVtYmVyKSB7XG4gICAgICAgICAgICAgICAgb2JqLnBhZ2UocGFnZU51bWJlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBvYmoudXBkYXRlU2VsZWN0aW9uRnJvbUNvb3JkcyhvYmouc2VsZWN0ZWRDZWxsWzBdLCBvYmouc2VsZWN0ZWRDZWxsWzFdLCBvYmouc2VsZWN0ZWRDZWxsWzJdLCBvYmouc2VsZWN0ZWRDZWxsWzNdKTtcbiAgICAgICAgb2JqLnVwZGF0ZVNjcm9sbCgzKTtcbiAgICB9XG5cbiAgICBvYmouc2VsZWN0QWxsID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICghIG9iai5zZWxlY3RlZENlbGwpIHtcbiAgICAgICAgICAgIG9iai5zZWxlY3RlZENlbGwgPSBbXTtcbiAgICAgICAgfVxuXG4gICAgICAgIG9iai5zZWxlY3RlZENlbGxbMF0gPSAwO1xuICAgICAgICBvYmouc2VsZWN0ZWRDZWxsWzFdID0gMDtcbiAgICAgICAgb2JqLnNlbGVjdGVkQ2VsbFsyXSA9IG9iai5oZWFkZXJzLmxlbmd0aCAtIDE7XG4gICAgICAgIG9iai5zZWxlY3RlZENlbGxbM10gPSBvYmoucmVjb3Jkcy5sZW5ndGggLSAxO1xuXG4gICAgICAgIG9iai51cGRhdGVTZWxlY3Rpb25Gcm9tQ29vcmRzKG9iai5zZWxlY3RlZENlbGxbMF0sIG9iai5zZWxlY3RlZENlbGxbMV0sIG9iai5zZWxlY3RlZENlbGxbMl0sIG9iai5zZWxlY3RlZENlbGxbM10pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdvIHRvIGEgcGFnZSBpbiBhIGxhenlMb2FkaW5nXG4gICAgICovXG4gICAgb2JqLmxvYWRQYWdlID0gZnVuY3Rpb24ocGFnZU51bWJlcikge1xuICAgICAgICAvLyBTZWFyY2hcbiAgICAgICAgaWYgKG9iai5vcHRpb25zLnNlYXJjaCA9PSB0cnVlICYmIG9iai5yZXN1bHRzKSB7XG4gICAgICAgICAgICB2YXIgcmVzdWx0cyA9IG9iai5yZXN1bHRzO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIHJlc3VsdHMgPSBvYmoucm93cztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFBlciBwYWdlXG4gICAgICAgIHZhciBxdWFudGl0eVBlclBhZ2UgPSAxMDA7XG5cbiAgICAgICAgLy8gcGFnZU51bWJlclxuICAgICAgICBpZiAocGFnZU51bWJlciA9PSBudWxsIHx8IHBhZ2VOdW1iZXIgPT0gLTEpIHtcbiAgICAgICAgICAgIC8vIExhc3QgcGFnZVxuICAgICAgICAgICAgcGFnZU51bWJlciA9IE1hdGguY2VpbChyZXN1bHRzLmxlbmd0aCAvIHF1YW50aXR5UGVyUGFnZSk7IFxuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHN0YXJ0Um93ID0gKHBhZ2VOdW1iZXIgKiBxdWFudGl0eVBlclBhZ2UpO1xuICAgICAgICB2YXIgZmluYWxSb3cgPSAocGFnZU51bWJlciAqIHF1YW50aXR5UGVyUGFnZSkgKyBxdWFudGl0eVBlclBhZ2U7XG4gICAgICAgIGlmIChmaW5hbFJvdyA+IHJlc3VsdHMubGVuZ3RoKSB7XG4gICAgICAgICAgICBmaW5hbFJvdyA9IHJlc3VsdHMubGVuZ3RoO1xuICAgICAgICB9XG4gICAgICAgIHN0YXJ0Um93ID0gZmluYWxSb3cgLSAxMDA7XG4gICAgICAgIGlmIChzdGFydFJvdyA8IDApIHtcbiAgICAgICAgICAgIHN0YXJ0Um93ID0gMDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEFwcGVkaW5nIGl0ZW1zXG4gICAgICAgIGZvciAodmFyIGogPSBzdGFydFJvdzsgaiA8IGZpbmFsUm93OyBqKyspIHtcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5zZWFyY2ggPT0gdHJ1ZSAmJiBvYmoucmVzdWx0cykge1xuICAgICAgICAgICAgICAgIG9iai50Ym9keS5hcHBlbmRDaGlsZChvYmoucm93c1tyZXN1bHRzW2pdXSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG9iai50Ym9keS5hcHBlbmRDaGlsZChvYmoucm93c1tqXSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvYmoudGJvZHkuY2hpbGRyZW4ubGVuZ3RoID4gcXVhbnRpdHlQZXJQYWdlKSB7XG4gICAgICAgICAgICAgICAgb2JqLnRib2R5LnJlbW92ZUNoaWxkKG9iai50Ym9keS5maXJzdENoaWxkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIG9iai5sb2FkVXAgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gU2VhcmNoXG4gICAgICAgIGlmIChvYmoub3B0aW9ucy5zZWFyY2ggPT0gdHJ1ZSAmJiBvYmoucmVzdWx0cykge1xuICAgICAgICAgICAgdmFyIHJlc3VsdHMgPSBvYmoucmVzdWx0cztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciByZXN1bHRzID0gb2JqLnJvd3M7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHRlc3QgPSAwO1xuICAgICAgICBpZiAocmVzdWx0cy5sZW5ndGggPiAxMDApIHtcbiAgICAgICAgICAgIC8vIEdldCB0aGUgZmlyc3QgZWxlbWVudCBpbiB0aGUgcGFnZVxuICAgICAgICAgICAgdmFyIGl0ZW0gPSBwYXJzZUludChvYmoudGJvZHkuZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUoJ2RhdGEteScpKTtcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5zZWFyY2ggPT0gdHJ1ZSAmJiBvYmoucmVzdWx0cykge1xuICAgICAgICAgICAgICAgIGl0ZW0gPSByZXN1bHRzLmluZGV4T2YoaXRlbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaXRlbSA+IDApIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IDMwOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaXRlbSA9IGl0ZW0gLSAxO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbSA+IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuc2VhcmNoID09IHRydWUgJiYgb2JqLnJlc3VsdHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoudGJvZHkuaW5zZXJ0QmVmb3JlKG9iai5yb3dzW3Jlc3VsdHNbaXRlbV1dLCBvYmoudGJvZHkuZmlyc3RDaGlsZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai50Ym9keS5pbnNlcnRCZWZvcmUob2JqLnJvd3NbaXRlbV0sIG9iai50Ym9keS5maXJzdENoaWxkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmoudGJvZHkuY2hpbGRyZW4ubGVuZ3RoID4gMTAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnRib2R5LnJlbW92ZUNoaWxkKG9iai50Ym9keS5sYXN0Q2hpbGQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlc3QgPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0ZXN0O1xuICAgIH1cblxuICAgIG9iai5sb2FkRG93biA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBTZWFyY2hcbiAgICAgICAgaWYgKG9iai5vcHRpb25zLnNlYXJjaCA9PSB0cnVlICYmIG9iai5yZXN1bHRzKSB7XG4gICAgICAgICAgICB2YXIgcmVzdWx0cyA9IG9iai5yZXN1bHRzO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIHJlc3VsdHMgPSBvYmoucm93cztcbiAgICAgICAgfVxuICAgICAgICB2YXIgdGVzdCA9IDA7XG4gICAgICAgIGlmIChyZXN1bHRzLmxlbmd0aCA+IDEwMCkge1xuICAgICAgICAgICAgLy8gR2V0IHRoZSBsYXN0IGVsZW1lbnQgaW4gdGhlIHBhZ2VcbiAgICAgICAgICAgIHZhciBpdGVtID0gcGFyc2VJbnQob2JqLnRib2R5Lmxhc3RDaGlsZC5nZXRBdHRyaWJ1dGUoJ2RhdGEteScpKTtcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5zZWFyY2ggPT0gdHJ1ZSAmJiBvYmoucmVzdWx0cykge1xuICAgICAgICAgICAgICAgIGl0ZW0gPSByZXN1bHRzLmluZGV4T2YoaXRlbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaXRlbSA8IG9iai5yb3dzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8PSAzMDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtIDwgcmVzdWx0cy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5zZWFyY2ggPT0gdHJ1ZSAmJiBvYmoucmVzdWx0cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai50Ym9keS5hcHBlbmRDaGlsZChvYmoucm93c1tyZXN1bHRzW2l0ZW1dXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai50Ym9keS5hcHBlbmRDaGlsZChvYmoucm93c1tpdGVtXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLnRib2R5LmNoaWxkcmVuLmxlbmd0aCA+IDEwMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai50Ym9keS5yZW1vdmVDaGlsZChvYmoudGJvZHkuZmlyc3RDaGlsZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVzdCA9IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaXRlbSA9IGl0ZW0gKyAxO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0ZXN0O1xuICAgIH1cblxuICAgIG9iai5sb2FkVmFsaWRhdGlvbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAob2JqLnNlbGVjdGVkQ2VsbCkge1xuICAgICAgICAgICAgdmFyIGN1cnJlbnRQYWdlID0gcGFyc2VJbnQob2JqLnRib2R5LmZpcnN0Q2hpbGQuZ2V0QXR0cmlidXRlKCdkYXRhLXknKSkgLyAxMDA7XG4gICAgICAgICAgICB2YXIgc2VsZWN0ZWRQYWdlID0gcGFyc2VJbnQob2JqLnNlbGVjdGVkQ2VsbFszXSAvIDEwMCk7XG4gICAgICAgICAgICB2YXIgdG90YWxQYWdlcyA9IHBhcnNlSW50KG9iai5yb3dzLmxlbmd0aCAvIDEwMCk7XG5cbiAgICAgICAgICAgIGlmIChjdXJyZW50UGFnZSAhPSBzZWxlY3RlZFBhZ2UgJiYgc2VsZWN0ZWRQYWdlIDw9IHRvdGFsUGFnZXMpIHtcbiAgICAgICAgICAgICAgICBpZiAoISBBcnJheS5wcm90b3R5cGUuaW5kZXhPZi5jYWxsKG9iai50Ym9keS5jaGlsZHJlbiwgb2JqLnJvd3Nbb2JqLnNlbGVjdGVkQ2VsbFszXV0pKSB7XG4gICAgICAgICAgICAgICAgICAgIG9iai5sb2FkUGFnZShzZWxlY3RlZFBhZ2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVzZXQgc2VhcmNoXG4gICAgICovXG4gICAgb2JqLnJlc2V0U2VhcmNoID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIG9iai5zZWFyY2hJbnB1dC52YWx1ZSA9ICcnO1xuICAgICAgICBvYmouc2VhcmNoKCcnKTtcbiAgICAgICAgb2JqLnJlc3VsdHMgPSBudWxsO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNlYXJjaFxuICAgICAqL1xuICAgIG9iai5zZWFyY2ggPSBmdW5jdGlvbihxdWVyeSkge1xuICAgICAgICAvLyBRdWVyeVxuICAgICAgICBpZiAocXVlcnkpIHtcbiAgICAgICAgICAgIHZhciBxdWVyeSA9IHF1ZXJ5LnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBSZXNldCBzZWxlY3Rpb25cbiAgICAgICAgb2JqLnJlc2V0U2VsZWN0aW9uKCk7XG5cbiAgICAgICAgLy8gVG90YWwgb2YgcmVzdWx0c1xuICAgICAgICBvYmoucGFnZU51bWJlciA9IDA7XG4gICAgICAgIG9iai5yZXN1bHRzID0gW107XG5cbiAgICAgICAgaWYgKHF1ZXJ5KSB7XG4gICAgICAgICAgICAvLyBTZWFyY2ggZmlsdGVyXG4gICAgICAgICAgICB2YXIgc2VhcmNoID0gZnVuY3Rpb24oaXRlbSwgcXVlcnksIGluZGV4KSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpdGVtLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICgoJycraXRlbVtpXSkudG9Mb3dlckNhc2UoKS5zZWFyY2gocXVlcnkpID49IDAgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICgnJytvYmoucmVjb3Jkc1tpbmRleF1baV0uaW5uZXJIVE1MKS50b0xvd2VyQ2FzZSgpLnNlYXJjaChxdWVyeSkgPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBSZXN1bHRcbiAgICAgICAgICAgIHZhciBhZGRUb1Jlc3VsdCA9IGZ1bmN0aW9uKGspIHtcbiAgICAgICAgICAgICAgICBpZiAob2JqLnJlc3VsdHMuaW5kZXhPZihrKSA9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICBvYmoucmVzdWx0cy5wdXNoKGspO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gRmlsdGVyXG4gICAgICAgICAgICB2YXIgZGF0YSA9IG9iai5vcHRpb25zLmRhdGEuZmlsdGVyKGZ1bmN0aW9uKHYsIGspIHtcbiAgICAgICAgICAgICAgICBpZiAoc2VhcmNoKHYsIHF1ZXJ5LCBrKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBNZXJnZWQgcm93cyBmb3VuZFxuICAgICAgICAgICAgICAgICAgICB2YXIgcm93cyA9IG9iai5pc1Jvd01lcmdlZChrKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJvd3MubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJvd3MubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcm93ID0gamV4Y2VsLmdldElkRnJvbUNvbHVtbk5hbWUocm93c1tpXSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBvYmoub3B0aW9ucy5tZXJnZUNlbGxzW3Jvd3NbaV1dWzFdOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkVG9SZXN1bHQocm93WzFdK2opO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5vcm1hbCByb3cgZm91bmRcbiAgICAgICAgICAgICAgICAgICAgICAgIGFkZFRvUmVzdWx0KGspO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG9iai5yZXN1bHRzID0gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciB0b3RhbCA9IDA7XG4gICAgICAgIHZhciBpbmRleCA9IDA7XG5cbiAgICAgICAgLy8gUGFnZSAxXG4gICAgICAgIGlmIChvYmoub3B0aW9ucy5sYXp5TG9hZGluZyA9PSB0cnVlKSB7XG4gICAgICAgICAgICB0b3RhbCA9IDEwMDtcbiAgICAgICAgfSBlbHNlIGlmIChvYmoub3B0aW9ucy5wYWdpbmF0aW9uID4gMCkge1xuICAgICAgICAgICAgdG90YWwgPSBvYmoub3B0aW9ucy5wYWdpbmF0aW9uO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKG9iai5yZXN1bHRzKSB7XG4gICAgICAgICAgICAgICAgdG90YWwgPSBvYmoucmVzdWx0cy5sZW5ndGg7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRvdGFsID0gb2JqLnJvd3MubGVuZ3RoO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gUmVzZXQgY3VycmVudCBub2Rlc1xuICAgICAgICB3aGlsZSAob2JqLnRib2R5LmZpcnN0Q2hpbGQpIHtcbiAgICAgICAgICAgIG9iai50Ym9keS5yZW1vdmVDaGlsZChvYmoudGJvZHkuZmlyc3RDaGlsZCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBIaWRlIGFsbCByZWNvcmRzIGZyb20gdGhlIHRhYmxlXG4gICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgb2JqLnJvd3MubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgIGlmICghIG9iai5yZXN1bHRzIHx8IG9iai5yZXN1bHRzLmluZGV4T2YoaikgPiAtMSkge1xuICAgICAgICAgICAgICAgIGlmIChpbmRleCA8IHRvdGFsKSB7XG4gICAgICAgICAgICAgICAgICAgIG9iai50Ym9keS5hcHBlbmRDaGlsZChvYmoucm93c1tqXSk7XG4gICAgICAgICAgICAgICAgICAgIGluZGV4Kys7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG9iai5yb3dzW2pdLnN0eWxlLmRpc3BsYXkgPSAnJztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgb2JqLnJvd3Nbal0uc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFVwZGF0ZSBwYWdpbmF0aW9uXG4gICAgICAgIGlmIChvYmoub3B0aW9ucy5wYWdpbmF0aW9uID4gMCkge1xuICAgICAgICAgICAgb2JqLnVwZGF0ZVBhZ2luYXRpb24oKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0b3RhbDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBXaGljaCBwYWdlIHRoZSBjZWxsIGlzXG4gICAgICovXG4gICAgb2JqLndoaWNoUGFnZSA9IGZ1bmN0aW9uKGNlbGwpIHtcbiAgICAgICAgLy8gU2VhcmNoXG4gICAgICAgIGlmIChvYmoub3B0aW9ucy5zZWFyY2ggPT0gdHJ1ZSAmJiBvYmoucmVzdWx0cykge1xuICAgICAgICAgICAgY2VsbCA9IG9iai5yZXN1bHRzLmluZGV4T2YoY2VsbCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gKE1hdGguY2VpbCgocGFyc2VJbnQoY2VsbCkgKyAxKSAvIHBhcnNlSW50KG9iai5vcHRpb25zLnBhZ2luYXRpb24pKSkgLSAxO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdvIHRvIHBhZ2VcbiAgICAgKi9cbiAgICBvYmoucGFnZSA9IGZ1bmN0aW9uKHBhZ2VOdW1iZXIpIHtcbiAgICAgICAgdmFyIG9sZFBhZ2UgPSBvYmoucGFnZU51bWJlcjtcclxuXG4gICAgICAgIC8vIFNlYXJjaFxuICAgICAgICBpZiAob2JqLm9wdGlvbnMuc2VhcmNoID09IHRydWUgJiYgb2JqLnJlc3VsdHMpIHtcbiAgICAgICAgICAgIHZhciByZXN1bHRzID0gb2JqLnJlc3VsdHM7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgcmVzdWx0cyA9IG9iai5yb3dzO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gUGVyIHBhZ2VcbiAgICAgICAgdmFyIHF1YW50aXR5UGVyUGFnZSA9IHBhcnNlSW50KG9iai5vcHRpb25zLnBhZ2luYXRpb24pO1xuXG4gICAgICAgIC8vIHBhZ2VOdW1iZXJcbiAgICAgICAgaWYgKHBhZ2VOdW1iZXIgPT0gbnVsbCB8fCBwYWdlTnVtYmVyID09IC0xKSB7XG4gICAgICAgICAgICAvLyBMYXN0IHBhZ2VcbiAgICAgICAgICAgIHBhZ2VOdW1iZXIgPSBNYXRoLmNlaWwocmVzdWx0cy5sZW5ndGggLyBxdWFudGl0eVBlclBhZ2UpOyBcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFBhZ2UgbnVtYmVyXG4gICAgICAgIG9iai5wYWdlTnVtYmVyID0gcGFnZU51bWJlcjtcblxuICAgICAgICB2YXIgc3RhcnRSb3cgPSAocGFnZU51bWJlciAqIHF1YW50aXR5UGVyUGFnZSk7XG4gICAgICAgIHZhciBmaW5hbFJvdyA9IChwYWdlTnVtYmVyICogcXVhbnRpdHlQZXJQYWdlKSArIHF1YW50aXR5UGVyUGFnZTtcbiAgICAgICAgaWYgKGZpbmFsUm93ID4gcmVzdWx0cy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGZpbmFsUm93ID0gcmVzdWx0cy5sZW5ndGg7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHN0YXJ0Um93IDwgMCkge1xuICAgICAgICAgICAgc3RhcnRSb3cgPSAwO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gUmVzZXQgY29udGFpbmVyXG4gICAgICAgIHdoaWxlIChvYmoudGJvZHkuZmlyc3RDaGlsZCkge1xuICAgICAgICAgICAgb2JqLnRib2R5LnJlbW92ZUNoaWxkKG9iai50Ym9keS5maXJzdENoaWxkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEFwcGVkaW5nIGl0ZW1zXG4gICAgICAgIGZvciAodmFyIGogPSBzdGFydFJvdzsgaiA8IGZpbmFsUm93OyBqKyspIHtcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5zZWFyY2ggPT0gdHJ1ZSAmJiBvYmoucmVzdWx0cykge1xuICAgICAgICAgICAgICAgIG9iai50Ym9keS5hcHBlbmRDaGlsZChvYmoucm93c1tyZXN1bHRzW2pdXSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG9iai50Ym9keS5hcHBlbmRDaGlsZChvYmoucm93c1tqXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAob2JqLm9wdGlvbnMucGFnaW5hdGlvbiA+IDApIHtcbiAgICAgICAgICAgIG9iai51cGRhdGVQYWdpbmF0aW9uKCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBVcGRhdGUgY29ybmVyIHBvc2l0aW9uXG4gICAgICAgIG9iai51cGRhdGVDb3JuZXJQb3NpdGlvbigpO1xuXHJcbiAgICAgICAgaWYgKHR5cGVvZihvYmoub3B0aW9ucy5vbmNoYW5nZXBhZ2UpID09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgb2JqLm9wdGlvbnMub25jaGFuZ2VwYWdlKGVsLCBwYWdlTnVtYmVyLCBvbGRQYWdlKTtcclxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVXBkYXRlIHRoZSBwYWdpbmF0aW9uXG4gICAgICovXG4gICAgb2JqLnVwZGF0ZVBhZ2luYXRpb24gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gUmVzZXQgY29udGFpbmVyXG4gICAgICAgIG9iai5wYWdpbmF0aW9uLmNoaWxkcmVuWzBdLmlubmVySFRNTCA9ICcnO1xuICAgICAgICBvYmoucGFnaW5hdGlvbi5jaGlsZHJlblsxXS5pbm5lckhUTUwgPSAnJztcblxuICAgICAgICAvLyBTdGFydCBwYWdpbmF0aW9uXG4gICAgICAgIGlmIChvYmoub3B0aW9ucy5wYWdpbmF0aW9uKSB7XG4gICAgICAgICAgICAvLyBTZWFyY2hhYmxlXG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuc2VhcmNoID09IHRydWUgJiYgb2JqLnJlc3VsdHMpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0cyA9IG9iai5yZXN1bHRzLmxlbmd0aDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIHJlc3VsdHMgPSBvYmoucm93cy5sZW5ndGg7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghIHJlc3VsdHMpIHtcbiAgICAgICAgICAgICAgICAvLyBObyByZWNvcmRzIGZvdW5kXG4gICAgICAgICAgICAgICAgb2JqLnBhZ2luYXRpb24uY2hpbGRyZW5bMF0uaW5uZXJIVE1MID0gb2JqLm9wdGlvbnMudGV4dC5ub1JlY29yZHNGb3VuZDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gUGFnaW5hdGlvbiBjb250YWluZXJcbiAgICAgICAgICAgICAgICB2YXIgcXVhbnR5T2ZQYWdlcyA9IE1hdGguY2VpbChyZXN1bHRzIC8gb2JqLm9wdGlvbnMucGFnaW5hdGlvbik7XG5cbiAgICAgICAgICAgICAgICBpZiAob2JqLnBhZ2VOdW1iZXIgPCA2KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzdGFydE51bWJlciA9IDE7XG4gICAgICAgICAgICAgICAgICAgIHZhciBmaW5hbE51bWJlciA9IHF1YW50eU9mUGFnZXMgPCAxMCA/IHF1YW50eU9mUGFnZXMgOiAxMDtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHF1YW50eU9mUGFnZXMgLSBvYmoucGFnZU51bWJlciA8IDUpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0YXJ0TnVtYmVyID0gcXVhbnR5T2ZQYWdlcyAtIDk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBmaW5hbE51bWJlciA9IHF1YW50eU9mUGFnZXM7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGFydE51bWJlciA8IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0TnVtYmVyID0gMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzdGFydE51bWJlciA9IG9iai5wYWdlTnVtYmVyIC0gNDtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZpbmFsTnVtYmVyID0gb2JqLnBhZ2VOdW1iZXIgKyA1O1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIEZpcnN0XG4gICAgICAgICAgICAgICAgaWYgKHN0YXJ0TnVtYmVyID4gMSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcGFnaW5hdGlvbkl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgICAgICAgICAgcGFnaW5hdGlvbkl0ZW0uY2xhc3NOYW1lID0gJ2pleGNlbF9wYWdlJztcbiAgICAgICAgICAgICAgICAgICAgcGFnaW5hdGlvbkl0ZW0uaW5uZXJIVE1MID0gJzwnO1xuICAgICAgICAgICAgICAgICAgICBwYWdpbmF0aW9uSXRlbS50aXRsZSA9IDE7XG4gICAgICAgICAgICAgICAgICAgIG9iai5wYWdpbmF0aW9uLmNoaWxkcmVuWzFdLmFwcGVuZENoaWxkKHBhZ2luYXRpb25JdGVtKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBHZXQgcGFnZSBsaW5rc1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSBzdGFydE51bWJlcjsgaSA8PSBmaW5hbE51bWJlcjsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwYWdpbmF0aW9uSXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgICAgICAgICBwYWdpbmF0aW9uSXRlbS5jbGFzc05hbWUgPSAnamV4Y2VsX3BhZ2UnO1xuICAgICAgICAgICAgICAgICAgICBwYWdpbmF0aW9uSXRlbS5pbm5lckhUTUwgPSBpO1xuICAgICAgICAgICAgICAgICAgICBvYmoucGFnaW5hdGlvbi5jaGlsZHJlblsxXS5hcHBlbmRDaGlsZChwYWdpbmF0aW9uSXRlbSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5wYWdlTnVtYmVyID09IChpLTEpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYWdpbmF0aW9uSXRlbS5jbGFzc0xpc3QuYWRkKCdqZXhjZWxfcGFnZV9zZWxlY3RlZCcpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gTGFzdFxuICAgICAgICAgICAgICAgIGlmIChmaW5hbE51bWJlciA8IHF1YW50eU9mUGFnZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBhZ2luYXRpb25JdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICAgICAgICAgIHBhZ2luYXRpb25JdGVtLmNsYXNzTmFtZSA9ICdqZXhjZWxfcGFnZSc7XG4gICAgICAgICAgICAgICAgICAgIHBhZ2luYXRpb25JdGVtLmlubmVySFRNTCA9ICc+JztcbiAgICAgICAgICAgICAgICAgICAgcGFnaW5hdGlvbkl0ZW0udGl0bGUgPSBxdWFudHlPZlBhZ2VzO1xuICAgICAgICAgICAgICAgICAgICBvYmoucGFnaW5hdGlvbi5jaGlsZHJlblsxXS5hcHBlbmRDaGlsZChwYWdpbmF0aW9uSXRlbSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gVGV4dFxuICAgICAgICAgICAgICAgIHZhciBmb3JtYXQgPSBmdW5jdGlvbihmb3JtYXQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZm9ybWF0LnJlcGxhY2UoL3soXFxkKyl9L2csIGZ1bmN0aW9uKG1hdGNoLCBudW1iZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHlwZW9mIGFyZ3NbbnVtYmVyXSAhPSAndW5kZWZpbmVkJ1xuICAgICAgICAgICAgICAgICAgICAgICAgPyBhcmdzW251bWJlcl1cbiAgICAgICAgICAgICAgICAgICAgICAgIDogbWF0Y2hcbiAgICAgICAgICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICBvYmoucGFnaW5hdGlvbi5jaGlsZHJlblswXS5pbm5lckhUTUwgPSBmb3JtYXQob2JqLm9wdGlvbnMudGV4dC5zaG93aW5nUGFnZSwgb2JqLnBhZ2VOdW1iZXIgKyAxLCBxdWFudHlPZlBhZ2VzKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRG93bmxvYWQgQ1NWIHRhYmxlXG4gICAgICogXG4gICAgICogQHJldHVybiBudWxsXG4gICAgICovXG4gICAgb2JqLmRvd25sb2FkID0gZnVuY3Rpb24oaW5jbHVkZUhlYWRlcnMpIHtcbiAgICAgICAgaWYgKG9iai5vcHRpb25zLmFsbG93RXhwb3J0ID09IGZhbHNlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFeHBvcnQgbm90IGFsbG93ZWQnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIERhdGFcbiAgICAgICAgICAgIHZhciBkYXRhID0gJyc7XG4gICAgICAgICAgICBpZiAoaW5jbHVkZUhlYWRlcnMgPT0gdHJ1ZSB8fCBvYmoub3B0aW9ucy5pbmNsdWRlSGVhZGVyc09uRG93bmxvYWQgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGRhdGEgKz0gb2JqLmdldEhlYWRlcnMoKTtcbiAgICAgICAgICAgICAgICBkYXRhICs9IFwiXFxyXFxuXCI7XG4gICAgICAgICAgICB9XG5cclxuICAgICAgICAgICAgLy8gR2V0IGRhdGFcbiAgICAgICAgICAgIGRhdGEgKz0gb2JqLmNvcHkoZmFsc2UsIG9iai5vcHRpb25zLmNzdkRlbGltaXRlciwgdHJ1ZSk7XHJcblxuICAgICAgICAgICAgLy8gRG93bmxvYWQgZWxlbWVudFxuICAgICAgICAgICAgdmFyIGJsb2IgPSBuZXcgQmxvYihbXCJcXHVGRUZGXCIrZGF0YV0sIHt0eXBlOiAndGV4dC9jc3Y7Y2hhcnNldD11dGYtODsnfSk7XG5cclxuICAgICAgICAgICAgLy8gSUUgQ29tcGF0aWJpbGl0eVxyXG4gICAgICAgICAgICBpZiAod2luZG93Lm5hdmlnYXRvciAmJiB3aW5kb3cubmF2aWdhdG9yLm1zU2F2ZU9yT3BlbkJsb2IpIHtcclxuICAgICAgICAgICAgICAgIHdpbmRvdy5uYXZpZ2F0b3IubXNTYXZlT3JPcGVuQmxvYihibG9iLCBvcHRpb25zLmNzdkZpbGVOYW1lICsgJy5jc3YnKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBEb3dubG9hZCBlbGVtZW50XG4gICAgICAgICAgICAgICAgdmFyIHBvbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcbiAgICAgICAgICAgICAgICB2YXIgdXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcbiAgICAgICAgICAgICAgICBwb20uaHJlZiA9IHVybDtcbiAgICAgICAgICAgICAgICBwb20uc2V0QXR0cmlidXRlKCdkb3dubG9hZCcsIG9iai5vcHRpb25zLmNzdkZpbGVOYW1lICsgJy5jc3YnKTtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHBvbSk7XG4gICAgICAgICAgICAgICAgcG9tLmNsaWNrKCk7XG4gICAgICAgICAgICAgICAgcG9tLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQocG9tKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEluaXRpYWxpemVzIGEgbmV3IGhpc3RvcnkgcmVjb3JkIGZvciB1bmRvL3JlZG9cbiAgICAgKiBcbiAgICAgKiBAcmV0dXJuIG51bGxcbiAgICAgKi9cbiAgICBvYmouc2V0SGlzdG9yeSA9IGZ1bmN0aW9uKGNoYW5nZXMpIHtcbiAgICAgICAgaWYgKG9iai5pZ25vcmVIaXN0b3J5ICE9IHRydWUpIHtcbiAgICAgICAgICAgIC8vIEluY3JlbWVudCBhbmQgZ2V0IHRoZSBjdXJyZW50IGhpc3RvcnkgaW5kZXhcbiAgICAgICAgICAgIHZhciBpbmRleCA9ICsrb2JqLmhpc3RvcnlJbmRleDtcblxuICAgICAgICAgICAgLy8gU2xpY2UgdGhlIGFycmF5IHRvIGRpc2NhcmQgdW5kb25lIGNoYW5nZXNcbiAgICAgICAgICAgIG9iai5oaXN0b3J5ID0gKG9iai5oaXN0b3J5ID0gb2JqLmhpc3Rvcnkuc2xpY2UoMCwgaW5kZXggKyAxKSk7XG5cbiAgICAgICAgICAgIC8vIEtlZXAgaGlzdG9yeVxuICAgICAgICAgICAgb2JqLmhpc3RvcnlbaW5kZXhdID0gY2hhbmdlcztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvcHkgbWV0aG9kXG4gICAgICogXG4gICAgICogQHBhcmFtIGJvb2wgaGlnaGxpZ2h0ZWQgLSBHZXQgb25seSBoaWdobGlnaHRlZCBjZWxsc1xuICAgICAqIEBwYXJhbSBkZWxpbWl0ZXIgLSBcXHQgZGVmYXVsdCB0byBrZWVwIGNvbXBhdGliaWxpdHkgd2l0aCBleGNlbFxuICAgICAqIEByZXR1cm4gc3RyaW5nIHZhbHVlXG4gICAgICovXG4gICAgb2JqLmNvcHkgPSBmdW5jdGlvbihoaWdobGlnaHRlZCwgZGVsaW1pdGVyLCByZXR1cm5EYXRhKSB7XG4gICAgICAgIGlmICghIGRlbGltaXRlcikge1xuICAgICAgICAgICAgZGVsaW1pdGVyID0gXCJcXHRcIjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENvbnRyb2xzXG4gICAgICAgIHZhciBjb2wgPSBbXTtcbiAgICAgICAgdmFyIGNvbExhYmVsID0gW107XG4gICAgICAgIHZhciByb3cgPSBbXTtcbiAgICAgICAgdmFyIHJvd0xhYmVsID0gW107XG4gICAgICAgIHZhciB4ID0gb2JqLm9wdGlvbnMuZGF0YVswXS5sZW5ndGhcbiAgICAgICAgdmFyIHkgPSBvYmoub3B0aW9ucy5kYXRhLmxlbmd0aFxuICAgICAgICB2YXIgdG1wID0gJyc7XG5cbiAgICAgICAgLy8gUmVzZXQgY29udGFpbmVyXG4gICAgICAgIG9iai5zdHlsZSA9IFtdO1xuXG4gICAgICAgIC8vIEdvIHRocm91Z2ggdGhlIGNvbHVtbnMgdG8gZ2V0IHRoZSBkYXRhXG4gICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgeTsgaisrKSB7XG4gICAgICAgICAgICBjb2wgPSBbXTtcbiAgICAgICAgICAgIGNvbExhYmVsID0gW107XG5cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgeDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgLy8gSWYgY2VsbCBpcyBoaWdobGlnaHRlZFxuICAgICAgICAgICAgICAgIGlmICghIGhpZ2hsaWdodGVkIHx8IG9iai5yZWNvcmRzW2pdW2ldLmNsYXNzTGlzdC5jb250YWlucygnaGlnaGxpZ2h0JykpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVmFsdWVzXG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IG9iai5vcHRpb25zLmRhdGFbal1baV07XG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5tYXRjaCAmJiAodmFsdWUubWF0Y2goLywvZykgfHwgdmFsdWUubWF0Y2goL1xcbi8pIHx8IHZhbHVlLm1hdGNoKC9cXFwiLykpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UobmV3IFJlZ0V4cCgnXCInLCAnZycpLCAnXCJcIicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSAnXCInICsgdmFsdWUgKyAnXCInO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNvbC5wdXNoKHZhbHVlKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBMYWJlbHNcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbaV0udHlwZSA9PSAnY2hlY2tib3gnIHx8IG9iai5vcHRpb25zLmNvbHVtbnNbaV0udHlwZSA9PSAncmFkaW8nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsYWJlbCA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbGFiZWwgPSBvYmoucmVjb3Jkc1tqXVtpXS5pbm5lckhUTUw7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobGFiZWwubWF0Y2ggJiYgKGxhYmVsLm1hdGNoKC8sL2cpIHx8IGxhYmVsLm1hdGNoKC9cXG4vKSB8fCBsYWJlbC5tYXRjaCgvXFxcIi8pKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNjYXBlIGRvdWJsZSBxdW90ZXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbCA9IGxhYmVsLnJlcGxhY2UobmV3IFJlZ0V4cCgnXCInLCAnZycpLCAnXCJcIicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsID0gJ1wiJyArIGxhYmVsICsgJ1wiJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNvbExhYmVsLnB1c2gobGFiZWwpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIEdldCBzdHlsZVxuICAgICAgICAgICAgICAgICAgICB0bXAgPSBvYmoucmVjb3Jkc1tqXVtpXS5nZXRBdHRyaWJ1dGUoJ3N0eWxlJyk7XG4gICAgICAgICAgICAgICAgICAgIG9iai5zdHlsZS5wdXNoKHRtcCA/IHRtcCA6ICcnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChjb2wubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgcm93LnB1c2goY29sLmpvaW4oZGVsaW1pdGVyKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY29sTGFiZWwubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgcm93TGFiZWwucHVzaChjb2xMYWJlbC5qb2luKGRlbGltaXRlcikpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gRmluYWwgc3RyaW5nXG4gICAgICAgIHZhciBzdHIgPSByb3cuam9pbihcIlxcclxcblwiKTtcbiAgICAgICAgdmFyIHN0ckxhYmVsID0gcm93TGFiZWwuam9pbihcIlxcclxcblwiKTtcblxuICAgICAgICAvLyBDcmVhdGUgYSBoaWRkZW4gdGV4dGFyZWEgdG8gY29weSB0aGUgdmFsdWVzXG4gICAgICAgIGlmICghIHJldHVybkRhdGEpIHtcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5jb3B5Q29tcGF0aWJpbGl0eSA9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgb2JqLnRleHRhcmVhLnZhbHVlID0gc3RyTGFiZWw7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG9iai50ZXh0YXJlYS52YWx1ZSA9IHN0cjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG9iai50ZXh0YXJlYS5zZWxlY3QoKTtcbiAgICAgICAgICAgIGRvY3VtZW50LmV4ZWNDb21tYW5kKFwiY29weVwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEtlZXAgZGF0YVxuICAgICAgICBpZiAob2JqLm9wdGlvbnMuY29weUNvbXBhdGliaWxpdHkgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgb2JqLmRhdGEgPSBzdHJMYWJlbDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgb2JqLmRhdGEgPSBzdHI7XG4gICAgICAgIH1cbiAgICAgICAgLy8gS2VlcCBub24gdmlzaWJsZSBpbmZvcm1hdGlvblxuICAgICAgICBvYmouaGFzaFN0cmluZyA9IG9iai5oYXNoKG9iai5kYXRhKTtcblxuICAgICAgICByZXR1cm4gb2JqLmRhdGE7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogakV4Y2VsIHBhc3RlIG1ldGhvZFxuICAgICAqIFxuICAgICAqIEBwYXJhbSBpbnRlZ2VyIHJvdyBudW1iZXJcbiAgICAgKiBAcmV0dXJuIHN0cmluZyB2YWx1ZVxuICAgICAqL1xuICAgIG9iai5wYXN0ZSA9IGZ1bmN0aW9uKHgsIHksIGRhdGEpIHtcbiAgICAgICAgLy8gUGFzdGUgZmlsdGVyXG4gICAgICAgIGlmICh0eXBlb2Yob2JqLm9wdGlvbnMub25iZWZvcmVwYXN0ZSkgPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgdmFyIGRhdGEgPSBvYmoub3B0aW9ucy5vbmJlZm9yZXBhc3RlKGVsLCBkYXRhKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENvbnRyb2xzXG4gICAgICAgIHZhciBoYXNoID0gb2JqLmhhc2goZGF0YSk7XG4gICAgICAgIHZhciBzdHlsZSA9IChoYXNoID09IG9iai5oYXNoU3RyaW5nKSA/IG9iai5zdHlsZSA6IG51bGw7XG5cbiAgICAgICAgLy8gRGVwZW5kaW5nIG9uIHRoZSBiZWhhdmlvclxuICAgICAgICBpZiAob2JqLm9wdGlvbnMuY29weUNvbXBhdGliaWxpdHkgPT0gdHJ1ZSAmJiBoYXNoID09IG9iai5oYXNoU3RyaW5nKSB7XG4gICAgICAgICAgICB2YXIgZGF0YSA9IG9iai5kYXRhO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gU3BsaXQgbmV3IGxpbmVcbiAgICAgICAgdmFyIGRhdGEgPSBvYmoucGFyc2VDU1YoZGF0YSwgXCJcXHRcIik7XG5cbiAgICAgICAgaWYgKHggIT0gbnVsbCAmJiB5ICE9IG51bGwgJiYgZGF0YSkge1xuICAgICAgICAgICAgLy8gUmVjb3Jkc1xuICAgICAgICAgICAgdmFyIGkgPSAwO1xuICAgICAgICAgICAgdmFyIGogPSAwO1xuICAgICAgICAgICAgdmFyIHJlY29yZHMgPSBbXTtcbiAgICAgICAgICAgIHZhciBuZXdTdHlsZSA9IHt9O1xuICAgICAgICAgICAgdmFyIG9sZFN0eWxlID0ge307XG4gICAgICAgICAgICB2YXIgc3R5bGVJbmRleCA9IDA7XG5cbiAgICAgICAgICAgIC8vIEluZGV4XG4gICAgICAgICAgICB2YXIgY29sSW5kZXggPSBwYXJzZUludCh4KTtcbiAgICAgICAgICAgIHZhciByb3dJbmRleCA9IHBhcnNlSW50KHkpO1xuICAgICAgICAgICAgdmFyIHJvdyA9IG51bGw7XG5cbiAgICAgICAgICAgIC8vIEdvIHRocm91Z2ggdGhlIGNvbHVtbnMgdG8gZ2V0IHRoZSBkYXRhXG4gICAgICAgICAgICB3aGlsZSAocm93ID0gZGF0YVtqXSkge1xuICAgICAgICAgICAgICAgIGkgPSAwO1xuICAgICAgICAgICAgICAgIGNvbEluZGV4ID0gcGFyc2VJbnQoeCk7XG5cbiAgICAgICAgICAgICAgICB3aGlsZSAocm93W2ldICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIGFuZCBrZWVwIGhpc3RvcnlcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlY29yZCA9IG9iai51cGRhdGVDZWxsKGNvbEluZGV4LCByb3dJbmRleCwgcm93W2ldKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gS2VlcCBoaXN0b3J5XG4gICAgICAgICAgICAgICAgICAgIHJlY29yZHMucHVzaChyZWNvcmQpO1xuICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgYWxsIGZvcm11bGFzIGluIHRoZSBjaGFpblxuICAgICAgICAgICAgICAgICAgICBvYmoudXBkYXRlRm9ybXVsYUNoYWluKGNvbEluZGV4LCByb3dJbmRleCwgcmVjb3Jkcyk7XG4gICAgICAgICAgICAgICAgICAgIC8vIFN0eWxlXG4gICAgICAgICAgICAgICAgICAgIGlmIChzdHlsZSAmJiBzdHlsZVtzdHlsZUluZGV4XSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbHVtbk5hbWUgPSBqZXhjZWwuZ2V0Q29sdW1uTmFtZUZyb21JZChbY29sSW5kZXgsIHJvd0luZGV4XSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdTdHlsZVtjb2x1bW5OYW1lXSA9IHN0eWxlW3N0eWxlSW5kZXhdO1xuICAgICAgICAgICAgICAgICAgICAgICAgb2xkU3R5bGVbY29sdW1uTmFtZV0gPSBvYmouZ2V0U3R5bGUoY29sdW1uTmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVjb3Jkc1tyb3dJbmRleF1bY29sSW5kZXhdLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCBzdHlsZVtzdHlsZUluZGV4XSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdHlsZUluZGV4KytcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpKys7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyb3dbaV0gIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbEluZGV4ID49IG9iai5oZWFkZXJzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouaW5zZXJ0Q29sdW1uKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xJbmRleCA9IG9iai5yaWdodC5nZXQoY29sSW5kZXgsIHJvd0luZGV4KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGorKztcbiAgICAgICAgICAgICAgICBpZiAoZGF0YVtqXSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAocm93SW5kZXggPj0gb2JqLnJvd3MubGVuZ3RoLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5pbnNlcnRSb3coKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByb3dJbmRleCA9IG9iai5kb3duLmdldCh4LCByb3dJbmRleCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBTZWxlY3QgdGhlIG5ldyBjZWxsc1xuICAgICAgICAgICAgb2JqLnVwZGF0ZVNlbGVjdGlvbkZyb21Db29yZHMoeCwgeSwgY29sSW5kZXgsIHJvd0luZGV4KTtcblxuICAgICAgICAgICAgLy8gVXBkYXRlIGhpc3RvcnlcbiAgICAgICAgICAgIG9iai5zZXRIaXN0b3J5KHtcbiAgICAgICAgICAgICAgICBhY3Rpb246J3NldFZhbHVlJyxcbiAgICAgICAgICAgICAgICByZWNvcmRzOnJlY29yZHMsXG4gICAgICAgICAgICAgICAgc2VsZWN0aW9uOm9iai5zZWxlY3RlZENlbGwsXG4gICAgICAgICAgICAgICAgbmV3U3R5bGU6bmV3U3R5bGUsXG4gICAgICAgICAgICAgICAgb2xkU3R5bGU6b2xkU3R5bGUsXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gVXBkYXRlIHRhYmxlXG4gICAgICAgICAgICBvYmoudXBkYXRlVGFibGUoKTtcblxuICAgICAgICAgICAgLy8gUGFzdGUgZXZlbnRcbiAgICAgICAgICAgIGlmICh0eXBlb2Yob2JqLm9wdGlvbnMub25wYXN0ZSkgPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLm9ucGFzdGUoZWwsIHJlY29yZHMpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBPbiBhZnRlciBjaGFuZ2VzXG4gICAgICAgICAgICBvYmoub25hZnRlcmNoYW5nZXMoZWwsIHJlY29yZHMpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUHJvY2VzcyByb3dcbiAgICAgKi9cbiAgICBvYmouaGlzdG9yeVByb2Nlc3NSb3cgPSBmdW5jdGlvbih0eXBlLCBoaXN0b3J5UmVjb3JkKSB7XG4gICAgICAgIHZhciByb3dJbmRleCA9ICghIGhpc3RvcnlSZWNvcmQuaW5zZXJ0QmVmb3JlKSA/IGhpc3RvcnlSZWNvcmQucm93TnVtYmVyICsgMSA6IGhpc3RvcnlSZWNvcmQucm93TnVtYmVyO1xuXG4gICAgICAgIGlmIChvYmoub3B0aW9ucy5zZWFyY2ggPT0gdHJ1ZSkge1xuICAgICAgICAgICAgaWYgKG9iai5yZXN1bHRzICYmIG9iai5yZXN1bHRzLmxlbmd0aCAhPSBvYmoucm93cy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBvYmoucmVzZXRTZWFyY2goKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFJlbW92ZSByb3dcbiAgICAgICAgaWYgKHR5cGUgPT0gMSkge1xuICAgICAgICAgICAgdmFyIG51bU9mUm93cyA9IGhpc3RvcnlSZWNvcmQubnVtT2ZSb3dzO1xuICAgICAgICAgICAgLy8gUmVtb3ZlIG5vZGVzXG4gICAgICAgICAgICBmb3IgKHZhciBqID0gcm93SW5kZXg7IGogPCAobnVtT2ZSb3dzICsgcm93SW5kZXgpOyBqKyspIHtcbiAgICAgICAgICAgICAgICBvYmoucm93c1tqXS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG9iai5yb3dzW2pdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIFJlbW92ZSByZWZlcmVuY2VzXG4gICAgICAgICAgICBvYmoucmVjb3Jkcy5zcGxpY2Uocm93SW5kZXgsIG51bU9mUm93cyk7XG4gICAgICAgICAgICBvYmoub3B0aW9ucy5kYXRhLnNwbGljZShyb3dJbmRleCwgbnVtT2ZSb3dzKTtcbiAgICAgICAgICAgIG9iai5yb3dzLnNwbGljZShyb3dJbmRleCwgbnVtT2ZSb3dzKTtcblxuICAgICAgICAgICAgb2JqLmNvbmRpdGlvbmFsU2VsZWN0aW9uVXBkYXRlKDEsIHJvd0luZGV4LCAobnVtT2ZSb3dzICsgcm93SW5kZXgpIC0gMSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBJbnNlcnQgZGF0YVxuICAgICAgICAgICAgb2JqLnJlY29yZHMgPSBqZXhjZWwuaW5qZWN0QXJyYXkob2JqLnJlY29yZHMsIHJvd0luZGV4LCBoaXN0b3J5UmVjb3JkLnJvd1JlY29yZHMpO1xuICAgICAgICAgICAgb2JqLm9wdGlvbnMuZGF0YSA9IGpleGNlbC5pbmplY3RBcnJheShvYmoub3B0aW9ucy5kYXRhLCByb3dJbmRleCwgaGlzdG9yeVJlY29yZC5yb3dEYXRhKTtcbiAgICAgICAgICAgIG9iai5yb3dzID0gamV4Y2VsLmluamVjdEFycmF5KG9iai5yb3dzLCByb3dJbmRleCwgaGlzdG9yeVJlY29yZC5yb3dOb2RlKTtcbiAgICAgICAgICAgIC8vIEluc2VydCBub2Rlc1xuICAgICAgICAgICAgdmFyIGluZGV4ID0gMFxuICAgICAgICAgICAgZm9yICh2YXIgaiA9IHJvd0luZGV4OyBqIDwgKGhpc3RvcnlSZWNvcmQubnVtT2ZSb3dzICsgcm93SW5kZXgpOyBqKyspIHtcbiAgICAgICAgICAgICAgICBvYmoudGJvZHkuaW5zZXJ0QmVmb3JlKGhpc3RvcnlSZWNvcmQucm93Tm9kZVtpbmRleF0sIG9iai50Ym9keS5jaGlsZHJlbltqXSk7XG4gICAgICAgICAgICAgICAgaW5kZXgrKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFJlc3BlY3QgcGFnaW5hdGlvblxuICAgICAgICBpZiAob2JqLm9wdGlvbnMucGFnaW5hdGlvbiA+IDApIHtcbiAgICAgICAgICAgIG9iai5wYWdlKG9iai5wYWdlTnVtYmVyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIG9iai51cGRhdGVUYWJsZVJlZmVyZW5jZXMoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBQcm9jZXNzIGNvbHVtblxuICAgICAqL1xuICAgIG9iai5oaXN0b3J5UHJvY2Vzc0NvbHVtbiA9IGZ1bmN0aW9uKHR5cGUsIGhpc3RvcnlSZWNvcmQpIHtcbiAgICAgICAgdmFyIGNvbHVtbkluZGV4ID0gKCEgaGlzdG9yeVJlY29yZC5pbnNlcnRCZWZvcmUpID8gaGlzdG9yeVJlY29yZC5jb2x1bW5OdW1iZXIgKyAxIDogaGlzdG9yeVJlY29yZC5jb2x1bW5OdW1iZXI7XG5cbiAgICAgICAgLy8gUmVtb3ZlIGNvbHVtblxuICAgICAgICBpZiAodHlwZSA9PSAxKSB7XG4gICAgICAgICAgICB2YXIgbnVtT2ZDb2x1bW5zID0gaGlzdG9yeVJlY29yZC5udW1PZkNvbHVtbnM7XG5cbiAgICAgICAgICAgIG9iai5vcHRpb25zLmNvbHVtbnMuc3BsaWNlKGNvbHVtbkluZGV4LCBudW1PZkNvbHVtbnMpO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IGNvbHVtbkluZGV4OyBpIDwgKG51bU9mQ29sdW1ucyArIGNvbHVtbkluZGV4KTsgaSsrKSB7XG4gICAgICAgICAgICAgICAgb2JqLmhlYWRlcnNbaV0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChvYmouaGVhZGVyc1tpXSk7XG4gICAgICAgICAgICAgICAgb2JqLmNvbGdyb3VwW2ldLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQob2JqLmNvbGdyb3VwW2ldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG9iai5oZWFkZXJzLnNwbGljZShjb2x1bW5JbmRleCwgbnVtT2ZDb2x1bW5zKTtcbiAgICAgICAgICAgIG9iai5jb2xncm91cC5zcGxpY2UoY29sdW1uSW5kZXgsIG51bU9mQ29sdW1ucyk7XG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGhpc3RvcnlSZWNvcmQuZGF0YS5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSBjb2x1bW5JbmRleDsgaSA8IChudW1PZkNvbHVtbnMgKyBjb2x1bW5JbmRleCk7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBvYmoucmVjb3Jkc1tqXVtpXS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG9iai5yZWNvcmRzW2pdW2ldKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgb2JqLnJlY29yZHNbal0uc3BsaWNlKGNvbHVtbkluZGV4LCBudW1PZkNvbHVtbnMpO1xuICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmRhdGFbal0uc3BsaWNlKGNvbHVtbkluZGV4LCBudW1PZkNvbHVtbnMpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBvYmouY29uZGl0aW9uYWxTZWxlY3Rpb25VcGRhdGUoMCwgY29sdW1uSW5kZXgsIChudW1PZkNvbHVtbnMgKyBjb2x1bW5JbmRleCkgLSAxKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIEluc2VydCBkYXRhXG4gICAgICAgICAgICBvYmoub3B0aW9ucy5jb2x1bW5zID0gamV4Y2VsLmluamVjdEFycmF5KG9iai5vcHRpb25zLmNvbHVtbnMsIGNvbHVtbkluZGV4LCBoaXN0b3J5UmVjb3JkLmNvbHVtbnMpO1xuICAgICAgICAgICAgb2JqLmhlYWRlcnMgPSBqZXhjZWwuaW5qZWN0QXJyYXkob2JqLmhlYWRlcnMsIGNvbHVtbkluZGV4LCBoaXN0b3J5UmVjb3JkLmhlYWRlcnMpO1xuICAgICAgICAgICAgb2JqLmNvbGdyb3VwID0gamV4Y2VsLmluamVjdEFycmF5KG9iai5jb2xncm91cCwgY29sdW1uSW5kZXgsIGhpc3RvcnlSZWNvcmQuY29sZ3JvdXApO1xuXG4gICAgICAgICAgICB2YXIgaW5kZXggPSAwXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gY29sdW1uSW5kZXg7IGkgPCAoaGlzdG9yeVJlY29yZC5udW1PZkNvbHVtbnMgKyBjb2x1bW5JbmRleCk7IGkrKykge1xuICAgICAgICAgICAgICAgIG9iai5oZWFkZXJDb250YWluZXIuaW5zZXJ0QmVmb3JlKGhpc3RvcnlSZWNvcmQuaGVhZGVyc1tpbmRleF0sIG9iai5oZWFkZXJDb250YWluZXIuY2hpbGRyZW5baSsxXSk7XG4gICAgICAgICAgICAgICAgb2JqLmNvbGdyb3VwQ29udGFpbmVyLmluc2VydEJlZm9yZShoaXN0b3J5UmVjb3JkLmNvbGdyb3VwW2luZGV4XSwgb2JqLmNvbGdyb3VwQ29udGFpbmVyLmNoaWxkcmVuW2krMV0pO1xuICAgICAgICAgICAgICAgIGluZGV4Kys7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgaGlzdG9yeVJlY29yZC5kYXRhLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMuZGF0YVtqXSA9IGpleGNlbC5pbmplY3RBcnJheShvYmoub3B0aW9ucy5kYXRhW2pdLCBjb2x1bW5JbmRleCwgaGlzdG9yeVJlY29yZC5kYXRhW2pdKTtcbiAgICAgICAgICAgICAgICBvYmoucmVjb3Jkc1tqXSA9IGpleGNlbC5pbmplY3RBcnJheShvYmoucmVjb3Jkc1tqXSwgY29sdW1uSW5kZXgsIGhpc3RvcnlSZWNvcmQucmVjb3Jkc1tqXSk7XG4gICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gMFxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSBjb2x1bW5JbmRleDsgaSA8IChoaXN0b3J5UmVjb3JkLm51bU9mQ29sdW1ucyArIGNvbHVtbkluZGV4KTsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIG9iai5yb3dzW2pdLmluc2VydEJlZm9yZShoaXN0b3J5UmVjb3JkLnJlY29yZHNbal1baW5kZXhdLCBvYmoucm93c1tqXS5jaGlsZHJlbltpKzFdKTtcbiAgICAgICAgICAgICAgICAgICAgaW5kZXgrKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBBZGp1c3QgbmVzdGVkIGhlYWRlcnNcbiAgICAgICAgaWYgKG9iai5vcHRpb25zLm5lc3RlZEhlYWRlcnMgJiYgb2JqLm9wdGlvbnMubmVzdGVkSGVhZGVycy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAvLyBGbGV4aWJsZSB3YXkgdG8gaGFuZGxlIG5lc3RlZGhlYWRlcnNcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5uZXN0ZWRIZWFkZXJzWzBdICYmIG9iai5vcHRpb25zLm5lc3RlZEhlYWRlcnNbMF1bMF0pIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG9iai5vcHRpb25zLm5lc3RlZEhlYWRlcnMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUgPT0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbHNwYW4gPSBwYXJzZUludChvYmoub3B0aW9ucy5uZXN0ZWRIZWFkZXJzW2pdW29iai5vcHRpb25zLm5lc3RlZEhlYWRlcnNbal0ubGVuZ3RoLTFdLmNvbHNwYW4pIC0gaGlzdG9yeVJlY29yZC5udW1PZkNvbHVtbnM7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29sc3BhbiA9IHBhcnNlSW50KG9iai5vcHRpb25zLm5lc3RlZEhlYWRlcnNbal1bb2JqLm9wdGlvbnMubmVzdGVkSGVhZGVyc1tqXS5sZW5ndGgtMV0uY29sc3BhbikgKyBoaXN0b3J5UmVjb3JkLm51bU9mQ29sdW1ucztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5uZXN0ZWRIZWFkZXJzW2pdW29iai5vcHRpb25zLm5lc3RlZEhlYWRlcnNbal0ubGVuZ3RoLTFdLmNvbHNwYW4gPSBjb2xzcGFuO1xuICAgICAgICAgICAgICAgICAgICBvYmoudGhlYWQuY2hpbGRyZW5bal0uY2hpbGRyZW5bb2JqLnRoZWFkLmNoaWxkcmVuW2pdLmNoaWxkcmVuLmxlbmd0aC0xXS5zZXRBdHRyaWJ1dGUoJ2NvbHNwYW4nLCBjb2xzcGFuKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlID09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbHNwYW4gPSBwYXJzZUludChvYmoub3B0aW9ucy5uZXN0ZWRIZWFkZXJzWzBdLmNvbHNwYW4pIC0gaGlzdG9yeVJlY29yZC5udW1PZkNvbHVtbnM7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbHNwYW4gPSBwYXJzZUludChvYmoub3B0aW9ucy5uZXN0ZWRIZWFkZXJzWzBdLmNvbHNwYW4pICsgaGlzdG9yeVJlY29yZC5udW1PZkNvbHVtbnM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLm5lc3RlZEhlYWRlcnNbMF0uY29sc3BhbiA9IGNvbHNwYW47XG4gICAgICAgICAgICAgICAgb2JqLnRoZWFkLmNoaWxkcmVuWzBdLmNoaWxkcmVuW29iai50aGVhZC5jaGlsZHJlblswXS5jaGlsZHJlbi5sZW5ndGgtMV0uc2V0QXR0cmlidXRlKCdjb2xzcGFuJywgY29sc3Bhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBvYmoudXBkYXRlVGFibGVSZWZlcmVuY2VzKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVW5kbyBsYXN0IGFjdGlvblxuICAgICAqL1xuICAgIG9iai51bmRvID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIElnbm9yZSBldmVudHMgYW5kIGhpc3RvcnlcbiAgICAgICAgdmFyIGlnbm9yZUV2ZW50cyA9IG9iai5pZ25vcmVFdmVudHMgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgIHZhciBpZ25vcmVIaXN0b3J5ID0gb2JqLmlnbm9yZUhpc3RvcnkgPyB0cnVlIDogZmFsc2U7XG5cbiAgICAgICAgb2JqLmlnbm9yZUV2ZW50cyA9IHRydWU7XG4gICAgICAgIG9iai5pZ25vcmVIaXN0b3J5ID0gdHJ1ZTtcblxuICAgICAgICAvLyBSZWNvcmRzXG4gICAgICAgIHZhciByZWNvcmRzID0gW107XG5cbiAgICAgICAgLy8gVXBkYXRlIGNlbGxzXG4gICAgICAgIGlmIChvYmouaGlzdG9yeUluZGV4ID49IDApIHtcbiAgICAgICAgICAgIC8vIEhpc3RvcnlcbiAgICAgICAgICAgIHZhciBoaXN0b3J5UmVjb3JkID0gb2JqLmhpc3Rvcnlbb2JqLmhpc3RvcnlJbmRleC0tXTtcblxuICAgICAgICAgICAgaWYgKGhpc3RvcnlSZWNvcmQuYWN0aW9uID09ICdpbnNlcnRSb3cnKSB7XG4gICAgICAgICAgICAgICAgb2JqLmhpc3RvcnlQcm9jZXNzUm93KDEsIGhpc3RvcnlSZWNvcmQpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChoaXN0b3J5UmVjb3JkLmFjdGlvbiA9PSAnZGVsZXRlUm93Jykge1xuICAgICAgICAgICAgICAgIG9iai5oaXN0b3J5UHJvY2Vzc1JvdygwLCBoaXN0b3J5UmVjb3JkKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaGlzdG9yeVJlY29yZC5hY3Rpb24gPT0gJ2luc2VydENvbHVtbicpIHtcbiAgICAgICAgICAgICAgICBvYmouaGlzdG9yeVByb2Nlc3NDb2x1bW4oMSwgaGlzdG9yeVJlY29yZCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGhpc3RvcnlSZWNvcmQuYWN0aW9uID09ICdkZWxldGVDb2x1bW4nKSB7XG4gICAgICAgICAgICAgICAgb2JqLmhpc3RvcnlQcm9jZXNzQ29sdW1uKDAsIGhpc3RvcnlSZWNvcmQpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChoaXN0b3J5UmVjb3JkLmFjdGlvbiA9PSAnbW92ZVJvdycpIHtcbiAgICAgICAgICAgICAgICBvYmoubW92ZVJvdyhoaXN0b3J5UmVjb3JkLm5ld1ZhbHVlLCBoaXN0b3J5UmVjb3JkLm9sZFZhbHVlKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaGlzdG9yeVJlY29yZC5hY3Rpb24gPT0gJ21vdmVDb2x1bW4nKSB7XG4gICAgICAgICAgICAgICAgb2JqLm1vdmVDb2x1bW4oaGlzdG9yeVJlY29yZC5uZXdWYWx1ZSwgaGlzdG9yeVJlY29yZC5vbGRWYWx1ZSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGhpc3RvcnlSZWNvcmQuYWN0aW9uID09ICdzZXRNZXJnZScpIHtcbiAgICAgICAgICAgICAgICBvYmoucmVtb3ZlTWVyZ2UoaGlzdG9yeVJlY29yZC5jb2x1bW4sIGhpc3RvcnlSZWNvcmQuZGF0YSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGhpc3RvcnlSZWNvcmQuYWN0aW9uID09ICdzZXRTdHlsZScpIHtcbiAgICAgICAgICAgICAgICBvYmouc2V0U3R5bGUoaGlzdG9yeVJlY29yZC5vbGRWYWx1ZSwgbnVsbCwgbnVsbCwgMSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGhpc3RvcnlSZWNvcmQuYWN0aW9uID09ICdzZXRXaWR0aCcpIHtcbiAgICAgICAgICAgICAgICBvYmouc2V0V2lkdGgoaGlzdG9yeVJlY29yZC5jb2x1bW4sIGhpc3RvcnlSZWNvcmQub2xkVmFsdWUpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChoaXN0b3J5UmVjb3JkLmFjdGlvbiA9PSAnc2V0SGVpZ2h0Jykge1xuICAgICAgICAgICAgICAgIG9iai5zZXRIZWlnaHQoaGlzdG9yeVJlY29yZC5yb3csIGhpc3RvcnlSZWNvcmQub2xkVmFsdWUpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChoaXN0b3J5UmVjb3JkLmFjdGlvbiA9PSAnc2V0SGVhZGVyJykge1xuICAgICAgICAgICAgICAgIG9iai5zZXRIZWFkZXIoaGlzdG9yeVJlY29yZC5jb2x1bW4sIGhpc3RvcnlSZWNvcmQub2xkVmFsdWUpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChoaXN0b3J5UmVjb3JkLmFjdGlvbiA9PSAnc2V0Q29tbWVudHMnKSB7XG4gICAgICAgICAgICAgICAgb2JqLnNldENvbW1lbnRzKGhpc3RvcnlSZWNvcmQuY29sdW1uLCBoaXN0b3J5UmVjb3JkLm9sZFZhbHVlWzBdLCBoaXN0b3J5UmVjb3JkLm9sZFZhbHVlWzFdKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaGlzdG9yeVJlY29yZC5hY3Rpb24gPT0gJ29yZGVyQnknKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJvd3MgPSBbXTtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGhpc3RvcnlSZWNvcmQucm93cy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICByb3dzW2hpc3RvcnlSZWNvcmQucm93c1tqXV0gPSBqO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBvYmoudXBkYXRlT3JkZXJBcnJvdyhoaXN0b3J5UmVjb3JkLmNvbHVtbiwgaGlzdG9yeVJlY29yZC5vcmRlciA/IDAgOiAxKTtcbiAgICAgICAgICAgICAgICBvYmoudXBkYXRlT3JkZXIocm93cyk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGhpc3RvcnlSZWNvcmQuYWN0aW9uID09ICdzZXRWYWx1ZScpIHtcbiAgICAgICAgICAgICAgICAvLyBSZWRvIGZvciBjaGFuZ2VzIGluIGNlbGxzXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBoaXN0b3J5UmVjb3JkLnJlY29yZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgb2JqLnVwZGF0ZUNlbGwoaGlzdG9yeVJlY29yZC5yZWNvcmRzW2ldLmNvbCwgaGlzdG9yeVJlY29yZC5yZWNvcmRzW2ldLnJvdywgaGlzdG9yeVJlY29yZC5yZWNvcmRzW2ldLm9sZFZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgb2JqLnVwZGF0ZUZvcm11bGFDaGFpbihoaXN0b3J5UmVjb3JkLnJlY29yZHNbaV0uY29sLCBoaXN0b3J5UmVjb3JkLnJlY29yZHNbaV0ucm93LCByZWNvcmRzKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGhpc3RvcnlSZWNvcmQub2xkU3R5bGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5yZXNldFN0eWxlKGhpc3RvcnlSZWNvcmQub2xkU3R5bGUsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBzZWxlY3Rpb25cbiAgICAgICAgICAgICAgICBpZiAoISBoaXN0b3J5UmVjb3JkLnNlbGVjdGlvbikge1xuICAgICAgICAgICAgICAgICAgICBoaXN0b3J5UmVjb3JkLnNlbGVjdGlvbiA9IFtoaXN0b3J5UmVjb3JkLnJlY29yZHNbMF0uY29sLCBoaXN0b3J5UmVjb3JkLnJlY29yZHNbMF0ucm93XTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgb2JqLnVwZGF0ZVNlbGVjdGlvbkZyb21Db29yZHMoaGlzdG9yeVJlY29yZC5zZWxlY3Rpb25bMF0sIGhpc3RvcnlSZWNvcmQuc2VsZWN0aW9uWzFdLCBoaXN0b3J5UmVjb3JkLnNlbGVjdGlvblsyXSwgaGlzdG9yeVJlY29yZC5zZWxlY3Rpb25bM10pO1xuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSB0YWJsZVxuICAgICAgICAgICAgICAgIG9iai51cGRhdGVUYWJsZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIG9iai5pZ25vcmVFdmVudHMgPSBpZ25vcmVFdmVudHM7XG4gICAgICAgIG9iai5pZ25vcmVIaXN0b3J5ID0gaWdub3JlSGlzdG9yeTtcblxuICAgICAgICBpZiAodHlwZW9mKG9iai5vcHRpb25zLm9udW5kbykgPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgb2JqLm9wdGlvbnMub251bmRvKGVsLCBoaXN0b3J5UmVjb3JkKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlZG8gcHJldmlvdXNseSB1bmRvbmUgYWN0aW9uXG4gICAgICovXG4gICAgb2JqLnJlZG8gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gSWdub3JlIGV2ZW50cyBhbmQgaGlzdG9yeVxuICAgICAgICB2YXIgaWdub3JlRXZlbnRzID0gb2JqLmlnbm9yZUV2ZW50cyA/IHRydWUgOiBmYWxzZTtcbiAgICAgICAgdmFyIGlnbm9yZUhpc3RvcnkgPSBvYmouaWdub3JlSGlzdG9yeSA/IHRydWUgOiBmYWxzZTtcblxuICAgICAgICBvYmouaWdub3JlRXZlbnRzID0gdHJ1ZTtcbiAgICAgICAgb2JqLmlnbm9yZUhpc3RvcnkgPSB0cnVlO1xuXG4gICAgICAgIC8vIFJlY29yZHNcbiAgICAgICAgdmFyIHJlY29yZHMgPSBbXTtcblxuICAgICAgICAvLyBVcGRhdGUgY2VsbHNcbiAgICAgICAgaWYgKG9iai5oaXN0b3J5SW5kZXggPCBvYmouaGlzdG9yeS5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICAvLyBIaXN0b3J5XG4gICAgICAgICAgICB2YXIgaGlzdG9yeVJlY29yZCA9IG9iai5oaXN0b3J5Wysrb2JqLmhpc3RvcnlJbmRleF07XG5cbiAgICAgICAgICAgIGlmIChoaXN0b3J5UmVjb3JkLmFjdGlvbiA9PSAnaW5zZXJ0Um93Jykge1xuICAgICAgICAgICAgICAgIG9iai5oaXN0b3J5UHJvY2Vzc1JvdygwLCBoaXN0b3J5UmVjb3JkKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaGlzdG9yeVJlY29yZC5hY3Rpb24gPT0gJ2RlbGV0ZVJvdycpIHtcbiAgICAgICAgICAgICAgICBvYmouaGlzdG9yeVByb2Nlc3NSb3coMSwgaGlzdG9yeVJlY29yZCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGhpc3RvcnlSZWNvcmQuYWN0aW9uID09ICdpbnNlcnRDb2x1bW4nKSB7XG4gICAgICAgICAgICAgICAgb2JqLmhpc3RvcnlQcm9jZXNzQ29sdW1uKDAsIGhpc3RvcnlSZWNvcmQpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChoaXN0b3J5UmVjb3JkLmFjdGlvbiA9PSAnZGVsZXRlQ29sdW1uJykge1xuICAgICAgICAgICAgICAgIG9iai5oaXN0b3J5UHJvY2Vzc0NvbHVtbigxLCBoaXN0b3J5UmVjb3JkKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaGlzdG9yeVJlY29yZC5hY3Rpb24gPT0gJ21vdmVSb3cnKSB7XG4gICAgICAgICAgICAgICAgb2JqLm1vdmVSb3coaGlzdG9yeVJlY29yZC5vbGRWYWx1ZSwgaGlzdG9yeVJlY29yZC5uZXdWYWx1ZSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGhpc3RvcnlSZWNvcmQuYWN0aW9uID09ICdtb3ZlQ29sdW1uJykge1xuICAgICAgICAgICAgICAgIG9iai5tb3ZlQ29sdW1uKGhpc3RvcnlSZWNvcmQub2xkVmFsdWUsIGhpc3RvcnlSZWNvcmQubmV3VmFsdWUpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChoaXN0b3J5UmVjb3JkLmFjdGlvbiA9PSAnc2V0TWVyZ2UnKSB7XG4gICAgICAgICAgICAgICAgb2JqLnNldE1lcmdlKGhpc3RvcnlSZWNvcmQuY29sdW1uLCBoaXN0b3J5UmVjb3JkLmNvbHNwYW4sIGhpc3RvcnlSZWNvcmQucm93c3BhbiwgMSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGhpc3RvcnlSZWNvcmQuYWN0aW9uID09ICdzZXRTdHlsZScpIHtcbiAgICAgICAgICAgICAgICBvYmouc2V0U3R5bGUoaGlzdG9yeVJlY29yZC5uZXdWYWx1ZSwgbnVsbCwgbnVsbCwgMSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGhpc3RvcnlSZWNvcmQuYWN0aW9uID09ICdzZXRXaWR0aCcpIHtcbiAgICAgICAgICAgICAgICBvYmouc2V0V2lkdGgoaGlzdG9yeVJlY29yZC5jb2x1bW4sIGhpc3RvcnlSZWNvcmQubmV3VmFsdWUpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChoaXN0b3J5UmVjb3JkLmFjdGlvbiA9PSAnc2V0SGVpZ2h0Jykge1xuICAgICAgICAgICAgICAgIG9iai5zZXRIZWlnaHQoaGlzdG9yeVJlY29yZC5yb3csIGhpc3RvcnlSZWNvcmQubmV3VmFsdWUpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChoaXN0b3J5UmVjb3JkLmFjdGlvbiA9PSAnc2V0SGVhZGVyJykge1xuICAgICAgICAgICAgICAgIG9iai5zZXRIZWFkZXIoaGlzdG9yeVJlY29yZC5jb2x1bW4sIGhpc3RvcnlSZWNvcmQubmV3VmFsdWUpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChoaXN0b3J5UmVjb3JkLmFjdGlvbiA9PSAnc2V0Q29tbWVudHMnKSB7XG4gICAgICAgICAgICAgICAgb2JqLnNldENvbW1lbnRzKGhpc3RvcnlSZWNvcmQuY29sdW1uLCBoaXN0b3J5UmVjb3JkLm5ld1ZhbHVlWzBdLCBoaXN0b3J5UmVjb3JkLm5ld1ZhbHVlWzFdKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaGlzdG9yeVJlY29yZC5hY3Rpb24gPT0gJ29yZGVyQnknKSB7XG4gICAgICAgICAgICAgICAgb2JqLnVwZGF0ZU9yZGVyQXJyb3coaGlzdG9yeVJlY29yZC5jb2x1bW4sIGhpc3RvcnlSZWNvcmQub3JkZXIpO1xuICAgICAgICAgICAgICAgIG9iai51cGRhdGVPcmRlcihoaXN0b3J5UmVjb3JkLnJvd3MpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChoaXN0b3J5UmVjb3JkLmFjdGlvbiA9PSAnc2V0VmFsdWUnKSB7XG4gICAgICAgICAgICAgICAgLy8gUmVkbyBmb3IgY2hhbmdlcyBpbiBjZWxsc1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaGlzdG9yeVJlY29yZC5yZWNvcmRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIG9iai51cGRhdGVDZWxsKGhpc3RvcnlSZWNvcmQucmVjb3Jkc1tpXS5jb2wsIGhpc3RvcnlSZWNvcmQucmVjb3Jkc1tpXS5yb3csIGhpc3RvcnlSZWNvcmQucmVjb3Jkc1tpXS5uZXdWYWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIG9iai51cGRhdGVGb3JtdWxhQ2hhaW4oaGlzdG9yeVJlY29yZC5yZWNvcmRzW2ldLmNvbCwgaGlzdG9yeVJlY29yZC5yZWNvcmRzW2ldLnJvdywgcmVjb3Jkcyk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChoaXN0b3J5UmVjb3JkLm5ld1N0eWxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVzZXRTdHlsZShoaXN0b3J5UmVjb3JkLm5ld1N0eWxlLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBzZWxlY3Rpb25cbiAgICAgICAgICAgICAgICBpZiAoISBoaXN0b3J5UmVjb3JkLnNlbGVjdGlvbikge1xuICAgICAgICAgICAgICAgICAgICBoaXN0b3J5UmVjb3JkLnNlbGVjdGlvbiA9IFtoaXN0b3J5UmVjb3JkLnJlY29yZHNbMF0uY29sLCBoaXN0b3J5UmVjb3JkLnJlY29yZHNbMF0ucm93XTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgb2JqLnVwZGF0ZVNlbGVjdGlvbkZyb21Db29yZHMoaGlzdG9yeVJlY29yZC5zZWxlY3Rpb25bMF0sIGhpc3RvcnlSZWNvcmQuc2VsZWN0aW9uWzFdLCBoaXN0b3J5UmVjb3JkLnNlbGVjdGlvblsyXSwgaGlzdG9yeVJlY29yZC5zZWxlY3Rpb25bM10pO1xuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSB0YWJsZVxuICAgICAgICAgICAgICAgIG9iai51cGRhdGVUYWJsZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIG9iai5pZ25vcmVFdmVudHMgPSBpZ25vcmVFdmVudHM7XG4gICAgICAgIG9iai5pZ25vcmVIaXN0b3J5ID0gaWdub3JlSGlzdG9yeTtcblxuICAgICAgICBpZiAodHlwZW9mKG9iai5vcHRpb25zLm9ucmVkbykgPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgb2JqLm9wdGlvbnMub25yZWRvKGVsLCBoaXN0b3J5UmVjb3JkKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBkcm9wZG93biB2YWx1ZSBmcm9tIGtleVxuICAgICAqL1xuICAgIG9iai5nZXREcm9wRG93blZhbHVlID0gZnVuY3Rpb24oY29sdW1uLCBrZXkpIHtcbiAgICAgICAgdmFyIHZhbHVlID0gW107XG5cbiAgICAgICAgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbY29sdW1uXSAmJiBvYmoub3B0aW9ucy5jb2x1bW5zW2NvbHVtbl0uc291cmNlKSB7XG4gICAgICAgICAgICAvLyBDcmVhdGUgYXJyYXkgZnJvbSBzb3VyY2VcbiAgICAgICAgICAgIHZhciBjb21ibyA9IFtdO1xuICAgICAgICAgICAgdmFyIHNvdXJjZSA9IG9iai5vcHRpb25zLmNvbHVtbnNbY29sdW1uXS5zb3VyY2U7XG5cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc291cmNlLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZihzb3VyY2VbaV0pID09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbWJvW3NvdXJjZVtpXS5pZF0gPSBzb3VyY2VbaV0ubmFtZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb21ib1tzb3VyY2VbaV1dID0gc291cmNlW2ldO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gR2FyYW50ZSBzaW5nbGUgbXVsdGlwbGUgY29tcGF0aWJpbHlcbiAgICAgICAgICAgIHZhciBrZXlzID0gKCcnICsga2V5KS5zcGxpdCgnOycpXG5cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmIChjb21ib1trZXlzW2ldXSkge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZS5wdXNoKGNvbWJvW2tleXNbaV1dKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdJbnZhbGlkIGNvbHVtbicpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuICh2YWx1ZS5sZW5ndGggPiAwKSA/IHZhbHVlLmpvaW4oJzsgJykgOiAnJztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGcm9tIHN0YXJja292ZXJmbG93IGNvbnRyaWJ1dGlvbnNcbiAgICAgKi9cbiAgICBvYmoucGFyc2VDU1YgPSBmdW5jdGlvbihzdHIsIGRlbGltaXRlcikge1xuICAgICAgICAvLyBSZW1vdmUgbGFzdCBsaW5lIGJyZWFrXG4gICAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKC9cXHI/XFxuJHxcXHIkfFxcbiQvZywgXCJcIik7XG4gICAgICAgIC8vIExhc3QgY2FyYWN0ZXIgaXMgdGhlIGRlbGltaXRlclxuICAgICAgICBpZiAoc3RyLmNoYXJDb2RlQXQoc3RyLmxlbmd0aC0xKSA9PSA5KSB7XG4gICAgICAgICAgICBzdHIgKz0gXCJcXDBcIjtcbiAgICAgICAgfVxuICAgICAgICAvLyB1c2VyLXN1cHBsaWVkIGRlbGltZXRlciBvciBkZWZhdWx0IGNvbW1hXG4gICAgICAgIGRlbGltaXRlciA9IChkZWxpbWl0ZXIgfHwgXCIsXCIpO1xuXG4gICAgICAgIHZhciBhcnIgPSBbXTtcbiAgICAgICAgdmFyIHF1b3RlID0gZmFsc2U7ICAvLyB0cnVlIG1lYW5zIHdlJ3JlIGluc2lkZSBhIHF1b3RlZCBmaWVsZFxuICAgICAgICAvLyBpdGVyYXRlIG92ZXIgZWFjaCBjaGFyYWN0ZXIsIGtlZXAgdHJhY2sgb2YgY3VycmVudCByb3cgYW5kIGNvbHVtbiAob2YgdGhlIHJldHVybmVkIGFycmF5KVxuICAgICAgICBmb3IgKHZhciByb3cgPSAwLCBjb2wgPSAwLCBjID0gMDsgYyA8IHN0ci5sZW5ndGg7IGMrKykge1xuICAgICAgICAgICAgdmFyIGNjID0gc3RyW2NdLCBuYyA9IHN0cltjKzFdO1xuICAgICAgICAgICAgYXJyW3Jvd10gPSBhcnJbcm93XSB8fCBbXTtcbiAgICAgICAgICAgIGFycltyb3ddW2NvbF0gPSBhcnJbcm93XVtjb2xdIHx8ICcnO1xuXG4gICAgICAgICAgICAvLyBJZiB0aGUgY3VycmVudCBjaGFyYWN0ZXIgaXMgYSBxdW90YXRpb24gbWFyaywgYW5kIHdlJ3JlIGluc2lkZSBhIHF1b3RlZCBmaWVsZCwgYW5kIHRoZSBuZXh0IGNoYXJhY3RlciBpcyBhbHNvIGEgcXVvdGF0aW9uIG1hcmssIGFkZCBhIHF1b3RhdGlvbiBtYXJrIHRvIHRoZSBjdXJyZW50IGNvbHVtbiBhbmQgc2tpcCB0aGUgbmV4dCBjaGFyYWN0ZXJcbiAgICAgICAgICAgIGlmIChjYyA9PSAnXCInICYmIHF1b3RlICYmIG5jID09ICdcIicpIHsgYXJyW3Jvd11bY29sXSArPSBjYzsgKytjOyBjb250aW51ZTsgfSAgXG5cbiAgICAgICAgICAgIC8vIElmIGl0J3MganVzdCBvbmUgcXVvdGF0aW9uIG1hcmssIGJlZ2luL2VuZCBxdW90ZWQgZmllbGRcbiAgICAgICAgICAgIGlmIChjYyA9PSAnXCInKSB7IHF1b3RlID0gIXF1b3RlOyBjb250aW51ZTsgfVxuXG4gICAgICAgICAgICAvLyBJZiBpdCdzIGEgY29tbWEgYW5kIHdlJ3JlIG5vdCBpbiBhIHF1b3RlZCBmaWVsZCwgbW92ZSBvbiB0byB0aGUgbmV4dCBjb2x1bW5cbiAgICAgICAgICAgIGlmIChjYyA9PSBkZWxpbWl0ZXIgJiYgIXF1b3RlKSB7ICsrY29sOyBjb250aW51ZTsgfVxuXG4gICAgICAgICAgICAvLyBJZiBpdCdzIGEgbmV3bGluZSAoQ1JMRikgYW5kIHdlJ3JlIG5vdCBpbiBhIHF1b3RlZCBmaWVsZCwgc2tpcCB0aGUgbmV4dCBjaGFyYWN0ZXIgYW5kIG1vdmUgb24gdG8gdGhlIG5leHQgcm93IGFuZCBtb3ZlIHRvIGNvbHVtbiAwIG9mIHRoYXQgbmV3IHJvd1xuICAgICAgICAgICAgaWYgKGNjID09ICdcXHInICYmIG5jID09ICdcXG4nICYmICFxdW90ZSkgeyArK3JvdzsgY29sID0gMDsgKytjOyBjb250aW51ZTsgfVxuXG4gICAgICAgICAgICAvLyBJZiBpdCdzIGEgbmV3bGluZSAoTEYgb3IgQ1IpIGFuZCB3ZSdyZSBub3QgaW4gYSBxdW90ZWQgZmllbGQsIG1vdmUgb24gdG8gdGhlIG5leHQgcm93IGFuZCBtb3ZlIHRvIGNvbHVtbiAwIG9mIHRoYXQgbmV3IHJvd1xuICAgICAgICAgICAgaWYgKGNjID09ICdcXG4nICYmICFxdW90ZSkgeyArK3JvdzsgY29sID0gMDsgY29udGludWU7IH1cbiAgICAgICAgICAgIGlmIChjYyA9PSAnXFxyJyAmJiAhcXVvdGUpIHsgKytyb3c7IGNvbCA9IDA7IGNvbnRpbnVlOyB9XG5cbiAgICAgICAgICAgIC8vIE90aGVyd2lzZSwgYXBwZW5kIHRoZSBjdXJyZW50IGNoYXJhY3RlciB0byB0aGUgY3VycmVudCBjb2x1bW5cbiAgICAgICAgICAgIGFycltyb3ddW2NvbF0gKz0gY2M7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGFycjtcbiAgICB9XG5cbiAgICBvYmouaGFzaCA9IGZ1bmN0aW9uKHN0cikge1xuICAgICAgICB2YXIgaGFzaCA9IDAsIGksIGNocjtcblxuICAgICAgICBpZiAoc3RyLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIGhhc2g7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgc3RyLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgIGNociA9IHN0ci5jaGFyQ29kZUF0KGkpO1xuICAgICAgICAgICAgICBoYXNoID0gKChoYXNoIDw8IDUpIC0gaGFzaCkgKyBjaHI7XG4gICAgICAgICAgICAgIGhhc2ggfD0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaGFzaDtcbiAgICB9XG5cbiAgICBvYmoub25hZnRlcmNoYW5nZXMgPSBmdW5jdGlvbihlbCwgcmVjb3Jkcykge1xuICAgICAgICBpZiAoISBvYmouaWdub3JlRXZlbnRzKSB7XG4gICAgICAgICAgICAvLyBPbiBhZnRlciBjaGFuZ2VzXG4gICAgICAgICAgICBpZiAodHlwZW9mKG9iai5vcHRpb25zLm9uYWZ0ZXJjaGFuZ2VzKSA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMub25hZnRlcmNoYW5nZXMoZWwsIHJlY29yZHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxyXG5cbiAgICBvYmouZGVzdHJveSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGpleGNlbC5kZXN0cm95KGVsKTtcclxuICAgIH1cclxuXG4gICAgLyoqXG4gICAgICogSW5pdGlhbGl6YXRpb24gbWV0aG9kXG4gICAgICovXG4gICAgb2JqLmluaXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgamV4Y2VsLmN1cnJlbnQgPSBvYmo7XG5cbiAgICAgICAgLy8gQnVpbGQgaGFuZGxlcnNcbiAgICAgICAgaWYgKHR5cGVvZihqZXhjZWwuYnVpbGQpID09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIGpleGNlbC5idWlsZCgpO1xuICAgICAgICAgICAgamV4Y2VsLmJ1aWxkID0gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIExvYWQgdGhlIHRhYmxlIGRhdGEgYmFzZWQgb24gYW4gQ1NWIGZpbGVcbiAgICAgICAgaWYgKG9iai5vcHRpb25zLmNzdikge1xuICAgICAgICAgICAgLy8gTG9hZGluZ1xuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmxvYWRpbmdTcGluID09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBqU3VpdGVzLmxvYWRpbmcuc2hvdygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBMb2FkIENTViBmaWxlXG4gICAgICAgICAgICBqU3VpdGVzLmFqYXgoe1xuICAgICAgICAgICAgICAgIHVybDogb2JqLm9wdGlvbnMuY3N2LFxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gQ29udmVydCBkYXRhXG4gICAgICAgICAgICAgICAgICAgIHZhciBuZXdEYXRhID0gb2JqLnBhcnNlQ1NWKHJlc3VsdCwgb2JqLm9wdGlvbnMuY3N2RGVsaW1pdGVyKVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIEhlYWRlcnNcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmNzdkhlYWRlcnMgPT0gdHJ1ZSAmJiBuZXdEYXRhLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBoZWFkZXJzID0gbmV3RGF0YS5zaGlmdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGhlYWRlcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoISBvYmoub3B0aW9ucy5jb2x1bW5zW2ldKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmNvbHVtbnNbaV0gPSB7IHR5cGU6J3RleHQnLCBhbGlnbjpvYmoub3B0aW9ucy5kZWZhdWx0Q29sQWxpZ24sIHdpZHRoOm9iai5vcHRpb25zLmRlZmF1bHRDb2xXaWR0aCB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBQcmVjZWRlbmNlIG92ZXIgcHJlLWNvbmZpZ3VyYXRlZCB0aXRsZXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG9iai5vcHRpb25zLmNvbHVtbnNbaV0udGl0bGUgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5jb2x1bW5zW2ldLnRpdGxlID0gaGVhZGVyc1tpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy8gRGF0YVxuICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5kYXRhID0gbmV3RGF0YTtcbiAgICAgICAgICAgICAgICAgICAgLy8gUHJlcGFyZSB0YWJsZVxuICAgICAgICAgICAgICAgICAgICBvYmoucHJlcGFyZVRhYmxlKCk7XG4gICAgICAgICAgICAgICAgICAgIC8vIEhpZGUgc3BpblxuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMubG9hZGluZ1NwaW4gPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgalN1aXRlcy5sb2FkaW5nLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2UgaWYgKG9iai5vcHRpb25zLnVybCkge1xuICAgICAgICAgICAgLy8gTG9hZGluZ1xuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmxvYWRpbmdTcGluID09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBqU3VpdGVzLmxvYWRpbmcuc2hvdygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBqU3VpdGVzLmFqYXgoe1xuICAgICAgICAgICAgICAgIHVybDogb2JqLm9wdGlvbnMudXJsLFxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gRGF0YVxuICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5kYXRhID0gKHJlc3VsdC5kYXRhKSA/IHJlc3VsdC5kYXRhIDogcmVzdWx0O1xuICAgICAgICAgICAgICAgICAgICAvLyBQcmVwYXJlIHRhYmxlXG4gICAgICAgICAgICAgICAgICAgIG9iai5wcmVwYXJlVGFibGUoKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gSGlkZSBzcGluXG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5sb2FkaW5nU3BpbiA9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBqU3VpdGVzLmxvYWRpbmcuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBQcmVwYXJlIHRhYmxlXG4gICAgICAgICAgICBvYmoucHJlcGFyZVRhYmxlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDb250ZXh0IG1lbnVcbiAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmNvbnRleHRNZW51ICE9IG51bGwpIHtcbiAgICAgICAgb2JqLm9wdGlvbnMuY29udGV4dE1lbnUgPSBvcHRpb25zLmNvbnRleHRNZW51O1xuICAgIH0gZWxzZSB7XG4gICAgICAgIG9iai5vcHRpb25zLmNvbnRleHRNZW51ID0gZnVuY3Rpb24oZWwsIHgsIHksIGUpIHtcbiAgICAgICAgICAgIHZhciBpdGVtcyA9IFtdO1xuXG4gICAgICAgICAgICBpZiAoeSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgLy8gSW5zZXJ0IGEgbmV3IGNvbHVtblxuICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5hbGxvd0luc2VydENvbHVtbiA9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6b2JqLm9wdGlvbnMudGV4dC5pbnNlcnRBTmV3Q29sdW1uQmVmb3JlLFxuICAgICAgICAgICAgICAgICAgICAgICAgb25jbGljazpmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouaW5zZXJ0Q29sdW1uKDEsIHBhcnNlSW50KHgpLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmFsbG93SW5zZXJ0Q29sdW1uID09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgaXRlbXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTpvYmoub3B0aW9ucy50ZXh0Lmluc2VydEFOZXdDb2x1bW5BZnRlcixcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uY2xpY2s6ZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmluc2VydENvbHVtbigxLCBwYXJzZUludCh4KSwgMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIERlbGV0ZSBhIGNvbHVtblxuICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5hbGxvd0RlbGV0ZUNvbHVtbiA9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6b2JqLm9wdGlvbnMudGV4dC5kZWxldGVTZWxlY3RlZENvbHVtbnMsXG4gICAgICAgICAgICAgICAgICAgICAgICBvbmNsaWNrOmZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5kZWxldGVDb2x1bW4ob2JqLmdldFNlbGVjdGVkQ29sdW1ucygpLmxlbmd0aCA/IHVuZGVmaW5lZCA6IHBhcnNlSW50KHgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gUmVuYW1lIGNvbHVtblxuICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5hbGxvd1JlbmFtZUNvbHVtbiA9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6b2JqLm9wdGlvbnMudGV4dC5yZW5hbWVUaGlzQ29sdW1uLFxuICAgICAgICAgICAgICAgICAgICAgICAgb25jbGljazpmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouc2V0SGVhZGVyKHgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBTb3J0aW5nXG4gICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmNvbHVtblNvcnRpbmcgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBMaW5lXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2goeyB0eXBlOidsaW5lJyB9KTtcblxuICAgICAgICAgICAgICAgICAgICBpdGVtcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOm9iai5vcHRpb25zLnRleHQub3JkZXJBc2NlbmRpbmcsXG4gICAgICAgICAgICAgICAgICAgICAgICBvbmNsaWNrOmZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5vcmRlckJ5KHgsIDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgaXRlbXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTpvYmoub3B0aW9ucy50ZXh0Lm9yZGVyRGVzY2VuZGluZyxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uY2xpY2s6ZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLm9yZGVyQnkoeCwgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gSW5zZXJ0IG5ldyByb3dcbiAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuYWxsb3dJbnNlcnRSb3cgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICBpdGVtcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOm9iai5vcHRpb25zLnRleHQuaW5zZXJ0QU5ld1Jvd0JlZm9yZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uY2xpY2s6ZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmluc2VydFJvdygxLCBwYXJzZUludCh5KSwgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6b2JqLm9wdGlvbnMudGV4dC5pbnNlcnRBTmV3Um93QWZ0ZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICBvbmNsaWNrOmZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5pbnNlcnRSb3coMSwgcGFyc2VJbnQoeSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuYWxsb3dEZWxldGVSb3cgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICBpdGVtcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOm9iai5vcHRpb25zLnRleHQuZGVsZXRlU2VsZWN0ZWRSb3dzLFxuICAgICAgICAgICAgICAgICAgICAgICAgb25jbGljazpmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouZGVsZXRlUm93KG9iai5nZXRTZWxlY3RlZFJvd3MoKS5sZW5ndGggPyB1bmRlZmluZWQgOiBwYXJzZUludCh5KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICh4KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5hbGxvd0NvbW1lbnRzID09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2goeyB0eXBlOidsaW5lJyB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRpdGxlID0gb2JqLnJlY29yZHNbeV1beF0uZ2V0QXR0cmlidXRlKCd0aXRsZScpIHx8ICcnO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogdGl0bGUgPyBvYmoub3B0aW9ucy50ZXh0LmVkaXRDb21tZW50cyA6IG9iai5vcHRpb25zLnRleHQuYWRkQ29tbWVudHMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25jbGljazpmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbW1lbnQgPSBwcm9tcHQob2JqLm9wdGlvbnMudGV4dC5jb21tZW50cywgdGl0bGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb21tZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5zZXRDb21tZW50cyhbIHgsIHkgXSwgY29tbWVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGl0bGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6b2JqLm9wdGlvbnMudGV4dC5jbGVhckNvbW1lbnRzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmNsaWNrOmZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnNldENvbW1lbnRzKFsgeCwgeSBdLCAnJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gTGluZVxuICAgICAgICAgICAgaXRlbXMucHVzaCh7IHR5cGU6J2xpbmUnIH0pO1xuXG4gICAgICAgICAgICAvLyBDb3B5XG4gICAgICAgICAgICBpdGVtcy5wdXNoKHtcbiAgICAgICAgICAgICAgICB0aXRsZTpvYmoub3B0aW9ucy50ZXh0LmNvcHksXG4gICAgICAgICAgICAgICAgc2hvcnRjdXQ6J0N0cmwgKyBDJyxcbiAgICAgICAgICAgICAgICBvbmNsaWNrOmZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBvYmouY29weSh0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gUGFzdGVcbiAgICAgICAgICAgIGlmIChuYXZpZ2F0b3IgJiYgbmF2aWdhdG9yLmNsaXBib2FyZCkge1xuICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTpvYmoub3B0aW9ucy50ZXh0LnBhc3RlLFxuICAgICAgICAgICAgICAgICAgICBzaG9ydGN1dDonQ3RybCArIFYnLFxuICAgICAgICAgICAgICAgICAgICBvbmNsaWNrOmZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5zZWxlY3RlZENlbGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYXZpZ2F0b3IuY2xpcGJvYXJkLnJlYWRUZXh0KCkudGhlbihmdW5jdGlvbih0ZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0ZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5wYXN0ZShvYmouc2VsZWN0ZWRDZWxsWzBdLCBvYmouc2VsZWN0ZWRDZWxsWzFdLCB0ZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFNhdmVcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5hbGxvd0V4cG9ydCkge1xuICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogb2JqLm9wdGlvbnMudGV4dC5zYXZlQXMsXG4gICAgICAgICAgICAgICAgICAgIHNob3J0Y3V0OiAnQ3RybCArIFMnLFxuICAgICAgICAgICAgICAgICAgICBvbmNsaWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouZG93bmxvYWQoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBBYm91dFxuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmFib3V0KSB7XG4gICAgICAgICAgICAgICAgaXRlbXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOm9iai5vcHRpb25zLnRleHQuYWJvdXQsXG4gICAgICAgICAgICAgICAgICAgIG9uY2xpY2s6ZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhbGVydChvYmoub3B0aW9ucy5hYm91dCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGl0ZW1zO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgb2JqLnNjcm9sbENvbnRyb2xzID0gZnVuY3Rpb24oZSkge1xuICAgICAgICBpZiAob2JqLm9wdGlvbnMubGF6eUxvYWRpbmcgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgaWYgKGpleGNlbC50aW1lQ29udHJvbExvYWRpbmcgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGpleGNlbC50aW1lQ29udHJvbExvYWRpbmcgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLmNvbnRlbnQuc2Nyb2xsVG9wICsgb2JqLmNvbnRlbnQuY2xpZW50SGVpZ2h0ID49IG9iai5jb250ZW50LnNjcm9sbEhlaWdodCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5sb2FkRG93bigpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5jb250ZW50LnNjcm9sbFRvcCArIG9iai5jb250ZW50LmNsaWVudEhlaWdodCA+IG9iai5jb250ZW50LnNjcm9sbEhlaWdodCAtIDEwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5jb250ZW50LnNjcm9sbFRvcCA9IG9iai5jb250ZW50LnNjcm9sbFRvcCAtIG9iai5jb250ZW50LmNsaWVudEhlaWdodDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnVwZGF0ZUNvcm5lclBvc2l0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob2JqLmNvbnRlbnQuc2Nyb2xsVG9wIDw9IG9iai5jb250ZW50LmNsaWVudEhlaWdodCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5sb2FkVXAoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmouY29udGVudC5zY3JvbGxUb3AgPCAxMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouY29udGVudC5zY3JvbGxUb3AgPSBvYmouY29udGVudC5zY3JvbGxUb3AgKyBvYmouY29udGVudC5jbGllbnRIZWlnaHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai51cGRhdGVDb3JuZXJQb3NpdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgamV4Y2VsLnRpbWVDb250cm9sTG9hZGluZyA9IG51bGw7XG4gICAgICAgICAgICAgICAgfSwgMTAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENsb3NlIGVkaXRvclxuICAgICAgICBpZiAob2JqLm9wdGlvbnMubGF6eUxvYWRpbmcgPT0gdHJ1ZSB8fCBvYmoub3B0aW9ucy50YWJsZU92ZXJmbG93ID09IHRydWUpIHtcbiAgICAgICAgICAgIGlmIChvYmouZWRpdGlvbiAmJiBlLnRhcmdldC5jbGFzc05hbWUuc3Vic3RyKDAsOSkgIT0gJ2pkcm9wZG93bicpIHtcbiAgICAgICAgICAgICAgICBvYmouY2xvc2VFZGl0b3Iob2JqLmVkaXRpb25bMF0sIHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZWwuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTU1vdXNlU2Nyb2xsXCIsIG9iai5zY3JvbGxDb250cm9scyk7XG4gICAgZWwuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNld2hlZWxcIiwgb2JqLnNjcm9sbENvbnRyb2xzKTtcblxuICAgIGVsLmpleGNlbCA9IG9iajtcblxuICAgIG9iai5pbml0KCk7XG5cbiAgICByZXR1cm4gb2JqO1xufSk7XG5cbmpleGNlbC5jdXJyZW50ID0gbnVsbDtcbmpleGNlbC50aW1lQ29udHJvbCA9IG51bGw7XG5qZXhjZWwudGltZUNvbnRyb2xMb2FkaW5nID0gbnVsbDtcblxuamV4Y2VsLmRlc3Ryb3kgPSBmdW5jdGlvbihlbGVtZW50LCBkZXN0cm95RXZlbnRIYW5kbGVycykge1xuICAgIGlmIChlbGVtZW50LmpleGNlbCkge1xuICAgICAgICBlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJET01Nb3VzZVNjcm9sbFwiLCBlbGVtZW50LmpleGNlbC5zY3JvbGxDb250cm9scyk7XG4gICAgICAgIGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNld2hlZWxcIiwgZWxlbWVudC5qZXhjZWwuc2Nyb2xsQ29udHJvbHMpO1xuICAgICAgICBlbGVtZW50LmpleGNlbCA9IG51bGw7XG4gICAgICAgIGVsZW1lbnQuaW5uZXJIVE1MID0gJyc7XG5cbiAgICAgICAgaWYgKGRlc3Ryb3lFdmVudEhhbmRsZXJzKSB7XG4gICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBqZXhjZWwua2V5RG93bkNvbnRyb2xzKTtcbiAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIGpleGNlbC5tb3VzZVVwQ29udHJvbHMpO1xuICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBqZXhjZWwubW91c2VEb3duQ29udHJvbHMpO1xuICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCBqZXhjZWwubW91c2VNb3ZlQ29udHJvbHMpO1xuICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNlb3ZlclwiLCBqZXhjZWwubW91c2VPdmVyQ29udHJvbHMpO1xuICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImRibGNsaWNrXCIsIGpleGNlbC5kb3VibGVDbGlja0NvbnRyb2xzKTtcbiAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJwYXN0ZVwiLCBqZXhjZWwucGFzdGVDb250cm9scyk7XG4gICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwiY29udGV4dG1lbnVcIiwgamV4Y2VsLmNvbnRleHRNZW51Q29udHJvbHMpO1xuICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInRvdWNoc3RhcnRcIiwgamV4Y2VsLnRvdWNoU3RhcnRDb250cm9scyk7XG4gICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIiwgamV4Y2VsLnRvdWNoRW5kQ29udHJvbHMpO1xuICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInRvdWNoY2FuY2VsXCIsIGpleGNlbC50b3VjaEVuZENvbnRyb2xzKTtcbiAgICAgICAgICAgIGpleGNlbCA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmpleGNlbC5idWlsZCA9IGZ1bmN0aW9uKCkge1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGpleGNlbC5rZXlEb3duQ29udHJvbHMpO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIGpleGNlbC5tb3VzZVVwQ29udHJvbHMpO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgamV4Y2VsLm1vdXNlRG93bkNvbnRyb2xzKTtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIGpleGNlbC5tb3VzZU1vdmVDb250cm9scyk7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlb3ZlclwiLCBqZXhjZWwubW91c2VPdmVyQ29udHJvbHMpO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJkYmxjbGlja1wiLCBqZXhjZWwuZG91YmxlQ2xpY2tDb250cm9scyk7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInBhc3RlXCIsIGpleGNlbC5wYXN0ZUNvbnRyb2xzKTtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiY29udGV4dG1lbnVcIiwgamV4Y2VsLmNvbnRleHRNZW51Q29udHJvbHMpO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaHN0YXJ0XCIsIGpleGNlbC50b3VjaFN0YXJ0Q29udHJvbHMpO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCBqZXhjZWwudG91Y2hFbmRDb250cm9scyk7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoY2FuY2VsXCIsIGpleGNlbC50b3VjaEVuZENvbnRyb2xzKTtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2htb3ZlXCIsIGpleGNlbC50b3VjaEVuZENvbnRyb2xzKTtcbn1cblxuLyoqXG4gKiBFdmVudHNcbiAqL1xuamV4Y2VsLmtleURvd25Db250cm9scyA9IGZ1bmN0aW9uKGUpIHtcbiAgICBpZiAoamV4Y2VsLmN1cnJlbnQpIHtcbiAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50LmVkaXRpb24pIHtcbiAgICAgICAgICAgIGlmIChlLndoaWNoID09IDI3KSB7XG4gICAgICAgICAgICAgICAgLy8gRXNjYXBlXG4gICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50LmVkaXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gRXhpdCB3aXRob3V0IHNhdmluZ1xuICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5jbG9zZUVkaXRvcihqZXhjZWwuY3VycmVudC5lZGl0aW9uWzBdLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZS53aGljaCA9PSAxMykge1xuICAgICAgICAgICAgICAgIC8vIEVudGVyXG4gICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50Lm9wdGlvbnMuY29sdW1uc1tqZXhjZWwuY3VycmVudC5lZGl0aW9uWzJdXS50eXBlID09ICdjYWxlbmRhcicpIHtcbiAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuZWRpdG9yWzBdLmNoaWxkcmVuWzBdLmNhbGVuZGFyLmNsb3NlKDEpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoamV4Y2VsLmN1cnJlbnQub3B0aW9ucy5jb2x1bW5zW2pleGNlbC5jdXJyZW50LmVkaXRpb25bMl1dLnR5cGUgPT0gJ2Ryb3Bkb3duJyB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQub3B0aW9ucy5jb2x1bW5zW2pleGNlbC5jdXJyZW50LmVkaXRpb25bMl1dLnR5cGUgPT0gJ2F1dG9jb21wbGV0ZScpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gRG8gbm90aGluZ1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEFsdCBlbnRlciAtPiBkbyBub3QgY2xvc2UgZWRpdG9yXG4gICAgICAgICAgICAgICAgICAgIGlmICgoamV4Y2VsLmN1cnJlbnQub3B0aW9ucy53b3JkV3JhcCA9PSB0cnVlIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQub3B0aW9ucy5jb2x1bW5zW2pleGNlbC5jdXJyZW50LmVkaXRpb25bMl1dLndvcmRXcmFwID09IHRydWUgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5vcHRpb25zLmRhdGFbamV4Y2VsLmN1cnJlbnQuZWRpdGlvblszXV1bamV4Y2VsLmN1cnJlbnQuZWRpdGlvblsyXV0ubGVuZ3RoID4gMjAwKSAmJiBlLmFsdEtleSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRkIG5ldyBsaW5lIHRvIHRoZSBlZGl0b3JcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlZGl0b3JUZXh0YXJlYSA9IGpleGNlbC5jdXJyZW50LmVkaXRpb25bMF0uY2hpbGRyZW5bMF07XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWRpdG9yVmFsdWUgPSBqZXhjZWwuY3VycmVudC5lZGl0aW9uWzBdLmNoaWxkcmVuWzBdLnZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVkaXRvckluZGV4T2YgPSBlZGl0b3JUZXh0YXJlYS5zZWxlY3Rpb25TdGFydDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRvclZhbHVlID0gZWRpdG9yVmFsdWUuc2xpY2UoMCwgZWRpdG9ySW5kZXhPZikgKyBcIlxcblwiICsgZWRpdG9yVmFsdWUuc2xpY2UoZWRpdG9ySW5kZXhPZik7XG4gICAgICAgICAgICAgICAgICAgICAgICBlZGl0b3JUZXh0YXJlYS52YWx1ZSA9IGVkaXRvclZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWRpdG9yVGV4dGFyZWEuZm9jdXMoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRvclRleHRhcmVhLnNlbGVjdGlvblN0YXJ0ID0gZWRpdG9ySW5kZXhPZiArIDE7XG4gICAgICAgICAgICAgICAgICAgICAgICBlZGl0b3JUZXh0YXJlYS5zZWxlY3Rpb25FbmQgPSBlZGl0b3JJbmRleE9mICsgMTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmVkaXRpb25bMF0uY2hpbGRyZW5bMF0uYmx1cigpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmIChlLndoaWNoID09IDkpIHtcbiAgICAgICAgICAgICAgICAvLyBUYWJcbiAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQub3B0aW9ucy5jb2x1bW5zW2pleGNlbC5jdXJyZW50LmVkaXRpb25bMl1dLnR5cGUgPT0gJ2NhbGVuZGFyJykge1xuICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5lZGl0aW9uWzBdLmNoaWxkcmVuWzBdLmNhbGVuZGFyLmNsb3NlKDEpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmVkaXRpb25bMF0uY2hpbGRyZW5bMF0uYmx1cigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghIGpleGNlbC5jdXJyZW50LmVkaXRpb24gJiYgamV4Y2VsLmN1cnJlbnQuc2VsZWN0ZWRDZWxsKSB7XG4gICAgICAgICAgICAvLyBXaGljaCBrZXlcbiAgICAgICAgICAgIGlmIChlLndoaWNoID09IDM3KSB7XG4gICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQubGVmdChlLnNoaWZ0S2V5LCBlLmN0cmxLZXkpO1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZS53aGljaCA9PSAzOSkge1xuICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnJpZ2h0KGUuc2hpZnRLZXksIGUuY3RybEtleSk7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChlLndoaWNoID09IDM4KSB7XG4gICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQudXAoZS5zaGlmdEtleSwgZS5jdHJsS2V5KTtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGUud2hpY2ggPT0gNDApIHtcbiAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5kb3duKGUuc2hpZnRLZXksIGUuY3RybEtleSk7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChlLndoaWNoID09IDM2KSB7XG4gICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuZmlyc3QoZS5zaGlmdEtleSwgZS5jdHJsS2V5KTtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGUud2hpY2ggPT0gMzUpIHtcbiAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5sYXN0KGUuc2hpZnRLZXksIGUuY3RybEtleSk7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChlLndoaWNoID09IDMyKSB7XG4gICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50Lm9wdGlvbnMuZWRpdGFibGUgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5zZXRDaGVja1JhZGlvVmFsdWUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChlLndoaWNoID09IDQ2KSB7XG4gICAgICAgICAgICAgICAgLy8gRGVsZXRlXG4gICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50Lm9wdGlvbnMuZWRpdGFibGUgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQuc2VsZWN0ZWRSb3cpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudC5vcHRpb25zLmFsbG93RGVsZXRlUm93ID09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlybShqZXhjZWwuY3VycmVudC5vcHRpb25zLnRleHQuYXJlWW91U3VyZVRvRGVsZXRlVGhlU2VsZWN0ZWRSb3dzKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5kZWxldGVSb3coKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoamV4Y2VsLmN1cnJlbnQuc2VsZWN0ZWRIZWFkZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudC5vcHRpb25zLmFsbG93RGVsZXRlQ29sdW1uID09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlybShqZXhjZWwuY3VycmVudC5vcHRpb25zLnRleHQuYXJlWW91U3VyZVRvRGVsZXRlVGhlU2VsZWN0ZWRDb2x1bW5zKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5kZWxldGVDb2x1bW4oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBDaGFuZ2UgdmFsdWVcbiAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnNldFZhbHVlKGpleGNlbC5jdXJyZW50LmhpZ2hsaWdodGVkLCAnJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGUud2hpY2ggPT0gMTMpIHtcbiAgICAgICAgICAgICAgICAvLyBNb3ZlIGN1cnNvclxuICAgICAgICAgICAgICAgIGlmIChlLnNoaWZ0S2V5KSB7XG4gICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnVwKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50Lm9wdGlvbnMuYWxsb3dJbnNlcnRSb3cgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50Lm9wdGlvbnMuYWxsb3dNYW51YWxJbnNlcnRSb3cgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudC5zZWxlY3RlZENlbGxbMV0gPT0gamV4Y2VsLmN1cnJlbnQub3B0aW9ucy5kYXRhLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTmV3IHJlY29yZCBpbiBjYXNlIHNlbGVjdGVkQ2VsbCBpbiB0aGUgbGFzdCByb3dcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuaW5zZXJ0Um93KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuZG93bigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGUud2hpY2ggPT0gOSkge1xuICAgICAgICAgICAgICAgIC8vIFRhYlxuICAgICAgICAgICAgICAgIGlmIChlLnNoaWZ0S2V5KSB7XG4gICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmxlZnQoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQub3B0aW9ucy5hbGxvd0luc2VydENvbHVtbiA9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQub3B0aW9ucy5hbGxvd01hbnVhbEluc2VydENvbHVtbiA9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50LnNlbGVjdGVkQ2VsbFswXSA9PSBqZXhjZWwuY3VycmVudC5vcHRpb25zLmRhdGFbMF0ubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBOZXcgcmVjb3JkIGluIGNhc2Ugc2VsZWN0ZWRDZWxsIGluIHRoZSBsYXN0IGNvbHVtblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5pbnNlcnRDb2x1bW4oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5yaWdodCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICgoZS5jdHJsS2V5IHx8IGUubWV0YUtleSkgJiYgISBlLnNoaWZ0S2V5KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlLndoaWNoID09IDY1KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBDdHJsICsgQVxuICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuc2VsZWN0QWxsKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZS53aGljaCA9PSA4Mykge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ3RybCArIFNcbiAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmRvd25sb2FkKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZS53aGljaCA9PSA4OSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ3RybCArIFlcbiAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnJlZG8oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlLndoaWNoID09IDkwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBDdHJsICsgWlxuICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQudW5kbygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGUud2hpY2ggPT0gNjcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEN0cmwgKyBDXG4gICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5jb3B5KHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGUud2hpY2ggPT0gNjcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEN0cmwgKyBDXG4gICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5jb3B5KHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGUud2hpY2ggPT0gODgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEN0cmwgKyBYXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQub3B0aW9ucy5lZGl0YWJsZSA9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1dENvbnRyb2xzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jb3B5Q29udHJvbHMoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlLndoaWNoID09IDg2KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBDdHJsICsgVlxuICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLnBhc3RlQ29udHJvbHMoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudC5zZWxlY3RlZENlbGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudC5vcHRpb25zLmVkaXRhYmxlID09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcm93SWQgPSBqZXhjZWwuY3VycmVudC5zZWxlY3RlZENlbGxbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbHVtbklkID0gamV4Y2VsLmN1cnJlbnQuc2VsZWN0ZWRDZWxsWzBdO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgaXMgbm90IHJlYWRvbmx5XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50Lm9wdGlvbnMuY29sdW1uc1tjb2x1bW5JZF0udHlwZSAhPSAncmVhZG9ubHknKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENoYXJhY3RlcnMgYWJsZSB0byBzdGFydCBhIGVkaXRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUua2V5Q29kZSA9PSAzMikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3BhY2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudC5vcHRpb25zLmNvbHVtbnNbY29sdW1uSWRdLnR5cGUgPT0gJ2NoZWNrYm94JyB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50Lm9wdGlvbnMuY29sdW1uc1tjb2x1bW5JZF0udHlwZSA9PSAncmFkaW8nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTdGFydCBlZGl0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQub3BlbkVkaXRvcihqZXhjZWwuY3VycmVudC5yZWNvcmRzW3Jvd0lkXVtjb2x1bW5JZF0sIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGUua2V5Q29kZSA9PSAxMTMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFN0YXJ0IGVkaXRpb24gd2l0aCBjdXJyZW50IGNvbnRlbnQgRjJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50Lm9wZW5FZGl0b3IoamV4Y2VsLmN1cnJlbnQucmVjb3Jkc1tyb3dJZF1bY29sdW1uSWRdLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoKGUua2V5Q29kZSA9PSA4KSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChlLmtleUNvZGUgPj0gNDggJiYgZS5rZXlDb2RlIDw9IDU3KSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChlLmtleUNvZGUgPj0gOTYgJiYgZS5rZXlDb2RlIDw9IDExMSkgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZS5rZXlDb2RlID09IDE4NykgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZS5rZXlDb2RlID09IDE4OSkgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoKFN0cmluZy5mcm9tQ2hhckNvZGUoZS5rZXlDb2RlKSA9PSBlLmtleSB8fCBTdHJpbmcuZnJvbUNoYXJDb2RlKGUua2V5Q29kZSkudG9Mb3dlckNhc2UoKSA9PSBlLmtleS50b0xvd2VyQ2FzZSgpKSAmJiBqZXhjZWwudmFsaWRMZXR0ZXIoU3RyaW5nLmZyb21DaGFyQ29kZShlLmtleUNvZGUpKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFN0YXJ0IGVkaXRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50Lm9wZW5FZGl0b3IoamV4Y2VsLmN1cnJlbnQucmVjb3Jkc1tyb3dJZF1bY29sdW1uSWRdLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFByZXZlbnQgZW50cmllcyBpbiB0aGUgY2FsZW5kYXJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudC5vcHRpb25zLmNvbHVtbnNbY29sdW1uSWRdLnR5cGUgPT0gJ2NhbGVuZGFyJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2pleGNlbF9zZWFyY2gnKSkge1xuICAgICAgICAgICAgICAgIGlmIChqZXhjZWwudGltZUNvbnRyb2wpIHtcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGpleGNlbC50aW1lQ29udHJvbCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgamV4Y2VsLnRpbWVDb250cm9sID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuc2VhcmNoKGUudGFyZ2V0LnZhbHVlKTtcbiAgICAgICAgICAgICAgICB9LCAyMDApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuXG5qZXhjZWwuaXNNb3VzZUFjdGlvbiA9IGZhbHNlO1xuXG5qZXhjZWwubW91c2VEb3duQ29udHJvbHMgPSBmdW5jdGlvbihlKSB7XG4gICAgZSA9IGUgfHwgd2luZG93LmV2ZW50O1xuICAgIGlmIChlLmJ1dHRvbnMpIHtcbiAgICAgICAgdmFyIG1vdXNlQnV0dG9uID0gZS5idXR0b25zO1xuICAgIH0gZWxzZSBpZiAoZS5idXR0b24pIHtcbiAgICAgICAgdmFyIG1vdXNlQnV0dG9uID0gZS5idXR0b247XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIG1vdXNlQnV0dG9uID0gZS53aGljaDtcbiAgICB9XG5cbiAgICAvLyBHZXQgZWxlbWVudHNcbiAgICB2YXIgamV4Y2VsVGFibGUgPSBqZXhjZWwuZ2V0RWxlbWVudChlLnRhcmdldCk7XG5cbiAgICBpZiAoamV4Y2VsVGFibGVbMF0pIHtcbiAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50ICE9IGpleGNlbFRhYmxlWzBdLmpleGNlbCkge1xuICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50KSB7XG4gICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQucmVzZXRTZWxlY3Rpb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGpleGNlbC5jdXJyZW50ID0gamV4Y2VsVGFibGVbMF0uamV4Y2VsO1xuICAgICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50KSB7XG4gICAgICAgICAgICBqZXhjZWwuY3VycmVudC5yZXNldFNlbGVjdGlvbih0cnVlKTtcbiAgICAgICAgICAgIGpleGNlbC5jdXJyZW50ID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlmIChqZXhjZWwuY3VycmVudCAmJiBtb3VzZUJ1dHRvbiA9PSAxKSB7XG4gICAgICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2pleGNlbF9zZWxlY3RhbGwnKSkge1xuICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50KSB7XG4gICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuc2VsZWN0QWxsKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqZXhjZWxfY29ybmVyJykpIHtcbiAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudC5vcHRpb25zLmVkaXRhYmxlID09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5zZWxlY3RlZENvcm5lciA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBIZWFkZXIgZm91bmRcbiAgICAgICAgICAgIGlmIChqZXhjZWxUYWJsZVsxXSA9PSAxKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNvbHVtbklkID0gZS50YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLXgnKTtcbiAgICAgICAgICAgICAgICBpZiAoY29sdW1uSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIGN1cnNvclxuICAgICAgICAgICAgICAgICAgICB2YXIgaW5mbyA9IGUudGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQub3B0aW9ucy5jb2x1bW5SZXNpemUgPT0gdHJ1ZSAmJiBpbmZvLndpZHRoIC0gZS5vZmZzZXRYIDwgNikge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVzaXplIGhlbHBlclxuICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQucmVzaXppbmcgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW91c2VQb3NpdGlvbjogZS5wYWdlWCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW46IGNvbHVtbklkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBpbmZvLndpZHRoLFxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQm9yZGVyIGluZGljYXRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmhlYWRlcnNbY29sdW1uSWRdLmNsYXNzTGlzdC5hZGQoJ3Jlc2l6aW5nJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGpleGNlbC5jdXJyZW50LnJlY29yZHMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQucmVjb3Jkc1tqXVtjb2x1bW5JZF0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQucmVjb3Jkc1tqXVtjb2x1bW5JZF0uY2xhc3NMaXN0LmFkZCgncmVzaXppbmcnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoamV4Y2VsLmN1cnJlbnQub3B0aW9ucy5jb2x1bW5EcmFnID09IHRydWUgJiYgaW5mby5oZWlnaHQgLSBlLm9mZnNldFkgPCA2KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQuaXNDb2xNZXJnZWQoY29sdW1uSWQpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0pFWENFTDogVGhpcyBjb2x1bW4gaXMgcGFydCBvZiBhIG1lcmdlZCBjZWxsLicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZXNldCBzZWxlY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5yZXNldFNlbGVjdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIERyYWcgaGVscGVyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuZHJhZ2dpbmcgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGUudGFyZ2V0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW46Y29sdW1uSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uOmNvbHVtbklkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQm9yZGVyIGluZGljYXRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5oZWFkZXJzW2NvbHVtbklkXS5jbGFzc0xpc3QuYWRkKCdkcmFnZ2luZycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgamV4Y2VsLmN1cnJlbnQucmVjb3Jkcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQucmVjb3Jkc1tqXVtjb2x1bW5JZF0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnJlY29yZHNbal1bY29sdW1uSWRdLmNsYXNzTGlzdC5hZGQoJ2RyYWdnaW5nJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQuc2VsZWN0ZWRIZWFkZXIgJiYgKGUuc2hpZnRLZXkgfHwgZS5jdHJsS2V5KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvID0gamV4Y2VsLmN1cnJlbnQuc2VsZWN0ZWRIZWFkZXI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBjb2x1bW5JZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUHJlc3MgdG8gcmVuYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50LnNlbGVjdGVkSGVhZGVyID09IGNvbHVtbklkICYmIGpleGNlbC5jdXJyZW50Lm9wdGlvbnMuYWxsb3dSZW5hbWVDb2x1bW4gPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwudGltZUNvbnRyb2wgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuc2V0SGVhZGVyKGNvbHVtbklkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgODAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBLZWVwIHRyYWNrIG9mIHdoaWNoIGhlYWRlciB3YXMgc2VsZWN0ZWQgZmlyc3RcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5zZWxlY3RlZEhlYWRlciA9IGNvbHVtbklkO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIHNlbGVjdGlvbiBzaW5nbGUgY29sdW1uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG8gPSBjb2x1bW5JZDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IGNvbHVtbklkO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgc2VsZWN0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC51cGRhdGVTZWxlY3Rpb25Gcm9tQ29vcmRzKG8sIDAsIGQsIGpleGNlbC5jdXJyZW50Lm9wdGlvbnMuZGF0YS5sZW5ndGggLSAxKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlLnRhcmdldC5wYXJlbnROb2RlLmNsYXNzTGlzdC5jb250YWlucygnamV4Y2VsX25lc3RlZCcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLWNvbHVtbicpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbHVtbiA9IGUudGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1jb2x1bW4nKS5zcGxpdCgnLCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjMSA9IHBhcnNlSW50KGNvbHVtblswXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMyID0gcGFyc2VJbnQoY29sdW1uW2NvbHVtbi5sZW5ndGgtMV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjMSA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYzIgPSBqZXhjZWwuY3VycmVudC5vcHRpb25zLmNvbHVtbnMubGVuZ3RoIC0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQudXBkYXRlU2VsZWN0aW9uRnJvbUNvb3JkcyhjMSwgMCwgYzIsIGpleGNlbC5jdXJyZW50Lm9wdGlvbnMuZGF0YS5sZW5ndGggLSAxKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuc2VsZWN0ZWRIZWFkZXIgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQm9keSBmb3VuZFxuICAgICAgICAgICAgaWYgKGpleGNlbFRhYmxlWzFdID09IDIpIHtcbiAgICAgICAgICAgICAgICB2YXIgcm93SWQgPSBlLnRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEteScpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnamV4Y2VsX3JvdycpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpbmZvID0gZS50YXJnZXQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudC5vcHRpb25zLnJvd1Jlc2l6ZSA9PSB0cnVlICYmIGluZm8uaGVpZ2h0IC0gZS5vZmZzZXRZIDwgNikge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVzaXplIGhlbHBlclxuICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQucmVzaXppbmcgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudDogZS50YXJnZXQucGFyZW50Tm9kZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb3VzZVBvc2l0aW9uOiBlLnBhZ2VZLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvdzogcm93SWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBpbmZvLmhlaWdodCxcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBCb3JkZXIgaW5kaWNhdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgZS50YXJnZXQucGFyZW50Tm9kZS5jbGFzc0xpc3QuYWRkKCdyZXNpemluZycpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGpleGNlbC5jdXJyZW50Lm9wdGlvbnMucm93RHJhZyA9PSB0cnVlICYmIGluZm8ud2lkdGggLSBlLm9mZnNldFggPCA2KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQuaXNSb3dNZXJnZWQocm93SWQpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0pFWENFTDogVGhpcyByb3cgaXMgcGFydCBvZiBhIG1lcmdlZCBjZWxsJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGpleGNlbC5jdXJyZW50Lm9wdGlvbnMuc2VhcmNoID09IHRydWUgJiYgamV4Y2VsLmN1cnJlbnQucmVzdWx0cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0pFWENFTDogUGxlYXNlIGNsZWFyIHlvdXIgc2VhcmNoIGJlZm9yZSBwZXJmb3JtIHRoaXMgYWN0aW9uJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlc2V0IHNlbGVjdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnJlc2V0U2VsZWN0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRHJhZyBoZWxwZXJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5kcmFnZ2luZyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudDogZS50YXJnZXQucGFyZW50Tm9kZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93OnJvd0lkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbjpyb3dJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEJvcmRlciBpbmRpY2F0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZS50YXJnZXQucGFyZW50Tm9kZS5jbGFzc0xpc3QuYWRkKCdkcmFnZ2luZycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50LnNlbGVjdGVkUm93ICYmIChlLnNoaWZ0S2V5IHx8IGUuY3RybEtleSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbyA9IGpleGNlbC5jdXJyZW50LnNlbGVjdGVkUm93O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gcm93SWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEtlZXAgdHJhY2sgb2Ygd2hpY2ggaGVhZGVyIHdhcyBzZWxlY3RlZCBmaXJzdFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnNlbGVjdGVkUm93ID0gcm93SWQ7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgc2VsZWN0aW9uIHNpbmdsZSBjb2x1bW5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbyA9IHJvd0lkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gcm93SWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBzZWxlY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnVwZGF0ZVNlbGVjdGlvbkZyb21Db29yZHMoMCwgbywgamV4Y2VsLmN1cnJlbnQub3B0aW9ucy5kYXRhWzBdLmxlbmd0aCAtIDEsIGQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gSmNsb3NlXG4gICAgICAgICAgICAgICAgICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2pjbG9zZScpICYmIGUudGFyZ2V0LmNsaWVudFdpZHRoIC0gZS5vZmZzZXRYIDwgNTAgJiYgZS5vZmZzZXRZIDwgNTApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmNsb3NlRWRpdG9yKGpleGNlbC5jdXJyZW50LmVkaXRpb25bMF0sIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGdldENlbGxDb29yZHMgPSBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHggPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS14Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHkgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS15Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHggJiYgeSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gW3gsIHldO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LnBhcmVudE5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDZWxsQ29vcmRzKGVsZW1lbnQucGFyZW50Tm9kZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcG9zaXRpb24gPSBnZXRDZWxsQ29vcmRzKGUudGFyZ2V0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwb3NpdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb2x1bW5JZCA9IHBvc2l0aW9uWzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByb3dJZCA9IHBvc2l0aW9uWzFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENsb3NlIGVkaXRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQuZWRpdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQuZWRpdGlvblsyXSAhPSBjb2x1bW5JZCB8fCBqZXhjZWwuY3VycmVudC5lZGl0aW9uWzNdICE9IHJvd0lkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5jbG9zZUVkaXRvcihqZXhjZWwuY3VycmVudC5lZGl0aW9uWzBdLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghIGpleGNlbC5jdXJyZW50LmVkaXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIGNlbGwgc2VsZWN0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLnNoaWZ0S2V5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC51cGRhdGVTZWxlY3Rpb25Gcm9tQ29vcmRzKGpleGNlbC5jdXJyZW50LnNlbGVjdGVkQ2VsbFswXSwgamV4Y2VsLmN1cnJlbnQuc2VsZWN0ZWRDZWxsWzFdLCBjb2x1bW5JZCwgcm93SWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQudXBkYXRlU2VsZWN0aW9uRnJvbUNvb3Jkcyhjb2x1bW5JZCwgcm93SWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTm8gZnVsbCByb3cgc2VsZWN0ZWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5zZWxlY3RlZEhlYWRlciA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuc2VsZWN0ZWRSb3cgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5zZWxlY3RlZFJvdyA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBQYWdpbmF0aW9uXG4gICAgICAgICAgICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqZXhjZWxfcGFnZScpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGUudGFyZ2V0LmlubmVyVGV4dCA9PSAnPCcpIHtcbiAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQucGFnZSgwKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGUudGFyZ2V0LmlubmVyVGV4dCA9PSAnPicpIHtcbiAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQucGFnZShlLnRhcmdldC5nZXRBdHRyaWJ1dGUoJ3RpdGxlJykgLSAxKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5wYWdlKGUudGFyZ2V0LmlubmVyVGV4dCAtIDEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChqZXhjZWwuY3VycmVudC5lZGl0aW9uKSB7XG4gICAgICAgICAgICBqZXhjZWwuaXNNb3VzZUFjdGlvbiA9IGZhbHNlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgamV4Y2VsLmlzTW91c2VBY3Rpb24gPSB0cnVlO1xuICAgICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICAgamV4Y2VsLmlzTW91c2VBY3Rpb24gPSBmYWxzZTtcbiAgICB9XG59XG5cbmpleGNlbC5tb3VzZVVwQ29udHJvbHMgPSBmdW5jdGlvbihlKSB7XG4gICAgaWYgKGpleGNlbC5jdXJyZW50KSB7XG4gICAgICAgIC8vIFVwZGF0ZSBjZWxsIHNpemVcbiAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50LnJlc2l6aW5nKSB7XG4gICAgICAgICAgICAvLyBDb2x1bW5zIHRvIGJlIHVwZGF0ZWRcbiAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudC5yZXNpemluZy5jb2x1bW4pIHtcbiAgICAgICAgICAgICAgICAvLyBSZW1vdmUgQ2xhc3NcbiAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5oZWFkZXJzW2pleGNlbC5jdXJyZW50LnJlc2l6aW5nLmNvbHVtbl0uY2xhc3NMaXN0LnJlbW92ZSgncmVzaXppbmcnKTtcbiAgICAgICAgICAgICAgICB2YXIgbmV3V2lkdGggPSBqZXhjZWwuY3VycmVudC5jb2xncm91cFtqZXhjZWwuY3VycmVudC5yZXNpemluZy5jb2x1bW5dLmdldEF0dHJpYnV0ZSgnd2lkdGgnKTtcbiAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5zZXRXaWR0aChqZXhjZWwuY3VycmVudC5yZXNpemluZy5jb2x1bW4sIG5ld1dpZHRoLCBqZXhjZWwuY3VycmVudC5yZXNpemluZy53aWR0aCk7XG4gICAgICAgICAgICAgICAgLy8gUmVtb3ZlIGJvcmRlclxuICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmhlYWRlcnNbamV4Y2VsLmN1cnJlbnQucmVzaXppbmcuY29sdW1uXS5jbGFzc0xpc3QucmVtb3ZlKCdyZXNpemluZycpO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgamV4Y2VsLmN1cnJlbnQucmVjb3Jkcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQucmVjb3Jkc1tqXVtqZXhjZWwuY3VycmVudC5yZXNpemluZy5jb2x1bW5dKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnJlY29yZHNbal1bamV4Y2VsLmN1cnJlbnQucmVzaXppbmcuY29sdW1uXS5jbGFzc0xpc3QucmVtb3ZlKCdyZXNpemluZycpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBSZW1vdmUgQ2xhc3NcbiAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5yb3dzW2pleGNlbC5jdXJyZW50LnJlc2l6aW5nLnJvd10uY2hpbGRyZW5bMF0uY2xhc3NMaXN0LnJlbW92ZSgncmVzaXppbmcnKTtcbiAgICAgICAgICAgICAgICB2YXIgbmV3SGVpZ2h0ID0gamV4Y2VsLmN1cnJlbnQucm93c1tqZXhjZWwuY3VycmVudC5yZXNpemluZy5yb3ddLmdldEF0dHJpYnV0ZSgnaGVpZ2h0Jyk7XG4gICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuc2V0SGVpZ2h0KGpleGNlbC5jdXJyZW50LnJlc2l6aW5nLnJvdywgbmV3SGVpZ2h0LCBqZXhjZWwuY3VycmVudC5yZXNpemluZy5oZWlnaHQpO1xuICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBib3JkZXJcbiAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5yZXNpemluZy5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3Jlc2l6aW5nJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBSZXNldCByZXNpemluZyBoZWxwZXJcbiAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnJlc2l6aW5nID0gbnVsbDtcbiAgICAgICAgfSBlbHNlIGlmIChqZXhjZWwuY3VycmVudC5kcmFnZ2luZykge1xuICAgICAgICAgICAgLy8gUmVzZXQgZHJhZ2dpbmcgaGVscGVyXG4gICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQuZHJhZ2dpbmcpIHtcbiAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQuZHJhZ2dpbmcuY29sdW1uKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFRhcmdldFxuICAgICAgICAgICAgICAgICAgICB2YXIgY29sdW1uSWQgPSBlLnRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEteCcpO1xuICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgbW92ZSBzdHlsZVxuICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5oZWFkZXJzW2pleGNlbC5jdXJyZW50LmRyYWdnaW5nLmNvbHVtbl0uY2xhc3NMaXN0LnJlbW92ZSgnZHJhZ2dpbmcnKTtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBqZXhjZWwuY3VycmVudC5yb3dzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQucmVjb3Jkc1tqXVtqZXhjZWwuY3VycmVudC5kcmFnZ2luZy5jb2x1bW5dKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQucmVjb3Jkc1tqXVtqZXhjZWwuY3VycmVudC5kcmFnZ2luZy5jb2x1bW5dLmNsYXNzTGlzdC5yZW1vdmUoJ2RyYWdnaW5nJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBqZXhjZWwuY3VycmVudC5oZWFkZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5oZWFkZXJzW2ldLmNsYXNzTGlzdC5yZW1vdmUoJ2RyYWdnaW5nLWxlZnQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmhlYWRlcnNbaV0uY2xhc3NMaXN0LnJlbW92ZSgnZHJhZ2dpbmctcmlnaHQnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgcG9zaXRpb25cbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbHVtbklkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQuZHJhZ2dpbmcuY29sdW1uICE9IGpleGNlbC5jdXJyZW50LmRyYWdnaW5nLmRlc3RpbmF0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQubW92ZUNvbHVtbihqZXhjZWwuY3VycmVudC5kcmFnZ2luZy5jb2x1bW4sIGpleGNlbC5jdXJyZW50LmRyYWdnaW5nLmRlc3RpbmF0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwb3NpdGlvbiA9IEFycmF5LnByb3RvdHlwZS5pbmRleE9mLmNhbGwoamV4Y2VsLmN1cnJlbnQuZHJhZ2dpbmcuZWxlbWVudC5wYXJlbnROb2RlLmNoaWxkcmVuLCBqZXhjZWwuY3VycmVudC5kcmFnZ2luZy5lbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50LmRyYWdnaW5nLnJvdyAhPSBwb3NpdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQubW92ZVJvdyhqZXhjZWwuY3VycmVudC5kcmFnZ2luZy5yb3csIHBvc2l0aW9uLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5kcmFnZ2luZy5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2RyYWdnaW5nJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmRyYWdnaW5nID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIENsb3NlIGFueSBjb3JuZXIgc2VsZWN0aW9uXG4gICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQuc2VsZWN0ZWRDb3JuZXIpIHtcbiAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5zZWxlY3RlZENvcm5lciA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgLy8gRGF0YSB0byBiZSBjb3BpZWRcbiAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQuc2VsZWN0aW9uLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gQ29weSBkYXRhXG4gICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmNvcHlEYXRhKGpleGNlbC5jdXJyZW50LnNlbGVjdGlvblswXSwgamV4Y2VsLmN1cnJlbnQuc2VsZWN0aW9uW2pleGNlbC5jdXJyZW50LnNlbGVjdGlvbi5sZW5ndGggLSAxXSk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIHNlbGVjdGlvblxuICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5yZW1vdmVDb3B5U2VsZWN0aW9uKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gQ2xlYXIgYW55IHRpbWUgY29udHJvbFxuICAgIGlmIChqZXhjZWwudGltZUNvbnRyb2wpIHtcbiAgICAgICAgY2xlYXJUaW1lb3V0KGpleGNlbC50aW1lQ29udHJvbCk7XG4gICAgICAgIGpleGNlbC50aW1lQ29udHJvbCA9IG51bGw7XG4gICAgfVxuXG4gICAgLy8gTW91c2UgdXBcbiAgICBqZXhjZWwuaXNNb3VzZUFjdGlvbiA9IGZhbHNlO1xufVxuXG4vLyBNb3VzZSBtb3ZlIGNvbnRyb2xzXG5qZXhjZWwubW91c2VNb3ZlQ29udHJvbHMgPSBmdW5jdGlvbihlKSB7XG4gICAgZSA9IGUgfHwgd2luZG93LmV2ZW50O1xuICAgIGlmIChlLmJ1dHRvbnMpIHtcbiAgICAgICAgdmFyIG1vdXNlQnV0dG9uID0gZS5idXR0b25zO1xuICAgIH0gZWxzZSBpZiAoZS5idXR0b24pIHtcbiAgICAgICAgdmFyIG1vdXNlQnV0dG9uID0gZS5idXR0b247XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIG1vdXNlQnV0dG9uID0gZS53aGljaDtcbiAgICB9XG5cbiAgICBpZiAoISBtb3VzZUJ1dHRvbikge1xuICAgICAgICBqZXhjZWwuaXNNb3VzZUFjdGlvbiA9IGZhbHNlO1xuICAgIH1cblxuICAgIGlmIChqZXhjZWwuY3VycmVudCkge1xuICAgICAgICBpZiAoamV4Y2VsLmlzTW91c2VBY3Rpb24gPT0gdHJ1ZSkge1xuICAgICAgICAgICAgLy8gUmVzaXppbmcgaXMgb25nb2luZ1xuICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50LnJlc2l6aW5nKSB7XG4gICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50LnJlc2l6aW5nLmNvbHVtbikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgd2lkdGggPSBlLnBhZ2VYIC0gamV4Y2VsLmN1cnJlbnQucmVzaXppbmcubW91c2VQb3NpdGlvbjtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQucmVzaXppbmcud2lkdGggKyB3aWR0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ZW1wV2lkdGggPSBqZXhjZWwuY3VycmVudC5yZXNpemluZy53aWR0aCArIHdpZHRoO1xuICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuY29sZ3JvdXBbamV4Y2VsLmN1cnJlbnQucmVzaXppbmcuY29sdW1uXS5zZXRBdHRyaWJ1dGUoJ3dpZHRoJywgdGVtcFdpZHRoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQudXBkYXRlQ29ybmVyUG9zaXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBoZWlnaHQgPSBlLnBhZ2VZIC0gamV4Y2VsLmN1cnJlbnQucmVzaXppbmcubW91c2VQb3NpdGlvbjtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQucmVzaXppbmcuaGVpZ2h0ICsgaGVpZ2h0ID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRlbXBIZWlnaHQgPSBqZXhjZWwuY3VycmVudC5yZXNpemluZy5oZWlnaHQgKyBoZWlnaHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5yb3dzW2pleGNlbC5jdXJyZW50LnJlc2l6aW5nLnJvd10uc2V0QXR0cmlidXRlKCdoZWlnaHQnLCB0ZW1wSGVpZ2h0KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQudXBkYXRlQ29ybmVyUG9zaXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciB4ID0gZS50YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLXgnKTtcbiAgICAgICAgICAgIHZhciB5ID0gZS50YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLXknKTtcbiAgICAgICAgICAgIHZhciByZWN0ID0gZS50YXJnZXQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cbiAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudC5jdXJzb3IpIHtcbiAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5jdXJzb3Iuc3R5bGUuY3Vyc29yID0gJyc7XG4gICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuY3Vyc29yID0gbnVsbDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGUudGFyZ2V0LnBhcmVudE5vZGUucGFyZW50Tm9kZSAmJiBlLnRhcmdldC5wYXJlbnROb2RlLnBhcmVudE5vZGUuY2xhc3NOYW1lKSB7XG4gICAgICAgICAgICAgICAgaWYgKGUudGFyZ2V0LnBhcmVudE5vZGUucGFyZW50Tm9kZS5jbGFzc0xpc3QuY29udGFpbnMoJ3Jlc2l6YWJsZScpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlLnRhcmdldCAmJiB4ICYmICEgeSAmJiAocmVjdC53aWR0aCAtIChlLmNsaWVudFggLSByZWN0LmxlZnQpIDwgNikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmN1cnNvciA9IGUudGFyZ2V0O1xuICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuY3Vyc29yLnN0eWxlLmN1cnNvciA9ICdjb2wtcmVzaXplJztcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlLnRhcmdldCAmJiAhIHggJiYgeSAmJiAocmVjdC5oZWlnaHQgLSAoZS5jbGllbnRZIC0gcmVjdC50b3ApIDwgNikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmN1cnNvciA9IGUudGFyZ2V0O1xuICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuY3Vyc29yLnN0eWxlLmN1cnNvciA9ICdyb3ctcmVzaXplJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChlLnRhcmdldC5wYXJlbnROb2RlLnBhcmVudE5vZGUuY2xhc3NMaXN0LmNvbnRhaW5zKCdkcmFnZ2FibGUnKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXQgJiYgISB4ICYmIHkgJiYgKHJlY3Qud2lkdGggLSAoZS5jbGllbnRYIC0gcmVjdC5sZWZ0KSA8IDYpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5jdXJzb3IgPSBlLnRhcmdldDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmN1cnNvci5zdHlsZS5jdXJzb3IgPSAnbW92ZSc7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZS50YXJnZXQgJiYgeCAmJiAhIHkgJiYgKHJlY3QuaGVpZ2h0IC0gKGUuY2xpZW50WSAtIHJlY3QudG9wKSA8IDYpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5jdXJzb3IgPSBlLnRhcmdldDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmN1cnNvci5zdHlsZS5jdXJzb3IgPSAnbW92ZSc7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmpleGNlbC5tb3VzZU92ZXJDb250cm9scyA9IGZ1bmN0aW9uKGUpIHtcbiAgICBlID0gZSB8fCB3aW5kb3cuZXZlbnQ7XG4gICAgaWYgKGUuYnV0dG9ucykge1xuICAgICAgICB2YXIgbW91c2VCdXR0b24gPSBlLmJ1dHRvbnM7XG4gICAgfSBlbHNlIGlmIChlLmJ1dHRvbikge1xuICAgICAgICB2YXIgbW91c2VCdXR0b24gPSBlLmJ1dHRvbjtcbiAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgbW91c2VCdXR0b24gPSBlLndoaWNoO1xuICAgIH1cblxuICAgIGlmICghIG1vdXNlQnV0dG9uKSB7XG4gICAgICAgIGpleGNlbC5pc01vdXNlQWN0aW9uID0gZmFsc2U7XG4gICAgfVxuXG4gICAgaWYgKGpleGNlbC5jdXJyZW50ICYmIGpleGNlbC5pc01vdXNlQWN0aW9uID09IHRydWUpIHtcbiAgICAgICAgLy8gR2V0IGVsZW1lbnRzXG4gICAgICAgIHZhciBqZXhjZWxUYWJsZSA9IGpleGNlbC5nZXRFbGVtZW50KGUudGFyZ2V0KTtcblxuICAgICAgICBpZiAoamV4Y2VsVGFibGVbMF0pIHtcbiAgICAgICAgICAgIC8vIEF2b2lkIGNyb3NzIHJlZmVyZW5jZVxuICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50ICE9IGpleGNlbFRhYmxlWzBdLmpleGNlbCkge1xuICAgICAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgY29sdW1uSWQgPSBlLnRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEteCcpO1xuICAgICAgICAgICAgdmFyIHJvd0lkID0gZS50YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLXknKTtcblxuICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50LmRyYWdnaW5nKSB7XG4gICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50LmRyYWdnaW5nLmNvbHVtbikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY29sdW1uSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudC5pc0NvbE1lcmdlZChjb2x1bW5JZCkubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignSkVYQ0VMOiBUaGlzIGNvbHVtbiBpcyBwYXJ0IG9mIGEgbWVyZ2VkIGNlbGwuJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgamV4Y2VsLmN1cnJlbnQuaGVhZGVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5oZWFkZXJzW2ldLmNsYXNzTGlzdC5yZW1vdmUoJ2RyYWdnaW5nLWxlZnQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuaGVhZGVyc1tpXS5jbGFzc0xpc3QucmVtb3ZlKCdkcmFnZ2luZy1yaWdodCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudC5kcmFnZ2luZy5jb2x1bW4gPT0gY29sdW1uSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuZHJhZ2dpbmcuZGVzdGluYXRpb24gPSBwYXJzZUludChjb2x1bW5JZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUudGFyZ2V0LmNsaWVudFdpZHRoIC8gMiA+IGUub2Zmc2V0WCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50LmRyYWdnaW5nLmNvbHVtbiA8IGNvbHVtbklkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuZHJhZ2dpbmcuZGVzdGluYXRpb24gPSBwYXJzZUludChjb2x1bW5JZCkgLSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5kcmFnZ2luZy5kZXN0aW5hdGlvbiA9IHBhcnNlSW50KGNvbHVtbklkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmhlYWRlcnNbY29sdW1uSWRdLmNsYXNzTGlzdC5hZGQoJ2RyYWdnaW5nLWxlZnQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudC5kcmFnZ2luZy5jb2x1bW4gPCBjb2x1bW5JZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmRyYWdnaW5nLmRlc3RpbmF0aW9uID0gcGFyc2VJbnQoY29sdW1uSWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5kcmFnZ2luZy5kZXN0aW5hdGlvbiA9IHBhcnNlSW50KGNvbHVtbklkKSArIDE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5oZWFkZXJzW2NvbHVtbklkXS5jbGFzc0xpc3QuYWRkKCdkcmFnZ2luZy1yaWdodCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJvd0lkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQuaXNSb3dNZXJnZWQocm93SWQpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0pFWENFTDogVGhpcyByb3cgaXMgcGFydCBvZiBhIG1lcmdlZCBjZWxsLicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0ID0gKGUudGFyZ2V0LmNsaWVudEhlaWdodCAvIDIgPiBlLm9mZnNldFkpID8gZS50YXJnZXQucGFyZW50Tm9kZS5uZXh0U2libGluZyA6IGUudGFyZ2V0LnBhcmVudE5vZGU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZS50YXJnZXQucGFyZW50Tm9kZS5wYXJlbnROb2RlLmluc2VydEJlZm9yZShqZXhjZWwuY3VycmVudC5kcmFnZ2luZy5lbGVtZW50LCB0YXJnZXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmIChqZXhjZWwuY3VycmVudC5yZXNpemluZykge1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBIZWFkZXIgZm91bmRcbiAgICAgICAgICAgICAgICBpZiAoamV4Y2VsVGFibGVbMV0gPT0gMSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQuc2VsZWN0ZWRIZWFkZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb2x1bW5JZCA9IGUudGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS14Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbyA9IGpleGNlbC5jdXJyZW50LnNlbGVjdGVkSGVhZGVyO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBjb2x1bW5JZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBzZWxlY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnVwZGF0ZVNlbGVjdGlvbkZyb21Db29yZHMobywgMCwgZCwgamV4Y2VsLmN1cnJlbnQub3B0aW9ucy5kYXRhLmxlbmd0aCAtIDEpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gQm9keSBmb3VuZFxuICAgICAgICAgICAgICAgIGlmIChqZXhjZWxUYWJsZVsxXSA9PSAyKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2pleGNlbF9yb3cnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50LnNlbGVjdGVkUm93KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG8gPSBqZXhjZWwuY3VycmVudC5zZWxlY3RlZFJvdztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IHJvd0lkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBzZWxlY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC51cGRhdGVTZWxlY3Rpb25Gcm9tQ29vcmRzKDAsIG8sIGpleGNlbC5jdXJyZW50Lm9wdGlvbnMuZGF0YVswXS5sZW5ndGggLSAxLCBkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIERvIG5vdCBzZWxlY3QgZWR0aW9uIGlzIGluIHByb2dyZXNzXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoISBqZXhjZWwuY3VycmVudC5lZGl0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbHVtbklkICYmIHJvd0lkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudC5zZWxlY3RlZENvcm5lcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQudXBkYXRlQ29weVNlbGVjdGlvbihjb2x1bW5JZCwgcm93SWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50LnNlbGVjdGVkQ2VsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnVwZGF0ZVNlbGVjdGlvbkZyb21Db29yZHMoamV4Y2VsLmN1cnJlbnQuc2VsZWN0ZWRDZWxsWzBdLCBqZXhjZWwuY3VycmVudC5zZWxlY3RlZENlbGxbMV0sIGNvbHVtbklkLCByb3dJZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDbGVhciBhbnkgdGltZSBjb250cm9sXG4gICAgaWYgKGpleGNlbC50aW1lQ29udHJvbCkge1xuICAgICAgICBjbGVhclRpbWVvdXQoamV4Y2VsLnRpbWVDb250cm9sKTtcbiAgICAgICAgamV4Y2VsLnRpbWVDb250cm9sID0gbnVsbDtcbiAgICB9XG59XG5cbi8qKlxuICogRG91YmxlIGNsaWNrIGV2ZW50IGhhbmRsZXI6IGNvbnRyb2xzIHRoZSBkb3VibGUgY2xpY2sgaW4gdGhlIGNvcm5lciwgY2VsbCBlZGl0aW9uIG9yIGNvbHVtbiByZS1vcmRlcmluZy5cbiAqL1xuamV4Y2VsLmRvdWJsZUNsaWNrQ29udHJvbHMgPSBmdW5jdGlvbihlKSB7XG4gICAgLy8gSmV4Y2VsIGlzIHNlbGVjdGVkXG4gICAgaWYgKGpleGNlbC5jdXJyZW50KSB7XG4gICAgICAgIC8vIENvcm5lciBhY3Rpb25cbiAgICAgICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnamV4Y2VsX2Nvcm5lcicpKSB7XG4gICAgICAgICAgICAvLyBBbnkgc2VsZWN0ZWQgY2VsbHNcbiAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudC5oaWdobGlnaHRlZC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgLy8gQ29weSBmcm9tIHRoaXNcbiAgICAgICAgICAgICAgICB2YXIgeDEgPSBqZXhjZWwuY3VycmVudC5oaWdobGlnaHRlZFswXS5nZXRBdHRyaWJ1dGUoJ2RhdGEteCcpO1xuICAgICAgICAgICAgICAgIHZhciB5MSA9IHBhcnNlSW50KGpleGNlbC5jdXJyZW50LmhpZ2hsaWdodGVkW2pleGNlbC5jdXJyZW50LmhpZ2hsaWdodGVkLmxlbmd0aCAtIDFdLmdldEF0dHJpYnV0ZSgnZGF0YS15JykpICsgMTtcbiAgICAgICAgICAgICAgICAvLyBVbnRpbCB0aGlzXG4gICAgICAgICAgICAgICAgdmFyIHgyID0gamV4Y2VsLmN1cnJlbnQuaGlnaGxpZ2h0ZWRbamV4Y2VsLmN1cnJlbnQuaGlnaGxpZ2h0ZWQubGVuZ3RoIC0gMV0uZ2V0QXR0cmlidXRlKCdkYXRhLXgnKTtcbiAgICAgICAgICAgICAgICB2YXIgeTIgPSBqZXhjZWwuY3VycmVudC5yZWNvcmRzLmxlbmd0aCAtIDFcbiAgICAgICAgICAgICAgICAvLyBFeGVjdXRlIGNvcHlcbiAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5jb3B5RGF0YShqZXhjZWwuY3VycmVudC5yZWNvcmRzW3kxXVt4MV0sIGpleGNlbC5jdXJyZW50LnJlY29yZHNbeTJdW3gyXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBHZXQgdGFibGVcbiAgICAgICAgICAgIHZhciBqZXhjZWxUYWJsZSA9IGpleGNlbC5nZXRFbGVtZW50KGUudGFyZ2V0KTtcblxuICAgICAgICAgICAgLy8gRG91YmxlIGNsaWNrIG92ZXIgaGVhZGVyXG4gICAgICAgICAgICBpZiAoamV4Y2VsVGFibGVbMV0gPT0gMSAmJiBqZXhjZWwuY3VycmVudC5vcHRpb25zLmNvbHVtblNvcnRpbmcgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIC8vIENoZWNrIHZhbGlkIGNvbHVtbiBoZWFkZXIgY29vcmRzXG4gICAgICAgICAgICAgICAgdmFyIGNvbHVtbklkID0gZS50YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLXgnKTtcbiAgICAgICAgICAgICAgICBpZiAoY29sdW1uSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQub3JkZXJCeShjb2x1bW5JZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBEb3VibGUgY2xpY2sgb3ZlciBib2R5XG4gICAgICAgICAgICBpZiAoamV4Y2VsVGFibGVbMV0gPT0gMiAmJiBqZXhjZWwuY3VycmVudC5vcHRpb25zLmVkaXRhYmxlID09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBpZiAoISBqZXhjZWwuY3VycmVudC5lZGl0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBnZXRDZWxsQ29vcmRzID0gZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQucGFyZW50Tm9kZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB4ID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2RhdGEteCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB5ID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2RhdGEteScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh4ICYmIHkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxDb29yZHMoZWxlbWVudC5wYXJlbnROb2RlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdmFyIGNlbGwgPSBnZXRDZWxsQ29vcmRzKGUudGFyZ2V0KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNlbGwgJiYgY2VsbC5jbGFzc0xpc3QuY29udGFpbnMoJ2hpZ2hsaWdodCcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5vcGVuRWRpdG9yKGNlbGwpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuXG5qZXhjZWwuY29weUNvbnRyb2xzID0gZnVuY3Rpb24oZSkge1xuICAgIGlmIChqZXhjZWwuY3VycmVudCAmJiBqZXhjZWwuY29weUNvbnRyb2xzLmVuYWJsZWQpIHtcbiAgICAgICAgaWYgKCEgamV4Y2VsLmN1cnJlbnQuZWRpdGlvbikge1xuICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuY29weSh0cnVlKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuamV4Y2VsLmN1dENvbnRyb2xzID0gZnVuY3Rpb24oZSkge1xuICAgIGlmIChqZXhjZWwuY3VycmVudCkge1xuICAgICAgICBpZiAoISBqZXhjZWwuY3VycmVudC5lZGl0aW9uKSB7XG4gICAgICAgICAgICBqZXhjZWwuY3VycmVudC5jb3B5KHRydWUpO1xuICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50Lm9wdGlvbnMuZWRpdGFibGUgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnNldFZhbHVlKGpleGNlbC5jdXJyZW50LmhpZ2hsaWdodGVkLCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmpleGNlbC5wYXN0ZUNvbnRyb2xzID0gZnVuY3Rpb24oZSkge1xuICAgIGlmIChqZXhjZWwuY3VycmVudCAmJiBqZXhjZWwuY3VycmVudC5zZWxlY3RlZENlbGwpIHtcbiAgICAgICAgaWYgKCEgamV4Y2VsLmN1cnJlbnQuZWRpdGlvbikge1xuICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50Lm9wdGlvbnMuZWRpdGFibGUgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGlmIChlICYmIGUuY2xpcGJvYXJkRGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5wYXN0ZShqZXhjZWwuY3VycmVudC5zZWxlY3RlZENlbGxbMF0sIGpleGNlbC5jdXJyZW50LnNlbGVjdGVkQ2VsbFsxXSwgZS5jbGlwYm9hcmREYXRhLmdldERhdGEoJ3RleHQnKSk7XG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHdpbmRvdy5jbGlwYm9hcmREYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnBhc3RlKGpleGNlbC5jdXJyZW50LnNlbGVjdGVkQ2VsbFswXSwgamV4Y2VsLmN1cnJlbnQuc2VsZWN0ZWRDZWxsWzFdLCB3aW5kb3cuY2xpcGJvYXJkRGF0YS5nZXREYXRhKCd0ZXh0JykpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cblxuamV4Y2VsLmNvbnRleHRNZW51Q29udHJvbHMgPSBmdW5jdGlvbihlKSB7XG4gICAgZSA9IGUgfHwgd2luZG93LmV2ZW50O1xuICAgIGlmIChcImJ1dHRvbnNcIiBpbiBlKSB7XG4gICAgICAgIHZhciBtb3VzZUJ1dHRvbiA9IGUuYnV0dG9ucztcbiAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgbW91c2VCdXR0b24gPSBlLndoaWNoIHx8IGUuYnV0dG9uO1xuICAgIH1cblxuICAgIGlmIChqZXhjZWwuY3VycmVudCkge1xuICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQuZWRpdGlvbikge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9IGVsc2UgaWYgKGpleGNlbC5jdXJyZW50Lm9wdGlvbnMuY29udGV4dE1lbnUpIHtcbiAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmNvbnRleHRNZW51LmNvbnRleHRtZW51LmNsb3NlKCk7XG5cbiAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudCkge1xuICAgICAgICAgICAgICAgIHZhciB4ID0gZS50YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLXgnKTtcbiAgICAgICAgICAgICAgICB2YXIgeSA9IGUudGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS15Jyk7XG5cbiAgICAgICAgICAgICAgICBpZiAoeCB8fCB5KSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFRhYmxlIGZvdW5kXG4gICAgICAgICAgICAgICAgICAgIHZhciBpdGVtcyA9IGpleGNlbC5jdXJyZW50Lm9wdGlvbnMuY29udGV4dE1lbnUoamV4Y2VsLmN1cnJlbnQsIHgsIHksIGUpO1xuICAgICAgICAgICAgICAgICAgICAvLyBUaGUgaWQgaXMgZGVwZW5kaW5nIG9uIGhlYWRlciBhbmQgYm9keVxuICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5jb250ZXh0TWVudS5jb250ZXh0bWVudS5vcGVuKGUsIGl0ZW1zKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gQXZvaWQgdGhlIHJlYWwgb25lXG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmpleGNlbC50b3VjaFN0YXJ0Q29udHJvbHMgPSBmdW5jdGlvbihlKSB7XG4gICAgdmFyIGpleGNlbFRhYmxlID0gamV4Y2VsLmdldEVsZW1lbnQoZS50YXJnZXQpO1xuXG4gICAgaWYgKGpleGNlbFRhYmxlWzBdKSB7XG4gICAgICAgIGlmIChqZXhjZWwuY3VycmVudCAhPSBqZXhjZWxUYWJsZVswXS5qZXhjZWwpIHtcbiAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudCkge1xuICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnJlc2V0U2VsZWN0aW9uKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBqZXhjZWwuY3VycmVudCA9IGpleGNlbFRhYmxlWzBdLmpleGNlbDtcbiAgICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChqZXhjZWwuY3VycmVudCkge1xuICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQucmVzZXRTZWxlY3Rpb24oKTtcbiAgICAgICAgICAgIGpleGNlbC5jdXJyZW50ID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlmIChqZXhjZWwuY3VycmVudCkge1xuICAgICAgICBpZiAoISBqZXhjZWwuY3VycmVudC5lZGl0aW9uKSB7XG4gICAgICAgICAgICB2YXIgY29sdW1uSWQgPSBlLnRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEteCcpO1xuICAgICAgICAgICAgdmFyIHJvd0lkID0gZS50YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLXknKTtcblxuICAgICAgICAgICAgaWYgKGNvbHVtbklkICYmIHJvd0lkKSB7XG4gICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQudXBkYXRlU2VsZWN0aW9uRnJvbUNvb3Jkcyhjb2x1bW5JZCwgcm93SWQpO1xuXG4gICAgICAgICAgICAgICAgamV4Y2VsLnRpbWVDb250cm9sID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gS2VlcCB0ZW1wb3JhcnkgcmVmZXJlbmNlIHRvIHRoZSBlbGVtZW50XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50Lm9wdGlvbnMuY29sdW1uc1tjb2x1bW5JZF0udHlwZSA9PSAnY29sb3InKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC50bXBFbGVtZW50ID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwudG1wRWxlbWVudCA9IGUudGFyZ2V0O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5vcGVuRWRpdG9yKGUudGFyZ2V0LCBmYWxzZSwgZSk7XG4gICAgICAgICAgICAgICAgfSwgNTAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cblxuamV4Y2VsLnRvdWNoRW5kQ29udHJvbHMgPSBmdW5jdGlvbihlKSB7XG4gICAgLy8gQ2xlYXIgYW55IHRpbWUgY29udHJvbFxuICAgIGlmIChqZXhjZWwudGltZUNvbnRyb2wpIHtcbiAgICAgICAgY2xlYXJUaW1lb3V0KGpleGNlbC50aW1lQ29udHJvbCk7XG4gICAgICAgIGpleGNlbC50aW1lQ29udHJvbCA9IG51bGw7XG4gICAgICAgIC8vIEVsZW1lbnRcclxuICAgICAgICBpZiAoamV4Y2VsLnRtcEVsZW1lbnQgJiYgamV4Y2VsLnRtcEVsZW1lbnQuY2hpbGRyZW5bMF0udGFnTmFtZSA9PSAnSU5QVVQnKSB7XHJcbiAgICAgICAgICAgIGpleGNlbC50bXBFbGVtZW50LmNoaWxkcmVuWzBdLmZvY3VzKCk7XHJcbiAgICAgICAgfVxuICAgICAgICBqZXhjZWwudG1wRWxlbWVudCA9IG51bGw7XG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICogSmV4Y2VsIGV4dGVuc2lvbnNcclxuICovXHJcblxyXG5qZXhjZWwuY3JlYXRlVGFicyA9IGZ1bmN0aW9uKHRhYnMsIHJlc3VsdCkge1xyXG4gICAgLy8gQ3JlYXRlIHRhYiBjb250YWluZXJcclxuICAgIHRhYnMuaW5uZXJIVE1MID0gJyc7XHJcbiAgICB0YWJzLmNsYXNzTGlzdC5hZGQoJ2pleGNlbF90YWJzJyk7XHJcbiAgICB2YXIgc3ByZWFkc2hlZXQgPSBbXVxyXG4gICAgdmFyIGxpbmsgPSBbXTtcclxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVzdWx0Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgLy8gU3ByZWFkc2hlZXQgY29udGFpbmVyXHJcbiAgICAgICAgc3ByZWFkc2hlZXRbaV0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICBzcHJlYWRzaGVldFtpXS5jbGFzc0xpc3QuYWRkKCdqZXhjZWxfdGFiJyk7XHJcbiAgICAgICAgLy8gVGFiIGxpbmtcclxuICAgICAgICBsaW5rW2ldID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgbGlua1tpXS5jbGFzc0xpc3QuYWRkKCdqZXhjZWxfdGFiX2xpbmsnKTtcclxuICAgICAgICBsaW5rW2ldLnNldEF0dHJpYnV0ZSgnZGF0YS1zcHJlYWRzaGVldCcsIGkpO1xyXG4gICAgICAgIGxpbmtbaV0uaW5uZXJIVE1MID0gcmVzdWx0W2ldLnNoZWV0TmFtZTtcclxuICAgICAgICBsaW5rW2ldLm9uY2xpY2sgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzcHJlYWRzaGVldC5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgc3ByZWFkc2hlZXRbal0uc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICAgICAgICAgICAgICAgIGxpbmtbal0uY2xhc3NMaXN0LnJlbW92ZSgnc2VsZWN0ZWQnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgaSA9IHRoaXMuZ2V0QXR0cmlidXRlKCdkYXRhLXNwcmVhZHNoZWV0Jyk7XHJcbiAgICAgICAgICAgIHNwcmVhZHNoZWV0W2ldLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xyXG4gICAgICAgICAgICBsaW5rW2ldLmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGVkJylcclxuICAgICAgICB9XHJcbiAgICAgICAgdGFicy5hcHBlbmRDaGlsZChsaW5rW2ldKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBBcHBlbmQgc3ByZWFkc2hlZXRcclxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3ByZWFkc2hlZXQubGVuZ3RoIC0gMTsgaSsrKSB7XHJcbiAgICAgICAgdGFicy5hcHBlbmRDaGlsZChzcHJlYWRzaGVldFtpXSk7XHJcbiAgICAgICAgamV4Y2VsKHNwcmVhZHNoZWV0W2ldLCByZXN1bHRbaV0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEZpcnN0IHRhYlxyXG4gICAgc3ByZWFkc2hlZXRbMF0uc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XHJcbiAgICBsaW5rWzBdLmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGVkJylcclxufVxyXG5cclxuamV4Y2VsLmZyb21TcHJlYWRzaGVldCA9IGZ1bmN0aW9uKGZpbGUsIF9fY2FsbGJhY2spIHtcclxuICAgIHZhciBjb252ZXJ0ID0gZnVuY3Rpb24od29ya2Jvb2spIHtcclxuICAgICAgICB2YXIgc3ByZWFkc2hlZXRzID0gW107XHJcbiAgICAgICAgd29ya2Jvb2suU2hlZXROYW1lcy5mb3JFYWNoKGZ1bmN0aW9uKHNoZWV0TmFtZSkge1xyXG4gICAgICAgICAgICB2YXIgc3ByZWFkc2hlZXQgPSB7fTtcclxuICAgICAgICAgICAgc3ByZWFkc2hlZXQucm93cyA9IFtdO1xyXG4gICAgICAgICAgICBzcHJlYWRzaGVldC5jb2x1bW5zID0gW107XHJcbiAgICAgICAgICAgIHNwcmVhZHNoZWV0LmRhdGEgPSBbXTtcclxuICAgICAgICAgICAgc3ByZWFkc2hlZXQuc3R5bGUgPSB7fTtcclxuICAgICAgICAgICAgc3ByZWFkc2hlZXQuc2hlZXROYW1lID0gc2hlZXROYW1lO1xyXG5cclxuICAgICAgICAgICAgLy8gQ29sdW1uIHdpZHRoc1xyXG4gICAgICAgICAgICB2YXIgdGVtcCA9IHdvcmtib29rLlNoZWV0c1tzaGVldE5hbWVdWychY29scyddO1xyXG4gICAgICAgICAgICBpZiAodGVtcCAmJiB0ZW1wLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0ZW1wLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3ByZWFkc2hlZXQuY29sdW1uc1tpXSA9IHt9O1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0ZW1wW2ldICYmIHRlbXBbaV0ud3B4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNwcmVhZHNoZWV0LmNvbHVtbnNbaV0ud2lkdGggPSB0ZW1wW2ldLndweCArICdweCc7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIFJvd3MgaGVpZ2h0c1xyXG4gICAgICAgICAgICB2YXIgdGVtcCA9IHdvcmtib29rLlNoZWV0c1tzaGVldE5hbWVdWychcm93cyddO1xyXG4gICAgICAgICAgICBpZiAodGVtcCAmJiB0ZW1wLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0ZW1wLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRlbXBbaV0gJiYgdGVtcFtpXS5ocHgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3ByZWFkc2hlZXQucm93c1tpXSA9IHt9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzcHJlYWRzaGVldC5yb3dzW2ldLmhlaWdodCA9IHRlbXBbaV0uaHB4ICsgJ3B4JztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gTWVyZ2UgY2VsbHNcclxuICAgICAgICAgICAgdmFyIHRlbXAgPSB3b3JrYm9vay5TaGVldHNbc2hlZXROYW1lXVsnIW1lcmdlcyddO1xyXG4gICAgICAgICAgICBpZiAodGVtcCAmJiB0ZW1wLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIHNwcmVhZHNoZWV0Lm1lcmdlQ2VsbHMgPSBbXTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGVtcC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB4MSA9IHRlbXBbaV0ucy5jO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB5MSA9IHRlbXBbaV0ucy5yO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB4MiA9IHRlbXBbaV0uZS5jO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB5MiA9IHRlbXBbaV0uZS5yO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBrZXkgPSBqZXhjZWwuZ2V0Q29sdW1uTmFtZUZyb21JZChbeDEseTFdKTtcclxuICAgICAgICAgICAgICAgICAgICBzcHJlYWRzaGVldC5tZXJnZUNlbGxzW2tleV0gPSBbIHgyLXgxKzEsIHkyLXkxKzEgXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBEYXRhIGNvbnRhaW5lclxyXG4gICAgICAgICAgICB2YXIgbWF4X3ggPSAwO1xyXG4gICAgICAgICAgICB2YXIgbWF4X3kgPSAwO1xyXG4gICAgICAgICAgICB2YXIgdGVtcCA9IE9iamVjdC5rZXlzKHdvcmtib29rLlNoZWV0c1tzaGVldE5hbWVdKTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0ZW1wLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGVtcFtpXS5zdWJzdHIoMCwxKSAhPSAnIScpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY2VsbCA9IHdvcmtib29rLlNoZWV0c1tzaGVldE5hbWVdW3RlbXBbaV1dO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpbmZvID0gamV4Y2VsLmdldElkRnJvbUNvbHVtbk5hbWUodGVtcFtpXSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEgc3ByZWFkc2hlZXQuZGF0YVtpbmZvWzFdXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzcHJlYWRzaGVldC5kYXRhW2luZm9bMV1dID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHNwcmVhZHNoZWV0LmRhdGFbaW5mb1sxXV1baW5mb1swXV0gPSBjZWxsLmYgPyAnPScgKyBjZWxsLmYgOiBjZWxsLnc7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1heF94IDwgaW5mb1swXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhfeCA9IGluZm9bMF07XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChtYXhfeSA8IGluZm9bMV0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWF4X3kgPSBpbmZvWzFdO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAvLyBTdHlsZVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjZWxsLnN0eWxlICYmIE9iamVjdC5rZXlzKGNlbGwuc3R5bGUpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3ByZWFkc2hlZXQuc3R5bGVbdGVtcFtpXV0gPSBjZWxsLnN0eWxlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2VsbC5zICYmIGNlbGwucy5mZ0NvbG9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzcHJlYWRzaGVldC5zdHlsZVt0ZW1wW2ldXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ByZWFkc2hlZXQuc3R5bGVbdGVtcFtpXV0gKz0gJzsnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNwcmVhZHNoZWV0LnN0eWxlW3RlbXBbaV1dICs9ICdiYWNrZ3JvdW5kLWNvbG9yOiMnICsgY2VsbC5zLmZnQ29sb3IucmdiO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgbnVtQ29sdW1ucyA9IHNwcmVhZHNoZWV0LmNvbHVtbnM7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDw9IG1heF95OyBqKyspIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDw9IG1heF94OyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoISBzcHJlYWRzaGVldC5kYXRhW2pdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNwcmVhZHNoZWV0LmRhdGFbal0gPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEgc3ByZWFkc2hlZXQuZGF0YVtqXVtpXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobnVtQ29sdW1ucyA8IGkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwcmVhZHNoZWV0LmRhdGFbal1baV0gPSAnJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzcHJlYWRzaGVldHMucHVzaChzcHJlYWRzaGVldCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiBzcHJlYWRzaGVldHM7XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIG9SZXE7XHJcbiAgICBvUmVxID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XHJcbiAgICBvUmVxLm9wZW4oXCJHRVRcIiwgZmlsZSwgdHJ1ZSk7XHJcblxyXG4gICAgaWYodHlwZW9mIFVpbnQ4QXJyYXkgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgb1JlcS5yZXNwb25zZVR5cGUgPSBcImFycmF5YnVmZmVyXCI7XHJcbiAgICAgICAgb1JlcS5vbmxvYWQgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgIHZhciBhcnJheWJ1ZmZlciA9IG9SZXEucmVzcG9uc2U7XHJcbiAgICAgICAgICAgIHZhciBkYXRhID0gbmV3IFVpbnQ4QXJyYXkoYXJyYXlidWZmZXIpO1xyXG4gICAgICAgICAgICB2YXIgd2IgPSBYTFNYLnJlYWQoZGF0YSwge3R5cGU6XCJhcnJheVwiLCBjZWxsRm9ybXVsYTp0cnVlLCBjZWxsU3R5bGVzOnRydWUgfSk7XHJcbiAgICAgICAgICAgIF9fY2FsbGJhY2soY29udmVydCh3YikpXHJcbiAgICAgICAgfTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgb1JlcS5zZXRSZXF1ZXN0SGVhZGVyKFwiQWNjZXB0LUNoYXJzZXRcIiwgXCJ4LXVzZXItZGVmaW5lZFwiKTsgIFxyXG4gICAgICAgIG9SZXEub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKSB7IGlmKG9SZXEucmVhZHlTdGF0ZSA9PSA0ICYmIG9SZXEuc3RhdHVzID09IDIwMCkge1xyXG4gICAgICAgICAgICB2YXIgZmYgPSBjb252ZXJ0UmVzcG9uc2VCb2R5VG9UZXh0KG9SZXEucmVzcG9uc2VCb2R5KTtcclxuICAgICAgICAgICAgdmFyIHdiID0gWExTWC5yZWFkKGZmLCB7dHlwZTpcImJpbmFyeVwiLCBjZWxsRm9ybXVsYTp0cnVlLCBjZWxsU3R5bGVzOnRydWUgfSk7XHJcbiAgICAgICAgICAgIF9fY2FsbGJhY2soY29udmVydCh3YikpXHJcbiAgICAgICAgfX07XHJcbiAgICB9XHJcblxyXG4gICAgb1JlcS5zZW5kKCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBWYWxpZCBpbnRlcm5hdGlvbmFsIGxldHRlclxyXG4gKi9cclxuXHJcbmpleGNlbC52YWxpZExldHRlciA9IGZ1bmN0aW9uICh0ZXh0KSB7XHJcbiAgICB2YXIgcmVnZXggPSAvKFtcXHUwMDQxLVxcdTAwNUFcXHUwMDYxLVxcdTAwN0FcXHUwMEFBXFx1MDBCNVxcdTAwQkFcXHUwMEMwLVxcdTAwRDZcXHUwMEQ4LVxcdTAwRjZcXHUwMEY4LVxcdTAyQzFcXHUwMkM2LVxcdTAyRDFcXHUwMkUwLVxcdTAyRTRcXHUwMkVDXFx1MDJFRVxcdTAzNzAtXFx1MDM3NFxcdTAzNzZcXHUwMzc3XFx1MDM3QS1cXHUwMzdEXFx1MDM4NlxcdTAzODgtXFx1MDM4QVxcdTAzOENcXHUwMzhFLVxcdTAzQTFcXHUwM0EzLVxcdTAzRjVcXHUwM0Y3LVxcdTA0ODFcXHUwNDhBLVxcdTA1MjdcXHUwNTMxLVxcdTA1NTZcXHUwNTU5XFx1MDU2MS1cXHUwNTg3XFx1MDVEMC1cXHUwNUVBXFx1MDVGMC1cXHUwNUYyXFx1MDYyMC1cXHUwNjRBXFx1MDY2RVxcdTA2NkZcXHUwNjcxLVxcdTA2RDNcXHUwNkQ1XFx1MDZFNVxcdTA2RTZcXHUwNkVFXFx1MDZFRlxcdTA2RkEtXFx1MDZGQ1xcdTA2RkZcXHUwNzEwXFx1MDcxMi1cXHUwNzJGXFx1MDc0RC1cXHUwN0E1XFx1MDdCMVxcdTA3Q0EtXFx1MDdFQVxcdTA3RjRcXHUwN0Y1XFx1MDdGQVxcdTA4MDAtXFx1MDgxNVxcdTA4MUFcXHUwODI0XFx1MDgyOFxcdTA4NDAtXFx1MDg1OFxcdTA4QTBcXHUwOEEyLVxcdTA4QUNcXHUwOTA0LVxcdTA5MzlcXHUwOTNEXFx1MDk1MFxcdTA5NTgtXFx1MDk2MVxcdTA5NzEtXFx1MDk3N1xcdTA5NzktXFx1MDk3RlxcdTA5ODUtXFx1MDk4Q1xcdTA5OEZcXHUwOTkwXFx1MDk5My1cXHUwOUE4XFx1MDlBQS1cXHUwOUIwXFx1MDlCMlxcdTA5QjYtXFx1MDlCOVxcdTA5QkRcXHUwOUNFXFx1MDlEQ1xcdTA5RERcXHUwOURGLVxcdTA5RTFcXHUwOUYwXFx1MDlGMVxcdTBBMDUtXFx1MEEwQVxcdTBBMEZcXHUwQTEwXFx1MEExMy1cXHUwQTI4XFx1MEEyQS1cXHUwQTMwXFx1MEEzMlxcdTBBMzNcXHUwQTM1XFx1MEEzNlxcdTBBMzhcXHUwQTM5XFx1MEE1OS1cXHUwQTVDXFx1MEE1RVxcdTBBNzItXFx1MEE3NFxcdTBBODUtXFx1MEE4RFxcdTBBOEYtXFx1MEE5MVxcdTBBOTMtXFx1MEFBOFxcdTBBQUEtXFx1MEFCMFxcdTBBQjJcXHUwQUIzXFx1MEFCNS1cXHUwQUI5XFx1MEFCRFxcdTBBRDBcXHUwQUUwXFx1MEFFMVxcdTBCMDUtXFx1MEIwQ1xcdTBCMEZcXHUwQjEwXFx1MEIxMy1cXHUwQjI4XFx1MEIyQS1cXHUwQjMwXFx1MEIzMlxcdTBCMzNcXHUwQjM1LVxcdTBCMzlcXHUwQjNEXFx1MEI1Q1xcdTBCNURcXHUwQjVGLVxcdTBCNjFcXHUwQjcxXFx1MEI4M1xcdTBCODUtXFx1MEI4QVxcdTBCOEUtXFx1MEI5MFxcdTBCOTItXFx1MEI5NVxcdTBCOTlcXHUwQjlBXFx1MEI5Q1xcdTBCOUVcXHUwQjlGXFx1MEJBM1xcdTBCQTRcXHUwQkE4LVxcdTBCQUFcXHUwQkFFLVxcdTBCQjlcXHUwQkQwXFx1MEMwNS1cXHUwQzBDXFx1MEMwRS1cXHUwQzEwXFx1MEMxMi1cXHUwQzI4XFx1MEMyQS1cXHUwQzMzXFx1MEMzNS1cXHUwQzM5XFx1MEMzRFxcdTBDNThcXHUwQzU5XFx1MEM2MFxcdTBDNjFcXHUwQzg1LVxcdTBDOENcXHUwQzhFLVxcdTBDOTBcXHUwQzkyLVxcdTBDQThcXHUwQ0FBLVxcdTBDQjNcXHUwQ0I1LVxcdTBDQjlcXHUwQ0JEXFx1MENERVxcdTBDRTBcXHUwQ0UxXFx1MENGMVxcdTBDRjJcXHUwRDA1LVxcdTBEMENcXHUwRDBFLVxcdTBEMTBcXHUwRDEyLVxcdTBEM0FcXHUwRDNEXFx1MEQ0RVxcdTBENjBcXHUwRDYxXFx1MEQ3QS1cXHUwRDdGXFx1MEQ4NS1cXHUwRDk2XFx1MEQ5QS1cXHUwREIxXFx1MERCMy1cXHUwREJCXFx1MERCRFxcdTBEQzAtXFx1MERDNlxcdTBFMDEtXFx1MEUzMFxcdTBFMzJcXHUwRTMzXFx1MEU0MC1cXHUwRTQ2XFx1MEU4MVxcdTBFODJcXHUwRTg0XFx1MEU4N1xcdTBFODhcXHUwRThBXFx1MEU4RFxcdTBFOTQtXFx1MEU5N1xcdTBFOTktXFx1MEU5RlxcdTBFQTEtXFx1MEVBM1xcdTBFQTVcXHUwRUE3XFx1MEVBQVxcdTBFQUJcXHUwRUFELVxcdTBFQjBcXHUwRUIyXFx1MEVCM1xcdTBFQkRcXHUwRUMwLVxcdTBFQzRcXHUwRUM2XFx1MEVEQy1cXHUwRURGXFx1MEYwMFxcdTBGNDAtXFx1MEY0N1xcdTBGNDktXFx1MEY2Q1xcdTBGODgtXFx1MEY4Q1xcdTEwMDAtXFx1MTAyQVxcdTEwM0ZcXHUxMDUwLVxcdTEwNTVcXHUxMDVBLVxcdTEwNURcXHUxMDYxXFx1MTA2NVxcdTEwNjZcXHUxMDZFLVxcdTEwNzBcXHUxMDc1LVxcdTEwODFcXHUxMDhFXFx1MTBBMC1cXHUxMEM1XFx1MTBDN1xcdTEwQ0RcXHUxMEQwLVxcdTEwRkFcXHUxMEZDLVxcdTEyNDhcXHUxMjRBLVxcdTEyNERcXHUxMjUwLVxcdTEyNTZcXHUxMjU4XFx1MTI1QS1cXHUxMjVEXFx1MTI2MC1cXHUxMjg4XFx1MTI4QS1cXHUxMjhEXFx1MTI5MC1cXHUxMkIwXFx1MTJCMi1cXHUxMkI1XFx1MTJCOC1cXHUxMkJFXFx1MTJDMFxcdTEyQzItXFx1MTJDNVxcdTEyQzgtXFx1MTJENlxcdTEyRDgtXFx1MTMxMFxcdTEzMTItXFx1MTMxNVxcdTEzMTgtXFx1MTM1QVxcdTEzODAtXFx1MTM4RlxcdTEzQTAtXFx1MTNGNFxcdTE0MDEtXFx1MTY2Q1xcdTE2NkYtXFx1MTY3RlxcdTE2ODEtXFx1MTY5QVxcdTE2QTAtXFx1MTZFQVxcdTE3MDAtXFx1MTcwQ1xcdTE3MEUtXFx1MTcxMVxcdTE3MjAtXFx1MTczMVxcdTE3NDAtXFx1MTc1MVxcdTE3NjAtXFx1MTc2Q1xcdTE3NkUtXFx1MTc3MFxcdTE3ODAtXFx1MTdCM1xcdTE3RDdcXHUxN0RDXFx1MTgyMC1cXHUxODc3XFx1MTg4MC1cXHUxOEE4XFx1MThBQVxcdTE4QjAtXFx1MThGNVxcdTE5MDAtXFx1MTkxQ1xcdTE5NTAtXFx1MTk2RFxcdTE5NzAtXFx1MTk3NFxcdTE5ODAtXFx1MTlBQlxcdTE5QzEtXFx1MTlDN1xcdTFBMDAtXFx1MUExNlxcdTFBMjAtXFx1MUE1NFxcdTFBQTdcXHUxQjA1LVxcdTFCMzNcXHUxQjQ1LVxcdTFCNEJcXHUxQjgzLVxcdTFCQTBcXHUxQkFFXFx1MUJBRlxcdTFCQkEtXFx1MUJFNVxcdTFDMDAtXFx1MUMyM1xcdTFDNEQtXFx1MUM0RlxcdTFDNUEtXFx1MUM3RFxcdTFDRTktXFx1MUNFQ1xcdTFDRUUtXFx1MUNGMVxcdTFDRjVcXHUxQ0Y2XFx1MUQwMC1cXHUxREJGXFx1MUUwMC1cXHUxRjE1XFx1MUYxOC1cXHUxRjFEXFx1MUYyMC1cXHUxRjQ1XFx1MUY0OC1cXHUxRjREXFx1MUY1MC1cXHUxRjU3XFx1MUY1OVxcdTFGNUJcXHUxRjVEXFx1MUY1Ri1cXHUxRjdEXFx1MUY4MC1cXHUxRkI0XFx1MUZCNi1cXHUxRkJDXFx1MUZCRVxcdTFGQzItXFx1MUZDNFxcdTFGQzYtXFx1MUZDQ1xcdTFGRDAtXFx1MUZEM1xcdTFGRDYtXFx1MUZEQlxcdTFGRTAtXFx1MUZFQ1xcdTFGRjItXFx1MUZGNFxcdTFGRjYtXFx1MUZGQ1xcdTIwNzFcXHUyMDdGXFx1MjA5MC1cXHUyMDlDXFx1MjEwMlxcdTIxMDdcXHUyMTBBLVxcdTIxMTNcXHUyMTE1XFx1MjExOS1cXHUyMTFEXFx1MjEyNFxcdTIxMjZcXHUyMTI4XFx1MjEyQS1cXHUyMTJEXFx1MjEyRi1cXHUyMTM5XFx1MjEzQy1cXHUyMTNGXFx1MjE0NS1cXHUyMTQ5XFx1MjE0RVxcdTIxODNcXHUyMTg0XFx1MkMwMC1cXHUyQzJFXFx1MkMzMC1cXHUyQzVFXFx1MkM2MC1cXHUyQ0U0XFx1MkNFQi1cXHUyQ0VFXFx1MkNGMlxcdTJDRjNcXHUyRDAwLVxcdTJEMjVcXHUyRDI3XFx1MkQyRFxcdTJEMzAtXFx1MkQ2N1xcdTJENkZcXHUyRDgwLVxcdTJEOTZcXHUyREEwLVxcdTJEQTZcXHUyREE4LVxcdTJEQUVcXHUyREIwLVxcdTJEQjZcXHUyREI4LVxcdTJEQkVcXHUyREMwLVxcdTJEQzZcXHUyREM4LVxcdTJEQ0VcXHUyREQwLVxcdTJERDZcXHUyREQ4LVxcdTJEREVcXHUyRTJGXFx1MzAwNVxcdTMwMDZcXHUzMDMxLVxcdTMwMzVcXHUzMDNCXFx1MzAzQ1xcdTMwNDEtXFx1MzA5NlxcdTMwOUQtXFx1MzA5RlxcdTMwQTEtXFx1MzBGQVxcdTMwRkMtXFx1MzBGRlxcdTMxMDUtXFx1MzEyRFxcdTMxMzEtXFx1MzE4RVxcdTMxQTAtXFx1MzFCQVxcdTMxRjAtXFx1MzFGRlxcdTM0MDAtXFx1NERCNVxcdTRFMDAtXFx1OUZDQ1xcdUEwMDAtXFx1QTQ4Q1xcdUE0RDAtXFx1QTRGRFxcdUE1MDAtXFx1QTYwQ1xcdUE2MTAtXFx1QTYxRlxcdUE2MkFcXHVBNjJCXFx1QTY0MC1cXHVBNjZFXFx1QTY3Ri1cXHVBNjk3XFx1QTZBMC1cXHVBNkU1XFx1QTcxNy1cXHVBNzFGXFx1QTcyMi1cXHVBNzg4XFx1QTc4Qi1cXHVBNzhFXFx1QTc5MC1cXHVBNzkzXFx1QTdBMC1cXHVBN0FBXFx1QTdGOC1cXHVBODAxXFx1QTgwMy1cXHVBODA1XFx1QTgwNy1cXHVBODBBXFx1QTgwQy1cXHVBODIyXFx1QTg0MC1cXHVBODczXFx1QTg4Mi1cXHVBOEIzXFx1QThGMi1cXHVBOEY3XFx1QThGQlxcdUE5MEEtXFx1QTkyNVxcdUE5MzAtXFx1QTk0NlxcdUE5NjAtXFx1QTk3Q1xcdUE5ODQtXFx1QTlCMlxcdUE5Q0ZcXHVBQTAwLVxcdUFBMjhcXHVBQTQwLVxcdUFBNDJcXHVBQTQ0LVxcdUFBNEJcXHVBQTYwLVxcdUFBNzZcXHVBQTdBXFx1QUE4MC1cXHVBQUFGXFx1QUFCMVxcdUFBQjVcXHVBQUI2XFx1QUFCOS1cXHVBQUJEXFx1QUFDMFxcdUFBQzJcXHVBQURCLVxcdUFBRERcXHVBQUUwLVxcdUFBRUFcXHVBQUYyLVxcdUFBRjRcXHVBQjAxLVxcdUFCMDZcXHVBQjA5LVxcdUFCMEVcXHVBQjExLVxcdUFCMTZcXHVBQjIwLVxcdUFCMjZcXHVBQjI4LVxcdUFCMkVcXHVBQkMwLVxcdUFCRTJcXHVBQzAwLVxcdUQ3QTNcXHVEN0IwLVxcdUQ3QzZcXHVEN0NCLVxcdUQ3RkJcXHVGOTAwLVxcdUZBNkRcXHVGQTcwLVxcdUZBRDlcXHVGQjAwLVxcdUZCMDZcXHVGQjEzLVxcdUZCMTdcXHVGQjFEXFx1RkIxRi1cXHVGQjI4XFx1RkIyQS1cXHVGQjM2XFx1RkIzOC1cXHVGQjNDXFx1RkIzRVxcdUZCNDBcXHVGQjQxXFx1RkI0M1xcdUZCNDRcXHVGQjQ2LVxcdUZCQjFcXHVGQkQzLVxcdUZEM0RcXHVGRDUwLVxcdUZEOEZcXHVGRDkyLVxcdUZEQzdcXHVGREYwLVxcdUZERkJcXHVGRTcwLVxcdUZFNzRcXHVGRTc2LVxcdUZFRkNcXHVGRjIxLVxcdUZGM0FcXHVGRjQxLVxcdUZGNUFcXHVGRjY2LVxcdUZGQkVcXHVGRkMyLVxcdUZGQzdcXHVGRkNBLVxcdUZGQ0ZcXHVGRkQyLVxcdUZGRDdcXHVGRkRBLVxcdUZGREMtXFx1MDQwMC1cXHUwNEZGJ10rKS9nO1xyXG4gICAgcmV0dXJuIHRleHQubWF0Y2gocmVnZXgpID8gMSA6IDA7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBIZWxwZXIgaW5qZWN0QXJyYXlcclxuICovXHJcbmpleGNlbC5pbmplY3RBcnJheSA9IGZ1bmN0aW9uKG8sIGlkeCwgYXJyKSB7XHJcbiAgICByZXR1cm4gby5zbGljZSgwLCBpZHgpLmNvbmNhdChhcnIpLmNvbmNhdChvLnNsaWNlKGlkeCkpO1xyXG59XHJcblxyXG4vKipcclxuICogR2V0IGxldHRlciBiYXNlZCBvbiBhIG51bWJlclxyXG4gKiBcclxuICogQHBhcmFtIGludGVnZXIgaVxyXG4gKiBAcmV0dXJuIHN0cmluZyBsZXR0ZXJcclxuICovXHJcbmpleGNlbC5nZXRDb2x1bW5OYW1lID0gZnVuY3Rpb24oaSkge1xyXG4gICAgdmFyIGxldHRlciA9ICcnO1xyXG4gICAgaWYgKGkgPiA3MDEpIHtcclxuICAgICAgICBsZXR0ZXIgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSg2NCArIHBhcnNlSW50KGkgLyA2NzYpKTtcclxuICAgICAgICBsZXR0ZXIgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSg2NCArIHBhcnNlSW50KChpICUgNjc2KSAvIDI2KSk7XHJcbiAgICB9IGVsc2UgaWYgKGkgPiAyNSkge1xyXG4gICAgICAgIGxldHRlciArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDY0ICsgcGFyc2VJbnQoaSAvIDI2KSk7XHJcbiAgICB9XHJcbiAgICBsZXR0ZXIgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSg2NSArIChpICUgMjYpKTtcclxuXHJcbiAgICByZXR1cm4gbGV0dGVyO1xyXG59XHJcblxyXG4vKipcclxuICogQ29udmVydCBleGNlbCBsaWtlIGNvbHVtbiB0byBqZXhjZWwgaWRcclxuICogXHJcbiAqIEBwYXJhbSBzdHJpbmcgaWRcclxuICogQHJldHVybiBzdHJpbmcgaWRcclxuICovXHJcbmpleGNlbC5nZXRJZEZyb21Db2x1bW5OYW1lID0gZnVuY3Rpb24gKGlkLCBhcnIpIHtcclxuICAgIC8vIEdldCB0aGUgbGV0dGVyc1xyXG4gICAgdmFyIHQgPSAvXlthLXpBLVpdKy8uZXhlYyhpZCk7XHJcblxyXG4gICAgaWYgKHQpIHtcclxuICAgICAgICAvLyBCYXNlIDI2IGNhbGN1bGF0aW9uXHJcbiAgICAgICAgdmFyIGNvZGUgPSAwO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdFswXS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBjb2RlICs9IHBhcnNlSW50KHRbMF0uY2hhckNvZGVBdChpKSAtIDY0KSAqIE1hdGgucG93KDI2LCAodFswXS5sZW5ndGggLSAxIC0gaSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb2RlLS07XHJcbiAgICAgICAgLy8gTWFrZSBzdXJlIGpleGNlbCBzdGFydHMgb24gemVyb1xyXG4gICAgICAgIGlmIChjb2RlIDwgMCkge1xyXG4gICAgICAgICAgICBjb2RlID0gMDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIE51bWJlclxyXG4gICAgICAgIHZhciBudW1iZXIgPSBwYXJzZUludCgvWzAtOV0rJC8uZXhlYyhpZCkpO1xyXG4gICAgICAgIGlmIChudW1iZXIgPiAwKSB7XHJcbiAgICAgICAgICAgIG51bWJlci0tO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGFyciA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgIGlkID0gWyBjb2RlLCBudW1iZXIgXTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZCA9IGNvZGUgKyAnLScgKyBudW1iZXI7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBpZDtcclxufVxyXG5cclxuLyoqXHJcbiAqIENvbnZlcnQgamV4Y2VsIGlkIHRvIGV4Y2VsIGxpa2UgY29sdW1uIG5hbWVcclxuICogXHJcbiAqIEBwYXJhbSBzdHJpbmcgaWRcclxuICogQHJldHVybiBzdHJpbmcgaWRcclxuICovXHJcbmpleGNlbC5nZXRDb2x1bW5OYW1lRnJvbUlkID0gZnVuY3Rpb24gKGNlbGxJZCkge1xyXG4gICAgaWYgKCEgQXJyYXkuaXNBcnJheShjZWxsSWQpKSB7XHJcbiAgICAgICAgY2VsbElkID0gY2VsbElkLnNwbGl0KCctJyk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGpleGNlbC5nZXRDb2x1bW5OYW1lKHBhcnNlSW50KGNlbGxJZFswXSkpICsgKHBhcnNlSW50KGNlbGxJZFsxXSkgKyAxKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFZlcmlmeSBlbGVtZW50IGluc2lkZSBqZXhjZWwgdGFibGVcclxuICogXHJcbiAqIEBwYXJhbSBzdHJpbmcgaWRcclxuICogQHJldHVybiBzdHJpbmcgaWRcclxuICovXHJcbmpleGNlbC5nZXRFbGVtZW50ID0gZnVuY3Rpb24oZWxlbWVudCkge1xyXG4gICAgdmFyIGpleGNlbFNlY3Rpb24gPSAwO1xyXG4gICAgdmFyIGpleGNlbEVsZW1lbnQgPSAwO1xyXG5cclxuICAgIGZ1bmN0aW9uIHBhdGggKGVsZW1lbnQpIHtcclxuICAgICAgICBpZiAoZWxlbWVudC5jbGFzc05hbWUpIHtcclxuICAgICAgICAgICAgaWYgKGVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqZXhjZWxfY29udGFpbmVyJykpIHtcclxuICAgICAgICAgICAgICAgIGpleGNlbEVsZW1lbnQgPSBlbGVtZW50O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoZWxlbWVudC50YWdOYW1lID09ICdUSEVBRCcpIHtcclxuICAgICAgICAgICAgamV4Y2VsU2VjdGlvbiA9IDE7XHJcbiAgICAgICAgfSBlbHNlIGlmIChlbGVtZW50LnRhZ05hbWUgPT0gJ1RCT0RZJykge1xyXG4gICAgICAgICAgICBqZXhjZWxTZWN0aW9uID0gMjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChlbGVtZW50LnBhcmVudE5vZGUpIHtcclxuICAgICAgICAgICAgcGF0aChlbGVtZW50LnBhcmVudE5vZGUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwYXRoKGVsZW1lbnQpO1xyXG5cclxuICAgIHJldHVybiBbIGpleGNlbEVsZW1lbnQsIGpleGNlbFNlY3Rpb24gXTtcclxufVxyXG5cclxuamV4Y2VsLmRvdWJsZURpZ2l0Rm9ybWF0ID0gZnVuY3Rpb24odikge1xyXG4gICAgdiA9ICcnK3Y7XHJcbiAgICBpZiAodi5sZW5ndGggPT0gMSkge1xyXG4gICAgICAgIHYgPSAnMCcrdjtcclxuICAgIH1cclxuICAgIHJldHVybiB2O1xyXG59XHJcblxyXG4vKipcclxuICogSnF1ZXJ5IFN1cHBvcnRcclxuICovXHJcbmlmICh0eXBlb2YoalF1ZXJ5KSAhPSAndW5kZWZpbmVkJykge1xyXG4gICAgKGZ1bmN0aW9uKCQpe1xyXG4gICAgICAgICQuZm4uamV4Y2VsID0gZnVuY3Rpb24obWV0aG9kKSB7XHJcbiAgICAgICAgICAgIHZhciBzcHJlYWRzaGVldENvbnRhaW5lciA9ICQodGhpcykuZ2V0KDApO1xyXG4gICAgICAgICAgICBpZiAoISBzcHJlYWRzaGVldENvbnRhaW5lci5qZXhjZWwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBqZXhjZWwoJCh0aGlzKS5nZXQoMCksIGFyZ3VtZW50c1swXSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc3ByZWFkc2hlZXRDb250YWluZXIuamV4Y2VsW21ldGhvZF0uYXBwbHkodGhpcywgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoIGFyZ3VtZW50cywgMSApKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgfSkoalF1ZXJ5KTtcclxufVxyXG5cclxuXHJcbi8vIEJhc2VkIG9uIHN1dG9pa3Ugd29yayAoaHR0cHM6Ly9naXRodWIuY29tL3N1dG9pa3UpXHJcblxyXG52YXIgZXJyb3IgPSAoZnVuY3Rpb24oKSB7XHJcbiAgICB2YXIgZXhwb3J0cyA9IHt9O1xyXG5cclxuICAgIGV4cG9ydHMubmlsID0gbmV3IEVycm9yKCcjTlVMTCEnKTtcclxuICAgIGV4cG9ydHMuZGl2MCA9IG5ldyBFcnJvcignI0RJVi8wIScpO1xyXG4gICAgZXhwb3J0cy52YWx1ZSA9IG5ldyBFcnJvcignI1ZBTFVFIScpO1xyXG4gICAgZXhwb3J0cy5yZWYgPSBuZXcgRXJyb3IoJyNSRUYhJyk7XHJcbiAgICBleHBvcnRzLm5hbWUgPSBuZXcgRXJyb3IoJyNOQU1FPycpO1xyXG4gICAgZXhwb3J0cy5udW0gPSBuZXcgRXJyb3IoJyNOVU0hJyk7XHJcbiAgICBleHBvcnRzLm5hID0gbmV3IEVycm9yKCcjTi9BJyk7XHJcbiAgICBleHBvcnRzLmVycm9yID0gbmV3IEVycm9yKCcjRVJST1IhJyk7XHJcbiAgICBleHBvcnRzLmRhdGEgPSBuZXcgRXJyb3IoJyNHRVRUSU5HX0RBVEEnKTtcclxuXHJcbiAgICByZXR1cm4gZXhwb3J0cztcclxufSkoKTtcclxuXHJcbnZhciB1dGlscyA9IChmdW5jdGlvbigpIHtcclxuICAgIHZhciBleHBvcnRzID0ge307XHJcblxyXG4gICAgZXhwb3J0cy5mbGF0dGVuU2hhbGxvdyA9IGZ1bmN0aW9uKGFycmF5KSB7XHJcbiAgICAgICAgaWYgKCFhcnJheSB8fCAhYXJyYXkucmVkdWNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBhcnJheTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBhcnJheS5yZWR1Y2UoZnVuY3Rpb24oYSwgYikge1xyXG4gICAgICAgICAgICB2YXIgYUlzQXJyYXkgPSBBcnJheS5pc0FycmF5KGEpO1xyXG4gICAgICAgICAgICB2YXIgYklzQXJyYXkgPSBBcnJheS5pc0FycmF5KGIpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGFJc0FycmF5ICYmIGJJc0FycmF5KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYS5jb25jYXQoYik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGFJc0FycmF5KSB7XHJcbiAgICAgICAgICAgICAgICBhLnB1c2goYik7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGJJc0FycmF5KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gWyBhIF0uY29uY2F0KGIpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gWyBhLCBiIF07XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuaXNGbGF0ID0gZnVuY3Rpb24oYXJyYXkpIHtcclxuICAgICAgICBpZiAoIWFycmF5KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyArK2kpIHtcclxuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoYXJyYXlbaV0pKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLmZsYXR0ZW4gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgcmVzdWx0ID0gZXhwb3J0cy5hcmdzVG9BcnJheS5hcHBseShudWxsLCBhcmd1bWVudHMpO1xyXG5cclxuICAgICAgICB3aGlsZSAoIWV4cG9ydHMuaXNGbGF0KHJlc3VsdCkpIHtcclxuICAgICAgICAgICAgcmVzdWx0ID0gZXhwb3J0cy5mbGF0dGVuU2hhbGxvdyhyZXN1bHQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5hcmdzVG9BcnJheSA9IGZ1bmN0aW9uKGFyZ3MpIHtcclxuICAgICAgICB2YXIgcmVzdWx0ID0gW107XHJcblxyXG4gICAgICAgIGV4cG9ydHMuYXJyYXlFYWNoKGFyZ3MsIGZ1bmN0aW9uKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdC5wdXNoKHZhbHVlKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5udW1iZXJzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIHBvc3NpYmxlTnVtYmVycyA9IHRoaXMuZmxhdHRlbi5hcHBseShudWxsLCBhcmd1bWVudHMpO1xyXG4gICAgICAgIHJldHVybiBwb3NzaWJsZU51bWJlcnMuZmlsdGVyKGZ1bmN0aW9uKGVsKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0eXBlb2YgZWwgPT09ICdudW1iZXInO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLmNsZWFuRmxvYXQgPSBmdW5jdGlvbihudW1iZXIpIHtcclxuICAgICAgICB2YXIgcG93ZXIgPSAxZTE0O1xyXG4gICAgICAgIHJldHVybiBNYXRoLnJvdW5kKG51bWJlciAqIHBvd2VyKSAvIHBvd2VyO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLnBhcnNlQm9vbCA9IGZ1bmN0aW9uKGJvb2wpIHtcclxuICAgICAgICBpZiAodHlwZW9mIGJvb2wgPT09ICdib29sZWFuJykge1xyXG4gICAgICAgICAgICByZXR1cm4gYm9vbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChib29sIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGJvb2w7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodHlwZW9mIGJvb2wgPT09ICdudW1iZXInKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBib29sICE9PSAwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHR5cGVvZiBib29sID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICB2YXIgdXAgPSBib29sLnRvVXBwZXJDYXNlKCk7XHJcbiAgICAgICAgICAgIGlmICh1cCA9PT0gJ1RSVUUnKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHVwID09PSAnRkFMU0UnKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChib29sIGluc3RhbmNlb2YgRGF0ZSAmJiAhaXNOYU4oYm9vbCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMucGFyc2VOdW1iZXIgPSBmdW5jdGlvbihzdHJpbmcpIHtcclxuICAgICAgICBpZiAoc3RyaW5nID09PSB1bmRlZmluZWQgfHwgc3RyaW5nID09PSAnJykge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghaXNOYU4oc3RyaW5nKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChzdHJpbmcpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLnBhcnNlTnVtYmVyQXJyYXkgPSBmdW5jdGlvbihhcnIpIHtcclxuICAgICAgICB2YXIgbGVuO1xyXG5cclxuICAgICAgICBpZiAoIWFyciB8fCAobGVuID0gYXJyLmxlbmd0aCkgPT09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIHBhcnNlZDtcclxuXHJcbiAgICAgICAgd2hpbGUgKGxlbi0tKSB7XHJcbiAgICAgICAgICAgIHBhcnNlZCA9IGV4cG9ydHMucGFyc2VOdW1iZXIoYXJyW2xlbl0pO1xyXG4gICAgICAgICAgICBpZiAocGFyc2VkID09PSBlcnJvci52YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBhcnJbbGVuXSA9IHBhcnNlZDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBhcnI7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMucGFyc2VNYXRyaXggPSBmdW5jdGlvbihtYXRyaXgpIHtcclxuICAgICAgICB2YXIgbjtcclxuXHJcbiAgICAgICAgaWYgKCFtYXRyaXggfHwgKG4gPSBtYXRyaXgubGVuZ3RoKSA9PT0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBwbmFycjtcclxuXHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXRyaXgubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgcG5hcnIgPSBleHBvcnRzLnBhcnNlTnVtYmVyQXJyYXkobWF0cml4W2ldKTtcclxuICAgICAgICAgICAgbWF0cml4W2ldID0gcG5hcnI7XHJcblxyXG4gICAgICAgICAgICBpZiAocG5hcnIgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHBuYXJyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gbWF0cml4O1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgZDE5MDAgPSBuZXcgRGF0ZShEYXRlLlVUQygxOTAwLCAwLCAxKSk7XHJcbiAgICBleHBvcnRzLnBhcnNlRGF0ZSA9IGZ1bmN0aW9uKGRhdGUpIHtcclxuICAgICAgICBpZiAoIWlzTmFOKGRhdGUpKSB7XHJcbiAgICAgICAgICAgIGlmIChkYXRlIGluc3RhbmNlb2YgRGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKGRhdGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBkID0gcGFyc2VJbnQoZGF0ZSwgMTApO1xyXG4gICAgICAgICAgICBpZiAoZCA8IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGQgPD0gNjApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRGF0ZShkMTkwMC5nZXRUaW1lKCkgKyAoZCAtIDEpICogODY0MDAwMDApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgRGF0ZShkMTkwMC5nZXRUaW1lKCkgKyAoZCAtIDIpICogODY0MDAwMDApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodHlwZW9mIGRhdGUgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIGRhdGUgPSBuZXcgRGF0ZShkYXRlKTtcclxuICAgICAgICAgICAgaWYgKCFpc05hTihkYXRlKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLnBhcnNlRGF0ZUFycmF5ID0gZnVuY3Rpb24oYXJyKSB7XHJcbiAgICAgICAgdmFyIGxlbiA9IGFyci5sZW5ndGg7XHJcbiAgICAgICAgdmFyIHBhcnNlZDtcclxuICAgICAgICB3aGlsZSAobGVuLS0pIHtcclxuICAgICAgICAgICAgcGFyc2VkID0gdGhpcy5wYXJzZURhdGUoYXJyW2xlbl0pO1xyXG4gICAgICAgICAgICBpZiAocGFyc2VkID09PSBlcnJvci52YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBhcnJbbGVuXSA9IHBhcnNlZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGFycjtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5hbnlJc0Vycm9yID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIG4gPSBhcmd1bWVudHMubGVuZ3RoO1xyXG4gICAgICAgIHdoaWxlIChuLS0pIHtcclxuICAgICAgICAgICAgaWYgKGFyZ3VtZW50c1tuXSBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuYXJyYXlWYWx1ZXNUb051bWJlcnMgPSBmdW5jdGlvbihhcnIpIHtcclxuICAgICAgICB2YXIgbiA9IGFyci5sZW5ndGg7XHJcbiAgICAgICAgdmFyIGVsO1xyXG4gICAgICAgIHdoaWxlIChuLS0pIHtcclxuICAgICAgICAgICAgZWwgPSBhcnJbbl07XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgZWwgPT09ICdudW1iZXInKSB7XHJcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoZWwgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgIGFycltuXSA9IDE7XHJcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoZWwgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICBhcnJbbl0gPSAwO1xyXG4gICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBlbCA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgIHZhciBudW1iZXIgPSB0aGlzLnBhcnNlTnVtYmVyKGVsKTtcclxuICAgICAgICAgICAgICAgIGlmIChudW1iZXIgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIGFycltuXSA9IDA7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGFycltuXSA9IG51bWJlcjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gYXJyO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLnJlc3QgPSBmdW5jdGlvbihhcnJheSwgaWR4KSB7XHJcbiAgICAgICAgaWR4ID0gaWR4IHx8IDE7XHJcbiAgICAgICAgaWYgKCFhcnJheSB8fCB0eXBlb2YgYXJyYXkuc2xpY2UgIT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGFycmF5O1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gYXJyYXkuc2xpY2UoaWR4KTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5pbml0aWFsID0gZnVuY3Rpb24oYXJyYXksIGlkeCkge1xyXG4gICAgICAgIGlkeCA9IGlkeCB8fCAxO1xyXG4gICAgICAgIGlmICghYXJyYXkgfHwgdHlwZW9mIGFycmF5LnNsaWNlICE9PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBhcnJheTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGFycmF5LnNsaWNlKDAsIGFycmF5Lmxlbmd0aCAtIGlkeCk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuYXJyYXlFYWNoID0gZnVuY3Rpb24oYXJyYXksIGl0ZXJhdGVlKSB7XHJcbiAgICAgICAgdmFyIGluZGV4ID0gLTEsIGxlbmd0aCA9IGFycmF5Lmxlbmd0aDtcclxuXHJcbiAgICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHtcclxuICAgICAgICAgICAgaWYgKGl0ZXJhdGVlKGFycmF5W2luZGV4XSwgaW5kZXgsIGFycmF5KSA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gYXJyYXk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMudHJhbnNwb3NlID0gZnVuY3Rpb24obWF0cml4KSB7XHJcbiAgICAgICAgaWYgKCFtYXRyaXgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG1hdHJpeFswXS5tYXAoZnVuY3Rpb24oY29sLCBpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBtYXRyaXgubWFwKGZ1bmN0aW9uKHJvdykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJvd1tpXTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiBleHBvcnRzO1xyXG59KSgpO1xyXG5cclxuamV4Y2VsLm1ldGhvZHMgPSB7fTtcclxuXHJcbmpleGNlbC5tZXRob2RzLmRhdGV0aW1lID0gKGZ1bmN0aW9uKCkge1xyXG4gICAgdmFyIGV4cG9ydHMgPSB7fTtcclxuXHJcbiAgICB2YXIgZDE5MDAgPSBuZXcgRGF0ZSgxOTAwLCAwLCAxKTtcclxuICAgIHZhciBXRUVLX1NUQVJUUyA9IFtcclxuICAgICAgICB1bmRlZmluZWQsXHJcbiAgICAgICAgMCxcclxuICAgICAgICAxLFxyXG4gICAgICAgIHVuZGVmaW5lZCxcclxuICAgICAgICB1bmRlZmluZWQsXHJcbiAgICAgICAgdW5kZWZpbmVkLFxyXG4gICAgICAgIHVuZGVmaW5lZCxcclxuICAgICAgICB1bmRlZmluZWQsXHJcbiAgICAgICAgdW5kZWZpbmVkLFxyXG4gICAgICAgIHVuZGVmaW5lZCxcclxuICAgICAgICB1bmRlZmluZWQsXHJcbiAgICAgICAgdW5kZWZpbmVkLFxyXG4gICAgICAgIDEsXHJcbiAgICAgICAgMixcclxuICAgICAgICAzLFxyXG4gICAgICAgIDQsXHJcbiAgICAgICAgNSxcclxuICAgICAgICA2LFxyXG4gICAgICAgIDBcclxuICAgIF07XHJcbiAgICB2YXIgV0VFS19UWVBFUyA9IFtcclxuICAgICAgICBbXSxcclxuICAgICAgICBbMSwgMiwgMywgNCwgNSwgNiwgN10sXHJcbiAgICAgICAgWzcsIDEsIDIsIDMsIDQsIDUsIDZdLFxyXG4gICAgICAgIFs2LCAwLCAxLCAyLCAzLCA0LCA1XSxcclxuICAgICAgICBbXSxcclxuICAgICAgICBbXSxcclxuICAgICAgICBbXSxcclxuICAgICAgICBbXSxcclxuICAgICAgICBbXSxcclxuICAgICAgICBbXSxcclxuICAgICAgICBbXSxcclxuICAgICAgICBbNywgMSwgMiwgMywgNCwgNSwgNl0sXHJcbiAgICAgICAgWzYsIDcsIDEsIDIsIDMsIDQsIDVdLFxyXG4gICAgICAgIFs1LCA2LCA3LCAxLCAyLCAzLCA0XSxcclxuICAgICAgICBbNCwgNSwgNiwgNywgMSwgMiwgM10sXHJcbiAgICAgICAgWzMsIDQsIDUsIDYsIDcsIDEsIDJdLFxyXG4gICAgICAgIFsyLCAzLCA0LCA1LCA2LCA3LCAxXSxcclxuICAgICAgICBbMSwgMiwgMywgNCwgNSwgNiwgN11cclxuICAgIF07XHJcbiAgICB2YXIgV0VFS0VORF9UWVBFUyA9IFtcclxuICAgICAgICBbXSxcclxuICAgICAgICBbNiwgMF0sXHJcbiAgICAgICAgWzAsIDFdLFxyXG4gICAgICAgIFsxLCAyXSxcclxuICAgICAgICBbMiwgM10sXHJcbiAgICAgICAgWzMsIDRdLFxyXG4gICAgICAgIFs0LCA1XSxcclxuICAgICAgICBbNSwgNl0sXHJcbiAgICAgICAgdW5kZWZpbmVkLFxyXG4gICAgICAgIHVuZGVmaW5lZCxcclxuICAgICAgICB1bmRlZmluZWQsIFswLCAwXSxcclxuICAgICAgICBbMSwgMV0sXHJcbiAgICAgICAgWzIsIDJdLFxyXG4gICAgICAgIFszLCAzXSxcclxuICAgICAgICBbNCwgNF0sXHJcbiAgICAgICAgWzUsIDVdLFxyXG4gICAgICAgIFs2LCA2XVxyXG4gICAgXTtcclxuXHJcbiAgICBleHBvcnRzLkRBVEUgPSBmdW5jdGlvbih5ZWFyLCBtb250aCwgZGF5KSB7XHJcbiAgICAgICAgeWVhciA9IHV0aWxzLnBhcnNlTnVtYmVyKHllYXIpO1xyXG4gICAgICAgIG1vbnRoID0gdXRpbHMucGFyc2VOdW1iZXIobW9udGgpO1xyXG4gICAgICAgIGRheSA9IHV0aWxzLnBhcnNlTnVtYmVyKGRheSk7XHJcbiAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IoeWVhciwgbW9udGgsIGRheSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoeWVhciA8IDAgfHwgbW9udGggPCAwIHx8IGRheSA8IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSh5ZWFyLCBtb250aCAtIDEsIGRheSk7XHJcbiAgICAgICAgcmV0dXJuIGRhdGU7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuREFURVZBTFVFID0gZnVuY3Rpb24oZGF0ZV90ZXh0KSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBkYXRlX3RleHQgIT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGRhdGUgPSBEYXRlLnBhcnNlKGRhdGVfdGV4dCk7XHJcbiAgICAgICAgaWYgKGlzTmFOKGRhdGUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGRhdGUgPD0gLTIyMDM4OTEyMDAwMDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIChkYXRlIC0gZDE5MDApIC8gODY0MDAwMDAgKyAxO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gKGRhdGUgLSBkMTkwMCkgLyA4NjQwMDAwMCArIDI7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuREFZID0gZnVuY3Rpb24oc2VyaWFsX251bWJlcikge1xyXG4gICAgICAgIHZhciBkYXRlID0gdXRpbHMucGFyc2VEYXRlKHNlcmlhbF9udW1iZXIpO1xyXG4gICAgICAgIGlmIChkYXRlIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGRhdGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBkYXRlLmdldERhdGUoKTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5EQVlTID0gZnVuY3Rpb24oZW5kX2RhdGUsIHN0YXJ0X2RhdGUpIHtcclxuICAgICAgICBlbmRfZGF0ZSA9IHV0aWxzLnBhcnNlRGF0ZShlbmRfZGF0ZSk7XHJcbiAgICAgICAgc3RhcnRfZGF0ZSA9IHV0aWxzLnBhcnNlRGF0ZShzdGFydF9kYXRlKTtcclxuICAgICAgICBpZiAoZW5kX2RhdGUgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gZW5kX2RhdGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChzdGFydF9kYXRlIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHN0YXJ0X2RhdGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBzZXJpYWwoZW5kX2RhdGUpIC0gc2VyaWFsKHN0YXJ0X2RhdGUpO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLkRBWVMzNjAgPSBmdW5jdGlvbihzdGFydF9kYXRlLCBlbmRfZGF0ZSwgbWV0aG9kKSB7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuRURBVEUgPSBmdW5jdGlvbihzdGFydF9kYXRlLCBtb250aHMpIHtcclxuICAgICAgICBzdGFydF9kYXRlID0gdXRpbHMucGFyc2VEYXRlKHN0YXJ0X2RhdGUpO1xyXG4gICAgICAgIGlmIChzdGFydF9kYXRlIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHN0YXJ0X2RhdGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChpc05hTihtb250aHMpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbW9udGhzID0gcGFyc2VJbnQobW9udGhzLCAxMCk7XHJcbiAgICAgICAgc3RhcnRfZGF0ZS5zZXRNb250aChzdGFydF9kYXRlLmdldE1vbnRoKCkgKyBtb250aHMpO1xyXG4gICAgICAgIHJldHVybiBzZXJpYWwoc3RhcnRfZGF0ZSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuRU9NT05USCA9IGZ1bmN0aW9uKHN0YXJ0X2RhdGUsIG1vbnRocykge1xyXG4gICAgICAgIHN0YXJ0X2RhdGUgPSB1dGlscy5wYXJzZURhdGUoc3RhcnRfZGF0ZSk7XHJcbiAgICAgICAgaWYgKHN0YXJ0X2RhdGUgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gc3RhcnRfZGF0ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGlzTmFOKG1vbnRocykpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBtb250aHMgPSBwYXJzZUludChtb250aHMsIDEwKTtcclxuICAgICAgICByZXR1cm4gc2VyaWFsKG5ldyBEYXRlKHN0YXJ0X2RhdGUuZ2V0RnVsbFllYXIoKSwgc3RhcnRfZGF0ZS5nZXRNb250aCgpICsgbW9udGhzICsgMSwgMCkpO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLkhPVVIgPSBmdW5jdGlvbihzZXJpYWxfbnVtYmVyKSB7XHJcbiAgICAgICAgc2VyaWFsX251bWJlciA9IHV0aWxzLnBhcnNlRGF0ZShzZXJpYWxfbnVtYmVyKTtcclxuICAgICAgICBpZiAoc2VyaWFsX251bWJlciBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBzZXJpYWxfbnVtYmVyO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gc2VyaWFsX251bWJlci5nZXRIb3VycygpO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLklOVEVSVkFMID0gZnVuY3Rpb24oc2Vjb25kKSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBzZWNvbmQgIT09ICdudW1iZXInICYmIHR5cGVvZiBzZWNvbmQgIT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBzZWNvbmQgPSBwYXJzZUludChzZWNvbmQsIDEwKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciB5ZWFyICA9IE1hdGguZmxvb3Ioc2Vjb25kLzk0NjA4MDAwMCk7XHJcbiAgICAgICAgc2Vjb25kICAgID0gc2Vjb25kJTk0NjA4MDAwMDtcclxuICAgICAgICB2YXIgbW9udGggPSBNYXRoLmZsb29yKHNlY29uZC8yNTkyMDAwKTtcclxuICAgICAgICBzZWNvbmQgICAgPSBzZWNvbmQlMjU5MjAwMDtcclxuICAgICAgICB2YXIgZGF5ICAgPSBNYXRoLmZsb29yKHNlY29uZC84NjQwMCk7XHJcbiAgICAgICAgc2Vjb25kICAgID0gc2Vjb25kJTg2NDAwO1xyXG5cclxuICAgICAgICB2YXIgaG91ciAgPSBNYXRoLmZsb29yKHNlY29uZC8zNjAwKTtcclxuICAgICAgICBzZWNvbmQgICAgPSBzZWNvbmQlMzYwMDtcclxuICAgICAgICB2YXIgbWluICAgPSBNYXRoLmZsb29yKHNlY29uZC82MCk7XHJcbiAgICAgICAgc2Vjb25kICAgID0gc2Vjb25kJTYwO1xyXG4gICAgICAgIHZhciBzZWMgICA9IHNlY29uZDtcclxuXHJcbiAgICAgICAgeWVhciAgPSAoeWVhciAgPiAwKSA/IHllYXIgICsgJ1knIDogJyc7XHJcbiAgICAgICAgbW9udGggPSAobW9udGggPiAwKSA/IG1vbnRoICsgJ00nIDogJyc7XHJcbiAgICAgICAgZGF5ICAgPSAoZGF5ICAgPiAwKSA/IGRheSAgICsgJ0QnIDogJyc7XHJcbiAgICAgICAgaG91ciAgPSAoaG91ciAgPiAwKSA/IGhvdXIgICsgJ0gnIDogJyc7XHJcbiAgICAgICAgbWluICAgPSAobWluICAgPiAwKSA/IG1pbiAgICsgJ00nIDogJyc7XHJcbiAgICAgICAgc2VjICAgPSAoc2VjICAgPiAwKSA/IHNlYyAgICsgJ1MnIDogJyc7XHJcblxyXG4gICAgICAgIHJldHVybiAnUCcgKyB5ZWFyICsgbW9udGggKyBkYXkgKyAnVCcgKyBob3VyICsgbWluICsgc2VjO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLklTT1dFRUtOVU0gPSBmdW5jdGlvbihkYXRlKSB7XHJcbiAgICAgICAgZGF0ZSA9IHV0aWxzLnBhcnNlRGF0ZShkYXRlKTtcclxuICAgICAgICBpZiAoZGF0ZSBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBkYXRlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZGF0ZS5zZXRIb3VycygwLCAwLCAwKTtcclxuICAgICAgICBkYXRlLnNldERhdGUoZGF0ZS5nZXREYXRlKCkgKyA0IC0gKGRhdGUuZ2V0RGF5KCkgfHwgNykpO1xyXG4gICAgICAgIHZhciB5ZWFyU3RhcnQgPSBuZXcgRGF0ZShkYXRlLmdldEZ1bGxZZWFyKCksIDAsIDEpO1xyXG4gICAgICAgIHJldHVybiBNYXRoLmNlaWwoKCgoZGF0ZSAtIHllYXJTdGFydCkgLyA4NjQwMDAwMCkgKyAxKSAvIDcpO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLk1JTlVURSA9IGZ1bmN0aW9uKHNlcmlhbF9udW1iZXIpIHtcclxuICAgICAgICBzZXJpYWxfbnVtYmVyID0gdXRpbHMucGFyc2VEYXRlKHNlcmlhbF9udW1iZXIpO1xyXG4gICAgICAgIGlmIChzZXJpYWxfbnVtYmVyIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHNlcmlhbF9udW1iZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBzZXJpYWxfbnVtYmVyLmdldE1pbnV0ZXMoKTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5NT05USCA9IGZ1bmN0aW9uKHNlcmlhbF9udW1iZXIpIHtcclxuICAgICAgICBzZXJpYWxfbnVtYmVyID0gdXRpbHMucGFyc2VEYXRlKHNlcmlhbF9udW1iZXIpO1xyXG4gICAgICAgIGlmIChzZXJpYWxfbnVtYmVyIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHNlcmlhbF9udW1iZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBzZXJpYWxfbnVtYmVyLmdldE1vbnRoKCkgKyAxO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLk5FVFdPUktEQVlTID0gZnVuY3Rpb24oc3RhcnRfZGF0ZSwgZW5kX2RhdGUsIGhvbGlkYXlzKSB7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuTkVUV09SS0RBWVMuSU5UTCA9IGZ1bmN0aW9uKHN0YXJ0X2RhdGUsIGVuZF9kYXRlLCB3ZWVrZW5kLCBob2xpZGF5cykge1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLk5PVyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBuZXcgRGF0ZSgpO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLlNFQ09ORCA9IGZ1bmN0aW9uKHNlcmlhbF9udW1iZXIpIHtcclxuICAgICAgICBzZXJpYWxfbnVtYmVyID0gdXRpbHMucGFyc2VEYXRlKHNlcmlhbF9udW1iZXIpO1xyXG4gICAgICAgIGlmIChzZXJpYWxfbnVtYmVyIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHNlcmlhbF9udW1iZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBzZXJpYWxfbnVtYmVyLmdldFNlY29uZHMoKTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5USU1FID0gZnVuY3Rpb24oaG91ciwgbWludXRlLCBzZWNvbmQpIHtcclxuICAgICAgICBob3VyID0gdXRpbHMucGFyc2VOdW1iZXIoaG91cik7XHJcbiAgICAgICAgbWludXRlID0gdXRpbHMucGFyc2VOdW1iZXIobWludXRlKTtcclxuICAgICAgICBzZWNvbmQgPSB1dGlscy5wYXJzZU51bWJlcihzZWNvbmQpO1xyXG4gICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKGhvdXIsIG1pbnV0ZSwgc2Vjb25kKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChob3VyIDwgMCB8fCBtaW51dGUgPCAwIHx8IHNlY29uZCA8IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuICgzNjAwICogaG91ciArIDYwICogbWludXRlICsgc2Vjb25kKSAvIDg2NDAwO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLlRJTUVWQUxVRSA9IGZ1bmN0aW9uKHRpbWVfdGV4dCkge1xyXG4gICAgICAgIHRpbWVfdGV4dCA9IHV0aWxzLnBhcnNlRGF0ZSh0aW1lX3RleHQpO1xyXG4gICAgICAgIGlmICh0aW1lX3RleHQgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gdGltZV90ZXh0O1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gKDM2MDAgKiB0aW1lX3RleHQuZ2V0SG91cnMoKSArIDYwICogdGltZV90ZXh0LmdldE1pbnV0ZXMoKSArIHRpbWVfdGV4dC5nZXRTZWNvbmRzKCkpIC8gODY0MDA7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuVE9EQVkgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gbmV3IERhdGUoKTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5XRUVLREFZID0gZnVuY3Rpb24oc2VyaWFsX251bWJlciwgcmV0dXJuX3R5cGUpIHtcclxuICAgICAgICBzZXJpYWxfbnVtYmVyID0gdXRpbHMucGFyc2VEYXRlKHNlcmlhbF9udW1iZXIpO1xyXG4gICAgICAgIGlmIChzZXJpYWxfbnVtYmVyIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHNlcmlhbF9udW1iZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChyZXR1cm5fdHlwZSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybl90eXBlID0gMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGRheSA9IHNlcmlhbF9udW1iZXIuZ2V0RGF5KCk7XHJcbiAgICAgICAgcmV0dXJuIFdFRUtfVFlQRVNbcmV0dXJuX3R5cGVdW2RheV07XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuV0VFS05VTSA9IGZ1bmN0aW9uKHNlcmlhbF9udW1iZXIsIHJldHVybl90eXBlKSB7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuV09SS0RBWSA9IGZ1bmN0aW9uKHN0YXJ0X2RhdGUsIGRheXMsIGhvbGlkYXlzKSB7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuV09SS0RBWS5JTlRMID0gZnVuY3Rpb24oc3RhcnRfZGF0ZSwgZGF5cywgd2Vla2VuZCwgaG9saWRheXMpIHtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5ZRUFSID0gZnVuY3Rpb24oc2VyaWFsX251bWJlcikge1xyXG4gICAgICAgIHNlcmlhbF9udW1iZXIgPSB1dGlscy5wYXJzZURhdGUoc2VyaWFsX251bWJlcik7XHJcbiAgICAgICAgaWYgKHNlcmlhbF9udW1iZXIgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gc2VyaWFsX251bWJlcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHNlcmlhbF9udW1iZXIuZ2V0RnVsbFllYXIoKTtcclxuICAgIH07XHJcblxyXG4gICAgZnVuY3Rpb24gaXNMZWFwWWVhcih5ZWFyKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKHllYXIsIDEsIDI5KS5nZXRNb250aCgpID09PSAxO1xyXG4gICAgfVxyXG5cclxuICAgIGV4cG9ydHMuWUVBUkZSQUMgPSBmdW5jdGlvbihzdGFydF9kYXRlLCBlbmRfZGF0ZSwgYmFzaXMpIHtcclxuICAgIH07XHJcblxyXG4gICAgZnVuY3Rpb24gc2VyaWFsKGRhdGUpIHtcclxuICAgICAgICB2YXIgYWRkT24gPSAoZGF0ZSA+IC0yMjAzODkxMjAwMDAwKT8yOjE7XHJcbiAgICAgICAgcmV0dXJuIChkYXRlIC0gZDE5MDApIC8gODY0MDAwMDAgKyBhZGRPbjtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZXhwb3J0cztcclxufSkoKTtcclxuXHJcbmpleGNlbC5tZXRob2RzLmRhdGFiYXNlID0gKGZ1bmN0aW9uKCkge1xyXG4gICAgdmFyIGV4cG9ydHMgPSB7fTtcclxuXHJcbiAgICBmdW5jdGlvbiBjb21wYWN0KGFycmF5KSB7XHJcbiAgICAgICAgaWYgKCFhcnJheSkge1xyXG4gICAgICAgICAgICByZXR1cm4gYXJyYXk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciByZXN1bHQgPSBbXTtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgKytpKSB7XHJcbiAgICAgICAgICAgIGlmICghYXJyYXlbaV0pIHtcclxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJlc3VsdC5wdXNoKGFycmF5W2ldKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuXHJcbiAgICBleHBvcnRzLkZJTkRGSUVMRCA9IGZ1bmN0aW9uKGRhdGFiYXNlLCB0aXRsZSkge1xyXG4gICAgICAgIHZhciBpbmRleCA9IG51bGw7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhYmFzZS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBpZiAoZGF0YWJhc2VbaV1bMF0gPT09IHRpdGxlKSB7XHJcbiAgICAgICAgICAgICAgICBpbmRleCA9IGk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIHRoZSBpbnB1dCBmaWVsZCB0aXRsZSBpcyBpbmNvcnJlY3RcclxuICAgICAgICBpZiAoaW5kZXggPT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBpbmRleDtcclxuICAgIH07XHJcblxyXG4gICAgZnVuY3Rpb24gZmluZFJlc3VsdEluZGV4KGRhdGFiYXNlLCBjcml0ZXJpYXMpIHtcclxuICAgICAgICB2YXIgbWF0Y2hlcyA9IHt9O1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgZGF0YWJhc2VbMF0ubGVuZ3RoOyArK2kpIHtcclxuICAgICAgICAgICAgbWF0Y2hlc1tpXSA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBtYXhDcml0ZXJpYUxlbmd0aCA9IGNyaXRlcmlhc1swXS5sZW5ndGg7XHJcbiAgICAgICAgZm9yIChpID0gMTsgaSA8IGNyaXRlcmlhcy5sZW5ndGg7ICsraSkge1xyXG4gICAgICAgICAgICBpZiAoY3JpdGVyaWFzW2ldLmxlbmd0aCA+IG1heENyaXRlcmlhTGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBtYXhDcml0ZXJpYUxlbmd0aCA9IGNyaXRlcmlhc1tpXS5sZW5ndGg7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZvciAodmFyIGsgPSAxOyBrIDwgZGF0YWJhc2UubGVuZ3RoOyArK2spIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgbCA9IDE7IGwgPCBkYXRhYmFzZVtrXS5sZW5ndGg7ICsrbCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRDcml0ZXJpYVJlc3VsdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdmFyIGhhc01hdGNoaW5nQ3JpdGVyaWEgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgY3JpdGVyaWFzLmxlbmd0aDsgKytqKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNyaXRlcmlhID0gY3JpdGVyaWFzW2pdO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjcml0ZXJpYS5sZW5ndGggPCBtYXhDcml0ZXJpYUxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjcml0ZXJpYUZpZWxkID0gY3JpdGVyaWFbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFiYXNlW2tdWzBdICE9PSBjcml0ZXJpYUZpZWxkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBoYXNNYXRjaGluZ0NyaXRlcmlhID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBwID0gMTsgcCA8IGNyaXRlcmlhLmxlbmd0aDsgKytwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRDcml0ZXJpYVJlc3VsdCA9IGN1cnJlbnRDcml0ZXJpYVJlc3VsdFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHx8IGV2YWwoZGF0YWJhc2Vba11bbF0gKyBjcml0ZXJpYVtwXSk7IC8vIGpzaGludFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpZ25vcmU6bGluZVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChoYXNNYXRjaGluZ0NyaXRlcmlhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWF0Y2hlc1tsXSA9IG1hdGNoZXNbbF0gJiYgY3VycmVudENyaXRlcmlhUmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgcmVzdWx0ID0gW107XHJcbiAgICAgICAgZm9yICh2YXIgbiA9IDA7IG4gPCBkYXRhYmFzZVswXS5sZW5ndGg7ICsrbikge1xyXG4gICAgICAgICAgICBpZiAobWF0Y2hlc1tuXSkge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobiAtIDEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gRGF0YWJhc2UgZnVuY3Rpb25zXHJcbiAgICBleHBvcnRzLkRBVkVSQUdFID0gZnVuY3Rpb24oZGF0YWJhc2UsIGZpZWxkLCBjcml0ZXJpYSkge1xyXG4gICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBmaWVsZCBpcyBub3QgYSBudW1iZXIgYW5kIG5vdCBhIHN0cmluZ1xyXG4gICAgICAgIGlmIChpc05hTihmaWVsZCkgJiYgKHR5cGVvZiBmaWVsZCAhPT0gXCJzdHJpbmdcIikpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgcmVzdWx0SW5kZXhlcyA9IGZpbmRSZXN1bHRJbmRleChkYXRhYmFzZSwgY3JpdGVyaWEpO1xyXG4gICAgICAgIHZhciB0YXJnZXRGaWVsZHMgPSBbXTtcclxuICAgICAgICBpZiAodHlwZW9mIGZpZWxkID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgIHZhciBpbmRleCA9IGV4cG9ydHMuRklOREZJRUxEKGRhdGFiYXNlLCBmaWVsZCk7XHJcbiAgICAgICAgICAgIHRhcmdldEZpZWxkcyA9IHV0aWxzLnJlc3QoZGF0YWJhc2VbaW5kZXhdKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0YXJnZXRGaWVsZHMgPSB1dGlscy5yZXN0KGRhdGFiYXNlW2ZpZWxkXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBzdW0gPSAwO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVzdWx0SW5kZXhlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBzdW0gKz0gdGFyZ2V0RmllbGRzW3Jlc3VsdEluZGV4ZXNbaV1dO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0SW5kZXhlcy5sZW5ndGggPT09IDAgPyBlcnJvci5kaXYwIDogc3VtIC8gcmVzdWx0SW5kZXhlcy5sZW5ndGg7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuRENPVU5UID0gZnVuY3Rpb24oZGF0YWJhc2UsIGZpZWxkLCBjcml0ZXJpYSkge1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLkRDT1VOVEEgPSBmdW5jdGlvbihkYXRhYmFzZSwgZmllbGQsIGNyaXRlcmlhKSB7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuREdFVCA9IGZ1bmN0aW9uKGRhdGFiYXNlLCBmaWVsZCwgY3JpdGVyaWEpIHtcclxuICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgZmllbGQgaXMgbm90IGEgbnVtYmVyIGFuZCBub3QgYSBzdHJpbmdcclxuICAgICAgICBpZiAoaXNOYU4oZmllbGQpICYmICh0eXBlb2YgZmllbGQgIT09IFwic3RyaW5nXCIpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIHJlc3VsdEluZGV4ZXMgPSBmaW5kUmVzdWx0SW5kZXgoZGF0YWJhc2UsIGNyaXRlcmlhKTtcclxuICAgICAgICB2YXIgdGFyZ2V0RmllbGRzID0gW107XHJcbiAgICAgICAgaWYgKHR5cGVvZiBmaWVsZCA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICB2YXIgaW5kZXggPSBleHBvcnRzLkZJTkRGSUVMRChkYXRhYmFzZSwgZmllbGQpO1xyXG4gICAgICAgICAgICB0YXJnZXRGaWVsZHMgPSB1dGlscy5yZXN0KGRhdGFiYXNlW2luZGV4XSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGFyZ2V0RmllbGRzID0gdXRpbHMucmVzdChkYXRhYmFzZVtmaWVsZF0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgbm8gcmVjb3JkIG1lZXRzIHRoZSBjcml0ZXJpYVxyXG4gICAgICAgIGlmIChyZXN1bHRJbmRleGVzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIFJldHVybnMgdGhlICNOVU0hIGVycm9yIHZhbHVlIGJlY2F1c2UgbW9yZSB0aGFuIG9uZSByZWNvcmQgbWVldHMgdGhlXHJcbiAgICAgICAgLy8gY3JpdGVyaWFcclxuICAgICAgICBpZiAocmVzdWx0SW5kZXhlcy5sZW5ndGggPiAxKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdGFyZ2V0RmllbGRzW3Jlc3VsdEluZGV4ZXNbMF1dO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLkRNQVggPSBmdW5jdGlvbihkYXRhYmFzZSwgZmllbGQsIGNyaXRlcmlhKSB7XHJcbiAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIGZpZWxkIGlzIG5vdCBhIG51bWJlciBhbmQgbm90IGEgc3RyaW5nXHJcbiAgICAgICAgaWYgKGlzTmFOKGZpZWxkKSAmJiAodHlwZW9mIGZpZWxkICE9PSBcInN0cmluZ1wiKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciByZXN1bHRJbmRleGVzID0gZmluZFJlc3VsdEluZGV4KGRhdGFiYXNlLCBjcml0ZXJpYSk7XHJcbiAgICAgICAgdmFyIHRhcmdldEZpZWxkcyA9IFtdO1xyXG4gICAgICAgIGlmICh0eXBlb2YgZmllbGQgPT09IFwic3RyaW5nXCIpIHtcclxuICAgICAgICAgICAgdmFyIGluZGV4ID0gZXhwb3J0cy5GSU5ERklFTEQoZGF0YWJhc2UsIGZpZWxkKTtcclxuICAgICAgICAgICAgdGFyZ2V0RmllbGRzID0gdXRpbHMucmVzdChkYXRhYmFzZVtpbmRleF0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRhcmdldEZpZWxkcyA9IHV0aWxzLnJlc3QoZGF0YWJhc2VbZmllbGRdKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIG1heFZhbHVlID0gdGFyZ2V0RmllbGRzW3Jlc3VsdEluZGV4ZXNbMF1dO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgcmVzdWx0SW5kZXhlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBpZiAobWF4VmFsdWUgPCB0YXJnZXRGaWVsZHNbcmVzdWx0SW5kZXhlc1tpXV0pIHtcclxuICAgICAgICAgICAgICAgIG1heFZhbHVlID0gdGFyZ2V0RmllbGRzW3Jlc3VsdEluZGV4ZXNbaV1dO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBtYXhWYWx1ZTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5ETUlOID0gZnVuY3Rpb24oZGF0YWJhc2UsIGZpZWxkLCBjcml0ZXJpYSkge1xyXG4gICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBmaWVsZCBpcyBub3QgYSBudW1iZXIgYW5kIG5vdCBhIHN0cmluZ1xyXG4gICAgICAgIGlmIChpc05hTihmaWVsZCkgJiYgKHR5cGVvZiBmaWVsZCAhPT0gXCJzdHJpbmdcIikpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgcmVzdWx0SW5kZXhlcyA9IGZpbmRSZXN1bHRJbmRleChkYXRhYmFzZSwgY3JpdGVyaWEpO1xyXG4gICAgICAgIHZhciB0YXJnZXRGaWVsZHMgPSBbXTtcclxuICAgICAgICBpZiAodHlwZW9mIGZpZWxkID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgIHZhciBpbmRleCA9IGV4cG9ydHMuRklOREZJRUxEKGRhdGFiYXNlLCBmaWVsZCk7XHJcbiAgICAgICAgICAgIHRhcmdldEZpZWxkcyA9IHV0aWxzLnJlc3QoZGF0YWJhc2VbaW5kZXhdKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0YXJnZXRGaWVsZHMgPSB1dGlscy5yZXN0KGRhdGFiYXNlW2ZpZWxkXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBtaW5WYWx1ZSA9IHRhcmdldEZpZWxkc1tyZXN1bHRJbmRleGVzWzBdXTtcclxuICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IHJlc3VsdEluZGV4ZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKG1pblZhbHVlID4gdGFyZ2V0RmllbGRzW3Jlc3VsdEluZGV4ZXNbaV1dKSB7XHJcbiAgICAgICAgICAgICAgICBtaW5WYWx1ZSA9IHRhcmdldEZpZWxkc1tyZXN1bHRJbmRleGVzW2ldXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbWluVmFsdWU7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuRFBST0RVQ1QgPSBmdW5jdGlvbihkYXRhYmFzZSwgZmllbGQsIGNyaXRlcmlhKSB7XHJcbiAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIGZpZWxkIGlzIG5vdCBhIG51bWJlciBhbmQgbm90IGEgc3RyaW5nXHJcbiAgICAgICAgaWYgKGlzTmFOKGZpZWxkKSAmJiAodHlwZW9mIGZpZWxkICE9PSBcInN0cmluZ1wiKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciByZXN1bHRJbmRleGVzID0gZmluZFJlc3VsdEluZGV4KGRhdGFiYXNlLCBjcml0ZXJpYSk7XHJcbiAgICAgICAgdmFyIHRhcmdldEZpZWxkcyA9IFtdO1xyXG4gICAgICAgIGlmICh0eXBlb2YgZmllbGQgPT09IFwic3RyaW5nXCIpIHtcclxuICAgICAgICAgICAgdmFyIGluZGV4ID0gZXhwb3J0cy5GSU5ERklFTEQoZGF0YWJhc2UsIGZpZWxkKTtcclxuICAgICAgICAgICAgdGFyZ2V0RmllbGRzID0gdXRpbHMucmVzdChkYXRhYmFzZVtpbmRleF0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRhcmdldEZpZWxkcyA9IHV0aWxzLnJlc3QoZGF0YWJhc2VbZmllbGRdKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIHRhcmdldFZhbHVlcyA9IFtdO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVzdWx0SW5kZXhlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICB0YXJnZXRWYWx1ZXNbaV0gPSB0YXJnZXRGaWVsZHNbcmVzdWx0SW5kZXhlc1tpXV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRhcmdldFZhbHVlcyA9IGNvbXBhY3QodGFyZ2V0VmFsdWVzKTtcclxuICAgICAgICB2YXIgcmVzdWx0ID0gMTtcclxuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdGFyZ2V0VmFsdWVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdCAqPSB0YXJnZXRWYWx1ZXNbaV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuRFNUREVWID0gZnVuY3Rpb24oZGF0YWJhc2UsIGZpZWxkLCBjcml0ZXJpYSkge1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLkRTVERFVlAgPSBmdW5jdGlvbihkYXRhYmFzZSwgZmllbGQsIGNyaXRlcmlhKSB7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuRFNVTSA9IGZ1bmN0aW9uKGRhdGFiYXNlLCBmaWVsZCwgY3JpdGVyaWEpIHtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5EVkFSID0gZnVuY3Rpb24oZGF0YWJhc2UsIGZpZWxkLCBjcml0ZXJpYSkge1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLkRWQVJQID0gZnVuY3Rpb24oZGF0YWJhc2UsIGZpZWxkLCBjcml0ZXJpYSkge1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLk1BVENIID0gZnVuY3Rpb24obG9va3VwVmFsdWUsIGxvb2t1cEFycmF5LCBtYXRjaFR5cGUpIHtcclxuICAgICAgICBpZiAoIWxvb2t1cFZhbHVlICYmICFsb29rdXBBcnJheSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IubmE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAyKSB7XHJcbiAgICAgICAgICAgIG1hdGNoVHlwZSA9IDE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghKGxvb2t1cEFycmF5IGluc3RhbmNlb2YgQXJyYXkpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5uYTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG1hdGNoVHlwZSAhPT0gLTEgJiYgbWF0Y2hUeXBlICE9PSAwICYmIG1hdGNoVHlwZSAhPT0gMSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IubmE7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgaW5kZXg7XHJcbiAgICAgICAgdmFyIGluZGV4VmFsdWU7XHJcblxyXG4gICAgICAgIGZvciAodmFyIGlkeCA9IDA7IGlkeCA8IGxvb2t1cEFycmF5Lmxlbmd0aDsgaWR4KyspIHtcclxuICAgICAgICAgICAgaWYgKG1hdGNoVHlwZSA9PT0gMSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGxvb2t1cEFycmF5W2lkeF0gPT09IGxvb2t1cFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlkeCArIDE7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGxvb2t1cEFycmF5W2lkeF0gPCBsb29rdXBWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghaW5kZXhWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmRleCA9IGlkeCArIDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4VmFsdWUgPSBsb29rdXBBcnJheVtpZHhdO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobG9va3VwQXJyYXlbaWR4XSA+IGluZGV4VmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXggPSBpZHggKyAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmRleFZhbHVlID0gbG9va3VwQXJyYXlbaWR4XTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAobWF0Y2hUeXBlID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGxvb2t1cFZhbHVlID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGxvb2t1cFZhbHVlID0gbG9va3VwVmFsdWUucmVwbGFjZSgvXFw/L2csICcuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxvb2t1cEFycmF5W2lkeF0udG9Mb3dlckNhc2UoKS5tYXRjaChsb29rdXBWYWx1ZS50b0xvd2VyQ2FzZSgpKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaWR4ICsgMTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChsb29rdXBBcnJheVtpZHhdID09PSBsb29rdXBWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaWR4ICsgMTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAobWF0Y2hUeXBlID09PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGxvb2t1cEFycmF5W2lkeF0gPT09IGxvb2t1cFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlkeCArIDE7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGxvb2t1cEFycmF5W2lkeF0gPiBsb29rdXBWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghaW5kZXhWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmRleCA9IGlkeCArIDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4VmFsdWUgPSBsb29rdXBBcnJheVtpZHhdO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobG9va3VwQXJyYXlbaWR4XSA8IGluZGV4VmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXggPSBpZHggKyAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmRleFZhbHVlID0gbG9va3VwQXJyYXlbaWR4XTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBpbmRleCA/IGluZGV4IDogZXJyb3IubmE7XHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiBleHBvcnRzO1xyXG59KSgpO1xyXG5cclxuamV4Y2VsLm1ldGhvZHMuZW5naW5lZXJpbmcgPSAoZnVuY3Rpb24oKSB7XHJcbiAgICB2YXIgZXhwb3J0cyA9IHt9O1xyXG5cclxuICAgIGZ1bmN0aW9uIGlzVmFsaWRCaW5hcnlOdW1iZXIobnVtYmVyKSB7XHJcbiAgICAgICAgcmV0dXJuICgvXlswMV17MSwxMH0kLykudGVzdChudW1iZXIpO1xyXG4gICAgfVxyXG5cclxuICAgIGV4cG9ydHMuQkVTU0VMSSA9IGZ1bmN0aW9uKHgsIG4pIHtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5CRVNTRUxKID0gZnVuY3Rpb24oeCwgbikge1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLkJFU1NFTEsgPSBmdW5jdGlvbih4LCBuKSB7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuQkVTU0VMWSA9IGZ1bmN0aW9uKHgsIG4pIHtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5CSU4yREVDID0gZnVuY3Rpb24obnVtYmVyKSB7XHJcbiAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIG51bWJlciBpcyBub3QgYmluYXJ5IG9yIGNvbnRhaW5zIG1vcmUgdGhhbiAxMFxyXG4gICAgICAgIC8vIGNoYXJhY3RlcnMgKDEwIGRpZ2l0cylcclxuICAgICAgICBpZiAoIWlzVmFsaWRCaW5hcnlOdW1iZXIobnVtYmVyKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQ29udmVydCBiaW5hcnkgbnVtYmVyIHRvIGRlY2ltYWxcclxuICAgICAgICB2YXIgcmVzdWx0ID0gcGFyc2VJbnQobnVtYmVyLCAyKTtcclxuXHJcbiAgICAgICAgLy8gSGFuZGxlIG5lZ2F0aXZlIG51bWJlcnNcclxuICAgICAgICB2YXIgc3RyaW5naWZpZWQgPSBudW1iZXIudG9TdHJpbmcoKTtcclxuICAgICAgICBpZiAoc3RyaW5naWZpZWQubGVuZ3RoID09PSAxMCAmJiBzdHJpbmdpZmllZC5zdWJzdHJpbmcoMCwgMSkgPT09ICcxJykge1xyXG4gICAgICAgICAgICByZXR1cm4gcGFyc2VJbnQoc3RyaW5naWZpZWQuc3Vic3RyaW5nKDEpLCAyKSAtIDUxMjtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5CSU4ySEVYID0gZnVuY3Rpb24obnVtYmVyLCBwbGFjZXMpIHtcclxuICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgbnVtYmVyIGlzIG5vdCBiaW5hcnkgb3IgY29udGFpbnMgbW9yZSB0aGFuIDEwXHJcbiAgICAgICAgLy8gY2hhcmFjdGVycyAoMTAgZGlnaXRzKVxyXG4gICAgICAgIGlmICghaXNWYWxpZEJpbmFyeU51bWJlcihudW1iZXIpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBJZ25vcmUgcGxhY2VzIGFuZCByZXR1cm4gYSAxMC1jaGFyYWN0ZXIgaGV4YWRlY2ltYWwgbnVtYmVyIGlmIG51bWJlclxyXG4gICAgICAgIC8vIGlzIG5lZ2F0aXZlXHJcbiAgICAgICAgdmFyIHN0cmluZ2lmaWVkID0gbnVtYmVyLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgaWYgKHN0cmluZ2lmaWVkLmxlbmd0aCA9PT0gMTAgJiYgc3RyaW5naWZpZWQuc3Vic3RyaW5nKDAsIDEpID09PSAnMScpIHtcclxuICAgICAgICAgICAgcmV0dXJuICgxMDk5NTExNjI3MjY0ICsgcGFyc2VJbnQoc3RyaW5naWZpZWQuc3Vic3RyaW5nKDEpLCAyKSkudG9TdHJpbmcoMTYpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQ29udmVydCBiaW5hcnkgbnVtYmVyIHRvIGhleGFkZWNpbWFsXHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IHBhcnNlSW50KG51bWJlciwgMikudG9TdHJpbmcoMTYpO1xyXG5cclxuICAgICAgICAvLyBSZXR1cm4gaGV4YWRlY2ltYWwgbnVtYmVyIHVzaW5nIHRoZSBtaW5pbXVtIG51bWJlciBvZiBjaGFyYWN0ZXJzXHJcbiAgICAgICAgLy8gbmVjZXNzYXJ5IGlmIHBsYWNlcyBpcyB1bmRlZmluZWRcclxuICAgICAgICBpZiAocGxhY2VzID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgcGxhY2VzIGlzIG5vbm51bWVyaWNcclxuICAgICAgICAgICAgaWYgKGlzTmFOKHBsYWNlcykpIHtcclxuICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBwbGFjZXMgaXMgbmVnYXRpdmVcclxuICAgICAgICAgICAgaWYgKHBsYWNlcyA8IDApIHtcclxuICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBUcnVuY2F0ZSBwbGFjZXMgaW4gY2FzZSBpdCBpcyBub3QgYW4gaW50ZWdlclxyXG4gICAgICAgICAgICBwbGFjZXMgPSBNYXRoLmZsb29yKHBsYWNlcyk7XHJcblxyXG4gICAgICAgICAgICAvLyBQYWQgcmV0dXJuIHZhbHVlIHdpdGggbGVhZGluZyAwcyAoemVyb3MpIGlmIG5lY2Vzc2FyeSAodXNpbmdcclxuICAgICAgICAgICAgLy8gVW5kZXJzY29yZS5zdHJpbmcpXHJcbiAgICAgICAgICAgIHJldHVybiAocGxhY2VzID49IHJlc3VsdC5sZW5ndGgpID8gUkVQVCgnMCcsIHBsYWNlcyAtIHJlc3VsdC5sZW5ndGgpICsgcmVzdWx0IDogZXJyb3IubnVtO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5CSU4yT0NUID0gZnVuY3Rpb24obnVtYmVyLCBwbGFjZXMpIHtcclxuICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgbnVtYmVyIGlzIG5vdCBiaW5hcnkgb3IgY29udGFpbnMgbW9yZSB0aGFuIDEwXHJcbiAgICAgICAgLy8gY2hhcmFjdGVycyAoMTAgZGlnaXRzKVxyXG4gICAgICAgIGlmICghaXNWYWxpZEJpbmFyeU51bWJlcihudW1iZXIpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBJZ25vcmUgcGxhY2VzIGFuZCByZXR1cm4gYSAxMC1jaGFyYWN0ZXIgb2N0YWwgbnVtYmVyIGlmIG51bWJlciBpc1xyXG4gICAgICAgIC8vIG5lZ2F0aXZlXHJcbiAgICAgICAgdmFyIHN0cmluZ2lmaWVkID0gbnVtYmVyLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgaWYgKHN0cmluZ2lmaWVkLmxlbmd0aCA9PT0gMTAgJiYgc3RyaW5naWZpZWQuc3Vic3RyaW5nKDAsIDEpID09PSAnMScpIHtcclxuICAgICAgICAgICAgcmV0dXJuICgxMDczNzQxMzEyICsgcGFyc2VJbnQoc3RyaW5naWZpZWQuc3Vic3RyaW5nKDEpLCAyKSkudG9TdHJpbmcoOCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBDb252ZXJ0IGJpbmFyeSBudW1iZXIgdG8gb2N0YWxcclxuICAgICAgICB2YXIgcmVzdWx0ID0gcGFyc2VJbnQobnVtYmVyLCAyKS50b1N0cmluZyg4KTtcclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIG9jdGFsIG51bWJlciB1c2luZyB0aGUgbWluaW11bSBudW1iZXIgb2YgY2hhcmFjdGVycyBuZWNlc3NhcnlcclxuICAgICAgICAvLyBpZiBwbGFjZXMgaXMgdW5kZWZpbmVkXHJcbiAgICAgICAgaWYgKHBsYWNlcyA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIHBsYWNlcyBpcyBub25udW1lcmljXHJcbiAgICAgICAgICAgIGlmIChpc05hTihwbGFjZXMpKSB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgcGxhY2VzIGlzIG5lZ2F0aXZlXHJcbiAgICAgICAgICAgIGlmIChwbGFjZXMgPCAwKSB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gVHJ1bmNhdGUgcGxhY2VzIGluIGNhc2UgaXQgaXMgbm90IGFuIGludGVnZXJcclxuICAgICAgICAgICAgcGxhY2VzID0gTWF0aC5mbG9vcihwbGFjZXMpO1xyXG5cclxuICAgICAgICAgICAgLy8gUGFkIHJldHVybiB2YWx1ZSB3aXRoIGxlYWRpbmcgMHMgKHplcm9zKSBpZiBuZWNlc3NhcnkgKHVzaW5nXHJcbiAgICAgICAgICAgIC8vIFVuZGVyc2NvcmUuc3RyaW5nKVxyXG4gICAgICAgICAgICByZXR1cm4gKHBsYWNlcyA+PSByZXN1bHQubGVuZ3RoKSA/IFJFUFQoJzAnLCBwbGFjZXMgLSByZXN1bHQubGVuZ3RoKSArIHJlc3VsdCA6IGVycm9yLm51bTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuQklUQU5EID0gZnVuY3Rpb24obnVtYmVyMSwgbnVtYmVyMikge1xyXG4gICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBlaXRoZXIgbnVtYmVyIGlzIGEgbm9uLW51bWVyaWMgdmFsdWVcclxuICAgICAgICBudW1iZXIxID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyMSk7XHJcbiAgICAgICAgbnVtYmVyMiA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcjIpO1xyXG4gICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKG51bWJlcjEsIG51bWJlcjIpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBlaXRoZXIgbnVtYmVyIGlzIGxlc3MgdGhhbiAwXHJcbiAgICAgICAgaWYgKG51bWJlcjEgPCAwIHx8IG51bWJlcjIgPCAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgZWl0aGVyIG51bWJlciBpcyBhIG5vbi1pbnRlZ2VyXHJcbiAgICAgICAgaWYgKE1hdGguZmxvb3IobnVtYmVyMSkgIT09IG51bWJlcjEgfHwgTWF0aC5mbG9vcihudW1iZXIyKSAhPT0gbnVtYmVyMikge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIGVpdGhlciBudW1iZXIgaXMgZ3JlYXRlciB0aGFuICgyXjQ4KS0xXHJcbiAgICAgICAgaWYgKG51bWJlcjEgPiAyODE0NzQ5NzY3MTA2NTUgfHwgbnVtYmVyMiA+IDI4MTQ3NDk3NjcxMDY1NSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIGJpdHdpc2UgQU5EIG9mIHR3byBudW1iZXJzXHJcbiAgICAgICAgcmV0dXJuIG51bWJlcjEgJiBudW1iZXIyO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLkJJVExTSElGVCA9IGZ1bmN0aW9uKG51bWJlciwgc2hpZnQpIHtcclxuICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgIHNoaWZ0ID0gdXRpbHMucGFyc2VOdW1iZXIoc2hpZnQpO1xyXG4gICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKG51bWJlciwgc2hpZnQpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBudW1iZXIgaXMgbGVzcyB0aGFuIDBcclxuICAgICAgICBpZiAobnVtYmVyIDwgMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIG51bWJlciBpcyBhIG5vbi1pbnRlZ2VyXHJcbiAgICAgICAgaWYgKE1hdGguZmxvb3IobnVtYmVyKSAhPT0gbnVtYmVyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgbnVtYmVyIGlzIGdyZWF0ZXIgdGhhbiAoMl40OCktMVxyXG4gICAgICAgIGlmIChudW1iZXIgPiAyODE0NzQ5NzY3MTA2NTUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBlcnJvciBpZiB0aGUgYWJzb2x1dGUgdmFsdWUgb2Ygc2hpZnQgaXMgZ3JlYXRlciB0aGFuIDUzXHJcbiAgICAgICAgaWYgKE1hdGguYWJzKHNoaWZ0KSA+IDUzKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZXR1cm4gbnVtYmVyIHNoaWZ0ZWQgYnkgc2hpZnQgYml0cyB0byB0aGUgbGVmdCBvciB0byB0aGUgcmlnaHQgaWZcclxuICAgICAgICAvLyBzaGlmdCBpcyBuZWdhdGl2ZVxyXG4gICAgICAgIHJldHVybiAoc2hpZnQgPj0gMCkgPyBudW1iZXIgPDwgc2hpZnQgOiBudW1iZXIgPj4gLXNoaWZ0O1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLkJJVE9SID0gZnVuY3Rpb24obnVtYmVyMSwgbnVtYmVyMikge1xyXG4gICAgICAgIG51bWJlcjEgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIxKTtcclxuICAgICAgICBudW1iZXIyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyMik7XHJcbiAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IobnVtYmVyMSwgbnVtYmVyMikpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIGVpdGhlciBudW1iZXIgaXMgbGVzcyB0aGFuIDBcclxuICAgICAgICBpZiAobnVtYmVyMSA8IDAgfHwgbnVtYmVyMiA8IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBlaXRoZXIgbnVtYmVyIGlzIGEgbm9uLWludGVnZXJcclxuICAgICAgICBpZiAoTWF0aC5mbG9vcihudW1iZXIxKSAhPT0gbnVtYmVyMSB8fCBNYXRoLmZsb29yKG51bWJlcjIpICE9PSBudW1iZXIyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgZWl0aGVyIG51bWJlciBpcyBncmVhdGVyIHRoYW4gKDJeNDgpLTFcclxuICAgICAgICBpZiAobnVtYmVyMSA+IDI4MTQ3NDk3NjcxMDY1NSB8fCBudW1iZXIyID4gMjgxNDc0OTc2NzEwNjU1KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZXR1cm4gYml0d2lzZSBPUiBvZiB0d28gbnVtYmVyc1xyXG4gICAgICAgIHJldHVybiBudW1iZXIxIHwgbnVtYmVyMjtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5CSVRSU0hJRlQgPSBmdW5jdGlvbihudW1iZXIsIHNoaWZ0KSB7XHJcbiAgICAgICAgbnVtYmVyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKTtcclxuICAgICAgICBzaGlmdCA9IHV0aWxzLnBhcnNlTnVtYmVyKHNoaWZ0KTtcclxuICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihudW1iZXIsIHNoaWZ0KSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgbnVtYmVyIGlzIGxlc3MgdGhhbiAwXHJcbiAgICAgICAgaWYgKG51bWJlciA8IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBudW1iZXIgaXMgYSBub24taW50ZWdlclxyXG4gICAgICAgIGlmIChNYXRoLmZsb29yKG51bWJlcikgIT09IG51bWJlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIG51bWJlciBpcyBncmVhdGVyIHRoYW4gKDJeNDgpLTFcclxuICAgICAgICBpZiAobnVtYmVyID4gMjgxNDc0OTc2NzEwNjU1KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgdGhlIGFic29sdXRlIHZhbHVlIG9mIHNoaWZ0IGlzIGdyZWF0ZXIgdGhhbiA1M1xyXG4gICAgICAgIGlmIChNYXRoLmFicyhzaGlmdCkgPiA1Mykge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIG51bWJlciBzaGlmdGVkIGJ5IHNoaWZ0IGJpdHMgdG8gdGhlIHJpZ2h0IG9yIHRvIHRoZSBsZWZ0IGlmXHJcbiAgICAgICAgLy8gc2hpZnQgaXMgbmVnYXRpdmVcclxuICAgICAgICByZXR1cm4gKHNoaWZ0ID49IDApID8gbnVtYmVyID4+IHNoaWZ0IDogbnVtYmVyIDw8IC1zaGlmdDtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5CSVRYT1IgPSBmdW5jdGlvbihudW1iZXIxLCBudW1iZXIyKSB7XHJcbiAgICAgICAgbnVtYmVyMSA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcjEpO1xyXG4gICAgICAgIG51bWJlcjIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIyKTtcclxuICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihudW1iZXIxLCBudW1iZXIyKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgZWl0aGVyIG51bWJlciBpcyBsZXNzIHRoYW4gMFxyXG4gICAgICAgIGlmIChudW1iZXIxIDwgMCB8fCBudW1iZXIyIDwgMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIGVpdGhlciBudW1iZXIgaXMgYSBub24taW50ZWdlclxyXG4gICAgICAgIGlmIChNYXRoLmZsb29yKG51bWJlcjEpICE9PSBudW1iZXIxIHx8IE1hdGguZmxvb3IobnVtYmVyMikgIT09IG51bWJlcjIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBlaXRoZXIgbnVtYmVyIGlzIGdyZWF0ZXIgdGhhbiAoMl40OCktMVxyXG4gICAgICAgIGlmIChudW1iZXIxID4gMjgxNDc0OTc2NzEwNjU1IHx8IG51bWJlcjIgPiAyODE0NzQ5NzY3MTA2NTUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBiaXR3aXNlIFhPUiBvZiB0d28gbnVtYmVyc1xyXG4gICAgICAgIHJldHVybiBudW1iZXIxIF4gbnVtYmVyMjtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5DT01QTEVYID0gZnVuY3Rpb24ocmVhbCwgaW1hZ2luYXJ5LCBzdWZmaXgpIHtcclxuICAgICAgICByZWFsID0gdXRpbHMucGFyc2VOdW1iZXIocmVhbCk7XHJcbiAgICAgICAgaW1hZ2luYXJ5ID0gdXRpbHMucGFyc2VOdW1iZXIoaW1hZ2luYXJ5KTtcclxuICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihyZWFsLCBpbWFnaW5hcnkpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZWFsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gU2V0IHN1ZmZpeFxyXG4gICAgICAgIHN1ZmZpeCA9IChzdWZmaXggPT09IHVuZGVmaW5lZCkgPyAnaScgOiBzdWZmaXg7XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBzdWZmaXggaXMgbmVpdGhlciBcImlcIiBub3IgXCJqXCJcclxuICAgICAgICBpZiAoc3VmZml4ICE9PSAnaScgJiYgc3VmZml4ICE9PSAnaicpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIGNvbXBsZXggbnVtYmVyXHJcbiAgICAgICAgaWYgKHJlYWwgPT09IDAgJiYgaW1hZ2luYXJ5ID09PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocmVhbCA9PT0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gKGltYWdpbmFyeSA9PT0gMSkgPyBzdWZmaXggOiBpbWFnaW5hcnkudG9TdHJpbmcoKSArIHN1ZmZpeDtcclxuICAgICAgICB9IGVsc2UgaWYgKGltYWdpbmFyeSA9PT0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVhbC50b1N0cmluZygpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHZhciBzaWduID0gKGltYWdpbmFyeSA+IDApID8gJysnIDogJyc7XHJcbiAgICAgICAgICAgIHJldHVybiByZWFsLnRvU3RyaW5nKCkgKyBzaWduICsgKChpbWFnaW5hcnkgPT09IDEpID8gc3VmZml4IDogaW1hZ2luYXJ5LnRvU3RyaW5nKCkgKyBzdWZmaXgpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5DT05WRVJUID0gZnVuY3Rpb24obnVtYmVyLCBmcm9tX3VuaXQsIHRvX3VuaXQpIHtcclxuICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgIGlmIChudW1iZXIgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gTGlzdCBvZiB1bml0cyBzdXBwb3J0ZWQgYnkgQ09OVkVSVCBhbmQgdW5pdHMgZGVmaW5lZCBieSB0aGVcclxuICAgICAgICAvLyBJbnRlcm5hdGlvbmFsIFN5c3RlbSBvZiBVbml0c1xyXG4gICAgICAgIC8vIFtOYW1lLCBTeW1ib2wsIEFsdGVybmF0ZSBzeW1ib2xzLCBRdWFudGl0eSwgSVNVLCBDT05WRVJULCBDb252ZXJzaW9uXHJcbiAgICAgICAgLy8gcmF0aW9dXHJcbiAgICAgICAgdmFyIHVuaXRzID0gW1xyXG4gICAgICAgICAgICBbXCJhLnUuIG9mIGFjdGlvblwiLCBcIj9cIiwgbnVsbCwgXCJhY3Rpb25cIiwgZmFsc2UsIGZhbHNlLCAxLjA1NDU3MTY4MTgxODE4ZS0zNF0sXHJcbiAgICAgICAgICAgIFtcImEudS4gb2YgY2hhcmdlXCIsIFwiZVwiLCBudWxsLCBcImVsZWN0cmljX2NoYXJnZVwiLCBmYWxzZSwgZmFsc2UsIDEuNjAyMTc2NTMxNDE0MTRlLTE5XSxcclxuICAgICAgICAgICAgW1wiYS51LiBvZiBlbmVyZ3lcIiwgXCJFaFwiLCBudWxsLCBcImVuZXJneVwiLCBmYWxzZSwgZmFsc2UsIDQuMzU5NzQ0MTc3NTc1NzZlLTE4XSxcclxuICAgICAgICAgICAgW1wiYS51LiBvZiBsZW5ndGhcIiwgXCJhP1wiLCBudWxsLCBcImxlbmd0aFwiLCBmYWxzZSwgZmFsc2UsIDUuMjkxNzcyMTA4MTgxODJlLTExXSxcclxuICAgICAgICAgICAgW1wiYS51LiBvZiBtYXNzXCIsIFwibT9cIiwgbnVsbCwgXCJtYXNzXCIsIGZhbHNlLCBmYWxzZSwgOS4xMDkzODI2MTYxNjE2MmUtMzFdLFxyXG4gICAgICAgICAgICBbXCJhLnUuIG9mIHRpbWVcIiwgXCI/L0VoXCIsIG51bGwsIFwidGltZVwiLCBmYWxzZSwgZmFsc2UsIDIuNDE4ODg0MzI2NTA1MTZlLTE3XSxcclxuICAgICAgICAgICAgW1wiYWRtaXJhbHR5IGtub3RcIiwgXCJhZG1rblwiLCBudWxsLCBcInNwZWVkXCIsIGZhbHNlLCB0cnVlLCAwLjUxNDc3MzMzM10sXHJcbiAgICAgICAgICAgIFtcImFtcGVyZVwiLCBcIkFcIiwgbnVsbCwgXCJlbGVjdHJpY19jdXJyZW50XCIsIHRydWUsIGZhbHNlLCAxXSxcclxuICAgICAgICAgICAgW1wiYW1wZXJlIHBlciBtZXRlclwiLCBcIkEvbVwiLCBudWxsLCBcIm1hZ25ldGljX2ZpZWxkX2ludGVuc2l0eVwiLCB0cnVlLCBmYWxzZSwgMV0sXHJcbiAgICAgICAgICAgIFtcIsOlbmdzdHLDtm1cIiwgXCLDhVwiLCBbXCJhbmdcIl0sIFwibGVuZ3RoXCIsIGZhbHNlLCB0cnVlLCAxZS0xMF0sXHJcbiAgICAgICAgICAgIFtcImFyZVwiLCBcImFyXCIsIG51bGwsIFwiYXJlYVwiLCBmYWxzZSwgdHJ1ZSwgMTAwXSxcclxuICAgICAgICAgICAgW1wiYXN0cm9ub21pY2FsIHVuaXRcIiwgXCJ1YVwiLCBudWxsLCBcImxlbmd0aFwiLCBmYWxzZSwgZmFsc2UsIDEuNDk1OTc4NzA2OTE2NjdlLTExXSxcclxuICAgICAgICAgICAgW1wiYmFyXCIsIFwiYmFyXCIsIG51bGwsIFwicHJlc3N1cmVcIiwgZmFsc2UsIGZhbHNlLCAxMDAwMDBdLFxyXG4gICAgICAgICAgICBbXCJiYXJuXCIsIFwiYlwiLCBudWxsLCBcImFyZWFcIiwgZmFsc2UsIGZhbHNlLCAxZS0yOF0sXHJcbiAgICAgICAgICAgIFtcImJlY3F1ZXJlbFwiLCBcIkJxXCIsIG51bGwsIFwicmFkaW9hY3Rpdml0eVwiLCB0cnVlLCBmYWxzZSwgMV0sXHJcbiAgICAgICAgICAgIFtcImJpdFwiLCBcImJpdFwiLCBbXCJiXCJdLCBcImluZm9ybWF0aW9uXCIsIGZhbHNlLCB0cnVlLCAxXSxcclxuICAgICAgICAgICAgW1wiYnR1XCIsIFwiQlRVXCIsIFtcImJ0dVwiXSwgXCJlbmVyZ3lcIiwgZmFsc2UsIHRydWUsIDEwNTUuMDU1ODUyNjJdLFxyXG4gICAgICAgICAgICBbXCJieXRlXCIsIFwiYnl0ZVwiLCBudWxsLCBcImluZm9ybWF0aW9uXCIsIGZhbHNlLCB0cnVlLCA4XSxcclxuICAgICAgICAgICAgW1wiY2FuZGVsYVwiLCBcImNkXCIsIG51bGwsIFwibHVtaW5vdXNfaW50ZW5zaXR5XCIsIHRydWUsIGZhbHNlLCAxXSxcclxuICAgICAgICAgICAgW1wiY2FuZGVsYSBwZXIgc3F1YXJlIG1ldHJlXCIsIFwiY2QvbT9cIiwgbnVsbCwgXCJsdW1pbmFuY2VcIiwgdHJ1ZSwgZmFsc2UsIDFdLFxyXG4gICAgICAgICAgICBbXCJjb3Vsb21iXCIsIFwiQ1wiLCBudWxsLCBcImVsZWN0cmljX2NoYXJnZVwiLCB0cnVlLCBmYWxzZSwgMV0sXHJcbiAgICAgICAgICAgIFtcImN1YmljIMOlbmdzdHLDtm1cIiwgXCJhbmczXCIsIFtcImFuZ14zXCJdLCBcInZvbHVtZVwiLCBmYWxzZSwgdHJ1ZSwgMWUtMzBdLFxyXG4gICAgICAgICAgICBbXCJjdWJpYyBmb290XCIsIFwiZnQzXCIsIFtcImZ0XjNcIl0sIFwidm9sdW1lXCIsIGZhbHNlLCB0cnVlLCAwLjAyODMxNjg0NjU5Ml0sXHJcbiAgICAgICAgICAgIFtcImN1YmljIGluY2hcIiwgXCJpbjNcIiwgW1wiaW5eM1wiXSwgXCJ2b2x1bWVcIiwgZmFsc2UsIHRydWUsIDAuMDAwMDE2Mzg3MDY0XSxcclxuICAgICAgICAgICAgW1wiY3ViaWMgbGlnaHQteWVhclwiLCBcImx5M1wiLCBbXCJseV4zXCJdLCBcInZvbHVtZVwiLCBmYWxzZSwgdHJ1ZSwgOC40Njc4NjY2NDYyMzcxNWUtNDddLFxyXG4gICAgICAgICAgICBbXCJjdWJpYyBtZXRyZVwiLCBcIm0/XCIsIG51bGwsIFwidm9sdW1lXCIsIHRydWUsIHRydWUsIDFdLFxyXG4gICAgICAgICAgICBbXCJjdWJpYyBtaWxlXCIsIFwibWkzXCIsIFtcIm1pXjNcIl0sIFwidm9sdW1lXCIsIGZhbHNlLCB0cnVlLCA0MTY4MTgxODI1LjQ0MDU4XSxcclxuICAgICAgICAgICAgW1wiY3ViaWMgbmF1dGljYWwgbWlsZVwiLCBcIk5taTNcIiwgW1wiTm1pXjNcIl0sIFwidm9sdW1lXCIsIGZhbHNlLCB0cnVlLCA2MzUyMTgyMjA4XSxcclxuICAgICAgICAgICAgW1wiY3ViaWMgUGljYVwiLCBcIlBpY2EzXCIsIFtcIlBpY2FwdDNcIiwgXCJQaWNhXjNcIiwgXCJQaWNhcHReM1wiXSwgXCJ2b2x1bWVcIiwgZmFsc2UsIHRydWUsIDcuNTg2NjAzNzAzNzAzNjllLThdLFxyXG4gICAgICAgICAgICBbXCJjdWJpYyB5YXJkXCIsIFwieWQzXCIsIFtcInlkXjNcIl0sIFwidm9sdW1lXCIsIGZhbHNlLCB0cnVlLCAwLjc2NDU1NDg1Nzk4NF0sXHJcbiAgICAgICAgICAgIFtcImN1cFwiLCBcImN1cFwiLCBudWxsLCBcInZvbHVtZVwiLCBmYWxzZSwgdHJ1ZSwgMC4wMDAyMzY1ODgyMzY1XSxcclxuICAgICAgICAgICAgW1wiZGFsdG9uXCIsIFwiRGFcIiwgW1widVwiXSwgXCJtYXNzXCIsIGZhbHNlLCBmYWxzZSwgMS42NjA1Mzg4NjI4MjgyOGUtMjddLFxyXG4gICAgICAgICAgICBbXCJkYXlcIiwgXCJkXCIsIFtcImRheVwiXSwgXCJ0aW1lXCIsIGZhbHNlLCB0cnVlLCA4NjQwMF0sXHJcbiAgICAgICAgICAgIFtcImRlZ3JlZVwiLCBcIsKwXCIsIG51bGwsIFwiYW5nbGVcIiwgZmFsc2UsIGZhbHNlLCAwLjAxNzQ1MzI5MjUxOTk0MzNdLFxyXG4gICAgICAgICAgICBbXCJkZWdyZWVzIFJhbmtpbmVcIiwgXCJSYW5rXCIsIG51bGwsIFwidGVtcGVyYXR1cmVcIiwgZmFsc2UsIHRydWUsIDAuNTU1NTU1NTU1NTU1NTU2XSxcclxuICAgICAgICAgICAgW1wiZHluZVwiLCBcImR5blwiLCBbXCJkeVwiXSwgXCJmb3JjZVwiLCBmYWxzZSwgdHJ1ZSwgMC4wMDAwMV0sXHJcbiAgICAgICAgICAgIFtcImVsZWN0cm9udm9sdFwiLCBcImVWXCIsIFtcImV2XCJdLCBcImVuZXJneVwiLCBmYWxzZSwgdHJ1ZSwgMS42MDIxNzY1NjUxNDE0MV0sXHJcbiAgICAgICAgICAgIFtcImVsbFwiLCBcImVsbFwiLCBudWxsLCBcImxlbmd0aFwiLCBmYWxzZSwgdHJ1ZSwgMS4xNDNdLFxyXG4gICAgICAgICAgICBbXCJlcmdcIiwgXCJlcmdcIiwgW1wiZVwiXSwgXCJlbmVyZ3lcIiwgZmFsc2UsIHRydWUsIDFlLTddLFxyXG4gICAgICAgICAgICBbXCJmYXJhZFwiLCBcIkZcIiwgbnVsbCwgXCJlbGVjdHJpY19jYXBhY2l0YW5jZVwiLCB0cnVlLCBmYWxzZSwgMV0sXHJcbiAgICAgICAgICAgIFtcImZsdWlkIG91bmNlXCIsIFwib3pcIiwgbnVsbCwgXCJ2b2x1bWVcIiwgZmFsc2UsIHRydWUsIDAuMDAwMDI5NTczNTI5NTYyNV0sXHJcbiAgICAgICAgICAgIFtcImZvb3RcIiwgXCJmdFwiLCBudWxsLCBcImxlbmd0aFwiLCBmYWxzZSwgdHJ1ZSwgMC4zMDQ4XSxcclxuICAgICAgICAgICAgW1wiZm9vdC1wb3VuZFwiLCBcImZsYlwiLCBudWxsLCBcImVuZXJneVwiLCBmYWxzZSwgdHJ1ZSwgMS4zNTU4MTc5NDgzMzE0XSxcclxuICAgICAgICAgICAgW1wiZ2FsXCIsIFwiR2FsXCIsIG51bGwsIFwiYWNjZWxlcmF0aW9uXCIsIGZhbHNlLCBmYWxzZSwgMC4wMV0sXHJcbiAgICAgICAgICAgIFtcImdhbGxvblwiLCBcImdhbFwiLCBudWxsLCBcInZvbHVtZVwiLCBmYWxzZSwgdHJ1ZSwgMC4wMDM3ODU0MTE3ODRdLFxyXG4gICAgICAgICAgICBbXCJnYXVzc1wiLCBcIkdcIiwgW1wiZ2FcIl0sIFwibWFnbmV0aWNfZmx1eF9kZW5zaXR5XCIsIGZhbHNlLCB0cnVlLCAxXSxcclxuICAgICAgICAgICAgW1wiZ3JhaW5cIiwgXCJncmFpblwiLCBudWxsLCBcIm1hc3NcIiwgZmFsc2UsIHRydWUsIDAuMDAwMDY0Nzk4OV0sXHJcbiAgICAgICAgICAgIFtcImdyYW1cIiwgXCJnXCIsIG51bGwsIFwibWFzc1wiLCBmYWxzZSwgdHJ1ZSwgMC4wMDFdLFxyXG4gICAgICAgICAgICBbXCJncmF5XCIsIFwiR3lcIiwgbnVsbCwgXCJhYnNvcmJlZF9kb3NlXCIsIHRydWUsIGZhbHNlLCAxXSxcclxuICAgICAgICAgICAgW1wiZ3Jvc3MgcmVnaXN0ZXJlZCB0b25cIiwgXCJHUlRcIiwgW1wicmVndG9uXCJdLCBcInZvbHVtZVwiLCBmYWxzZSwgdHJ1ZSwgMi44MzE2ODQ2NTkyXSxcclxuICAgICAgICAgICAgW1wiaGVjdGFyZVwiLCBcImhhXCIsIG51bGwsIFwiYXJlYVwiLCBmYWxzZSwgdHJ1ZSwgMTAwMDBdLFxyXG4gICAgICAgICAgICBbXCJoZW5yeVwiLCBcIkhcIiwgbnVsbCwgXCJpbmR1Y3RhbmNlXCIsIHRydWUsIGZhbHNlLCAxXSxcclxuICAgICAgICAgICAgW1wiaGVydHpcIiwgXCJIelwiLCBudWxsLCBcImZyZXF1ZW5jeVwiLCB0cnVlLCBmYWxzZSwgMV0sXHJcbiAgICAgICAgICAgIFtcImhvcnNlcG93ZXJcIiwgXCJIUFwiLCBbXCJoXCJdLCBcInBvd2VyXCIsIGZhbHNlLCB0cnVlLCA3NDUuNjk5ODcxNTgyMjddLFxyXG4gICAgICAgICAgICBbXCJob3JzZXBvd2VyLWhvdXJcIiwgXCJIUGhcIiwgW1wiaGhcIiwgXCJocGhcIl0sIFwiZW5lcmd5XCIsIGZhbHNlLCB0cnVlLCAyNjg0NTE5LjUzOF0sXHJcbiAgICAgICAgICAgIFtcImhvdXJcIiwgXCJoXCIsIFtcImhyXCJdLCBcInRpbWVcIiwgZmFsc2UsIHRydWUsIDM2MDBdLFxyXG4gICAgICAgICAgICBbXCJpbXBlcmlhbCBnYWxsb24gKFUuSy4pXCIsIFwidWtfZ2FsXCIsIG51bGwsIFwidm9sdW1lXCIsIGZhbHNlLCB0cnVlLCAwLjAwNDU0NjA5XSxcclxuICAgICAgICAgICAgW1wiaW1wZXJpYWwgaHVuZHJlZHdlaWdodFwiLCBcImxjd3RcIiwgW1widWtfY3d0XCIsIFwiaHdlaWdodFwiXSwgXCJtYXNzXCIsIGZhbHNlLCB0cnVlLCA1MC44MDIzNDVdLFxyXG4gICAgICAgICAgICBbXCJpbXBlcmlhbCBxdWFydCAoVS5LKVwiLCBcInVrX3F0XCIsIG51bGwsIFwidm9sdW1lXCIsIGZhbHNlLCB0cnVlLCAwLjAwMTEzNjUyMjVdLFxyXG4gICAgICAgICAgICBbXCJpbXBlcmlhbCB0b25cIiwgXCJicnRvblwiLCBbXCJ1a190b25cIiwgXCJMVE9OXCJdLCBcIm1hc3NcIiwgZmFsc2UsIHRydWUsIDEwMTYuMDQ2OTA5XSxcclxuICAgICAgICAgICAgW1wiaW5jaFwiLCBcImluXCIsIG51bGwsIFwibGVuZ3RoXCIsIGZhbHNlLCB0cnVlLCAwLjAyNTRdLFxyXG4gICAgICAgICAgICBbXCJpbnRlcm5hdGlvbmFsIGFjcmVcIiwgXCJ1a19hY3JlXCIsIG51bGwsIFwiYXJlYVwiLCBmYWxzZSwgdHJ1ZSwgNDA0Ni44NTY0MjI0XSxcclxuICAgICAgICAgICAgW1wiSVQgY2Fsb3JpZVwiLCBcImNhbFwiLCBudWxsLCBcImVuZXJneVwiLCBmYWxzZSwgdHJ1ZSwgNC4xODY4XSxcclxuICAgICAgICAgICAgW1wiam91bGVcIiwgXCJKXCIsIG51bGwsIFwiZW5lcmd5XCIsIHRydWUsIHRydWUsIDFdLFxyXG4gICAgICAgICAgICBbXCJrYXRhbFwiLCBcImthdFwiLCBudWxsLCBcImNhdGFseXRpY19hY3Rpdml0eVwiLCB0cnVlLCBmYWxzZSwgMV0sXHJcbiAgICAgICAgICAgIFtcImtlbHZpblwiLCBcIktcIiwgW1wia2VsXCJdLCBcInRlbXBlcmF0dXJlXCIsIHRydWUsIHRydWUsIDFdLFxyXG4gICAgICAgICAgICBbXCJraWxvZ3JhbVwiLCBcImtnXCIsIG51bGwsIFwibWFzc1wiLCB0cnVlLCB0cnVlLCAxXSxcclxuICAgICAgICAgICAgW1wia25vdFwiLCBcImtuXCIsIG51bGwsIFwic3BlZWRcIiwgZmFsc2UsIHRydWUsIDAuNTE0NDQ0NDQ0NDQ0NDQ0XSxcclxuICAgICAgICAgICAgW1wibGlnaHQteWVhclwiLCBcImx5XCIsIG51bGwsIFwibGVuZ3RoXCIsIGZhbHNlLCB0cnVlLCA5NDYwNzMwNDcyNTgwODAwXSxcclxuICAgICAgICAgICAgW1wibGl0cmVcIiwgXCJMXCIsIFtcImxcIiwgXCJsdFwiXSwgXCJ2b2x1bWVcIiwgZmFsc2UsIHRydWUsIDAuMDAxXSxcclxuICAgICAgICAgICAgW1wibHVtZW5cIiwgXCJsbVwiLCBudWxsLCBcImx1bWlub3VzX2ZsdXhcIiwgdHJ1ZSwgZmFsc2UsIDFdLFxyXG4gICAgICAgICAgICBbXCJsdXhcIiwgXCJseFwiLCBudWxsLCBcImlsbHVtaW5hbmNlXCIsIHRydWUsIGZhbHNlLCAxXSxcclxuICAgICAgICAgICAgW1wibWF4d2VsbFwiLCBcIk14XCIsIG51bGwsIFwibWFnbmV0aWNfZmx1eFwiLCBmYWxzZSwgZmFsc2UsIDFlLTE4XSxcclxuICAgICAgICAgICAgW1wibWVhc3VyZW1lbnQgdG9uXCIsIFwiTVRPTlwiLCBudWxsLCBcInZvbHVtZVwiLCBmYWxzZSwgdHJ1ZSwgMS4xMzI2NzM4NjM2OF0sXHJcbiAgICAgICAgICAgIFtcIm1ldGVyIHBlciBob3VyXCIsIFwibS9oXCIsIFtcIm0vaHJcIl0sIFwic3BlZWRcIiwgZmFsc2UsIHRydWUsIDAuMDAwMjc3Nzc3Nzc3Nzc3NzhdLFxyXG4gICAgICAgICAgICBbXCJtZXRlciBwZXIgc2Vjb25kXCIsIFwibS9zXCIsIFtcIm0vc2VjXCJdLCBcInNwZWVkXCIsIHRydWUsIHRydWUsIDFdLFxyXG4gICAgICAgICAgICBbXCJtZXRlciBwZXIgc2Vjb25kIHNxdWFyZWRcIiwgXCJtP3M/P1wiLCBudWxsLCBcImFjY2VsZXJhdGlvblwiLCB0cnVlLCBmYWxzZSwgMV0sXHJcbiAgICAgICAgICAgIFtcInBhcnNlY1wiLCBcInBjXCIsIFtcInBhcnNlY1wiXSwgXCJsZW5ndGhcIiwgZmFsc2UsIHRydWUsIDMwODU2Nzc1ODE0NjcxOTAwXSxcclxuICAgICAgICAgICAgW1wibWV0ZXIgc3F1YXJlZCBwZXIgc2Vjb25kXCIsIFwibT8vc1wiLCBudWxsLCBcImtpbmVtYXRpY192aXNjb3NpdHlcIiwgdHJ1ZSwgZmFsc2UsIDFdLFxyXG4gICAgICAgICAgICBbXCJtZXRyZVwiLCBcIm1cIiwgbnVsbCwgXCJsZW5ndGhcIiwgdHJ1ZSwgdHJ1ZSwgMV0sXHJcbiAgICAgICAgICAgIFtcIm1pbGVzIHBlciBob3VyXCIsIFwibXBoXCIsIG51bGwsIFwic3BlZWRcIiwgZmFsc2UsIHRydWUsIDAuNDQ3MDRdLFxyXG4gICAgICAgICAgICBbXCJtaWxsaW1ldHJlIG9mIG1lcmN1cnlcIiwgXCJtbUhnXCIsIG51bGwsIFwicHJlc3N1cmVcIiwgZmFsc2UsIGZhbHNlLCAxMzMuMzIyXSxcclxuICAgICAgICAgICAgW1wibWludXRlXCIsIFwiP1wiLCBudWxsLCBcImFuZ2xlXCIsIGZhbHNlLCBmYWxzZSwgMC4wMDAyOTA4ODgyMDg2NjU3MjJdLFxyXG4gICAgICAgICAgICBbXCJtaW51dGVcIiwgXCJtaW5cIiwgW1wibW5cIl0sIFwidGltZVwiLCBmYWxzZSwgdHJ1ZSwgNjBdLFxyXG4gICAgICAgICAgICBbXCJtb2Rlcm4gdGVhc3Bvb25cIiwgXCJ0c3BtXCIsIG51bGwsIFwidm9sdW1lXCIsIGZhbHNlLCB0cnVlLCAwLjAwMDAwNV0sXHJcbiAgICAgICAgICAgIFtcIm1vbGVcIiwgXCJtb2xcIiwgbnVsbCwgXCJhbW91bnRfb2Zfc3Vic3RhbmNlXCIsIHRydWUsIGZhbHNlLCAxXSxcclxuICAgICAgICAgICAgW1wibW9yZ2VuXCIsIFwiTW9yZ2VuXCIsIG51bGwsIFwiYXJlYVwiLCBmYWxzZSwgdHJ1ZSwgMjUwMF0sXHJcbiAgICAgICAgICAgIFtcIm4udS4gb2YgYWN0aW9uXCIsIFwiP1wiLCBudWxsLCBcImFjdGlvblwiLCBmYWxzZSwgZmFsc2UsIDEuMDU0NTcxNjgxODE4MThlLTM0XSxcclxuICAgICAgICAgICAgW1wibi51LiBvZiBtYXNzXCIsIFwibT9cIiwgbnVsbCwgXCJtYXNzXCIsIGZhbHNlLCBmYWxzZSwgOS4xMDkzODI2MTYxNjE2MmUtMzFdLFxyXG4gICAgICAgICAgICBbXCJuLnUuIG9mIHNwZWVkXCIsIFwiYz9cIiwgbnVsbCwgXCJzcGVlZFwiLCBmYWxzZSwgZmFsc2UsIDI5OTc5MjQ1OF0sXHJcbiAgICAgICAgICAgIFtcIm4udS4gb2YgdGltZVwiLCBcIj8vKG1lP2M/PylcIiwgbnVsbCwgXCJ0aW1lXCIsIGZhbHNlLCBmYWxzZSwgMS4yODgwODg2Njc3ODY4N2UtMjFdLFxyXG4gICAgICAgICAgICBbXCJuYXV0aWNhbCBtaWxlXCIsIFwiTVwiLCBbXCJObWlcIl0sIFwibGVuZ3RoXCIsIGZhbHNlLCB0cnVlLCAxODUyXSxcclxuICAgICAgICAgICAgW1wibmV3dG9uXCIsIFwiTlwiLCBudWxsLCBcImZvcmNlXCIsIHRydWUsIHRydWUsIDFdLFxyXG4gICAgICAgICAgICBbXCLFk3JzdGVkXCIsIFwiT2UgXCIsIG51bGwsIFwibWFnbmV0aWNfZmllbGRfaW50ZW5zaXR5XCIsIGZhbHNlLCBmYWxzZSwgNzkuNTc3NDcxNTQ1OTQ3N10sXHJcbiAgICAgICAgICAgIFtcIm9obVwiLCBcIs6pXCIsIG51bGwsIFwiZWxlY3RyaWNfcmVzaXN0YW5jZVwiLCB0cnVlLCBmYWxzZSwgMV0sXHJcbiAgICAgICAgICAgIFtcIm91bmNlIG1hc3NcIiwgXCJvem1cIiwgbnVsbCwgXCJtYXNzXCIsIGZhbHNlLCB0cnVlLCAwLjAyODM0OTUyMzEyNV0sXHJcbiAgICAgICAgICAgIFtcInBhc2NhbFwiLCBcIlBhXCIsIG51bGwsIFwicHJlc3N1cmVcIiwgdHJ1ZSwgZmFsc2UsIDFdLFxyXG4gICAgICAgICAgICBbXCJwYXNjYWwgc2Vjb25kXCIsIFwiUGE/c1wiLCBudWxsLCBcImR5bmFtaWNfdmlzY29zaXR5XCIsIHRydWUsIGZhbHNlLCAxXSxcclxuICAgICAgICAgICAgW1wicGZlcmRlc3TDpHJrZVwiLCBcIlBTXCIsIG51bGwsIFwicG93ZXJcIiwgZmFsc2UsIHRydWUsIDczNS40OTg3NV0sXHJcbiAgICAgICAgICAgIFtcInBob3RcIiwgXCJwaFwiLCBudWxsLCBcImlsbHVtaW5hbmNlXCIsIGZhbHNlLCBmYWxzZSwgMC4wMDAxXSxcclxuICAgICAgICAgICAgW1wicGljYSAoMS82IGluY2gpXCIsIFwicGljYVwiLCBudWxsLCBcImxlbmd0aFwiLCBmYWxzZSwgdHJ1ZSwgMC4wMDAzNTI3Nzc3Nzc3Nzc3OF0sXHJcbiAgICAgICAgICAgIFtcInBpY2EgKDEvNzIgaW5jaClcIiwgXCJQaWNhXCIsIFtcIlBpY2FwdFwiXSwgXCJsZW5ndGhcIiwgZmFsc2UsIHRydWUsIDAuMDA0MjMzMzMzMzMzMzMzMzNdLFxyXG4gICAgICAgICAgICBbXCJwb2lzZVwiLCBcIlBcIiwgbnVsbCwgXCJkeW5hbWljX3Zpc2Nvc2l0eVwiLCBmYWxzZSwgZmFsc2UsIDAuMV0sXHJcbiAgICAgICAgICAgIFtcInBvbmRcIiwgXCJwb25kXCIsIG51bGwsIFwiZm9yY2VcIiwgZmFsc2UsIHRydWUsIDAuMDA5ODA2NjVdLFxyXG4gICAgICAgICAgICBbXCJwb3VuZCBmb3JjZVwiLCBcImxiZlwiLCBudWxsLCBcImZvcmNlXCIsIGZhbHNlLCB0cnVlLCA0LjQ0ODIyMTYxNTI2MDVdLFxyXG4gICAgICAgICAgICBbXCJwb3VuZCBtYXNzXCIsIFwibGJtXCIsIG51bGwsIFwibWFzc1wiLCBmYWxzZSwgdHJ1ZSwgMC40NTM1OTIzN10sXHJcbiAgICAgICAgICAgIFtcInF1YXJ0XCIsIFwicXRcIiwgbnVsbCwgXCJ2b2x1bWVcIiwgZmFsc2UsIHRydWUsIDAuMDAwOTQ2MzUyOTQ2XSxcclxuICAgICAgICAgICAgW1wicmFkaWFuXCIsIFwicmFkXCIsIG51bGwsIFwiYW5nbGVcIiwgdHJ1ZSwgZmFsc2UsIDFdLFxyXG4gICAgICAgICAgICBbXCJzZWNvbmRcIiwgXCI/XCIsIG51bGwsIFwiYW5nbGVcIiwgZmFsc2UsIGZhbHNlLCAwLjAwMDAwNDg0ODEzNjgxMTA5NTM2XSxcclxuICAgICAgICAgICAgW1wic2Vjb25kXCIsIFwic1wiLCBbXCJzZWNcIl0sIFwidGltZVwiLCB0cnVlLCB0cnVlLCAxXSxcclxuICAgICAgICAgICAgW1wic2hvcnQgaHVuZHJlZHdlaWdodFwiLCBcImN3dFwiLCBbXCJzaHdlaWdodFwiXSwgXCJtYXNzXCIsIGZhbHNlLCB0cnVlLCA0NS4zNTkyMzddLFxyXG4gICAgICAgICAgICBbXCJzaWVtZW5zXCIsIFwiU1wiLCBudWxsLCBcImVsZWN0cmljYWxfY29uZHVjdGFuY2VcIiwgdHJ1ZSwgZmFsc2UsIDFdLFxyXG4gICAgICAgICAgICBbXCJzaWV2ZXJ0XCIsIFwiU3ZcIiwgbnVsbCwgXCJlcXVpdmFsZW50X2Rvc2VcIiwgdHJ1ZSwgZmFsc2UsIDFdLFxyXG4gICAgICAgICAgICBbXCJzbHVnXCIsIFwic2dcIiwgbnVsbCwgXCJtYXNzXCIsIGZhbHNlLCB0cnVlLCAxNC41OTM5MDI5NF0sXHJcbiAgICAgICAgICAgIFtcInNxdWFyZSDDpW5nc3Ryw7ZtXCIsIFwiYW5nMlwiLCBbXCJhbmdeMlwiXSwgXCJhcmVhXCIsIGZhbHNlLCB0cnVlLCAxZS0yMF0sXHJcbiAgICAgICAgICAgIFtcInNxdWFyZSBmb290XCIsIFwiZnQyXCIsIFtcImZ0XjJcIl0sIFwiYXJlYVwiLCBmYWxzZSwgdHJ1ZSwgMC4wOTI5MDMwNF0sXHJcbiAgICAgICAgICAgIFtcInNxdWFyZSBpbmNoXCIsIFwiaW4yXCIsIFtcImluXjJcIl0sIFwiYXJlYVwiLCBmYWxzZSwgdHJ1ZSwgMC4wMDA2NDUxNl0sXHJcbiAgICAgICAgICAgIFtcInNxdWFyZSBsaWdodC15ZWFyXCIsIFwibHkyXCIsIFtcImx5XjJcIl0sIFwiYXJlYVwiLCBmYWxzZSwgdHJ1ZSwgOC45NTA1NDIxMDc0ODE4OWUrMzFdLFxyXG4gICAgICAgICAgICBbXCJzcXVhcmUgbWV0ZXJcIiwgXCJtP1wiLCBudWxsLCBcImFyZWFcIiwgdHJ1ZSwgdHJ1ZSwgMV0sXHJcbiAgICAgICAgICAgIFtcInNxdWFyZSBtaWxlXCIsIFwibWkyXCIsIFtcIm1pXjJcIl0sIFwiYXJlYVwiLCBmYWxzZSwgdHJ1ZSwgMjU4OTk4OC4xMTAzMzZdLFxyXG4gICAgICAgICAgICBbXCJzcXVhcmUgbmF1dGljYWwgbWlsZVwiLCBcIk5taTJcIiwgW1wiTm1pXjJcIl0sIFwiYXJlYVwiLCBmYWxzZSwgdHJ1ZSwgMzQyOTkwNF0sXHJcbiAgICAgICAgICAgIFtcInNxdWFyZSBQaWNhXCIsIFwiUGljYTJcIiwgW1wiUGljYXB0MlwiLCBcIlBpY2FeMlwiLCBcIlBpY2FwdF4yXCJdLCBcImFyZWFcIiwgZmFsc2UsIHRydWUsIDAuMDAwMDE3OTIxMTExMTExMTFdLFxyXG4gICAgICAgICAgICBbXCJzcXVhcmUgeWFyZFwiLCBcInlkMlwiLCBbXCJ5ZF4yXCJdLCBcImFyZWFcIiwgZmFsc2UsIHRydWUsIDAuODM2MTI3MzZdLFxyXG4gICAgICAgICAgICBbXCJzdGF0dXRlIG1pbGVcIiwgXCJtaVwiLCBudWxsLCBcImxlbmd0aFwiLCBmYWxzZSwgdHJ1ZSwgMTYwOS4zNDRdLFxyXG4gICAgICAgICAgICBbXCJzdGVyYWRpYW5cIiwgXCJzclwiLCBudWxsLCBcInNvbGlkX2FuZ2xlXCIsIHRydWUsIGZhbHNlLCAxXSxcclxuICAgICAgICAgICAgW1wic3RpbGJcIiwgXCJzYlwiLCBudWxsLCBcImx1bWluYW5jZVwiLCBmYWxzZSwgZmFsc2UsIDAuMDAwMV0sXHJcbiAgICAgICAgICAgIFtcInN0b2tlc1wiLCBcIlN0XCIsIG51bGwsIFwia2luZW1hdGljX3Zpc2Nvc2l0eVwiLCBmYWxzZSwgZmFsc2UsIDAuMDAwMV0sXHJcbiAgICAgICAgICAgIFtcInN0b25lXCIsIFwic3RvbmVcIiwgbnVsbCwgXCJtYXNzXCIsIGZhbHNlLCB0cnVlLCA2LjM1MDI5MzE4XSxcclxuICAgICAgICAgICAgW1widGFibGVzcG9vblwiLCBcInRic1wiLCBudWxsLCBcInZvbHVtZVwiLCBmYWxzZSwgdHJ1ZSwgMC4wMDAwMTQ3ODY4XSxcclxuICAgICAgICAgICAgW1widGVhc3Bvb25cIiwgXCJ0c3BcIiwgbnVsbCwgXCJ2b2x1bWVcIiwgZmFsc2UsIHRydWUsIDAuMDAwMDA0OTI4OTJdLFxyXG4gICAgICAgICAgICBbXCJ0ZXNsYVwiLCBcIlRcIiwgbnVsbCwgXCJtYWduZXRpY19mbHV4X2RlbnNpdHlcIiwgdHJ1ZSwgdHJ1ZSwgMV0sXHJcbiAgICAgICAgICAgIFtcInRoZXJtb2R5bmFtaWMgY2Fsb3JpZVwiLCBcImNcIiwgbnVsbCwgXCJlbmVyZ3lcIiwgZmFsc2UsIHRydWUsIDQuMTg0XSxcclxuICAgICAgICAgICAgW1widG9uXCIsIFwidG9uXCIsIG51bGwsIFwibWFzc1wiLCBmYWxzZSwgdHJ1ZSwgOTA3LjE4NDc0XSxcclxuICAgICAgICAgICAgW1widG9ubmVcIiwgXCJ0XCIsIG51bGwsIFwibWFzc1wiLCBmYWxzZSwgZmFsc2UsIDEwMDBdLFxyXG4gICAgICAgICAgICBbXCJVLksuIHBpbnRcIiwgXCJ1a19wdFwiLCBudWxsLCBcInZvbHVtZVwiLCBmYWxzZSwgdHJ1ZSwgMC4wMDA1NjgyNjEyNV0sXHJcbiAgICAgICAgICAgIFtcIlUuUy4gYnVzaGVsXCIsIFwiYnVzaGVsXCIsIG51bGwsIFwidm9sdW1lXCIsIGZhbHNlLCB0cnVlLCAwLjAzNTIzOTA3XSxcclxuICAgICAgICAgICAgW1wiVS5TLiBvaWwgYmFycmVsXCIsIFwiYmFycmVsXCIsIG51bGwsIFwidm9sdW1lXCIsIGZhbHNlLCB0cnVlLCAwLjE1ODk4NzI5NV0sXHJcbiAgICAgICAgICAgIFtcIlUuUy4gcGludFwiLCBcInB0XCIsIFtcInVzX3B0XCJdLCBcInZvbHVtZVwiLCBmYWxzZSwgdHJ1ZSwgMC4wMDA0NzMxNzY0NzNdLFxyXG4gICAgICAgICAgICBbXCJVLlMuIHN1cnZleSBtaWxlXCIsIFwic3VydmV5X21pXCIsIG51bGwsIFwibGVuZ3RoXCIsIGZhbHNlLCB0cnVlLCAxNjA5LjM0NzIxOV0sXHJcbiAgICAgICAgICAgIFtcIlUuUy4gc3VydmV5L3N0YXR1dGUgYWNyZVwiLCBcInVzX2FjcmVcIiwgbnVsbCwgXCJhcmVhXCIsIGZhbHNlLCB0cnVlLCA0MDQ2Ljg3MjYxXSxcclxuICAgICAgICAgICAgW1widm9sdFwiLCBcIlZcIiwgbnVsbCwgXCJ2b2x0YWdlXCIsIHRydWUsIGZhbHNlLCAxXSxcclxuICAgICAgICAgICAgW1wid2F0dFwiLCBcIldcIiwgbnVsbCwgXCJwb3dlclwiLCB0cnVlLCB0cnVlLCAxXSxcclxuICAgICAgICAgICAgW1wid2F0dC1ob3VyXCIsIFwiV2hcIiwgW1wid2hcIl0sIFwiZW5lcmd5XCIsIGZhbHNlLCB0cnVlLCAzNjAwXSxcclxuICAgICAgICAgICAgW1wid2ViZXJcIiwgXCJXYlwiLCBudWxsLCBcIm1hZ25ldGljX2ZsdXhcIiwgdHJ1ZSwgZmFsc2UsIDFdLFxyXG4gICAgICAgICAgICBbXCJ5YXJkXCIsIFwieWRcIiwgbnVsbCwgXCJsZW5ndGhcIiwgZmFsc2UsIHRydWUsIDAuOTE0NF0sXHJcbiAgICAgICAgICAgIFtcInllYXJcIiwgXCJ5clwiLCBudWxsLCBcInRpbWVcIiwgZmFsc2UsIHRydWUsIDMxNTU3NjAwXVxyXG4gICAgICAgIF07XHJcblxyXG4gICAgICAgIC8vIEJpbmFyeSBwcmVmaXhlc1xyXG4gICAgICAgIC8vIFtOYW1lLCBQcmVmaXggcG93ZXIgb2YgMiB2YWx1ZSwgUHJldml4IHZhbHVlLCBBYmJyZXZpYXRpb24sIERlcml2ZWRcclxuICAgICAgICAvLyBmcm9tXVxyXG4gICAgICAgIHZhciBiaW5hcnlfcHJlZml4ZXMgPSB7XHJcbiAgICAgICAgICAgIFlpOiBbXCJ5b2JpXCIsIDgwLCAxMjA4OTI1ODE5NjE0NjI5MTc0NzA2MTc2LCBcIllpXCIsIFwieW90dGFcIl0sXHJcbiAgICAgICAgICAgIFppOiBbXCJ6ZWJpXCIsIDcwLCAxMTgwNTkxNjIwNzE3NDExMzAzNDI0LCBcIlppXCIsIFwiemV0dGFcIl0sXHJcbiAgICAgICAgICAgIEVpOiBbXCJleGJpXCIsIDYwLCAxMTUyOTIxNTA0NjA2ODQ2OTc2LCBcIkVpXCIsIFwiZXhhXCJdLFxyXG4gICAgICAgICAgICBQaTogW1wicGViaVwiLCA1MCwgMTEyNTg5OTkwNjg0MjYyNCwgXCJQaVwiLCBcInBldGFcIl0sXHJcbiAgICAgICAgICAgIFRpOiBbXCJ0ZWJpXCIsIDQwLCAxMDk5NTExNjI3Nzc2LCBcIlRpXCIsIFwidGVyYVwiXSxcclxuICAgICAgICAgICAgR2k6IFtcImdpYmlcIiwgMzAsIDEwNzM3NDE4MjQsIFwiR2lcIiwgXCJnaWdhXCJdLFxyXG4gICAgICAgICAgICBNaTogW1wibWViaVwiLCAyMCwgMTA0ODU3NiwgXCJNaVwiLCBcIm1lZ2FcIl0sXHJcbiAgICAgICAgICAgIGtpOiBbXCJraWJpXCIsIDEwLCAxMDI0LCBcImtpXCIsIFwia2lsb1wiXVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIFVuaXQgcHJlZml4ZXNcclxuICAgICAgICAvLyBbTmFtZSwgTXVsdGlwbGllciwgQWJicmV2aWF0aW9uXVxyXG4gICAgICAgIHZhciB1bml0X3ByZWZpeGVzID0ge1xyXG4gICAgICAgICAgICBZOiBbXCJ5b3R0YVwiLCAxZSsyNCwgXCJZXCJdLFxyXG4gICAgICAgICAgICBaOiBbXCJ6ZXR0YVwiLCAxZSsyMSwgXCJaXCJdLFxyXG4gICAgICAgICAgICBFOiBbXCJleGFcIiwgMWUrMTgsIFwiRVwiXSxcclxuICAgICAgICAgICAgUDogW1wicGV0YVwiLCAxZSsxNSwgXCJQXCJdLFxyXG4gICAgICAgICAgICBUOiBbXCJ0ZXJhXCIsIDFlKzEyLCBcIlRcIl0sXHJcbiAgICAgICAgICAgIEc6IFtcImdpZ2FcIiwgMWUrMDksIFwiR1wiXSxcclxuICAgICAgICAgICAgTTogW1wibWVnYVwiLCAxZSswNiwgXCJNXCJdLFxyXG4gICAgICAgICAgICBrOiBbXCJraWxvXCIsIDFlKzAzLCBcImtcIl0sXHJcbiAgICAgICAgICAgIGg6IFtcImhlY3RvXCIsIDFlKzAyLCBcImhcIl0sXHJcbiAgICAgICAgICAgIGU6IFtcImRla2FvXCIsIDFlKzAxLCBcImVcIl0sXHJcbiAgICAgICAgICAgIGQ6IFtcImRlY2lcIiwgMWUtMDEsIFwiZFwiXSxcclxuICAgICAgICAgICAgYzogW1wiY2VudGlcIiwgMWUtMDIsIFwiY1wiXSxcclxuICAgICAgICAgICAgbTogW1wibWlsbGlcIiwgMWUtMDMsIFwibVwiXSxcclxuICAgICAgICAgICAgdTogW1wibWljcm9cIiwgMWUtMDYsIFwidVwiXSxcclxuICAgICAgICAgICAgbjogW1wibmFub1wiLCAxZS0wOSwgXCJuXCJdLFxyXG4gICAgICAgICAgICBwOiBbXCJwaWNvXCIsIDFlLTEyLCBcInBcIl0sXHJcbiAgICAgICAgICAgIGY6IFtcImZlbXRvXCIsIDFlLTE1LCBcImZcIl0sXHJcbiAgICAgICAgICAgIGE6IFtcImF0dG9cIiwgMWUtMTgsIFwiYVwiXSxcclxuICAgICAgICAgICAgejogW1wiemVwdG9cIiwgMWUtMjEsIFwielwiXSxcclxuICAgICAgICAgICAgeTogW1wieW9jdG9cIiwgMWUtMjQsIFwieVwiXVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIEluaXRpYWxpemUgdW5pdHMgYW5kIG11bHRpcGxpZXJzXHJcbiAgICAgICAgdmFyIGZyb20gPSBudWxsO1xyXG4gICAgICAgIHZhciB0byA9IG51bGw7XHJcbiAgICAgICAgdmFyIGJhc2VfZnJvbV91bml0ID0gZnJvbV91bml0O1xyXG4gICAgICAgIHZhciBiYXNlX3RvX3VuaXQgPSB0b191bml0O1xyXG4gICAgICAgIHZhciBmcm9tX211bHRpcGxpZXIgPSAxO1xyXG4gICAgICAgIHZhciB0b19tdWx0aXBsaWVyID0gMTtcclxuICAgICAgICB2YXIgYWx0O1xyXG5cclxuICAgICAgICAvLyBMb29rdXAgZnJvbSBhbmQgdG8gdW5pdHNcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHVuaXRzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGFsdCA9ICh1bml0c1tpXVsyXSA9PT0gbnVsbCkgPyBbXSA6IHVuaXRzW2ldWzJdO1xyXG4gICAgICAgICAgICBpZiAodW5pdHNbaV1bMV0gPT09IGJhc2VfZnJvbV91bml0IHx8IGFsdC5pbmRleE9mKGJhc2VfZnJvbV91bml0KSA+PSAwKSB7XHJcbiAgICAgICAgICAgICAgZnJvbSA9IHVuaXRzW2ldO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh1bml0c1tpXVsxXSA9PT0gYmFzZV90b191bml0IHx8IGFsdC5pbmRleE9mKGJhc2VfdG9fdW5pdCkgPj0gMCkge1xyXG4gICAgICAgICAgICAgIHRvID0gdW5pdHNbaV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIExvb2t1cCBmcm9tIHByZWZpeFxyXG4gICAgICAgIGlmIChmcm9tID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHZhciBmcm9tX2JpbmFyeV9wcmVmaXggPSBiaW5hcnlfcHJlZml4ZXNbZnJvbV91bml0LnN1YnN0cmluZygwLCAyKV07XHJcbiAgICAgICAgICAgIHZhciBmcm9tX3VuaXRfcHJlZml4ID0gdW5pdF9wcmVmaXhlc1tmcm9tX3VuaXQuc3Vic3RyaW5nKDAsIDEpXTtcclxuXHJcbiAgICAgICAgICAgIC8vIEhhbmRsZSBkZWthbyB1bml0IHByZWZpeCAob25seSB1bml0IHByZWZpeCB3aXRoIHR3byBjaGFyYWN0ZXJzKVxyXG4gICAgICAgICAgICBpZiAoZnJvbV91bml0LnN1YnN0cmluZygwLCAyKSA9PT0gJ2RhJykge1xyXG4gICAgICAgICAgICAgIGZyb21fdW5pdF9wcmVmaXggPSBbXCJkZWthb1wiLCAxZSswMSwgXCJkYVwiXTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gSGFuZGxlIGJpbmFyeSBwcmVmaXhlcyBmaXJzdCAoc28gdGhhdCAnWWknIGlzIHByb2Nlc3NlZCBiZWZvcmVcclxuICAgICAgICAgICAgLy8gJ1knKVxyXG4gICAgICAgICAgICBpZiAoZnJvbV9iaW5hcnlfcHJlZml4KSB7XHJcbiAgICAgICAgICAgICAgZnJvbV9tdWx0aXBsaWVyID0gZnJvbV9iaW5hcnlfcHJlZml4WzJdO1xyXG4gICAgICAgICAgICAgIGJhc2VfZnJvbV91bml0ID0gZnJvbV91bml0LnN1YnN0cmluZygyKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChmcm9tX3VuaXRfcHJlZml4KSB7XHJcbiAgICAgICAgICAgICAgZnJvbV9tdWx0aXBsaWVyID0gZnJvbV91bml0X3ByZWZpeFsxXTtcclxuICAgICAgICAgICAgICBiYXNlX2Zyb21fdW5pdCA9IGZyb21fdW5pdC5zdWJzdHJpbmcoZnJvbV91bml0X3ByZWZpeFsyXS5sZW5ndGgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBMb29rdXAgZnJvbSB1bml0XHJcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgdW5pdHMubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgICBhbHQgPSAodW5pdHNbal1bMl0gPT09IG51bGwpID8gW10gOiB1bml0c1tqXVsyXTtcclxuICAgICAgICAgICAgICBpZiAodW5pdHNbal1bMV0gPT09IGJhc2VfZnJvbV91bml0IHx8IGFsdC5pbmRleE9mKGJhc2VfZnJvbV91bml0KSA+PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgIGZyb20gPSB1bml0c1tqXTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIExvb2t1cCB0byBwcmVmaXhcclxuICAgICAgICBpZiAodG8gPT09IG51bGwpIHtcclxuICAgICAgICAgICAgdmFyIHRvX2JpbmFyeV9wcmVmaXggPSBiaW5hcnlfcHJlZml4ZXNbdG9fdW5pdC5zdWJzdHJpbmcoMCwgMildO1xyXG4gICAgICAgICAgICB2YXIgdG9fdW5pdF9wcmVmaXggPSB1bml0X3ByZWZpeGVzW3RvX3VuaXQuc3Vic3RyaW5nKDAsIDEpXTtcclxuXHJcbiAgICAgICAgICAgIC8vIEhhbmRsZSBkZWthbyB1bml0IHByZWZpeCAob25seSB1bml0IHByZWZpeCB3aXRoIHR3byBjaGFyYWN0ZXJzKVxyXG4gICAgICAgICAgICBpZiAodG9fdW5pdC5zdWJzdHJpbmcoMCwgMikgPT09ICdkYScpIHtcclxuICAgICAgICAgICAgICB0b191bml0X3ByZWZpeCA9IFtcImRla2FvXCIsIDFlKzAxLCBcImRhXCJdO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBIYW5kbGUgYmluYXJ5IHByZWZpeGVzIGZpcnN0IChzbyB0aGF0ICdZaScgaXMgcHJvY2Vzc2VkIGJlZm9yZVxyXG4gICAgICAgICAgICAvLyAnWScpXHJcbiAgICAgICAgICAgIGlmICh0b19iaW5hcnlfcHJlZml4KSB7XHJcbiAgICAgICAgICAgICAgdG9fbXVsdGlwbGllciA9IHRvX2JpbmFyeV9wcmVmaXhbMl07XHJcbiAgICAgICAgICAgICAgYmFzZV90b191bml0ID0gdG9fdW5pdC5zdWJzdHJpbmcoMik7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodG9fdW5pdF9wcmVmaXgpIHtcclxuICAgICAgICAgICAgICB0b19tdWx0aXBsaWVyID0gdG9fdW5pdF9wcmVmaXhbMV07XHJcbiAgICAgICAgICAgICAgYmFzZV90b191bml0ID0gdG9fdW5pdC5zdWJzdHJpbmcodG9fdW5pdF9wcmVmaXhbMl0ubGVuZ3RoKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gTG9va3VwIHRvIHVuaXRcclxuICAgICAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCB1bml0cy5sZW5ndGg7IGsrKykge1xyXG4gICAgICAgICAgICAgIGFsdCA9ICh1bml0c1trXVsyXSA9PT0gbnVsbCkgPyBbXSA6IHVuaXRzW2tdWzJdO1xyXG4gICAgICAgICAgICAgIGlmICh1bml0c1trXVsxXSA9PT0gYmFzZV90b191bml0IHx8IGFsdC5pbmRleE9mKGJhc2VfdG9fdW5pdCkgPj0gMCkge1xyXG4gICAgICAgICAgICAgICAgICB0byA9IHVuaXRzW2tdO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIGEgdW5pdCBkb2VzIG5vdCBleGlzdFxyXG4gICAgICAgIGlmIChmcm9tID09PSBudWxsIHx8IHRvID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5uYTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBlcnJvciBpZiB1bml0cyByZXByZXNlbnQgZGlmZmVyZW50IHF1YW50aXRpZXNcclxuICAgICAgICBpZiAoZnJvbVszXSAhPT0gdG9bM10pIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLm5hO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIGNvbnZlcnRlZCBudW1iZXJcclxuICAgICAgICByZXR1cm4gbnVtYmVyICogZnJvbVs2XSAqIGZyb21fbXVsdGlwbGllciAvICh0b1s2XSAqIHRvX211bHRpcGxpZXIpO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLkRFQzJCSU4gPSBmdW5jdGlvbihudW1iZXIsIHBsYWNlcykge1xyXG4gICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgaWYgKG51bWJlciBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudW1iZXI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgbnVtYmVyIGlzIG5vdCBkZWNpbWFsLCBpcyBsb3dlciB0aGFuIC01MTIsIG9yIGlzXHJcbiAgICAgICAgLy8gZ3JlYXRlciB0aGFuIDUxMVxyXG4gICAgICAgIGlmICghL14tP1swLTldezEsM30kLy50ZXN0KG51bWJlcikgfHwgbnVtYmVyIDwgLTUxMiB8fCBudW1iZXIgPiA1MTEpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIElnbm9yZSBwbGFjZXMgYW5kIHJldHVybiBhIDEwLWNoYXJhY3RlciBiaW5hcnkgbnVtYmVyIGlmIG51bWJlciBpc1xyXG4gICAgICAgIC8vIG5lZ2F0aXZlXHJcbiAgICAgICAgaWYgKG51bWJlciA8IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuICcxJyArIFJFUFQoJzAnLCA5IC0gKDUxMiArIG51bWJlcikudG9TdHJpbmcoMikubGVuZ3RoKSArICg1MTIgKyBudW1iZXIpLnRvU3RyaW5nKDIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQ29udmVydCBkZWNpbWFsIG51bWJlciB0byBiaW5hcnlcclxuICAgICAgICB2YXIgcmVzdWx0ID0gcGFyc2VJbnQobnVtYmVyLCAxMCkudG9TdHJpbmcoMik7XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBiaW5hcnkgbnVtYmVyIHVzaW5nIHRoZSBtaW5pbXVtIG51bWJlciBvZiBjaGFyYWN0ZXJzIG5lY2Vzc2FyeVxyXG4gICAgICAgIC8vIGlmIHBsYWNlcyBpcyB1bmRlZmluZWRcclxuICAgICAgICBpZiAodHlwZW9mIHBsYWNlcyA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgcGxhY2VzIGlzIG5vbm51bWVyaWNcclxuICAgICAgICAgICAgaWYgKGlzTmFOKHBsYWNlcykpIHtcclxuICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBwbGFjZXMgaXMgbmVnYXRpdmVcclxuICAgICAgICAgICAgaWYgKHBsYWNlcyA8IDApIHtcclxuICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBUcnVuY2F0ZSBwbGFjZXMgaW4gY2FzZSBpdCBpcyBub3QgYW4gaW50ZWdlclxyXG4gICAgICAgICAgICBwbGFjZXMgPSBNYXRoLmZsb29yKHBsYWNlcyk7XHJcblxyXG4gICAgICAgICAgICAvLyBQYWQgcmV0dXJuIHZhbHVlIHdpdGggbGVhZGluZyAwcyAoemVyb3MpIGlmIG5lY2Vzc2FyeSAodXNpbmdcclxuICAgICAgICAgICAgLy8gVW5kZXJzY29yZS5zdHJpbmcpXHJcbiAgICAgICAgICAgIHJldHVybiAocGxhY2VzID49IHJlc3VsdC5sZW5ndGgpID8gUkVQVCgnMCcsIHBsYWNlcyAtIHJlc3VsdC5sZW5ndGgpICsgcmVzdWx0IDogZXJyb3IubnVtO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5ERUMySEVYID0gZnVuY3Rpb24obnVtYmVyLCBwbGFjZXMpIHtcclxuICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgIGlmIChudW1iZXIgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIG51bWJlciBpcyBub3QgZGVjaW1hbCwgaXMgbG93ZXIgdGhhbiAtNTQ5NzU1ODEzODg4LFxyXG4gICAgICAgIC8vIG9yIGlzIGdyZWF0ZXIgdGhhbiA1NDk3NTU4MTM4ODdcclxuICAgICAgICBpZiAoIS9eLT9bMC05XXsxLDEyfSQvLnRlc3QobnVtYmVyKSB8fCBudW1iZXIgPCAtNTQ5NzU1ODEzODg4IHx8IG51bWJlciA+IDU0OTc1NTgxMzg4Nykge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gSWdub3JlIHBsYWNlcyBhbmQgcmV0dXJuIGEgMTAtY2hhcmFjdGVyIGhleGFkZWNpbWFsIG51bWJlciBpZiBudW1iZXJcclxuICAgICAgICAvLyBpcyBuZWdhdGl2ZVxyXG4gICAgICAgIGlmIChudW1iZXIgPCAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAoMTA5OTUxMTYyNzc3NiArIG51bWJlcikudG9TdHJpbmcoMTYpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQ29udmVydCBkZWNpbWFsIG51bWJlciB0byBoZXhhZGVjaW1hbFxyXG4gICAgICAgIHZhciByZXN1bHQgPSBwYXJzZUludChudW1iZXIsIDEwKS50b1N0cmluZygxNik7XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBoZXhhZGVjaW1hbCBudW1iZXIgdXNpbmcgdGhlIG1pbmltdW0gbnVtYmVyIG9mIGNoYXJhY3RlcnNcclxuICAgICAgICAvLyBuZWNlc3NhcnkgaWYgcGxhY2VzIGlzIHVuZGVmaW5lZFxyXG4gICAgICAgIGlmICh0eXBlb2YgcGxhY2VzID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBwbGFjZXMgaXMgbm9ubnVtZXJpY1xyXG4gICAgICAgICAgICBpZiAoaXNOYU4ocGxhY2VzKSkge1xyXG4gICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIHBsYWNlcyBpcyBuZWdhdGl2ZVxyXG4gICAgICAgICAgICBpZiAocGxhY2VzIDwgMCkge1xyXG4gICAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFRydW5jYXRlIHBsYWNlcyBpbiBjYXNlIGl0IGlzIG5vdCBhbiBpbnRlZ2VyXHJcbiAgICAgICAgICAgIHBsYWNlcyA9IE1hdGguZmxvb3IocGxhY2VzKTtcclxuXHJcbiAgICAgICAgICAgIC8vIFBhZCByZXR1cm4gdmFsdWUgd2l0aCBsZWFkaW5nIDBzICh6ZXJvcykgaWYgbmVjZXNzYXJ5ICh1c2luZ1xyXG4gICAgICAgICAgICAvLyBVbmRlcnNjb3JlLnN0cmluZylcclxuICAgICAgICAgICAgcmV0dXJuIChwbGFjZXMgPj0gcmVzdWx0Lmxlbmd0aCkgPyBSRVBUKCcwJywgcGxhY2VzIC0gcmVzdWx0Lmxlbmd0aCkgKyByZXN1bHQgOiBlcnJvci5udW07XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLkRFQzJPQ1QgPSBmdW5jdGlvbihudW1iZXIsIHBsYWNlcykge1xyXG4gICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgaWYgKG51bWJlciBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudW1iZXI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgbnVtYmVyIGlzIG5vdCBkZWNpbWFsLCBpcyBsb3dlciB0aGFuIC01NDk3NTU4MTM4ODgsXHJcbiAgICAgICAgLy8gb3IgaXMgZ3JlYXRlciB0aGFuIDU0OTc1NTgxMzg4N1xyXG4gICAgICAgIGlmICghL14tP1swLTldezEsOX0kLy50ZXN0KG51bWJlcikgfHwgbnVtYmVyIDwgLTUzNjg3MDkxMiB8fCBudW1iZXIgPiA1MzY4NzA5MTEpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIElnbm9yZSBwbGFjZXMgYW5kIHJldHVybiBhIDEwLWNoYXJhY3RlciBvY3RhbCBudW1iZXIgaWYgbnVtYmVyIGlzXHJcbiAgICAgICAgLy8gbmVnYXRpdmVcclxuICAgICAgICBpZiAobnVtYmVyIDwgMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gKDEwNzM3NDE4MjQgKyBudW1iZXIpLnRvU3RyaW5nKDgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQ29udmVydCBkZWNpbWFsIG51bWJlciB0byBvY3RhbFxyXG4gICAgICAgIHZhciByZXN1bHQgPSBwYXJzZUludChudW1iZXIsIDEwKS50b1N0cmluZyg4KTtcclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIG9jdGFsIG51bWJlciB1c2luZyB0aGUgbWluaW11bSBudW1iZXIgb2YgY2hhcmFjdGVycyBuZWNlc3NhcnlcclxuICAgICAgICAvLyBpZiBwbGFjZXMgaXMgdW5kZWZpbmVkXHJcbiAgICAgICAgaWYgKHR5cGVvZiBwbGFjZXMgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIHBsYWNlcyBpcyBub25udW1lcmljXHJcbiAgICAgICAgICAgIGlmIChpc05hTihwbGFjZXMpKSB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgcGxhY2VzIGlzIG5lZ2F0aXZlXHJcbiAgICAgICAgICAgIGlmIChwbGFjZXMgPCAwKSB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gVHJ1bmNhdGUgcGxhY2VzIGluIGNhc2UgaXQgaXMgbm90IGFuIGludGVnZXJcclxuICAgICAgICAgICAgcGxhY2VzID0gTWF0aC5mbG9vcihwbGFjZXMpO1xyXG5cclxuICAgICAgICAgICAgLy8gUGFkIHJldHVybiB2YWx1ZSB3aXRoIGxlYWRpbmcgMHMgKHplcm9zKSBpZiBuZWNlc3NhcnkgKHVzaW5nXHJcbiAgICAgICAgICAgIC8vIFVuZGVyc2NvcmUuc3RyaW5nKVxyXG4gICAgICAgICAgICByZXR1cm4gKHBsYWNlcyA+PSByZXN1bHQubGVuZ3RoKSA/IFJFUFQoJzAnLCBwbGFjZXMgLSByZXN1bHQubGVuZ3RoKSArIHJlc3VsdCA6IGVycm9yLm51bTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuREVMVEEgPSBmdW5jdGlvbihudW1iZXIxLCBudW1iZXIyKSB7XHJcbiAgICAgICAgLy8gU2V0IG51bWJlcjIgdG8gemVybyBpZiB1bmRlZmluZWRcclxuICAgICAgICBudW1iZXIyID0gKG51bWJlcjIgPT09IHVuZGVmaW5lZCkgPyAwIDogbnVtYmVyMjtcclxuICAgICAgICBudW1iZXIxID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyMSk7XHJcbiAgICAgICAgbnVtYmVyMiA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcjIpO1xyXG4gICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKG51bWJlcjEsIG51bWJlcjIpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBkZWx0YVxyXG4gICAgICAgIHJldHVybiAobnVtYmVyMSA9PT0gbnVtYmVyMikgPyAxIDogMDtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5FUkYgPSBmdW5jdGlvbihsb3dlcl9ib3VuZCwgdXBwZXJfYm91bmQpIHtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5FUkYuUFJFQ0lTRSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLkVSRkMgPSBmdW5jdGlvbih4KSB7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuRVJGQy5QUkVDSVNFID0gZnVuY3Rpb24oKSB7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuR0VTVEVQID0gZnVuY3Rpb24obnVtYmVyLCBzdGVwKSB7XHJcbiAgICAgICAgc3RlcCA9IHN0ZXAgfHwgMDtcclxuICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKHN0ZXAsIG51bWJlcikpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bWJlcjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBkZWx0YVxyXG4gICAgICAgIHJldHVybiAobnVtYmVyID49IHN0ZXApID8gMSA6IDA7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuSEVYMkJJTiA9IGZ1bmN0aW9uKG51bWJlciwgcGxhY2VzKSB7XHJcbiAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIG51bWJlciBpcyBub3QgaGV4YWRlY2ltYWwgb3IgY29udGFpbnMgbW9yZSB0aGFuIHRlblxyXG4gICAgICAgIC8vIGNoYXJhY3RlcnMgKDEwIGRpZ2l0cylcclxuICAgICAgICBpZiAoIS9eWzAtOUEtRmEtZl17MSwxMH0kLy50ZXN0KG51bWJlcikpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIENoZWNrIGlmIG51bWJlciBpcyBuZWdhdGl2ZVxyXG4gICAgICAgIHZhciBuZWdhdGl2ZSA9IChudW1iZXIubGVuZ3RoID09PSAxMCAmJiBudW1iZXIuc3Vic3RyaW5nKDAsIDEpLnRvTG93ZXJDYXNlKCkgPT09ICdmJykgPyB0cnVlIDogZmFsc2U7XHJcblxyXG4gICAgICAgIC8vIENvbnZlcnQgaGV4YWRlY2ltYWwgbnVtYmVyIHRvIGRlY2ltYWxcclxuICAgICAgICB2YXIgZGVjaW1hbCA9IChuZWdhdGl2ZSkgPyBwYXJzZUludChudW1iZXIsIDE2KSAtIDEwOTk1MTE2Mjc3NzYgOiBwYXJzZUludChudW1iZXIsIDE2KTtcclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIG51bWJlciBpcyBsb3dlciB0aGFuIC01MTIgb3IgZ3JlYXRlciB0aGFuIDUxMVxyXG4gICAgICAgIGlmIChkZWNpbWFsIDwgLTUxMiB8fCBkZWNpbWFsID4gNTExKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBJZ25vcmUgcGxhY2VzIGFuZCByZXR1cm4gYSAxMC1jaGFyYWN0ZXIgYmluYXJ5IG51bWJlciBpZiBudW1iZXIgaXNcclxuICAgICAgICAvLyBuZWdhdGl2ZVxyXG4gICAgICAgIGlmIChuZWdhdGl2ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gJzEnICsgUkVQVCgnMCcsIDkgLSAoNTEyICsgZGVjaW1hbCkudG9TdHJpbmcoMikubGVuZ3RoKSArICg1MTIgKyBkZWNpbWFsKS50b1N0cmluZygyKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIENvbnZlcnQgZGVjaW1hbCBudW1iZXIgdG8gYmluYXJ5XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IGRlY2ltYWwudG9TdHJpbmcoMik7XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBiaW5hcnkgbnVtYmVyIHVzaW5nIHRoZSBtaW5pbXVtIG51bWJlciBvZiBjaGFyYWN0ZXJzIG5lY2Vzc2FyeVxyXG4gICAgICAgIC8vIGlmIHBsYWNlcyBpcyB1bmRlZmluZWRcclxuICAgICAgICBpZiAocGxhY2VzID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgcGxhY2VzIGlzIG5vbm51bWVyaWNcclxuICAgICAgICAgICAgaWYgKGlzTmFOKHBsYWNlcykpIHtcclxuICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBwbGFjZXMgaXMgbmVnYXRpdmVcclxuICAgICAgICAgICAgaWYgKHBsYWNlcyA8IDApIHtcclxuICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBUcnVuY2F0ZSBwbGFjZXMgaW4gY2FzZSBpdCBpcyBub3QgYW4gaW50ZWdlclxyXG4gICAgICAgICAgICBwbGFjZXMgPSBNYXRoLmZsb29yKHBsYWNlcyk7XHJcblxyXG4gICAgICAgICAgICAvLyBQYWQgcmV0dXJuIHZhbHVlIHdpdGggbGVhZGluZyAwcyAoemVyb3MpIGlmIG5lY2Vzc2FyeSAodXNpbmdcclxuICAgICAgICAgICAgLy8gVW5kZXJzY29yZS5zdHJpbmcpXHJcbiAgICAgICAgICAgIHJldHVybiAocGxhY2VzID49IHJlc3VsdC5sZW5ndGgpID8gUkVQVCgnMCcsIHBsYWNlcyAtIHJlc3VsdC5sZW5ndGgpICsgcmVzdWx0IDogZXJyb3IubnVtO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5IRVgyREVDID0gZnVuY3Rpb24obnVtYmVyKSB7XHJcbiAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIG51bWJlciBpcyBub3QgaGV4YWRlY2ltYWwgb3IgY29udGFpbnMgbW9yZSB0aGFuIHRlblxyXG4gICAgICAgIC8vIGNoYXJhY3RlcnMgKDEwIGRpZ2l0cylcclxuICAgICAgICBpZiAoIS9eWzAtOUEtRmEtZl17MSwxMH0kLy50ZXN0KG51bWJlcikpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIENvbnZlcnQgaGV4YWRlY2ltYWwgbnVtYmVyIHRvIGRlY2ltYWxcclxuICAgICAgICB2YXIgZGVjaW1hbCA9IHBhcnNlSW50KG51bWJlciwgMTYpO1xyXG5cclxuICAgICAgICAvLyBSZXR1cm4gZGVjaW1hbCBudW1iZXJcclxuICAgICAgICByZXR1cm4gKGRlY2ltYWwgPj0gNTQ5NzU1ODEzODg4KSA/IGRlY2ltYWwgLSAxMDk5NTExNjI3Nzc2IDogZGVjaW1hbDtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5IRVgyT0NUID0gZnVuY3Rpb24obnVtYmVyLCBwbGFjZXMpIHtcclxuICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgbnVtYmVyIGlzIG5vdCBoZXhhZGVjaW1hbCBvciBjb250YWlucyBtb3JlIHRoYW4gdGVuXHJcbiAgICAgICAgLy8gY2hhcmFjdGVycyAoMTAgZGlnaXRzKVxyXG4gICAgICAgIGlmICghL15bMC05QS1GYS1mXXsxLDEwfSQvLnRlc3QobnVtYmVyKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQ29udmVydCBoZXhhZGVjaW1hbCBudW1iZXIgdG8gZGVjaW1hbFxyXG4gICAgICAgIHZhciBkZWNpbWFsID0gcGFyc2VJbnQobnVtYmVyLCAxNik7XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBudW1iZXIgaXMgcG9zaXRpdmUgYW5kIGdyZWF0ZXIgdGhhbiAweDFmZmZmZmZmXHJcbiAgICAgICAgLy8gKDUzNjg3MDkxMSlcclxuICAgICAgICBpZiAoZGVjaW1hbCA+IDUzNjg3MDkxMSAmJiBkZWNpbWFsIDwgMTA5ODk3NDc1Njg2NCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gSWdub3JlIHBsYWNlcyBhbmQgcmV0dXJuIGEgMTAtY2hhcmFjdGVyIG9jdGFsIG51bWJlciBpZiBudW1iZXIgaXNcclxuICAgICAgICAvLyBuZWdhdGl2ZVxyXG4gICAgICAgIGlmIChkZWNpbWFsID49IDEwOTg5NzQ3NTY4NjQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIChkZWNpbWFsIC0gMTA5ODQzNzg4NTk1MikudG9TdHJpbmcoOCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBDb252ZXJ0IGRlY2ltYWwgbnVtYmVyIHRvIG9jdGFsXHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IGRlY2ltYWwudG9TdHJpbmcoOCk7XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBvY3RhbCBudW1iZXIgdXNpbmcgdGhlIG1pbmltdW0gbnVtYmVyIG9mIGNoYXJhY3RlcnMgbmVjZXNzYXJ5XHJcbiAgICAgICAgLy8gaWYgcGxhY2VzIGlzIHVuZGVmaW5lZFxyXG4gICAgICAgIGlmIChwbGFjZXMgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBwbGFjZXMgaXMgbm9ubnVtZXJpY1xyXG4gICAgICAgICAgICBpZiAoaXNOYU4ocGxhY2VzKSkge1xyXG4gICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIHBsYWNlcyBpcyBuZWdhdGl2ZVxyXG4gICAgICAgICAgICBpZiAocGxhY2VzIDwgMCkge1xyXG4gICAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFRydW5jYXRlIHBsYWNlcyBpbiBjYXNlIGl0IGlzIG5vdCBhbiBpbnRlZ2VyXHJcbiAgICAgICAgICAgIHBsYWNlcyA9IE1hdGguZmxvb3IocGxhY2VzKTtcclxuXHJcbiAgICAgICAgICAgIC8vIFBhZCByZXR1cm4gdmFsdWUgd2l0aCBsZWFkaW5nIDBzICh6ZXJvcykgaWYgbmVjZXNzYXJ5ICh1c2luZ1xyXG4gICAgICAgICAgICAvLyBVbmRlcnNjb3JlLnN0cmluZylcclxuICAgICAgICAgICAgcmV0dXJuIChwbGFjZXMgPj0gcmVzdWx0Lmxlbmd0aCkgPyBSRVBUKCcwJywgcGxhY2VzIC0gcmVzdWx0Lmxlbmd0aCkgKyByZXN1bHQgOiBlcnJvci5udW07XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLklNQUJTID0gZnVuY3Rpb24oaW51bWJlcikge1xyXG4gICAgICAgIC8vIExvb2t1cCByZWFsIGFuZCBpbWFnaW5hcnkgY29lZmZpY2llbnRzIHVzaW5nIGV4cG9ydHMuanNcclxuICAgICAgICAvLyBbaHR0cDovL2Zvcm11bGFqcy5vcmddXHJcbiAgICAgICAgdmFyIHggPSBleHBvcnRzLklNUkVBTChpbnVtYmVyKTtcclxuICAgICAgICB2YXIgeSA9IGV4cG9ydHMuSU1BR0lOQVJZKGludW1iZXIpO1xyXG5cclxuICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgZWl0aGVyIGNvZWZmaWNpZW50IGlzIG5vdCBhIG51bWJlclxyXG4gICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKHgsIHkpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBhYnNvbHV0ZSB2YWx1ZSBvZiBjb21wbGV4IG51bWJlclxyXG4gICAgICAgIHJldHVybiBNYXRoLnNxcnQoTWF0aC5wb3coeCwgMikgKyBNYXRoLnBvdyh5LCAyKSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuSU1BR0lOQVJZID0gZnVuY3Rpb24oaW51bWJlcikge1xyXG4gICAgICAgIGlmIChpbnVtYmVyID09PSB1bmRlZmluZWQgfHwgaW51bWJlciA9PT0gdHJ1ZSB8fCBpbnVtYmVyID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZXR1cm4gMCBpZiBpbnVtYmVyIGlzIGVxdWFsIHRvIDBcclxuICAgICAgICBpZiAoaW51bWJlciA9PT0gMCB8fCBpbnVtYmVyID09PSAnMCcpIHtcclxuICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBIYW5kbGUgc3BlY2lhbCBjYXNlc1xyXG4gICAgICAgIGlmIChbJ2knLCAnaiddLmluZGV4T2YoaW51bWJlcikgPj0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gMTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIE5vcm1hbGl6ZSBpbWFnaW5hcnkgY29lZmZpY2llbnRcclxuICAgICAgICBpbnVtYmVyID0gaW51bWJlci5yZXBsYWNlKCcraScsICcrMWknKS5yZXBsYWNlKCctaScsICctMWknKS5yZXBsYWNlKCcraicsICcrMWonKS5yZXBsYWNlKCctaicsICctMWonKTtcclxuXHJcbiAgICAgICAgLy8gTG9va3VwIHNpZ25cclxuICAgICAgICB2YXIgcGx1cyA9IGludW1iZXIuaW5kZXhPZignKycpO1xyXG4gICAgICAgIHZhciBtaW51cyA9IGludW1iZXIuaW5kZXhPZignLScpO1xyXG4gICAgICAgIGlmIChwbHVzID09PSAwKSB7XHJcbiAgICAgICAgICAgIHBsdXMgPSBpbnVtYmVyLmluZGV4T2YoJysnLCAxKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChtaW51cyA9PT0gMCkge1xyXG4gICAgICAgICAgICBtaW51cyA9IGludW1iZXIuaW5kZXhPZignLScsIDEpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gTG9va3VwIGltYWdpbmFyeSB1bml0XHJcbiAgICAgICAgdmFyIGxhc3QgPSBpbnVtYmVyLnN1YnN0cmluZyhpbnVtYmVyLmxlbmd0aCAtIDEsIGludW1iZXIubGVuZ3RoKTtcclxuICAgICAgICB2YXIgdW5pdCA9IChsYXN0ID09PSAnaScgfHwgbGFzdCA9PT0gJ2onKTtcclxuXHJcbiAgICAgICAgaWYgKHBsdXMgPj0gMCB8fCBtaW51cyA+PSAwKSB7XHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBpbWFnaW5hcnkgdW5pdCBpcyBuZWl0aGVyIGkgbm9yIGpcclxuICAgICAgICAgICAgaWYgKCF1bml0KSB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGltYWdpbmFyeSBjb2VmZmljaWVudCBvZiBjb21wbGV4IG51bWJlclxyXG4gICAgICAgICAgICBpZiAocGx1cyA+PSAwKSB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIChpc05hTihpbnVtYmVyLnN1YnN0cmluZygwLCBwbHVzKSkgfHwgaXNOYU4oaW51bWJlci5zdWJzdHJpbmcocGx1cyArIDEsIGludW1iZXIubGVuZ3RoIC0gMSkpKSA/XHJcbiAgICAgICAgICAgICAgICAgIGVycm9yLm51bSA6XHJcbiAgICAgICAgICAgICAgICAgIE51bWJlcihpbnVtYmVyLnN1YnN0cmluZyhwbHVzICsgMSwgaW51bWJlci5sZW5ndGggLSAxKSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIChpc05hTihpbnVtYmVyLnN1YnN0cmluZygwLCBtaW51cykpIHx8IGlzTmFOKGludW1iZXIuc3Vic3RyaW5nKG1pbnVzICsgMSwgaW51bWJlci5sZW5ndGggLSAxKSkpID9cclxuICAgICAgICAgICAgICAgICAgZXJyb3IubnVtIDpcclxuICAgICAgICAgICAgICAgICAgLU51bWJlcihpbnVtYmVyLnN1YnN0cmluZyhtaW51cyArIDEsIGludW1iZXIubGVuZ3RoIC0gMSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKHVuaXQpIHtcclxuICAgICAgICAgICAgICByZXR1cm4gKGlzTmFOKGludW1iZXIuc3Vic3RyaW5nKDAsIGludW1iZXIubGVuZ3RoIC0gMSkpKSA/IGVycm9yLm51bSA6IGludW1iZXIuc3Vic3RyaW5nKDAsIGludW1iZXIubGVuZ3RoIC0gMSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIChpc05hTihpbnVtYmVyKSkgPyBlcnJvci5udW0gOiAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLklNQVJHVU1FTlQgPSBmdW5jdGlvbihpbnVtYmVyKSB7XHJcbiAgICAgICAgLy8gTG9va3VwIHJlYWwgYW5kIGltYWdpbmFyeSBjb2VmZmljaWVudHMgdXNpbmcgZXhwb3J0cy5qc1xyXG4gICAgICAgIC8vIFtodHRwOi8vZm9ybXVsYWpzLm9yZ11cclxuICAgICAgICB2YXIgeCA9IGV4cG9ydHMuSU1SRUFMKGludW1iZXIpO1xyXG4gICAgICAgIHZhciB5ID0gZXhwb3J0cy5JTUFHSU5BUlkoaW51bWJlcik7XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBlaXRoZXIgY29lZmZpY2llbnQgaXMgbm90IGEgbnVtYmVyXHJcbiAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IoeCwgeSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIGludW1iZXIgaXMgZXF1YWwgdG8gemVyb1xyXG4gICAgICAgIGlmICh4ID09PSAwICYmIHkgPT09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLmRpdjA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZXR1cm4gUEkvMiBpZiB4IGlzIGVxdWFsIHRvIHplcm8gYW5kIHkgaXMgcG9zaXRpdmVcclxuICAgICAgICBpZiAoeCA9PT0gMCAmJiB5ID4gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gTWF0aC5QSSAvIDI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZXR1cm4gLVBJLzIgaWYgeCBpcyBlcXVhbCB0byB6ZXJvIGFuZCB5IGlzIG5lZ2F0aXZlXHJcbiAgICAgICAgaWYgKHggPT09IDAgJiYgeSA8IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIC1NYXRoLlBJIC8gMjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJldHVybiB6ZXJvIGlmIHggaXMgbmVnYXRpdmUgYW5kIHkgaXMgZXF1YWwgdG8gemVyb1xyXG4gICAgICAgIGlmICh5ID09PSAwICYmIHggPiAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIHplcm8gaWYgeCBpcyBuZWdhdGl2ZSBhbmQgeSBpcyBlcXVhbCB0byB6ZXJvXHJcbiAgICAgICAgaWYgKHkgPT09IDAgJiYgeCA8IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIC1NYXRoLlBJO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIGFyZ3VtZW50IG9mIGNvbXBsZXggbnVtYmVyXHJcbiAgICAgICAgaWYgKHggPiAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBNYXRoLmF0YW4oeSAvIHgpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoeCA8IDAgJiYgeSA+PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBNYXRoLmF0YW4oeSAvIHgpICsgTWF0aC5QSTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gTWF0aC5hdGFuKHkgLyB4KSAtIE1hdGguUEk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLklNQ09OSlVHQVRFID0gZnVuY3Rpb24oaW51bWJlcikge1xyXG4gICAgICAgIC8vIExvb2t1cCByZWFsIGFuZCBpbWFnaW5hcnkgY29lZmZpY2llbnRzIHVzaW5nIGV4cG9ydHMuanNcclxuICAgICAgICAvLyBbaHR0cDovL2Zvcm11bGFqcy5vcmddXHJcbiAgICAgICAgdmFyIHggPSBleHBvcnRzLklNUkVBTChpbnVtYmVyKTtcclxuICAgICAgICB2YXIgeSA9IGV4cG9ydHMuSU1BR0lOQVJZKGludW1iZXIpO1xyXG5cclxuICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcih4LCB5KSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBMb29rdXAgaW1hZ2luYXJ5IHVuaXRcclxuICAgICAgICB2YXIgdW5pdCA9IGludW1iZXIuc3Vic3RyaW5nKGludW1iZXIubGVuZ3RoIC0gMSk7XHJcbiAgICAgICAgdW5pdCA9ICh1bml0ID09PSAnaScgfHwgdW5pdCA9PT0gJ2onKSA/IHVuaXQgOiAnaSc7XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBjb25qdWdhdGUgb2YgY29tcGxleCBudW1iZXJcclxuICAgICAgICByZXR1cm4gKHkgIT09IDApID8gZXhwb3J0cy5DT01QTEVYKHgsIC15LCB1bml0KSA6IGludW1iZXI7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuSU1DT1MgPSBmdW5jdGlvbihpbnVtYmVyKSB7XHJcbiAgICAgICAgLy8gTG9va3VwIHJlYWwgYW5kIGltYWdpbmFyeSBjb2VmZmljaWVudHMgdXNpbmcgZXhwb3J0cy5qc1xyXG4gICAgICAgIC8vIFtodHRwOi8vZm9ybXVsYWpzLm9yZ11cclxuICAgICAgICB2YXIgeCA9IGV4cG9ydHMuSU1SRUFMKGludW1iZXIpO1xyXG4gICAgICAgIHZhciB5ID0gZXhwb3J0cy5JTUFHSU5BUlkoaW51bWJlcik7XHJcblxyXG4gICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKHgsIHkpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIExvb2t1cCBpbWFnaW5hcnkgdW5pdFxyXG4gICAgICAgIHZhciB1bml0ID0gaW51bWJlci5zdWJzdHJpbmcoaW51bWJlci5sZW5ndGggLSAxKTtcclxuICAgICAgICB1bml0ID0gKHVuaXQgPT09ICdpJyB8fCB1bml0ID09PSAnaicpID8gdW5pdCA6ICdpJztcclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIGNvc2luZSBvZiBjb21wbGV4IG51bWJlclxyXG4gICAgICAgIHJldHVybiBleHBvcnRzLkNPTVBMRVgoTWF0aC5jb3MoeCkgKiAoTWF0aC5leHAoeSkgKyBNYXRoLmV4cCgteSkpIC8gMiwgLU1hdGguc2luKHgpICogKE1hdGguZXhwKHkpIC0gTWF0aC5leHAoLXkpKSAvIDIsIHVuaXQpO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLklNQ09TSCA9IGZ1bmN0aW9uKGludW1iZXIpIHtcclxuICAgICAgICAvLyBMb29rdXAgcmVhbCBhbmQgaW1hZ2luYXJ5IGNvZWZmaWNpZW50cyB1c2luZyBleHBvcnRzLmpzXHJcbiAgICAgICAgLy8gW2h0dHA6Ly9mb3JtdWxhanMub3JnXVxyXG4gICAgICAgIHZhciB4ID0gZXhwb3J0cy5JTVJFQUwoaW51bWJlcik7XHJcbiAgICAgICAgdmFyIHkgPSBleHBvcnRzLklNQUdJTkFSWShpbnVtYmVyKTtcclxuXHJcbiAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IoeCwgeSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gTG9va3VwIGltYWdpbmFyeSB1bml0XHJcbiAgICAgICAgdmFyIHVuaXQgPSBpbnVtYmVyLnN1YnN0cmluZyhpbnVtYmVyLmxlbmd0aCAtIDEpO1xyXG4gICAgICAgIHVuaXQgPSAodW5pdCA9PT0gJ2knIHx8IHVuaXQgPT09ICdqJykgPyB1bml0IDogJ2knO1xyXG5cclxuICAgICAgICAvLyBSZXR1cm4gaHlwZXJib2xpYyBjb3NpbmUgb2YgY29tcGxleCBudW1iZXJcclxuICAgICAgICByZXR1cm4gZXhwb3J0cy5DT01QTEVYKE1hdGguY29zKHkpICogKE1hdGguZXhwKHgpICsgTWF0aC5leHAoLXgpKSAvIDIsIE1hdGguc2luKHkpICogKE1hdGguZXhwKHgpIC0gTWF0aC5leHAoLXgpKSAvIDIsIHVuaXQpO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLklNQ09UID0gZnVuY3Rpb24oaW51bWJlcikge1xyXG4gICAgICAgIC8vIExvb2t1cCByZWFsIGFuZCBpbWFnaW5hcnkgY29lZmZpY2llbnRzIHVzaW5nIEZvcm11bGEuanNcclxuICAgICAgICAvLyBbaHR0cDovL2Zvcm11bGFqcy5vcmddXHJcbiAgICAgICAgdmFyIHggPSBleHBvcnRzLklNUkVBTChpbnVtYmVyKTtcclxuICAgICAgICB2YXIgeSA9IGV4cG9ydHMuSU1BR0lOQVJZKGludW1iZXIpO1xyXG5cclxuICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcih4LCB5KSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZXR1cm4gY290YW5nZW50IG9mIGNvbXBsZXggbnVtYmVyXHJcbiAgICAgICAgcmV0dXJuIGV4cG9ydHMuSU1ESVYoZXhwb3J0cy5JTUNPUyhpbnVtYmVyKSwgZXhwb3J0cy5JTVNJTihpbnVtYmVyKSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuSU1ESVYgPSBmdW5jdGlvbihpbnVtYmVyMSwgaW51bWJlcjIpIHtcclxuICAgICAgICAvLyBMb29rdXAgcmVhbCBhbmQgaW1hZ2luYXJ5IGNvZWZmaWNpZW50cyB1c2luZyBGb3JtdWxhLmpzXHJcbiAgICAgICAgLy8gW2h0dHA6Ly9mb3JtdWxhanMub3JnXVxyXG4gICAgICAgIHZhciBhID0gZXhwb3J0cy5JTVJFQUwoaW51bWJlcjEpO1xyXG4gICAgICAgIHZhciBiID0gZXhwb3J0cy5JTUFHSU5BUlkoaW51bWJlcjEpO1xyXG4gICAgICAgIHZhciBjID0gZXhwb3J0cy5JTVJFQUwoaW51bWJlcjIpO1xyXG4gICAgICAgIHZhciBkID0gZXhwb3J0cy5JTUFHSU5BUlkoaW51bWJlcjIpO1xyXG5cclxuICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihhLCBiLCBjLCBkKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBMb29rdXAgaW1hZ2luYXJ5IHVuaXRcclxuICAgICAgICB2YXIgdW5pdDEgPSBpbnVtYmVyMS5zdWJzdHJpbmcoaW51bWJlcjEubGVuZ3RoIC0gMSk7XHJcbiAgICAgICAgdmFyIHVuaXQyID0gaW51bWJlcjIuc3Vic3RyaW5nKGludW1iZXIyLmxlbmd0aCAtIDEpO1xyXG4gICAgICAgIHZhciB1bml0ID0gJ2knO1xyXG4gICAgICAgIGlmICh1bml0MSA9PT0gJ2onKSB7XHJcbiAgICAgICAgICAgIHVuaXQgPSAnaic7XHJcbiAgICAgICAgfSBlbHNlIGlmICh1bml0MiA9PT0gJ2onKSB7XHJcbiAgICAgICAgICAgIHVuaXQgPSAnaic7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgaW51bWJlcjIgaXMgbnVsbFxyXG4gICAgICAgIGlmIChjID09PSAwICYmIGQgPT09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBleHBvbmVudGlhbCBvZiBjb21wbGV4IG51bWJlclxyXG4gICAgICAgIHZhciBkZW4gPSBjICogYyArIGQgKiBkO1xyXG4gICAgICAgIHJldHVybiBleHBvcnRzLkNPTVBMRVgoKGEgKiBjICsgYiAqIGQpIC8gZGVuLCAoYiAqIGMgLSBhICogZCkgLyBkZW4sIHVuaXQpO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLklNRVhQID0gZnVuY3Rpb24oaW51bWJlcikge1xyXG4gICAgICAgIC8vIExvb2t1cCByZWFsIGFuZCBpbWFnaW5hcnkgY29lZmZpY2llbnRzIHVzaW5nIEZvcm11bGEuanNcclxuICAgICAgICAvLyBbaHR0cDovL2Zvcm11bGFqcy5vcmddXHJcbiAgICAgICAgdmFyIHggPSBleHBvcnRzLklNUkVBTChpbnVtYmVyKTtcclxuICAgICAgICB2YXIgeSA9IGV4cG9ydHMuSU1BR0lOQVJZKGludW1iZXIpO1xyXG5cclxuICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcih4LCB5KSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBMb29rdXAgaW1hZ2luYXJ5IHVuaXRcclxuICAgICAgICB2YXIgdW5pdCA9IGludW1iZXIuc3Vic3RyaW5nKGludW1iZXIubGVuZ3RoIC0gMSk7XHJcbiAgICAgICAgdW5pdCA9ICh1bml0ID09PSAnaScgfHwgdW5pdCA9PT0gJ2onKSA/IHVuaXQgOiAnaSc7XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBleHBvbmVudGlhbCBvZiBjb21wbGV4IG51bWJlclxyXG4gICAgICAgIHZhciBlID0gTWF0aC5leHAoeCk7XHJcbiAgICAgICAgcmV0dXJuIGV4cG9ydHMuQ09NUExFWChlICogTWF0aC5jb3MoeSksIGUgKiBNYXRoLnNpbih5KSwgdW5pdCk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuSU1MTiA9IGZ1bmN0aW9uKGludW1iZXIpIHtcclxuICAgICAgICAvLyBMb29rdXAgcmVhbCBhbmQgaW1hZ2luYXJ5IGNvZWZmaWNpZW50cyB1c2luZyBGb3JtdWxhLmpzXHJcbiAgICAgICAgLy8gW2h0dHA6Ly9mb3JtdWxhanMub3JnXVxyXG4gICAgICAgIHZhciB4ID0gZXhwb3J0cy5JTVJFQUwoaW51bWJlcik7XHJcbiAgICAgICAgdmFyIHkgPSBleHBvcnRzLklNQUdJTkFSWShpbnVtYmVyKTtcclxuXHJcbiAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IoeCwgeSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gTG9va3VwIGltYWdpbmFyeSB1bml0XHJcbiAgICAgICAgdmFyIHVuaXQgPSBpbnVtYmVyLnN1YnN0cmluZyhpbnVtYmVyLmxlbmd0aCAtIDEpO1xyXG4gICAgICAgIHVuaXQgPSAodW5pdCA9PT0gJ2knIHx8IHVuaXQgPT09ICdqJykgPyB1bml0IDogJ2knO1xyXG5cclxuICAgICAgICAvLyBSZXR1cm4gZXhwb25lbnRpYWwgb2YgY29tcGxleCBudW1iZXJcclxuICAgICAgICByZXR1cm4gZXhwb3J0cy5DT01QTEVYKE1hdGgubG9nKE1hdGguc3FydCh4ICogeCArIHkgKiB5KSksIE1hdGguYXRhbih5IC8geCksIHVuaXQpO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLklNTE9HMTAgPSBmdW5jdGlvbihpbnVtYmVyKSB7XHJcbiAgICAgICAgLy8gTG9va3VwIHJlYWwgYW5kIGltYWdpbmFyeSBjb2VmZmljaWVudHMgdXNpbmcgRm9ybXVsYS5qc1xyXG4gICAgICAgIC8vIFtodHRwOi8vZm9ybXVsYWpzLm9yZ11cclxuICAgICAgICB2YXIgeCA9IGV4cG9ydHMuSU1SRUFMKGludW1iZXIpO1xyXG4gICAgICAgIHZhciB5ID0gZXhwb3J0cy5JTUFHSU5BUlkoaW51bWJlcik7XHJcblxyXG4gICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKHgsIHkpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIExvb2t1cCBpbWFnaW5hcnkgdW5pdFxyXG4gICAgICAgIHZhciB1bml0ID0gaW51bWJlci5zdWJzdHJpbmcoaW51bWJlci5sZW5ndGggLSAxKTtcclxuICAgICAgICB1bml0ID0gKHVuaXQgPT09ICdpJyB8fCB1bml0ID09PSAnaicpID8gdW5pdCA6ICdpJztcclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIGV4cG9uZW50aWFsIG9mIGNvbXBsZXggbnVtYmVyXHJcbiAgICAgICAgcmV0dXJuIGV4cG9ydHMuQ09NUExFWChNYXRoLmxvZyhNYXRoLnNxcnQoeCAqIHggKyB5ICogeSkpIC8gTWF0aC5sb2coMTApLCBNYXRoLmF0YW4oeSAvIHgpIC8gTWF0aC5sb2coMTApLCB1bml0KTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5JTUxPRzIgPSBmdW5jdGlvbihpbnVtYmVyKSB7XHJcbiAgICAgICAgLy8gTG9va3VwIHJlYWwgYW5kIGltYWdpbmFyeSBjb2VmZmljaWVudHMgdXNpbmcgRm9ybXVsYS5qc1xyXG4gICAgICAgIC8vIFtodHRwOi8vZm9ybXVsYWpzLm9yZ11cclxuICAgICAgICB2YXIgeCA9IGV4cG9ydHMuSU1SRUFMKGludW1iZXIpO1xyXG4gICAgICAgIHZhciB5ID0gZXhwb3J0cy5JTUFHSU5BUlkoaW51bWJlcik7XHJcblxyXG4gICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKHgsIHkpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIExvb2t1cCBpbWFnaW5hcnkgdW5pdFxyXG4gICAgICAgIHZhciB1bml0ID0gaW51bWJlci5zdWJzdHJpbmcoaW51bWJlci5sZW5ndGggLSAxKTtcclxuICAgICAgICB1bml0ID0gKHVuaXQgPT09ICdpJyB8fCB1bml0ID09PSAnaicpID8gdW5pdCA6ICdpJztcclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIGV4cG9uZW50aWFsIG9mIGNvbXBsZXggbnVtYmVyXHJcbiAgICAgICAgcmV0dXJuIGV4cG9ydHMuQ09NUExFWChNYXRoLmxvZyhNYXRoLnNxcnQoeCAqIHggKyB5ICogeSkpIC8gTWF0aC5sb2coMiksIE1hdGguYXRhbih5IC8geCkgLyBNYXRoLmxvZygyKSwgdW5pdCk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuSU1QT1dFUiA9IGZ1bmN0aW9uKGludW1iZXIsIG51bWJlcikge1xyXG4gICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgdmFyIHggPSBleHBvcnRzLklNUkVBTChpbnVtYmVyKTtcclxuICAgICAgICB2YXIgeSA9IGV4cG9ydHMuSU1BR0lOQVJZKGludW1iZXIpO1xyXG4gICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKG51bWJlciwgeCwgeSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gTG9va3VwIGltYWdpbmFyeSB1bml0XHJcbiAgICAgICAgdmFyIHVuaXQgPSBpbnVtYmVyLnN1YnN0cmluZyhpbnVtYmVyLmxlbmd0aCAtIDEpO1xyXG4gICAgICAgIHVuaXQgPSAodW5pdCA9PT0gJ2knIHx8IHVuaXQgPT09ICdqJykgPyB1bml0IDogJ2knO1xyXG5cclxuICAgICAgICAvLyBDYWxjdWxhdGUgcG93ZXIgb2YgbW9kdWx1c1xyXG4gICAgICAgIHZhciBwID0gTWF0aC5wb3coZXhwb3J0cy5JTUFCUyhpbnVtYmVyKSwgbnVtYmVyKTtcclxuXHJcbiAgICAgICAgLy8gQ2FsY3VsYXRlIGFyZ3VtZW50XHJcbiAgICAgICAgdmFyIHQgPSBleHBvcnRzLklNQVJHVU1FTlQoaW51bWJlcik7XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBleHBvbmVudGlhbCBvZiBjb21wbGV4IG51bWJlclxyXG4gICAgICAgIHJldHVybiBleHBvcnRzLkNPTVBMRVgocCAqIE1hdGguY29zKG51bWJlciAqIHQpLCBwICogTWF0aC5zaW4obnVtYmVyICogdCksIHVuaXQpO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLklNUFJPRFVDVCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIC8vIEluaXRpYWxpemUgcmVzdWx0XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IGFyZ3VtZW50c1swXTtcclxuXHJcbiAgICAgICAgLy8gTG9vcCBvbiBhbGwgbnVtYmVyc1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIC8vIExvb2t1cCBjb2VmZmljaWVudHMgb2YgdHdvIGNvbXBsZXggbnVtYmVyc1xyXG4gICAgICAgICAgICB2YXIgYSA9IGV4cG9ydHMuSU1SRUFMKHJlc3VsdCk7XHJcbiAgICAgICAgICAgIHZhciBiID0gZXhwb3J0cy5JTUFHSU5BUlkocmVzdWx0KTtcclxuICAgICAgICAgICAgdmFyIGMgPSBleHBvcnRzLklNUkVBTChhcmd1bWVudHNbaV0pO1xyXG4gICAgICAgICAgICB2YXIgZCA9IGV4cG9ydHMuSU1BR0lOQVJZKGFyZ3VtZW50c1tpXSk7XHJcblxyXG4gICAgICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihhLCBiLCBjLCBkKSkge1xyXG4gICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gQ29tcGx1dGUgcHJvZHVjdCBvZiB0d28gY29tcGxleCBudW1iZXJzXHJcbiAgICAgICAgICAgIHJlc3VsdCA9IGV4cG9ydHMuQ09NUExFWChhICogYyAtIGIgKiBkLCBhICogZCArIGIgKiBjKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBwcm9kdWN0IG9mIGNvbXBsZXggbnVtYmVyc1xyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuSU1SRUFMID0gZnVuY3Rpb24oaW51bWJlcikge1xyXG4gICAgICAgIGlmIChpbnVtYmVyID09PSB1bmRlZmluZWQgfHwgaW51bWJlciA9PT0gdHJ1ZSB8fCBpbnVtYmVyID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZXR1cm4gMCBpZiBpbnVtYmVyIGlzIGVxdWFsIHRvIDBcclxuICAgICAgICBpZiAoaW51bWJlciA9PT0gMCB8fCBpbnVtYmVyID09PSAnMCcpIHtcclxuICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBIYW5kbGUgc3BlY2lhbCBjYXNlc1xyXG4gICAgICAgIGlmIChbJ2knLCAnK2knLCAnMWknLCAnKzFpJywgJy1pJywgJy0xaScsICdqJywgJytqJywgJzFqJywgJysxaicsICctaicsICctMWonXS5pbmRleE9mKGludW1iZXIpID49IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBMb29rdXAgc2lnblxyXG4gICAgICAgIHZhciBwbHVzID0gaW51bWJlci5pbmRleE9mKCcrJyk7XHJcbiAgICAgICAgdmFyIG1pbnVzID0gaW51bWJlci5pbmRleE9mKCctJyk7XHJcbiAgICAgICAgaWYgKHBsdXMgPT09IDApIHtcclxuICAgICAgICAgICAgcGx1cyA9IGludW1iZXIuaW5kZXhPZignKycsIDEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobWludXMgPT09IDApIHtcclxuICAgICAgICAgICAgbWludXMgPSBpbnVtYmVyLmluZGV4T2YoJy0nLCAxKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIExvb2t1cCBpbWFnaW5hcnkgdW5pdFxyXG4gICAgICAgIHZhciBsYXN0ID0gaW51bWJlci5zdWJzdHJpbmcoaW51bWJlci5sZW5ndGggLSAxLCBpbnVtYmVyLmxlbmd0aCk7XHJcbiAgICAgICAgdmFyIHVuaXQgPSAobGFzdCA9PT0gJ2knIHx8IGxhc3QgPT09ICdqJyk7XHJcblxyXG4gICAgICAgIGlmIChwbHVzID49IDAgfHwgbWludXMgPj0gMCkge1xyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgaW1hZ2luYXJ5IHVuaXQgaXMgbmVpdGhlciBpIG5vciBqXHJcbiAgICAgICAgICAgIGlmICghdW5pdCkge1xyXG4gICAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiByZWFsIGNvZWZmaWNpZW50IG9mIGNvbXBsZXggbnVtYmVyXHJcbiAgICAgICAgICAgIGlmIChwbHVzID49IDApIHtcclxuICAgICAgICAgICAgICByZXR1cm4gKGlzTmFOKGludW1iZXIuc3Vic3RyaW5nKDAsIHBsdXMpKSB8fCBpc05hTihpbnVtYmVyLnN1YnN0cmluZyhwbHVzICsgMSwgaW51bWJlci5sZW5ndGggLSAxKSkpID9cclxuICAgICAgICAgICAgICAgICAgZXJyb3IubnVtIDpcclxuICAgICAgICAgICAgICAgICAgTnVtYmVyKGludW1iZXIuc3Vic3RyaW5nKDAsIHBsdXMpKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICByZXR1cm4gKGlzTmFOKGludW1iZXIuc3Vic3RyaW5nKDAsIG1pbnVzKSkgfHwgaXNOYU4oaW51bWJlci5zdWJzdHJpbmcobWludXMgKyAxLCBpbnVtYmVyLmxlbmd0aCAtIDEpKSkgP1xyXG4gICAgICAgICAgICAgICAgICBlcnJvci5udW0gOlxyXG4gICAgICAgICAgICAgICAgICBOdW1iZXIoaW51bWJlci5zdWJzdHJpbmcoMCwgbWludXMpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICh1bml0KSB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIChpc05hTihpbnVtYmVyLnN1YnN0cmluZygwLCBpbnVtYmVyLmxlbmd0aCAtIDEpKSkgPyBlcnJvci5udW0gOiAwO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIHJldHVybiAoaXNOYU4oaW51bWJlcikpID8gZXJyb3IubnVtIDogaW51bWJlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5JTVNFQyA9IGZ1bmN0aW9uKGludW1iZXIpIHtcclxuICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgaW51bWJlciBpcyBhIGxvZ2ljYWwgdmFsdWVcclxuICAgICAgICBpZiAoaW51bWJlciA9PT0gdHJ1ZSB8fCBpbnVtYmVyID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBMb29rdXAgcmVhbCBhbmQgaW1hZ2luYXJ5IGNvZWZmaWNpZW50cyB1c2luZyBGb3JtdWxhLmpzXHJcbiAgICAgICAgLy8gW2h0dHA6Ly9mb3JtdWxhanMub3JnXVxyXG4gICAgICAgIHZhciB4ID0gZXhwb3J0cy5JTVJFQUwoaW51bWJlcik7XHJcbiAgICAgICAgdmFyIHkgPSBleHBvcnRzLklNQUdJTkFSWShpbnVtYmVyKTtcclxuXHJcbiAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IoeCwgeSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIHNlY2FudCBvZiBjb21wbGV4IG51bWJlclxyXG4gICAgICAgIHJldHVybiBleHBvcnRzLklNRElWKCcxJywgZXhwb3J0cy5JTUNPUyhpbnVtYmVyKSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuSU1TRUNIID0gZnVuY3Rpb24oaW51bWJlcikge1xyXG4gICAgICAgIC8vIExvb2t1cCByZWFsIGFuZCBpbWFnaW5hcnkgY29lZmZpY2llbnRzIHVzaW5nIEZvcm11bGEuanNcclxuICAgICAgICAvLyBbaHR0cDovL2Zvcm11bGFqcy5vcmddXHJcbiAgICAgICAgdmFyIHggPSBleHBvcnRzLklNUkVBTChpbnVtYmVyKTtcclxuICAgICAgICB2YXIgeSA9IGV4cG9ydHMuSU1BR0lOQVJZKGludW1iZXIpO1xyXG5cclxuICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcih4LCB5KSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZXR1cm4gaHlwZXJib2xpYyBzZWNhbnQgb2YgY29tcGxleCBudW1iZXJcclxuICAgICAgICByZXR1cm4gZXhwb3J0cy5JTURJVignMScsIGV4cG9ydHMuSU1DT1NIKGludW1iZXIpKTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5JTVNJTiA9IGZ1bmN0aW9uKGludW1iZXIpIHtcclxuICAgICAgICAvLyBMb29rdXAgcmVhbCBhbmQgaW1hZ2luYXJ5IGNvZWZmaWNpZW50cyB1c2luZyBGb3JtdWxhLmpzXHJcbiAgICAgICAgLy8gW2h0dHA6Ly9mb3JtdWxhanMub3JnXVxyXG4gICAgICAgIHZhciB4ID0gZXhwb3J0cy5JTVJFQUwoaW51bWJlcik7XHJcbiAgICAgICAgdmFyIHkgPSBleHBvcnRzLklNQUdJTkFSWShpbnVtYmVyKTtcclxuXHJcbiAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IoeCwgeSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gTG9va3VwIGltYWdpbmFyeSB1bml0XHJcbiAgICAgICAgdmFyIHVuaXQgPSBpbnVtYmVyLnN1YnN0cmluZyhpbnVtYmVyLmxlbmd0aCAtIDEpO1xyXG4gICAgICAgIHVuaXQgPSAodW5pdCA9PT0gJ2knIHx8IHVuaXQgPT09ICdqJykgPyB1bml0IDogJ2knO1xyXG5cclxuICAgICAgICAvLyBSZXR1cm4gc2luZSBvZiBjb21wbGV4IG51bWJlclxyXG4gICAgICAgIHJldHVybiBleHBvcnRzLkNPTVBMRVgoTWF0aC5zaW4oeCkgKiAoTWF0aC5leHAoeSkgKyBNYXRoLmV4cCgteSkpIC8gMiwgTWF0aC5jb3MoeCkgKiAoTWF0aC5leHAoeSkgLSBNYXRoLmV4cCgteSkpIC8gMiwgdW5pdCk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuSU1TSU5IID0gZnVuY3Rpb24oaW51bWJlcikge1xyXG4gICAgICAgIC8vIExvb2t1cCByZWFsIGFuZCBpbWFnaW5hcnkgY29lZmZpY2llbnRzIHVzaW5nIEZvcm11bGEuanNcclxuICAgICAgICAvLyBbaHR0cDovL2Zvcm11bGFqcy5vcmddXHJcbiAgICAgICAgdmFyIHggPSBleHBvcnRzLklNUkVBTChpbnVtYmVyKTtcclxuICAgICAgICB2YXIgeSA9IGV4cG9ydHMuSU1BR0lOQVJZKGludW1iZXIpO1xyXG5cclxuICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcih4LCB5KSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBMb29rdXAgaW1hZ2luYXJ5IHVuaXRcclxuICAgICAgICB2YXIgdW5pdCA9IGludW1iZXIuc3Vic3RyaW5nKGludW1iZXIubGVuZ3RoIC0gMSk7XHJcbiAgICAgICAgdW5pdCA9ICh1bml0ID09PSAnaScgfHwgdW5pdCA9PT0gJ2onKSA/IHVuaXQgOiAnaSc7XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBoeXBlcmJvbGljIHNpbmUgb2YgY29tcGxleCBudW1iZXJcclxuICAgICAgICByZXR1cm4gZXhwb3J0cy5DT01QTEVYKE1hdGguY29zKHkpICogKE1hdGguZXhwKHgpIC0gTWF0aC5leHAoLXgpKSAvIDIsIE1hdGguc2luKHkpICogKE1hdGguZXhwKHgpICsgTWF0aC5leHAoLXgpKSAvIDIsIHVuaXQpO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLklNU1FSVCA9IGZ1bmN0aW9uKGludW1iZXIpIHtcclxuICAgICAgICAvLyBMb29rdXAgcmVhbCBhbmQgaW1hZ2luYXJ5IGNvZWZmaWNpZW50cyB1c2luZyBGb3JtdWxhLmpzXHJcbiAgICAgICAgLy8gW2h0dHA6Ly9mb3JtdWxhanMub3JnXVxyXG4gICAgICAgIHZhciB4ID0gZXhwb3J0cy5JTVJFQUwoaW51bWJlcik7XHJcbiAgICAgICAgdmFyIHkgPSBleHBvcnRzLklNQUdJTkFSWShpbnVtYmVyKTtcclxuXHJcbiAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IoeCwgeSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gTG9va3VwIGltYWdpbmFyeSB1bml0XHJcbiAgICAgICAgdmFyIHVuaXQgPSBpbnVtYmVyLnN1YnN0cmluZyhpbnVtYmVyLmxlbmd0aCAtIDEpO1xyXG4gICAgICAgIHVuaXQgPSAodW5pdCA9PT0gJ2knIHx8IHVuaXQgPT09ICdqJykgPyB1bml0IDogJ2knO1xyXG5cclxuICAgICAgICAvLyBDYWxjdWxhdGUgcG93ZXIgb2YgbW9kdWx1c1xyXG4gICAgICAgIHZhciBzID0gTWF0aC5zcXJ0KGV4cG9ydHMuSU1BQlMoaW51bWJlcikpO1xyXG5cclxuICAgICAgICAvLyBDYWxjdWxhdGUgYXJndW1lbnRcclxuICAgICAgICB2YXIgdCA9IGV4cG9ydHMuSU1BUkdVTUVOVChpbnVtYmVyKTtcclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIGV4cG9uZW50aWFsIG9mIGNvbXBsZXggbnVtYmVyXHJcbiAgICAgICAgcmV0dXJuIGV4cG9ydHMuQ09NUExFWChzICogTWF0aC5jb3ModCAvIDIpLCBzICogTWF0aC5zaW4odCAvIDIpLCB1bml0KTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5JTUNTQyA9IGZ1bmN0aW9uIChpbnVtYmVyKSB7XHJcbiAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIGludW1iZXIgaXMgYSBsb2dpY2FsIHZhbHVlXHJcbiAgICAgICAgaWYgKGludW1iZXIgPT09IHRydWUgfHwgaW51bWJlciA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gTG9va3VwIHJlYWwgYW5kIGltYWdpbmFyeSBjb2VmZmljaWVudHMgdXNpbmcgRm9ybXVsYS5qc1xyXG4gICAgICAgIC8vIFtodHRwOi8vZm9ybXVsYWpzLm9yZ11cclxuICAgICAgICB2YXIgeCA9IGV4cG9ydHMuSU1SRUFMKGludW1iZXIpO1xyXG4gICAgICAgIHZhciB5ID0gZXhwb3J0cy5JTUFHSU5BUlkoaW51bWJlcik7XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBlaXRoZXIgY29lZmZpY2llbnQgaXMgbm90IGEgbnVtYmVyXHJcbiAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IoeCwgeSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBjb3NlY2FudCBvZiBjb21wbGV4IG51bWJlclxyXG4gICAgICAgIHJldHVybiBleHBvcnRzLklNRElWKCcxJywgZXhwb3J0cy5JTVNJTihpbnVtYmVyKSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuSU1DU0NIID0gZnVuY3Rpb24gKGludW1iZXIpIHtcclxuICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgaW51bWJlciBpcyBhIGxvZ2ljYWwgdmFsdWVcclxuICAgICAgICBpZiAoaW51bWJlciA9PT0gdHJ1ZSB8fCBpbnVtYmVyID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBMb29rdXAgcmVhbCBhbmQgaW1hZ2luYXJ5IGNvZWZmaWNpZW50cyB1c2luZyBGb3JtdWxhLmpzXHJcbiAgICAgICAgLy8gW2h0dHA6Ly9mb3JtdWxhanMub3JnXVxyXG4gICAgICAgIHZhciB4ID0gZXhwb3J0cy5JTVJFQUwoaW51bWJlcik7XHJcbiAgICAgICAgdmFyIHkgPSBleHBvcnRzLklNQUdJTkFSWShpbnVtYmVyKTtcclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIGVpdGhlciBjb2VmZmljaWVudCBpcyBub3QgYSBudW1iZXJcclxuICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcih4LCB5KSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIGh5cGVyYm9saWMgY29zZWNhbnQgb2YgY29tcGxleCBudW1iZXJcclxuICAgICAgICByZXR1cm4gZXhwb3J0cy5JTURJVignMScsIGV4cG9ydHMuSU1TSU5IKGludW1iZXIpKTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5JTVNVQiA9IGZ1bmN0aW9uKGludW1iZXIxLCBpbnVtYmVyMikge1xyXG4gICAgICAgIC8vIExvb2t1cCByZWFsIGFuZCBpbWFnaW5hcnkgY29lZmZpY2llbnRzIHVzaW5nIEZvcm11bGEuanNcclxuICAgICAgICAvLyBbaHR0cDovL2Zvcm11bGFqcy5vcmddXHJcbiAgICAgICAgdmFyIGEgPSB0aGlzLklNUkVBTChpbnVtYmVyMSk7XHJcbiAgICAgICAgdmFyIGIgPSB0aGlzLklNQUdJTkFSWShpbnVtYmVyMSk7XHJcbiAgICAgICAgdmFyIGMgPSB0aGlzLklNUkVBTChpbnVtYmVyMik7XHJcbiAgICAgICAgdmFyIGQgPSB0aGlzLklNQUdJTkFSWShpbnVtYmVyMik7XHJcblxyXG4gICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKGEsIGIsIGMsIGQpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIExvb2t1cCBpbWFnaW5hcnkgdW5pdFxyXG4gICAgICAgIHZhciB1bml0MSA9IGludW1iZXIxLnN1YnN0cmluZyhpbnVtYmVyMS5sZW5ndGggLSAxKTtcclxuICAgICAgICB2YXIgdW5pdDIgPSBpbnVtYmVyMi5zdWJzdHJpbmcoaW51bWJlcjIubGVuZ3RoIC0gMSk7XHJcbiAgICAgICAgdmFyIHVuaXQgPSAnaSc7XHJcbiAgICAgICAgaWYgKHVuaXQxID09PSAnaicpIHtcclxuICAgICAgICAgICAgdW5pdCA9ICdqJztcclxuICAgICAgICB9IGVsc2UgaWYgKHVuaXQyID09PSAnaicpIHtcclxuICAgICAgICAgICAgdW5pdCA9ICdqJztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBfIG9mIHR3byBjb21wbGV4IG51bWJlcnNcclxuICAgICAgICByZXR1cm4gdGhpcy5DT01QTEVYKGEgLSBjLCBiIC0gZCwgdW5pdCk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuSU1TVU0gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgYXJncyA9IHV0aWxzLmZsYXR0ZW4oYXJndW1lbnRzKTtcclxuXHJcbiAgICAgICAgLy8gSW5pdGlhbGl6ZSByZXN1bHRcclxuICAgICAgICB2YXIgcmVzdWx0ID0gYXJnc1swXTtcclxuXHJcbiAgICAgICAgLy8gTG9vcCBvbiBhbGwgbnVtYmVyc1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJncy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAvLyBMb29rdXAgY29lZmZpY2llbnRzIG9mIHR3byBjb21wbGV4IG51bWJlcnNcclxuICAgICAgICAgICAgdmFyIGEgPSB0aGlzLklNUkVBTChyZXN1bHQpO1xyXG4gICAgICAgICAgICB2YXIgYiA9IHRoaXMuSU1BR0lOQVJZKHJlc3VsdCk7XHJcbiAgICAgICAgICAgIHZhciBjID0gdGhpcy5JTVJFQUwoYXJnc1tpXSk7XHJcbiAgICAgICAgICAgIHZhciBkID0gdGhpcy5JTUFHSU5BUlkoYXJnc1tpXSk7XHJcblxyXG4gICAgICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihhLCBiLCBjLCBkKSkge1xyXG4gICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gQ29tcGx1dGUgcHJvZHVjdCBvZiB0d28gY29tcGxleCBudW1iZXJzXHJcbiAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMuQ09NUExFWChhICsgYywgYiArIGQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIHN1bSBvZiBjb21wbGV4IG51bWJlcnNcclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLklNVEFOID0gZnVuY3Rpb24oaW51bWJlcikge1xyXG4gICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBpbnVtYmVyIGlzIGEgbG9naWNhbCB2YWx1ZVxyXG4gICAgICAgIGlmIChpbnVtYmVyID09PSB0cnVlIHx8IGludW1iZXIgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIExvb2t1cCByZWFsIGFuZCBpbWFnaW5hcnkgY29lZmZpY2llbnRzIHVzaW5nIEZvcm11bGEuanNcclxuICAgICAgICAvLyBbaHR0cDovL2Zvcm11bGFqcy5vcmddXHJcbiAgICAgICAgdmFyIHggPSBleHBvcnRzLklNUkVBTChpbnVtYmVyKTtcclxuICAgICAgICB2YXIgeSA9IGV4cG9ydHMuSU1BR0lOQVJZKGludW1iZXIpO1xyXG5cclxuICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcih4LCB5KSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZXR1cm4gdGFuZ2VudCBvZiBjb21wbGV4IG51bWJlclxyXG4gICAgICAgIHJldHVybiB0aGlzLklNRElWKHRoaXMuSU1TSU4oaW51bWJlciksIHRoaXMuSU1DT1MoaW51bWJlcikpO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLk9DVDJCSU4gPSBmdW5jdGlvbihudW1iZXIsIHBsYWNlcykge1xyXG4gICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBudW1iZXIgaXMgbm90IGhleGFkZWNpbWFsIG9yIGNvbnRhaW5zIG1vcmUgdGhhbiB0ZW5cclxuICAgICAgICAvLyBjaGFyYWN0ZXJzICgxMCBkaWdpdHMpXHJcbiAgICAgICAgaWYgKCEvXlswLTddezEsMTB9JC8udGVzdChudW1iZXIpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBDaGVjayBpZiBudW1iZXIgaXMgbmVnYXRpdmVcclxuICAgICAgICB2YXIgbmVnYXRpdmUgPSAobnVtYmVyLmxlbmd0aCA9PT0gMTAgJiYgbnVtYmVyLnN1YnN0cmluZygwLCAxKSA9PT0gJzcnKSA/IHRydWUgOiBmYWxzZTtcclxuXHJcbiAgICAgICAgLy8gQ29udmVydCBvY3RhbCBudW1iZXIgdG8gZGVjaW1hbFxyXG4gICAgICAgIHZhciBkZWNpbWFsID0gKG5lZ2F0aXZlKSA/IHBhcnNlSW50KG51bWJlciwgOCkgLSAxMDczNzQxODI0IDogcGFyc2VJbnQobnVtYmVyLCA4KTtcclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIG51bWJlciBpcyBsb3dlciB0aGFuIC01MTIgb3IgZ3JlYXRlciB0aGFuIDUxMVxyXG4gICAgICAgIGlmIChkZWNpbWFsIDwgLTUxMiB8fCBkZWNpbWFsID4gNTExKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBJZ25vcmUgcGxhY2VzIGFuZCByZXR1cm4gYSAxMC1jaGFyYWN0ZXIgYmluYXJ5IG51bWJlciBpZiBudW1iZXIgaXNcclxuICAgICAgICAvLyBuZWdhdGl2ZVxyXG4gICAgICAgIGlmIChuZWdhdGl2ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gJzEnICsgUkVQVCgnMCcsIDkgLSAoNTEyICsgZGVjaW1hbCkudG9TdHJpbmcoMikubGVuZ3RoKSArICg1MTIgKyBkZWNpbWFsKS50b1N0cmluZygyKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIENvbnZlcnQgZGVjaW1hbCBudW1iZXIgdG8gYmluYXJ5XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IGRlY2ltYWwudG9TdHJpbmcoMik7XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBiaW5hcnkgbnVtYmVyIHVzaW5nIHRoZSBtaW5pbXVtIG51bWJlciBvZiBjaGFyYWN0ZXJzIG5lY2Vzc2FyeVxyXG4gICAgICAgIC8vIGlmIHBsYWNlcyBpcyB1bmRlZmluZWRcclxuICAgICAgICBpZiAodHlwZW9mIHBsYWNlcyA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgcGxhY2VzIGlzIG5vbm51bWVyaWNcclxuICAgICAgICAgICAgaWYgKGlzTmFOKHBsYWNlcykpIHtcclxuICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBwbGFjZXMgaXMgbmVnYXRpdmVcclxuICAgICAgICAgICAgaWYgKHBsYWNlcyA8IDApIHtcclxuICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBUcnVuY2F0ZSBwbGFjZXMgaW4gY2FzZSBpdCBpcyBub3QgYW4gaW50ZWdlclxyXG4gICAgICAgICAgICBwbGFjZXMgPSBNYXRoLmZsb29yKHBsYWNlcyk7XHJcblxyXG4gICAgICAgICAgICAvLyBQYWQgcmV0dXJuIHZhbHVlIHdpdGggbGVhZGluZyAwcyAoemVyb3MpIGlmIG5lY2Vzc2FyeSAodXNpbmdcclxuICAgICAgICAgICAgLy8gVW5kZXJzY29yZS5zdHJpbmcpXHJcbiAgICAgICAgICAgIHJldHVybiAocGxhY2VzID49IHJlc3VsdC5sZW5ndGgpID8gUkVQVCgnMCcsIHBsYWNlcyAtIHJlc3VsdC5sZW5ndGgpICsgcmVzdWx0IDogZXJyb3IubnVtO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5PQ1QyREVDID0gZnVuY3Rpb24obnVtYmVyKSB7XHJcbiAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIG51bWJlciBpcyBub3Qgb2N0YWwgb3IgY29udGFpbnMgbW9yZSB0aGFuIHRlblxyXG4gICAgICAgIC8vIGNoYXJhY3RlcnMgKDEwIGRpZ2l0cylcclxuICAgICAgICBpZiAoIS9eWzAtN117MSwxMH0kLy50ZXN0KG51bWJlcikpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIENvbnZlcnQgb2N0YWwgbnVtYmVyIHRvIGRlY2ltYWxcclxuICAgICAgICB2YXIgZGVjaW1hbCA9IHBhcnNlSW50KG51bWJlciwgOCk7XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBkZWNpbWFsIG51bWJlclxyXG4gICAgICAgIHJldHVybiAoZGVjaW1hbCA+PSA1MzY4NzA5MTIpID8gZGVjaW1hbCAtIDEwNzM3NDE4MjQgOiBkZWNpbWFsO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLk9DVDJIRVggPSBmdW5jdGlvbihudW1iZXIsIHBsYWNlcykge1xyXG4gICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBudW1iZXIgaXMgbm90IG9jdGFsIG9yIGNvbnRhaW5zIG1vcmUgdGhhbiB0ZW5cclxuICAgICAgICAvLyBjaGFyYWN0ZXJzICgxMCBkaWdpdHMpXHJcbiAgICAgICAgaWYgKCEvXlswLTddezEsMTB9JC8udGVzdChudW1iZXIpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBDb252ZXJ0IG9jdGFsIG51bWJlciB0byBkZWNpbWFsXHJcbiAgICAgICAgdmFyIGRlY2ltYWwgPSBwYXJzZUludChudW1iZXIsIDgpO1xyXG5cclxuICAgICAgICAvLyBJZ25vcmUgcGxhY2VzIGFuZCByZXR1cm4gYSAxMC1jaGFyYWN0ZXIgb2N0YWwgbnVtYmVyIGlmIG51bWJlciBpc1xyXG4gICAgICAgIC8vIG5lZ2F0aXZlXHJcbiAgICAgICAgaWYgKGRlY2ltYWwgPj0gNTM2ODcwOTEyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnZmYnICsgKGRlY2ltYWwgKyAzMjIxMjI1NDcyKS50b1N0cmluZygxNik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBDb252ZXJ0IGRlY2ltYWwgbnVtYmVyIHRvIGhleGFkZWNpbWFsXHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IGRlY2ltYWwudG9TdHJpbmcoMTYpO1xyXG5cclxuICAgICAgICAvLyBSZXR1cm4gaGV4YWRlY2ltYWwgbnVtYmVyIHVzaW5nIHRoZSBtaW5pbXVtIG51bWJlciBvZiBjaGFyYWN0ZXJzXHJcbiAgICAgICAgLy8gbmVjZXNzYXJ5IGlmIHBsYWNlcyBpcyB1bmRlZmluZWRcclxuICAgICAgICBpZiAocGxhY2VzID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgcGxhY2VzIGlzIG5vbm51bWVyaWNcclxuICAgICAgICAgICAgaWYgKGlzTmFOKHBsYWNlcykpIHtcclxuICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBwbGFjZXMgaXMgbmVnYXRpdmVcclxuICAgICAgICAgICAgaWYgKHBsYWNlcyA8IDApIHtcclxuICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBUcnVuY2F0ZSBwbGFjZXMgaW4gY2FzZSBpdCBpcyBub3QgYW4gaW50ZWdlclxyXG4gICAgICAgICAgICBwbGFjZXMgPSBNYXRoLmZsb29yKHBsYWNlcyk7XHJcblxyXG4gICAgICAgICAgICAvLyBQYWQgcmV0dXJuIHZhbHVlIHdpdGggbGVhZGluZyAwcyAoemVyb3MpIGlmIG5lY2Vzc2FyeSAodXNpbmdcclxuICAgICAgICAgICAgLy8gVW5kZXJzY29yZS5zdHJpbmcpXHJcbiAgICAgICAgICAgIHJldHVybiAocGxhY2VzID49IHJlc3VsdC5sZW5ndGgpID8gUkVQVCgnMCcsIHBsYWNlcyAtIHJlc3VsdC5sZW5ndGgpICsgcmVzdWx0IDogZXJyb3IubnVtO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIGV4cG9ydHM7XHJcbn0pKCk7XHJcblxyXG5qZXhjZWwubWV0aG9kcy5maW5hbmNpYWwgPSAoZnVuY3Rpb24oKSB7XHJcbiAgICB2YXIgZXhwb3J0cyA9IHt9O1xyXG5cclxuICAgIGZ1bmN0aW9uIHZhbGlkRGF0ZShkKSB7XHJcbiAgICAgICAgcmV0dXJuIGQgJiYgZC5nZXRUaW1lICYmICFpc05hTihkLmdldFRpbWUoKSk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZW5zdXJlRGF0ZShkKSB7XHJcbiAgICAgICAgcmV0dXJuIChkIGluc3RhbmNlb2YgRGF0ZSk/ZDpuZXcgRGF0ZShkKTtcclxuICAgIH1cclxuXHJcbiAgICBleHBvcnRzLkFDQ1JJTlQgPSBmdW5jdGlvbihpc3N1ZSwgZmlyc3QsIHNldHRsZW1lbnQsIHJhdGUsIHBhciwgZnJlcXVlbmN5LCBiYXNpcykge1xyXG4gICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBlaXRoZXIgZGF0ZSBpcyBpbnZhbGlkXHJcbiAgICAgICAgaXNzdWUgICAgICAgID0gZW5zdXJlRGF0ZShpc3N1ZSk7XHJcbiAgICAgICAgZmlyc3QgICAgICAgID0gZW5zdXJlRGF0ZShmaXJzdCk7XHJcbiAgICAgICAgc2V0dGxlbWVudCA9IGVuc3VyZURhdGUoc2V0dGxlbWVudCk7XHJcbiAgICAgICAgaWYgKCF2YWxpZERhdGUoaXNzdWUpIHx8ICF2YWxpZERhdGUoZmlyc3QpIHx8ICF2YWxpZERhdGUoc2V0dGxlbWVudCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuICcjVkFMVUUhJztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBlaXRoZXIgcmF0ZSBvciBwYXIgYXJlIGxvd2VyIHRoYW4gb3IgZXF1YWwgdG8gemVyb1xyXG4gICAgICAgIGlmIChyYXRlIDw9IDAgfHwgcGFyIDw9IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuICcjTlVNISc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgZnJlcXVlbmN5IGlzIG5laXRoZXIgMSwgMiwgb3IgNFxyXG4gICAgICAgIGlmIChbMSwgMiwgNF0uaW5kZXhPZihmcmVxdWVuY3kpID09PSAtMSkge1xyXG4gICAgICAgICAgICByZXR1cm4gJyNOVU0hJztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBiYXNpcyBpcyBuZWl0aGVyIDAsIDEsIDIsIDMsIG9yIDRcclxuICAgICAgICBpZiAoWzAsIDEsIDIsIDMsIDRdLmluZGV4T2YoYmFzaXMpID09PSAtMSkge1xyXG4gICAgICAgICAgICByZXR1cm4gJyNOVU0hJztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBzZXR0bGVtZW50IGlzIGJlZm9yZSBvciBlcXVhbCB0byBpc3N1ZVxyXG4gICAgICAgIGlmIChzZXR0bGVtZW50IDw9IGlzc3VlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnI05VTSEnO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gU2V0IGRlZmF1bHQgdmFsdWVzXHJcbiAgICAgICAgcGFyICAgPSBwYXIgICB8fCAwO1xyXG4gICAgICAgIGJhc2lzID0gYmFzaXMgfHwgMDtcclxuXHJcbiAgICAgICAgLy8gQ29tcHV0ZSBhY2NydWVkIGludGVyZXN0XHJcbiAgICAgICAgcmV0dXJuIHBhciAqIHJhdGUgKiBZRUFSRlJBQyhpc3N1ZSwgc2V0dGxlbWVudCwgYmFzaXMpO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLkFDQ1JJTlRNID0gbnVsbDtcclxuXHJcbiAgICBleHBvcnRzLkFNT1JERUdSQyA9IG51bGw7XHJcblxyXG4gICAgZXhwb3J0cy5BTU9STElOQyA9IG51bGw7XHJcblxyXG4gICAgZXhwb3J0cy5DT1VQREFZQlMgPSBudWxsO1xyXG5cclxuICAgIGV4cG9ydHMuQ09VUERBWVMgPSBudWxsO1xyXG5cclxuICAgIGV4cG9ydHMuQ09VUERBWVNOQyA9IG51bGw7XHJcblxyXG4gICAgZXhwb3J0cy5DT1VQTkNEID0gbnVsbDtcclxuXHJcbiAgICBleHBvcnRzLkNPVVBOVU0gPSBudWxsO1xyXG5cclxuICAgIGV4cG9ydHMuQ09VUFBDRCA9IG51bGw7XHJcblxyXG4gICAgZXhwb3J0cy5DVU1JUE1UID0gZnVuY3Rpb24ocmF0ZSwgcGVyaW9kcywgdmFsdWUsIHN0YXJ0LCBlbmQsIHR5cGUpIHtcclxuICAgICAgICAvLyBDcmVkaXRzOiBhbGdvcml0aG0gaW5zcGlyZWQgYnkgQXBhY2hlIE9wZW5PZmZpY2VcclxuICAgICAgICAvLyBDcmVkaXRzOiBIYW5uZXMgU3RpZWJpdHpob2ZlciBmb3IgdGhlIHRyYW5zbGF0aW9ucyBvZiBmdW5jdGlvbiBhbmRcclxuICAgICAgICAgICAgLy8gdmFyaWFibGUgbmFtZXNcclxuICAgICAgICAvLyBSZXF1aXJlcyBleHBvcnRzLkZWKCkgYW5kIGV4cG9ydHMuUE1UKCkgZnJvbSBleHBvcnRzLmpzXHJcbiAgICAgICAgICAgIC8vIFtodHRwOi8vc3RvaWMuY29tL2V4cG9ydHMvXVxyXG5cclxuICAgICAgICByYXRlID0gdXRpbHMucGFyc2VOdW1iZXIocmF0ZSk7XHJcbiAgICAgICAgcGVyaW9kcyA9IHV0aWxzLnBhcnNlTnVtYmVyKHBlcmlvZHMpO1xyXG4gICAgICAgIHZhbHVlID0gdXRpbHMucGFyc2VOdW1iZXIodmFsdWUpO1xyXG4gICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKHJhdGUsIHBlcmlvZHMsIHZhbHVlKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgZWl0aGVyIHJhdGUsIHBlcmlvZHMsIG9yIHZhbHVlIGFyZSBsb3dlciB0aGFuIG9yXHJcbiAgICAgICAgICAgIC8vIGVxdWFsIHRvIHplcm9cclxuICAgICAgICBpZiAocmF0ZSA8PSAwIHx8IHBlcmlvZHMgPD0gMCB8fCB2YWx1ZSA8PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgc3RhcnQgPCAxLCBlbmQgPCAxLCBvciBzdGFydCA+IGVuZFxyXG4gICAgICAgIGlmIChzdGFydCA8IDEgfHwgZW5kIDwgMSB8fCBzdGFydCA+IGVuZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIHR5cGUgaXMgbmVpdGhlciAwIG5vciAxXHJcbiAgICAgICAgaWYgKHR5cGUgIT09IDAgJiYgdHlwZSAhPT0gMSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQ29tcHV0ZSBjdW11bGF0aXZlIGludGVyZXN0XHJcbiAgICAgICAgdmFyIHBheW1lbnQgPSBleHBvcnRzLlBNVChyYXRlLCBwZXJpb2RzLCB2YWx1ZSwgMCwgdHlwZSk7XHJcbiAgICAgICAgdmFyIGludGVyZXN0ID0gMDtcclxuXHJcbiAgICAgICAgaWYgKHN0YXJ0ID09PSAxKSB7XHJcbiAgICAgICAgICAgIGlmICh0eXBlID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBpbnRlcmVzdCA9IC12YWx1ZTtcclxuICAgICAgICAgICAgICAgIHN0YXJ0Kys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZvciAodmFyIGkgPSBzdGFydDsgaSA8PSBlbmQ7IGkrKykge1xyXG4gICAgICAgICAgICBpZiAodHlwZSA9PT0gMSkge1xyXG4gICAgICAgICAgICAgICAgaW50ZXJlc3QgKz0gZXhwb3J0cy5GVihyYXRlLCBpIC0gMiwgcGF5bWVudCwgdmFsdWUsIDEpIC0gcGF5bWVudDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGludGVyZXN0ICs9IGV4cG9ydHMuRlYocmF0ZSwgaSAtIDEsIHBheW1lbnQsIHZhbHVlLCAwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpbnRlcmVzdCAqPSByYXRlO1xyXG5cclxuICAgICAgICAvLyBSZXR1cm4gY3VtdWxhdGl2ZSBpbnRlcmVzdFxyXG4gICAgICAgIHJldHVybiBpbnRlcmVzdDtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5DVU1QUklOQyA9IGZ1bmN0aW9uKHJhdGUsIHBlcmlvZHMsIHZhbHVlLCBzdGFydCwgZW5kLCB0eXBlKSB7XHJcbiAgICAgICAgLy8gQ3JlZGl0czogYWxnb3JpdGhtIGluc3BpcmVkIGJ5IEFwYWNoZSBPcGVuT2ZmaWNlXHJcbiAgICAgICAgLy8gQ3JlZGl0czogSGFubmVzIFN0aWViaXR6aG9mZXIgZm9yIHRoZSB0cmFuc2xhdGlvbnMgb2YgZnVuY3Rpb24gYW5kXHJcbiAgICAgICAgICAgIC8vIHZhcmlhYmxlIG5hbWVzXHJcblxyXG4gICAgICAgIHJhdGUgPSB1dGlscy5wYXJzZU51bWJlcihyYXRlKTtcclxuICAgICAgICBwZXJpb2RzID0gdXRpbHMucGFyc2VOdW1iZXIocGVyaW9kcyk7XHJcbiAgICAgICAgdmFsdWUgPSB1dGlscy5wYXJzZU51bWJlcih2YWx1ZSk7XHJcbiAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IocmF0ZSwgcGVyaW9kcywgdmFsdWUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBlaXRoZXIgcmF0ZSwgcGVyaW9kcywgb3IgdmFsdWUgYXJlIGxvd2VyIHRoYW4gb3JcclxuICAgICAgICAgICAgLy8gZXF1YWwgdG8gemVyb1xyXG4gICAgICAgIGlmIChyYXRlIDw9IDAgfHwgcGVyaW9kcyA8PSAwIHx8IHZhbHVlIDw9IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBzdGFydCA8IDEsIGVuZCA8IDEsIG9yIHN0YXJ0ID4gZW5kXHJcbiAgICAgICAgaWYgKHN0YXJ0IDwgMSB8fCBlbmQgPCAxIHx8IHN0YXJ0ID4gZW5kKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgdHlwZSBpcyBuZWl0aGVyIDAgbm9yIDFcclxuICAgICAgICBpZiAodHlwZSAhPT0gMCAmJiB0eXBlICE9PSAxKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBDb21wdXRlIGN1bXVsYXRpdmUgcHJpbmNpcGFsXHJcbiAgICAgICAgdmFyIHBheW1lbnQgPSBleHBvcnRzLlBNVChyYXRlLCBwZXJpb2RzLCB2YWx1ZSwgMCwgdHlwZSk7XHJcbiAgICAgICAgdmFyIHByaW5jaXBhbCA9IDA7XHJcbiAgICAgICAgaWYgKHN0YXJ0ID09PSAxKSB7XHJcbiAgICAgICAgICAgIGlmICh0eXBlID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBwcmluY2lwYWwgPSBwYXltZW50ICsgdmFsdWUgKiByYXRlO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcHJpbmNpcGFsID0gcGF5bWVudDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzdGFydCsrO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKHZhciBpID0gc3RhcnQ7IGkgPD0gZW5kOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKHR5cGUgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBwcmluY2lwYWwgKz0gcGF5bWVudCAtIChleHBvcnRzLkZWKHJhdGUsIGkgLSAyLCBwYXltZW50LCB2YWx1ZSwgMSkgLSBwYXltZW50KSAqIHJhdGU7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBwcmluY2lwYWwgKz0gcGF5bWVudCAtIGV4cG9ydHMuRlYocmF0ZSwgaSAtIDEsIHBheW1lbnQsIHZhbHVlLCAwKSAqIHJhdGU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBjdW11bGF0aXZlIHByaW5jaXBhbFxyXG4gICAgICAgIHJldHVybiBwcmluY2lwYWw7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuREIgPSBmdW5jdGlvbihjb3N0LCBzYWx2YWdlLCBsaWZlLCBwZXJpb2QsIG1vbnRoKSB7XHJcbiAgICAgICAgLy8gSW5pdGlhbGl6ZSBtb250aFxyXG4gICAgICAgIG1vbnRoID0gKG1vbnRoID09PSB1bmRlZmluZWQpID8gMTIgOiBtb250aDtcclxuXHJcbiAgICAgICAgY29zdCA9IHV0aWxzLnBhcnNlTnVtYmVyKGNvc3QpO1xyXG4gICAgICAgIHNhbHZhZ2UgPSB1dGlscy5wYXJzZU51bWJlcihzYWx2YWdlKTtcclxuICAgICAgICBsaWZlID0gdXRpbHMucGFyc2VOdW1iZXIobGlmZSk7XHJcbiAgICAgICAgcGVyaW9kID0gdXRpbHMucGFyc2VOdW1iZXIocGVyaW9kKTtcclxuICAgICAgICBtb250aCA9IHV0aWxzLnBhcnNlTnVtYmVyKG1vbnRoKTtcclxuICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihjb3N0LCBzYWx2YWdlLCBsaWZlLCBwZXJpb2QsIG1vbnRoKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGlzIG5lZ2F0aXZlXHJcbiAgICAgICAgaWYgKGNvc3QgPCAwIHx8IHNhbHZhZ2UgPCAwIHx8IGxpZmUgPCAwIHx8IHBlcmlvZCA8IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBtb250aCBpcyBub3QgYW4gaW50ZWdlciBiZXR3ZWVuIDEgYW5kIDEyXHJcbiAgICAgICAgaWYgKFsxLCAyLCAzLCA0LCA1LCA2LCA3LCA4LCA5LCAxMCwgMTEsIDEyXS5pbmRleE9mKG1vbnRoKSA9PT0gLTEpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBwZXJpb2QgaXMgZ3JlYXRlciB0aGFuIGxpZmVcclxuICAgICAgICBpZiAocGVyaW9kID4gbGlmZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIDAgKHplcm8pIGlmIHNhbHZhZ2UgaXMgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIGNvc3RcclxuICAgICAgICBpZiAoc2FsdmFnZSA+PSBjb3N0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUmF0ZSBpcyByb3VuZGVkIHRvIHRocmVlIGRlY2ltYWxzIHBsYWNlc1xyXG4gICAgICAgIHZhciByYXRlID0gKDEgLSBNYXRoLnBvdyhzYWx2YWdlIC8gY29zdCwgMSAvIGxpZmUpKS50b0ZpeGVkKDMpO1xyXG5cclxuICAgICAgICAvLyBDb21wdXRlIGluaXRpYWwgZGVwcmVjaWF0aW9uXHJcbiAgICAgICAgdmFyIGluaXRpYWwgPSBjb3N0ICogcmF0ZSAqIG1vbnRoIC8gMTI7XHJcblxyXG4gICAgICAgIC8vIENvbXB1dGUgdG90YWwgZGVwcmVjaWF0aW9uXHJcbiAgICAgICAgdmFyIHRvdGFsID0gaW5pdGlhbDtcclxuICAgICAgICB2YXIgY3VycmVudCA9IDA7XHJcbiAgICAgICAgdmFyIGNlaWxpbmcgPSAocGVyaW9kID09PSBsaWZlKSA/IGxpZmUgLSAxIDogcGVyaW9kO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAyOyBpIDw9IGNlaWxpbmc7IGkrKykge1xyXG4gICAgICAgICAgICBjdXJyZW50ID0gKGNvc3QgLSB0b3RhbCkgKiByYXRlO1xyXG4gICAgICAgICAgICB0b3RhbCArPSBjdXJyZW50O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gRGVwcmVjaWF0aW9uIGZvciB0aGUgZmlyc3QgYW5kIGxhc3QgcGVyaW9kcyBhcmUgc3BlY2lhbCBjYXNlc1xyXG4gICAgICAgIGlmIChwZXJpb2QgPT09IDEpIHtcclxuICAgICAgICAgICAgLy8gRmlyc3QgcGVyaW9kXHJcbiAgICAgICAgICAgIHJldHVybiBpbml0aWFsO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocGVyaW9kID09PSBsaWZlKSB7XHJcbiAgICAgICAgICAgIC8vIExhc3QgcGVyaW9kXHJcbiAgICAgICAgICAgIHJldHVybiAoY29zdCAtIHRvdGFsKSAqIHJhdGU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnQ7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLkREQiA9IGZ1bmN0aW9uKGNvc3QsIHNhbHZhZ2UsIGxpZmUsIHBlcmlvZCwgZmFjdG9yKSB7XHJcbiAgICAgICAgLy8gSW5pdGlhbGl6ZSBmYWN0b3JcclxuICAgICAgICBmYWN0b3IgPSAoZmFjdG9yID09PSB1bmRlZmluZWQpID8gMiA6IGZhY3RvcjtcclxuXHJcbiAgICAgICAgY29zdCA9IHV0aWxzLnBhcnNlTnVtYmVyKGNvc3QpO1xyXG4gICAgICAgIHNhbHZhZ2UgPSB1dGlscy5wYXJzZU51bWJlcihzYWx2YWdlKTtcclxuICAgICAgICBsaWZlID0gdXRpbHMucGFyc2VOdW1iZXIobGlmZSk7XHJcbiAgICAgICAgcGVyaW9kID0gdXRpbHMucGFyc2VOdW1iZXIocGVyaW9kKTtcclxuICAgICAgICBmYWN0b3IgPSB1dGlscy5wYXJzZU51bWJlcihmYWN0b3IpO1xyXG4gICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKGNvc3QsIHNhbHZhZ2UsIGxpZmUsIHBlcmlvZCwgZmFjdG9yKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGlzIG5lZ2F0aXZlIG9yIGlmIGZhY3RvciBpc1xyXG4gICAgICAgICAgICAvLyBudWxsXHJcbiAgICAgICAgaWYgKGNvc3QgPCAwIHx8IHNhbHZhZ2UgPCAwIHx8IGxpZmUgPCAwIHx8IHBlcmlvZCA8IDAgfHwgZmFjdG9yIDw9IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBwZXJpb2QgaXMgZ3JlYXRlciB0aGFuIGxpZmVcclxuICAgICAgICBpZiAocGVyaW9kID4gbGlmZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIDAgKHplcm8pIGlmIHNhbHZhZ2UgaXMgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIGNvc3RcclxuICAgICAgICBpZiAoc2FsdmFnZSA+PSBjb3N0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQ29tcHV0ZSBkZXByZWNpYXRpb25cclxuICAgICAgICB2YXIgdG90YWwgPSAwO1xyXG4gICAgICAgIHZhciBjdXJyZW50ID0gMDtcclxuICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8PSBwZXJpb2Q7IGkrKykge1xyXG4gICAgICAgICAgICBjdXJyZW50ID0gTWF0aC5taW4oKGNvc3QgLSB0b3RhbCkgKiAoZmFjdG9yIC8gbGlmZSksIChjb3N0IC0gc2FsdmFnZSAtIHRvdGFsKSk7XHJcbiAgICAgICAgICAgIHRvdGFsICs9IGN1cnJlbnQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZXR1cm4gZGVwcmVjaWF0aW9uXHJcbiAgICAgICAgcmV0dXJuIGN1cnJlbnQ7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuRElTQyA9IG51bGw7XHJcblxyXG4gICAgZXhwb3J0cy5ET0xMQVJERSA9IGZ1bmN0aW9uKGRvbGxhciwgZnJhY3Rpb24pIHtcclxuICAgICAgICAvLyBDcmVkaXRzOiBhbGdvcml0aG0gaW5zcGlyZWQgYnkgQXBhY2hlIE9wZW5PZmZpY2VcclxuXHJcbiAgICAgICAgZG9sbGFyID0gdXRpbHMucGFyc2VOdW1iZXIoZG9sbGFyKTtcclxuICAgICAgICBmcmFjdGlvbiA9IHV0aWxzLnBhcnNlTnVtYmVyKGZyYWN0aW9uKTtcclxuICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihkb2xsYXIsIGZyYWN0aW9uKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgZnJhY3Rpb24gaXMgbmVnYXRpdmVcclxuICAgICAgICBpZiAoZnJhY3Rpb24gPCAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgZnJhY3Rpb24gaXMgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIDAgYW5kIGxlc3MgdGhhblxyXG4gICAgICAgICAgICAvLyAxXHJcbiAgICAgICAgaWYgKGZyYWN0aW9uID49IDAgJiYgZnJhY3Rpb24gPCAxKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5kaXYwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gVHJ1bmNhdGUgZnJhY3Rpb24gaWYgaXQgaXMgbm90IGFuIGludGVnZXJcclxuICAgICAgICBmcmFjdGlvbiA9IHBhcnNlSW50KGZyYWN0aW9uLCAxMCk7XHJcblxyXG4gICAgICAgIC8vIENvbXB1dGUgaW50ZWdlciBwYXJ0XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IHBhcnNlSW50KGRvbGxhciwgMTApO1xyXG5cclxuICAgICAgICAvLyBBZGQgZGVjaW1hbCBwYXJ0XHJcbiAgICAgICAgcmVzdWx0ICs9IChkb2xsYXIgJSAxKSAqIE1hdGgucG93KDEwLCBNYXRoLmNlaWwoTWF0aC5sb2coZnJhY3Rpb24pIC8gTWF0aC5MTjEwKSkgLyBmcmFjdGlvbjtcclxuXHJcbiAgICAgICAgLy8gUm91bmQgcmVzdWx0XHJcbiAgICAgICAgdmFyIHBvd2VyID0gTWF0aC5wb3coMTAsIE1hdGguY2VpbChNYXRoLmxvZyhmcmFjdGlvbikgLyBNYXRoLkxOMikgKyAxKTtcclxuICAgICAgICByZXN1bHQgPSBNYXRoLnJvdW5kKHJlc3VsdCAqIHBvd2VyKSAvIHBvd2VyO1xyXG5cclxuICAgICAgICAvLyBSZXR1cm4gY29udmVydGVkIGRvbGxhciBwcmljZVxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuRE9MTEFSRlIgPSBmdW5jdGlvbihkb2xsYXIsIGZyYWN0aW9uKSB7XHJcbiAgICAgICAgLy8gQ3JlZGl0czogYWxnb3JpdGhtIGluc3BpcmVkIGJ5IEFwYWNoZSBPcGVuT2ZmaWNlXHJcblxyXG4gICAgICAgIGRvbGxhciA9IHV0aWxzLnBhcnNlTnVtYmVyKGRvbGxhcik7XHJcbiAgICAgICAgZnJhY3Rpb24gPSB1dGlscy5wYXJzZU51bWJlcihmcmFjdGlvbik7XHJcbiAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IoZG9sbGFyLCBmcmFjdGlvbikpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIGZyYWN0aW9uIGlzIG5lZ2F0aXZlXHJcbiAgICAgICAgaWYgKGZyYWN0aW9uIDwgMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIGZyYWN0aW9uIGlzIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byAwIGFuZCBsZXNzIHRoYW5cclxuICAgICAgICAgICAgLy8gMVxyXG4gICAgICAgIGlmIChmcmFjdGlvbiA+PSAwICYmIGZyYWN0aW9uIDwgMSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IuZGl2MDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFRydW5jYXRlIGZyYWN0aW9uIGlmIGl0IGlzIG5vdCBhbiBpbnRlZ2VyXHJcbiAgICAgICAgZnJhY3Rpb24gPSBwYXJzZUludChmcmFjdGlvbiwgMTApO1xyXG5cclxuICAgICAgICAvLyBDb21wdXRlIGludGVnZXIgcGFydFxyXG4gICAgICAgIHZhciByZXN1bHQgPSBwYXJzZUludChkb2xsYXIsIDEwKTtcclxuXHJcbiAgICAgICAgLy8gQWRkIGRlY2ltYWwgcGFydFxyXG4gICAgICAgIHJlc3VsdCArPSAoZG9sbGFyICUgMSkgKiBNYXRoLnBvdygxMCwgLU1hdGguY2VpbChNYXRoLmxvZyhmcmFjdGlvbikgLyBNYXRoLkxOMTApKSAqIGZyYWN0aW9uO1xyXG5cclxuICAgICAgICAvLyBSZXR1cm4gY29udmVydGVkIGRvbGxhciBwcmljZVxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuRFVSQVRJT04gPSBudWxsO1xyXG5cclxuICAgIGV4cG9ydHMuRUZGRUNUID0gZnVuY3Rpb24ocmF0ZSwgcGVyaW9kcykge1xyXG4gICAgICAgIHJhdGUgPSB1dGlscy5wYXJzZU51bWJlcihyYXRlKTtcclxuICAgICAgICBwZXJpb2RzID0gdXRpbHMucGFyc2VOdW1iZXIocGVyaW9kcyk7XHJcbiAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IocmF0ZSwgcGVyaW9kcykpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIHJhdGUgPD0wIG9yIHBlcmlvZHMgPCAxXHJcbiAgICAgICAgaWYgKHJhdGUgPD0gMCB8fCBwZXJpb2RzIDwgMSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gVHJ1bmNhdGUgcGVyaW9kcyBpZiBpdCBpcyBub3QgYW4gaW50ZWdlclxyXG4gICAgICAgIHBlcmlvZHMgPSBwYXJzZUludChwZXJpb2RzLCAxMCk7XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBlZmZlY3RpdmUgYW5udWFsIGludGVyZXN0IHJhdGVcclxuICAgICAgICByZXR1cm4gTWF0aC5wb3coMSArIHJhdGUgLyBwZXJpb2RzLCBwZXJpb2RzKSAtIDE7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuRlYgPSBmdW5jdGlvbihyYXRlLCBwZXJpb2RzLCBwYXltZW50LCB2YWx1ZSwgdHlwZSkge1xyXG4gICAgICAgIC8vIENyZWRpdHM6IGFsZ29yaXRobSBpbnNwaXJlZCBieSBBcGFjaGUgT3Blbk9mZmljZVxyXG5cclxuICAgICAgICB2YWx1ZSA9IHZhbHVlIHx8IDA7XHJcbiAgICAgICAgdHlwZSA9IHR5cGUgfHwgMDtcclxuXHJcbiAgICAgICAgcmF0ZSA9IHV0aWxzLnBhcnNlTnVtYmVyKHJhdGUpO1xyXG4gICAgICAgIHBlcmlvZHMgPSB1dGlscy5wYXJzZU51bWJlcihwZXJpb2RzKTtcclxuICAgICAgICBwYXltZW50ID0gdXRpbHMucGFyc2VOdW1iZXIocGF5bWVudCk7XHJcbiAgICAgICAgdmFsdWUgPSB1dGlscy5wYXJzZU51bWJlcih2YWx1ZSk7XHJcbiAgICAgICAgdHlwZSA9IHV0aWxzLnBhcnNlTnVtYmVyKHR5cGUpO1xyXG4gICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKHJhdGUsIHBlcmlvZHMsIHBheW1lbnQsIHZhbHVlLCB0eXBlKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZXR1cm4gZnV0dXJlIHZhbHVlXHJcbiAgICAgICAgdmFyIHJlc3VsdDtcclxuICAgICAgICBpZiAocmF0ZSA9PT0gMCkge1xyXG4gICAgICAgICAgICByZXN1bHQgPSB2YWx1ZSArIHBheW1lbnQgKiBwZXJpb2RzO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHZhciB0ZXJtID0gTWF0aC5wb3coMSArIHJhdGUsIHBlcmlvZHMpO1xyXG4gICAgICAgICAgICBpZiAodHlwZSA9PT0gMSkge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gdmFsdWUgKiB0ZXJtICsgcGF5bWVudCAqICgxICsgcmF0ZSkgKiAodGVybSAtIDEpIC8gcmF0ZTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHZhbHVlICogdGVybSArIHBheW1lbnQgKiAodGVybSAtIDEpIC8gcmF0ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gLXJlc3VsdDtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5GVlNDSEVEVUxFID0gZnVuY3Rpb24ocHJpbmNpcGFsLCBzY2hlZHVsZSkge1xyXG4gICAgICAgIHByaW5jaXBhbCA9IHV0aWxzLnBhcnNlTnVtYmVyKHByaW5jaXBhbCk7XHJcbiAgICAgICAgc2NoZWR1bGUgPSB1dGlscy5wYXJzZU51bWJlckFycmF5KHV0aWxzLmZsYXR0ZW4oc2NoZWR1bGUpKTtcclxuICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihwcmluY2lwYWwsIHNjaGVkdWxlKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgbiA9IHNjaGVkdWxlLmxlbmd0aDtcclxuICAgICAgICB2YXIgZnV0dXJlID0gcHJpbmNpcGFsO1xyXG5cclxuICAgICAgICAvLyBBcHBseSBhbGwgaW50ZXJlc3RzIGluIHNjaGVkdWxlXHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuOyBpKyspIHtcclxuICAgICAgICAgICAgLy8gQXBwbHkgc2NoZWR1bGVkIGludGVyZXN0XHJcbiAgICAgICAgICAgIGZ1dHVyZSAqPSAxICsgc2NoZWR1bGVbaV07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZXR1cm4gZnV0dXJlIHZhbHVlXHJcbiAgICAgICAgcmV0dXJuIGZ1dHVyZTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5JTlRSQVRFID0gbnVsbDtcclxuXHJcbiAgICBleHBvcnRzLklQTVQgPSBmdW5jdGlvbihyYXRlLCBwZXJpb2QsIHBlcmlvZHMsIHByZXNlbnQsIGZ1dHVyZSwgdHlwZSkge1xyXG4gICAgICAgIC8vIENyZWRpdHM6IGFsZ29yaXRobSBpbnNwaXJlZCBieSBBcGFjaGUgT3Blbk9mZmljZVxyXG5cclxuICAgICAgICBmdXR1cmUgPSBmdXR1cmUgfHwgMDtcclxuICAgICAgICB0eXBlID0gdHlwZSB8fCAwO1xyXG5cclxuICAgICAgICByYXRlID0gdXRpbHMucGFyc2VOdW1iZXIocmF0ZSk7XHJcbiAgICAgICAgcGVyaW9kID0gdXRpbHMucGFyc2VOdW1iZXIocGVyaW9kKTtcclxuICAgICAgICBwZXJpb2RzID0gdXRpbHMucGFyc2VOdW1iZXIocGVyaW9kcyk7XHJcbiAgICAgICAgcHJlc2VudCA9IHV0aWxzLnBhcnNlTnVtYmVyKHByZXNlbnQpO1xyXG4gICAgICAgIGZ1dHVyZSA9IHV0aWxzLnBhcnNlTnVtYmVyKGZ1dHVyZSk7XHJcbiAgICAgICAgdHlwZSA9IHV0aWxzLnBhcnNlTnVtYmVyKHR5cGUpO1xyXG4gICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKHJhdGUsIHBlcmlvZCwgcGVyaW9kcywgcHJlc2VudCwgZnV0dXJlLCB0eXBlKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBDb21wdXRlIHBheW1lbnRcclxuICAgICAgICB2YXIgcGF5bWVudCA9IGV4cG9ydHMuUE1UKHJhdGUsIHBlcmlvZHMsIHByZXNlbnQsIGZ1dHVyZSwgdHlwZSk7XHJcblxyXG4gICAgICAgIC8vIENvbXB1dGUgaW50ZXJlc3RcclxuICAgICAgICB2YXIgaW50ZXJlc3Q7XHJcbiAgICAgICAgaWYgKHBlcmlvZCA9PT0gMSkge1xyXG4gICAgICAgICAgICBpZiAodHlwZSA9PT0gMSkge1xyXG4gICAgICAgICAgICAgICAgaW50ZXJlc3QgPSAwO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaW50ZXJlc3QgPSAtcHJlc2VudDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICh0eXBlID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICBpbnRlcmVzdCA9IGV4cG9ydHMuRlYocmF0ZSwgcGVyaW9kIC0gMiwgcGF5bWVudCwgcHJlc2VudCwgMSkgLSBwYXltZW50O1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaW50ZXJlc3QgPSBleHBvcnRzLkZWKHJhdGUsIHBlcmlvZCAtIDEsIHBheW1lbnQsIHByZXNlbnQsIDApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZXR1cm4gaW50ZXJlc3RcclxuICAgICAgICByZXR1cm4gaW50ZXJlc3QgKiByYXRlO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLklSUiA9IGZ1bmN0aW9uKHZhbHVlcywgZ3Vlc3MpIHtcclxuICAgICAgICAvLyBDcmVkaXRzOiBhbGdvcml0aG0gaW5zcGlyZWQgYnkgQXBhY2hlIE9wZW5PZmZpY2VcclxuXHJcbiAgICAgICAgZ3Vlc3MgPSBndWVzcyB8fCAwO1xyXG5cclxuICAgICAgICB2YWx1ZXMgPSB1dGlscy5wYXJzZU51bWJlckFycmF5KHV0aWxzLmZsYXR0ZW4odmFsdWVzKSk7XHJcbiAgICAgICAgZ3Vlc3MgPSB1dGlscy5wYXJzZU51bWJlcihndWVzcyk7XHJcbiAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IodmFsdWVzLCBndWVzcykpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQ2FsY3VsYXRlcyB0aGUgcmVzdWx0aW5nIGFtb3VudFxyXG4gICAgICAgIHZhciBpcnJSZXN1bHQgPSBmdW5jdGlvbih2YWx1ZXMsIGRhdGVzLCByYXRlKSB7XHJcbiAgICAgICAgICAgIHZhciByID0gcmF0ZSArIDE7XHJcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSB2YWx1ZXNbMF07XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgdmFsdWVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQgKz0gdmFsdWVzW2ldIC8gTWF0aC5wb3cociwgKGRhdGVzW2ldIC0gZGF0ZXNbMF0pIC8gMzY1KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIENhbGN1bGF0ZXMgdGhlIGZpcnN0IGRlcml2YXRpb25cclxuICAgICAgICB2YXIgaXJyUmVzdWx0RGVyaXYgPSBmdW5jdGlvbih2YWx1ZXMsIGRhdGVzLCByYXRlKSB7XHJcbiAgICAgICAgICAgIHZhciByID0gcmF0ZSArIDE7XHJcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSAwO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IHZhbHVlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGZyYWMgPSAoZGF0ZXNbaV0gLSBkYXRlc1swXSkgLyAzNjU7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQgLT0gZnJhYyAqIHZhbHVlc1tpXSAvIE1hdGgucG93KHIsIGZyYWMgKyAxKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIEluaXRpYWxpemUgZGF0ZXMgYW5kIGNoZWNrIHRoYXQgdmFsdWVzIGNvbnRhaW5zIGF0IGxlYXN0IG9uZSBwb3NpdGl2ZVxyXG4gICAgICAgICAgICAvLyB2YWx1ZSBhbmQgb25lIG5lZ2F0aXZlIHZhbHVlXHJcbiAgICAgICAgdmFyIGRhdGVzID0gW107XHJcbiAgICAgICAgdmFyIHBvc2l0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgdmFyIG5lZ2F0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2YWx1ZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgZGF0ZXNbaV0gPSAoaSA9PT0gMCkgPyAwIDogZGF0ZXNbaSAtIDFdICsgMzY1O1xyXG4gICAgICAgICAgICBpZiAodmFsdWVzW2ldID4gMCkge1xyXG4gICAgICAgICAgICAgICAgcG9zaXRpdmUgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh2YWx1ZXNbaV0gPCAwKSB7XHJcbiAgICAgICAgICAgICAgICBuZWdhdGl2ZSA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBlcnJvciBpZiB2YWx1ZXMgZG9lcyBub3QgY29udGFpbiBhdCBsZWFzdCBvbmUgcG9zaXRpdmUgdmFsdWVcclxuICAgICAgICAgICAgLy8gYW5kIG9uZSBuZWdhdGl2ZSB2YWx1ZVxyXG4gICAgICAgIGlmICghcG9zaXRpdmUgfHwgIW5lZ2F0aXZlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBJbml0aWFsaXplIGd1ZXNzIGFuZCByZXN1bHRSYXRlXHJcbiAgICAgICAgZ3Vlc3MgPSAoZ3Vlc3MgPT09IHVuZGVmaW5lZCkgPyAwLjEgOiBndWVzcztcclxuICAgICAgICB2YXIgcmVzdWx0UmF0ZSA9IGd1ZXNzO1xyXG5cclxuICAgICAgICAvLyBTZXQgbWF4aW11bSBlcHNpbG9uIGZvciBlbmQgb2YgaXRlcmF0aW9uXHJcbiAgICAgICAgdmFyIGVwc01heCA9IDFlLTEwO1xyXG5cclxuICAgICAgICAvLyBJbXBsZW1lbnQgTmV3dG9uJ3MgbWV0aG9kXHJcbiAgICAgICAgdmFyIG5ld1JhdGUsIGVwc1JhdGUsIHJlc3VsdFZhbHVlO1xyXG4gICAgICAgIHZhciBjb250TG9vcCA9IHRydWU7XHJcbiAgICAgICAgZG8ge1xyXG4gICAgICAgICAgICByZXN1bHRWYWx1ZSA9IGlyclJlc3VsdCh2YWx1ZXMsIGRhdGVzLCByZXN1bHRSYXRlKTtcclxuICAgICAgICAgICAgbmV3UmF0ZSA9IHJlc3VsdFJhdGUgLSByZXN1bHRWYWx1ZSAvIGlyclJlc3VsdERlcml2KHZhbHVlcywgZGF0ZXMsIHJlc3VsdFJhdGUpO1xyXG4gICAgICAgICAgICBlcHNSYXRlID0gTWF0aC5hYnMobmV3UmF0ZSAtIHJlc3VsdFJhdGUpO1xyXG4gICAgICAgICAgICByZXN1bHRSYXRlID0gbmV3UmF0ZTtcclxuICAgICAgICAgICAgY29udExvb3AgPSAoZXBzUmF0ZSA+IGVwc01heCkgJiYgKE1hdGguYWJzKHJlc3VsdFZhbHVlKSA+IGVwc01heCk7XHJcbiAgICAgICAgfSB3aGlsZSAoY29udExvb3ApO1xyXG5cclxuICAgICAgICAvLyBSZXR1cm4gaW50ZXJuYWwgcmF0ZSBvZiByZXR1cm5cclxuICAgICAgICByZXR1cm4gcmVzdWx0UmF0ZTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5JU1BNVCA9IGZ1bmN0aW9uKHJhdGUsIHBlcmlvZCwgcGVyaW9kcywgdmFsdWUpIHtcclxuICAgICAgICByYXRlID0gdXRpbHMucGFyc2VOdW1iZXIocmF0ZSk7XHJcbiAgICAgICAgcGVyaW9kID0gdXRpbHMucGFyc2VOdW1iZXIocGVyaW9kKTtcclxuICAgICAgICBwZXJpb2RzID0gdXRpbHMucGFyc2VOdW1iZXIocGVyaW9kcyk7XHJcbiAgICAgICAgdmFsdWUgPSB1dGlscy5wYXJzZU51bWJlcih2YWx1ZSk7XHJcbiAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IocmF0ZSwgcGVyaW9kLCBwZXJpb2RzLCB2YWx1ZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIGludGVyZXN0XHJcbiAgICAgICAgcmV0dXJuIHZhbHVlICogcmF0ZSAqIChwZXJpb2QgLyBwZXJpb2RzIC0gMSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuTURVUkFUSU9OID0gbnVsbDtcclxuXHJcbiAgICBleHBvcnRzLk1JUlIgPSBmdW5jdGlvbih2YWx1ZXMsIGZpbmFuY2VfcmF0ZSwgcmVpbnZlc3RfcmF0ZSkge1xyXG4gICAgICAgIHZhbHVlcyA9IHV0aWxzLnBhcnNlTnVtYmVyQXJyYXkodXRpbHMuZmxhdHRlbih2YWx1ZXMpKTtcclxuICAgICAgICBmaW5hbmNlX3JhdGUgPSB1dGlscy5wYXJzZU51bWJlcihmaW5hbmNlX3JhdGUpO1xyXG4gICAgICAgIHJlaW52ZXN0X3JhdGUgPSB1dGlscy5wYXJzZU51bWJlcihyZWludmVzdF9yYXRlKTtcclxuICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcih2YWx1ZXMsIGZpbmFuY2VfcmF0ZSwgcmVpbnZlc3RfcmF0ZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gSW5pdGlhbGl6ZSBudW1iZXIgb2YgdmFsdWVzXHJcbiAgICAgICAgdmFyIG4gPSB2YWx1ZXMubGVuZ3RoO1xyXG5cclxuICAgICAgICAvLyBMb29rdXAgcGF5bWVudHMgKG5lZ2F0aXZlIHZhbHVlcykgYW5kIGluY29tZXMgKHBvc2l0aXZlIHZhbHVlcylcclxuICAgICAgICB2YXIgcGF5bWVudHMgPSBbXTtcclxuICAgICAgICB2YXIgaW5jb21lcyA9IFtdO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbjsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmICh2YWx1ZXNbaV0gPCAwKSB7XHJcbiAgICAgICAgICAgICAgICBwYXltZW50cy5wdXNoKHZhbHVlc1tpXSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpbmNvbWVzLnB1c2godmFsdWVzW2ldKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIG1vZGlmaWVkIGludGVybmFsIHJhdGUgb2YgcmV0dXJuXHJcbiAgICAgICAgdmFyIG51bSA9IC1leHBvcnRzLk5QVihyZWludmVzdF9yYXRlLCBpbmNvbWVzKSAqIE1hdGgucG93KDEgKyByZWludmVzdF9yYXRlLCBuIC0gMSk7XHJcbiAgICAgICAgdmFyIGRlbiA9IGV4cG9ydHMuTlBWKGZpbmFuY2VfcmF0ZSwgcGF5bWVudHMpICogKDEgKyBmaW5hbmNlX3JhdGUpO1xyXG4gICAgICAgIHJldHVybiBNYXRoLnBvdyhudW0gLyBkZW4sIDEgLyAobiAtIDEpKSAtIDE7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuTk9NSU5BTCA9IGZ1bmN0aW9uKHJhdGUsIHBlcmlvZHMpIHtcclxuICAgICAgICByYXRlID0gdXRpbHMucGFyc2VOdW1iZXIocmF0ZSk7XHJcbiAgICAgICAgcGVyaW9kcyA9IHV0aWxzLnBhcnNlTnVtYmVyKHBlcmlvZHMpO1xyXG4gICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKHJhdGUsIHBlcmlvZHMpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBlcnJvciBpZiByYXRlIDw9MCBvciBwZXJpb2RzIDwgMVxyXG4gICAgICAgIGlmIChyYXRlIDw9IDAgfHwgcGVyaW9kcyA8IDEpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFRydW5jYXRlIHBlcmlvZHMgaWYgaXQgaXMgbm90IGFuIGludGVnZXJcclxuICAgICAgICBwZXJpb2RzID0gcGFyc2VJbnQocGVyaW9kcywgMTApO1xyXG5cclxuICAgICAgICAvLyBSZXR1cm4gbm9taW5hbCBhbm51YWwgaW50ZXJlc3QgcmF0ZVxyXG4gICAgICAgIHJldHVybiAoTWF0aC5wb3cocmF0ZSArIDEsIDEgLyBwZXJpb2RzKSAtIDEpICogcGVyaW9kcztcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5OUEVSID0gZnVuY3Rpb24ocmF0ZSwgcGF5bWVudCwgcHJlc2VudCwgZnV0dXJlLCB0eXBlKSB7XHJcbiAgICAgICAgdHlwZSA9ICh0eXBlID09PSB1bmRlZmluZWQpID8gMCA6IHR5cGU7XHJcbiAgICAgICAgZnV0dXJlID0gKGZ1dHVyZSA9PT0gdW5kZWZpbmVkKSA/IDAgOiBmdXR1cmU7XHJcblxyXG4gICAgICAgIHJhdGUgPSB1dGlscy5wYXJzZU51bWJlcihyYXRlKTtcclxuICAgICAgICBwYXltZW50ID0gdXRpbHMucGFyc2VOdW1iZXIocGF5bWVudCk7XHJcbiAgICAgICAgcHJlc2VudCA9IHV0aWxzLnBhcnNlTnVtYmVyKHByZXNlbnQpO1xyXG4gICAgICAgIGZ1dHVyZSA9IHV0aWxzLnBhcnNlTnVtYmVyKGZ1dHVyZSk7XHJcbiAgICAgICAgdHlwZSA9IHV0aWxzLnBhcnNlTnVtYmVyKHR5cGUpO1xyXG4gICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKHJhdGUsIHBheW1lbnQsIHByZXNlbnQsIGZ1dHVyZSwgdHlwZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIG51bWJlciBvZiBwZXJpb2RzXHJcbiAgICAgICAgdmFyIG51bSA9IHBheW1lbnQgKiAoMSArIHJhdGUgKiB0eXBlKSAtIGZ1dHVyZSAqIHJhdGU7XHJcbiAgICAgICAgdmFyIGRlbiA9IChwcmVzZW50ICogcmF0ZSArIHBheW1lbnQgKiAoMSArIHJhdGUgKiB0eXBlKSk7XHJcbiAgICAgICAgcmV0dXJuIE1hdGgubG9nKG51bSAvIGRlbikgLyBNYXRoLmxvZygxICsgcmF0ZSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuTlBWID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIGFyZ3MgPSB1dGlscy5wYXJzZU51bWJlckFycmF5KHV0aWxzLmZsYXR0ZW4oYXJndW1lbnRzKSk7XHJcbiAgICAgICAgaWYgKGFyZ3MgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gYXJncztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIExvb2t1cCByYXRlXHJcbiAgICAgICAgdmFyIHJhdGUgPSBhcmdzWzBdO1xyXG5cclxuICAgICAgICAvLyBJbml0aWFsaXplIG5ldCBwcmVzZW50IHZhbHVlXHJcbiAgICAgICAgdmFyIHZhbHVlID0gMDtcclxuXHJcbiAgICAgICAgLy8gTG9vcCBvbiBhbGwgdmFsdWVzXHJcbiAgICAgICAgZm9yICh2YXIgaiA9IDE7IGogPCBhcmdzLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgIHZhbHVlICs9IGFyZ3Nbal0gLyBNYXRoLnBvdygxICsgcmF0ZSwgaik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZXR1cm4gbmV0IHByZXNlbnQgdmFsdWVcclxuICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuT0RERlBSSUNFID0gbnVsbDtcclxuXHJcbiAgICBleHBvcnRzLk9EREZZSUVMRCA9IG51bGw7XHJcblxyXG4gICAgZXhwb3J0cy5PRERMUFJJQ0UgPSBudWxsO1xyXG5cclxuICAgIGV4cG9ydHMuT0RETFlJRUxEID0gbnVsbDtcclxuXHJcbiAgICBleHBvcnRzLlBEVVJBVElPTiA9IGZ1bmN0aW9uKHJhdGUsIHByZXNlbnQsIGZ1dHVyZSkge1xyXG4gICAgICAgIHJhdGUgPSB1dGlscy5wYXJzZU51bWJlcihyYXRlKTtcclxuICAgICAgICBwcmVzZW50ID0gdXRpbHMucGFyc2VOdW1iZXIocHJlc2VudCk7XHJcbiAgICAgICAgZnV0dXJlID0gdXRpbHMucGFyc2VOdW1iZXIoZnV0dXJlKTtcclxuICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihyYXRlLCBwcmVzZW50LCBmdXR1cmUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBlcnJvciBpZiByYXRlIDw9MFxyXG4gICAgICAgIGlmIChyYXRlIDw9IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBudW1iZXIgb2YgcGVyaW9kc1xyXG4gICAgICAgIHJldHVybiAoTWF0aC5sb2coZnV0dXJlKSAtIE1hdGgubG9nKHByZXNlbnQpKSAvIE1hdGgubG9nKDEgKyByYXRlKTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5QTVQgPSBmdW5jdGlvbihyYXRlLCBwZXJpb2RzLCBwcmVzZW50LCBmdXR1cmUsIHR5cGUpIHtcclxuICAgICAgICAvLyBDcmVkaXRzOiBhbGdvcml0aG0gaW5zcGlyZWQgYnkgQXBhY2hlIE9wZW5PZmZpY2VcclxuXHJcbiAgICAgICAgZnV0dXJlID0gZnV0dXJlIHx8IDA7XHJcbiAgICAgICAgdHlwZSA9IHR5cGUgfHwgMDtcclxuXHJcbiAgICAgICAgcmF0ZSA9IHV0aWxzLnBhcnNlTnVtYmVyKHJhdGUpO1xyXG4gICAgICAgIHBlcmlvZHMgPSB1dGlscy5wYXJzZU51bWJlcihwZXJpb2RzKTtcclxuICAgICAgICBwcmVzZW50ID0gdXRpbHMucGFyc2VOdW1iZXIocHJlc2VudCk7XHJcbiAgICAgICAgZnV0dXJlID0gdXRpbHMucGFyc2VOdW1iZXIoZnV0dXJlKTtcclxuICAgICAgICB0eXBlID0gdXRpbHMucGFyc2VOdW1iZXIodHlwZSk7XHJcbiAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IocmF0ZSwgcGVyaW9kcywgcHJlc2VudCwgZnV0dXJlLCB0eXBlKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZXR1cm4gcGF5bWVudFxyXG4gICAgICAgIHZhciByZXN1bHQ7XHJcbiAgICAgICAgaWYgKHJhdGUgPT09IDApIHtcclxuICAgICAgICAgICAgcmVzdWx0ID0gKHByZXNlbnQgKyBmdXR1cmUpIC8gcGVyaW9kcztcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB2YXIgdGVybSA9IE1hdGgucG93KDEgKyByYXRlLCBwZXJpb2RzKTtcclxuICAgICAgICAgICAgaWYgKHR5cGUgPT09IDEpIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IChmdXR1cmUgKiByYXRlIC8gKHRlcm0gLSAxKSArIHByZXNlbnQgKiByYXRlIC8gKDEgLSAxIC8gdGVybSkpIC8gKDEgKyByYXRlKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IGZ1dHVyZSAqIHJhdGUgLyAodGVybSAtIDEpICsgcHJlc2VudCAqIHJhdGUgLyAoMSAtIDEgLyB0ZXJtKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gLXJlc3VsdDtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5QUE1UID0gZnVuY3Rpb24ocmF0ZSwgcGVyaW9kLCBwZXJpb2RzLCBwcmVzZW50LCBmdXR1cmUsIHR5cGUpIHtcclxuICAgICAgICBmdXR1cmUgPSBmdXR1cmUgfHwgMDtcclxuICAgICAgICB0eXBlID0gdHlwZSB8fCAwO1xyXG5cclxuICAgICAgICByYXRlID0gdXRpbHMucGFyc2VOdW1iZXIocmF0ZSk7XHJcbiAgICAgICAgcGVyaW9kcyA9IHV0aWxzLnBhcnNlTnVtYmVyKHBlcmlvZHMpO1xyXG4gICAgICAgIHByZXNlbnQgPSB1dGlscy5wYXJzZU51bWJlcihwcmVzZW50KTtcclxuICAgICAgICBmdXR1cmUgPSB1dGlscy5wYXJzZU51bWJlcihmdXR1cmUpO1xyXG4gICAgICAgIHR5cGUgPSB1dGlscy5wYXJzZU51bWJlcih0eXBlKTtcclxuICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihyYXRlLCBwZXJpb2RzLCBwcmVzZW50LCBmdXR1cmUsIHR5cGUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBleHBvcnRzLlBNVChyYXRlLCBwZXJpb2RzLCBwcmVzZW50LCBmdXR1cmUsIHR5cGUpIC0gZXhwb3J0cy5JUE1UKHJhdGUsIHBlcmlvZCwgcGVyaW9kcywgcHJlc2VudCwgZnV0dXJlLCB0eXBlKTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5QUklDRSA9IG51bGw7XHJcblxyXG4gICAgZXhwb3J0cy5QUklDRURJU0MgPSBudWxsO1xyXG5cclxuICAgIGV4cG9ydHMuUFJJQ0VNQVQgPSBudWxsO1xyXG5cclxuICAgIGV4cG9ydHMuUFYgPSBmdW5jdGlvbihyYXRlLCBwZXJpb2RzLCBwYXltZW50LCBmdXR1cmUsIHR5cGUpIHtcclxuICAgICAgICBmdXR1cmUgPSBmdXR1cmUgfHwgMDtcclxuICAgICAgICB0eXBlID0gdHlwZSB8fCAwO1xyXG5cclxuICAgICAgICByYXRlID0gdXRpbHMucGFyc2VOdW1iZXIocmF0ZSk7XHJcbiAgICAgICAgcGVyaW9kcyA9IHV0aWxzLnBhcnNlTnVtYmVyKHBlcmlvZHMpO1xyXG4gICAgICAgIHBheW1lbnQgPSB1dGlscy5wYXJzZU51bWJlcihwYXltZW50KTtcclxuICAgICAgICBmdXR1cmUgPSB1dGlscy5wYXJzZU51bWJlcihmdXR1cmUpO1xyXG4gICAgICAgIHR5cGUgPSB1dGlscy5wYXJzZU51bWJlcih0eXBlKTtcclxuICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihyYXRlLCBwZXJpb2RzLCBwYXltZW50LCBmdXR1cmUsIHR5cGUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBwcmVzZW50IHZhbHVlXHJcbiAgICAgICAgaWYgKHJhdGUgPT09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIC1wYXltZW50ICogcGVyaW9kcyAtIGZ1dHVyZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gKCgoMSAtIE1hdGgucG93KDEgKyByYXRlLCBwZXJpb2RzKSkgLyByYXRlKSAqIHBheW1lbnQgKiAoMSArIHJhdGUgKiB0eXBlKSAtIGZ1dHVyZSkgLyBNYXRoLnBvdygxICsgcmF0ZSwgcGVyaW9kcyk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLlJBVEUgPSBmdW5jdGlvbihwZXJpb2RzLCBwYXltZW50LCBwcmVzZW50LCBmdXR1cmUsIHR5cGUsIGd1ZXNzKSB7XHJcbiAgICAgICAgLy8gQ3JlZGl0czogcmFidWdlbnRvXHJcblxyXG4gICAgICAgIGd1ZXNzID0gKGd1ZXNzID09PSB1bmRlZmluZWQpID8gMC4wMSA6IGd1ZXNzO1xyXG4gICAgICAgIGZ1dHVyZSA9IChmdXR1cmUgPT09IHVuZGVmaW5lZCkgPyAwIDogZnV0dXJlO1xyXG4gICAgICAgIHR5cGUgPSAodHlwZSA9PT0gdW5kZWZpbmVkKSA/IDAgOiB0eXBlO1xyXG5cclxuICAgICAgICBwZXJpb2RzID0gdXRpbHMucGFyc2VOdW1iZXIocGVyaW9kcyk7XHJcbiAgICAgICAgcGF5bWVudCA9IHV0aWxzLnBhcnNlTnVtYmVyKHBheW1lbnQpO1xyXG4gICAgICAgIHByZXNlbnQgPSB1dGlscy5wYXJzZU51bWJlcihwcmVzZW50KTtcclxuICAgICAgICBmdXR1cmUgPSB1dGlscy5wYXJzZU51bWJlcihmdXR1cmUpO1xyXG4gICAgICAgIHR5cGUgPSB1dGlscy5wYXJzZU51bWJlcih0eXBlKTtcclxuICAgICAgICBndWVzcyA9IHV0aWxzLnBhcnNlTnVtYmVyKGd1ZXNzKTtcclxuICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihwZXJpb2RzLCBwYXltZW50LCBwcmVzZW50LCBmdXR1cmUsIHR5cGUsIGd1ZXNzKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBTZXQgbWF4aW11bSBlcHNpbG9uIGZvciBlbmQgb2YgaXRlcmF0aW9uXHJcbiAgICAgICAgdmFyIGVwc01heCA9IDFlLTY7XHJcblxyXG4gICAgICAgIC8vIFNldCBtYXhpbXVtIG51bWJlciBvZiBpdGVyYXRpb25zXHJcbiAgICAgICAgdmFyIGl0ZXJNYXggPSAxMDA7XHJcbiAgICAgICAgdmFyIGl0ZXIgPSAwO1xyXG4gICAgICAgIHZhciBjbG9zZSA9IGZhbHNlO1xyXG4gICAgICAgIHZhciByYXRlID0gZ3Vlc3M7XHJcblxyXG4gICAgICAgIHdoaWxlIChpdGVyIDwgaXRlck1heCAmJiAhY2xvc2UpIHtcclxuICAgICAgICAgICAgdmFyIHQxID0gTWF0aC5wb3cocmF0ZSArIDEsIHBlcmlvZHMpO1xyXG4gICAgICAgICAgICB2YXIgdDIgPSBNYXRoLnBvdyhyYXRlICsgMSwgcGVyaW9kcyAtIDEpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGYxID0gZnV0dXJlICsgdDEgKiBwcmVzZW50ICsgcGF5bWVudCAqICh0MSAtIDEpICogKHJhdGUgKiB0eXBlICsgMSkgLyByYXRlO1xyXG4gICAgICAgICAgICB2YXIgZjIgPSBwZXJpb2RzICogdDIgKiBwcmVzZW50IC0gcGF5bWVudCAqICh0MSAtIDEpICoocmF0ZSAqIHR5cGUgKyAxKSAvIE1hdGgucG93KHJhdGUsMik7XHJcbiAgICAgICAgICAgIHZhciBmMyA9IHBlcmlvZHMgKiBwYXltZW50ICogdDIgKiAocmF0ZSAqIHR5cGUgKyAxKSAvIHJhdGUgKyBwYXltZW50ICogKHQxIC0gMSkgKiB0eXBlIC8gcmF0ZTtcclxuXHJcbiAgICAgICAgICAgIHZhciBuZXdSYXRlID0gcmF0ZSAtIGYxIC8gKGYyICsgZjMpO1xyXG5cclxuICAgICAgICAgICAgaWYgKE1hdGguYWJzKG5ld1JhdGUgLSByYXRlKSA8IGVwc01heCkgY2xvc2UgPSB0cnVlO1xyXG4gICAgICAgICAgICBpdGVyKytcclxuICAgICAgICAgICAgcmF0ZSA9IG5ld1JhdGU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIWNsb3NlKSByZXR1cm4gTnVtYmVyLk5hTiArIHJhdGU7XHJcbiAgICAgICAgcmV0dXJuIHJhdGU7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIFRPRE9cclxuICAgIGV4cG9ydHMuUkVDRUlWRUQgPSBudWxsO1xyXG5cclxuICAgIGV4cG9ydHMuUlJJID0gZnVuY3Rpb24ocGVyaW9kcywgcHJlc2VudCwgZnV0dXJlKSB7XHJcbiAgICAgICAgcGVyaW9kcyA9IHV0aWxzLnBhcnNlTnVtYmVyKHBlcmlvZHMpO1xyXG4gICAgICAgIHByZXNlbnQgPSB1dGlscy5wYXJzZU51bWJlcihwcmVzZW50KTtcclxuICAgICAgICBmdXR1cmUgPSB1dGlscy5wYXJzZU51bWJlcihmdXR1cmUpO1xyXG4gICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKHBlcmlvZHMsIHByZXNlbnQsIGZ1dHVyZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIHBlcmlvZHMgb3IgcHJlc2VudCBpcyBlcXVhbCB0byAwICh6ZXJvKVxyXG4gICAgICAgIGlmIChwZXJpb2RzID09PSAwIHx8IHByZXNlbnQgPT09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBlcXVpdmFsZW50IGludGVyZXN0IHJhdGVcclxuICAgICAgICByZXR1cm4gTWF0aC5wb3coZnV0dXJlIC8gcHJlc2VudCwgMSAvIHBlcmlvZHMpIC0gMTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5TTE4gPSBmdW5jdGlvbihjb3N0LCBzYWx2YWdlLCBsaWZlKSB7XHJcbiAgICAgICAgY29zdCA9IHV0aWxzLnBhcnNlTnVtYmVyKGNvc3QpO1xyXG4gICAgICAgIHNhbHZhZ2UgPSB1dGlscy5wYXJzZU51bWJlcihzYWx2YWdlKTtcclxuICAgICAgICBsaWZlID0gdXRpbHMucGFyc2VOdW1iZXIobGlmZSk7XHJcbiAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IoY29zdCwgc2FsdmFnZSwgbGlmZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIGxpZmUgZXF1YWwgdG8gMCAoemVybylcclxuICAgICAgICBpZiAobGlmZSA9PT0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIHN0cmFpZ2h0LWxpbmUgZGVwcmVjaWF0aW9uXHJcbiAgICAgICAgcmV0dXJuIChjb3N0IC0gc2FsdmFnZSkgLyBsaWZlO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLlNZRCA9IGZ1bmN0aW9uKGNvc3QsIHNhbHZhZ2UsIGxpZmUsIHBlcmlvZCkge1xyXG4gICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgaXMgbm90IGEgbnVtYmVyXHJcbiAgICAgICAgY29zdCA9IHV0aWxzLnBhcnNlTnVtYmVyKGNvc3QpO1xyXG4gICAgICAgIHNhbHZhZ2UgPSB1dGlscy5wYXJzZU51bWJlcihzYWx2YWdlKTtcclxuICAgICAgICBsaWZlID0gdXRpbHMucGFyc2VOdW1iZXIobGlmZSk7XHJcbiAgICAgICAgcGVyaW9kID0gdXRpbHMucGFyc2VOdW1iZXIocGVyaW9kKTtcclxuICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihjb3N0LCBzYWx2YWdlLCBsaWZlLCBwZXJpb2QpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBsaWZlIGVxdWFsIHRvIDAgKHplcm8pXHJcbiAgICAgICAgaWYgKGxpZmUgPT09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBwZXJpb2QgaXMgbG93ZXIgdGhhbiAxIG9yIGdyZWF0ZXIgdGhhbiBsaWZlXHJcbiAgICAgICAgaWYgKHBlcmlvZCA8IDEgfHwgcGVyaW9kID4gbGlmZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gVHJ1bmNhdGUgcGVyaW9kIGlmIGl0IGlzIG5vdCBhbiBpbnRlZ2VyXHJcbiAgICAgICAgcGVyaW9kID0gcGFyc2VJbnQocGVyaW9kLCAxMCk7XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBzdHJhaWdodC1saW5lIGRlcHJlY2lhdGlvblxyXG4gICAgICAgIHJldHVybiAoKGNvc3QgLSBzYWx2YWdlKSAqIChsaWZlIC0gcGVyaW9kICsgMSkgKiAyKSAvIChsaWZlICogKGxpZmUgKyAxKSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuVEJJTExFUSA9IGZ1bmN0aW9uKHNldHRsZW1lbnQsIG1hdHVyaXR5LCBkaXNjb3VudCkge1xyXG4gICAgICAgIHNldHRsZW1lbnQgPSB1dGlscy5wYXJzZURhdGUoc2V0dGxlbWVudCk7XHJcbiAgICAgICAgbWF0dXJpdHkgPSB1dGlscy5wYXJzZURhdGUobWF0dXJpdHkpO1xyXG4gICAgICAgIGRpc2NvdW50ID0gdXRpbHMucGFyc2VOdW1iZXIoZGlzY291bnQpO1xyXG4gICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKHNldHRsZW1lbnQsIG1hdHVyaXR5LCBkaXNjb3VudCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIGRpc2NvdW50IGlzIGxvd2VyIHRoYW4gb3IgZXF1YWwgdG8gemVyb1xyXG4gICAgICAgIGlmIChkaXNjb3VudCA8PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgc2V0dGxlbWVudCBpcyBncmVhdGVyIHRoYW4gbWF0dXJpdHlcclxuICAgICAgICBpZiAoc2V0dGxlbWVudCA+IG1hdHVyaXR5KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgbWF0dXJpdHkgaXMgbW9yZSB0aGFuIG9uZSB5ZWFyIGFmdGVyIHNldHRsZW1lbnRcclxuICAgICAgICBpZiAobWF0dXJpdHkgLSBzZXR0bGVtZW50ID4gMzY1ICogMjQgKiA2MCAqIDYwICogMTAwMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIGJvbmQtZXF1aXZhbGVudCB5aWVsZFxyXG4gICAgICAgIHJldHVybiAoMzY1ICogZGlzY291bnQpIC8gKDM2MCAtIGRpc2NvdW50ICogREFZUzM2MChzZXR0bGVtZW50LCBtYXR1cml0eSwgZmFsc2UpKTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5UQklMTFBSSUNFID0gZnVuY3Rpb24oc2V0dGxlbWVudCwgbWF0dXJpdHksIGRpc2NvdW50KSB7XHJcbiAgICAgICAgc2V0dGxlbWVudCA9IHV0aWxzLnBhcnNlRGF0ZShzZXR0bGVtZW50KTtcclxuICAgICAgICBtYXR1cml0eSA9IHV0aWxzLnBhcnNlRGF0ZShtYXR1cml0eSk7XHJcbiAgICAgICAgZGlzY291bnQgPSB1dGlscy5wYXJzZU51bWJlcihkaXNjb3VudCk7XHJcbiAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3Ioc2V0dGxlbWVudCwgbWF0dXJpdHksIGRpc2NvdW50KSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgZGlzY291bnQgaXMgbG93ZXIgdGhhbiBvciBlcXVhbCB0byB6ZXJvXHJcbiAgICAgICAgaWYgKGRpc2NvdW50IDw9IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBzZXR0bGVtZW50IGlzIGdyZWF0ZXIgdGhhbiBtYXR1cml0eVxyXG4gICAgICAgIGlmIChzZXR0bGVtZW50ID4gbWF0dXJpdHkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBtYXR1cml0eSBpcyBtb3JlIHRoYW4gb25lIHllYXIgYWZ0ZXIgc2V0dGxlbWVudFxyXG4gICAgICAgIGlmIChtYXR1cml0eSAtIHNldHRsZW1lbnQgPiAzNjUgKiAyNCAqIDYwICogNjAgKiAxMDAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZXR1cm4gYm9uZC1lcXVpdmFsZW50IHlpZWxkXHJcbiAgICAgICAgcmV0dXJuIDEwMCAqICgxIC0gZGlzY291bnQgKiBEQVlTMzYwKHNldHRsZW1lbnQsIG1hdHVyaXR5LCBmYWxzZSkgLyAzNjApO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLlRCSUxMWUlFTEQgPSBmdW5jdGlvbihzZXR0bGVtZW50LCBtYXR1cml0eSwgcHJpY2UpIHtcclxuICAgICAgICBzZXR0bGVtZW50ID0gdXRpbHMucGFyc2VEYXRlKHNldHRsZW1lbnQpO1xyXG4gICAgICAgIG1hdHVyaXR5ID0gdXRpbHMucGFyc2VEYXRlKG1hdHVyaXR5KTtcclxuICAgICAgICBwcmljZSA9IHV0aWxzLnBhcnNlTnVtYmVyKHByaWNlKTtcclxuICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihzZXR0bGVtZW50LCBtYXR1cml0eSwgcHJpY2UpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBwcmljZSBpcyBsb3dlciB0aGFuIG9yIGVxdWFsIHRvIHplcm9cclxuICAgICAgICBpZiAocHJpY2UgPD0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIHNldHRsZW1lbnQgaXMgZ3JlYXRlciB0aGFuIG1hdHVyaXR5XHJcbiAgICAgICAgaWYgKHNldHRsZW1lbnQgPiBtYXR1cml0eSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIG1hdHVyaXR5IGlzIG1vcmUgdGhhbiBvbmUgeWVhciBhZnRlciBzZXR0bGVtZW50XHJcbiAgICAgICAgaWYgKG1hdHVyaXR5IC0gc2V0dGxlbWVudCA+IDM2NSAqIDI0ICogNjAgKiA2MCAqIDEwMDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJldHVybiBib25kLWVxdWl2YWxlbnQgeWllbGRcclxuICAgICAgICByZXR1cm4gKDEwMCAtIHByaWNlKSAqIDM2MCAvIChwcmljZSAqIERBWVMzNjAoc2V0dGxlbWVudCwgbWF0dXJpdHksIGZhbHNlKSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuVkRCID0gbnVsbDtcclxuXHJcbiAgICBleHBvcnRzLlhJUlIgPSBmdW5jdGlvbih2YWx1ZXMsIGRhdGVzLCBndWVzcykge1xyXG4gICAgICAgIC8vIENyZWRpdHM6IGFsZ29yaXRobSBpbnNwaXJlZCBieSBBcGFjaGUgT3Blbk9mZmljZVxyXG5cclxuICAgICAgICB2YWx1ZXMgPSB1dGlscy5wYXJzZU51bWJlckFycmF5KHV0aWxzLmZsYXR0ZW4odmFsdWVzKSk7XHJcbiAgICAgICAgZGF0ZXMgPSB1dGlscy5wYXJzZURhdGVBcnJheSh1dGlscy5mbGF0dGVuKGRhdGVzKSk7XHJcbiAgICAgICAgZ3Vlc3MgPSB1dGlscy5wYXJzZU51bWJlcihndWVzcyk7XHJcbiAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IodmFsdWVzLCBkYXRlcywgZ3Vlc3MpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIENhbGN1bGF0ZXMgdGhlIHJlc3VsdGluZyBhbW91bnRcclxuICAgICAgICB2YXIgaXJyUmVzdWx0ID0gZnVuY3Rpb24odmFsdWVzLCBkYXRlcywgcmF0ZSkge1xyXG4gICAgICAgICAgICB2YXIgciA9IHJhdGUgKyAxO1xyXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gdmFsdWVzWzBdO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IHZhbHVlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0ICs9IHZhbHVlc1tpXSAvIE1hdGgucG93KHIsIERBWVMoZGF0ZXNbaV0sIGRhdGVzWzBdKSAvIDM2NSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBDYWxjdWxhdGVzIHRoZSBmaXJzdCBkZXJpdmF0aW9uXHJcbiAgICAgICAgdmFyIGlyclJlc3VsdERlcml2ID0gZnVuY3Rpb24odmFsdWVzLCBkYXRlcywgcmF0ZSkge1xyXG4gICAgICAgICAgICB2YXIgciA9IHJhdGUgKyAxO1xyXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gMDtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCB2YWx1ZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciBmcmFjID0gREFZUyhkYXRlc1tpXSwgZGF0ZXNbMF0pIC8gMzY1O1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0IC09IGZyYWMgKiB2YWx1ZXNbaV0gLyBNYXRoLnBvdyhyLCBmcmFjICsgMSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBDaGVjayB0aGF0IHZhbHVlcyBjb250YWlucyBhdCBsZWFzdCBvbmUgcG9zaXRpdmUgdmFsdWUgYW5kIG9uZVxyXG4gICAgICAgICAgICAvLyBuZWdhdGl2ZSB2YWx1ZVxyXG4gICAgICAgIHZhciBwb3NpdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgIHZhciBuZWdhdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmFsdWVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmICh2YWx1ZXNbaV0gPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBwb3NpdGl2ZSA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHZhbHVlc1tpXSA8IDApIHtcclxuICAgICAgICAgICAgICAgIG5lZ2F0aXZlID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIHZhbHVlcyBkb2VzIG5vdCBjb250YWluIGF0IGxlYXN0IG9uZSBwb3NpdGl2ZSB2YWx1ZVxyXG4gICAgICAgICAgICAvLyBhbmQgb25lIG5lZ2F0aXZlIHZhbHVlXHJcbiAgICAgICAgaWYgKCFwb3NpdGl2ZSB8fCAhbmVnYXRpdmUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIEluaXRpYWxpemUgZ3Vlc3MgYW5kIHJlc3VsdFJhdGVcclxuICAgICAgICBndWVzcyA9IGd1ZXNzIHx8IDAuMTtcclxuICAgICAgICB2YXIgcmVzdWx0UmF0ZSA9IGd1ZXNzO1xyXG5cclxuICAgICAgICAvLyBTZXQgbWF4aW11bSBlcHNpbG9uIGZvciBlbmQgb2YgaXRlcmF0aW9uXHJcbiAgICAgICAgdmFyIGVwc01heCA9IDFlLTEwO1xyXG5cclxuICAgICAgICAvLyBJbXBsZW1lbnQgTmV3dG9uJ3MgbWV0aG9kXHJcbiAgICAgICAgdmFyIG5ld1JhdGUsIGVwc1JhdGUsIHJlc3VsdFZhbHVlO1xyXG4gICAgICAgIHZhciBjb250TG9vcCA9IHRydWU7XHJcbiAgICAgICAgZG8ge1xyXG4gICAgICAgICAgICByZXN1bHRWYWx1ZSA9IGlyclJlc3VsdCh2YWx1ZXMsIGRhdGVzLCByZXN1bHRSYXRlKTtcclxuICAgICAgICAgICAgbmV3UmF0ZSA9IHJlc3VsdFJhdGUgLSByZXN1bHRWYWx1ZSAvIGlyclJlc3VsdERlcml2KHZhbHVlcywgZGF0ZXMsIHJlc3VsdFJhdGUpO1xyXG4gICAgICAgICAgICBlcHNSYXRlID0gTWF0aC5hYnMobmV3UmF0ZSAtIHJlc3VsdFJhdGUpO1xyXG4gICAgICAgICAgICByZXN1bHRSYXRlID0gbmV3UmF0ZTtcclxuICAgICAgICAgICAgY29udExvb3AgPSAoZXBzUmF0ZSA+IGVwc01heCkgJiYgKE1hdGguYWJzKHJlc3VsdFZhbHVlKSA+IGVwc01heCk7XHJcbiAgICAgICAgfSB3aGlsZSAoY29udExvb3ApO1xyXG5cclxuICAgICAgICAvLyBSZXR1cm4gaW50ZXJuYWwgcmF0ZSBvZiByZXR1cm5cclxuICAgICAgICByZXR1cm4gcmVzdWx0UmF0ZTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5YTlBWID0gZnVuY3Rpb24ocmF0ZSwgdmFsdWVzLCBkYXRlcykge1xyXG4gICAgICAgIHJhdGUgPSB1dGlscy5wYXJzZU51bWJlcihyYXRlKTtcclxuICAgICAgICB2YWx1ZXMgPSB1dGlscy5wYXJzZU51bWJlckFycmF5KHV0aWxzLmZsYXR0ZW4odmFsdWVzKSk7XHJcbiAgICAgICAgZGF0ZXMgPSB1dGlscy5wYXJzZURhdGVBcnJheSh1dGlscy5mbGF0dGVuKGRhdGVzKSk7XHJcbiAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IocmF0ZSwgdmFsdWVzLCBkYXRlcykpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IDA7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2YWx1ZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgcmVzdWx0ICs9IHZhbHVlc1tpXSAvIE1hdGgucG93KDEgKyByYXRlLCBEQVlTKGRhdGVzW2ldLCBkYXRlc1swXSkgLyAzNjUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLllJRUxEID0gbnVsbDtcclxuXHJcbiAgICBleHBvcnRzLllJRUxERElTQyA9IG51bGw7XHJcblxyXG4gICAgZXhwb3J0cy5ZSUVMRE1BVCA9IG51bGw7XHJcblxyXG4gICAgcmV0dXJuIGV4cG9ydHM7XHJcbn0pKCk7XHJcblxyXG5qZXhjZWwubWV0aG9kcy5pbmZvcm1hdGlvbiA9IChmdW5jdGlvbigpIHtcclxuICAgIHZhciBleHBvcnRzID0ge307XHJcbiAgICBleHBvcnRzLkNFTEwgPSBudWxsO1xyXG5cclxuICAgIGV4cG9ydHMuRVJST1IgPSB7fTtcclxuICAgIGV4cG9ydHMuRVJST1IuVFlQRSA9IGZ1bmN0aW9uKGVycm9yX3ZhbCkge1xyXG4gICAgICAgIHN3aXRjaCAoZXJyb3JfdmFsKSB7XHJcbiAgICAgICAgICAgIGNhc2UgZXJyb3IubmlsOiByZXR1cm4gMTtcclxuICAgICAgICAgICAgY2FzZSBlcnJvci5kaXYwOiByZXR1cm4gMjtcclxuICAgICAgICAgICAgY2FzZSBlcnJvci52YWx1ZTogcmV0dXJuIDM7XHJcbiAgICAgICAgICAgIGNhc2UgZXJyb3IucmVmOiByZXR1cm4gNDtcclxuICAgICAgICAgICAgY2FzZSBlcnJvci5uYW1lOiByZXR1cm4gNTtcclxuICAgICAgICAgICAgY2FzZSBlcnJvci5udW06IHJldHVybiA2O1xyXG4gICAgICAgICAgICBjYXNlIGVycm9yLm5hOiByZXR1cm4gNztcclxuICAgICAgICAgICAgY2FzZSBlcnJvci5kYXRhOiByZXR1cm4gODtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGVycm9yLm5hO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLklORk8gPSBudWxsO1xyXG5cclxuICAgIGV4cG9ydHMuSVNCTEFOSyA9IGZ1bmN0aW9uKHZhbHVlKSB7XHJcbiAgICAgICAgcmV0dXJuIHZhbHVlID09PSBudWxsO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLklTQklOQVJZID0gZnVuY3Rpb24gKG51bWJlcikge1xyXG4gICAgICAgIHJldHVybiAoL15bMDFdezEsMTB9JC8pLnRlc3QobnVtYmVyKTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5JU0VSUiA9IGZ1bmN0aW9uKHZhbHVlKSB7XHJcbiAgICAgICAgcmV0dXJuIChbZXJyb3IudmFsdWUsIGVycm9yLnJlZiwgZXJyb3IuZGl2MCwgZXJyb3IubnVtLCBlcnJvci5uYW1lLCBlcnJvci5uaWxdKS5pbmRleE9mKHZhbHVlKSA+PSAwIHx8XHJcbiAgICAgICAgICAgICh0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInICYmIChpc05hTih2YWx1ZSkgfHwgIWlzRmluaXRlKHZhbHVlKSkpO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLklTRVJST1IgPSBmdW5jdGlvbih2YWx1ZSkge1xyXG4gICAgICAgIHJldHVybiBleHBvcnRzLklTRVJSKHZhbHVlKSB8fCB2YWx1ZSA9PT0gZXJyb3IubmE7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuSVNFVkVOID0gZnVuY3Rpb24obnVtYmVyKSB7XHJcbiAgICAgICAgcmV0dXJuIChNYXRoLmZsb29yKE1hdGguYWJzKG51bWJlcikpICYgMSkgPyBmYWxzZSA6IHRydWU7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIFRPRE9cclxuICAgIGV4cG9ydHMuSVNGT1JNVUxBID0gbnVsbDtcclxuXHJcbiAgICBleHBvcnRzLklTTE9HSUNBTCA9IGZ1bmN0aW9uKHZhbHVlKSB7XHJcbiAgICAgICAgcmV0dXJuIHZhbHVlID09PSB0cnVlIHx8IHZhbHVlID09PSBmYWxzZTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5JU05BID0gZnVuY3Rpb24odmFsdWUpIHtcclxuICAgICAgICByZXR1cm4gdmFsdWUgPT09IGVycm9yLm5hO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLklTTk9OVEVYVCA9IGZ1bmN0aW9uKHZhbHVlKSB7XHJcbiAgICAgICAgcmV0dXJuIHR5cGVvZih2YWx1ZSkgIT09ICdzdHJpbmcnO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLklTTlVNQkVSID0gZnVuY3Rpb24odmFsdWUpIHtcclxuICAgICAgICByZXR1cm4gdHlwZW9mKHZhbHVlKSA9PT0gJ251bWJlcicgJiYgIWlzTmFOKHZhbHVlKSAmJiBpc0Zpbml0ZSh2YWx1ZSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuSVNPREQgPSBmdW5jdGlvbihudW1iZXIpIHtcclxuICAgICAgICByZXR1cm4gKE1hdGguZmxvb3IoTWF0aC5hYnMobnVtYmVyKSkgJiAxKSA/IHRydWUgOiBmYWxzZTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5JU1JFRiA9IG51bGw7XHJcblxyXG4gICAgZXhwb3J0cy5JU1RFWFQgPSBmdW5jdGlvbih2YWx1ZSkge1xyXG4gICAgICAgIHJldHVybiB0eXBlb2YodmFsdWUpID09PSAnc3RyaW5nJztcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5OID0gZnVuY3Rpb24odmFsdWUpIHtcclxuICAgICAgICBpZiAodGhpcy5JU05VTUJFUih2YWx1ZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBEYXRlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZS5nZXRUaW1lKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh2YWx1ZSA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHZhbHVlID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuSVNFUlJPUih2YWx1ZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gMDtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5OQSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBlcnJvci5uYTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5TSEVFVCA9IG51bGw7XHJcblxyXG4gICAgZXhwb3J0cy5TSEVFVFMgPSBudWxsO1xyXG5cclxuICAgIGV4cG9ydHMuVFlQRSA9IGZ1bmN0aW9uKHZhbHVlKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuSVNOVU1CRVIodmFsdWUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAxO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5JU1RFWFQodmFsdWUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAyO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5JU0xPR0lDQUwodmFsdWUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiA0O1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5JU0VSUk9SKHZhbHVlKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gMTY7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gNjQ7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4gZXhwb3J0cztcclxufSkoKTtcclxuXHJcbmpleGNlbC5tZXRob2RzLmxvZ2ljYWwgPSAoZnVuY3Rpb24oKSB7XHJcbiAgICB2YXIgZXhwb3J0cyA9IHt9O1xyXG5cclxuICAgIGV4cG9ydHMuQU5EID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIGFyZ3MgPSB1dGlscy5mbGF0dGVuKGFyZ3VtZW50cyk7XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IHRydWU7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmICghYXJnc1tpXSkge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5DSE9PU0UgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLm5hO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGluZGV4ID0gYXJndW1lbnRzWzBdO1xyXG4gICAgICAgIGlmIChpbmRleCA8IDEgfHwgaW5kZXggPiAyNTQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCBpbmRleCArIDEpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGFyZ3VtZW50c1tpbmRleF07XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuRkFMU0UgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuSUYgPSBmdW5jdGlvbih0ZXN0LCB0aGVuX3ZhbHVlLCBvdGhlcndpc2VfdmFsdWUpIHtcclxuICAgICAgICByZXR1cm4gdGVzdCA/IHRoZW5fdmFsdWUgOiBvdGhlcndpc2VfdmFsdWU7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuSUZFUlJPUiA9IGZ1bmN0aW9uKHZhbHVlLCB2YWx1ZUlmRXJyb3IpIHtcclxuICAgICAgICBpZiAoSVNFUlJPUih2YWx1ZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlSWZFcnJvcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLklGTkEgPSBmdW5jdGlvbih2YWx1ZSwgdmFsdWVfaWZfbmEpIHtcclxuICAgICAgICByZXR1cm4gdmFsdWUgPT09IGVycm9yLm5hID8gdmFsdWVfaWZfbmEgOiB2YWx1ZTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5OT1QgPSBmdW5jdGlvbihsb2dpY2FsKSB7XHJcbiAgICAgICAgcmV0dXJuICFsb2dpY2FsO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLk9SID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIGFyZ3MgPSB1dGlscy5mbGF0dGVuKGFyZ3VtZW50cyk7XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IGZhbHNlO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBpZiAoYXJnc1tpXSkge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLlRSVUUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5YT1IgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgYXJncyA9IHV0aWxzLmZsYXR0ZW4oYXJndW1lbnRzKTtcclxuICAgICAgICB2YXIgcmVzdWx0ID0gMDtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyZ3MubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKGFyZ3NbaV0pIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiAoTWF0aC5mbG9vcihNYXRoLmFicyhyZXN1bHQpKSAmIDEpID8gdHJ1ZSA6IGZhbHNlO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLlNXSVRDSCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciByZXN1bHQ7XHJcbiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAwKSAge1xyXG4gICAgICAgICAgICB2YXIgdGFyZ2V0VmFsdWUgPSBhcmd1bWVudHNbMF07XHJcbiAgICAgICAgICAgIHZhciBhcmdjID0gYXJndW1lbnRzLmxlbmd0aCAtIDE7XHJcbiAgICAgICAgICAgIHZhciBzd2l0Y2hDb3VudCA9IE1hdGguZmxvb3IoYXJnYyAvIDIpO1xyXG4gICAgICAgICAgICB2YXIgc3dpdGNoU2F0aXNmaWVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZhciBkZWZhdWx0Q2xhdXNlID0gYXJnYyAlIDIgPT09IDAgPyBudWxsIDogYXJndW1lbnRzW2FyZ3VtZW50cy5sZW5ndGggLSAxXTtcclxuXHJcbiAgICAgICAgICAgIGlmIChzd2l0Y2hDb3VudCkge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IHN3aXRjaENvdW50OyBpbmRleCsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldFZhbHVlID09PSBhcmd1bWVudHNbaW5kZXggKiAyICsgMV0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGFyZ3VtZW50c1tpbmRleCAqIDIgKyAyXTtcclxuICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaFNhdGlzZmllZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICghc3dpdGNoU2F0aXNmaWVkICYmIGRlZmF1bHRDbGF1c2UpIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IGRlZmF1bHRDbGF1c2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiBleHBvcnRzO1xyXG59KSgpO1xyXG5cclxuamV4Y2VsLm1ldGhvZHMubWF0aCA9IChmdW5jdGlvbigpIHtcclxuICAgIHZhciBleHBvcnRzID0ge307XHJcblxyXG4gICAgZXhwb3J0cy5BQlMgPSBmdW5jdGlvbihudW1iZXIpIHtcclxuICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgIGlmIChudW1iZXIgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gTWF0aC5hYnModXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuQUNPUyA9IGZ1bmN0aW9uKG51bWJlcikge1xyXG4gICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgaWYgKG51bWJlciBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudW1iZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBNYXRoLmFjb3MobnVtYmVyKTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5BQ09TSCA9IGZ1bmN0aW9uKG51bWJlcikge1xyXG4gICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgaWYgKG51bWJlciBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudW1iZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBNYXRoLmxvZyhudW1iZXIgKyBNYXRoLnNxcnQobnVtYmVyICogbnVtYmVyIC0gMSkpO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLkFDT1QgPSBmdW5jdGlvbihudW1iZXIpIHtcclxuICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgIGlmIChudW1iZXIgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gTWF0aC5hdGFuKDEgLyBudW1iZXIpO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLkFDT1RIID0gZnVuY3Rpb24obnVtYmVyKSB7XHJcbiAgICAgICAgbnVtYmVyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKTtcclxuICAgICAgICBpZiAobnVtYmVyIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bWJlcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIDAuNSAqIE1hdGgubG9nKChudW1iZXIgKyAxKSAvIChudW1iZXIgLSAxKSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuQUdHUkVHQVRFID0gbnVsbFxyXG5cclxuICAgIGV4cG9ydHMuQVJBQklDID0gZnVuY3Rpb24odGV4dCkge1xyXG4gICAgICAgIC8vIENyZWRpdHM6IFJhZmE/IEt1a2F3c2tpXHJcbiAgICAgICAgaWYgKCEvXk0qKD86RD9DezAsM318Q1tNRF0pKD86TD9YezAsM318WFtDTF0pKD86Vj9JezAsM318SVtYVl0pJC8udGVzdCh0ZXh0KSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciByID0gMDtcclxuICAgICAgICB0ZXh0LnJlcGxhY2UoL1tNRExWXXxDW01EXT98WFtDTF0/fElbWFZdPy9nLCBmdW5jdGlvbihpKSB7XHJcbiAgICAgICAgICAgIHIgKz0ge1xyXG4gICAgICAgICAgICAgICAgTTogMTAwMCxcclxuICAgICAgICAgICAgICAgIENNOiA5MDAsXHJcbiAgICAgICAgICAgICAgICBEOiA1MDAsXHJcbiAgICAgICAgICAgICAgICBDRDogNDAwLFxyXG4gICAgICAgICAgICAgICAgQzogMTAwLFxyXG4gICAgICAgICAgICAgICAgWEM6IDkwLFxyXG4gICAgICAgICAgICAgICAgTDogNTAsXHJcbiAgICAgICAgICAgICAgICBYTDogNDAsXHJcbiAgICAgICAgICAgICAgICBYOiAxMCxcclxuICAgICAgICAgICAgICAgIElYOiA5LFxyXG4gICAgICAgICAgICAgICAgVjogNSxcclxuICAgICAgICAgICAgICAgIElWOiA0LFxyXG4gICAgICAgICAgICAgICAgSTogMVxyXG4gICAgICAgICAgICB9W2ldO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiByO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLkFTSU4gPSBmdW5jdGlvbihudW1iZXIpIHtcclxuICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgIGlmIChudW1iZXIgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gTWF0aC5hc2luKG51bWJlcik7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuQVNJTkggPSBmdW5jdGlvbihudW1iZXIpIHtcclxuICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgIGlmIChudW1iZXIgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gTWF0aC5sb2cobnVtYmVyICsgTWF0aC5zcXJ0KG51bWJlciAqIG51bWJlciArIDEpKTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5BVEFOID0gZnVuY3Rpb24obnVtYmVyKSB7XHJcbiAgICAgICAgbnVtYmVyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKTtcclxuICAgICAgICBpZiAobnVtYmVyIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bWJlcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIE1hdGguYXRhbihudW1iZXIpO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLkFUQU4yID0gZnVuY3Rpb24obnVtYmVyX3gsIG51bWJlcl95KSB7XHJcbiAgICAgICAgbnVtYmVyX3ggPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXJfeCk7XHJcbiAgICAgICAgbnVtYmVyX3kgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXJfeSk7XHJcbiAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IobnVtYmVyX3gsIG51bWJlcl95KSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBNYXRoLmF0YW4yKG51bWJlcl94LCBudW1iZXJfeSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuQVRBTkggPSBmdW5jdGlvbihudW1iZXIpIHtcclxuICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgIGlmIChudW1iZXIgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gTWF0aC5sb2coKDEgKyBudW1iZXIpIC8gKDEgLSBudW1iZXIpKSAvIDI7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuQkFTRSA9IGZ1bmN0aW9uKG51bWJlciwgcmFkaXgsIG1pbl9sZW5ndGgpIHtcclxuICAgICAgICBtaW5fbGVuZ3RoID0gbWluX2xlbmd0aCB8fCAwO1xyXG5cclxuICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgIHJhZGl4ID0gdXRpbHMucGFyc2VOdW1iZXIocmFkaXgpO1xyXG4gICAgICAgIG1pbl9sZW5ndGggPSB1dGlscy5wYXJzZU51bWJlcihtaW5fbGVuZ3RoKTtcclxuICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihudW1iZXIsIHJhZGl4LCBtaW5fbGVuZ3RoKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG1pbl9sZW5ndGggPSAobWluX2xlbmd0aCA9PT0gdW5kZWZpbmVkKSA/IDAgOiBtaW5fbGVuZ3RoO1xyXG4gICAgICAgIHZhciByZXN1bHQgPSBudW1iZXIudG9TdHJpbmcocmFkaXgpO1xyXG4gICAgICAgIHJldHVybiBuZXcgQXJyYXkoTWF0aC5tYXgobWluX2xlbmd0aCArIDEgLSByZXN1bHQubGVuZ3RoLCAwKSkuam9pbignMCcpICsgcmVzdWx0O1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLkNFSUxJTkcgPSBmdW5jdGlvbihudW1iZXIsIHNpZ25pZmljYW5jZSwgbW9kZSkge1xyXG4gICAgICAgIHNpZ25pZmljYW5jZSA9IChzaWduaWZpY2FuY2UgPT09IHVuZGVmaW5lZCkgPyAxIDogc2lnbmlmaWNhbmNlO1xyXG4gICAgICAgIG1vZGUgPSAobW9kZSA9PT0gdW5kZWZpbmVkKSA/IDAgOiBtb2RlO1xyXG5cclxuICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgIHNpZ25pZmljYW5jZSA9IHV0aWxzLnBhcnNlTnVtYmVyKHNpZ25pZmljYW5jZSk7XHJcbiAgICAgICAgbW9kZSA9IHV0aWxzLnBhcnNlTnVtYmVyKG1vZGUpO1xyXG4gICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKG51bWJlciwgc2lnbmlmaWNhbmNlLCBtb2RlKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChzaWduaWZpY2FuY2UgPT09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzaWduaWZpY2FuY2UgPSBNYXRoLmFicyhzaWduaWZpY2FuY2UpO1xyXG4gICAgICAgIGlmIChudW1iZXIgPj0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gTWF0aC5jZWlsKG51bWJlciAvIHNpZ25pZmljYW5jZSkgKiBzaWduaWZpY2FuY2U7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKG1vZGUgPT09IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAtMSAqIE1hdGguZmxvb3IoTWF0aC5hYnMobnVtYmVyKSAvIHNpZ25pZmljYW5jZSkgKiBzaWduaWZpY2FuY2U7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gLTEgKiBNYXRoLmNlaWwoTWF0aC5hYnMobnVtYmVyKSAvIHNpZ25pZmljYW5jZSkgKiBzaWduaWZpY2FuY2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuQ0VJTElORy5NQVRIID0gZXhwb3J0cy5DRUlMSU5HO1xyXG5cclxuICAgIGV4cG9ydHMuQ0VJTElORy5QUkVDSVNFID0gZXhwb3J0cy5DRUlMSU5HO1xyXG5cclxuICAgIGV4cG9ydHMuQ09NQklOID0gZnVuY3Rpb24obnVtYmVyLCBudW1iZXJfY2hvc2VuKSB7XHJcbiAgICAgICAgbnVtYmVyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKTtcclxuICAgICAgICBudW1iZXJfY2hvc2VuID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyX2Nob3Nlbik7XHJcbiAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IobnVtYmVyLCBudW1iZXJfY2hvc2VuKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBleHBvcnRzLkZBQ1QobnVtYmVyKSAvIChleHBvcnRzLkZBQ1QobnVtYmVyX2Nob3NlbikgKiBleHBvcnRzLkZBQ1QobnVtYmVyIC0gbnVtYmVyX2Nob3NlbikpO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLkNPTUJJTkEgPSBmdW5jdGlvbihudW1iZXIsIG51bWJlcl9jaG9zZW4pIHtcclxuICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgIG51bWJlcl9jaG9zZW4gPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXJfY2hvc2VuKTtcclxuICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihudW1iZXIsIG51bWJlcl9jaG9zZW4pKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIChudW1iZXIgPT09IDAgJiYgbnVtYmVyX2Nob3NlbiA9PT0gMCkgPyAxIDogZXhwb3J0cy5DT01CSU4obnVtYmVyICsgbnVtYmVyX2Nob3NlbiAtIDEsIG51bWJlciAtIDEpO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLkNPUyA9IGZ1bmN0aW9uKG51bWJlcikge1xyXG4gICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgaWYgKG51bWJlciBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudW1iZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBNYXRoLmNvcyhudW1iZXIpO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLkNPU0ggPSBmdW5jdGlvbihudW1iZXIpIHtcclxuICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgIGlmIChudW1iZXIgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gKE1hdGguZXhwKG51bWJlcikgKyBNYXRoLmV4cCgtbnVtYmVyKSkgLyAyO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLkNPVCA9IGZ1bmN0aW9uKG51bWJlcikge1xyXG4gICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgaWYgKG51bWJlciBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudW1iZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiAxIC8gTWF0aC50YW4obnVtYmVyKTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5DT1RIID0gZnVuY3Rpb24obnVtYmVyKSB7XHJcbiAgICAgICAgbnVtYmVyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKTtcclxuICAgICAgICBpZiAobnVtYmVyIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bWJlcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGUyID0gTWF0aC5leHAoMiAqIG51bWJlcik7XHJcbiAgICAgICAgcmV0dXJuIChlMiArIDEpIC8gKGUyIC0gMSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuQ1NDID0gZnVuY3Rpb24obnVtYmVyKSB7XHJcbiAgICAgICAgbnVtYmVyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKTtcclxuICAgICAgICBpZiAobnVtYmVyIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bWJlcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIDEgLyBNYXRoLnNpbihudW1iZXIpO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLkNTQ0ggPSBmdW5jdGlvbihudW1iZXIpIHtcclxuICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgIGlmIChudW1iZXIgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gMiAvIChNYXRoLmV4cChudW1iZXIpIC0gTWF0aC5leHAoLW51bWJlcikpO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLkRFQ0lNQUwgPSBmdW5jdGlvbihudW1iZXIsIHJhZGl4KSB7XHJcbiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAxKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICByZXR1cm4gcGFyc2VJbnQobnVtYmVyLCByYWRpeCk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuREVHUkVFUyA9IGZ1bmN0aW9uKG51bWJlcikge1xyXG4gICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgaWYgKG51bWJlciBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudW1iZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBudW1iZXIgKiAxODAgLyBNYXRoLlBJO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLkVWRU4gPSBmdW5jdGlvbihudW1iZXIpIHtcclxuICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgIGlmIChudW1iZXIgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZXhwb3J0cy5DRUlMSU5HKG51bWJlciwgLTIsIC0xKTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5FWFAgPSBNYXRoLmV4cDtcclxuXHJcbiAgICB2YXIgTUVNT0laRURfRkFDVCA9IFtdO1xyXG4gICAgZXhwb3J0cy5GQUNUID0gZnVuY3Rpb24obnVtYmVyKSB7XHJcbiAgICAgICAgbnVtYmVyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKTtcclxuICAgICAgICBpZiAobnVtYmVyIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bWJlcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIG4gPSBNYXRoLmZsb29yKG51bWJlcik7XHJcbiAgICAgICAgaWYgKG4gPT09IDAgfHwgbiA9PT0gMSkge1xyXG4gICAgICAgICAgICByZXR1cm4gMTtcclxuICAgICAgICB9IGVsc2UgaWYgKE1FTU9JWkVEX0ZBQ1Rbbl0gPiAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBNRU1PSVpFRF9GQUNUW25dO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIE1FTU9JWkVEX0ZBQ1Rbbl0gPSBleHBvcnRzLkZBQ1QobiAtIDEpICogbjtcclxuICAgICAgICAgICAgcmV0dXJuIE1FTU9JWkVEX0ZBQ1Rbbl07XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLkZBQ1RET1VCTEUgPSBmdW5jdGlvbihudW1iZXIpIHtcclxuICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgIGlmIChudW1iZXIgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgbiA9IE1hdGguZmxvb3IobnVtYmVyKTtcclxuICAgICAgICBpZiAobiA8PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAxO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuICogZXhwb3J0cy5GQUNURE9VQkxFKG4gLSAyKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuRkxPT1IgPSBmdW5jdGlvbihudW1iZXIsIHNpZ25pZmljYW5jZSwgbW9kZSkge1xyXG4gICAgICAgIHNpZ25pZmljYW5jZSA9IChzaWduaWZpY2FuY2UgPT09IHVuZGVmaW5lZCkgPyAxIDogc2lnbmlmaWNhbmNlO1xyXG4gICAgICAgIG1vZGUgPSAobW9kZSA9PT0gdW5kZWZpbmVkKSA/IDAgOiBtb2RlO1xyXG5cclxuICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgIHNpZ25pZmljYW5jZSA9IHV0aWxzLnBhcnNlTnVtYmVyKHNpZ25pZmljYW5jZSk7XHJcbiAgICAgICAgbW9kZSA9IHV0aWxzLnBhcnNlTnVtYmVyKG1vZGUpO1xyXG4gICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKG51bWJlciwgc2lnbmlmaWNhbmNlLCBtb2RlKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChzaWduaWZpY2FuY2UgPT09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzaWduaWZpY2FuY2UgPSBNYXRoLmFicyhzaWduaWZpY2FuY2UpO1xyXG4gICAgICAgIGlmIChudW1iZXIgPj0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihudW1iZXIgLyBzaWduaWZpY2FuY2UpICogc2lnbmlmaWNhbmNlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmIChtb2RlID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gLTEgKiBNYXRoLmNlaWwoTWF0aC5hYnMobnVtYmVyKSAvIHNpZ25pZmljYW5jZSkgKiBzaWduaWZpY2FuY2U7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gLTEgKiBNYXRoLmZsb29yKE1hdGguYWJzKG51bWJlcikgLyBzaWduaWZpY2FuY2UpICogc2lnbmlmaWNhbmNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLkZMT09SLk1BVEggPSBleHBvcnRzLkZMT09SO1xyXG5cclxuICAgIGV4cG9ydHMuR0NEID0gbnVsbDtcclxuXHJcbiAgICBleHBvcnRzLklOVCA9IGZ1bmN0aW9uKG51bWJlcikge1xyXG4gICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgaWYgKG51bWJlciBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudW1iZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBNYXRoLmZsb29yKG51bWJlcik7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuTENNID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgLy8gQ3JlZGl0czogSm9uYXMgUmFvbmkgU29hcmVzIFNpbHZhXHJcbiAgICAgICAgdmFyIG8gPSB1dGlscy5wYXJzZU51bWJlckFycmF5KHV0aWxzLmZsYXR0ZW4oYXJndW1lbnRzKSk7XHJcbiAgICAgICAgaWYgKG8gaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gbztcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yICh2YXIgaSwgaiwgbiwgZCwgciA9IDE7XHJcbiAgICAgICAgICAgIChuID0gby5wb3AoKSkgIT09IHVuZGVmaW5lZDspIHtcclxuICAgICAgICAgICAgd2hpbGUgKG4gPiAxKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobiAlIDIpIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSAzLCBqID0gTWF0aC5mbG9vcihNYXRoLnNxcnQobikpOyBpIDw9IGogJiYgbiAlIGk7IGkgKz0gMikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgLy9lbXB0eVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBkID0gKGkgPD0gaikgPyBpIDogbjtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZCA9IDI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBmb3IgKG4gLz0gZCwgciAqPSBkLCBpID0gby5sZW5ndGg7IGk7XHJcbiAgICAgICAgICAgICAgICAgICAgKG9bLS1pXSAlIGQpID09PSAwICYmIChvW2ldIC89IGQpID09PSAxICYmIG8uc3BsaWNlKGksIDEpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9lbXB0eVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLkxOID0gZnVuY3Rpb24obnVtYmVyKSB7XHJcbiAgICAgICAgbnVtYmVyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKTtcclxuICAgICAgICBpZiAobnVtYmVyIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bWJlcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIE1hdGgubG9nKG51bWJlcik7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuTE9HID0gZnVuY3Rpb24obnVtYmVyLCBiYXNlKSB7XHJcbiAgICAgICAgbnVtYmVyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKTtcclxuICAgICAgICBiYXNlID0gKGJhc2UgPT09IHVuZGVmaW5lZCkgPyAxMCA6IHV0aWxzLnBhcnNlTnVtYmVyKGJhc2UpO1xyXG5cclxuICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihudW1iZXIsIGJhc2UpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBNYXRoLmxvZyhudW1iZXIpIC8gTWF0aC5sb2coYmFzZSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuTE9HMTAgPSBmdW5jdGlvbihudW1iZXIpIHtcclxuICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgIGlmIChudW1iZXIgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gTWF0aC5sb2cobnVtYmVyKSAvIE1hdGgubG9nKDEwKTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5NREVURVJNID0gbnVsbDtcclxuXHJcbiAgICBleHBvcnRzLk1JTlZFUlNFID0gbnVsbDtcclxuXHJcbiAgICBleHBvcnRzLk1NVUxUID0gbnVsbDtcclxuXHJcbiAgICBleHBvcnRzLk1PRCA9IGZ1bmN0aW9uKGRpdmlkZW5kLCBkaXZpc29yKSB7XHJcbiAgICAgICAgZGl2aWRlbmQgPSB1dGlscy5wYXJzZU51bWJlcihkaXZpZGVuZCk7XHJcbiAgICAgICAgZGl2aXNvciA9IHV0aWxzLnBhcnNlTnVtYmVyKGRpdmlzb3IpO1xyXG4gICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKGRpdmlkZW5kLCBkaXZpc29yKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChkaXZpc29yID09PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5kaXYwO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgbW9kdWx1cyA9IE1hdGguYWJzKGRpdmlkZW5kICUgZGl2aXNvcik7XHJcbiAgICAgICAgcmV0dXJuIChkaXZpc29yID4gMCkgPyBtb2R1bHVzIDogLW1vZHVsdXM7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuTVJPVU5EID0gZnVuY3Rpb24obnVtYmVyLCBtdWx0aXBsZSkge1xyXG4gICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgbXVsdGlwbGUgPSB1dGlscy5wYXJzZU51bWJlcihtdWx0aXBsZSk7XHJcbiAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IobnVtYmVyLCBtdWx0aXBsZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobnVtYmVyICogbXVsdGlwbGUgPCAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gTWF0aC5yb3VuZChudW1iZXIgLyBtdWx0aXBsZSkgKiBtdWx0aXBsZTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5NVUxUSU5PTUlBTCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciBhcmdzID0gdXRpbHMucGFyc2VOdW1iZXJBcnJheSh1dGlscy5mbGF0dGVuKGFyZ3VtZW50cykpO1xyXG4gICAgICAgIGlmIChhcmdzIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGFyZ3M7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBzdW0gPSAwO1xyXG4gICAgICAgIHZhciBkaXZpc29yID0gMTtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyZ3MubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgc3VtICs9IGFyZ3NbaV07XHJcbiAgICAgICAgICAgIGRpdmlzb3IgKj0gZXhwb3J0cy5GQUNUKGFyZ3NbaV0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZXhwb3J0cy5GQUNUKHN1bSkgLyBkaXZpc29yO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLk1VTklUID0gbnVsbDtcclxuXHJcbiAgICBleHBvcnRzLk9ERCA9IGZ1bmN0aW9uKG51bWJlcikge1xyXG4gICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgaWYgKG51bWJlciBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudW1iZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciB0ZW1wID0gTWF0aC5jZWlsKE1hdGguYWJzKG51bWJlcikpO1xyXG4gICAgICAgIHRlbXAgPSAodGVtcCAmIDEpID8gdGVtcCA6IHRlbXAgKyAxO1xyXG4gICAgICAgIHJldHVybiAobnVtYmVyID4gMCkgPyB0ZW1wIDogLXRlbXA7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuUEkgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gTWF0aC5QSTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5QT1dFUiA9IGZ1bmN0aW9uKG51bWJlciwgcG93ZXIpIHtcclxuICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgIHBvd2VyID0gdXRpbHMucGFyc2VOdW1iZXIocG93ZXIpO1xyXG4gICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKG51bWJlciwgcG93ZXIpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IE1hdGgucG93KG51bWJlciwgcG93ZXIpO1xyXG4gICAgICAgIGlmIChpc05hTihyZXN1bHQpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLlBST0RVQ1QgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgYXJncyA9IHV0aWxzLnBhcnNlTnVtYmVyQXJyYXkodXRpbHMuZmxhdHRlbihhcmd1bWVudHMpKTtcclxuICAgICAgICBpZiAoYXJncyBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBhcmdzO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgcmVzdWx0ID0gMTtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyZ3MubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgcmVzdWx0ICo9IGFyZ3NbaV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuUVVPVElFTlQgPSBmdW5jdGlvbihudW1lcmF0b3IsIGRlbm9taW5hdG9yKSB7XHJcbiAgICAgICAgbnVtZXJhdG9yID0gdXRpbHMucGFyc2VOdW1iZXIobnVtZXJhdG9yKTtcclxuICAgICAgICBkZW5vbWluYXRvciA9IHV0aWxzLnBhcnNlTnVtYmVyKGRlbm9taW5hdG9yKTtcclxuICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihudW1lcmF0b3IsIGRlbm9taW5hdG9yKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBwYXJzZUludChudW1lcmF0b3IgLyBkZW5vbWluYXRvciwgMTApO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLlJBRElBTlMgPSBmdW5jdGlvbihudW1iZXIpIHtcclxuICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgIGlmIChudW1iZXIgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbnVtYmVyICogTWF0aC5QSSAvIDE4MDtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5SQU5EID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIE1hdGgucmFuZG9tKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuUkFOREJFVFdFRU4gPSBmdW5jdGlvbihib3R0b20sIHRvcCkge1xyXG4gICAgICAgIGJvdHRvbSA9IHV0aWxzLnBhcnNlTnVtYmVyKGJvdHRvbSk7XHJcbiAgICAgICAgdG9wID0gdXRpbHMucGFyc2VOdW1iZXIodG9wKTtcclxuICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihib3R0b20sIHRvcCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBDcmVhdGl2ZSBDb21tb25zIEF0dHJpYnV0aW9uIDMuMCBMaWNlbnNlXHJcbiAgICAgICAgLy8gQ29weXJpZ2h0IChjKSAyMDEyIGVxY29kZVxyXG4gICAgICAgIHJldHVybiBib3R0b20gKyBNYXRoLmNlaWwoKHRvcCAtIGJvdHRvbSArIDEpICogTWF0aC5yYW5kb20oKSkgLSAxO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLlJPTUFOID0gbnVsbDtcclxuXHJcbiAgICBleHBvcnRzLlJPVU5EID0gZnVuY3Rpb24obnVtYmVyLCBkaWdpdHMpIHtcclxuICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgIGRpZ2l0cyA9IHV0aWxzLnBhcnNlTnVtYmVyKGRpZ2l0cyk7XHJcbiAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IobnVtYmVyLCBkaWdpdHMpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIE1hdGgucm91bmQobnVtYmVyICogTWF0aC5wb3coMTAsIGRpZ2l0cykpIC8gTWF0aC5wb3coMTAsIGRpZ2l0cyk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuUk9VTkRET1dOID0gZnVuY3Rpb24obnVtYmVyLCBkaWdpdHMpIHtcclxuICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgIGRpZ2l0cyA9IHV0aWxzLnBhcnNlTnVtYmVyKGRpZ2l0cyk7XHJcbiAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IobnVtYmVyLCBkaWdpdHMpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIHNpZ24gPSAobnVtYmVyID4gMCkgPyAxIDogLTE7XHJcbiAgICAgICAgcmV0dXJuIHNpZ24gKiAoTWF0aC5mbG9vcihNYXRoLmFicyhudW1iZXIpICogTWF0aC5wb3coMTAsIGRpZ2l0cykpKSAvIE1hdGgucG93KDEwLCBkaWdpdHMpO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLlJPVU5EVVAgPSBmdW5jdGlvbihudW1iZXIsIGRpZ2l0cykge1xyXG4gICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgZGlnaXRzID0gdXRpbHMucGFyc2VOdW1iZXIoZGlnaXRzKTtcclxuICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihudW1iZXIsIGRpZ2l0cykpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgc2lnbiA9IChudW1iZXIgPiAwKSA/IDEgOiAtMTtcclxuICAgICAgICByZXR1cm4gc2lnbiAqIChNYXRoLmNlaWwoTWF0aC5hYnMobnVtYmVyKSAqIE1hdGgucG93KDEwLCBkaWdpdHMpKSkgLyBNYXRoLnBvdygxMCwgZGlnaXRzKTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5TRUMgPSBmdW5jdGlvbihudW1iZXIpIHtcclxuICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgIGlmIChudW1iZXIgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gMSAvIE1hdGguY29zKG51bWJlcik7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuU0VDSCA9IGZ1bmN0aW9uKG51bWJlcikge1xyXG4gICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgaWYgKG51bWJlciBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudW1iZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiAyIC8gKE1hdGguZXhwKG51bWJlcikgKyBNYXRoLmV4cCgtbnVtYmVyKSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuU0VSSUVTU1VNID0gZnVuY3Rpb24oeCwgbiwgbSwgY29lZmZpY2llbnRzKSB7XHJcbiAgICAgICAgeCA9IHV0aWxzLnBhcnNlTnVtYmVyKHgpO1xyXG4gICAgICAgIG4gPSB1dGlscy5wYXJzZU51bWJlcihuKTtcclxuICAgICAgICBtID0gdXRpbHMucGFyc2VOdW1iZXIobSk7XHJcbiAgICAgICAgY29lZmZpY2llbnRzID0gdXRpbHMucGFyc2VOdW1iZXJBcnJheShjb2VmZmljaWVudHMpO1xyXG4gICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKHgsIG4sIG0sIGNvZWZmaWNpZW50cykpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgcmVzdWx0ID0gY29lZmZpY2llbnRzWzBdICogTWF0aC5wb3coeCwgbik7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBjb2VmZmljaWVudHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgcmVzdWx0ICs9IGNvZWZmaWNpZW50c1tpXSAqIE1hdGgucG93KHgsIG4gKyBpICogbSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuU0lHTiA9IGZ1bmN0aW9uKG51bWJlcikge1xyXG4gICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgaWYgKG51bWJlciBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudW1iZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChudW1iZXIgPCAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAtMTtcclxuICAgICAgICB9IGVsc2UgaWYgKG51bWJlciA9PT0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gMTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuU0lOID0gZnVuY3Rpb24obnVtYmVyKSB7XHJcbiAgICAgICAgbnVtYmVyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKTtcclxuICAgICAgICBpZiAobnVtYmVyIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bWJlcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIE1hdGguc2luKG51bWJlcik7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuU0lOSCA9IGZ1bmN0aW9uKG51bWJlcikge1xyXG4gICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgaWYgKG51bWJlciBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudW1iZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiAoTWF0aC5leHAobnVtYmVyKSAtIE1hdGguZXhwKC1udW1iZXIpKSAvIDI7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuU1FSVCA9IGZ1bmN0aW9uKG51bWJlcikge1xyXG4gICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgaWYgKG51bWJlciBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudW1iZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChudW1iZXIgPCAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBNYXRoLnNxcnQobnVtYmVyKTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5TUVJUUEkgPSBmdW5jdGlvbihudW1iZXIpIHtcclxuICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgIGlmIChudW1iZXIgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gTWF0aC5zcXJ0KG51bWJlciAqIE1hdGguUEkpO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLlNVQlRPVEFMID0gbnVsbDtcclxuXHJcbiAgICBleHBvcnRzLkFERCA9IGZ1bmN0aW9uIChudW0xLCBudW0yKSB7XHJcbiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLm5hO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbnVtMSA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bTEpO1xyXG4gICAgICAgIG51bTIgPSB1dGlscy5wYXJzZU51bWJlcihudW0yKTtcclxuICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihudW0xLCBudW0yKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gbnVtMSArIG51bTI7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuTUlOVVMgPSBmdW5jdGlvbiAobnVtMSwgbnVtMikge1xyXG4gICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5uYTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIG51bTEgPSB1dGlscy5wYXJzZU51bWJlcihudW0xKTtcclxuICAgICAgICBudW0yID0gdXRpbHMucGFyc2VOdW1iZXIobnVtMik7XHJcbiAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IobnVtMSwgbnVtMikpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG51bTEgLSBudW0yO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLkRJVklERSA9IGZ1bmN0aW9uIChkaXZpZGVuZCwgZGl2aXNvcikge1xyXG4gICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5uYTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGRpdmlkZW5kID0gdXRpbHMucGFyc2VOdW1iZXIoZGl2aWRlbmQpO1xyXG4gICAgICAgIGRpdmlzb3IgPSB1dGlscy5wYXJzZU51bWJlcihkaXZpc29yKTtcclxuICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihkaXZpZGVuZCwgZGl2aXNvcikpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGRpdmlzb3IgPT09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLmRpdjA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gZGl2aWRlbmQgLyBkaXZpc29yO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLk1VTFRJUExZID0gZnVuY3Rpb24gKGZhY3RvcjEsIGZhY3RvcjIpIHtcclxuICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMikge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IubmE7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmYWN0b3IxID0gdXRpbHMucGFyc2VOdW1iZXIoZmFjdG9yMSk7XHJcbiAgICAgICAgZmFjdG9yMiA9IHV0aWxzLnBhcnNlTnVtYmVyKGZhY3RvcjIpO1xyXG4gICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKGZhY3RvcjEsIGZhY3RvcjIpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBmYWN0b3IxICogZmFjdG9yMjtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5HVEUgPSBmdW5jdGlvbiAobnVtMSwgbnVtMikge1xyXG4gICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5uYTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIG51bTEgPSB1dGlscy5wYXJzZU51bWJlcihudW0xKTtcclxuICAgICAgICBudW0yID0gdXRpbHMucGFyc2VOdW1iZXIobnVtMik7XHJcbiAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IobnVtMSwgbnVtMikpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLmVycm9yO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG51bTEgPj0gbnVtMjtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5MVCA9IGZ1bmN0aW9uIChudW0xLCBudW0yKSB7XHJcbiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLm5hO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbnVtMSA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bTEpO1xyXG4gICAgICAgIG51bTIgPSB1dGlscy5wYXJzZU51bWJlcihudW0yKTtcclxuICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihudW0xLCBudW0yKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IuZXJyb3I7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gbnVtMSA8IG51bTI7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuTFRFID0gZnVuY3Rpb24gKG51bTEsIG51bTIpIHtcclxuICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMikge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IubmE7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBudW0xID0gdXRpbHMucGFyc2VOdW1iZXIobnVtMSk7XHJcbiAgICAgICAgbnVtMiA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bTIpO1xyXG4gICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKG51bTEsIG51bTIpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5lcnJvcjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBudW0xIDw9IG51bTI7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuRVEgPSBmdW5jdGlvbiAodmFsdWUxLCB2YWx1ZTIpIHtcclxuICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMikge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IubmE7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdmFsdWUxID09PSB2YWx1ZTI7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuTkUgPSBmdW5jdGlvbiAodmFsdWUxLCB2YWx1ZTIpIHtcclxuICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMikge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IubmE7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdmFsdWUxICE9PSB2YWx1ZTI7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuUE9XID0gZnVuY3Rpb24gKGJhc2UsIGV4cG9uZW50KSB7XHJcbiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLm5hO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgYmFzZSA9IHV0aWxzLnBhcnNlTnVtYmVyKGJhc2UpO1xyXG4gICAgICAgIGV4cG9uZW50ID0gdXRpbHMucGFyc2VOdW1iZXIoZXhwb25lbnQpO1xyXG4gICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKGJhc2UsIGV4cG9uZW50KSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IuZXJyb3I7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gZXhwb3J0cy5QT1dFUihiYXNlLCBleHBvbmVudCk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuU1VNID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IDA7XHJcbiAgICAgICAgdmFyIGFyZ3NLZXlzID0gT2JqZWN0LmtleXMoYXJndW1lbnRzKTtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyZ3NLZXlzLmxlbmd0aDsgKytpKSB7XHJcbiAgICAgICAgICAgIHZhciBlbHQgPSBhcmd1bWVudHNbYXJnc0tleXNbaV1dO1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIGVsdCA9PT0gJ251bWJlcicpIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCArPSBlbHQ7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGVsdCA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgIHZhciBwYXJzZWQgPSBwYXJzZUZsb2F0KGVsdCk7XHJcbiAgICAgICAgICAgICAgICAhaXNOYU4ocGFyc2VkKSAmJiAocmVzdWx0ICs9IHBhcnNlZCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShlbHQpKSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQgKz0gZXhwb3J0cy5TVU0uYXBwbHkobnVsbCwgZWx0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLlNVTUlGID0gZnVuY3Rpb24ocmFuZ2UsIGNyaXRlcmlhKSB7XHJcbiAgICAgICAgcmFuZ2UgPSB1dGlscy5wYXJzZU51bWJlckFycmF5KHV0aWxzLmZsYXR0ZW4ocmFuZ2UpKTtcclxuICAgICAgICBpZiAocmFuZ2UgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gcmFuZ2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciByZXN1bHQgPSAwO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmFuZ2UubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgcmVzdWx0ICs9IChldmFsKHJhbmdlW2ldICsgY3JpdGVyaWEpKSA/IHJhbmdlW2ldIDogMDsgLy8ganNoaW50IGlnbm9yZTpsaW5lXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuU1VNSUZTID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIGFyZ3MgPSB1dGlscy5hcmdzVG9BcnJheShhcmd1bWVudHMpO1xyXG4gICAgICAgIHZhciByYW5nZSA9IHV0aWxzLnBhcnNlTnVtYmVyQXJyYXkodXRpbHMuZmxhdHRlbihhcmdzLnNoaWZ0KCkpKTtcclxuICAgICAgICBpZiAocmFuZ2UgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gcmFuZ2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBjcml0ZXJpYSA9IGFyZ3M7XHJcblxyXG4gICAgICAgIHZhciBuX3JhbmdlX2VsZW1lbnRzID0gcmFuZ2UubGVuZ3RoO1xyXG4gICAgICAgIHZhciBuX2NyaXRlcmlhcyA9IGNyaXRlcmlhLmxlbmd0aDtcclxuXHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IDA7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuX3JhbmdlX2VsZW1lbnRzOyBpKyspIHtcclxuICAgICAgICAgICAgdmFyIGVsID0gcmFuZ2VbaV07XHJcbiAgICAgICAgICAgIHZhciBjb25kaXRpb24gPSAnJztcclxuICAgICAgICAgICAgZm9yICh2YXIgYyA9IDA7IGMgPCBuX2NyaXRlcmlhczsgYysrKSB7XHJcbiAgICAgICAgICAgICAgICBjb25kaXRpb24gKz0gZWwgKyBjcml0ZXJpYVtjXTtcclxuICAgICAgICAgICAgICAgIGlmIChjICE9PSBuX2NyaXRlcmlhcyAtIDEpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25kaXRpb24gKz0gJyYmJztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoZXZhbChjb25kaXRpb24pKSB7IC8vIGpzaGludCBpZ25vcmU6bGluZVxyXG4gICAgICAgICAgICAgICAgcmVzdWx0ICs9IGVsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuU1VNUFJPRFVDVCA9IG51bGw7XHJcblxyXG4gICAgZXhwb3J0cy5TVU1TUSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciBudW1iZXJzID0gdXRpbHMucGFyc2VOdW1iZXJBcnJheSh1dGlscy5mbGF0dGVuKGFyZ3VtZW50cykpO1xyXG4gICAgICAgIGlmIChudW1iZXJzIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bWJlcnM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciByZXN1bHQgPSAwO1xyXG4gICAgICAgIHZhciBsZW5ndGggPSBudW1iZXJzLmxlbmd0aDtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdCArPSAoSVNOVU1CRVIobnVtYmVyc1tpXSkpID8gbnVtYmVyc1tpXSAqIG51bWJlcnNbaV0gOiAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLlNVTVgyTVkyID0gZnVuY3Rpb24oYXJyYXlfeCwgYXJyYXlfeSkge1xyXG4gICAgICAgIGFycmF5X3ggPSB1dGlscy5wYXJzZU51bWJlckFycmF5KHV0aWxzLmZsYXR0ZW4oYXJyYXlfeCkpO1xyXG4gICAgICAgIGFycmF5X3kgPSB1dGlscy5wYXJzZU51bWJlckFycmF5KHV0aWxzLmZsYXR0ZW4oYXJyYXlfeSkpO1xyXG4gICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKGFycmF5X3gsIGFycmF5X3kpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IDA7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnJheV94Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdCArPSBhcnJheV94W2ldICogYXJyYXlfeFtpXSAtIGFycmF5X3lbaV0gKiBhcnJheV95W2ldO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLlNVTVgyUFkyID0gZnVuY3Rpb24oYXJyYXlfeCwgYXJyYXlfeSkge1xyXG4gICAgICAgIGFycmF5X3ggPSB1dGlscy5wYXJzZU51bWJlckFycmF5KHV0aWxzLmZsYXR0ZW4oYXJyYXlfeCkpO1xyXG4gICAgICAgIGFycmF5X3kgPSB1dGlscy5wYXJzZU51bWJlckFycmF5KHV0aWxzLmZsYXR0ZW4oYXJyYXlfeSkpO1xyXG4gICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKGFycmF5X3gsIGFycmF5X3kpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IDA7XHJcbiAgICAgICAgYXJyYXlfeCA9IHV0aWxzLnBhcnNlTnVtYmVyQXJyYXkodXRpbHMuZmxhdHRlbihhcnJheV94KSk7XHJcbiAgICAgICAgYXJyYXlfeSA9IHV0aWxzLnBhcnNlTnVtYmVyQXJyYXkodXRpbHMuZmxhdHRlbihhcnJheV95KSk7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnJheV94Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdCArPSBhcnJheV94W2ldICogYXJyYXlfeFtpXSArIGFycmF5X3lbaV0gKiBhcnJheV95W2ldO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLlNVTVhNWTIgPSBmdW5jdGlvbihhcnJheV94LCBhcnJheV95KSB7XHJcbiAgICAgICAgYXJyYXlfeCA9IHV0aWxzLnBhcnNlTnVtYmVyQXJyYXkodXRpbHMuZmxhdHRlbihhcnJheV94KSk7XHJcbiAgICAgICAgYXJyYXlfeSA9IHV0aWxzLnBhcnNlTnVtYmVyQXJyYXkodXRpbHMuZmxhdHRlbihhcnJheV95KSk7XHJcbiAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IoYXJyYXlfeCwgYXJyYXlfeSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgcmVzdWx0ID0gMDtcclxuICAgICAgICBhcnJheV94ID0gdXRpbHMuZmxhdHRlbihhcnJheV94KTtcclxuICAgICAgICBhcnJheV95ID0gdXRpbHMuZmxhdHRlbihhcnJheV95KTtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFycmF5X3gubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgcmVzdWx0ICs9IE1hdGgucG93KGFycmF5X3hbaV0gLSBhcnJheV95W2ldLCAyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5UQU4gPSBmdW5jdGlvbihudW1iZXIpIHtcclxuICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgIGlmIChudW1iZXIgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gTWF0aC50YW4obnVtYmVyKTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5UQU5IID0gZnVuY3Rpb24obnVtYmVyKSB7XHJcbiAgICAgICAgbnVtYmVyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKTtcclxuICAgICAgICBpZiAobnVtYmVyIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bWJlcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGUyID0gTWF0aC5leHAoMiAqIG51bWJlcik7XHJcbiAgICAgICAgcmV0dXJuIChlMiAtIDEpIC8gKGUyICsgMSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuVFJVTkMgPSBmdW5jdGlvbihudW1iZXIsIGRpZ2l0cykge1xyXG4gICAgICAgIGRpZ2l0cyA9IChkaWdpdHMgPT09IHVuZGVmaW5lZCkgPyAwIDogZGlnaXRzO1xyXG4gICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgZGlnaXRzID0gdXRpbHMucGFyc2VOdW1iZXIoZGlnaXRzKTtcclxuICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihudW1iZXIsIGRpZ2l0cykpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgc2lnbiA9IChudW1iZXIgPiAwKSA/IDEgOiAtMTtcclxuICAgICAgICByZXR1cm4gc2lnbiAqIChNYXRoLmZsb29yKE1hdGguYWJzKG51bWJlcikgKiBNYXRoLnBvdygxMCwgZGlnaXRzKSkpIC8gTWF0aC5wb3coMTAsIGRpZ2l0cyk7XHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiBleHBvcnRzO1xyXG59KSgpO1xyXG5cclxuamV4Y2VsLm1ldGhvZHMubWlzYyA9IChmdW5jdGlvbigpIHtcclxuICAgIHZhciBleHBvcnRzID0ge307XHJcblxyXG4gICAgZXhwb3J0cy5VTklRVUUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IFtdO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgKytpKSB7XHJcbiAgICAgICAgICAgIHZhciBoYXNFbGVtZW50ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gYXJndW1lbnRzW2ldO1xyXG5cclxuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgd2UndmUgYWxyZWFkeSBzZWVuIHRoaXMgZWxlbWVudC5cclxuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCByZXN1bHQubGVuZ3RoOyArK2opIHtcclxuICAgICAgICAgICAgICAgIGhhc0VsZW1lbnQgPSByZXN1bHRbal0gPT09IGVsZW1lbnQ7XHJcbiAgICAgICAgICAgICAgICBpZiAoaGFzRWxlbWVudCkgeyBicmVhazsgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBJZiB3ZSBkaWQgbm90IGZpbmQgaXQsIGFkZCBpdCB0byB0aGUgcmVzdWx0LlxyXG4gICAgICAgICAgICBpZiAoIWhhc0VsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGVsZW1lbnQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuRkxBVFRFTiA9IHV0aWxzLmZsYXR0ZW47XHJcblxyXG4gICAgZXhwb3J0cy5BUkdTMkFSUkFZID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDApO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLlJFRkVSRU5DRSA9IGZ1bmN0aW9uIChjb250ZXh0LCByZWZlcmVuY2UpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICB2YXIgcGF0aCA9IHJlZmVyZW5jZS5zcGxpdCgnLicpO1xyXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gY29udGV4dDtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXRoLmxlbmd0aDsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc3RlcCA9IHBhdGhbaV07XHJcbiAgICAgICAgICAgICAgICBpZiAoc3RlcFtzdGVwLmxlbmd0aCAtIDFdID09PSAnXScpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgb3BlbmluZyA9IHN0ZXAuaW5kZXhPZignWycpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IHN0ZXAuc3Vic3RyaW5nKG9wZW5pbmcgKyAxLCBzdGVwLmxlbmd0aCAtIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdFtzdGVwLnN1YnN0cmluZygwLCBvcGVuaW5nKV1baW5kZXhdO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSByZXN1bHRbc3RlcF07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge31cclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5KT0lOID0gZnVuY3Rpb24gKGFycmF5LCBzZXBhcmF0b3IpIHtcclxuICAgICAgICByZXR1cm4gYXJyYXkuam9pbihzZXBhcmF0b3IpO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLk5VTUJFUlMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHBvc3NpYmxlTnVtYmVycyA9IHV0aWxzLmZsYXR0ZW4oYXJndW1lbnRzKTtcclxuICAgICAgICByZXR1cm4gcG9zc2libGVOdW1iZXJzLmZpbHRlcihmdW5jdGlvbiAoZWwpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiBlbCA9PT0gJ251bWJlcic7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuTlVNRVJBTCA9IG51bGw7XHJcblxyXG4gICAgcmV0dXJuIGV4cG9ydHM7XHJcbn0pKCk7XHJcblxyXG5qZXhjZWwubWV0aG9kcy50ZXh0ID0gKGZ1bmN0aW9uKCkge1xyXG4gICAgdmFyIGV4cG9ydHMgPSB7fTtcclxuXHJcbiAgICBleHBvcnRzLkFTQyA9IG51bGw7XHJcblxyXG4gICAgZXhwb3J0cy5CQUhUVEVYVCA9IG51bGw7XHJcblxyXG4gICAgZXhwb3J0cy5DSEFSID0gZnVuY3Rpb24obnVtYmVyKSB7XHJcbiAgICAgICAgbnVtYmVyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKTtcclxuICAgICAgICBpZiAobnVtYmVyIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bWJlcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUobnVtYmVyKTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5DTEVBTiA9IGZ1bmN0aW9uKHRleHQpIHtcclxuICAgICAgICB0ZXh0ID0gdGV4dCB8fCAnJztcclxuICAgICAgICB2YXIgcmUgPSAvW1xcMC1cXHgxRl0vZztcclxuICAgICAgICByZXR1cm4gdGV4dC5yZXBsYWNlKHJlLCBcIlwiKTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5DT0RFID0gZnVuY3Rpb24odGV4dCkge1xyXG4gICAgICAgIHRleHQgPSB0ZXh0IHx8ICcnO1xyXG4gICAgICAgIHJldHVybiB0ZXh0LmNoYXJDb2RlQXQoMCk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuQ09OQ0FURU5BVEUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgYXJncyA9IHV0aWxzLmZsYXR0ZW4oYXJndW1lbnRzKTtcclxuXHJcbiAgICAgICAgdmFyIHRydWVGb3VuZCA9IDA7XHJcbiAgICAgICAgd2hpbGUgKCh0cnVlRm91bmQgPSBhcmdzLmluZGV4T2YodHJ1ZSkpID4gLTEpIHtcclxuICAgICAgICAgICAgYXJnc1t0cnVlRm91bmRdID0gJ1RSVUUnO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGZhbHNlRm91bmQgPSAwO1xyXG4gICAgICAgIHdoaWxlICgoZmFsc2VGb3VuZCA9IGFyZ3MuaW5kZXhPZihmYWxzZSkpID4gLTEpIHtcclxuICAgICAgICAgICAgYXJnc1tmYWxzZUZvdW5kXSA9ICdGQUxTRSc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gYXJncy5qb2luKCcnKTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5EQkNTID0gbnVsbDtcclxuXHJcbiAgICBleHBvcnRzLkRPTExBUiA9IG51bGw7XHJcblxyXG4gICAgZXhwb3J0cy5FWEFDVCA9IGZ1bmN0aW9uKHRleHQxLCB0ZXh0Mikge1xyXG4gICAgICAgIHJldHVybiB0ZXh0MSA9PT0gdGV4dDI7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuRklORCA9IGZ1bmN0aW9uKGZpbmRfdGV4dCwgd2l0aGluX3RleHQsIHBvc2l0aW9uKSB7XHJcbiAgICAgICAgcG9zaXRpb24gPSAocG9zaXRpb24gPT09IHVuZGVmaW5lZCkgPyAwIDogcG9zaXRpb247XHJcbiAgICAgICAgcmV0dXJuIHdpdGhpbl90ZXh0ID8gd2l0aGluX3RleHQuaW5kZXhPZihmaW5kX3RleHQsIHBvc2l0aW9uIC0gMSkgKyAxIDogbnVsbDtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5GSVhFRCA9IG51bGw7XHJcblxyXG4gICAgZXhwb3J0cy5IVE1MMlRFWFQgPSBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICB2YXIgcmVzdWx0ID0gJyc7XHJcblxyXG4gICAgICAgIGlmICh2YWx1ZSkge1xyXG4gICAgICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBBcnJheSkge1xyXG4gICAgICAgICAgICAgICAgdmFsdWUuZm9yRWFjaChmdW5jdGlvbiAobGluZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgIT09ICcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gJ1xcbic7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSAobGluZS5yZXBsYWNlKC88KD86LnxcXG4pKj8+L2dtLCAnJykpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQgPSB2YWx1ZS5yZXBsYWNlKC88KD86LnxcXG4pKj8+L2dtLCAnJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuTEVGVCA9IGZ1bmN0aW9uKHRleHQsIG51bWJlcikge1xyXG4gICAgICAgIG51bWJlciA9IChudW1iZXIgPT09IHVuZGVmaW5lZCkgPyAxIDogbnVtYmVyO1xyXG4gICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgaWYgKG51bWJlciBpbnN0YW5jZW9mIEVycm9yIHx8IHR5cGVvZiB0ZXh0ICE9PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0ZXh0ID8gdGV4dC5zdWJzdHJpbmcoMCwgbnVtYmVyKSA6IG51bGw7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuTEVOID0gZnVuY3Rpb24odGV4dCkge1xyXG4gICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5lcnJvcjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0eXBlb2YgdGV4dCA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRleHQgPyB0ZXh0Lmxlbmd0aCA6IDA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGV4dC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRleHQubGVuZ3RoO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLkxPV0VSID0gZnVuY3Rpb24odGV4dCkge1xyXG4gICAgICAgIGlmICh0eXBlb2YgdGV4dCAhPT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGV4dCA/IHRleHQudG9Mb3dlckNhc2UoKSA6IHRleHQ7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuTUlEID0gZnVuY3Rpb24odGV4dCwgc3RhcnQsIG51bWJlcikge1xyXG4gICAgICAgIHN0YXJ0ID0gdXRpbHMucGFyc2VOdW1iZXIoc3RhcnQpO1xyXG4gICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3Ioc3RhcnQsIG51bWJlcikgfHwgdHlwZW9mIHRleHQgIT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudW1iZXI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgYmVnaW4gPSBzdGFydCAtIDE7XHJcbiAgICAgICAgdmFyIGVuZCA9IGJlZ2luICsgbnVtYmVyO1xyXG5cclxuICAgICAgICByZXR1cm4gdGV4dC5zdWJzdHJpbmcoYmVnaW4sIGVuZCk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuTlVNQkVSVkFMVUUgPSBudWxsO1xyXG5cclxuICAgIGV4cG9ydHMuUFJPTkVUSUMgPSBudWxsO1xyXG5cclxuICAgIGV4cG9ydHMuUFJPUEVSID0gZnVuY3Rpb24odGV4dCkge1xyXG4gICAgICAgIGlmICh0ZXh0ID09PSB1bmRlZmluZWQgfHwgdGV4dC5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGV4dCA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICB0ZXh0ID0gJ1RSVUUnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGV4dCA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgdGV4dCA9ICdGQUxTRSc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChpc05hTih0ZXh0KSAmJiB0eXBlb2YgdGV4dCA9PT0gJ251bWJlcicpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodHlwZW9mIHRleHQgPT09ICdudW1iZXInKSB7XHJcbiAgICAgICAgICAgIHRleHQgPSAnJyArIHRleHQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdGV4dC5yZXBsYWNlKC9cXHdcXFMqL2csIGZ1bmN0aW9uKHR4dCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdHh0LmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgdHh0LnN1YnN0cigxKS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLlJFR0VYRVhUUkFDVCA9IGZ1bmN0aW9uICh0ZXh0LCByZWd1bGFyX2V4cHJlc3Npb24pIHtcclxuICAgICAgICB2YXIgbWF0Y2ggPSB0ZXh0Lm1hdGNoKG5ldyBSZWdFeHAocmVndWxhcl9leHByZXNzaW9uKSk7XHJcbiAgICAgICAgcmV0dXJuIG1hdGNoID8gKG1hdGNoW21hdGNoLmxlbmd0aCA+IDEgPyBtYXRjaC5sZW5ndGggLSAxIDogMF0pIDogbnVsbDtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5SRUdFWE1BVENIID0gZnVuY3Rpb24gKHRleHQsIHJlZ3VsYXJfZXhwcmVzc2lvbiwgZnVsbCkge1xyXG4gICAgICAgIHZhciBtYXRjaCA9IHRleHQubWF0Y2gobmV3IFJlZ0V4cChyZWd1bGFyX2V4cHJlc3Npb24pKTtcclxuICAgICAgICByZXR1cm4gZnVsbCA/IG1hdGNoIDogISFtYXRjaDtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5SRUdFWFJFUExBQ0UgPSBmdW5jdGlvbiAodGV4dCwgcmVndWxhcl9leHByZXNzaW9uLCByZXBsYWNlbWVudCkge1xyXG4gICAgICAgIHJldHVybiB0ZXh0LnJlcGxhY2UobmV3IFJlZ0V4cChyZWd1bGFyX2V4cHJlc3Npb24pLCByZXBsYWNlbWVudCk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuUkVQTEFDRSA9IGZ1bmN0aW9uKHRleHQsIHBvc2l0aW9uLCBsZW5ndGgsIG5ld190ZXh0KSB7XHJcbiAgICAgICAgcG9zaXRpb24gPSB1dGlscy5wYXJzZU51bWJlcihwb3NpdGlvbik7XHJcbiAgICAgICAgbGVuZ3RoID0gdXRpbHMucGFyc2VOdW1iZXIobGVuZ3RoKTtcclxuICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihwb3NpdGlvbiwgbGVuZ3RoKSB8fFxyXG4gICAgICAgICAgICB0eXBlb2YgdGV4dCAhPT0gJ3N0cmluZycgfHxcclxuICAgICAgICAgICAgdHlwZW9mIG5ld190ZXh0ICE9PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0ZXh0LnN1YnN0cigwLCBwb3NpdGlvbiAtIDEpICsgbmV3X3RleHQgKyB0ZXh0LnN1YnN0cihwb3NpdGlvbiAtIDEgKyBsZW5ndGgpO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLlJFUFQgPSBmdW5jdGlvbih0ZXh0LCBudW1iZXIpIHtcclxuICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgIGlmIChudW1iZXIgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbmV3IEFycmF5KG51bWJlciArIDEpLmpvaW4odGV4dCk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuUklHSFQgPSBmdW5jdGlvbih0ZXh0LCBudW1iZXIpIHtcclxuICAgICAgICBudW1iZXIgPSAobnVtYmVyID09PSB1bmRlZmluZWQpID8gMSA6IG51bWJlcjtcclxuICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgIGlmIChudW1iZXIgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGV4dCA/IHRleHQuc3Vic3RyaW5nKHRleHQubGVuZ3RoIC0gbnVtYmVyKSA6IG51bGw7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuU0VBUkNIID0gZnVuY3Rpb24oZmluZF90ZXh0LCB3aXRoaW5fdGV4dCwgcG9zaXRpb24pIHtcclxuICAgICAgICB2YXIgZm91bmRBdDtcclxuICAgICAgICBpZiAodHlwZW9mIGZpbmRfdGV4dCAhPT0gJ3N0cmluZycgfHwgdHlwZW9mIHdpdGhpbl90ZXh0ICE9PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHBvc2l0aW9uID0gKHBvc2l0aW9uID09PSB1bmRlZmluZWQpID8gMCA6IHBvc2l0aW9uO1xyXG4gICAgICAgIGZvdW5kQXQgPSB3aXRoaW5fdGV4dC50b0xvd2VyQ2FzZSgpLmluZGV4T2YoZmluZF90ZXh0LnRvTG93ZXJDYXNlKCksIHBvc2l0aW9uIC0gMSkrMTtcclxuICAgICAgICByZXR1cm4gKGZvdW5kQXQgPT09IDApP2Vycm9yLnZhbHVlOmZvdW5kQXQ7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuU1BMSVQgPSBmdW5jdGlvbiAodGV4dCwgc2VwYXJhdG9yKSB7XHJcbiAgICAgICAgcmV0dXJuIHRleHQuc3BsaXQoc2VwYXJhdG9yKTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5TVUJTVElUVVRFID0gZnVuY3Rpb24odGV4dCwgb2xkX3RleHQsIG5ld190ZXh0LCBvY2N1cnJlbmNlKSB7XHJcbiAgICAgICAgaWYgKCF0ZXh0IHx8ICFvbGRfdGV4dCB8fCAhbmV3X3RleHQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRleHQ7XHJcbiAgICAgICAgfSBlbHNlIGlmIChvY2N1cnJlbmNlID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRleHQucmVwbGFjZShuZXcgUmVnRXhwKG9sZF90ZXh0LCAnZycpLCBuZXdfdGV4dCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdmFyIGluZGV4ID0gMDtcclxuICAgICAgICAgICAgdmFyIGkgPSAwO1xyXG4gICAgICAgICAgICB3aGlsZSAodGV4dC5pbmRleE9mKG9sZF90ZXh0LCBpbmRleCkgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBpbmRleCA9IHRleHQuaW5kZXhPZihvbGRfdGV4dCwgaW5kZXggKyAxKTtcclxuICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgICAgIGlmIChpID09PSBvY2N1cnJlbmNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRleHQuc3Vic3RyaW5nKDAsIGluZGV4KSArIG5ld190ZXh0ICsgdGV4dC5zdWJzdHJpbmcoaW5kZXggKyBvbGRfdGV4dC5sZW5ndGgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLlQgPSBmdW5jdGlvbih2YWx1ZSkge1xyXG4gICAgICAgIHJldHVybiAodHlwZW9mIHZhbHVlID09PSBcInN0cmluZ1wiKSA/IHZhbHVlIDogJyc7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuVEVYVCA9IG51bGw7XHJcblxyXG4gICAgZXhwb3J0cy5UUklNID0gZnVuY3Rpb24odGV4dCkge1xyXG4gICAgICAgIGlmICh0eXBlb2YgdGV4dCAhPT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGV4dC5yZXBsYWNlKC8gKy9nLCAnICcpLnRyaW0oKTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5VTklDSEFSID0gZXhwb3J0cy5DSEFSO1xyXG5cclxuICAgIGV4cG9ydHMuVU5JQ09ERSA9IGV4cG9ydHMuQ09ERTtcclxuXHJcbiAgICBleHBvcnRzLlVQUEVSID0gZnVuY3Rpb24odGV4dCkge1xyXG4gICAgICAgIGlmICh0eXBlb2YgdGV4dCAhPT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGV4dC50b1VwcGVyQ2FzZSgpO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLlZBTFVFID0gbnVsbDtcclxuXHJcbiAgICByZXR1cm4gZXhwb3J0cztcclxufSkoKTtcclxuXHJcbmpleGNlbC5tZXRob2RzLnN0YXRzID0gKGZ1bmN0aW9uKCkge1xyXG4gICAgdmFyIGV4cG9ydHMgPSB7fTtcclxuXHJcbiAgICB2YXIgU1FSVDJQSSA9IDIuNTA2NjI4Mjc0NjMxMDAwMjtcclxuXHJcbiAgICBleHBvcnRzLkFWRURFViA9IG51bGw7XHJcblxyXG4gICAgZXhwb3J0cy5BVkVSQUdFID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIHJhbmdlID0gdXRpbHMubnVtYmVycyh1dGlscy5mbGF0dGVuKGFyZ3VtZW50cykpO1xyXG4gICAgICAgIHZhciBuID0gcmFuZ2UubGVuZ3RoO1xyXG4gICAgICAgIHZhciBzdW0gPSAwO1xyXG4gICAgICAgIHZhciBjb3VudCA9IDA7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuOyBpKyspIHtcclxuICAgICAgICAgICAgc3VtICs9IHJhbmdlW2ldO1xyXG4gICAgICAgICAgICBjb3VudCArPSAxO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gc3VtIC8gY291bnQ7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuQVZFUkFHRUEgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgcmFuZ2UgPSB1dGlscy5mbGF0dGVuKGFyZ3VtZW50cyk7XHJcbiAgICAgICAgdmFyIG4gPSByYW5nZS5sZW5ndGg7XHJcbiAgICAgICAgdmFyIHN1bSA9IDA7XHJcbiAgICAgICAgdmFyIGNvdW50ID0gMDtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG47IGkrKykge1xyXG4gICAgICAgICAgICB2YXIgZWwgPSByYW5nZVtpXTtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBlbCA9PT0gJ251bWJlcicpIHtcclxuICAgICAgICAgICAgICAgIHN1bSArPSBlbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoZWwgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgIHN1bSsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChlbCAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgY291bnQrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gc3VtIC8gY291bnQ7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuQVZFUkFHRUlGID0gZnVuY3Rpb24ocmFuZ2UsIGNyaXRlcmlhLCBhdmVyYWdlX3JhbmdlKSB7XHJcbiAgICAgICAgYXZlcmFnZV9yYW5nZSA9IGF2ZXJhZ2VfcmFuZ2UgfHwgcmFuZ2U7XHJcbiAgICAgICAgcmFuZ2UgPSB1dGlscy5mbGF0dGVuKHJhbmdlKTtcclxuICAgICAgICBhdmVyYWdlX3JhbmdlID0gdXRpbHMucGFyc2VOdW1iZXJBcnJheSh1dGlscy5mbGF0dGVuKGF2ZXJhZ2VfcmFuZ2UpKTtcclxuICAgICAgICBpZiAoYXZlcmFnZV9yYW5nZSBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBhdmVyYWdlX3JhbmdlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgYXZlcmFnZV9jb3VudCA9IDA7XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IDA7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByYW5nZS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBpZiAoZXZhbChyYW5nZVtpXSArIGNyaXRlcmlhKSkgeyAvLyBqc2hpbnQgaWdub3JlOmxpbmVcclxuICAgICAgICAgICAgICAgIHJlc3VsdCArPSBhdmVyYWdlX3JhbmdlW2ldO1xyXG4gICAgICAgICAgICAgICAgYXZlcmFnZV9jb3VudCsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHQgLyBhdmVyYWdlX2NvdW50O1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLkFWRVJBR0VJRlMgPSBudWxsO1xyXG5cclxuICAgIGV4cG9ydHMuQ09VTlQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gdXRpbHMubnVtYmVycyh1dGlscy5mbGF0dGVuKGFyZ3VtZW50cykpLmxlbmd0aDtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5DT1VOVEEgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgcmFuZ2UgPSB1dGlscy5mbGF0dGVuKGFyZ3VtZW50cyk7XHJcbiAgICAgICAgcmV0dXJuIHJhbmdlLmxlbmd0aCAtIGV4cG9ydHMuQ09VTlRCTEFOSyhyYW5nZSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuQ09VTlRJTiA9IGZ1bmN0aW9uIChyYW5nZSwgdmFsdWUpIHtcclxuICAgICAgICB2YXIgcmVzdWx0ID0gMDtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJhbmdlLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmIChyYW5nZVtpXSA9PT0gdmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuQ09VTlRCTEFOSyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciByYW5nZSA9IHV0aWxzLmZsYXR0ZW4oYXJndW1lbnRzKTtcclxuICAgICAgICB2YXIgYmxhbmtzID0gMDtcclxuICAgICAgICB2YXIgZWxlbWVudDtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJhbmdlLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGVsZW1lbnQgPSByYW5nZVtpXTtcclxuICAgICAgICAgICAgaWYgKGVsZW1lbnQgPT09IG51bGwgfHwgZWxlbWVudCA9PT0gJycpIHtcclxuICAgICAgICAgICAgICAgIGJsYW5rcysrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBibGFua3M7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuQ09VTlRJRiA9IGZ1bmN0aW9uKHJhbmdlLCBjcml0ZXJpYSkge1xyXG4gICAgICAgIHJhbmdlID0gdXRpbHMuZmxhdHRlbihyYW5nZSk7XHJcbiAgICAgICAgaWYgKCEvWzw+PSFdLy50ZXN0KGNyaXRlcmlhKSkge1xyXG4gICAgICAgICAgICBjcml0ZXJpYSA9ICc9PVwiJyArIGNyaXRlcmlhICsgJ1wiJztcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIG1hdGNoZXMgPSAwO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmFuZ2UubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiByYW5nZVtpXSAhPT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgIGlmIChldmFsKHJhbmdlW2ldICsgY3JpdGVyaWEpKSB7IC8vIGpzaGludCBpZ25vcmU6bGluZVxyXG4gICAgICAgICAgICAgICAgICAgIG1hdGNoZXMrKztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChldmFsKCdcIicgKyByYW5nZVtpXSArICdcIicgKyBjcml0ZXJpYSkpIHsgLy8ganNoaW50IGlnbm9yZTpsaW5lXHJcbiAgICAgICAgICAgICAgICAgICAgbWF0Y2hlcysrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBtYXRjaGVzO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLkNPVU5USUZTID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIGFyZ3MgPSB1dGlscy5hcmdzVG9BcnJheShhcmd1bWVudHMpO1xyXG4gICAgICAgIHZhciByZXN1bHRzID0gbmV3IEFycmF5KHV0aWxzLmZsYXR0ZW4oYXJnc1swXSkubGVuZ3RoKTtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJlc3VsdHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgcmVzdWx0c1tpXSA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsgaSArPSAyKSB7XHJcbiAgICAgICAgICAgIHZhciByYW5nZSA9IHV0aWxzLmZsYXR0ZW4oYXJnc1tpXSk7XHJcbiAgICAgICAgICAgIHZhciBjcml0ZXJpYSA9IGFyZ3NbaSArIDFdO1xyXG4gICAgICAgICAgICBpZiAoIS9bPD49IV0vLnRlc3QoY3JpdGVyaWEpKSB7XHJcbiAgICAgICAgICAgICAgICBjcml0ZXJpYSA9ICc9PVwiJyArIGNyaXRlcmlhICsgJ1wiJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHJhbmdlLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHJhbmdlW2pdICE9PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdHNbal0gPSByZXN1bHRzW2pdICYmIGV2YWwocmFuZ2Vbal0gKyBjcml0ZXJpYSk7IC8vIGpzaGludCBpZ25vcmU6bGluZVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHRzW2pdID0gcmVzdWx0c1tqXSAmJiBldmFsKCdcIicgKyByYW5nZVtqXSArICdcIicgKyBjcml0ZXJpYSk7IC8vIGpzaGludCBpZ25vcmU6bGluZVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciByZXN1bHQgPSAwO1xyXG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCByZXN1bHRzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmIChyZXN1bHRzW2ldKSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLkNPVU5UVU5JUVVFID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBVTklRVUUuYXBwbHkobnVsbCwgdXRpbHMuZmxhdHRlbihhcmd1bWVudHMpKS5sZW5ndGg7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuRklTSEVSID0gZnVuY3Rpb24oeCkge1xyXG4gICAgICAgIHggPSB1dGlscy5wYXJzZU51bWJlcih4KTtcclxuICAgICAgICBpZiAoeCBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB4O1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gTWF0aC5sb2coKDEgKyB4KSAvICgxIC0geCkpIC8gMjtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5GSVNIRVJJTlYgPSBmdW5jdGlvbih5KSB7XHJcbiAgICAgICAgeSA9IHV0aWxzLnBhcnNlTnVtYmVyKHkpO1xyXG4gICAgICAgIGlmICh5IGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBlMnkgPSBNYXRoLmV4cCgyICogeSk7XHJcbiAgICAgICAgcmV0dXJuIChlMnkgLSAxKSAvIChlMnkgKyAxKTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5GUkVRVUVOQ1kgPSBmdW5jdGlvbihkYXRhLCBiaW5zKSB7XHJcbiAgICAgICAgZGF0YSA9IHV0aWxzLnBhcnNlTnVtYmVyQXJyYXkodXRpbHMuZmxhdHRlbihkYXRhKSk7XHJcbiAgICAgICAgYmlucyA9IHV0aWxzLnBhcnNlTnVtYmVyQXJyYXkodXRpbHMuZmxhdHRlbihiaW5zKSk7XHJcbiAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IoZGF0YSwgYmlucykpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgbiA9IGRhdGEubGVuZ3RoO1xyXG4gICAgICAgIHZhciBiID0gYmlucy5sZW5ndGg7XHJcbiAgICAgICAgdmFyIHIgPSBbXTtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8PSBiOyBpKyspIHtcclxuICAgICAgICAgICAgcltpXSA9IDA7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbjsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaSA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhW2pdIDw9IGJpbnNbMF0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgclswXSArPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaSA8IGIpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YVtqXSA+IGJpbnNbaSAtIDFdICYmIGRhdGFbal0gPD0gYmluc1tpXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByW2ldICs9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpID09PSBiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFbal0gPiBiaW5zW2IgLSAxXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByW2JdICs9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLkxBUkdFID0gZnVuY3Rpb24ocmFuZ2UsIGspIHtcclxuICAgICAgICByYW5nZSA9IHV0aWxzLnBhcnNlTnVtYmVyQXJyYXkodXRpbHMuZmxhdHRlbihyYW5nZSkpO1xyXG4gICAgICAgIGsgPSB1dGlscy5wYXJzZU51bWJlcihrKTtcclxuICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihyYW5nZSwgaykpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJhbmdlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmFuZ2Uuc29ydChmdW5jdGlvbihhLCBiKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBiIC0gYTtcclxuICAgICAgICB9KVtrIC0gMV07XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuTUFYID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIHJhbmdlID0gdXRpbHMubnVtYmVycyh1dGlscy5mbGF0dGVuKGFyZ3VtZW50cykpO1xyXG4gICAgICAgIHJldHVybiAocmFuZ2UubGVuZ3RoID09PSAwKSA/IDAgOiBNYXRoLm1heC5hcHBseShNYXRoLCByYW5nZSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuTUFYQSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciByYW5nZSA9IHV0aWxzLmFycmF5VmFsdWVzVG9OdW1iZXJzKHV0aWxzLmZsYXR0ZW4oYXJndW1lbnRzKSk7XHJcbiAgICAgICAgcmV0dXJuIChyYW5nZS5sZW5ndGggPT09IDApID8gMCA6IE1hdGgubWF4LmFwcGx5KE1hdGgsIHJhbmdlKTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5NSU4gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgcmFuZ2UgPSB1dGlscy5udW1iZXJzKHV0aWxzLmZsYXR0ZW4oYXJndW1lbnRzKSk7XHJcbiAgICAgICAgcmV0dXJuIChyYW5nZS5sZW5ndGggPT09IDApID8gMCA6IE1hdGgubWluLmFwcGx5KE1hdGgsIHJhbmdlKTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5NSU5BID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIHJhbmdlID0gdXRpbHMuYXJyYXlWYWx1ZXNUb051bWJlcnModXRpbHMuZmxhdHRlbihhcmd1bWVudHMpKTtcclxuICAgICAgICByZXR1cm4gKHJhbmdlLmxlbmd0aCA9PT0gMCkgPyAwIDogTWF0aC5taW4uYXBwbHkoTWF0aCwgcmFuZ2UpO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLk1PREUgPSB7fTtcclxuXHJcbiAgICBleHBvcnRzLk1PREUuTVVMVCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIC8vIENyZWRpdHM6IFJvw7ZuYcOkblxyXG4gICAgICAgIHZhciByYW5nZSA9IHV0aWxzLnBhcnNlTnVtYmVyQXJyYXkodXRpbHMuZmxhdHRlbihhcmd1bWVudHMpKTtcclxuICAgICAgICBpZiAocmFuZ2UgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gcmFuZ2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBuID0gcmFuZ2UubGVuZ3RoO1xyXG4gICAgICAgIHZhciBjb3VudCA9IHt9O1xyXG4gICAgICAgIHZhciBtYXhJdGVtcyA9IFtdO1xyXG4gICAgICAgIHZhciBtYXggPSAwO1xyXG4gICAgICAgIHZhciBjdXJyZW50SXRlbTtcclxuXHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuOyBpKyspIHtcclxuICAgICAgICAgICAgY3VycmVudEl0ZW0gPSByYW5nZVtpXTtcclxuICAgICAgICAgICAgY291bnRbY3VycmVudEl0ZW1dID0gY291bnRbY3VycmVudEl0ZW1dID8gY291bnRbY3VycmVudEl0ZW1dICsgMSA6IDE7XHJcbiAgICAgICAgICAgIGlmIChjb3VudFtjdXJyZW50SXRlbV0gPiBtYXgpIHtcclxuICAgICAgICAgICAgICAgIG1heCA9IGNvdW50W2N1cnJlbnRJdGVtXTtcclxuICAgICAgICAgICAgICAgIG1heEl0ZW1zID0gW107XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGNvdW50W2N1cnJlbnRJdGVtXSA9PT0gbWF4KSB7XHJcbiAgICAgICAgICAgICAgICBtYXhJdGVtc1ttYXhJdGVtcy5sZW5ndGhdID0gY3VycmVudEl0ZW07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG1heEl0ZW1zO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLk1PREUuU05HTCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciByYW5nZSA9IHV0aWxzLnBhcnNlTnVtYmVyQXJyYXkodXRpbHMuZmxhdHRlbihhcmd1bWVudHMpKTtcclxuICAgICAgICBpZiAocmFuZ2UgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gcmFuZ2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBleHBvcnRzLk1PREUuTVVMVChyYW5nZSkuc29ydChmdW5jdGlvbihhLCBiKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBhIC0gYjtcclxuICAgICAgICB9KVswXTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5QRVJDRU5USUxFID0ge307XHJcblxyXG4gICAgZXhwb3J0cy5QRVJDRU5USUxFLkVYQyA9IGZ1bmN0aW9uKGFycmF5LCBrKSB7XHJcbiAgICAgICAgYXJyYXkgPSB1dGlscy5wYXJzZU51bWJlckFycmF5KHV0aWxzLmZsYXR0ZW4oYXJyYXkpKTtcclxuICAgICAgICBrID0gdXRpbHMucGFyc2VOdW1iZXIoayk7XHJcbiAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IoYXJyYXksIGspKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgYXJyYXkgPSBhcnJheS5zb3J0KGZ1bmN0aW9uKGEsIGIpIHtcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGEgLSBiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdmFyIG4gPSBhcnJheS5sZW5ndGg7XHJcbiAgICAgICAgaWYgKGsgPCAxIC8gKG4gKyAxKSB8fCBrID4gMSAtIDEgLyAobiArIDEpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBsID0gayAqIChuICsgMSkgLSAxO1xyXG4gICAgICAgIHZhciBmbCA9IE1hdGguZmxvb3IobCk7XHJcbiAgICAgICAgcmV0dXJuIHV0aWxzLmNsZWFuRmxvYXQoKGwgPT09IGZsKSA/IGFycmF5W2xdIDogYXJyYXlbZmxdICsgKGwgLSBmbCkgKiAoYXJyYXlbZmwgKyAxXSAtIGFycmF5W2ZsXSkpO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLlBFUkNFTlRJTEUuSU5DID0gZnVuY3Rpb24oYXJyYXksIGspIHtcclxuICAgICAgICBhcnJheSA9IHV0aWxzLnBhcnNlTnVtYmVyQXJyYXkodXRpbHMuZmxhdHRlbihhcnJheSkpO1xyXG4gICAgICAgIGsgPSB1dGlscy5wYXJzZU51bWJlcihrKTtcclxuICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihhcnJheSwgaykpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBhcnJheSA9IGFycmF5LnNvcnQoZnVuY3Rpb24oYSwgYikge1xyXG4gICAgICAgICAgICByZXR1cm4gYSAtIGI7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdmFyIG4gPSBhcnJheS5sZW5ndGg7XHJcbiAgICAgICAgdmFyIGwgPSBrICogKG4gLSAxKTtcclxuICAgICAgICB2YXIgZmwgPSBNYXRoLmZsb29yKGwpO1xyXG4gICAgICAgIHJldHVybiB1dGlscy5jbGVhbkZsb2F0KChsID09PSBmbCkgPyBhcnJheVtsXSA6IGFycmF5W2ZsXSArIChsIC0gZmwpICogKGFycmF5W2ZsICsgMV0gLSBhcnJheVtmbF0pKTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5QRVJDRU5UUkFOSyA9IHt9O1xyXG5cclxuICAgIGV4cG9ydHMuUEVSQ0VOVFJBTksuRVhDID0gZnVuY3Rpb24oYXJyYXksIHgsIHNpZ25pZmljYW5jZSkge1xyXG4gICAgICAgIHNpZ25pZmljYW5jZSA9IChzaWduaWZpY2FuY2UgPT09IHVuZGVmaW5lZCkgPyAzIDogc2lnbmlmaWNhbmNlO1xyXG4gICAgICAgIGFycmF5ID0gdXRpbHMucGFyc2VOdW1iZXJBcnJheSh1dGlscy5mbGF0dGVuKGFycmF5KSk7XHJcbiAgICAgICAgeCA9IHV0aWxzLnBhcnNlTnVtYmVyKHgpO1xyXG4gICAgICAgIHNpZ25pZmljYW5jZSA9IHV0aWxzLnBhcnNlTnVtYmVyKHNpZ25pZmljYW5jZSk7XHJcbiAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IoYXJyYXksIHgsIHNpZ25pZmljYW5jZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBhcnJheSA9IGFycmF5LnNvcnQoZnVuY3Rpb24oYSwgYikge1xyXG4gICAgICAgICAgICByZXR1cm4gYSAtIGI7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdmFyIHVuaXF1ZXMgPSBVTklRVUUuYXBwbHkobnVsbCwgYXJyYXkpO1xyXG4gICAgICAgIHZhciBuID0gYXJyYXkubGVuZ3RoO1xyXG4gICAgICAgIHZhciBtID0gdW5pcXVlcy5sZW5ndGg7XHJcbiAgICAgICAgdmFyIHBvd2VyID0gTWF0aC5wb3coMTAsIHNpZ25pZmljYW5jZSk7XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IDA7XHJcbiAgICAgICAgdmFyIG1hdGNoID0gZmFsc2U7XHJcbiAgICAgICAgdmFyIGkgPSAwO1xyXG4gICAgICAgIHdoaWxlICghbWF0Y2ggJiYgaSA8IG0pIHtcclxuICAgICAgICAgICAgaWYgKHggPT09IHVuaXF1ZXNbaV0pIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IChhcnJheS5pbmRleE9mKHVuaXF1ZXNbaV0pICsgMSkgLyAobiArIDEpO1xyXG4gICAgICAgICAgICAgICAgbWF0Y2ggPSB0cnVlO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHggPj0gdW5pcXVlc1tpXSAmJiAoeCA8IHVuaXF1ZXNbaSArIDFdIHx8IGkgPT09IG0gLSAxKSkge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gKGFycmF5LmluZGV4T2YodW5pcXVlc1tpXSkgKyAxICsgKHggLSB1bmlxdWVzW2ldKSAvICh1bmlxdWVzW2kgKyAxXSAtIHVuaXF1ZXNbaV0pKSAvIChuICsgMSk7XHJcbiAgICAgICAgICAgICAgICBtYXRjaCA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihyZXN1bHQgKiBwb3dlcikgLyBwb3dlcjtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5QRVJDRU5UUkFOSy5JTkMgPSBmdW5jdGlvbihhcnJheSwgeCwgc2lnbmlmaWNhbmNlKSB7XHJcbiAgICAgICAgc2lnbmlmaWNhbmNlID0gKHNpZ25pZmljYW5jZSA9PT0gdW5kZWZpbmVkKSA/IDMgOiBzaWduaWZpY2FuY2U7XHJcbiAgICAgICAgYXJyYXkgPSB1dGlscy5wYXJzZU51bWJlckFycmF5KHV0aWxzLmZsYXR0ZW4oYXJyYXkpKTtcclxuICAgICAgICB4ID0gdXRpbHMucGFyc2VOdW1iZXIoeCk7XHJcbiAgICAgICAgc2lnbmlmaWNhbmNlID0gdXRpbHMucGFyc2VOdW1iZXIoc2lnbmlmaWNhbmNlKTtcclxuICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihhcnJheSwgeCwgc2lnbmlmaWNhbmNlKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGFycmF5ID0gYXJyYXkuc29ydChmdW5jdGlvbihhLCBiKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBhIC0gYjtcclxuICAgICAgICB9KTtcclxuICAgICAgICB2YXIgdW5pcXVlcyA9IFVOSVFVRS5hcHBseShudWxsLCBhcnJheSk7XHJcbiAgICAgICAgdmFyIG4gPSBhcnJheS5sZW5ndGg7XHJcbiAgICAgICAgdmFyIG0gPSB1bmlxdWVzLmxlbmd0aDtcclxuICAgICAgICB2YXIgcG93ZXIgPSBNYXRoLnBvdygxMCwgc2lnbmlmaWNhbmNlKTtcclxuICAgICAgICB2YXIgcmVzdWx0ID0gMDtcclxuICAgICAgICB2YXIgbWF0Y2ggPSBmYWxzZTtcclxuICAgICAgICB2YXIgaSA9IDA7XHJcbiAgICAgICAgd2hpbGUgKCFtYXRjaCAmJiBpIDwgbSkge1xyXG4gICAgICAgICAgICBpZiAoeCA9PT0gdW5pcXVlc1tpXSkge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gYXJyYXkuaW5kZXhPZih1bmlxdWVzW2ldKSAvIChuIC0gMSk7XHJcbiAgICAgICAgICAgICAgICBtYXRjaCA9IHRydWU7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoeCA+PSB1bmlxdWVzW2ldICYmICh4IDwgdW5pcXVlc1tpICsgMV0gfHwgaSA9PT0gbSAtIDEpKSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQgPSAoYXJyYXkuaW5kZXhPZih1bmlxdWVzW2ldKSArICh4IC0gdW5pcXVlc1tpXSkgLyAodW5pcXVlc1tpICsgMV0gLSB1bmlxdWVzW2ldKSkgLyAobiAtIDEpO1xyXG4gICAgICAgICAgICAgICAgbWF0Y2ggPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGkrKztcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IocmVzdWx0ICogcG93ZXIpIC8gcG93ZXI7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuUEVSTVVUID0gZnVuY3Rpb24obnVtYmVyLCBudW1iZXJfY2hvc2VuKSB7XHJcbiAgICAgICAgbnVtYmVyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKTtcclxuICAgICAgICBudW1iZXJfY2hvc2VuID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyX2Nob3Nlbik7XHJcbiAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IobnVtYmVyLCBudW1iZXJfY2hvc2VuKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBGQUNUKG51bWJlcikgLyBGQUNUKG51bWJlciAtIG51bWJlcl9jaG9zZW4pO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLlBFUk1VVEFUSU9OQSA9IGZ1bmN0aW9uKG51bWJlciwgbnVtYmVyX2Nob3Nlbikge1xyXG4gICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgbnVtYmVyX2Nob3NlbiA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcl9jaG9zZW4pO1xyXG4gICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKG51bWJlciwgbnVtYmVyX2Nob3NlbikpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gTWF0aC5wb3cobnVtYmVyLCBudW1iZXJfY2hvc2VuKTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5QSEkgPSBmdW5jdGlvbih4KSB7XHJcbiAgICAgICAgeCA9IHV0aWxzLnBhcnNlTnVtYmVyKHgpO1xyXG4gICAgICAgIGlmICh4IGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gTWF0aC5leHAoLTAuNSAqIHggKiB4KSAvIFNRUlQyUEk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuUFJPQiA9IGZ1bmN0aW9uKHJhbmdlLCBwcm9iYWJpbGl0eSwgbG93ZXIsIHVwcGVyKSB7XHJcbiAgICAgICAgaWYgKGxvd2VyID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHVwcGVyID0gKHVwcGVyID09PSB1bmRlZmluZWQpID8gbG93ZXIgOiB1cHBlcjtcclxuXHJcbiAgICAgICAgcmFuZ2UgPSB1dGlscy5wYXJzZU51bWJlckFycmF5KHV0aWxzLmZsYXR0ZW4ocmFuZ2UpKTtcclxuICAgICAgICBwcm9iYWJpbGl0eSA9IHV0aWxzLnBhcnNlTnVtYmVyQXJyYXkodXRpbHMuZmxhdHRlbihwcm9iYWJpbGl0eSkpO1xyXG4gICAgICAgIGxvd2VyID0gdXRpbHMucGFyc2VOdW1iZXIobG93ZXIpO1xyXG4gICAgICAgIHVwcGVyID0gdXRpbHMucGFyc2VOdW1iZXIodXBwZXIpO1xyXG4gICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKHJhbmdlLCBwcm9iYWJpbGl0eSwgbG93ZXIsIHVwcGVyKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAobG93ZXIgPT09IHVwcGVyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAocmFuZ2UuaW5kZXhPZihsb3dlcikgPj0gMCkgPyBwcm9iYWJpbGl0eVtyYW5nZS5pbmRleE9mKGxvd2VyKV0gOiAwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIHNvcnRlZCA9IHJhbmdlLnNvcnQoZnVuY3Rpb24oYSwgYikge1xyXG4gICAgICAgICAgICByZXR1cm4gYSAtIGI7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdmFyIG4gPSBzb3J0ZWQubGVuZ3RoO1xyXG4gICAgICAgIHZhciByZXN1bHQgPSAwO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbjsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmIChzb3J0ZWRbaV0gPj0gbG93ZXIgJiYgc29ydGVkW2ldIDw9IHVwcGVyKSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQgKz0gcHJvYmFiaWxpdHlbcmFuZ2UuaW5kZXhPZihzb3J0ZWRbaV0pXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLlFVQVJUSUxFID0ge307XHJcblxyXG4gICAgZXhwb3J0cy5RVUFSVElMRS5FWEMgPSBmdW5jdGlvbihyYW5nZSwgcXVhcnQpIHtcclxuICAgICAgICByYW5nZSA9IHV0aWxzLnBhcnNlTnVtYmVyQXJyYXkodXRpbHMuZmxhdHRlbihyYW5nZSkpO1xyXG4gICAgICAgIHF1YXJ0ID0gdXRpbHMucGFyc2VOdW1iZXIocXVhcnQpO1xyXG4gICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKHJhbmdlLCBxdWFydCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBzd2l0Y2ggKHF1YXJ0KSB7XHJcbiAgICAgICAgICAgIGNhc2UgMTpcclxuICAgICAgICAgICAgICAgIHJldHVybiBleHBvcnRzLlBFUkNFTlRJTEUuRVhDKHJhbmdlLCAwLjI1KTtcclxuICAgICAgICAgICAgY2FzZSAyOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGV4cG9ydHMuUEVSQ0VOVElMRS5FWEMocmFuZ2UsIDAuNSk7XHJcbiAgICAgICAgICAgIGNhc2UgMzpcclxuICAgICAgICAgICAgICAgIHJldHVybiBleHBvcnRzLlBFUkNFTlRJTEUuRVhDKHJhbmdlLCAwLjc1KTtcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLlFVQVJUSUxFLklOQyA9IGZ1bmN0aW9uKHJhbmdlLCBxdWFydCkge1xyXG4gICAgICAgIHJhbmdlID0gdXRpbHMucGFyc2VOdW1iZXJBcnJheSh1dGlscy5mbGF0dGVuKHJhbmdlKSk7XHJcbiAgICAgICAgcXVhcnQgPSB1dGlscy5wYXJzZU51bWJlcihxdWFydCk7XHJcbiAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IocmFuZ2UsIHF1YXJ0KSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHN3aXRjaCAocXVhcnQpIHtcclxuICAgICAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGV4cG9ydHMuUEVSQ0VOVElMRS5JTkMocmFuZ2UsIDAuMjUpO1xyXG4gICAgICAgICAgICBjYXNlIDI6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXhwb3J0cy5QRVJDRU5USUxFLklOQyhyYW5nZSwgMC41KTtcclxuICAgICAgICAgICAgY2FzZSAzOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGV4cG9ydHMuUEVSQ0VOVElMRS5JTkMocmFuZ2UsIDAuNzUpO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuUkFOSyA9IHt9O1xyXG5cclxuICAgIGV4cG9ydHMuUkFOSy5BVkcgPSBmdW5jdGlvbihudW1iZXIsIHJhbmdlLCBvcmRlcikge1xyXG4gICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgcmFuZ2UgPSB1dGlscy5wYXJzZU51bWJlckFycmF5KHV0aWxzLmZsYXR0ZW4ocmFuZ2UpKTtcclxuICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihudW1iZXIsIHJhbmdlKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJhbmdlID0gdXRpbHMuZmxhdHRlbihyYW5nZSk7XHJcbiAgICAgICAgb3JkZXIgPSBvcmRlciB8fCBmYWxzZTtcclxuICAgICAgICB2YXIgc29ydCA9IChvcmRlcikgPyBmdW5jdGlvbihhLCBiKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBhIC0gYjtcclxuICAgICAgICB9IDogZnVuY3Rpb24oYSwgYikge1xyXG4gICAgICAgICAgICByZXR1cm4gYiAtIGE7XHJcbiAgICAgICAgfTtcclxuICAgICAgICByYW5nZSA9IHJhbmdlLnNvcnQoc29ydCk7XHJcblxyXG4gICAgICAgIHZhciBsZW5ndGggPSByYW5nZS5sZW5ndGg7XHJcbiAgICAgICAgdmFyIGNvdW50ID0gMDtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmIChyYW5nZVtpXSA9PT0gbnVtYmVyKSB7XHJcbiAgICAgICAgICAgICAgICBjb3VudCsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gKGNvdW50ID4gMSkgPyAoMiAqIHJhbmdlLmluZGV4T2YobnVtYmVyKSArIGNvdW50ICsgMSkgLyAyIDogcmFuZ2UuaW5kZXhPZihudW1iZXIpICsgMTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5SQU5LLkVRID0gZnVuY3Rpb24obnVtYmVyLCByYW5nZSwgb3JkZXIpIHtcclxuICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgIHJhbmdlID0gdXRpbHMucGFyc2VOdW1iZXJBcnJheSh1dGlscy5mbGF0dGVuKHJhbmdlKSk7XHJcbiAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IobnVtYmVyLCByYW5nZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBvcmRlciA9IG9yZGVyIHx8IGZhbHNlO1xyXG4gICAgICAgIHZhciBzb3J0ID0gKG9yZGVyKSA/IGZ1bmN0aW9uKGEsIGIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGEgLSBiO1xyXG4gICAgICAgIH0gOiBmdW5jdGlvbihhLCBiKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBiIC0gYTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJhbmdlID0gcmFuZ2Uuc29ydChzb3J0KTtcclxuICAgICAgICByZXR1cm4gcmFuZ2UuaW5kZXhPZihudW1iZXIpICsgMTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5SU1EgPSBmdW5jdGlvbihkYXRhX3gsIGRhdGFfeSkgeyAvLyBubyBuZWVkIHRvIGZsYXR0ZW4gaGVyZSwgUEVBUlNPTiB3aWxsIHRha2UgY2FyZSBvZiB0aGF0XHJcbiAgICAgICAgZGF0YV94ID0gdXRpbHMucGFyc2VOdW1iZXJBcnJheSh1dGlscy5mbGF0dGVuKGRhdGFfeCkpO1xyXG4gICAgICAgIGRhdGFfeSA9IHV0aWxzLnBhcnNlTnVtYmVyQXJyYXkodXRpbHMuZmxhdHRlbihkYXRhX3kpKTtcclxuICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihkYXRhX3gsIGRhdGFfeSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gTWF0aC5wb3coZXhwb3J0cy5QRUFSU09OKGRhdGFfeCwgZGF0YV95KSwgMik7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuU01BTEwgPSBmdW5jdGlvbihyYW5nZSwgaykge1xyXG4gICAgICAgIHJhbmdlID0gdXRpbHMucGFyc2VOdW1iZXJBcnJheSh1dGlscy5mbGF0dGVuKHJhbmdlKSk7XHJcbiAgICAgICAgayA9IHV0aWxzLnBhcnNlTnVtYmVyKGspO1xyXG4gICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKHJhbmdlLCBrKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmFuZ2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByYW5nZS5zb3J0KGZ1bmN0aW9uKGEsIGIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGEgLSBiO1xyXG4gICAgICAgIH0pW2sgLSAxXTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5TVEFOREFSRElaRSA9IGZ1bmN0aW9uKHgsIG1lYW4sIHNkKSB7XHJcbiAgICAgICAgeCA9IHV0aWxzLnBhcnNlTnVtYmVyKHgpO1xyXG4gICAgICAgIG1lYW4gPSB1dGlscy5wYXJzZU51bWJlcihtZWFuKTtcclxuICAgICAgICBzZCA9IHV0aWxzLnBhcnNlTnVtYmVyKHNkKTtcclxuICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcih4LCBtZWFuLCBzZCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gKHggLSBtZWFuKSAvIHNkO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLlNUREVWID0ge307XHJcblxyXG4gICAgZXhwb3J0cy5TVERFVi5QID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIHYgPSBleHBvcnRzLlZBUi5QLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcbiAgICAgICAgcmV0dXJuIE1hdGguc3FydCh2KTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5TVERFVi5TID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIHYgPSBleHBvcnRzLlZBUi5TLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcbiAgICAgICAgcmV0dXJuIE1hdGguc3FydCh2KTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5TVERFVkEgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgdiA9IGV4cG9ydHMuVkFSQS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG4gICAgICAgIHJldHVybiBNYXRoLnNxcnQodik7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuU1RERVZQQSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciB2ID0gZXhwb3J0cy5WQVJQQS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG4gICAgICAgIHJldHVybiBNYXRoLnNxcnQodik7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuVkFSID0ge307XHJcblxyXG4gICAgZXhwb3J0cy5WQVIuUCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciByYW5nZSA9IHV0aWxzLm51bWJlcnModXRpbHMuZmxhdHRlbihhcmd1bWVudHMpKTtcclxuICAgICAgICB2YXIgbiA9IHJhbmdlLmxlbmd0aDtcclxuICAgICAgICB2YXIgc2lnbWEgPSAwO1xyXG4gICAgICAgIHZhciBtZWFuID0gZXhwb3J0cy5BVkVSQUdFKHJhbmdlKTtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG47IGkrKykge1xyXG4gICAgICAgICAgICBzaWdtYSArPSBNYXRoLnBvdyhyYW5nZVtpXSAtIG1lYW4sIDIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gc2lnbWEgLyBuO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLlZBUi5TID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIHJhbmdlID0gdXRpbHMubnVtYmVycyh1dGlscy5mbGF0dGVuKGFyZ3VtZW50cykpO1xyXG4gICAgICAgIHZhciBuID0gcmFuZ2UubGVuZ3RoO1xyXG4gICAgICAgIHZhciBzaWdtYSA9IDA7XHJcbiAgICAgICAgdmFyIG1lYW4gPSBleHBvcnRzLkFWRVJBR0UocmFuZ2UpO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbjsgaSsrKSB7XHJcbiAgICAgICAgICAgIHNpZ21hICs9IE1hdGgucG93KHJhbmdlW2ldIC0gbWVhbiwgMik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBzaWdtYSAvIChuIC0gMSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuVkFSQSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciByYW5nZSA9IHV0aWxzLmZsYXR0ZW4oYXJndW1lbnRzKTtcclxuICAgICAgICB2YXIgbiA9IHJhbmdlLmxlbmd0aDtcclxuICAgICAgICB2YXIgc2lnbWEgPSAwO1xyXG4gICAgICAgIHZhciBjb3VudCA9IDA7XHJcbiAgICAgICAgdmFyIG1lYW4gPSBleHBvcnRzLkFWRVJBR0VBKHJhbmdlKTtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG47IGkrKykge1xyXG4gICAgICAgICAgICB2YXIgZWwgPSByYW5nZVtpXTtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBlbCA9PT0gJ251bWJlcicpIHtcclxuICAgICAgICAgICAgICAgIHNpZ21hICs9IE1hdGgucG93KGVsIC0gbWVhbiwgMik7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZWwgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgIHNpZ21hICs9IE1hdGgucG93KDEgLSBtZWFuLCAyKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHNpZ21hICs9IE1hdGgucG93KDAgLSBtZWFuLCAyKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGVsICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBjb3VudCsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBzaWdtYSAvIChjb3VudCAtIDEpO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLlZBUlBBID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIHJhbmdlID0gdXRpbHMuZmxhdHRlbihhcmd1bWVudHMpO1xyXG4gICAgICAgIHZhciBuID0gcmFuZ2UubGVuZ3RoO1xyXG4gICAgICAgIHZhciBzaWdtYSA9IDA7XHJcbiAgICAgICAgdmFyIGNvdW50ID0gMDtcclxuICAgICAgICB2YXIgbWVhbiA9IGV4cG9ydHMuQVZFUkFHRUEocmFuZ2UpO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbjsgaSsrKSB7XHJcbiAgICAgICAgICAgIHZhciBlbCA9IHJhbmdlW2ldO1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIGVsID09PSAnbnVtYmVyJykge1xyXG4gICAgICAgICAgICAgICAgc2lnbWEgKz0gTWF0aC5wb3coZWwgLSBtZWFuLCAyKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChlbCA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgc2lnbWEgKz0gTWF0aC5wb3coMSAtIG1lYW4sIDIpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc2lnbWEgKz0gTWF0aC5wb3coMCAtIG1lYW4sIDIpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoZWwgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIGNvdW50Kys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHNpZ21hIC8gY291bnQ7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMuV0VJQlVMTCA9IHt9O1xyXG5cclxuICAgIGV4cG9ydHMuV0VJQlVMTC5ESVNUID0gZnVuY3Rpb24oeCwgYWxwaGEsIGJldGEsIGN1bXVsYXRpdmUpIHtcclxuICAgICAgICB4ID0gdXRpbHMucGFyc2VOdW1iZXIoeCk7XHJcbiAgICAgICAgYWxwaGEgPSB1dGlscy5wYXJzZU51bWJlcihhbHBoYSk7XHJcbiAgICAgICAgYmV0YSA9IHV0aWxzLnBhcnNlTnVtYmVyKGJldGEpO1xyXG4gICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKHgsIGFscGhhLCBiZXRhKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiAoY3VtdWxhdGl2ZSkgPyAxIC0gTWF0aC5leHAoLU1hdGgucG93KHggLyBiZXRhLCBhbHBoYSkpIDogTWF0aC5wb3coeCwgYWxwaGEgLSAxKSAqIE1hdGguZXhwKC1NYXRoLnBvdyh4IC8gYmV0YSwgYWxwaGEpKSAqIGFscGhhIC8gTWF0aC5wb3coYmV0YSwgYWxwaGEpO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnRzLlogPSB7fTtcclxuXHJcbiAgICBleHBvcnRzLlouVEVTVCA9IGZ1bmN0aW9uKHJhbmdlLCB4LCBzZCkge1xyXG4gICAgICAgIHJhbmdlID0gdXRpbHMucGFyc2VOdW1iZXJBcnJheSh1dGlscy5mbGF0dGVuKHJhbmdlKSk7XHJcbiAgICAgICAgeCA9IHV0aWxzLnBhcnNlTnVtYmVyKHgpO1xyXG4gICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKHJhbmdlLCB4KSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzZCA9IHNkIHx8IGV4cG9ydHMuU1RERVYuUyhyYW5nZSk7XHJcbiAgICAgICAgdmFyIG4gPSByYW5nZS5sZW5ndGg7XHJcbiAgICAgICAgcmV0dXJuIDEgLSBleHBvcnRzLk5PUk0uUy5ESVNUKChleHBvcnRzLkFWRVJBR0UocmFuZ2UpIC0geCkgLyAoc2QgLyBNYXRoLnNxcnQobikpLCB0cnVlKTtcclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIGV4cG9ydHM7XHJcbn0pKCk7XHJcblxyXG5mb3IgKHZhciBpID0gMDsgaSA8IE9iamVjdC5rZXlzKGpleGNlbC5tZXRob2RzKS5sZW5ndGg7IGkrKykge1xyXG4gICAgdmFyIG1ldGhvZHMgPSBqZXhjZWwubWV0aG9kc1tPYmplY3Qua2V5cyhqZXhjZWwubWV0aG9kcylbaV1dO1xyXG4gICAgZm9yICh2YXIgaiA9IDA7IGogPCBPYmplY3Qua2V5cyhtZXRob2RzKS5sZW5ndGg7IGorKykge1xyXG4gICAgICAgIGlmICh0eXBlb2YobWV0aG9kc1tPYmplY3Qua2V5cyhtZXRob2RzKVtqXV0pID09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgd2luZG93W09iamVjdC5rZXlzKG1ldGhvZHMpW2pdXSA9IG1ldGhvZHNbT2JqZWN0LmtleXMobWV0aG9kcylbal1dO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHdpbmRvd1tPYmplY3Qua2V5cyhtZXRob2RzKVtqXV0gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3Qua2V5cyhtZXRob2RzKVtqXSArICdOb3QgaW1wbGVtZW50ZWQnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5cclxuXHJcblxyXG4gICAgcmV0dXJuIGpleGNlbDtcclxuXHJcbn0pKSk7IiwiXHJcbi8qKlxyXG4gKiAoYykgalN1aXRlcyBKYXZhc2NyaXB0IFdlYiBDb21wb25lbnRzICh2Mi44KVxyXG4gKlxyXG4gKiBBdXRob3I6IFBhdWwgSG9kZWwgPHBhdWwuaG9kZWxAZ21haWwuY29tPlxyXG4gKiBXZWJzaXRlOiBodHRwczovL2Jvc3Nhbm92YS51ay9qc3VpdGVzL1xyXG4gKiBEZXNjcmlwdGlvbjogQ3JlYXRlIGFtYXppbmcgd2ViIGJhc2VkIGFwcGxpY2F0aW9ucy5cclxuICpcclxuICogTUlUIExpY2Vuc2VcclxuICpcclxuICovXHJcbjsoZnVuY3Rpb24gKGdsb2JhbCwgZmFjdG9yeSkge1xyXG4gICAgdHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnID8gbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCkgOlxyXG4gICAgdHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kID8gZGVmaW5lKGZhY3RvcnkpIDpcclxuICAgIGdsb2JhbC5qU3VpdGVzID0gZmFjdG9yeSgpO1xyXG59KHRoaXMsIChmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxudmFyIGpTdWl0ZXMgPSBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgdmFyIG9iaiA9IHt9XG5cbiAgICBvYmouaW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBGaW5kIHJvb3QgZWxlbWVudFxuICAgICAgICB2YXIgYXBwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmphcHAnKTtcblxuICAgICAgICAvLyBSb290IGVsZW1lbnRcbiAgICAgICAgaWYgKGFwcCkge1xuICAgICAgICAgICAgb2JqLmVsID0gYXBwO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgb2JqLmVsID0gZG9jdW1lbnQuYm9keTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIExvYWRpbmcgbW9kdWxlc1xuICAgICAgICB2YXIgbW9kdWxlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLWF1dG9sb2FkXScpO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1vZHVsZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBtID0gbW9kdWxlc1tpXS5nZXRBdHRyaWJ1dGUoJ2RhdGEtYXV0b2xvYWQnKTtcbiAgICAgICAgICAgIGlmICh0eXBlb2Yod2luZG93W21dKSA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgd2luZG93W21dKG1vZHVsZXNbaV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgb2JqLmd1aWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGd1aWQgPSAnJztcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAzMjsgaSsrKSB7XG4gICAgICAgICAgICBndWlkICs9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSoweEYpLnRvU3RyaW5nKDB4Rik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGd1aWQ7XG4gICAgfVxuXG4gICAgb2JqLmdldFdpbmRvd1dpZHRoID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciB3ID0gd2luZG93LFxuICAgICAgICBkID0gZG9jdW1lbnQsXG4gICAgICAgIGUgPSBkLmRvY3VtZW50RWxlbWVudCxcbiAgICAgICAgZyA9IGQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2JvZHknKVswXSxcbiAgICAgICAgeCA9IHcuaW5uZXJXaWR0aCB8fCBlLmNsaWVudFdpZHRoIHx8IGcuY2xpZW50V2lkdGg7XG4gICAgICAgIHJldHVybiB4O1xuICAgIH1cblxuICAgIG9iai5nZXRXaW5kb3dIZWlnaHQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHcgPSB3aW5kb3csXG4gICAgICAgIGQgPSBkb2N1bWVudCxcbiAgICAgICAgZSA9IGQuZG9jdW1lbnRFbGVtZW50LFxuICAgICAgICBnID0gZC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYm9keScpWzBdLFxuICAgICAgICB5ID0gdy5pbm5lckhlaWdodHx8IGUuY2xpZW50SGVpZ2h0fHwgZy5jbGllbnRIZWlnaHQ7XG4gICAgICAgIHJldHVybiAgeTtcbiAgICB9XG5cbiAgICBvYmouZ2V0UG9zaXRpb24gPSBmdW5jdGlvbihlKSB7XG4gICAgICAgIGlmIChlLmNoYW5nZWRUb3VjaGVzICYmIGUuY2hhbmdlZFRvdWNoZXNbMF0pIHtcbiAgICAgICAgICAgIHZhciB4ID0gZS5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWDtcbiAgICAgICAgICAgIHZhciB5ID0gZS5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciB4ID0gKHdpbmRvdy5FdmVudCkgPyBlLnBhZ2VYIDogZS5jbGllbnRYICsgKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxMZWZ0ID8gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbExlZnQgOiBkb2N1bWVudC5ib2R5LnNjcm9sbExlZnQpO1xuICAgICAgICAgICAgdmFyIHkgPSAod2luZG93LkV2ZW50KSA/IGUucGFnZVkgOiBlLmNsaWVudFkgKyAoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCA/IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3AgOiBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gWyB4LCB5IF07XG4gICAgfVxuXG4gICAgb2JqLmNsaWNrID0gZnVuY3Rpb24oZWwpIHtcbiAgICAgICAgaWYgKGVsLmNsaWNrKSB7XG4gICAgICAgICAgICBlbC5jbGljaygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIGV2dCA9IG5ldyBNb3VzZUV2ZW50KCdjbGljaycsIHtcbiAgICAgICAgICAgICAgICBidWJibGVzOiB0cnVlLFxuICAgICAgICAgICAgICAgIGNhbmNlbGFibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgdmlldzogd2luZG93XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGVsLmRpc3BhdGNoRXZlbnQoZXZ0KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG9iai5nZXRFbGVtZW50ID0gZnVuY3Rpb24oZWxlbWVudCwgY2xhc3NOYW1lKSB7XG4gICAgICAgIHZhciBmb3VuZEVsZW1lbnQgPSBmYWxzZTtcblxuICAgICAgICBmdW5jdGlvbiBwYXRoIChlbGVtZW50KSB7XG4gICAgICAgICAgICBpZiAoZWxlbWVudC5jbGFzc05hbWUpIHtcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoY2xhc3NOYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3VuZEVsZW1lbnQgPSBlbGVtZW50O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGVsZW1lbnQucGFyZW50Tm9kZSkge1xuICAgICAgICAgICAgICAgIHBhdGgoZWxlbWVudC5wYXJlbnROb2RlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHBhdGgoZWxlbWVudCk7XG5cbiAgICAgICAgcmV0dXJuIGZvdW5kRWxlbWVudDtcbiAgICB9XG5cbiAgICBvYmouZ2V0TGlua0VsZW1lbnQgPSBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIHZhciB0YXJnZXRFbGVtZW50ID0gZmFsc2U7XG5cbiAgICAgICAgZnVuY3Rpb24gcGF0aCAoZWxlbWVudCkge1xuICAgICAgICAgICAgaWYgKChlbGVtZW50LnRhZ05hbWUgPT0gJ0EnIHx8IGVsZW1lbnQudGFnTmFtZSA9PSAnRElWJykgJiYgZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2RhdGEtaHJlZicpKSB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0RWxlbWVudCA9IGVsZW1lbnQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChlbGVtZW50LnBhcmVudE5vZGUpIHtcbiAgICAgICAgICAgICAgICBwYXRoKGVsZW1lbnQucGFyZW50Tm9kZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBwYXRoKGVsZW1lbnQpO1xuXG4gICAgICAgIHJldHVybiB0YXJnZXRFbGVtZW50O1xuICAgIH1cblxuICAgIG9iai5nZXRGb3JtRWxlbWVudHMgPSBmdW5jdGlvbihmb3JtT2JqZWN0KSB7XG4gICAgICAgIHZhciByZXQgPSB7fTtcblxuICAgICAgICBpZiAoZm9ybU9iamVjdCkge1xuICAgICAgICAgICAgdmFyIGVsZW1lbnRzID0gZm9ybU9iamVjdC5xdWVyeVNlbGVjdG9yQWxsKFwiaW5wdXQsIHNlbGVjdCwgdGV4dGFyZWFcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgZWxlbWVudHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiaW5wdXQsIHNlbGVjdCwgdGV4dGFyZWFcIik7XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IGVsZW1lbnRzW2ldO1xuICAgICAgICAgICAgdmFyIG5hbWUgPSBlbGVtZW50Lm5hbWU7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBlbGVtZW50LnZhbHVlO1xuXG4gICAgICAgICAgICBpZiAobmFtZSkge1xuICAgICAgICAgICAgICAgIHJldFtuYW1lXSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJldDtcbiAgICB9XG5cbiAgICBvYmouZXhpc3RzID0gZnVuY3Rpb24odXJsLCBfX2NhbGxiYWNrKSB7XG4gICAgICAgIHZhciBodHRwID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICAgIGh0dHAub3BlbignSEVBRCcsIHVybCwgZmFsc2UpO1xuICAgICAgICBodHRwLnNlbmQoKTtcbiAgICAgICAgaWYgKGh0dHAuc3RhdHVzKSB7XG4gICAgICAgICAgICBfX2NhbGxiYWNrKGh0dHAuc3RhdHVzKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG9iai5nZXRGaWxlcyA9IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgaWYgKCEgZWxlbWVudCkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignTm8gZWxlbWVudCBkZWZpbmVkIGluIHRoZSBhcmd1bWVudHMgb2YgeW91ciBtZXRob2QnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEdldCBhdHRhY2htZW50c1xuICAgICAgICB2YXIgZmlsZXMgPSBlbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5qZmlsZScpO1xuXG4gICAgICAgIGlmIChmaWxlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB2YXIgZGF0YSA9IFtdO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBmaWxlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciBmaWxlID0ge307XG5cbiAgICAgICAgICAgICAgICB2YXIgc3JjID0gZmlsZXNbaV0uZ2V0QXR0cmlidXRlKCdzcmMnKTtcblxuICAgICAgICAgICAgICAgIGlmIChmaWxlc1tpXS5jbGFzc0xpc3QuY29udGFpbnMoJ2pyZW1vdmUnKSkge1xuICAgICAgICAgICAgICAgICAgICBmaWxlLnJlbW92ZSA9IDE7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNyYy5zdWJzdHIoMCw0KSA9PSAnZGF0YScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUuY29udGVudCA9IHNyYy5zdWJzdHIoc3JjLmluZGV4T2YoJywnKSArIDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5leHRlbnNpb24gPSBmaWxlc1tpXS5nZXRBdHRyaWJ1dGUoJ2RhdGEtZXh0ZW5zaW9uJyk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxlLmZpbGUgPSBzcmM7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxlLmV4dGVuc2lvbiA9IGZpbGVzW2ldLmdldEF0dHJpYnV0ZSgnZGF0YS1leHRlbnNpb24nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghIGZpbGUuZXh0ZW5zaW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5leHRlbnNpb24gPSAgc3JjLnN1YnN0cihzcmMubGFzdEluZGV4T2YoJy4nKSArIDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpTdWl0ZXMuZmlsZXNbZmlsZS5maWxlXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUuY29udGVudCA9IGpTdWl0ZXMuZmlsZXNbZmlsZS5maWxlXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIE9wdGlvbmFsIGZpbGUgaW5mb3JtYXRpb25cbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVzW2ldLmdldEF0dHJpYnV0ZSgnZGF0YS1uYW1lJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUubmFtZSA9IGZpbGVzW2ldLmdldEF0dHJpYnV0ZSgnZGF0YS1uYW1lJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZXNbaV0uZ2V0QXR0cmlidXRlKCdkYXRhLWZpbGUnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5maWxlID0gZmlsZXNbaV0uZ2V0QXR0cmlidXRlKCdkYXRhLWZpbGUnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWxlc1tpXS5nZXRBdHRyaWJ1dGUoJ2RhdGEtc2l6ZScpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxlLnNpemUgPSBmaWxlc1tpXS5nZXRBdHRyaWJ1dGUoJ2RhdGEtc2l6ZScpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVzW2ldLmdldEF0dHJpYnV0ZSgnZGF0YS1kYXRlJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUuZGF0ZSA9IGZpbGVzW2ldLmdldEF0dHJpYnV0ZSgnZGF0YS1kYXRlJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZXNbaV0uZ2V0QXR0cmlidXRlKCdkYXRhLWNvdmVyJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUuY292ZXIgPSBmaWxlc1tpXS5nZXRBdHRyaWJ1dGUoJ2RhdGEtY292ZXInKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIFRPRE8gU01BTEwgdGh1bWJzP1xuXG4gICAgICAgICAgICAgICAgZGF0YVtpXSA9IGZpbGU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgb2JqLmFqYXggPSBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIGlmICghIG9wdGlvbnMuZGF0YSkge1xuICAgICAgICAgICAgb3B0aW9ucy5kYXRhID0ge307XG4gICAgICAgIH1cblxuICAgICAgICBpZiAob3B0aW9ucy50eXBlKSB7XG4gICAgICAgICAgICBvcHRpb25zLm1ldGhvZCA9IG9wdGlvbnMudHlwZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChvcHRpb25zLmRhdGEpIHtcbiAgICAgICAgICAgIHZhciBkYXRhID0gW107XG4gICAgICAgICAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9wdGlvbnMuZGF0YSk7XG5cbiAgICAgICAgICAgIGlmIChrZXlzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mKG9wdGlvbnMuZGF0YVtrZXlzW2ldXSkgPT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvID0gb3B0aW9ucy5kYXRhW2tleXNbaV1dO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBvLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZihvW2pdKSA9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnB1c2goa2V5c1tpXSArICdbJyArIGogKyAnXT0nICsgZW5jb2RlVVJJQ29tcG9uZW50KG9bal0pKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcHJvcCA9IE9iamVjdC5rZXlzKG9bal0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciB6ID0gMDsgeiA8IHByb3AubGVuZ3RoOyB6KyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEucHVzaChrZXlzW2ldICsgJ1snICsgaiArICddWycgKyBwcm9wW3pdICsgJ109JyArIGVuY29kZVVSSUNvbXBvbmVudChvW2pdW3Byb3Bbel1dKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnB1c2goa2V5c1tpXSArICc9JyArIGVuY29kZVVSSUNvbXBvbmVudChvcHRpb25zLmRhdGFba2V5c1tpXV0pKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG9wdGlvbnMubWV0aG9kID09ICdHRVQnICYmIGRhdGEubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLnVybC5pbmRleE9mKCc/JykgPCAwKSB7XG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMudXJsICs9ICc/JztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgb3B0aW9ucy51cmwgKz0gZGF0YS5qb2luKCcmJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgaHR0cFJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgICAgaHR0cFJlcXVlc3Qub3BlbihvcHRpb25zLm1ldGhvZCwgb3B0aW9ucy51cmwsIHRydWUpO1xuICAgICAgICBodHRwUmVxdWVzdC5zZXRSZXF1ZXN0SGVhZGVyKCdYLVJlcXVlc3RlZC1XaXRoJywgJ1hNTEh0dHBSZXF1ZXN0Jyk7XG5cbiAgICAgICAgaWYgKG9wdGlvbnMubWV0aG9kID09ICdQT1NUJykge1xuICAgICAgICAgICAgaHR0cFJlcXVlc3Quc2V0UmVxdWVzdEhlYWRlcignQWNjZXB0JywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcbiAgICAgICAgICAgIGh0dHBSZXF1ZXN0LnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChvcHRpb25zLmRhdGFUeXBlID09ICdqc29uJykge1xuICAgICAgICAgICAgICAgIGh0dHBSZXF1ZXN0LnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICd0ZXh0L2pzb24nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIE5vIGNhY2hlXG4gICAgICAgIGlmIChvcHRpb25zLmNhY2hlICE9IHRydWUpIHtcbiAgICAgICAgICAgIGh0dHBSZXF1ZXN0LnNldFJlcXVlc3RIZWFkZXIoJ3ByYWdtYScsICduby1jYWNoZScpO1xuICAgICAgICAgICAgaHR0cFJlcXVlc3Quc2V0UmVxdWVzdEhlYWRlcignY2FjaGUtY29udHJvbCcsICduby1jYWNoZScpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQXV0aGVudGljYXRpb25cbiAgICAgICAgaWYgKG9wdGlvbnMud2l0aENyZWRlbnRpYWxzID09IHRydWUpIHtcbiAgICAgICAgICAgIGh0dHBSZXF1ZXN0LndpdGhDcmVkZW50aWFscyA9IHRydWVcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEJlZm9yZSBzZW5kXG4gICAgICAgIGlmICh0eXBlb2Yob3B0aW9ucy5iZWZvcmVTZW5kKSA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBvcHRpb25zLmJlZm9yZVNlbmQoaHR0cFJlcXVlc3QpO1xuICAgICAgICB9XG5cbiAgICAgICAgaHR0cFJlcXVlc3Qub25sb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoaHR0cFJlcXVlc3Quc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5kYXRhVHlwZSA9PSAnanNvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBKU09OLnBhcnNlKGh0dHBSZXF1ZXN0LnJlc3BvbnNlVGV4dCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLnN1Y2Nlc3MgJiYgdHlwZW9mKG9wdGlvbnMuc3VjY2VzcykgPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuc3VjY2VzcyhyZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGNhdGNoKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuZXJyb3IgJiYgdHlwZW9mKG9wdGlvbnMuZXJyb3IpID09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmVycm9yKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gaHR0cFJlcXVlc3QucmVzcG9uc2VUZXh0O1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLnN1Y2Nlc3MgJiYgdHlwZW9mKG9wdGlvbnMuc3VjY2VzcykgPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5zdWNjZXNzKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmVycm9yICYmIHR5cGVvZihvcHRpb25zLmVycm9yKSA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZXJyb3IoaHR0cFJlcXVlc3QucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIEdsb2JhbCBjb21wbGV0ZSBtZXRob2RcbiAgICAgICAgICAgIGlmIChvYmouYWpheC5yZXF1ZXN0cyAmJiBvYmouYWpheC5yZXF1ZXN0cy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAvLyBHZXQgaW5kZXggb2YgdGhpcyByZXF1ZXN0IGluIHRoZSBjb250YWluZXJcbiAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSBvYmouYWpheC5yZXF1ZXN0cy5pbmRleE9mKGh0dHBSZXF1ZXN0KVxuICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBmcm9tIHRoZSBhamF4IHJlcXVlc3RzIGNvbnRhaW5lclxuICAgICAgICAgICAgICAgIG9iai5hamF4LnJlcXVlc3RzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICAgICAgLy8gTGFzdCBvbmU/XG4gICAgICAgICAgICAgICAgaWYgKCEgb2JqLmFqYXgucmVxdWVzdHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmNvbXBsZXRlICYmIHR5cGVvZihvcHRpb25zLmNvbXBsZXRlKSA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmNvbXBsZXRlKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgaHR0cFJlcXVlc3Quc2VuZChkYXRhLmpvaW4oJyYnKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBodHRwUmVxdWVzdC5zZW5kKCk7XG4gICAgICAgIH1cblxuICAgICAgICBvYmouYWpheC5yZXF1ZXN0cy5wdXNoKGh0dHBSZXF1ZXN0KTtcblxuICAgICAgICByZXR1cm4gaHR0cFJlcXVlc3Q7XG4gICAgfVxuXG4gICAgb2JqLmFqYXgucmVxdWVzdHMgPSBbXTtcblxuICAgIG9iai5zbGlkZUxlZnQgPSBmdW5jdGlvbihlbGVtZW50LCBkaXJlY3Rpb24sIGRvbmUpIHtcbiAgICAgICAgaWYgKGRpcmVjdGlvbiA9PSB0cnVlKSB7XG4gICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3NsaWRlLWxlZnQtaW4nKTtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdzbGlkZS1sZWZ0LWluJyk7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZihkb25lKSA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCA0MDApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdzbGlkZS1sZWZ0LW91dCcpO1xuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3NsaWRlLWxlZnQtb3V0Jyk7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZihkb25lKSA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCA0MDApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgb2JqLnNsaWRlUmlnaHQgPSBmdW5jdGlvbihlbGVtZW50LCBkaXJlY3Rpb24sIGRvbmUpIHtcbiAgICAgICAgaWYgKGRpcmVjdGlvbiA9PSB0cnVlKSB7XG4gICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3NsaWRlLXJpZ2h0LWluJyk7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnc2xpZGUtcmlnaHQtaW4nKTtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mKGRvbmUpID09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIDQwMCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3NsaWRlLXJpZ2h0LW91dCcpO1xuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3NsaWRlLXJpZ2h0LW91dCcpO1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YoZG9uZSkgPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICBkb25lKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgNDAwKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG9iai5zbGlkZVRvcCA9IGZ1bmN0aW9uKGVsZW1lbnQsIGRpcmVjdGlvbiwgZG9uZSkge1xuICAgICAgICBpZiAoZGlyZWN0aW9uID09IHRydWUpIHtcbiAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnc2xpZGUtdG9wLWluJyk7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnc2xpZGUtdG9wLWluJyk7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZihkb25lKSA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCA0MDApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdzbGlkZS10b3Atb3V0Jyk7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnc2xpZGUtdG9wLW91dCcpO1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YoZG9uZSkgPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICBkb25lKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgNDAwKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG9iai5zbGlkZUJvdHRvbSA9IGZ1bmN0aW9uKGVsZW1lbnQsIGRpcmVjdGlvbiwgZG9uZSkge1xuICAgICAgICBpZiAoZGlyZWN0aW9uID09IHRydWUpIHtcbiAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnc2xpZGUtYm90dG9tLWluJyk7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnc2xpZGUtYm90dG9tLWluJyk7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZihkb25lKSA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCA0MDApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdzbGlkZS1ib3R0b20tb3V0Jyk7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnc2xpZGUtYm90dG9tLW91dCcpO1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YoZG9uZSkgPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICBkb25lKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgMTAwKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG9iai5mYWRlSW4gPSBmdW5jdGlvbihlbGVtZW50LCBkb25lKSB7XG4gICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnZmFkZS1pbicpO1xuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdmYWRlLWluJyk7XG4gICAgICAgICAgICBpZiAodHlwZW9mKGRvbmUpID09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBkb25lKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIDIwMDApO1xuICAgIH1cblxuICAgIG9iai5mYWRlT3V0ID0gZnVuY3Rpb24oZWxlbWVudCwgZG9uZSkge1xuICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2ZhZGUtb3V0Jyk7XG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2ZhZGUtb3V0Jyk7XG4gICAgICAgICAgICBpZiAodHlwZW9mKGRvbmUpID09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBkb25lKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIDEwMDApO1xuICAgIH1cblxuICAgIG9iai5rZXlEb3duQ29udHJvbHMgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgIGlmIChlLndoaWNoID09IDI3KSB7XG4gICAgICAgICAgICB2YXIgbm9kZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuanNsaWRlcicpO1xuICAgICAgICAgICAgaWYgKG5vZGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5vZGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIG5vZGVzW2ldLnNsaWRlci5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5qZGlhbG9nJykpIHtcbiAgICAgICAgICAgICAgICBqU3VpdGVzLmRpYWxvZy5jbG9zZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGUud2hpY2ggPT0gMTMpIHtcbiAgICAgICAgICAgIGlmIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuamRpYWxvZycpKSB7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZihqU3VpdGVzLmRpYWxvZy5vcHRpb25zLm9uY29uZmlybSkgPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICBqU3VpdGVzLmRpYWxvZy5vcHRpb25zLm9uY29uZmlybSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBqU3VpdGVzLmRpYWxvZy5jbG9zZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gVmVyaWZ5IG1hc2tcbiAgICAgICAgaWYgKGpTdWl0ZXMubWFzaykge1xuICAgICAgICAgICAgalN1aXRlcy5tYXNrLmFwcGx5KGUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgdmFyIGFjdGlvblVwQ29udHJvbCA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgdmFyIGVsZW1lbnQgPSBudWxsO1xuICAgICAgICBpZiAoZWxlbWVudCA9IGpTdWl0ZXMuZ2V0TGlua0VsZW1lbnQoZS50YXJnZXQpKSB7XG4gICAgICAgICAgICB2YXIgbGluayA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLWhyZWYnKTtcbiAgICAgICAgICAgIGlmIChsaW5rID09ICcjYmFjaycpIHtcbiAgICAgICAgICAgICAgICB3aW5kb3cuaGlzdG9yeS5iYWNrKCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGxpbmsgPT0gJyNwYW5lbCcpIHtcbiAgICAgICAgICAgICAgICBqU3VpdGVzLnBhbmVsKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGpTdWl0ZXMucGFnZXMobGluayk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgY29udHJvbFN3aXBlTGVmdCA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgdmFyIGVsZW1lbnQgPSBqU3VpdGVzLmdldEVsZW1lbnQoZS50YXJnZXQsICdvcHRpb24nKTtcblxuICAgICAgICBpZiAoZWxlbWVudCAmJiBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5vcHRpb24tYWN0aW9ucycpKSB7XG4gICAgICAgICAgICBlbGVtZW50LnNjcm9sbFRvKHtcbiAgICAgICAgICAgICAgICBsZWZ0OiAxMDAsXG4gICAgICAgICAgICAgICAgYmVoYXZpb3I6ICdzbW9vdGgnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0galN1aXRlcy5nZXRFbGVtZW50KGUudGFyZ2V0LCAnamNhbGVuZGFyJyk7XG4gICAgICAgICAgICBpZiAoZWxlbWVudCAmJiBqU3VpdGVzLmNhbGVuZGFyLmN1cnJlbnQpIHtcbiAgICAgICAgICAgICAgICBqU3VpdGVzLmNhbGVuZGFyLmN1cnJlbnQucHJldigpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoalN1aXRlcy5wYW5lbCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZWxlbWVudCA9IGpTdWl0ZXMucGFuZWwuZ2V0KCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5zdHlsZS5kaXNwbGF5ICE9ICdub25lJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpTdWl0ZXMucGFuZWwuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHZhciBjb250cm9sU3dpcGVSaWdodCA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgdmFyIGVsZW1lbnQgPSBqU3VpdGVzLmdldEVsZW1lbnQoZS50YXJnZXQsICdvcHRpb24nKTtcbiAgICAgICAgaWYgKGVsZW1lbnQgJiYgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcub3B0aW9uLWFjdGlvbnMnKSkge1xuICAgICAgICAgICAgZWxlbWVudC5zY3JvbGxUbyh7XG4gICAgICAgICAgICAgICAgbGVmdDogMCxcbiAgICAgICAgICAgICAgICBiZWhhdmlvcjogJ3Ntb290aCdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBqU3VpdGVzLmdldEVsZW1lbnQoZS50YXJnZXQsICdqY2FsZW5kYXInKTtcbiAgICAgICAgICAgIGlmIChlbGVtZW50ICYmIGpTdWl0ZXMuY2FsZW5kYXIuY3VycmVudCkge1xuICAgICAgICAgICAgICAgIGpTdWl0ZXMuY2FsZW5kYXIuY3VycmVudC5uZXh0KCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChqU3VpdGVzLnBhbmVsKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlbGVtZW50ID0galN1aXRlcy5wYW5lbC5nZXQoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LnN0eWxlLmRpc3BsYXkgPT0gJ25vbmUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgalN1aXRlcy5wYW5lbCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgdmFyIGFjdGlvbk92ZXJDb250cm9sID0gZnVuY3Rpb24oZSkge1xuICAgICAgICAvLyBUb29sdGlwXG4gICAgICAgIGlmIChqU3VpdGVzLnRvb2x0aXApIHtcbiAgICAgICAgICAgIGpTdWl0ZXMudG9vbHRpcChlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHZhciBhY3Rpb25PdXRDb250cm9sID0gZnVuY3Rpb24oZSkge1xuICAgICAgICAvLyBUb29sdGlwXG4gICAgICAgIGlmIChqU3VpdGVzLnRvb2x0aXApIHtcbiAgICAgICAgICAgIGpTdWl0ZXMudG9vbHRpcC5oaWRlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgcGFnZSBjb250YWluZXJcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdzd2lwZWxlZnQnLCBjb250cm9sU3dpcGVMZWZ0KTtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdzd2lwZXJpZ2h0JywgY29udHJvbFN3aXBlUmlnaHQpO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBvYmoua2V5RG93bkNvbnRyb2xzKTtcblxuICAgIGlmICgnb250b3VjaGVuZCcgaW4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50ID09PSB0cnVlKSB7XG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgYWN0aW9uVXBDb250cm9sKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgYWN0aW9uVXBDb250cm9sKTtcbiAgICB9XG5cbiAgICAvLyBPbm1vdXNlb3ZlclxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlb3ZlcicsIGFjdGlvbk92ZXJDb250cm9sKTtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW91dCcsIGFjdGlvbk91dENvbnRyb2wpO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgb2JqLmluaXQoKTtcbiAgICB9KTtcblxuICAgIC8vIFBvcCBzdGF0ZSBjb250cm9sXG4gICAgd2luZG93Lm9ucG9wc3RhdGUgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgIGlmIChlLnN0YXRlICYmIGUuc3RhdGUucm91dGUpIHtcbiAgICAgICAgICAgIGlmIChqU3VpdGVzLnBhZ2VzLmdldChlLnN0YXRlLnJvdXRlKSkge1xuICAgICAgICAgICAgICAgIGpTdWl0ZXMucGFnZXMoZS5zdGF0ZS5yb3V0ZSwgeyBpZ25vcmVIaXN0b3J5OnRydWUgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gb2JqO1xufSgpO1xuXG5qU3VpdGVzLmZpbGVzID0gW107XHJcblxyXG5qU3VpdGVzLmNhbGVuZGFyID0gKGZ1bmN0aW9uKGVsLCBvcHRpb25zKSB7XG4gICAgdmFyIG9iaiA9IHt9O1xuICAgIG9iai5vcHRpb25zID0ge307XG5cbiAgICAvLyBHbG9iYWwgY29udGFpbmVyXG4gICAgaWYgKCEgalN1aXRlcy5jYWxlbmRhci5jdXJyZW50KSB7XG4gICAgICAgIGpTdWl0ZXMuY2FsZW5kYXIuY3VycmVudCA9IG51bGw7XG4gICAgfVxuXG4gICAgLy8gRGVmYXVsdCBjb25maWd1cmF0aW9uXG4gICAgdmFyIGRlZmF1bHRzID0ge1xuICAgICAgICAvLyBEYXRhXG4gICAgICAgIGRhdGE6IG51bGwsXG4gICAgICAgIC8vIElubGluZSBvciBub3RcbiAgICAgICAgdHlwZTogbnVsbCxcbiAgICAgICAgLy8gUmVzdHJpY3Rpb25zXG4gICAgICAgIHZhbGlkUmFuZ2U6IG51bGwsXG4gICAgICAgIC8vIFN0YXJ0aW5nIHdlZWtkYXkgLSAwIGZvciBzdW5kYXksIDYgZm9yIHNhdHVyZGF5XG4gICAgICAgIHN0YXJ0aW5nRGF5OiBudWxsLCBcbiAgICAgICAgLy8gRGF0ZSBmb3JtYXRcbiAgICAgICAgZm9ybWF0OiAnREQvTU0vWVlZWScsXG4gICAgICAgIC8vIEFsbG93IGtleWJvYXJkIGRhdGUgZW50cnlcbiAgICAgICAgcmVhZG9ubHk6IHRydWUsXG4gICAgICAgIC8vIFRvZGF5IGlzIGRlZmF1bHRcbiAgICAgICAgdG9kYXk6IGZhbHNlLFxuICAgICAgICAvLyBTaG93IHRpbWVwaWNrZXJcbiAgICAgICAgdGltZTogZmFsc2UsXG4gICAgICAgIC8vIFNob3cgdGhlIHJlc2V0IGJ1dHRvblxuICAgICAgICByZXNldEJ1dHRvbjogdHJ1ZSxcbiAgICAgICAgLy8gUGxhY2Vob2xkZXJcbiAgICAgICAgcGxhY2Vob2xkZXI6ICcnLFxuICAgICAgICAvLyBUcmFuc2xhdGlvbnMgY2FuIGJlIGRvbmUgaGVyZVxuICAgICAgICBtb250aHM6IFsnSmFuJywgJ0ZlYicsICdNYXInLCAnQXByJywgJ01heScsICdKdW4nLCAnSnVsJywgJ0F1ZycsICdTZXAnLCAnT2N0JywgJ05vdicsICdEZWMnXSxcbiAgICAgICAgd2Vla2RheXM6IFsnU3VuZGF5JywnTW9uZGF5JywnVHVlc2RheScsJ1dlZG5lc2RheScsJ1RodXJzZGF5JywnRnJpZGF5JywnU2F0dXJkYXknXSxcbiAgICAgICAgd2Vla2RheXNfc2hvcnQ6IFsnUycsICdNJywgJ1QnLCAnVycsICdUJywgJ0YnLCAnUyddLFxuICAgICAgICAvLyBWYWx1ZVxuICAgICAgICB2YWx1ZTogbnVsbCxcbiAgICAgICAgLy8gRXZlbnRzXG4gICAgICAgIG9uY2xvc2U6IG51bGwsXG4gICAgICAgIG9uY2hhbmdlOiBudWxsLFxuICAgICAgICAvLyBGdWxsc2NyZWVuICh0aGlzIGlzIGF1dG9tYXRpYyBzZXQgZm9yIHNjcmVlbnNpemUgPCA4MDApXG4gICAgICAgIGZ1bGxzY3JlZW46IGZhbHNlLFxuICAgICAgICAvLyBJbnRlcm5hbCBtb2RlIGNvbnRyb2xsZXJcbiAgICAgICAgbW9kZTogbnVsbCxcbiAgICAgICAgcG9zaXRpb246IG51bGwsXG4gICAgICAgIC8vIENyZWF0ZSB0aGUgY2FsZW5kYXIgY2xvc2VkIGFzIGRlZmF1bHRcbiAgICAgICAgb3BlbmVkOiBmYWxzZSxcbiAgICB9O1xuXG4gICAgLy8gTG9vcCB0aHJvdWdoIG91ciBvYmplY3RcbiAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBkZWZhdWx0cykge1xuICAgICAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmhhc093blByb3BlcnR5KHByb3BlcnR5KSkge1xuICAgICAgICAgICAgb2JqLm9wdGlvbnNbcHJvcGVydHldID0gb3B0aW9uc1twcm9wZXJ0eV07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBvYmoub3B0aW9uc1twcm9wZXJ0eV0gPSBkZWZhdWx0c1twcm9wZXJ0eV07XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBWYWx1ZVxuICAgIGlmICghIG9iai5vcHRpb25zLnZhbHVlKSB7XG4gICAgICAgIGlmIChlbC50YWdOYW1lID09ICdJTlBVVCcgJiYgZWwudmFsdWUpIHtcbiAgICAgICAgICAgIG9iai5vcHRpb25zLnZhbHVlID0gZWwudmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBNYWtlIHN1cmUgdXNlIHVwcGVyIGNhc2UgaW4gdGhlIGZvcm1hdFxuICAgIG9iai5vcHRpb25zLmZvcm1hdCA9IG9iai5vcHRpb25zLmZvcm1hdC50b1VwcGVyQ2FzZSgpO1xuXG4gICAgaWYgKG9iai5vcHRpb25zLnZhbHVlKSB7XG4gICAgICAgIHZhciBkYXRlID0gb2JqLm9wdGlvbnMudmFsdWUuc3BsaXQoJyAnKTtcbiAgICAgICAgdmFyIHRpbWUgPSBkYXRlWzFdO1xuICAgICAgICB2YXIgZGF0ZSA9IGRhdGVbMF0uc3BsaXQoJy0nKTtcbiAgICAgICAgdmFyIHkgPSBwYXJzZUludChkYXRlWzBdKTtcbiAgICAgICAgdmFyIG0gPSBwYXJzZUludChkYXRlWzFdKTtcbiAgICAgICAgdmFyIGQgPSBwYXJzZUludChkYXRlWzJdKTtcblxuICAgICAgICBpZiAodGltZSkge1xuICAgICAgICAgICAgdmFyIHRpbWUgPSB0aW1lLnNwbGl0KCc6Jyk7XG4gICAgICAgICAgICB2YXIgaCA9IHBhcnNlSW50KHRpbWVbMF0pO1xuICAgICAgICAgICAgdmFyIGkgPSBwYXJzZUludCh0aW1lWzFdKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciBoID0gMDtcbiAgICAgICAgICAgIHZhciBpID0gMDtcbiAgICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoKTtcbiAgICAgICAgdmFyIHkgPSBkYXRlLmdldEZ1bGxZZWFyKCk7XG4gICAgICAgIHZhciBtID0gZGF0ZS5nZXRNb250aCgpICsgMTtcbiAgICAgICAgdmFyIGQgPSBkYXRlLmdldERhdGUoKTtcbiAgICAgICAgdmFyIGggPSBkYXRlLmdldEhvdXJzKCk7XG4gICAgICAgIHZhciBpID0gZGF0ZS5nZXRNaW51dGVzKCk7XG4gICAgfVxuXG4gICAgLy8gQ3VycmVudCB2YWx1ZVxuICAgIG9iai5kYXRlID0gWyB5LCBtLCBkLCBoLCBpLCAwIF07XG5cbiAgICAvLyBUd28gZGlnaXRzXG4gICAgdmFyIHR3byA9IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgIHZhbHVlID0gJycgKyB2YWx1ZTtcbiAgICAgICAgaWYgKHZhbHVlLmxlbmd0aCA9PSAxKSB7XG4gICAgICAgICAgICB2YWx1ZSA9ICcwJyArIHZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG5cbiAgICAvLyBDYWxlbmRhciBlbGVtZW50c1xuICAgIHZhciBjYWxlbmRhclJlc2V0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgY2FsZW5kYXJSZXNldC5jbGFzc05hbWUgPSAnamNhbGVuZGFyLXJlc2V0JztcbiAgICBjYWxlbmRhclJlc2V0LmlubmVySFRNTCA9ICdSZXNldCc7XG5cbiAgICB2YXIgY2FsZW5kYXJDb25maXJtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgY2FsZW5kYXJDb25maXJtLmNsYXNzTmFtZSA9ICdqY2FsZW5kYXItY29uZmlybSc7XG4gICAgY2FsZW5kYXJDb25maXJtLmlubmVySFRNTCA9ICdEb25lJztcblxuICAgIHZhciBjYWxlbmRhckNvbnRyb2xzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgY2FsZW5kYXJDb250cm9scy5jbGFzc05hbWUgPSAnamNhbGVuZGFyLWNvbnRyb2xzJ1xuICAgIGlmIChvYmoub3B0aW9ucy5yZXNldEJ1dHRvbikge1xuICAgICAgICBjYWxlbmRhckNvbnRyb2xzLmFwcGVuZENoaWxkKGNhbGVuZGFyUmVzZXQpO1xuICAgIH1cbiAgICBjYWxlbmRhckNvbnRyb2xzLmFwcGVuZENoaWxkKGNhbGVuZGFyQ29uZmlybSk7XG5cbiAgICB2YXIgY2FsZW5kYXJDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBjYWxlbmRhckNvbnRhaW5lci5jbGFzc05hbWUgPSAnamNhbGVuZGFyLWNvbnRhaW5lcic7XG5cbiAgICB2YXIgY2FsZW5kYXJDb250ZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgY2FsZW5kYXJDb250ZW50LmNsYXNzTmFtZSA9ICdqY2FsZW5kYXItY29udGVudCc7XG4gICAgY2FsZW5kYXJDb250ZW50LmFwcGVuZENoaWxkKGNhbGVuZGFyQ29udHJvbHMpO1xuICAgIGNhbGVuZGFyQ29udGFpbmVyLmFwcGVuZENoaWxkKGNhbGVuZGFyQ29udGVudCk7XG5cbiAgICAvLyBUYWJsZSBjb250YWluZXJcbiAgICB2YXIgY2FsZW5kYXJUYWJsZUNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGNhbGVuZGFyVGFibGVDb250YWluZXIuY2xhc3NOYW1lID0gJ2pjYWxlbmRhci10YWJsZSc7XG4gICAgY2FsZW5kYXJDb250ZW50LmFwcGVuZENoaWxkKGNhbGVuZGFyVGFibGVDb250YWluZXIpO1xuXG4gICAgLy8gTWFpbiBlbGVtZW50XG4gICAgaWYgKGVsLnRhZ05hbWUgPT0gJ0lOUFVUJykge1xuICAgICAgICB2YXIgY2FsZW5kYXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgY2FsZW5kYXIgPSBlbDtcbiAgICB9XG4gICAgY2FsZW5kYXIuY2xhc3NOYW1lID0gJ2pjYWxlbmRhcic7XG4gICAgY2FsZW5kYXIuYXBwZW5kQ2hpbGQoY2FsZW5kYXJDb250YWluZXIpO1xuXG4gICAgLy8gUHJldmlvdXMgYnV0dG9uXG4gICAgdmFyIGNhbGVuZGFySGVhZGVyUHJldiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgY2FsZW5kYXJIZWFkZXJQcmV2LnNldEF0dHJpYnV0ZSgnY29sc3BhbicsICcyJyk7XG4gICAgY2FsZW5kYXJIZWFkZXJQcmV2LmNsYXNzTmFtZSA9ICdqY2FsZW5kYXItcHJldic7XG5cbiAgICAvLyBIZWFkZXIgd2l0aCB5ZWFyIGFuZCBtb250aFxuICAgIHZhciBjYWxlbmRhckxhYmVsWWVhciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgICBjYWxlbmRhckxhYmVsWWVhci5jbGFzc05hbWUgPSAnamNhbGVuZGFyLXllYXInO1xuXG4gICAgdmFyIGNhbGVuZGFyTGFiZWxNb250aCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgICBjYWxlbmRhckxhYmVsTW9udGguY2xhc3NOYW1lID0gJ2pjYWxlbmRhci1tb250aCc7XG5cbiAgICB2YXIgY2FsZW5kYXJIZWFkZXJUaXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgY2FsZW5kYXJIZWFkZXJUaXRsZS5jbGFzc05hbWUgPSAnamNhbGVuZGFyLWhlYWRlcic7XG4gICAgY2FsZW5kYXJIZWFkZXJUaXRsZS5zZXRBdHRyaWJ1dGUoJ2NvbHNwYW4nLCAnMycpO1xuICAgIGNhbGVuZGFySGVhZGVyVGl0bGUuYXBwZW5kQ2hpbGQoY2FsZW5kYXJMYWJlbE1vbnRoKTtcbiAgICBjYWxlbmRhckhlYWRlclRpdGxlLmFwcGVuZENoaWxkKGNhbGVuZGFyTGFiZWxZZWFyKTtcblxuICAgIHZhciBjYWxlbmRhckhlYWRlck5leHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuICAgIGNhbGVuZGFySGVhZGVyTmV4dC5zZXRBdHRyaWJ1dGUoJ2NvbHNwYW4nLCAnMicpO1xuICAgIGNhbGVuZGFySGVhZGVyTmV4dC5jbGFzc05hbWUgPSAnamNhbGVuZGFyLW5leHQnO1xuXG4gICAgdmFyIGNhbGVuZGFySGVhZGVyUm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcbiAgICBjYWxlbmRhckhlYWRlclJvdy5hcHBlbmRDaGlsZChjYWxlbmRhckhlYWRlclByZXYpO1xuICAgIGNhbGVuZGFySGVhZGVyUm93LmFwcGVuZENoaWxkKGNhbGVuZGFySGVhZGVyVGl0bGUpO1xuICAgIGNhbGVuZGFySGVhZGVyUm93LmFwcGVuZENoaWxkKGNhbGVuZGFySGVhZGVyTmV4dCk7XG5cbiAgICB2YXIgY2FsZW5kYXJIZWFkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0aGVhZCcpO1xuICAgIGNhbGVuZGFySGVhZGVyLmFwcGVuZENoaWxkKGNhbGVuZGFySGVhZGVyUm93KTtcblxuICAgIHZhciBjYWxlbmRhckJvZHkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0Ym9keScpO1xuICAgIHZhciBjYWxlbmRhckZvb3RlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3Rmb290Jyk7XG5cbiAgICAvLyBDYWxlbmRhciB0YWJsZVxuICAgIHZhciBjYWxlbmRhclRhYmxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGFibGUnKTtcbiAgICBjYWxlbmRhclRhYmxlLnNldEF0dHJpYnV0ZSgnY2VsbHBhZGRpbmcnLCAnMCcpO1xuICAgIGNhbGVuZGFyVGFibGUuc2V0QXR0cmlidXRlKCdjZWxsc3BhY2luZycsICcwJyk7XG4gICAgY2FsZW5kYXJUYWJsZS5hcHBlbmRDaGlsZChjYWxlbmRhckhlYWRlcik7XG4gICAgY2FsZW5kYXJUYWJsZS5hcHBlbmRDaGlsZChjYWxlbmRhckJvZHkpO1xuICAgIGNhbGVuZGFyVGFibGUuYXBwZW5kQ2hpbGQoY2FsZW5kYXJGb290ZXIpO1xuICAgIGNhbGVuZGFyVGFibGVDb250YWluZXIuYXBwZW5kQ2hpbGQoY2FsZW5kYXJUYWJsZSk7XG5cbiAgICB2YXIgY2FsZW5kYXJTZWxlY3RIb3VyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2VsZWN0Jyk7XG4gICAgY2FsZW5kYXJTZWxlY3RIb3VyLmNsYXNzTmFtZSA9ICdqY2FsZW5kYXItc2VsZWN0JztcbiAgICBjYWxlbmRhclNlbGVjdEhvdXIub25jaGFuZ2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgb2JqLmRhdGVbM10gPSB0aGlzLnZhbHVlOyBcbiAgICB9XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IDI0OyBpKyspIHtcbiAgICAgICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcbiAgICAgICAgZWxlbWVudC52YWx1ZSA9IGk7XG4gICAgICAgIGVsZW1lbnQuaW5uZXJIVE1MID0gdHdvKGkpO1xuICAgICAgICBjYWxlbmRhclNlbGVjdEhvdXIuYXBwZW5kQ2hpbGQoZWxlbWVudCk7XG4gICAgfVxuXG4gICAgdmFyIGNhbGVuZGFyU2VsZWN0TWluID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2VsZWN0Jyk7XG4gICAgY2FsZW5kYXJTZWxlY3RNaW4uY2xhc3NOYW1lID0gJ2pjYWxlbmRhci1zZWxlY3QnO1xuICAgIGNhbGVuZGFyU2VsZWN0TWluLm9uY2hhbmdlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIG9iai5kYXRlWzRdID0gdGhpcy52YWx1ZTsgXG4gICAgfVxuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCA2MDsgaSsrKSB7XG4gICAgICAgIHZhciBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XG4gICAgICAgIGVsZW1lbnQudmFsdWUgPSBpO1xuICAgICAgICBlbGVtZW50LmlubmVySFRNTCA9IHR3byhpKTtcbiAgICAgICAgY2FsZW5kYXJTZWxlY3RNaW4uYXBwZW5kQ2hpbGQoZWxlbWVudCk7XG4gICAgfVxuXG4gICAgLy8gRm9vdGVyIGNvbnRyb2xzXG4gICAgdmFyIGNhbGVuZGFyQ29udHJvbHNGb290ZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBjYWxlbmRhckNvbnRyb2xzRm9vdGVyLmNsYXNzTmFtZSA9ICdqY2FsZW5kYXItY29udHJvbHMnO1xuXG4gICAgdmFyIGNhbGVuZGFyQ29udHJvbHNUaW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgY2FsZW5kYXJDb250cm9sc1RpbWUuY2xhc3NOYW1lID0gJ2pjYWxlbmRhci10aW1lJztcbiAgICBjYWxlbmRhckNvbnRyb2xzVGltZS5zdHlsZS5tYXhXaWR0aCA9ICcxNDBweCc7XG4gICAgY2FsZW5kYXJDb250cm9sc1RpbWUuYXBwZW5kQ2hpbGQoY2FsZW5kYXJTZWxlY3RIb3VyKTtcbiAgICBjYWxlbmRhckNvbnRyb2xzVGltZS5hcHBlbmRDaGlsZChjYWxlbmRhclNlbGVjdE1pbik7XG5cbiAgICB2YXIgY2FsZW5kYXJDb250cm9sc1VwZGF0ZUJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gICAgY2FsZW5kYXJDb250cm9sc1VwZGF0ZUJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCAnYnV0dG9uJyk7XG4gICAgY2FsZW5kYXJDb250cm9sc1VwZGF0ZUJ1dHRvbi5jbGFzc05hbWUgPSAnamNhbGVuZGFyLXVwZGF0ZSc7XG4gICAgY2FsZW5kYXJDb250cm9sc1VwZGF0ZUJ1dHRvbi52YWx1ZSA9ICdVcGRhdGUnO1xuXG4gICAgdmFyIGNhbGVuZGFyQ29udHJvbHNVcGRhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBjYWxlbmRhckNvbnRyb2xzVXBkYXRlLnN0eWxlLmZsZXhHcm93ID0gJzEwJztcbiAgICBjYWxlbmRhckNvbnRyb2xzVXBkYXRlLmFwcGVuZENoaWxkKGNhbGVuZGFyQ29udHJvbHNVcGRhdGVCdXR0b24pO1xuICAgIGNhbGVuZGFyQ29udHJvbHNGb290ZXIuYXBwZW5kQ2hpbGQoY2FsZW5kYXJDb250cm9sc1RpbWUpO1xuICAgIGNhbGVuZGFyQ29udHJvbHNGb290ZXIuYXBwZW5kQ2hpbGQoY2FsZW5kYXJDb250cm9sc1VwZGF0ZSk7XG4gICAgY2FsZW5kYXJDb250ZW50LmFwcGVuZENoaWxkKGNhbGVuZGFyQ29udHJvbHNGb290ZXIpO1xuXG4gICAgdmFyIGNhbGVuZGFyQmFja2Ryb3AgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBjYWxlbmRhckJhY2tkcm9wLmNsYXNzTmFtZSA9ICdqY2FsZW5kYXItYmFja2Ryb3AnO1xuICAgIGNhbGVuZGFyLmFwcGVuZENoaWxkKGNhbGVuZGFyQmFja2Ryb3ApO1xuXG4gICAgLy8gVXBkYXRlIGFjdGlvbnMgYnV0dG9uXG4gICAgdmFyIHVwZGF0ZUFjdGlvbnMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGN1cnJlbnREYXkgPSBjYWxlbmRhci5xdWVyeVNlbGVjdG9yKCcuamNhbGVuZGFyLXNlbGVjdGVkJyk7XG5cbiAgICAgICAgaWYgKGN1cnJlbnREYXkgJiYgY3VycmVudERheS5jbGFzc0xpc3QuY29udGFpbnMoJ2pjYWxlbmRhci1kaXNhYmxlZCcpKSB7XG4gICAgICAgICAgICBjYWxlbmRhckNvbnRyb2xzVXBkYXRlQnV0dG9uLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnZGlzYWJsZWQnKTtcbiAgICAgICAgICAgIGNhbGVuZGFyU2VsZWN0SG91ci5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJyk7XG4gICAgICAgICAgICBjYWxlbmRhclNlbGVjdE1pbi5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjYWxlbmRhckNvbnRyb2xzVXBkYXRlQnV0dG9uLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICAgICAgICAgIGNhbGVuZGFyU2VsZWN0SG91ci5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG4gICAgICAgICAgICBjYWxlbmRhclNlbGVjdE1pbi5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBNZXRob2RzXG4gICAgb2JqLm9wZW4gPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgaWYgKCEgY2FsZW5kYXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdqY2FsZW5kYXItZm9jdXMnKSkge1xuICAgICAgICAgICAgaWYgKGpTdWl0ZXMuY2FsZW5kYXIuY3VycmVudCkge1xuICAgICAgICAgICAgICAgIGpTdWl0ZXMuY2FsZW5kYXIuY3VycmVudC5jbG9zZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gQ3VycmVudFxuICAgICAgICAgICAgalN1aXRlcy5jYWxlbmRhci5jdXJyZW50ID0gb2JqO1xuICAgICAgICAgICAgLy8gU2hvdyBjYWxlbmRhclxuICAgICAgICAgICAgY2FsZW5kYXIuY2xhc3NMaXN0LmFkZCgnamNhbGVuZGFyLWZvY3VzJyk7XG4gICAgICAgICAgICAvLyBHZXQgZGF5c1xuICAgICAgICAgICAgb2JqLmdldERheXMoKTtcbiAgICAgICAgICAgIC8vIEhvdXJcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy50aW1lKSB7XG4gICAgICAgICAgICAgICAgY2FsZW5kYXJTZWxlY3RIb3VyLnZhbHVlID0gb2JqLmRhdGVbM107XG4gICAgICAgICAgICAgICAgY2FsZW5kYXJTZWxlY3RNaW4udmFsdWUgPSBvYmouZGF0ZVs0XTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gR2V0IHRoZSBwb3NpdGlvbiBvZiB0aGUgY29ybmVyIGhlbHBlclxuICAgICAgICAgICAgaWYgKGpTdWl0ZXMuZ2V0V2luZG93V2lkdGgoKSA8IDgwMCB8fCBvYmoub3B0aW9ucy5mdWxsc2NyZWVuKSB7XG4gICAgICAgICAgICAgICAgLy8gRnVsbFxuICAgICAgICAgICAgICAgIGNhbGVuZGFyLmNsYXNzTGlzdC5hZGQoJ2pjYWxlbmRhci1mdWxsc2l6ZScpO1xuICAgICAgICAgICAgICAgIC8vIEFuaW1hdGlvblxuICAgICAgICAgICAgICAgIGpTdWl0ZXMuc2xpZGVCb3R0b20oY2FsZW5kYXJDb250ZW50LCAxKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVjdCA9IGVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlY3RDb250ZW50ID0gY2FsZW5kYXJDb250ZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXG4gICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLnBvc2l0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGVuZGFyQ29udGFpbmVyLnN0eWxlLnBvc2l0aW9uID0gJ2ZpeGVkJztcbiAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5pbm5lckhlaWdodCA8IHJlY3QuYm90dG9tICsgcmVjdENvbnRlbnQuaGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxlbmRhckNvbnRhaW5lci5zdHlsZS50b3AgPSAocmVjdC50b3AgLSAocmVjdENvbnRlbnQuaGVpZ2h0ICsgMikpICsgJ3B4JztcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGVuZGFyQ29udGFpbmVyLnN0eWxlLnRvcCA9IChyZWN0LnRvcCArIHJlY3QuaGVpZ2h0ICsgMikgKyAncHgnO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNhbGVuZGFyQ29udGFpbmVyLnN0eWxlLmxlZnQgPSByZWN0LmxlZnQgKyAncHgnO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuaW5uZXJIZWlnaHQgPCByZWN0LmJvdHRvbSArIHJlY3RDb250ZW50LmhlaWdodCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsZW5kYXJDb250YWluZXIuc3R5bGUuYm90dG9tID0gKDEgKiByZWN0LmhlaWdodCArIHJlY3RDb250ZW50LmhlaWdodCArIDIpICsgJ3B4JztcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGVuZGFyQ29udGFpbmVyLnN0eWxlLnRvcCA9IDIgKyAncHgnOyBcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIG9iai5jbG9zZSA9IGZ1bmN0aW9uIChpZ25vcmVFdmVudHMsIHVwZGF0ZSkge1xuICAgICAgICBpZiAoalN1aXRlcy5jYWxlbmRhci5jdXJyZW50KSB7XG4gICAgICAgICAgICAvLyBDdXJyZW50XG4gICAgICAgICAgICBqU3VpdGVzLmNhbGVuZGFyLmN1cnJlbnQgPSBudWxsO1xuXG4gICAgICAgICAgICBpZiAodXBkYXRlICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIHZhciBlbGVtZW50ID0gY2FsZW5kYXIucXVlcnlTZWxlY3RvcignLmpjYWxlbmRhci1zZWxlY3RlZCcpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZih1cGRhdGUpID09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IHVwZGF0ZTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVsZW1lbnQgJiYgZWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoJ2pjYWxlbmRhci1kaXNhYmxlZCcpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IG9iai5vcHRpb25zLnZhbHVlXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gb2JqLmdldFZhbHVlKCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgb2JqLnNldFZhbHVlKHZhbHVlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gRXZlbnRzXG4gICAgICAgICAgICBpZiAoISBpZ25vcmVFdmVudHMgJiYgdHlwZW9mKG9iai5vcHRpb25zLm9uY2xvc2UpID09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5vbmNsb3NlKGVsKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gSGlkZVxuICAgICAgICAgICAgY2FsZW5kYXIuY2xhc3NMaXN0LnJlbW92ZSgnamNhbGVuZGFyLWZvY3VzJyk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gb2JqLm9wdGlvbnMudmFsdWU7XG4gICAgfVxuXG4gICAgb2JqLnByZXYgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIHZpc3VhbGl6YXRpb24gaXMgdGhlIGRheXMgcGlja2VyIG9yIHllYXJzIHBpY2tlclxuICAgICAgICBpZiAob2JqLm9wdGlvbnMubW9kZSA9PSAneWVhcnMnKSB7XG4gICAgICAgICAgICBvYmouZGF0ZVswXSA9IG9iai5kYXRlWzBdIC0gMTI7XG5cbiAgICAgICAgICAgIC8vIFVwZGF0ZSBwaWNrZXIgdGFibGUgb2YgZGF5c1xuICAgICAgICAgICAgb2JqLmdldFllYXJzKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBHbyB0byB0aGUgcHJldmlvdXMgbW9udGhcbiAgICAgICAgICAgIGlmIChvYmouZGF0ZVsxXSA8IDIpIHtcbiAgICAgICAgICAgICAgICBvYmouZGF0ZVswXSA9IG9iai5kYXRlWzBdIC0gMTtcbiAgICAgICAgICAgICAgICBvYmouZGF0ZVsxXSA9IDEyO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBvYmouZGF0ZVsxXSA9IG9iai5kYXRlWzFdIC0gMTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gVXBkYXRlIHBpY2tlciB0YWJsZSBvZiBkYXlzXG4gICAgICAgICAgICBvYmouZ2V0RGF5cygpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgb2JqLm5leHQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIHZpc3VhbGl6YXRpb24gaXMgdGhlIGRheXMgcGlja2VyIG9yIHllYXJzIHBpY2tlclxuICAgICAgICBpZiAob2JqLm9wdGlvbnMubW9kZSA9PSAneWVhcnMnKSB7XG4gICAgICAgICAgICBvYmouZGF0ZVswXSA9IHBhcnNlSW50KG9iai5kYXRlWzBdKSArIDEyO1xuXG4gICAgICAgICAgICAvLyBVcGRhdGUgcGlja2VyIHRhYmxlIG9mIGRheXNcbiAgICAgICAgICAgIG9iai5nZXRZZWFycygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gR28gdG8gdGhlIHByZXZpb3VzIG1vbnRoXG4gICAgICAgICAgICBpZiAob2JqLmRhdGVbMV0gPiAxMSkge1xuICAgICAgICAgICAgICAgIG9iai5kYXRlWzBdID0gcGFyc2VJbnQob2JqLmRhdGVbMF0pICsgMTtcbiAgICAgICAgICAgICAgICBvYmouZGF0ZVsxXSA9IDE7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG9iai5kYXRlWzFdID0gcGFyc2VJbnQob2JqLmRhdGVbMV0pICsgMTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gVXBkYXRlIHBpY2tlciB0YWJsZSBvZiBkYXlzXG4gICAgICAgICAgICBvYmouZ2V0RGF5cygpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgb2JqLnNldFZhbHVlID0gZnVuY3Rpb24odmFsKSB7XG4gICAgICAgIGlmICghIHZhbCkge1xuICAgICAgICAgICAgdmFsID0gJycgKyB2YWw7XG4gICAgICAgIH1cbiAgICAgICAgLy8gVmFsdWVzXG4gICAgICAgIHZhciBuZXdWYWx1ZSA9IHZhbDtcbiAgICAgICAgdmFyIG9sZFZhbHVlID0gb2JqLm9wdGlvbnMudmFsdWU7XG4gICAgICAgIC8vIFNldCBsYWJlbFxuICAgICAgICB2YXIgdmFsdWUgPSBvYmouc2V0TGFiZWwobmV3VmFsdWUsIG9iai5vcHRpb25zLmZvcm1hdCk7XG4gICAgICAgIHZhciBkYXRlID0gbmV3VmFsdWUuc3BsaXQoJyAnKTtcbiAgICAgICAgaWYgKCEgZGF0ZVsxXSkge1xuICAgICAgICAgICAgZGF0ZVsxXSA9ICcwMDowMDowMCc7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHRpbWUgPSBkYXRlWzFdLnNwbGl0KCc6JylcbiAgICAgICAgdmFyIGRhdGUgPSBkYXRlWzBdLnNwbGl0KCctJyk7XG4gICAgICAgIHZhciB5ID0gcGFyc2VJbnQoZGF0ZVswXSk7XG4gICAgICAgIHZhciBtID0gcGFyc2VJbnQoZGF0ZVsxXSk7XG4gICAgICAgIHZhciBkID0gcGFyc2VJbnQoZGF0ZVsyXSk7XG4gICAgICAgIHZhciBoID0gcGFyc2VJbnQodGltZVswXSk7XG4gICAgICAgIHZhciBpID0gcGFyc2VJbnQodGltZVsxXSk7XG4gICAgICAgIG9iai5kYXRlID0gWyB5LCBtLCBkLCBoLCBpLCAwIF07XG4gICAgICAgIHZhciB2YWwgPSBvYmouc2V0TGFiZWwobmV3VmFsdWUsIG9iai5vcHRpb25zLmZvcm1hdCk7XG5cbiAgICAgICAgaWYgKG9sZFZhbHVlICE9IG5ld1ZhbHVlKSB7XG4gICAgICAgICAgICAvLyBJbnB1dCB2YWx1ZVxuICAgICAgICAgICAgaWYgKGVsLnRhZ05hbWUgPT0gJ0lOUFVUJykge1xuICAgICAgICAgICAgICAgIGVsLnZhbHVlID0gdmFsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gTmV3IHZhbHVlXG4gICAgICAgICAgICBvYmoub3B0aW9ucy52YWx1ZSA9IG5ld1ZhbHVlO1xuICAgICAgICAgICAgLy8gT24gY2hhbmdlXG4gICAgICAgICAgICBpZiAodHlwZW9mKG9iai5vcHRpb25zLm9uY2hhbmdlKSA9PSAgJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLm9uY2hhbmdlKGVsLCBuZXdWYWx1ZSwgb2xkVmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgb2JqLmdldERheXMoKTtcbiAgICB9XG5cbiAgICBvYmouZ2V0VmFsdWUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKG9iai5kYXRlKSB7XG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMudGltZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0d28ob2JqLmRhdGVbMF0pICsgJy0nICsgdHdvKG9iai5kYXRlWzFdKSArICctJyArIHR3byhvYmouZGF0ZVsyXSkgKyAnICcgKyB0d28ob2JqLmRhdGVbM10pICsgJzonICsgdHdvKG9iai5kYXRlWzRdKSArICc6JyArIHR3bygwKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHR3byhvYmouZGF0ZVswXSkgKyAnLScgKyB0d28ob2JqLmRhdGVbMV0pICsgJy0nICsgdHdvKG9iai5kYXRlWzJdKSArICcgJyArIHR3bygwKSArICc6JyArIHR3bygwKSArICc6JyArIHR3bygwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBcIlwiO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogIENhbGVuZGFyXG4gICAgICovXG4gICAgb2JqLnVwZGF0ZSA9IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgaWYgKGVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqY2FsZW5kYXItZGlzYWJsZWQnKSkge1xuICAgICAgICAgICAgLy8gRG8gbm90aGluZ1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgb2JqLmRhdGVbMl0gPSBlbGVtZW50LmlubmVyVGV4dDtcblxuICAgICAgICAgICAgaWYgKCEgb2JqLm9wdGlvbnMudGltZSkge1xuICAgICAgICAgICAgICAgIG9iai5jbG9zZSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBvYmouZGF0ZVszXSA9IGNhbGVuZGFyU2VsZWN0SG91ci52YWx1ZTtcbiAgICAgICAgICAgICAgICBvYmouZGF0ZVs0XSA9IGNhbGVuZGFyU2VsZWN0TWluLnZhbHVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgZWxlbWVudHMgPSBjYWxlbmRhci5xdWVyeVNlbGVjdG9yKCcuamNhbGVuZGFyLXNlbGVjdGVkJyk7XG4gICAgICAgICAgICBpZiAoZWxlbWVudHMpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50cy5jbGFzc0xpc3QucmVtb3ZlKCdqY2FsZW5kYXItc2VsZWN0ZWQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnamNhbGVuZGFyLXNlbGVjdGVkJyk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBVcGRhdGVcbiAgICAgICAgdXBkYXRlQWN0aW9ucygpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldCB0byBibGFua1xuICAgICAqL1xuICAgIG9iai5yZXNldCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBDbG9zZSBjYWxlbmRhclxuICAgICAgICBvYmouY2xvc2UoZmFsc2UsICcnKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgY2FsZW5kYXIgZGF5c1xuICAgICAqL1xuICAgIG9iai5nZXREYXlzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIE1vZGVcbiAgICAgICAgb2JqLm9wdGlvbnMubW9kZSA9ICdkYXlzJztcblxuICAgICAgICAvLyBTZXR0aW5nIGN1cnJlbnQgdmFsdWVzIGluIGNhc2Ugb2YgTlVMTHNcbiAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSgpO1xuXG4gICAgICAgIC8vIEN1cnJlbnQgc2VsZWN0aW9uXG4gICAgICAgIHZhciB5ZWFyID0gb2JqLmRhdGUgJiYgb2JqLmRhdGVbMF0gPyBvYmouZGF0ZVswXSA6IHBhcnNlSW50KGRhdGUuZ2V0RnVsbFllYXIoKSk7XG4gICAgICAgIHZhciBtb250aCA9IG9iai5kYXRlICYmIG9iai5kYXRlWzFdID8gb2JqLmRhdGVbMV0gOiBwYXJzZUludChkYXRlLmdldE1vbnRoKCkpICsgMTtcbiAgICAgICAgdmFyIGRheSA9IG9iai5kYXRlICYmIG9iai5kYXRlWzJdID8gb2JqLmRhdGVbMl0gOiBwYXJzZUludChkYXRlLmdldERheSgpKTtcbiAgICAgICAgdmFyIGhvdXIgPSBvYmouZGF0ZSAmJiBvYmouZGF0ZVszXSA/IG9iai5kYXRlWzNdIDogcGFyc2VJbnQoZGF0ZS5nZXRIb3VycygpKTtcbiAgICAgICAgdmFyIG1pbiA9IG9iai5kYXRlICYmIG9iai5kYXRlWzRdID8gb2JqLmRhdGVbNF0gOiBwYXJzZUludChkYXRlLmdldE1pbnV0ZXMoKSk7XG5cbiAgICAgICAgLy8gU2VsZWN0aW9uIGNvbnRhaW5lclxuICAgICAgICBvYmouZGF0ZSA9IFt5ZWFyLCBtb250aCwgZGF5LCBob3VyLCBtaW4sIDAgXTtcblxuICAgICAgICAvLyBVcGRhdGUgdGl0bGVcbiAgICAgICAgY2FsZW5kYXJMYWJlbFllYXIuaW5uZXJIVE1MID0geWVhcjtcbiAgICAgICAgY2FsZW5kYXJMYWJlbE1vbnRoLmlubmVySFRNTCA9IG9iai5vcHRpb25zLm1vbnRoc1ttb250aCAtIDFdO1xuXG4gICAgICAgIC8vIEN1cnJlbnQgbW9udGggYW5kIFllYXJcbiAgICAgICAgdmFyIGlzQ3VycmVudE1vbnRoQW5kWWVhciA9IChkYXRlLmdldE1vbnRoKCkgPT0gbW9udGggLSAxKSAmJiAoZGF0ZS5nZXRGdWxsWWVhcigpID09IHllYXIpID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICB2YXIgY3VycmVudERheSA9IGRhdGUuZ2V0RGF0ZSgpO1xuXG4gICAgICAgIC8vIE51bWJlciBvZiBkYXlzIGluIHRoZSBtb250aFxuICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKHllYXIsIG1vbnRoLCAwLCAwLCAwKTtcbiAgICAgICAgdmFyIG51bWJlck9mRGF5cyA9IGRhdGUuZ2V0RGF0ZSgpO1xuXG4gICAgICAgIC8vIEZpcnN0IGRheVxuICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKHllYXIsIG1vbnRoLTEsIDAsIDAsIDApO1xuICAgICAgICB2YXIgZmlyc3REYXkgPSBkYXRlLmdldERheSgpICsgMTtcblxuICAgICAgICAvLyBJbmRleCB2YWx1ZVxuICAgICAgICB2YXIgaW5kZXggPSBvYmoub3B0aW9ucy5zdGFydGluZ0RheSB8fCAwO1xuXG4gICAgICAgIC8vIEZpcnN0IG9mIGRheSByZWxhdGl2ZSB0byB0aGUgc3RhcnRpbmcgY2FsZW5kYXIgd2Vla2RheVxuICAgICAgICBmaXJzdERheSA9IGZpcnN0RGF5IC0gaW5kZXg7XG5cbiAgICAgICAgLy8gUmVzZXQgdGFibGVcbiAgICAgICAgY2FsZW5kYXJCb2R5LmlubmVySFRNTCA9ICcnO1xuXG4gICAgICAgIC8vIFdlZWtkYXlzIFJvd1xuICAgICAgICB2YXIgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcbiAgICAgICAgcm93LnNldEF0dHJpYnV0ZSgnYWxpZ24nLCAnY2VudGVyJyk7XG4gICAgICAgIGNhbGVuZGFyQm9keS5hcHBlbmRDaGlsZChyb3cpO1xuXG4gICAgICAgIC8vIENyZWF0ZSB3ZWVrZGF5cyByb3dcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA3OyBpKyspIHtcbiAgICAgICAgICAgIHZhciBjZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcbiAgICAgICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZCgnamNhbGVuZGFyLXdlZWtkYXknKVxuICAgICAgICAgICAgY2VsbC5pbm5lckhUTUwgPSBvYmoub3B0aW9ucy53ZWVrZGF5c19zaG9ydFtpbmRleF07XG4gICAgICAgICAgICByb3cuYXBwZW5kQ2hpbGQoY2VsbCk7XG4gICAgICAgICAgICAvLyBOZXh0IHdlZWsgZGF5XG4gICAgICAgICAgICBpbmRleCsrO1xuICAgICAgICAgICAgLy8gUmVzdGFydCBpbmRleFxuICAgICAgICAgICAgaWYgKGluZGV4ID4gNikge1xuICAgICAgICAgICAgICAgIGluZGV4ID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEluZGV4IG9mIGRheXNcbiAgICAgICAgdmFyIGluZGV4ID0gMDtcbiAgICAgICAgdmFyIGQgPSAwO1xuIFxuICAgICAgICAvLyBDYWxlbmRhciB0YWJsZVxuICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IDU7IGorKykge1xuICAgICAgICAgICAgLy8gUmVzZXQgY2VsbHMgY29udGFpbmVyXG4gICAgICAgICAgICB2YXIgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcbiAgICAgICAgICAgIHJvdy5zZXRBdHRyaWJ1dGUoJ2FsaWduJywgJ2NlbnRlcicpO1xuICAgICAgICAgICAgLy8gRGF0YSBjb250cm9sXG4gICAgICAgICAgICB2YXIgZW1wdHlSb3cgPSB0cnVlO1xuICAgICAgICAgICAgLy8gQ3JlYXRlIGNlbGxzXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDc7IGkrKykge1xuICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBjZWxsXG4gICAgICAgICAgICAgICAgdmFyIGNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuICAgICAgICAgICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZCgnamNhbGVuZGFyLXNldC1kYXknKTtcblxuICAgICAgICAgICAgICAgIGlmIChpbmRleCA+PSBmaXJzdERheSAmJiBpbmRleCA8IChmaXJzdERheSArIG51bWJlck9mRGF5cykpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gRGF5IGNlbGxcbiAgICAgICAgICAgICAgICAgICAgZCsrO1xuICAgICAgICAgICAgICAgICAgICBjZWxsLmlubmVySFRNTCA9IGQ7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gU2VsZWN0ZWRcbiAgICAgICAgICAgICAgICAgICAgaWYgKGQgPT0gZGF5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjZWxsLmNsYXNzTGlzdC5hZGQoJ2pjYWxlbmRhci1zZWxlY3RlZCcpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gQ3VycmVudCBzZWxlY3Rpb24gZGF5IGlzIHRvZGF5XG4gICAgICAgICAgICAgICAgICAgIGlmIChpc0N1cnJlbnRNb250aEFuZFllYXIgJiYgY3VycmVudERheSA9PSBkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjZWxsLnN0eWxlLmZvbnRXZWlnaHQgPSAnYm9sZCc7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBDdXJyZW50IHNlbGVjdGlvbiBkYXlcbiAgICAgICAgICAgICAgICAgICAgdmFyIGN1cnJlbnQgPSBqU3VpdGVzLmNhbGVuZGFyLm5vdyhuZXcgRGF0ZSh5ZWFyLCBtb250aC0xLCBkKSwgdHJ1ZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gQXZhaWxhYmxlIHJhbmdlc1xuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMudmFsaWRSYW5nZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEgb2JqLm9wdGlvbnMudmFsaWRSYW5nZVswXSB8fCBjdXJyZW50ID49IG9iai5vcHRpb25zLnZhbGlkUmFuZ2VbMF0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGVzdDEgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGVzdDEgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEgb2JqLm9wdGlvbnMudmFsaWRSYW5nZVsxXSB8fCBjdXJyZW50IDw9IG9iai5vcHRpb25zLnZhbGlkUmFuZ2VbMV0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGVzdDIgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGVzdDIgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEgKHRlc3QxICYmIHRlc3QyKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZCgnamNhbGVuZGFyLWRpc2FibGVkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBDb250cm9sXG4gICAgICAgICAgICAgICAgICAgIGVtcHR5Um93ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIERheSBjZWxsXG4gICAgICAgICAgICAgICAgcm93LmFwcGVuZENoaWxkKGNlbGwpO1xuICAgICAgICAgICAgICAgIC8vIEluZGV4XG4gICAgICAgICAgICAgICAgaW5kZXgrKztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQWRkIGNlbGwgdG8gdGhlIGNhbGVuZGFyIGJvZHlcbiAgICAgICAgICAgIGlmIChlbXB0eVJvdyA9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIGNhbGVuZGFyQm9keS5hcHBlbmRDaGlsZChyb3cpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gU2hvdyB0aW1lIGNvbnRyb2xzXG4gICAgICAgIGlmIChvYmoub3B0aW9ucy50aW1lKSB7XG4gICAgICAgICAgICBjYWxlbmRhckNvbnRyb2xzVGltZS5zdHlsZS5kaXNwbGF5ID0gJyc7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjYWxlbmRhckNvbnRyb2xzVGltZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVXBkYXRlXG4gICAgICAgIHVwZGF0ZUFjdGlvbnMoKTtcbiAgICB9XG5cbiAgICBvYmouZ2V0TW9udGhzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIE1vZGVcbiAgICAgICAgb2JqLm9wdGlvbnMubW9kZSA9ICdtb250aHMnO1xuXG4gICAgICAgIC8vIExvYWRpbmcgbW9udGggbGFiZWxzXG4gICAgICAgIHZhciBtb250aHMgPSBvYmoub3B0aW9ucy5tb250aHM7XG5cbiAgICAgICAgLy8gVXBkYXRlIHRpdGxlXG4gICAgICAgIGNhbGVuZGFyTGFiZWxZZWFyLmlubmVySFRNTCA9IG9iai5kYXRlWzBdO1xuICAgICAgICBjYWxlbmRhckxhYmVsTW9udGguaW5uZXJIVE1MID0gJyc7XG5cbiAgICAgICAgLy8gQ3JlYXRlIG1vbnRocyB0YWJsZVxuICAgICAgICB2YXIgaHRtbCA9ICc8dGQgY29sc3Bhbj1cIjdcIj48dGFibGUgd2lkdGg9XCIxMDAlXCI+PHRyIGFsaWduPVwiY2VudGVyXCI+JztcblxuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgMTI7IGkrKykge1xuICAgICAgICAgICAgaWYgKChpID4gMCkgJiYgKCEoaSAlIDQpKSkge1xuICAgICAgICAgICAgICAgIGh0bWwgKz0gJzwvdHI+PHRyIGFsaWduPVwiY2VudGVyXCI+JztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIG1vbnRoID0gcGFyc2VJbnQoaSkgKyAxO1xuICAgICAgICAgICAgaHRtbCArPSAnPHRkIGNsYXNzPVwiamNhbGVuZGFyLXNldC1tb250aFwiIGRhdGEtdmFsdWU9XCInICsgbW9udGggKyAnXCI+JyArIG1vbnRoc1tpXSArJzwvdGQ+JztcbiAgICAgICAgfVxuXG4gICAgICAgIGh0bWwgKz0gJzwvdHI+PC90YWJsZT48L3RkPic7XG5cbiAgICAgICAgY2FsZW5kYXJCb2R5LmlubmVySFRNTCA9IGh0bWw7XG4gICAgfVxuXG4gICAgb2JqLmdldFllYXJzID0gZnVuY3Rpb24oKSB7IFxuICAgICAgICAvLyBNb2RlXG4gICAgICAgIG9iai5vcHRpb25zLm1vZGUgPSAneWVhcnMnO1xuXG4gICAgICAgIC8vIEFycmF5IG9mIHllYXJzXG4gICAgICAgIHZhciB5ID0gW107XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCAyNTsgaSsrKSB7XG4gICAgICAgICAgICB5W2ldID0gcGFyc2VJbnQob2JqLmRhdGVbMF0pICsgKGkgLSAxMik7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBBc3NlbWJsaW5nIHRoZSB5ZWFyIHRhYmxlc1xuICAgICAgICB2YXIgaHRtbCA9ICc8dGQgY29sc3Bhbj1cIjdcIj48dGFibGUgd2lkdGg9XCIxMDAlXCI+PHRyIGFsaWduPVwiY2VudGVyXCI+JztcblxuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgMjU7IGkrKykge1xuICAgICAgICAgICAgaWYgKChpID4gMCkgJiYgKCEoaSAlIDUpKSkge1xuICAgICAgICAgICAgICAgIGh0bWwgKz0gJzwvdHI+PHRyIGFsaWduPVwiY2VudGVyXCI+JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGh0bWwgKz0gJzx0ZCBjbGFzcz1cImpjYWxlbmRhci1zZXQteWVhclwiPicrIHlbaV0gKyc8L3RkPic7XG4gICAgICAgIH1cblxuICAgICAgICBodG1sICs9ICc8L3RyPjwvdGFibGU+PC90ZD4nO1xuXG4gICAgICAgIGNhbGVuZGFyQm9keS5pbm5lckhUTUwgPSBodG1sO1xuICAgIH1cblxuICAgIG9iai5zZXRMYWJlbCA9IGZ1bmN0aW9uKHZhbHVlLCBmb3JtYXQpIHtcbiAgICAgICAgcmV0dXJuIGpTdWl0ZXMuY2FsZW5kYXIuZ2V0RGF0ZVN0cmluZyh2YWx1ZSwgZm9ybWF0KTtcbiAgICB9XG5cbiAgICBvYmouZnJvbUZvcm1hdHRlZCA9IGZ1bmN0aW9uICh2YWx1ZSwgZm9ybWF0KSB7XG4gICAgICAgIHJldHVybiBqU3VpdGVzLmNhbGVuZGFyLmV4dHJhY3REYXRlRnJvbVN0cmluZyh2YWx1ZSwgZm9ybWF0KTtcbiAgICB9XG5cbiAgICB2YXIgbW91c2VVcENvbnRyb2xzID0gZnVuY3Rpb24oZSkge1xuICAgICAgICB2YXIgYWN0aW9uID0gZS50YXJnZXQuY2xhc3NOYW1lO1xuXG4gICAgICAgIC8vIE9iamVjdCBpZFxuICAgICAgICBpZiAoYWN0aW9uID09ICdqY2FsZW5kYXItcHJldicpIHtcbiAgICAgICAgICAgIG9iai5wcmV2KCk7XG4gICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbiA9PSAnamNhbGVuZGFyLW5leHQnKSB7XG4gICAgICAgICAgICBvYmoubmV4dCgpO1xuICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfSBlbHNlIGlmIChhY3Rpb24gPT0gJ2pjYWxlbmRhci1tb250aCcpIHtcbiAgICAgICAgICAgIG9iai5nZXRNb250aHMoKTtcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH0gZWxzZSBpZiAoYWN0aW9uID09ICdqY2FsZW5kYXIteWVhcicpIHtcbiAgICAgICAgICAgIG9iai5nZXRZZWFycygpO1xuICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfSBlbHNlIGlmIChhY3Rpb24gPT0gJ2pjYWxlbmRhci1zZXQteWVhcicpIHtcbiAgICAgICAgICAgIG9iai5kYXRlWzBdID0gZS50YXJnZXQuaW5uZXJUZXh0O1xuICAgICAgICAgICAgb2JqLmdldERheXMoKTtcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH0gZWxzZSBpZiAoYWN0aW9uID09ICdqY2FsZW5kYXItc2V0LW1vbnRoJykge1xuICAgICAgICAgICAgb2JqLmRhdGVbMV0gPSBwYXJzZUludChlLnRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtdmFsdWUnKSk7XG4gICAgICAgICAgICBvYmouZ2V0RGF5cygpO1xuICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfSBlbHNlIGlmIChhY3Rpb24gPT0gJ2pjYWxlbmRhci1jb25maXJtJyB8fCBhY3Rpb24gPT0gJ2pjYWxlbmRhci11cGRhdGUnKSB7XG4gICAgICAgICAgICBvYmouY2xvc2UoKTtcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH0gZWxzZSBpZiAoYWN0aW9uID09ICdqY2FsZW5kYXItY2xvc2UnKSB7XG4gICAgICAgICAgICBvYmouY2xvc2UoKTtcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH0gZWxzZSBpZiAoYWN0aW9uID09ICdqY2FsZW5kYXItYmFja2Ryb3AnKSB7XG4gICAgICAgICAgICBvYmouY2xvc2UoZmFsc2UsIGZhbHNlKTtcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH0gZWxzZSBpZiAoYWN0aW9uID09ICdqY2FsZW5kYXItcmVzZXQnKSB7XG4gICAgICAgICAgICBvYmoucmVzZXQoKTtcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH0gZWxzZSBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqY2FsZW5kYXItc2V0LWRheScpKSB7XG4gICAgICAgICAgICBpZiAoZS50YXJnZXQuaW5uZXJUZXh0KSB7XG4gICAgICAgICAgICAgICAgb2JqLnVwZGF0ZShlLnRhcmdldCk7XG4gICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIga2V5VXBDb250cm9scyA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgaWYgKGUudGFyZ2V0LnZhbHVlICYmIGUudGFyZ2V0LnZhbHVlLmxlbmd0aCA+IDMpIHtcbiAgICAgICAgICAgIHZhciB0ZXN0ID0galN1aXRlcy5jYWxlbmRhci5leHRyYWN0RGF0ZUZyb21TdHJpbmcoZS50YXJnZXQudmFsdWUsIG9iai5vcHRpb25zLmZvcm1hdCk7XG4gICAgICAgICAgICBpZiAodGVzdCkge1xuICAgICAgICAgICAgICAgIGlmIChlLnRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtY29tcGxldGVkJykgPT0gJ3RydWUnKSB7XG4gICAgICAgICAgICAgICAgICAgIG9iai5zZXRWYWx1ZSh0ZXN0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBIYW5kbGUgZXZlbnRzXG4gICAgZWwuYWRkRXZlbnRMaXN0ZW5lcihcImtleXVwXCIsIGtleVVwQ29udHJvbHMpO1xuXG4gICAgLy8gQWRkIGdsb2JhbCBldmVudHNcbiAgICBjYWxlbmRhci5hZGRFdmVudExpc3RlbmVyKFwic3dpcGVsZWZ0XCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgalN1aXRlcy5zbGlkZUxlZnQoY2FsZW5kYXJUYWJsZSwgMCwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBvYmoubmV4dCgpO1xuICAgICAgICAgICAgalN1aXRlcy5zbGlkZVJpZ2h0KGNhbGVuZGFyVGFibGUsIDEpO1xuICAgICAgICB9KTtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIH0pO1xuXG4gICAgY2FsZW5kYXIuYWRkRXZlbnRMaXN0ZW5lcihcInN3aXBlcmlnaHRcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgICBqU3VpdGVzLnNsaWRlUmlnaHQoY2FsZW5kYXJUYWJsZSwgMCwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBvYmoucHJldigpO1xuICAgICAgICAgICAgalN1aXRlcy5zbGlkZUxlZnQoY2FsZW5kYXJUYWJsZSwgMSk7XG4gICAgICAgIH0pO1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgfSk7XG5cbiAgICBpZiAoJ29udG91Y2hlbmQnIGluIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCA9PT0gdHJ1ZSkge1xuICAgICAgICBjYWxlbmRhci5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIiwgbW91c2VVcENvbnRyb2xzKTtcblxuICAgICAgICBlbC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgb2JqLm9wZW4oKTtcbiAgICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgY2FsZW5kYXIuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgbW91c2VVcENvbnRyb2xzKTtcblxuICAgICAgICBlbC5hZGRFdmVudExpc3RlbmVyKFwibW91c2V1cFwiLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBvYmoub3BlbigpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBBcHBlbmQgZWxlbWVudCB0byB0aGUgRE9NXG4gICAgaWYgKGVsLnRhZ05hbWUgPT0gJ0lOUFVUJykge1xuICAgICAgICBlbC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShjYWxlbmRhciwgZWwubmV4dFNpYmxpbmcpO1xuICAgICAgICAvLyBBZGQgcHJvcGVydGllc1xuICAgICAgICBlbC5zZXRBdHRyaWJ1dGUoJ2F1dG9jb21wbGV0ZScsICdvZmYnKTtcbiAgICAgICAgZWwuc2V0QXR0cmlidXRlKCdkYXRhLW1hc2snLCBvYmoub3B0aW9ucy5mb3JtYXQudG9Mb3dlckNhc2UoKSk7XG5cbiAgICAgICAgaWYgKG9iai5vcHRpb25zLnJlYWRvbmx5KSB7XG4gICAgICAgICAgICBlbC5zZXRBdHRyaWJ1dGUoJ3JlYWRvbmx5JywgJ3JlYWRvbmx5Jyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9iai5vcHRpb25zLnBsYWNlaG9sZGVyKSB7XG4gICAgICAgICAgICBlbC5zZXRBdHRyaWJ1dGUoJ3BsYWNlaG9sZGVyJywgb2JqLm9wdGlvbnMucGxhY2Vob2xkZXIpO1xuICAgICAgICB9XG4gICAgICAgIC8vIEVsZW1lbnRcbiAgICAgICAgZWwuY2xhc3NMaXN0LmFkZCgnamNhbGVuZGFyLWlucHV0Jyk7XG4gICAgICAgIC8vIFZhbHVlXG4gICAgICAgIGVsLnZhbHVlID0gb2JqLnNldExhYmVsKG9iai5nZXRWYWx1ZSgpLCBvYmoub3B0aW9ucy5mb3JtYXQpO1xuICAgIH1cblxuICAgIC8vIEtlZXAgb2JqZWN0IGF2YWlsYWJsZSBmcm9tIHRoZSBub2RlXG4gICAgZWwuY2FsZW5kYXIgPSBvYmo7XG5cbiAgICBpZiAob2JqLm9wdGlvbnMub3BlbmVkID09IHRydWUpIHtcbiAgICAgICAgb2JqLm9wZW4oKTtcbiAgICB9XG5cbiAgICByZXR1cm4gb2JqO1xufSk7XG5cbmpTdWl0ZXMuY2FsZW5kYXIucHJldHRpZnkgPSBmdW5jdGlvbihkLCB0ZXh0cykge1xuICAgIGlmICghIHRleHRzKSB7XG4gICAgICAgIHZhciB0ZXh0cyA9IHtcbiAgICAgICAgICAgIGp1c3ROb3c6ICdKdXN0IG5vdycsXG4gICAgICAgICAgICB4TWludXRlc0FnbzogJ3swfW0gYWdvJyxcbiAgICAgICAgICAgIHhIb3Vyc0FnbzogJ3swfWggYWdvJyxcbiAgICAgICAgICAgIHhEYXlzQWdvOiAnezB9ZCBhZ28nLFxuICAgICAgICAgICAgeFdlZWtzQWdvOiAnezB9dyBhZ28nLFxuICAgICAgICAgICAgeE1vbnRoc0FnbzogJ3swfSBtb24gYWdvJyxcbiAgICAgICAgICAgIHhZZWFyc0FnbzogJ3swfXkgYWdvJyxcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHZhciBkMSA9IG5ldyBEYXRlKCk7XG4gICAgdmFyIGQyID0gbmV3IERhdGUoZCk7XG4gICAgdmFyIHRvdGFsID0gcGFyc2VJbnQoKGQxIC0gZDIpIC8gMTAwMCAvIDYwKTtcblxuICAgIFN0cmluZy5wcm90b3R5cGUuZm9ybWF0ID0gZnVuY3Rpb24obykge1xuICAgICAgICByZXR1cm4gdGhpcy5yZXBsYWNlKCd7MH0nLCBvKTtcbiAgICB9XG5cbiAgICBpZiAodG90YWwgPT0gMCkge1xuICAgICAgICB2YXIgdGV4dCA9IHRleHRzLmp1c3ROb3c7XG4gICAgfSBlbHNlIGlmICh0b3RhbCA8IDkwKSB7XG4gICAgICAgIHZhciB0ZXh0ID0gdGV4dHMueE1pbnV0ZXNBZ28uZm9ybWF0KHRvdGFsKTtcbiAgICB9IGVsc2UgaWYgKHRvdGFsIDwgMTQ0MCkgeyAvLyBPbmUgZGF5XG4gICAgICAgIHZhciB0ZXh0ID0gdGV4dHMueEhvdXJzQWdvLmZvcm1hdChNYXRoLnJvdW5kKHRvdGFsLzYwKSk7XG4gICAgfSBlbHNlIGlmICh0b3RhbCA8IDIwMTYwKSB7IC8vIDE0IGRheXNcbiAgICAgICAgdmFyIHRleHQgPSB0ZXh0cy54RGF5c0Fnby5mb3JtYXQoTWF0aC5yb3VuZCh0b3RhbCAvIDE0NDApKTtcbiAgICB9IGVsc2UgaWYgKHRvdGFsIDwgNDMyMDApIHsgLy8gMzAgZGF5c1xuICAgICAgICB2YXIgdGV4dCA9IHRleHRzLnhXZWVrc0Fnby5mb3JtYXQoTWF0aC5yb3VuZCh0b3RhbCAvIDEwMDgwKSk7XG4gICAgfSBlbHNlIGlmICh0b3RhbCA8IDEwMzY4MDApIHsgLy8gMjQgbW9udGhzXG4gICAgICAgIHZhciB0ZXh0ID0gdGV4dHMueE1vbnRoc0Fnby5mb3JtYXQoTWF0aC5yb3VuZCh0b3RhbCAvIDQzMjAwKSk7XG4gICAgfSBlbHNlIHsgLy8gMjQgbW9udGhzK1xuICAgICAgICB2YXIgdGV4dCA9IHRleHRzLnhZZWFyc0Fnby5mb3JtYXQoTWF0aC5yb3VuZCh0b3RhbCAvIDUyNTYwMCkpO1xuICAgIH1cblxuICAgIHJldHVybiB0ZXh0O1xufVxuXG5qU3VpdGVzLmNhbGVuZGFyLnByZXR0aWZ5QWxsID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIGVsZW1lbnRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnByZXR0eWRhdGUnKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmIChlbGVtZW50c1tpXS5nZXRBdHRyaWJ1dGUoJ2RhdGEtZGF0ZScpKSB7XG4gICAgICAgICAgICBlbGVtZW50c1tpXS5pbm5lckhUTUwgPSBqU3VpdGVzLmNhbGVuZGFyLnByZXR0aWZ5KGVsZW1lbnRzW2ldLmdldEF0dHJpYnV0ZSgnZGF0YS1kYXRlJykpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZWxlbWVudHNbaV0uc2V0QXR0cmlidXRlKCdkYXRhLWRhdGUnLCBlbGVtZW50c1tpXS5pbm5lckhUTUwpO1xuICAgICAgICAgICAgZWxlbWVudHNbaV0uaW5uZXJIVE1MID0galN1aXRlcy5jYWxlbmRhci5wcmV0dGlmeShlbGVtZW50c1tpXS5pbm5lckhUTUwpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5qU3VpdGVzLmNhbGVuZGFyLm5vdyA9IGZ1bmN0aW9uKGRhdGUsIGRhdGVPbmx5KSB7XG4gICAgaWYgKCEgZGF0ZSkge1xuICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgfVxuICAgIHZhciB5ID0gZGF0ZS5nZXRGdWxsWWVhcigpO1xuICAgIHZhciBtID0gZGF0ZS5nZXRNb250aCgpICsgMTtcbiAgICB2YXIgZCA9IGRhdGUuZ2V0RGF0ZSgpO1xuICAgIHZhciBoID0gZGF0ZS5nZXRIb3VycygpO1xuICAgIHZhciBpID0gZGF0ZS5nZXRNaW51dGVzKCk7XG4gICAgdmFyIHMgPSBkYXRlLmdldFNlY29uZHMoKTtcblxuICAgIC8vIFR3byBkaWdpdHNcbiAgICB2YXIgdHdvID0gZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgdmFsdWUgPSAnJyArIHZhbHVlO1xuICAgICAgICBpZiAodmFsdWUubGVuZ3RoID09IDEpIHtcbiAgICAgICAgICAgIHZhbHVlID0gJzAnICsgdmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cblxuICAgIGlmIChkYXRlT25seSA9PSB0cnVlKSB7XG4gICAgICAgIHJldHVybiB0d28oeSkgKyAnLScgKyB0d28obSkgKyAnLScgKyB0d28oZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHR3byh5KSArICctJyArIHR3byhtKSArICctJyArIHR3byhkKSArICcgJyArIHR3byhoKSArICc6JyArIHR3byhpKSArICc6JyArIHR3byhzKTtcbiAgICB9XG59XG5cbi8vIEhlbHBlciB0byBleHRyYWN0IGRhdGUgZnJvbSBhIHN0cmluZ1xualN1aXRlcy5jYWxlbmRhci5leHRyYWN0RGF0ZUZyb21TdHJpbmcgPSBmdW5jdGlvbihkYXRlLCBmb3JtYXQpIHtcbiAgICB2YXIgdjEgPSAnJyArIGRhdGU7XG4gICAgdmFyIHYyID0gZm9ybWF0LnJlcGxhY2UoL1swLTldL2csJycpO1xuXG4gICAgdmFyIHRlc3QgPSAxO1xuXG4gICAgLy8gR2V0IHllYXJcbiAgICB2YXIgeSA9IHYyLnNlYXJjaChcIllZWVlcIik7XG4gICAgeSA9IHYxLnN1YnN0cih5LDQpO1xuICAgIGlmIChwYXJzZUludCh5KSAhPSB5KSB7XG4gICAgICAgIHRlc3QgPSAwO1xuICAgIH1cblxuICAgIC8vIEdldCBtb250aFxuICAgIHZhciBtID0gdjIuc2VhcmNoKFwiTU1cIik7XG4gICAgbSA9IHYxLnN1YnN0cihtLDIpO1xuICAgIGlmIChwYXJzZUludChtKSAhPSBtIHx8IGQgPiAxMikge1xuICAgICAgICB0ZXN0ID0gMDtcbiAgICB9XG5cbiAgICAvLyBHZXQgZGF5XG4gICAgdmFyIGQgPSB2Mi5zZWFyY2goXCJERFwiKTtcbiAgICBkID0gdjEuc3Vic3RyKGQsMik7XG4gICAgaWYgKHBhcnNlSW50KGQpICE9IGQgIHx8IGQgPiAzMSkge1xuICAgICAgICB0ZXN0ID0gMDtcbiAgICB9XG5cbiAgICAvLyBHZXQgaG91clxuICAgIHZhciBoID0gdjIuc2VhcmNoKFwiSEhcIik7XG4gICAgaWYgKGggPj0gMCkge1xuICAgICAgICBoID0gdjEuc3Vic3RyKGgsMik7XG4gICAgICAgIGlmICghIHBhcnNlSW50KGgpIHx8IGggPiAyMykge1xuICAgICAgICAgICAgaCA9ICcwMCc7XG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICBoID0gJzAwJztcbiAgICB9XG4gICAgXG4gICAgLy8gR2V0IG1pbnV0ZXNcbiAgICB2YXIgaSA9IHYyLnNlYXJjaChcIk1JXCIpO1xuICAgIGlmIChpID49IDApIHtcbiAgICAgICAgaSA9IHYxLnN1YnN0cihpLDIpO1xuICAgICAgICBpZiAoISBwYXJzZUludChpKSB8fCBpID4gNTkpIHtcbiAgICAgICAgICAgIGkgPSAnMDAnO1xuICAgICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICAgaSA9ICcwMCc7XG4gICAgfVxuXG4gICAgLy8gR2V0IHNlY29uZHNcbiAgICB2YXIgcyA9IHYyLnNlYXJjaChcIlNTXCIpO1xuICAgIGlmIChzID49IDApIHtcbiAgICAgICAgcyA9IHYxLnN1YnN0cihzLDIpO1xuICAgICAgICBpZiAoISBwYXJzZUludChzKSB8fCBzID4gNTkpIHtcbiAgICAgICAgICAgIHMgPSAnMDAnO1xuICAgICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcyA9ICcwMCc7XG4gICAgfVxuXG4gICAgaWYgKHRlc3QgPT0gMSAmJiBkYXRlLmxlbmd0aCA9PSB2Mi5sZW5ndGgpIHtcbiAgICAgICAgLy8gVXBkYXRlIHNvdXJjZVxuICAgICAgICB2YXIgZGF0YSA9IHkgKyAnLScgKyBtICsgJy0nICsgZCArICcgJyArIGggKyAnOicgKyAgaSArICc6JyArIHM7XG5cbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfVxuXG4gICAgcmV0dXJuICcnO1xufVxuXG4vLyBIZWxwZXIgdG8gY29udmVydCBkYXRlIGludG8gc3RyaW5nXG5qU3VpdGVzLmNhbGVuZGFyLmdldERhdGVTdHJpbmcgPSBmdW5jdGlvbih2YWx1ZSwgZm9ybWF0KSB7XG4gICAgLy8gRGVmYXVsdCBjYWxlbmRhclxuICAgIGlmICghIGZvcm1hdCkge1xuICAgICAgICB2YXIgZm9ybWF0ID0gJ0REL01NL1lZWVknO1xuICAgIH1cblxuICAgIGlmICh2YWx1ZSkge1xuICAgICAgICB2YXIgZCA9ICcnK3ZhbHVlO1xuICAgICAgICBkID0gZC5zcGxpdCgnICcpO1xuXG4gICAgICAgIHZhciBoID0gJyc7XG4gICAgICAgIHZhciBtID0gJyc7XG4gICAgICAgIHZhciBzID0gJyc7XG5cbiAgICAgICAgaWYgKGRbMV0pIHtcbiAgICAgICAgICAgIGggPSBkWzFdLnNwbGl0KCc6Jyk7XG4gICAgICAgICAgICBtID0gaFsxXSA/IGhbMV0gOiAnMDAnO1xuICAgICAgICAgICAgcyA9IGhbMl0gPyBoWzJdIDogJzAwJztcbiAgICAgICAgICAgIGggPSBoWzBdID8gaFswXSA6ICcwMCc7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBoID0gJzAwJztcbiAgICAgICAgICAgIG0gPSAnMDAnO1xuICAgICAgICAgICAgcyA9ICcwMCc7XG4gICAgICAgIH1cblxuICAgICAgICBkID0gZFswXS5zcGxpdCgnLScpO1xuXG4gICAgICAgIGlmIChkWzBdICYmIGRbMV0gJiYgZFsyXSAmJiBkWzBdID4gMCAmJiBkWzFdID4gMCAmJiBkWzFdIDwgMTMgJiYgZFsyXSA+IDAgJiYgZFsyXSA8IDMyKSB7XG4gICAgICAgICAgICB2YXIgY2FsZW5kYXIgPSBuZXcgRGF0ZShkWzBdLCBkWzFdLTEsIGRbMl0pO1xuICAgICAgICAgICAgdmFyIHdlZWtkYXkgPSBuZXcgQXJyYXkoJ1N1bmRheScsJ01vbmRheScsJ1R1ZXNkYXknLCdXZWRuZXNkYXknLCdUaHVyc2RheScsJ0ZyaWRheScsJ1NhdHVyZGF5Jyk7XG4gICAgICAgICAgICB2YXIgbW9udGhzID0gbmV3IEFycmF5KCdKYW4nLCAnRmViJywgJ01hcicsICdBcHInLCAnTWF5JywgJ0p1bicsICdKdWwnLCAnQXVnJywgJ1NlcCcsICdPY3QnLCAnTm92JywgJ0RlYycpO1xuXG4gICAgICAgICAgICBkWzFdID0gKGRbMV0ubGVuZ3RoIDwgMiA/ICcwJyA6ICcnKSArIGRbMV07XG4gICAgICAgICAgICBkWzJdID0gKGRbMl0ubGVuZ3RoIDwgMiA/ICcwJyA6ICcnKSArIGRbMl07XG4gICAgICAgICAgICBoID0gKGgubGVuZ3RoIDwgMiA/ICcwJyA6ICcnKSArIGg7XG4gICAgICAgICAgICBtID0gKG0ubGVuZ3RoIDwgMiA/ICcwJyA6ICcnKSArIG07XG4gICAgICAgICAgICBzID0gKHMubGVuZ3RoIDwgMiA/ICcwJyA6ICcnKSArIHM7XG5cbiAgICAgICAgICAgIHZhbHVlID0gZm9ybWF0O1xuICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKCdXRCcsIHdlZWtkYXlbY2FsZW5kYXIuZ2V0RGF5KCldKTtcbiAgICAgICAgICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZSgnREQnLCBkWzJdKTtcbiAgICAgICAgICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZSgnTU0nLCBkWzFdKTtcbiAgICAgICAgICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZSgnWVlZWScsIGRbMF0pO1xuICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKCdZWScsIGRbMF0uc3Vic3RyaW5nKDIsNCkpO1xuICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKCdNT04nLCBtb250aHNbcGFyc2VJbnQoZFsxXSktMV0udG9VcHBlckNhc2UoKSk7XG5cbiAgICAgICAgICAgIGlmIChoKSB7XG4gICAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKCdISDI0JywgaCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChoID4gMTIpIHtcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoJ0hIMTInLCBoIC0gMTIpO1xuICAgICAgICAgICAgICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZSgnSEgnLCBoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKCdISDEyJywgaCk7XG4gICAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKCdISCcsIGgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoJ01JJywgbSk7XG4gICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoJ01NJywgbSk7XG4gICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoJ1NTJywgcyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YWx1ZSA9ICcnO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHZhbHVlO1xufVxuXG5qU3VpdGVzLmNhbGVuZGFyLmlzT3BlbiA9IGZ1bmN0aW9uKGUpIHtcbiAgICBpZiAoalN1aXRlcy5jYWxlbmRhci5jdXJyZW50KSB7XG4gICAgICAgIGlmICghIGUudGFyZ2V0LmNsYXNzTmFtZSB8fCBlLnRhcmdldC5jbGFzc05hbWUuaW5kZXhPZignamNhbGVuZGFyJykgPT0gLTEpIHtcbiAgICAgICAgICAgIGpTdWl0ZXMuY2FsZW5kYXIuY3VycmVudC5jbG9zZShmYWxzZSwgZmFsc2UpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5pZiAoJ29udG91Y2hzdGFydCcgaW4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50ID09PSB0cnVlKSB7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoc3RhcnRcIiwgalN1aXRlcy5jYWxlbmRhci5pc09wZW4pO1xufSBlbHNlIHtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIGpTdWl0ZXMuY2FsZW5kYXIuaXNPcGVuKTtcbn1cclxuXHJcbmpTdWl0ZXMuY29sb3IgPSAoZnVuY3Rpb24oZWwsIG9wdGlvbnMpIHtcbiAgICB2YXIgb2JqID0ge307XG4gICAgb2JqLm9wdGlvbnMgPSB7fTtcbiAgICBvYmoudmFsdWVzID0gW107XG5cbiAgICAvLyBHbG9iYWwgY29udGFpbmVyXG4gICAgaWYgKCEgalN1aXRlcy5jb2xvci5jdXJyZW50KSB7XG4gICAgICAgIGpTdWl0ZXMuY29sb3IuY3VycmVudCA9IG51bGw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHR5cGVkZWYge09iamVjdH0gZGVmYXVsdHNcbiAgICAgKiBAcHJvcGVydHkgeyhzdHJpbmd8QXJyYXkpfSB2YWx1ZSAtIEluaXRpYWwgdmFsdWUgb2YgdGhlIGNvbXBvbnRlbnRcbiAgICAgKiBAcHJvcGVydHkge3N0cmluZ30gcGxhY2Vob2xkZXIgLSBUaGUgZGVmYXVsdCBpbnN0cnVjdGlvbiB0ZXh0IG9uIHRoZSBlbGVtZW50XG4gICAgICogQHByb3BlcnR5IHtyZXF1ZXN0Q2FsbGJhY2t9IG9uY2hhbmdlIC0gTWV0aG9kIHRvIGJlIGV4ZWN1dGUgYWZ0ZXIgYW55IGNoYW5nZXMgb24gdGhlIGVsZW1lbnRcbiAgICAgKiBAcHJvcGVydHkge3JlcXVlc3RDYWxsYmFja30gb25jbG9zZSAtIE1ldGhvZCB0byBiZSBleGVjdXRlIHdoZW4gdGhlIGVsZW1lbnQgaXMgY2xvc2VkXG4gICAgICovXG4gICAgdmFyIGRlZmF1bHRzID0ge1xuICAgICAgICBwbGFjZWhvbGRlcjogJycsXG4gICAgICAgIHZhbHVlOiBudWxsLFxuICAgICAgICBvbmNsb3NlOiBudWxsLFxuICAgICAgICBvbmNoYW5nZTogbnVsbCxcbiAgICAgICAgY2xvc2VPbkNoYW5nZTogdHJ1ZSxcbiAgICB9O1xuXG4gICAgLy8gTG9vcCB0aHJvdWdoIG91ciBvYmplY3RcbiAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBkZWZhdWx0cykge1xuICAgICAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmhhc093blByb3BlcnR5KHByb3BlcnR5KSkge1xuICAgICAgICAgICAgb2JqLm9wdGlvbnNbcHJvcGVydHldID0gb3B0aW9uc1twcm9wZXJ0eV07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBvYmoub3B0aW9uc1twcm9wZXJ0eV0gPSBkZWZhdWx0c1twcm9wZXJ0eV07XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgcGFsZXR0ZSA9IHtcbiAgICAgICAgICBcInJlZFwiOiB7XG4gICAgICAgICAgICBcIjUwXCI6IFwiI2ZmZWJlZVwiLFxuICAgICAgICAgICAgXCIxMDBcIjogXCIjZmZjZGQyXCIsXG4gICAgICAgICAgICBcIjIwMFwiOiBcIiNlZjlhOWFcIixcbiAgICAgICAgICAgIFwiMzAwXCI6IFwiI2U1NzM3M1wiLFxuICAgICAgICAgICAgXCI0MDBcIjogXCIjZWY1MzUwXCIsXG4gICAgICAgICAgICBcIjUwMFwiOiBcIiNmNDQzMzZcIixcbiAgICAgICAgICAgIFwiNjAwXCI6IFwiI2U1MzkzNVwiLFxuICAgICAgICAgICAgXCI3MDBcIjogXCIjZDMyZjJmXCIsXG4gICAgICAgICAgICBcIjgwMFwiOiBcIiNjNjI4MjhcIixcbiAgICAgICAgICAgIFwiOTAwXCI6IFwiI2I3MWMxY1wiLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJwaW5rXCI6IHtcbiAgICAgICAgICAgIFwiNTBcIjogXCIjZmNlNGVjXCIsXG4gICAgICAgICAgICBcIjEwMFwiOiBcIiNmOGJiZDBcIixcbiAgICAgICAgICAgIFwiMjAwXCI6IFwiI2Y0OGZiMVwiLFxuICAgICAgICAgICAgXCIzMDBcIjogXCIjZjA2MjkyXCIsXG4gICAgICAgICAgICBcIjQwMFwiOiBcIiNlYzQwN2FcIixcbiAgICAgICAgICAgIFwiNTAwXCI6IFwiI2U5MWU2M1wiLFxuICAgICAgICAgICAgXCI2MDBcIjogXCIjZDgxYjYwXCIsXG4gICAgICAgICAgICBcIjcwMFwiOiBcIiNjMjE4NWJcIixcbiAgICAgICAgICAgIFwiODAwXCI6IFwiI2FkMTQ1N1wiLFxuICAgICAgICAgICAgXCI5MDBcIjogXCIjODgwZTRmXCIsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInB1cnBsZVwiOiB7XG4gICAgICAgICAgICBcIjUwXCI6IFwiI2YzZTVmNVwiLFxuICAgICAgICAgICAgXCIxMDBcIjogXCIjZTFiZWU3XCIsXG4gICAgICAgICAgICBcIjIwMFwiOiBcIiNjZTkzZDhcIixcbiAgICAgICAgICAgIFwiMzAwXCI6IFwiI2JhNjhjOFwiLFxuICAgICAgICAgICAgXCI0MDBcIjogXCIjYWI0N2JjXCIsXG4gICAgICAgICAgICBcIjUwMFwiOiBcIiM5YzI3YjBcIixcbiAgICAgICAgICAgIFwiNjAwXCI6IFwiIzhlMjRhYVwiLFxuICAgICAgICAgICAgXCI3MDBcIjogXCIjN2IxZmEyXCIsXG4gICAgICAgICAgICBcIjgwMFwiOiBcIiM2YTFiOWFcIixcbiAgICAgICAgICAgIFwiOTAwXCI6IFwiIzRhMTQ4Y1wiLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJpbmRpZ29cIjoge1xuICAgICAgICAgICAgXCI1MFwiOiBcIiNlOGVhZjZcIixcbiAgICAgICAgICAgIFwiMTAwXCI6IFwiI2M1Y2FlOVwiLFxuICAgICAgICAgICAgXCIyMDBcIjogXCIjOWZhOGRhXCIsXG4gICAgICAgICAgICBcIjMwMFwiOiBcIiM3OTg2Y2JcIixcbiAgICAgICAgICAgIFwiNDAwXCI6IFwiIzVjNmJjMFwiLFxuICAgICAgICAgICAgXCI1MDBcIjogXCIjM2Y1MWI1XCIsXG4gICAgICAgICAgICBcIjYwMFwiOiBcIiMzOTQ5YWJcIixcbiAgICAgICAgICAgIFwiNzAwXCI6IFwiIzMwM2Y5ZlwiLFxuICAgICAgICAgICAgXCI4MDBcIjogXCIjMjgzNTkzXCIsXG4gICAgICAgICAgICBcIjkwMFwiOiBcIiMxYTIzN2VcIixcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiYmx1ZVwiOiB7XG4gICAgICAgICAgICBcIjUwXCI6IFwiI2UzZjJmZFwiLFxuICAgICAgICAgICAgXCIxMDBcIjogXCIjYmJkZWZiXCIsXG4gICAgICAgICAgICBcIjIwMFwiOiBcIiM5MGNhZjlcIixcbiAgICAgICAgICAgIFwiMzAwXCI6IFwiIzY0YjVmNlwiLFxuICAgICAgICAgICAgXCI0MDBcIjogXCIjNDJhNWY1XCIsXG4gICAgICAgICAgICBcIjUwMFwiOiBcIiMyMTk2ZjNcIixcbiAgICAgICAgICAgIFwiNjAwXCI6IFwiIzFlODhlNVwiLFxuICAgICAgICAgICAgXCI3MDBcIjogXCIjMTk3NmQyXCIsXG4gICAgICAgICAgICBcIjgwMFwiOiBcIiMxNTY1YzBcIixcbiAgICAgICAgICAgIFwiOTAwXCI6IFwiIzBkNDdhMVwiLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJjeWFuXCI6IHtcbiAgICAgICAgICAgIFwiNTBcIjogXCIjZTBmN2ZhXCIsXG4gICAgICAgICAgICBcIjEwMFwiOiBcIiNiMmViZjJcIixcbiAgICAgICAgICAgIFwiMjAwXCI6IFwiIzgwZGVlYVwiLFxuICAgICAgICAgICAgXCIzMDBcIjogXCIjNGRkMGUxXCIsXG4gICAgICAgICAgICBcIjQwMFwiOiBcIiMyNmM2ZGFcIixcbiAgICAgICAgICAgIFwiNTAwXCI6IFwiIzAwYmNkNFwiLFxuICAgICAgICAgICAgXCI2MDBcIjogXCIjMDBhY2MxXCIsXG4gICAgICAgICAgICBcIjcwMFwiOiBcIiMwMDk3YTdcIixcbiAgICAgICAgICAgIFwiODAwXCI6IFwiIzAwODM4ZlwiLFxuICAgICAgICAgICAgXCI5MDBcIjogXCIjMDA2MDY0XCIsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInRlYWxcIjoge1xuICAgICAgICAgICAgXCI1MFwiOiBcIiNlMGYyZjFcIixcbiAgICAgICAgICAgIFwiMTAwXCI6IFwiI2IyZGZkYlwiLFxuICAgICAgICAgICAgXCIyMDBcIjogXCIjODBjYmM0XCIsXG4gICAgICAgICAgICBcIjMwMFwiOiBcIiM0ZGI2YWNcIixcbiAgICAgICAgICAgIFwiNDAwXCI6IFwiIzI2YTY5YVwiLFxuICAgICAgICAgICAgXCI1MDBcIjogXCIjMDA5Njg4XCIsXG4gICAgICAgICAgICBcIjYwMFwiOiBcIiMwMDg5N2JcIixcbiAgICAgICAgICAgIFwiNzAwXCI6IFwiIzAwNzk2YlwiLFxuICAgICAgICAgICAgXCI4MDBcIjogXCIjMDA2OTVjXCIsXG4gICAgICAgICAgICBcIjkwMFwiOiBcIiMwMDRkNDBcIixcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiZ3JlZW5cIjoge1xuICAgICAgICAgICAgXCI1MFwiOiBcIiNlOGY1ZTlcIixcbiAgICAgICAgICAgIFwiMTAwXCI6IFwiI2M4ZTZjOVwiLFxuICAgICAgICAgICAgXCIyMDBcIjogXCIjYTVkNmE3XCIsXG4gICAgICAgICAgICBcIjMwMFwiOiBcIiM4MWM3ODRcIixcbiAgICAgICAgICAgIFwiNDAwXCI6IFwiIzY2YmI2YVwiLFxuICAgICAgICAgICAgXCI1MDBcIjogXCIjNGNhZjUwXCIsXG4gICAgICAgICAgICBcIjYwMFwiOiBcIiM0M2EwNDdcIixcbiAgICAgICAgICAgIFwiNzAwXCI6IFwiIzM4OGUzY1wiLFxuICAgICAgICAgICAgXCI4MDBcIjogXCIjMmU3ZDMyXCIsXG4gICAgICAgICAgICBcIjkwMFwiOiBcIiMxYjVlMjBcIixcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwibGlnaHRncmVlblwiOiB7XG4gICAgICAgICAgICBcIjUwXCI6IFwiI2YxZjhlOVwiLFxuICAgICAgICAgICAgXCIxMDBcIjogXCIjZGNlZGM4XCIsXG4gICAgICAgICAgICBcIjIwMFwiOiBcIiNjNWUxYTVcIixcbiAgICAgICAgICAgIFwiMzAwXCI6IFwiI2FlZDU4MVwiLFxuICAgICAgICAgICAgXCI0MDBcIjogXCIjOWNjYzY1XCIsXG4gICAgICAgICAgICBcIjUwMFwiOiBcIiM4YmMzNGFcIixcbiAgICAgICAgICAgIFwiNjAwXCI6IFwiIzdjYjM0MlwiLFxuICAgICAgICAgICAgXCI3MDBcIjogXCIjNjg5ZjM4XCIsXG4gICAgICAgICAgICBcIjgwMFwiOiBcIiM1NThiMmZcIixcbiAgICAgICAgICAgIFwiOTAwXCI6IFwiIzMzNjkxZVwiLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJsaW1lXCI6IHtcbiAgICAgICAgICAgIFwiNTBcIjogXCIjZjlmYmU3XCIsXG4gICAgICAgICAgICBcIjEwMFwiOiBcIiNmMGY0YzNcIixcbiAgICAgICAgICAgIFwiMjAwXCI6IFwiI2U2ZWU5Y1wiLFxuICAgICAgICAgICAgXCIzMDBcIjogXCIjZGNlNzc1XCIsXG4gICAgICAgICAgICBcIjQwMFwiOiBcIiNkNGUxNTdcIixcbiAgICAgICAgICAgIFwiNTAwXCI6IFwiI2NkZGMzOVwiLFxuICAgICAgICAgICAgXCI2MDBcIjogXCIjYzBjYTMzXCIsXG4gICAgICAgICAgICBcIjcwMFwiOiBcIiNhZmI0MmJcIixcbiAgICAgICAgICAgIFwiODAwXCI6IFwiIzllOWQyNFwiLFxuICAgICAgICAgICAgXCI5MDBcIjogXCIjODI3NzE3XCIsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInllbGxvd1wiOiB7XG4gICAgICAgICAgICBcIjUwXCI6IFwiI2ZmZmRlN1wiLFxuICAgICAgICAgICAgXCIxMDBcIjogXCIjZmZmOWM0XCIsXG4gICAgICAgICAgICBcIjIwMFwiOiBcIiNmZmY1OWRcIixcbiAgICAgICAgICAgIFwiMzAwXCI6IFwiI2ZmZjE3NlwiLFxuICAgICAgICAgICAgXCI0MDBcIjogXCIjZmZlZTU4XCIsXG4gICAgICAgICAgICBcIjUwMFwiOiBcIiNmZmViM2JcIixcbiAgICAgICAgICAgIFwiNjAwXCI6IFwiI2ZkZDgzNVwiLFxuICAgICAgICAgICAgXCI3MDBcIjogXCIjZmJjMDJkXCIsXG4gICAgICAgICAgICBcIjgwMFwiOiBcIiNmOWE4MjVcIixcbiAgICAgICAgICAgIFwiOTAwXCI6IFwiI2Y1N2YxN1wiLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJhbWJlclwiOiB7XG4gICAgICAgICAgICBcIjUwXCI6IFwiI2ZmZjhlMVwiLFxuICAgICAgICAgICAgXCIxMDBcIjogXCIjZmZlY2IzXCIsXG4gICAgICAgICAgICBcIjIwMFwiOiBcIiNmZmUwODJcIixcbiAgICAgICAgICAgIFwiMzAwXCI6IFwiI2ZmZDU0ZlwiLFxuICAgICAgICAgICAgXCI0MDBcIjogXCIjZmZjYTI4XCIsXG4gICAgICAgICAgICBcIjUwMFwiOiBcIiNmZmMxMDdcIixcbiAgICAgICAgICAgIFwiNjAwXCI6IFwiI2ZmYjMwMFwiLFxuICAgICAgICAgICAgXCI3MDBcIjogXCIjZmZhMDAwXCIsXG4gICAgICAgICAgICBcIjgwMFwiOiBcIiNmZjhmMDBcIixcbiAgICAgICAgICAgIFwiOTAwXCI6IFwiI2ZmNmYwMFwiLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJvcmFuZ2VcIjoge1xuICAgICAgICAgICAgXCI1MFwiOiBcIiNmZmYzZTBcIixcbiAgICAgICAgICAgIFwiMTAwXCI6IFwiI2ZmZTBiMlwiLFxuICAgICAgICAgICAgXCIyMDBcIjogXCIjZmZjYzgwXCIsXG4gICAgICAgICAgICBcIjMwMFwiOiBcIiNmZmI3NGRcIixcbiAgICAgICAgICAgIFwiNDAwXCI6IFwiI2ZmYTcyNlwiLFxuICAgICAgICAgICAgXCI1MDBcIjogXCIjZmY5ODAwXCIsXG4gICAgICAgICAgICBcIjYwMFwiOiBcIiNmYjhjMDBcIixcbiAgICAgICAgICAgIFwiNzAwXCI6IFwiI2Y1N2MwMFwiLFxuICAgICAgICAgICAgXCI4MDBcIjogXCIjZWY2YzAwXCIsXG4gICAgICAgICAgICBcIjkwMFwiOiBcIiNlNjUxMDBcIixcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiZGVlcG9yYW5nZVwiOiB7XG4gICAgICAgICAgICBcIjUwXCI6IFwiI2ZiZTllN1wiLFxuICAgICAgICAgICAgXCIxMDBcIjogXCIjZmZjY2JjXCIsXG4gICAgICAgICAgICBcIjIwMFwiOiBcIiNmZmFiOTFcIixcbiAgICAgICAgICAgIFwiMzAwXCI6IFwiI2ZmOGE2NVwiLFxuICAgICAgICAgICAgXCI0MDBcIjogXCIjZmY3MDQzXCIsXG4gICAgICAgICAgICBcIjUwMFwiOiBcIiNmZjU3MjJcIixcbiAgICAgICAgICAgIFwiNjAwXCI6IFwiI2Y0NTExZVwiLFxuICAgICAgICAgICAgXCI3MDBcIjogXCIjZTY0YTE5XCIsXG4gICAgICAgICAgICBcIjgwMFwiOiBcIiNkODQzMTVcIixcbiAgICAgICAgICAgIFwiOTAwXCI6IFwiI2JmMzYwY1wiLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJicm93blwiOiB7XG4gICAgICAgICAgICBcIjUwXCI6IFwiI2VmZWJlOVwiLFxuICAgICAgICAgICAgXCIxMDBcIjogXCIjZDdjY2M4XCIsXG4gICAgICAgICAgICBcIjIwMFwiOiBcIiNiY2FhYTRcIixcbiAgICAgICAgICAgIFwiMzAwXCI6IFwiI2ExODg3ZlwiLFxuICAgICAgICAgICAgXCI0MDBcIjogXCIjOGQ2ZTYzXCIsXG4gICAgICAgICAgICBcIjUwMFwiOiBcIiM3OTU1NDhcIixcbiAgICAgICAgICAgIFwiNjAwXCI6IFwiIzZkNGM0MVwiLFxuICAgICAgICAgICAgXCI3MDBcIjogXCIjNWQ0MDM3XCIsXG4gICAgICAgICAgICBcIjgwMFwiOiBcIiM0ZTM0MmVcIixcbiAgICAgICAgICAgIFwiOTAwXCI6IFwiIzNlMjcyM1wiXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImdyZXlcIjoge1xuICAgICAgICAgICAgXCI1MFwiOiBcIiNmYWZhZmFcIixcbiAgICAgICAgICAgIFwiMTAwXCI6IFwiI2Y1ZjVmNVwiLFxuICAgICAgICAgICAgXCIyMDBcIjogXCIjZWVlZWVlXCIsXG4gICAgICAgICAgICBcIjMwMFwiOiBcIiNlMGUwZTBcIixcbiAgICAgICAgICAgIFwiNDAwXCI6IFwiI2JkYmRiZFwiLFxuICAgICAgICAgICAgXCI1MDBcIjogXCIjOWU5ZTllXCIsXG4gICAgICAgICAgICBcIjYwMFwiOiBcIiM3NTc1NzVcIixcbiAgICAgICAgICAgIFwiNzAwXCI6IFwiIzYxNjE2MVwiLFxuICAgICAgICAgICAgXCI4MDBcIjogXCIjNDI0MjQyXCIsXG4gICAgICAgICAgICBcIjkwMFwiOiBcIiMyMTIxMjFcIlxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJibHVlZ3JleVwiOiB7XG4gICAgICAgICAgICBcIjUwXCI6IFwiI2VjZWZmMVwiLFxuICAgICAgICAgICAgXCIxMDBcIjogXCIjY2ZkOGRjXCIsXG4gICAgICAgICAgICBcIjIwMFwiOiBcIiNiMGJlYzVcIixcbiAgICAgICAgICAgIFwiMzAwXCI6IFwiIzkwYTRhZVwiLFxuICAgICAgICAgICAgXCI0MDBcIjogXCIjNzg5MDljXCIsXG4gICAgICAgICAgICBcIjUwMFwiOiBcIiM2MDdkOGJcIixcbiAgICAgICAgICAgIFwiNjAwXCI6IFwiIzU0NmU3YVwiLFxuICAgICAgICAgICAgXCI3MDBcIjogXCIjNDU1YTY0XCIsXG4gICAgICAgICAgICBcIjgwMFwiOiBcIiMzNzQ3NGZcIixcbiAgICAgICAgICAgIFwiOTAwXCI6IFwiIzI2MzIzOFwiXG4gICAgICAgICAgfVxuICAgIH07XG5cbiAgICB2YXIgeCA9IDA7XG4gICAgdmFyIHkgPSAwO1xuICAgIHZhciBjb2xvcnMgPSBbXTtcblxuICAgIHZhciBjb2wgPSBPYmplY3Qua2V5cyhwYWxldHRlKTtcbiAgICB2YXIgc2hhZGUgPSBPYmplY3Qua2V5cyhwYWxldHRlW2NvbFswXV0pO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb2wubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzaGFkZS5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgaWYgKCEgY29sb3JzW2pdKSB7XG4gICAgICAgICAgICAgICAgY29sb3JzW2pdID0gW107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb2xvcnNbal1baV0gPSBwYWxldHRlW2NvbFtpXV1bc2hhZGVbal1dO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8vIFZhbHVlXG4gICAgaWYgKG9iai5vcHRpb25zLnZhbHVlKSB7XG4gICAgICAgIGVsLnZhbHVlID0gb2JqLm9wdGlvbnMudmFsdWU7XG4gICAgfVxuXG4gICAgLy8gVGFibGUgY29udGFpbmVyXG4gICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGNvbnRhaW5lci5jbGFzc05hbWUgPSAnamNvbG9yJztcblxuICAgIC8vIFRhYmxlIGNvbnRhaW5lclxuICAgIHZhciBiYWNrZHJvcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGJhY2tkcm9wLmNsYXNzTmFtZSA9ICdqY29sb3ItYmFja2Ryb3AnO1xuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChiYWNrZHJvcCk7XG5cbiAgICAvLyBDb250ZW50XG4gICAgdmFyIGNvbnRlbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBjb250ZW50LmNsYXNzTmFtZSA9ICdqY29sb3ItY29udGVudCc7XG5cbiAgICAvLyBDbG9zZSBidXR0b25cbiAgICB2YXIgY2xvc2VCdXR0b24gID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgY2xvc2VCdXR0b24uY2xhc3NOYW1lID0gJ2pjb2xvci1jbG9zZSc7XG4gICAgY2xvc2VCdXR0b24uaW5uZXJIVE1MID0gJ0RvbmUnO1xuICAgIGNsb3NlQnV0dG9uLm9uY2xpY2sgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgb2JqLmNsb3NlKCk7XG4gICAgfVxuICAgIGNvbnRlbnQuYXBwZW5kQ2hpbGQoY2xvc2VCdXR0b24pO1xuXG4gICAgLy8gVGFibGUgcGFsbGV0ZVxuICAgIHZhciB0YWJsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RhYmxlJyk7XG4gICAgdGFibGUuc2V0QXR0cmlidXRlKCdjZWxscGFkZGluZycsICc3Jyk7XG4gICAgdGFibGUuc2V0QXR0cmlidXRlKCdjZWxsc3BhY2luZycsICcwJyk7XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvbG9ycy5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgdHIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpO1xuICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGNvbG9yc1tpXS5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgdmFyIHRkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcbiAgICAgICAgICAgIHRkLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGNvbG9yc1tpXVtqXTtcbiAgICAgICAgICAgIHRkLnNldEF0dHJpYnV0ZSgnZGF0YS12YWx1ZScsIGNvbG9yc1tpXVtqXSk7XG4gICAgICAgICAgICB0ZC5pbm5lckhUTUwgPSAnJztcbiAgICAgICAgICAgIHRyLmFwcGVuZENoaWxkKHRkKTtcblxuICAgICAgICAgICAgLy8gU2VsZWN0ZWQgY29sb3JcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy52YWx1ZSA9PSBjb2xvcnNbaV1bal0pIHtcbiAgICAgICAgICAgICAgICB0ZC5jbGFzc0xpc3QuYWRkKCdqY29sb3Itc2VsZWN0ZWQnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gUG9zc2libGUgdmFsdWVzXG4gICAgICAgICAgICBvYmoudmFsdWVzW2NvbG9yc1tpXVtqXV0gPSB0ZDtcbiAgICAgICAgfVxuICAgICAgICB0YWJsZS5hcHBlbmRDaGlsZCh0cik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogT3BlbiBjb2xvciBwYWxsZXRlXG4gICAgICovXG4gICAgb2JqLm9wZW4gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKGpTdWl0ZXMuY29sb3IuY3VycmVudCkge1xuICAgICAgICAgICAgaWYgKGpTdWl0ZXMuY29sb3IuY3VycmVudCAhPSBvYmopIHtcbiAgICAgICAgICAgICAgICBqU3VpdGVzLmNvbG9yLmN1cnJlbnQuY2xvc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghIGpTdWl0ZXMuY29sb3IuY3VycmVudCkge1xuICAgICAgICAgICAgLy8gUGVyc2lzdCBlbGVtZW50XG4gICAgICAgICAgICBqU3VpdGVzLmNvbG9yLmN1cnJlbnQgPSBvYmo7XG4gICAgICAgICAgICAvLyBTaG93IGNvbG9ycGlja2VyXG4gICAgICAgICAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZCgnamNvbG9yLWZvY3VzJyk7XG5cbiAgICAgICAgICAgIGNvbnN0IHJlY3RDb250ZW50ID0gY29udGVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAgICAgICAgICAgaWYgKGpTdWl0ZXMuZ2V0V2luZG93V2lkdGgoKSA8IDgwMCkge1xuICAgICAgICAgICAgICAgIGNvbnRlbnQuc3R5bGUudG9wID0gJyc7XG4gICAgICAgICAgICAgICAgY29udGVudC5jbGFzc0xpc3QuYWRkKCdqY29sb3ItZnVsbHNjcmVlbicpO1xuICAgICAgICAgICAgICAgIGpTdWl0ZXMuc2xpZGVCb3R0b20oY29udGVudCwgMSk7XG4gICAgICAgICAgICAgICAgYmFja2Ryb3Auc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChjb250ZW50LmNsYXNzTGlzdC5jb250YWlucygnamNvbG9yLWZ1bGxzY3JlZW4nKSkge1xuICAgICAgICAgICAgICAgICAgICBjb250ZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2pjb2xvci1mdWxsc2NyZWVuJyk7XG4gICAgICAgICAgICAgICAgICAgIGJhY2tkcm9wLnN0eWxlLmRpc3BsYXkgPSAnJztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjb25zdCByZWN0ID0gZWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cbiAgICAgICAgICAgICAgICBpZiAod2luZG93LmlubmVySGVpZ2h0IDwgcmVjdC5ib3R0b20gKyByZWN0Q29udGVudC5oZWlnaHQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGVudC5zdHlsZS50b3AgPSAtMSAqIChyZWN0Q29udGVudC5oZWlnaHQgKyByZWN0LmhlaWdodCArIDIpICsgJ3B4JztcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb250ZW50LnN0eWxlLnRvcCA9ICcycHgnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29udGFpbmVyLmZvY3VzKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDbG9zZSBjb2xvciBwYWxsZXRlXG4gICAgICovXG4gICAgb2JqLmNsb3NlID0gZnVuY3Rpb24oaWdub3JlRXZlbnRzKSB7XG4gICAgICAgIGlmIChqU3VpdGVzLmNvbG9yLmN1cnJlbnQpIHtcbiAgICAgICAgICAgIGpTdWl0ZXMuY29sb3IuY3VycmVudCA9IG51bGw7XG4gICAgICAgICAgICBpZiAoISBpZ25vcmVFdmVudHMgJiYgdHlwZW9mKG9iai5vcHRpb25zLm9uY2xvc2UpID09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5vbmNsb3NlKGVsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdqY29sb3ItZm9jdXMnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIE1ha2Ugc3VyZSBiYWNrZHJvcCBpcyBoaWRkZW5cbiAgICAgICAgYmFja2Ryb3Auc3R5bGUuZGlzcGxheSA9ICcnO1xuXG4gICAgICAgIHJldHVybiBvYmoub3B0aW9ucy52YWx1ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXQgdmFsdWVcbiAgICAgKi9cbiAgICBvYmouc2V0VmFsdWUgPSBmdW5jdGlvbihjb2xvcikge1xuICAgICAgICBpZiAoY29sb3IpIHtcbiAgICAgICAgICAgIGVsLnZhbHVlID0gY29sb3I7XG4gICAgICAgICAgICBvYmoub3B0aW9ucy52YWx1ZSA9IGNvbG9yO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gUmVtb3ZlIGN1cnJlbnQgc2VsZWNkZWQgbWFya1xuICAgICAgICB2YXIgc2VsZWN0ZWQgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignLmpjb2xvci1zZWxlY3RlZCcpO1xuICAgICAgICBpZiAoc2VsZWN0ZWQpIHtcbiAgICAgICAgICAgIHNlbGVjdGVkLmNsYXNzTGlzdC5yZW1vdmUoJ2pjb2xvci1zZWxlY3RlZCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gTWFyayBjZWxsIGFzIHNlbGVjdGVkXG4gICAgICAgIG9iai52YWx1ZXNbY29sb3JdLmNsYXNzTGlzdC5hZGQoJ2pjb2xvci1zZWxlY3RlZCcpO1xuXG4gICAgICAgIC8vIE9uY2hhbmdlXG4gICAgICAgIGlmICh0eXBlb2Yob2JqLm9wdGlvbnMub25jaGFuZ2UpID09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIG9iai5vcHRpb25zLm9uY2hhbmdlKGVsLCBjb2xvcik7XG4gICAgICAgIH1cblxyXG4gICAgICAgIGlmIChvYmoub3B0aW9ucy5jbG9zZU9uQ2hhbmdlID09IHRydWUpIHtcclxuICAgICAgICAgICAgb2JqLmNsb3NlKCk7XHJcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCB2YWx1ZVxuICAgICAqL1xuICAgIG9iai5nZXRWYWx1ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gb2JqLm9wdGlvbnMudmFsdWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSWYgZWxlbWVudCBpcyBmb2N1cyBvcGVuIHRoZSBwaWNrZXJcbiAgICAgKi9cbiAgICBlbC5hZGRFdmVudExpc3RlbmVyKFwiZm9jdXNcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgICBvYmoub3BlbigpO1xuICAgIH0pO1xuXG4gICAgZWwuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIGlmICghIGpTdWl0ZXMuY29sb3IuY3VycmVudCkge1xyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIG9iai5vcGVuKCk7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICB9LCAyMDApO1xyXG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIFNlbGVjdCBjb2xvclxuICAgIGNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFwibW91c2V1cFwiLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIGlmIChlLnRhcmdldC50YWdOYW1lID09ICdURCcpIHtcbiAgICAgICAgICAgIGpTdWl0ZXMuY29sb3IuY3VycmVudC5zZXRWYWx1ZShlLnRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtdmFsdWUnKSk7XG5cclxuICAgICAgICAgICAgaWYgKGpTdWl0ZXMuY29sb3IuY3VycmVudCkge1xuICAgICAgICAgICAgICAgIGpTdWl0ZXMuY29sb3IuY3VycmVudC5jbG9zZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBDbG9zZSBjb250cm9sbGVyXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIGlmIChqU3VpdGVzLmNvbG9yLmN1cnJlbnQpIHtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0galN1aXRlcy5nZXRFbGVtZW50KGUudGFyZ2V0LCAnamNvbG9yJyk7XG4gICAgICAgICAgICBpZiAoISBlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgalN1aXRlcy5jb2xvci5jdXJyZW50LmNsb3NlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIFBvc3NpYmxlIHRvIGZvY3VzIHRoZSBjb250YWluZXJcbiAgICBjb250YWluZXIuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICc5MDAnKTtcblxuICAgIC8vIFBsYWNlaG9sZGVyXG4gICAgaWYgKG9iai5vcHRpb25zLnBsYWNlaG9sZGVyKSB7XG4gICAgICAgIGVsLnNldEF0dHJpYnV0ZSgncGxhY2Vob2xkZXInLCBvYmoub3B0aW9ucy5wbGFjZWhvbGRlcik7XG4gICAgfVxuXG4gICAgLy8gQXBwZW5kIHRvIHRoZSB0YWJsZVxuICAgIGNvbnRlbnQuYXBwZW5kQ2hpbGQodGFibGUpO1xuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChjb250ZW50KTtcblxuICAgIC8vIEluc2VydCBwaWNrZXIgYWZ0ZXIgdGhlIGVsZW1lbnRcbiAgICBpZiAoZWwudGFnTmFtZSA9PSAnSU5QVVQnKSB7XG4gICAgICAgIGVsLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGNvbnRhaW5lciwgZWwubmV4dFNpYmxpbmcpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGVsLmFwcGVuZENoaWxkKGNvbnRhaW5lcik7XG4gICAgfVxuXG4gICAgLy8gS2VlcCBvYmplY3QgYXZhaWxhYmxlIGZyb20gdGhlIG5vZGVcbiAgICBlbC5jb2xvciA9IG9iajtcblxuICAgIHJldHVybiBvYmo7XG59KTtcblxyXG5cclxualN1aXRlcy5jb250ZXh0bWVudSA9IChmdW5jdGlvbihlbCwgb3B0aW9ucykge1xuICAgIHZhciBvYmogPSB7fTtcbiAgICBvYmoub3B0aW9ucyA9IHt9O1xuXG4gICAgLy8gRGVmYXVsdCBjb25maWd1cmF0aW9uXG4gICAgdmFyIGRlZmF1bHRzID0ge1xuICAgICAgICBpdGVtczogbnVsbCxcbiAgICAgICAgb25jbGljazogbnVsbCxcbiAgICB9O1xuXG4gICAgLy8gTG9vcCB0aHJvdWdoIG91ciBvYmplY3RcbiAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBkZWZhdWx0cykge1xuICAgICAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmhhc093blByb3BlcnR5KHByb3BlcnR5KSkge1xuICAgICAgICAgICAgb2JqLm9wdGlvbnNbcHJvcGVydHldID0gb3B0aW9uc1twcm9wZXJ0eV07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBvYmoub3B0aW9uc1twcm9wZXJ0eV0gPSBkZWZhdWx0c1twcm9wZXJ0eV07XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDbGFzcyBkZWZpbml0aW9uXG4gICAgZWwuY2xhc3NMaXN0LmFkZCgnamNvbnRleHRtZW51Jyk7XG4gICAgLy8gRm9jdXNhYmxlXG4gICAgZWwuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICc5MDAnKTtcblxuICAgIC8qKlxuICAgICAqIE9wZW4gY29udGV4dG1lbnVcbiAgICAgKi9cbiAgICBvYmoub3BlbiA9IGZ1bmN0aW9uKGUsIGl0ZW1zKSB7XG4gICAgICAgIGlmIChpdGVtcykge1xuICAgICAgICAgICAgLy8gVXBkYXRlIGNvbnRlbnRcbiAgICAgICAgICAgIG9iai5vcHRpb25zLml0ZW1zID0gaXRlbXM7XG4gICAgICAgICAgICAvLyBDcmVhdGUgaXRlbXNcbiAgICAgICAgICAgIG9iai5jcmVhdGUoaXRlbXMpO1xuICAgICAgICB9XG4gICAgICAgIC8vIENvb3JkaW5hdGVzXG4gICAgICAgIGlmIChlLnRhcmdldCkge1xuICAgICAgICAgICAgdmFyIHggPSBlLmNsaWVudFg7XG4gICAgICAgICAgICB2YXIgeSA9IGUuY2xpZW50WTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciB4ID0gZS54O1xuICAgICAgICAgICAgdmFyIHkgPSBlLnk7XG4gICAgICAgIH1cblxuICAgICAgICBlbC5jbGFzc0xpc3QuYWRkKCdqY29udGV4dG1lbnUtZm9jdXMnKTtcbiAgICAgICAgZWwuZm9jdXMoKTtcblxuICAgICAgICBjb25zdCByZWN0ID0gZWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cbiAgICAgICAgaWYgKHdpbmRvdy5pbm5lckhlaWdodCA8IHkgKyByZWN0LmhlaWdodCkge1xuICAgICAgICAgICAgZWwuc3R5bGUudG9wID0gKHkgLSByZWN0LmhlaWdodCkgKyAncHgnO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZWwuc3R5bGUudG9wID0geSArICdweCc7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAod2luZG93LmlubmVyV2lkdGggPCB4ICsgcmVjdC53aWR0aCkge1xuICAgICAgICAgICAgaWYgKHggLSByZWN0LndpZHRoID4gMCkge1xuICAgICAgICAgICAgICAgIGVsLnN0eWxlLmxlZnQgPSAoeCAtIHJlY3Qud2lkdGgpICsgJ3B4JztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZWwuc3R5bGUubGVmdCA9ICcxMHB4JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGVsLnN0eWxlLmxlZnQgPSB4ICsgJ3B4JztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENsb3NlIG1lbnVcbiAgICAgKi9cbiAgICBvYmouY2xvc2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKGVsLmNsYXNzTGlzdC5jb250YWlucygnamNvbnRleHRtZW51LWZvY3VzJykpIHtcbiAgICAgICAgICAgIGVsLmNsYXNzTGlzdC5yZW1vdmUoJ2pjb250ZXh0bWVudS1mb2N1cycpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGl0ZW1zIGJhc2VkIG9uIHRoZSBkZWNsYXJlZCBvYmplY3RkXG4gICAgICogQHBhcmFtIHtvYmplY3R9IGl0ZW1zIC0gTGlzdCBvZiBvYmplY3RcbiAgICAgKi9cbiAgICBvYmouY3JlYXRlID0gZnVuY3Rpb24oaXRlbXMpIHtcbiAgICAgICAgLy8gVXBkYXRlIGNvbnRlbnRcbiAgICAgICAgZWwuaW5uZXJIVE1MID0gJyc7XG5cbiAgICAgICAgLy8gQXBwZW5kIGl0ZW1zXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaXRlbXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChpdGVtc1tpXS50eXBlICYmIGl0ZW1zW2ldLnR5cGUgPT0gJ2xpbmUnKSB7XG4gICAgICAgICAgICAgICAgdmFyIGl0ZW1Db250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdocicpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgaXRlbUNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgICAgIHZhciBpdGVtVGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcbiAgICAgICAgICAgICAgICBpdGVtVGV4dC5pbm5lckhUTUwgPSBpdGVtc1tpXS50aXRsZTtcblxuICAgICAgICAgICAgICAgIGlmIChpdGVtc1tpXS5kaXNhYmxlZCkge1xuICAgICAgICAgICAgICAgICAgICBpdGVtQ29udGFpbmVyLmNsYXNzTmFtZSA9ICdqY29udGV4dG1lbnUtZGlzYWJsZWQnO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbXNbaV0ub25jbGljaykge1xuICAgICAgICAgICAgICAgICAgICBpdGVtQ29udGFpbmVyLm1ldGhvZCA9IGl0ZW1zW2ldLm9uY2xpY2s7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW1Db250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBFeGVjdXRlIG1ldGhvZFxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tZXRob2QodGhpcyk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpdGVtQ29udGFpbmVyLmFwcGVuZENoaWxkKGl0ZW1UZXh0KTtcblxuICAgICAgICAgICAgICAgIGlmIChpdGVtc1tpXS5zaG9ydGN1dCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbVNob3J0Q3V0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgICAgICAgICAgICAgICAgICBpdGVtU2hvcnRDdXQuaW5uZXJIVE1MID0gaXRlbXNbaV0uc2hvcnRjdXQ7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW1Db250YWluZXIuYXBwZW5kQ2hpbGQoaXRlbVNob3J0Q3V0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGVsLmFwcGVuZENoaWxkKGl0ZW1Db250YWluZXIpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZihvYmoub3B0aW9ucy5vbmNsaWNrKSA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgb2JqLm9wdGlvbnMub25jbGljayhvYmopO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgZnVuY3Rpb24oZSkge1xuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgb2JqLmNsb3NlKCk7XG4gICAgICAgIH0sIDEyMCk7XG4gICAgfSk7XG5cbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNld2hlZWxcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgIG9iai5jbG9zZSgpO1xuICAgIH0pO1xuXG4gICAgLy8gQ3JlYXRlIGl0ZW1zXG4gICAgaWYgKG9iai5vcHRpb25zLml0ZW1zKSB7XG4gICAgICAgIG9iai5jcmVhdGUob2JqLm9wdGlvbnMuaXRlbXMpO1xuICAgIH1cblxuICAgIGVsLmNvbnRleHRtZW51ID0gb2JqO1xuXG4gICAgcmV0dXJuIG9iajtcbn0pO1xuXG5qU3VpdGVzLmNvbnRleHRtZW51LmdldEVsZW1lbnQgPSBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgdmFyIGZvdW5kSWQgPSAwO1xuXG4gICAgZnVuY3Rpb24gcGF0aCAoZWxlbWVudCkge1xuICAgICAgICBpZiAoZWxlbWVudC5wYXJlbnROb2RlICYmIGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdhcmlhLWNvbnRleHRtZW51LWlkJykpIHtcbiAgICAgICAgICAgIGZvdW5kSWQgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgnYXJpYS1jb250ZXh0bWVudS1pZCcpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoZWxlbWVudC5wYXJlbnROb2RlKSB7XG4gICAgICAgICAgICAgICAgcGF0aChlbGVtZW50LnBhcmVudE5vZGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcGF0aChlbGVtZW50KTtcblxuICAgIHJldHVybiBmb3VuZElkO1xufVxuXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiY29udGV4dG1lbnVcIiwgZnVuY3Rpb24oZSkge1xuICAgIHZhciBpZCA9IGpTdWl0ZXMuY29udGV4dG1lbnUuZ2V0RWxlbWVudChlLnRhcmdldCk7XG4gICAgaWYgKGlkKSB7XG4gICAgICAgIHZhciBlbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignIycgKyBpZCk7XG4gICAgICAgIGlmICghIGVsZW1lbnQpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0pTVUlURVM6IENvbnRleHRtZW51IGlkIG5vdCBmb3VuZCcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZWxlbWVudC5jb250ZXh0bWVudS5vcGVuKGUpO1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9XG4gICAgfVxufSk7XHJcblxyXG4vKipcbiAqIERpYWxvZyB2MS4wLjFcbiAqIEF1dGhvcjogcGF1bC5ob2RlbEBnbWFpbC5jb21cbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9wYXVsaG9kZWwvanRvb2xzXG4gKi9cbiBcbmpTdWl0ZXMuZGlhbG9nID0gKGZ1bmN0aW9uKCkge1xuICAgIHZhciBvYmogPSB7fTtcbiAgICBvYmoub3B0aW9ucyA9IHt9O1xuXG4gICAgdmFyIGRpYWxvZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGRpYWxvZy5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJzkwMScpO1xuICAgIGRpYWxvZy5jbGFzc05hbWUgPSAnamRpYWxvZyc7XG4gICAgZGlhbG9nLmlkID0gJ2RpYWxvZyc7XG5cbiAgICB2YXIgZGlhbG9nSGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgZGlhbG9nSGVhZGVyLmNsYXNzTmFtZSA9ICdqZGlhbG9nLWhlYWRlcic7XG5cbiAgICB2YXIgZGlhbG9nVGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBkaWFsb2dUaXRsZS5jbGFzc05hbWUgPSAnamRpYWxvZy10aXRsZSc7XG4gICAgZGlhbG9nSGVhZGVyLmFwcGVuZENoaWxkKGRpYWxvZ1RpdGxlKTtcblxuICAgIHZhciBkaWFsb2dNZXNzYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgZGlhbG9nTWVzc2FnZS5jbGFzc05hbWUgPSAnamRpYWxvZy1tZXNzYWdlJztcbiAgICBkaWFsb2dIZWFkZXIuYXBwZW5kQ2hpbGQoZGlhbG9nTWVzc2FnZSk7XG5cbiAgICB2YXIgZGlhbG9nRm9vdGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgZGlhbG9nRm9vdGVyLmNsYXNzTmFtZSA9ICdqZGlhbG9nLWZvb3Rlcic7XG5cbiAgICB2YXIgZGlhbG9nQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgZGlhbG9nQ29udGFpbmVyLmNsYXNzTmFtZSA9ICdqZGlhbG9nLWNvbnRhaW5lcic7XG4gICAgZGlhbG9nQ29udGFpbmVyLmFwcGVuZENoaWxkKGRpYWxvZ0hlYWRlcik7XG4gICAgZGlhbG9nQ29udGFpbmVyLmFwcGVuZENoaWxkKGRpYWxvZ0Zvb3Rlcik7XG5cbiAgICAvLyBDb25maXJtXG4gICAgdmFyIGRpYWxvZ0NvbmZpcm0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICB2YXIgZGlhbG9nQ29uZmlybUJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gICAgZGlhbG9nQ29uZmlybUJ1dHRvbi52YWx1ZSA9IG9iai5vcHRpb25zLmNvbmZpcm1MYWJlbDtcbiAgICBkaWFsb2dDb25maXJtQnV0dG9uLnR5cGUgPSAnYnV0dG9uJztcbiAgICBkaWFsb2dDb25maXJtQnV0dG9uLm9uY2xpY2sgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHR5cGVvZihvYmoub3B0aW9ucy5vbmNvbmZpcm0pID09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIG9iai5vcHRpb25zLm9uY29uZmlybSgpO1xuICAgICAgICB9XG4gICAgICAgIG9iai5jbG9zZSgpO1xuICAgIH07XG4gICAgZGlhbG9nQ29uZmlybS5hcHBlbmRDaGlsZChkaWFsb2dDb25maXJtQnV0dG9uKTtcbiAgICBkaWFsb2dGb290ZXIuYXBwZW5kQ2hpbGQoZGlhbG9nQ29uZmlybSk7XG5cbiAgICAvLyBDYW5jZWxcbiAgICB2YXIgZGlhbG9nQ2FuY2VsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgdmFyIGRpYWxvZ0NhbmNlbEJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gICAgZGlhbG9nQ2FuY2VsQnV0dG9uLnZhbHVlID0gb2JqLm9wdGlvbnMuY2FuY2VsTGFiZWw7XG4gICAgZGlhbG9nQ2FuY2VsQnV0dG9uLnR5cGUgPSAnYnV0dG9uJztcbiAgICBkaWFsb2dDYW5jZWxCdXR0b24ub25jbGljayA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodHlwZW9mKG9iai5vcHRpb25zLm9uY2FuY2VsKSA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBvYmoub3B0aW9ucy5vbmNhbmNlbCgpO1xuICAgICAgICB9XG4gICAgICAgIG9iai5jbG9zZSgpO1xuICAgIH1cbiAgICBkaWFsb2dDYW5jZWwuYXBwZW5kQ2hpbGQoZGlhbG9nQ2FuY2VsQnV0dG9uKTtcbiAgICBkaWFsb2dGb290ZXIuYXBwZW5kQ2hpbGQoZGlhbG9nQ2FuY2VsKTtcblxuICAgIC8vIERpYWxvZ1xuICAgIGRpYWxvZy5hcHBlbmRDaGlsZChkaWFsb2dDb250YWluZXIpO1xuXG4gICAgb2JqLm9wZW4gPSBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIG9iai5vcHRpb25zID0gb3B0aW9ucztcblxuICAgICAgICBpZiAob2JqLm9wdGlvbnMudGl0bGUpIHtcbiAgICAgICAgICAgIGRpYWxvZ1RpdGxlLmlubmVySFRNTCA9IG9iai5vcHRpb25zLnRpdGxlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG9iai5vcHRpb25zLm1lc3NhZ2UpIHtcbiAgICAgICAgICAgIGRpYWxvZ01lc3NhZ2UuaW5uZXJIVE1MID0gb2JqLm9wdGlvbnMubWVzc2FnZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghIG9iai5vcHRpb25zLmNvbmZpcm1MYWJlbCkge1xuICAgICAgICAgICAgb2JqLm9wdGlvbnMuY29uZmlybUxhYmVsID0gJ09LJztcbiAgICAgICAgfVxuICAgICAgICBkaWFsb2dDb25maXJtQnV0dG9uLnZhbHVlID0gb2JqLm9wdGlvbnMuY29uZmlybUxhYmVsO1xuXG4gICAgICAgIGlmICghIG9iai5vcHRpb25zLmNhbmNlbExhYmVsKSB7XG4gICAgICAgICAgICBvYmoub3B0aW9ucy5jYW5jZWxMYWJlbCA9ICdDYW5jZWwnO1xuICAgICAgICB9XG4gICAgICAgIGRpYWxvZ0NhbmNlbEJ1dHRvbi52YWx1ZSA9IG9iai5vcHRpb25zLmNhbmNlbExhYmVsO1xuXG4gICAgICAgIGlmIChvYmoub3B0aW9ucy50eXBlID09ICdjb25maXJtJykge1xuICAgICAgICAgICAgZGlhbG9nQ2FuY2VsQnV0dG9uLnBhcmVudE5vZGUuc3R5bGUuZGlzcGxheSA9ICcnO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZGlhbG9nQ2FuY2VsQnV0dG9uLnBhcmVudE5vZGUuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEFwcGVuZCBlbGVtZW50IHRvIHRoZSBhcHBcbiAgICAgICAgZGlhbG9nLnN0eWxlLm9wYWNpdHkgPSAxMDA7XG5cbiAgICAgICAgLy8gQXBwZW5kIHRvIHRoZSBwYWdlXG4gICAgICAgIGlmIChqU3VpdGVzLmVsKSB7XG4gICAgICAgICAgICBqU3VpdGVzLmVsLmFwcGVuZENoaWxkKGRpYWxvZyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGRpYWxvZyk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBGb2N1c1xuICAgICAgICBkaWFsb2cuZm9jdXMoKTtcblxuICAgICAgICAvLyBTaG93XG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBkaWFsb2dDb250YWluZXIuc3R5bGUub3BhY2l0eSA9IDEwMDtcbiAgICAgICAgfSwgMCk7XG4gICAgfTtcblxuICAgIG9iai5jbG9zZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBkaWFsb2cuc3R5bGUub3BhY2l0eSA9IDA7XG4gICAgICAgIGRpYWxvZ0NvbnRhaW5lci5zdHlsZS5vcGFjaXR5ID0gMDtcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGRpYWxvZy5yZW1vdmUoKTtcbiAgICAgICAgfSwgMTAwKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIG9iajtcbn0pKCk7XG5cbmpTdWl0ZXMuY29uZmlybSA9IChmdW5jdGlvbihtZXNzYWdlLCBvbmNvbmZpcm0pIHtcbiAgICBpZiAoalN1aXRlcy5nZXRXaW5kb3dXaWR0aCgpIDwgODAwKSB7XG4gICAgICAgIGpTdWl0ZXMuZGlhbG9nLm9wZW4oe1xuICAgICAgICAgICAgdHlwZTogJ2NvbmZpcm0nLFxuICAgICAgICAgICAgbWVzc2FnZTogbWVzc2FnZSxcbiAgICAgICAgICAgIHRpdGxlOiAnQ29uZmlybWF0aW9uJyxcbiAgICAgICAgICAgIG9uY29uZmlybTogb25jb25maXJtLFxuICAgICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoY29uZmlybShtZXNzYWdlKSkge1xuICAgICAgICAgICAgb25jb25maXJtKCk7XG4gICAgICAgIH1cbiAgICB9XG59KTtcblxualN1aXRlcy5hbGVydCA9IGZ1bmN0aW9uKG1lc3NhZ2UpIHtcbiAgICBpZiAoalN1aXRlcy5nZXRXaW5kb3dXaWR0aCgpIDwgODAwKSB7XG4gICAgICAgIGpTdWl0ZXMuZGlhbG9nLm9wZW4oe1xuICAgICAgICAgICAgdGl0bGU6J0FsZXJ0JyxcbiAgICAgICAgICAgIG1lc3NhZ2U6bWVzc2FnZSxcbiAgICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgYWxlcnQobWVzc2FnZSk7XG4gICAgfVxufVxuXHJcblxyXG5qU3VpdGVzLmRyb3Bkb3duID0gKGZ1bmN0aW9uKGVsLCBvcHRpb25zKSB7XG4gICAgdmFyIG9iaiA9IHt9O1xuICAgIG9iai5vcHRpb25zID0ge307XG5cbiAgICAvLyBJZiB0aGUgZWxlbWVudCBpcyBhIFNFTEVDVCB0YWcsIGNyZWF0ZSBhIGNvbmZpZ3VyYXRpb24gb2JqZWN0XG4gICAgaWYgKGVsLnRhZ05hbWUgPT0gJ1NFTEVDVCcpIHtcbiAgICAgICAgdmFyIHJldCA9IGpTdWl0ZXMuZHJvcGRvd24uZXh0cmFjdEZyb21Eb20oZWwsIG9wdGlvbnMpO1xuICAgICAgICBlbCA9IHJldC5lbDtcbiAgICAgICAgb3B0aW9ucyA9IHJldC5vcHRpb25zO1xuICAgIH1cblxuICAgIC8vIERlZmF1bHQgY29uZmlndXJhdGlvblxuICAgIHZhciBkZWZhdWx0cyA9IHtcbiAgICAgICAgdXJsOiBudWxsLFxuICAgICAgICBkYXRhOiBbXSxcbiAgICAgICAgbXVsdGlwbGU6IGZhbHNlLFxuICAgICAgICBhdXRvY29tcGxldGU6IGZhbHNlLFxuICAgICAgICB0eXBlOiBudWxsLFxuICAgICAgICB3aWR0aDogbnVsbCxcbiAgICAgICAgb3BlbmVkOiBmYWxzZSxcbiAgICAgICAgdmFsdWU6IG51bGwsXG4gICAgICAgIHBsYWNlaG9sZGVyOiAnJyxcbiAgICAgICAgcG9zaXRpb246IGZhbHNlLFxuICAgICAgICBvbmNoYW5nZTogbnVsbCxcbiAgICAgICAgb25sb2FkOiBudWxsLFxuICAgICAgICBvbm9wZW46IG51bGwsXG4gICAgICAgIG9uY2xvc2U6IG51bGwsXG4gICAgICAgIG9uYmx1cjogbnVsbCxcbiAgICB9O1xuXG4gICAgLy8gTG9vcCB0aHJvdWdoIG91ciBvYmplY3RcbiAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBkZWZhdWx0cykge1xuICAgICAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmhhc093blByb3BlcnR5KHByb3BlcnR5KSkge1xuICAgICAgICAgICAgb2JqLm9wdGlvbnNbcHJvcGVydHldID0gb3B0aW9uc1twcm9wZXJ0eV07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBvYmoub3B0aW9uc1twcm9wZXJ0eV0gPSBkZWZhdWx0c1twcm9wZXJ0eV07XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBHbG9iYWwgY29udGFpbmVyXG4gICAgaWYgKCEgalN1aXRlcy5kcm9wZG93bi5jdXJyZW50KSB7XG4gICAgICAgIGpTdWl0ZXMuZHJvcGRvd24uY3VycmVudCA9IG51bGw7XG4gICAgfVxuXG4gICAgLy8gQ29udGFpbmVyc1xuICAgIG9iai5pdGVtcyA9IFtdO1xuICAgIG9iai5ncm91cHMgPSBbXTtcbiAgICBvYmouc2VsZWN0ZWQgPSBbXTtcblxuICAgIC8vIENyZWF0ZSBkcm9wZG93blxuICAgIGVsLmNsYXNzTGlzdC5hZGQoJ2pkcm9wZG93bicpO1xuIFxuICAgIGlmIChvYmoub3B0aW9ucy50eXBlID09ICdzZWFyY2hiYXInKSB7XG4gICAgICAgIGVsLmNsYXNzTGlzdC5hZGQoJ2pkcm9wZG93bi1zZWFyY2hiYXInKTtcbiAgICB9IGVsc2UgaWYgKG9iai5vcHRpb25zLnR5cGUgPT0gJ2xpc3QnKSB7XG4gICAgICAgIGVsLmNsYXNzTGlzdC5hZGQoJ2pkcm9wZG93bi1saXN0Jyk7XG4gICAgfSBlbHNlIGlmIChvYmoub3B0aW9ucy50eXBlID09ICdwaWNrZXInKSB7XG4gICAgICAgIGVsLmNsYXNzTGlzdC5hZGQoJ2pkcm9wZG93bi1waWNrZXInKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoalN1aXRlcy5nZXRXaW5kb3dXaWR0aCgpIDwgODAwKSB7XG4gICAgICAgICAgICBlbC5jbGFzc0xpc3QuYWRkKCdqZHJvcGRvd24tcGlja2VyJyk7XG4gICAgICAgICAgICBvYmoub3B0aW9ucy50eXBlID0gJ3BpY2tlcic7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMud2lkdGgpIHtcbiAgICAgICAgICAgICAgICBlbC5zdHlsZS53aWR0aCA9IG9iai5vcHRpb25zLndpZHRoO1xuICAgICAgICAgICAgICAgIGVsLnN0eWxlLm1pbldpZHRoID0gb2JqLm9wdGlvbnMud2lkdGg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbC5jbGFzc0xpc3QuYWRkKCdqZHJvcGRvd24tZGVmYXVsdCcpO1xuICAgICAgICAgICAgb2JqLm9wdGlvbnMudHlwZSA9ICdkZWZhdWx0JztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIEhlYWRlciBjb250YWluZXJcbiAgICB2YXIgY29udGFpbmVySGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgY29udGFpbmVySGVhZGVyLmNsYXNzTmFtZSA9ICdqZHJvcGRvd24tY29udGFpbmVyLWhlYWRlcic7XG5cbiAgICAvLyBIZWFkZXJcbiAgICB2YXIgaGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgICBoZWFkZXIuY2xhc3NOYW1lID0gJ2pkcm9wZG93bi1oZWFkZXInO1xuICAgIGlmICh0eXBlb2Yob2JqLm9wdGlvbnMub25ibHVyKSA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIGhlYWRlci5vbmJsdXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG9iai5vcHRpb25zLm9uYmx1cihlbCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDb250YWluZXJcbiAgICB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgY29udGFpbmVyLmNsYXNzTmFtZSA9ICdqZHJvcGRvd24tY29udGFpbmVyJztcblxuICAgIC8vIERyb3Bkb3duIGNvbnRlbnRcbiAgICB2YXIgY29udGVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGNvbnRlbnQuY2xhc3NOYW1lID0gJ2pkcm9wZG93bi1jb250ZW50JztcblxuICAgIC8vIENsb3NlIGJ1dHRvblxuICAgIHZhciBjbG9zZUJ1dHRvbiAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBjbG9zZUJ1dHRvbi5jbGFzc05hbWUgPSAnamRyb3Bkb3duLWNsb3NlJztcbiAgICBjbG9zZUJ1dHRvbi5pbm5lckhUTUwgPSAnRG9uZSc7XG5cbiAgICAvLyBDcmVhdGUgYmFja2Ryb3BcbiAgICB2YXIgYmFja2Ryb3AgID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgYmFja2Ryb3AuY2xhc3NOYW1lID0gJ2pkcm9wZG93bi1iYWNrZHJvcCc7XG5cbiAgICAvLyBBdXRvY29tcGxldGVcbiAgICBpZiAob2JqLm9wdGlvbnMuYXV0b2NvbXBsZXRlID09IHRydWUpIHtcbiAgICAgICAgZWwuc2V0QXR0cmlidXRlKCdkYXRhLWF1dG9jb21wbGV0ZScsIHRydWUpO1xuXG4gICAgICAgIC8vIEhhbmRsZXJcbiAgICAgICAgdmFyIGtleVRpbWVyID0gbnVsbDtcbiAgICAgICAgaGVhZGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgaWYgKGtleVRpbWVyKSB7XG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGtleVRpbWVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGtleVRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBvYmouZmluZChoZWFkZXIudmFsdWUpO1xuICAgICAgICAgICAgICAgIGtleVRpbWVyID0gbnVsbDtcbiAgICAgICAgICAgIH0sIDUwMCk7XG5cbiAgICAgICAgICAgIGlmICghIGVsLmNsYXNzTGlzdC5jb250YWlucygnamRyb3Bkb3duLWZvY3VzJykpIHtcbiAgICAgICAgICAgICAgICBpZiAoZS53aGljaCA+IDY1KSB7XG4gICAgICAgICAgICAgICAgICAgIG9iai5vcGVuKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBoZWFkZXIuc2V0QXR0cmlidXRlKCdyZWFkb25seScsICdyZWFkb25seScpO1xuICAgIH1cblxuICAgIC8vIFBsYWNlIGhvbGRlclxuICAgIGlmICghIG9iai5vcHRpb25zLnBsYWNlaG9sZGVyICYmIGVsLmdldEF0dHJpYnV0ZSgncGxhY2Vob2xkZXInKSkge1xuICAgICAgICBvYmoub3B0aW9ucy5wbGFjZWhvbGRlciA9IGVsLmdldEF0dHJpYnV0ZSgncGxhY2Vob2xkZXInKTtcbiAgICB9XG5cbiAgICBpZiAob2JqLm9wdGlvbnMucGxhY2Vob2xkZXIpIHtcbiAgICAgICAgaGVhZGVyLnNldEF0dHJpYnV0ZSgncGxhY2Vob2xkZXInLCBvYmoub3B0aW9ucy5wbGFjZWhvbGRlcik7XG4gICAgfVxuXG4gICAgLy8gQXBwZW5kIGVsZW1lbnRzXG4gICAgY29udGFpbmVySGVhZGVyLmFwcGVuZENoaWxkKGhlYWRlcik7XG4gICAgaWYgKG9iai5vcHRpb25zLnR5cGUgPT0gJ3NlYXJjaGJhcicpIHtcbiAgICAgICAgY29udGFpbmVySGVhZGVyLmFwcGVuZENoaWxkKGNsb3NlQnV0dG9uKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoY2xvc2VCdXR0b24pO1xuICAgIH1cbiAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoY29udGVudCk7XG4gICAgZWwuYXBwZW5kQ2hpbGQoY29udGFpbmVySGVhZGVyKTtcbiAgICBlbC5hcHBlbmRDaGlsZChjb250YWluZXIpO1xuICAgIGVsLmFwcGVuZENoaWxkKGJhY2tkcm9wKTtcblxuICAgIC8qKlxuICAgICAqIEluaXQgZHJvcGRvd25cbiAgICAgKi9cbiAgICBvYmouaW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAob2JqLm9wdGlvbnMudXJsKSB7XG4gICAgICAgICAgICBqU3VpdGVzLmFqYXgoe1xuICAgICAgICAgICAgICAgIHVybDogb2JqLm9wdGlvbnMudXJsLFxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgZGF0YVxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnNldERhdGEoZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdmFsdWVcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy52YWx1ZSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnNldFZhbHVlKG9iai5vcHRpb25zLnZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE9ubG9hZCBtZXRob2RcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2Yob2JqLm9wdGlvbnMub25sb2FkKSA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMub25sb2FkKGVsLCBvYmosIGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBTZXQgZGF0YVxuICAgICAgICAgICAgb2JqLnNldERhdGEoKTtcbiAgICAgICAgICAgIC8vIFNldCB2YWx1ZVxuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLnZhbHVlICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBvYmouc2V0VmFsdWUob2JqLm9wdGlvbnMudmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gT25sb2FkXG4gICAgICAgICAgICBpZiAodHlwZW9mKG9iai5vcHRpb25zLm9ubG9hZCkgPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLm9ubG9hZChlbCwgb2JqLCBkYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIE9wZW4gZHJvcGRvd25cbiAgICAgICAgaWYgKG9iai5vcHRpb25zLm9wZW5lZCA9PSB0cnVlKSB7XG4gICAgICAgICAgICBvYmoub3BlbigpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgb2JqLmdldFVybCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gb2JqLm9wdGlvbnMudXJsO1xuICAgIH1cblxuICAgIG9iai5zZXRVcmwgPSBmdW5jdGlvbih1cmwpIHtcbiAgICAgICAgb2JqLm9wdGlvbnMudXJsID0gdXJsO1xuXG4gICAgICAgIGpTdWl0ZXMuYWpheCh7XG4gICAgICAgICAgICB1cmw6IG9iai5vcHRpb25zLnVybCxcbiAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgIG9iai5zZXREYXRhKGRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgaXRlbVxuICAgICAqL1xuICAgIG9iai5jcmVhdGVJdGVtID0gZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAvLyBDcmVhdGUgaXRlbVxuICAgICAgICB2YXIgaXRlbSA9IHt9O1xuICAgICAgICBpdGVtLmVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgaXRlbS5lbGVtZW50LmNsYXNzTmFtZSA9ICdqZHJvcGRvd24taXRlbSc7XG4gICAgICAgIGl0ZW0udmFsdWUgPSBkYXRhLmlkO1xuICAgICAgICBpdGVtLnRleHQgPSBkYXRhLm5hbWU7XG4gICAgICAgIGl0ZW0udGV4dExvd2VyQ2FzZSA9ICcnICsgZGF0YS5uYW1lLnRvTG93ZXJDYXNlKCk7XG5cbiAgICAgICAgLy8gSW1hZ2VcbiAgICAgICAgaWYgKGRhdGEuaW1hZ2UpIHtcbiAgICAgICAgICAgIHZhciBpbWFnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xuICAgICAgICAgICAgaW1hZ2UuY2xhc3NOYW1lID0gJ2pkcm9wZG93bi1pbWFnZSc7XG4gICAgICAgICAgICBpbWFnZS5zcmMgPSBkYXRhLmltYWdlO1xuICAgICAgICAgICAgaWYgKCEgZGF0YS50aXRsZSkge1xuICAgICAgICAgICAgICAgaW1hZ2UuY2xhc3NMaXN0LmFkZCgnamRyb3Bkb3duLWltYWdlLXNtYWxsJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpdGVtLmVsZW1lbnQuYXBwZW5kQ2hpbGQoaW1hZ2UpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gU2V0IGNvbnRlbnRcbiAgICAgICAgdmFyIG5vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgbm9kZS5jbGFzc05hbWUgPSAnamRyb3Bkb3duLWRlc2NyaXB0aW9uJztcbiAgICAgICAgbm9kZS5pbm5lckhUTUwgPSBkYXRhLm5hbWU7XG5cbiAgICAgICAgLy8gVGl0bGVcbiAgICAgICAgaWYgKGRhdGEudGl0bGUpIHtcbiAgICAgICAgICAgIHZhciB0aXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgdGl0bGUuY2xhc3NOYW1lID0gJ2pkcm9wZG93bi10aXRsZSc7XG4gICAgICAgICAgICB0aXRsZS5pbm5lckhUTUwgPSBkYXRhLnRpdGxlO1xuICAgICAgICAgICAgbm9kZS5hcHBlbmRDaGlsZCh0aXRsZSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBBZGQgbm9kZSB0byBpdGVtXG4gICAgICAgIGl0ZW0uZWxlbWVudC5hcHBlbmRDaGlsZChub2RlKTtcblxuICAgICAgICByZXR1cm4gaXRlbTtcbiAgICB9XG5cbiAgICBvYmouc2V0RGF0YSA9IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgLy8gVXBkYXRlIGRhdGFcbiAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgIG9iai5vcHRpb25zLmRhdGEgPSBkYXRhO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRGF0YVxuICAgICAgICB2YXIgZGF0YSA9IG9iai5vcHRpb25zLmRhdGE7XG5cbiAgICAgICAgLy8gUmVtb3ZlIGNvbnRlbnQgZnJvbSB0aGUgRE9NXG4gICAgICAgIGNvbnRhaW5lci5yZW1vdmVDaGlsZChjb250ZW50KTtcblxuICAgICAgICAvLyBNYWtlIHN1cmUgdGhlIGNvbnRlbnQgY29udGFpbmVyIGlzIGJsYW5rXG4gICAgICAgIGNvbnRlbnQuaW5uZXJIVE1MID0gJyc7XG5cbiAgICAgICAgLy8gUmVzZXRcbiAgICAgICAgb2JqLnJlc2V0KCk7XG5cbiAgICAgICAgLy8gUmVzZXQgaXRlbXNcbiAgICAgICAgb2JqLml0ZW1zID0gW107XG5cbiAgICAgICAgLy8gSGVscGVyc1xuICAgICAgICB2YXIgaXRlbXMgPSBbXTtcbiAgICAgICAgdmFyIGdyb3VwcyA9IFtdO1xuXG4gICAgICAgIC8vIENyZWF0ZSBlbGVtZW50c1xuICAgICAgICBpZiAoZGF0YS5sZW5ndGgpIHtcbiAgICAgICAgICAgIC8vIFByZXBhcmUgZGF0YVxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgLy8gQ29tcGF0aWJpbGl0eVxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YoZGF0YVtpXSkgIT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gQ29ycmVjdCBmb3JtYXRcbiAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMuZGF0YVtpXSA9IGRhdGFbaV0gPSB7IGlkOiBkYXRhW2ldLCBuYW1lOiBkYXRhW2ldIH07XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gUHJvY2VzcyBncm91cHNcbiAgICAgICAgICAgICAgICBpZiAoZGF0YVtpXS5ncm91cCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoISBncm91cHNbZGF0YVtpXS5ncm91cF0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdyb3Vwc1tkYXRhW2ldLmdyb3VwXSA9IFtdO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGdyb3Vwc1tkYXRhW2ldLmdyb3VwXS5wdXNoKGkpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2goaSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBHcm91cHNcbiAgICAgICAgICAgIHZhciBncm91cE5hbWVzID0gT2JqZWN0LmtleXMoZ3JvdXBzKTtcblxuICAgICAgICAgICAgLy8gQXBwZW5kIGdyb3VwcyBpbiBjYXNlIGV4aXN0c1xuICAgICAgICAgICAgaWYgKGdyb3VwTmFtZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZ3JvdXBOYW1lcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAvLyBHcm91cCBjb250YWluZXJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGdyb3VwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICAgICAgICAgIGdyb3VwLmNsYXNzTmFtZSA9ICdqZHJvcGRvd24tZ3JvdXAnO1xuICAgICAgICAgICAgICAgICAgICAvLyBHcm91cCBuYW1lXG4gICAgICAgICAgICAgICAgICAgIHZhciBncm91cE5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXBOYW1lLmNsYXNzTmFtZSA9ICdqZHJvcGRvd24tZ3JvdXAtbmFtZSc7XG4gICAgICAgICAgICAgICAgICAgIGdyb3VwTmFtZS5pbm5lckhUTUwgPSBncm91cE5hbWVzW2ldO1xuICAgICAgICAgICAgICAgICAgICAvLyBHcm91cCBhcnJvd1xuICAgICAgICAgICAgICAgICAgICB2YXIgZ3JvdXBBcnJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2knKTtcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXBBcnJvdy5jbGFzc05hbWUgPSAnamRyb3Bkb3duLWdyb3VwLWFycm93IGpkcm9wZG93bi1ncm91cC1hcnJvdy1kb3duJztcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXBOYW1lLmFwcGVuZENoaWxkKGdyb3VwQXJyb3cpO1xuICAgICAgICAgICAgICAgICAgICAvLyBHcm91cCBpdGVtc1xuICAgICAgICAgICAgICAgICAgICB2YXIgZ3JvdXBDb250ZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICAgICAgICAgIGdyb3VwQ29udGVudC5jbGFzc05hbWUgPSAnamRyb3Bkb3duLWdyb3VwLWl0ZW1zJztcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBncm91cHNbZ3JvdXBOYW1lc1tpXV0ubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpdGVtID0gb2JqLmNyZWF0ZUl0ZW0oZGF0YVtncm91cHNbZ3JvdXBOYW1lc1tpXV1bal1dKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwQ29udGVudC5hcHBlbmRDaGlsZChpdGVtLmVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSXRlbXNcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5pdGVtcy5wdXNoKGl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIEdyb3VwIGl0ZW5zXG4gICAgICAgICAgICAgICAgICAgIGdyb3VwLmFwcGVuZENoaWxkKGdyb3VwTmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIGdyb3VwLmFwcGVuZENoaWxkKGdyb3VwQXJyb3cpO1xuICAgICAgICAgICAgICAgICAgICBncm91cC5hcHBlbmRDaGlsZChncm91cENvbnRlbnQpO1xuICAgICAgICAgICAgICAgICAgICBjb250ZW50LmFwcGVuZENoaWxkKGdyb3VwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChpdGVtcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpdGVtID0gb2JqLmNyZWF0ZUl0ZW0oZGF0YVtpdGVtc1tpXV0pO1xuICAgICAgICAgICAgICAgICAgICBvYmouaXRlbXMucHVzaChpdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgY29udGVudC5hcHBlbmRDaGlsZChpdGVtLmVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQ3JlYXRlIHRoZSBJbmRleGVzXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iai5pdGVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIG9iai5pdGVtc1tpXS5lbGVtZW50LnNldEF0dHJpYnV0ZSgnZGF0YS1pbmRleCcsIGkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gUmUtaW5zZXJ0IHRoZSBjb250ZW50IHRvIHRoZSBjb250YWluZXJcbiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGNvbnRlbnQpO1xuICAgIH1cblxuICAgIG9iai5nZXRUZXh0ID0gZnVuY3Rpb24oYXNBcnJheSkge1xuICAgICAgICAvLyBSZXN1bHRcbiAgICAgICAgdmFyIHJlc3VsdCA9IFtdO1xuICAgICAgICAvLyBBcHBlbmQgb3B0aW9uc1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iai5zZWxlY3RlZC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKG9iai5pdGVtc1tvYmouc2VsZWN0ZWRbaV1dKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gob2JqLml0ZW1zW29iai5zZWxlY3RlZFtpXV0udGV4dCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoYXNBcnJheSkge1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQuam9pbignOyAnKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG9iai5nZXRWYWx1ZSA9IGZ1bmN0aW9uKGFzQXJyYXkpIHtcbiAgICAgICAgLy8gUmVzdWx0XG4gICAgICAgIHZhciByZXN1bHQgPSBbXTtcbiAgICAgICAgLy8gQXBwZW5kIG9wdGlvbnNcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvYmouc2VsZWN0ZWQubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChvYmouaXRlbXNbb2JqLnNlbGVjdGVkW2ldXSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKG9iai5pdGVtc1tvYmouc2VsZWN0ZWRbaV1dLnZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChhc0FycmF5KSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5qb2luKCc7Jyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBvYmouc2V0VmFsdWUgPSBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAvLyBSZW1vdmUgdmFsdWVzXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2JqLnNlbGVjdGVkLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBvYmouaXRlbXNbb2JqLnNlbGVjdGVkW2ldXS5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2pkcm9wZG93bi1zZWxlY3RlZCcpXG4gICAgICAgIH0gXG5cbiAgICAgICAgLy8gUmVzZXQgc2VsZWN0ZWRcbiAgICAgICAgb2JqLnNlbGVjdGVkID0gW107XG5cbiAgICAgICAgLy8gU2V0IHZhbHVlc1xuICAgICAgICBpZiAodmFsdWUgIT0gbnVsbCkge1xuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvYmouaXRlbXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB2YWx1ZS5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5pdGVtc1tpXS52YWx1ZSA9PSB2YWx1ZVtqXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEtlZXAgaW5kZXggb2YgdGhlIHNlbGVjdGVkIGl0ZW1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouc2VsZWN0ZWQucHVzaChpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBWaXN1YWwgc2VsZWN0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLml0ZW1zW2ldLmVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnamRyb3Bkb3duLXNlbGVjdGVkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2JqLml0ZW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmouaXRlbXNbaV0udmFsdWUgPT0gdmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEtlZXAgaW5kZXggb2YgdGhlIHNlbGVjdGVkIGl0ZW1cbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5zZWxlY3RlZC5wdXNoKGkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVmlzdWFsIHNlbGVjdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLml0ZW1zW2ldLmVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnamRyb3Bkb3duLXNlbGVjdGVkJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBVcGRhdGUgbGFiZWxzXG4gICAgICAgIG9iai51cGRhdGVMYWJlbCgpO1xuICAgIH1cblxuICAgIG9iai5zZWxlY3RJbmRleCA9IGZ1bmN0aW9uKGluZGV4KSB7XG4gICAgICAgIC8vIE9ubHkgc2VsZWN0IHRob3NlIGV4aXN0aW5nIGVsZW1lbnRzXG4gICAgICAgIGlmIChvYmouaXRlbXMgJiYgb2JqLml0ZW1zW2luZGV4XSkge1xuICAgICAgICAgICAgdmFyIGluZGV4ID0gaW5kZXggPSBwYXJzZUludChpbmRleCk7XG4gICAgICAgICAgICAvLyBDdXJyZW50IHNlbGVjdGlvblxuICAgICAgICAgICAgdmFyIG9sZFZhbHVlID0gb2JqLmdldFZhbHVlKCk7XG4gICAgICAgICAgICB2YXIgb2xkTGFiZWwgPSBvYmouZ2V0VGV4dCgpO1xuXG4gICAgICAgICAgICAvLyBSZW1vdmUgY3Vyc29yIHN0eWxlXG4gICAgICAgICAgICBpZiAob2JqLmN1cnJlbnRJbmRleCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgb2JqLml0ZW1zW29iai5jdXJyZW50SW5kZXhdLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnamRyb3Bkb3duLWN1cnNvcicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gU2V0IGN1cnNvciBzdHlsZVxuICAgICAgICAgICAgb2JqLml0ZW1zW2luZGV4XS5lbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2pkcm9wZG93bi1jdXJzb3InKTtcblxuICAgICAgICAgICAgLy8gVXBkYXRlIGN1cnNvciBwb3NpdGlvblxuICAgICAgICAgICAgb2JqLmN1cnJlbnRJbmRleCA9IGluZGV4O1xuXG4gICAgICAgICAgICAvLyBGb2N1cyBiZWhhdmlvdXJcbiAgICAgICAgICAgIGlmICghIG9iai5vcHRpb25zLm11bHRpcGxlKSB7XG4gICAgICAgICAgICAgICAgLy8gVW5zZWxlY3Qgb3B0aW9uXG4gICAgICAgICAgICAgICAgaWYgKG9iai5pdGVtc1tpbmRleF0uZWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoJ2pkcm9wZG93bi1zZWxlY3RlZCcpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFJlc2V0IHNlbGVjdGVkXG4gICAgICAgICAgICAgICAgICAgIG9iai5yZXNldFNlbGVjdGVkKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gUmVzZXQgc2VsZWN0ZWRcbiAgICAgICAgICAgICAgICAgICAgb2JqLnJlc2V0U2VsZWN0ZWQoKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIHNlbGVjdGVkIGl0ZW1cbiAgICAgICAgICAgICAgICAgICAgb2JqLml0ZW1zW2luZGV4XS5lbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2pkcm9wZG93bi1zZWxlY3RlZCcpO1xuICAgICAgICAgICAgICAgICAgICAvLyBBZGQgdG8gdGhlIHNlbGVjdGVkIGxpc3RcbiAgICAgICAgICAgICAgICAgICAgb2JqLnNlbGVjdGVkLnB1c2goaW5kZXgpO1xuICAgICAgICAgICAgICAgICAgICAvLyBDbG9zZVxuICAgICAgICAgICAgICAgICAgICBvYmouY2xvc2UoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIFRvZ2dsZSBvcHRpb25cbiAgICAgICAgICAgICAgICBpZiAob2JqLml0ZW1zW2luZGV4XS5lbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnamRyb3Bkb3duLXNlbGVjdGVkJykpIHtcbiAgICAgICAgICAgICAgICAgICAgb2JqLml0ZW1zW2luZGV4XS5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2pkcm9wZG93bi1zZWxlY3RlZCcpO1xuICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgZnJvbSBzZWxlY3RlZCBsaXN0XG4gICAgICAgICAgICAgICAgICAgIHZhciBpbmRleFRvUmVtb3ZlID0gb2JqLnNlbGVjdGVkLmluZGV4T2YoaW5kZXgpO1xuICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgc2VsZWN0XG4gICAgICAgICAgICAgICAgICAgIG9iai5zZWxlY3RlZC5zcGxpY2UoaW5kZXhUb1JlbW92ZSwgMSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gU2VsZWN0IGVsZW1lbnRcbiAgICAgICAgICAgICAgICAgICAgb2JqLml0ZW1zW2luZGV4XS5lbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2pkcm9wZG93bi1zZWxlY3RlZCcpO1xuICAgICAgICAgICAgICAgICAgICAvLyBBZGQgdG8gdGhlIHNlbGVjdGVkIGxpc3RcbiAgICAgICAgICAgICAgICAgICAgb2JqLnNlbGVjdGVkLnB1c2goaW5kZXgpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBsYWJlbHMgZm9yIG11bHRpcGxlIGRyb3Bkb3duXG4gICAgICAgICAgICAgICAgaWYgKCEgb2JqLm9wdGlvbnMuYXV0b2NvbXBsZXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIG9iai51cGRhdGVMYWJlbCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQ3VycmVudCBzZWxlY3Rpb25cbiAgICAgICAgICAgIHZhciBuZXdWYWx1ZSA9IG9iai5nZXRWYWx1ZSgpO1xuICAgICAgICAgICAgdmFyIG5ld0xhYmVsID0gb2JqLmdldFRleHQoKTtcblxuICAgICAgICAgICAgLy8gRXZlbnRzXG4gICAgICAgICAgICBpZiAodHlwZW9mKG9iai5vcHRpb25zLm9uY2hhbmdlKSA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMub25jaGFuZ2UoZWwsIGluZGV4LCBvbGRWYWx1ZSwgbmV3VmFsdWUsIG9sZExhYmVsLCBuZXdMYWJlbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBvYmouc2VsZWN0SXRlbSA9IGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgaWYgKGpTdWl0ZXMuZHJvcGRvd24uY3VycmVudCkge1xuICAgICAgICAgICAgdmFyIGluZGV4ID0gaXRlbS5nZXRBdHRyaWJ1dGUoJ2RhdGEtaW5kZXgnKTtcbiAgICAgICAgICAgIGlmIChpbmRleCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgb2JqLnNlbGVjdEluZGV4KGluZGV4KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIG9iai5maW5kID0gZnVuY3Rpb24oc3RyKSB7XG4gICAgICAgIC8vIEZvcmNlIGxvd2VyY2FzZVxuICAgICAgICB2YXIgc3RyID0gc3RyID8gc3RyLnRvTG93ZXJDYXNlKCkgOiBudWxsO1xuXG4gICAgICAgIC8vIEFwcGVuZCBvcHRpb25zXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2JqLml0ZW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoc3RyID09IG51bGwgfHwgb2JqLml0ZW1zW2ldLnRleHRMb3dlckNhc2UuaW5kZXhPZihzdHIpICE9IC0xKSB7XG4gICAgICAgICAgICAgICAgb2JqLml0ZW1zW2ldLmVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICcnO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAob2JqLnNlbGVjdGVkLmluZGV4T2YoaSkgPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgb2JqLml0ZW1zW2ldLmVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBvYmouaXRlbXNbaV0uZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJyc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdmFyIG51bVZpc2libGVJdGVtcyA9IGZ1bmN0aW9uKGl0ZW1zKSB7XG4gICAgICAgICAgICB2YXIgdmlzaWJsZSA9IDA7XG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGl0ZW1zLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW1zW2pdLnN0eWxlLmRpc3BsYXkgIT0gJ25vbmUnKSB7XG4gICAgICAgICAgICAgICAgICAgIHZpc2libGUrKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdmlzaWJsZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEhpZGUgZ3JvdXBzXG4gICAgICAgIC8qZm9yICh2YXIgaSA9IDA7IGkgPCBvYmouZ3JvdXBzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAobnVtVmlzaWJsZUl0ZW1zKG9iai5ncm91cHNbaV0ucXVlcnlTZWxlY3RvckFsbCgnLmpkcm9wZG93bi1pdGVtJykpKSB7XG4gICAgICAgICAgICAgICAgb2JqLmdyb3Vwc1tpXS5jaGlsZHJlblswXS5zdHlsZS5kaXNwbGF5ID0gJyc7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG9iai5ncm91cHNbaV0uY2hpbGRyZW5bMF0uc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSovXG4gICAgfVxuXG4gICAgb2JqLnVwZGF0ZUxhYmVsID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIFVwZGF0ZSBsYWJlbFxuICAgICAgICBoZWFkZXIudmFsdWUgPSBvYmouZ2V0VGV4dCgpO1xuICAgIH1cblxuICAgIG9iai5vcGVuID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmIChqU3VpdGVzLmRyb3Bkb3duLmN1cnJlbnQgIT0gZWwpIHtcbiAgICAgICAgICAgIGlmIChqU3VpdGVzLmRyb3Bkb3duLmN1cnJlbnQpIHtcbiAgICAgICAgICAgICAgICBqU3VpdGVzLmRyb3Bkb3duLmN1cnJlbnQuZHJvcGRvd24uY2xvc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGpTdWl0ZXMuZHJvcGRvd24uY3VycmVudCA9IGVsO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRm9jdXNcbiAgICAgICAgaWYgKCEgZWwuY2xhc3NMaXN0LmNvbnRhaW5zKCdqZHJvcGRvd24tZm9jdXMnKSkge1xuICAgICAgICAgICAgLy8gQWRkIGZvY3VzXG4gICAgICAgICAgICBlbC5jbGFzc0xpc3QuYWRkKCdqZHJvcGRvd24tZm9jdXMnKTtcblxuICAgICAgICAgICAgLy8gQW5pbWF0aW9uXG4gICAgICAgICAgICBpZiAoalN1aXRlcy5nZXRXaW5kb3dXaWR0aCgpIDwgODAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLnR5cGUgPT0gbnVsbCB8fCBvYmoub3B0aW9ucy50eXBlID09ICdwaWNrZXInKSB7XG4gICAgICAgICAgICAgICAgICAgIGpTdWl0ZXMuc2xpZGVCb3R0b20oY29udGFpbmVyLCAxKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIEZpbHRlclxuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmF1dG9jb21wbGV0ZSA9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgLy8gUmVkbyBzZWFyY2hcbiAgICAgICAgICAgICAgICBvYmouZmluZCgpO1xuICAgICAgICAgICAgICAgIC8vIENsZWFyIHNlYXJjaCBmaWVsZFxuICAgICAgICAgICAgICAgIGhlYWRlci52YWx1ZSA9ICcnO1xuICAgICAgICAgICAgICAgIGhlYWRlci5mb2N1cygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBTZXQgY3Vyc29yIGZvciB0aGUgZmlyc3Qgb3IgZmlyc3Qgc2VsZWN0ZWQgZWxlbWVudFxuICAgICAgICAgICAgdmFyIGN1cnNvciA9IChvYmouc2VsZWN0ZWQgJiYgb2JqLnNlbGVjdGVkWzBdKSA/IG9iai5zZWxlY3RlZFswXSA6IDA7XG4gICAgICAgICAgICBvYmoudXBkYXRlQ3Vyc29yKGN1cnNvcik7XG5cbiAgICAgICAgICAgIC8vIENvbnRhaW5lciBTaXplXG4gICAgICAgICAgICBpZiAoISBvYmoub3B0aW9ucy50eXBlIHx8IG9iai5vcHRpb25zLnR5cGUgPT0gJ2RlZmF1bHQnKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVjdCA9IGVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlY3RDb250YWluZXIgPSBjb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cbiAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMucG9zaXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLnN0eWxlLnBvc2l0aW9uID0gJ2ZpeGVkJztcbiAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5pbm5lckhlaWdodCA8IHJlY3QuYm90dG9tICsgcmVjdENvbnRhaW5lci5oZWlnaHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5zdHlsZS50b3AgPSAnJztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5zdHlsZS5ib3R0b20gPSAod2luZG93LmlubmVySGVpZ2h0IC0gcmVjdC50b3AgKSArIDEgKyAncHgnO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLnN0eWxlLnRvcCA9IHJlY3QuYm90dG9tICsgJ3B4JztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5zdHlsZS5ib3R0b20gPSAnJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuc3R5bGUubGVmdCA9IHJlY3QubGVmdCArICdweCc7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5pbm5lckhlaWdodCA8IHJlY3QuYm90dG9tICsgcmVjdENvbnRhaW5lci5oZWlnaHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5zdHlsZS50b3AgPSAnJztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5zdHlsZS5ib3R0b20gPSByZWN0LmhlaWdodCArIDEgKyAncHgnO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLnN0eWxlLnRvcCA9ICcnO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLnN0eWxlLmJvdHRvbSA9ICcnO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29udGFpbmVyLnN0eWxlLm1pbldpZHRoID0gcmVjdC53aWR0aCArICdweCc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBFdmVudHNcbiAgICAgICAgaWYgKHR5cGVvZihvYmoub3B0aW9ucy5vbm9wZW4pID09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIG9iai5vcHRpb25zLm9ub3BlbihlbCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBvYmouY2xvc2UgPSBmdW5jdGlvbihpZ25vcmVFdmVudHMpIHtcbiAgICAgICAgaWYgKGpTdWl0ZXMuZHJvcGRvd24uY3VycmVudCkge1xuICAgICAgICAgICAgLy8gUmVtb3ZlIGNvbnRyb2xsZXJcbiAgICAgICAgICAgIGpTdWl0ZXMuZHJvcGRvd24uY3VycmVudCA9IG51bGxcbiAgICAgICAgICAgIC8vIFJlbW92ZSBjdXJzb3JcbiAgICAgICAgICAgIG9iai5yZXNldEN1cnNvcigpO1xuICAgICAgICAgICAgLy8gVXBkYXRlIGxhYmVsc1xuICAgICAgICAgICAgb2JqLnVwZGF0ZUxhYmVsKCk7XG4gICAgICAgICAgICAvLyBFdmVudHNcbiAgICAgICAgICAgIGlmICghIGlnbm9yZUV2ZW50cyAmJiB0eXBlb2Yob2JqLm9wdGlvbnMub25jbG9zZSkgPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLm9uY2xvc2UoZWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gQmx1clxuICAgICAgICAgICAgaWYgKGhlYWRlci5ibHVyKSB7XG4gICAgICAgICAgICAgICAgaGVhZGVyLmJsdXIoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIFJlbW92ZSBmb2N1c1xuICAgICAgICAgICAgZWwuY2xhc3NMaXN0LnJlbW92ZSgnamRyb3Bkb3duLWZvY3VzJyk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gb2JqLmdldFZhbHVlKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVXBkYXRlIHBvc2l0aW9uIGN1cnNvclxuICAgICAqL1xuICAgIG9iai51cGRhdGVDdXJzb3IgPSBmdW5jdGlvbihpbmRleCkge1xuICAgICAgICAvLyBTZXQgbmV3IGN1cnNvclxuICAgICAgICBpZiAob2JqLml0ZW1zICYmIG9iai5pdGVtc1tpbmRleF0gJiYgb2JqLml0ZW1zW2luZGV4XS5lbGVtZW50KSB7XG4gICAgICAgICAgICAvLyBSZXNldCBjdXJzb3JcbiAgICAgICAgICAgIG9iai5yZXNldEN1cnNvcigpO1xuXG4gICAgICAgICAgICAvLyBTZXQgbmV3IGN1cnNvclxuICAgICAgICAgICAgb2JqLml0ZW1zW2luZGV4XS5lbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2pkcm9wZG93bi1jdXJzb3InKTtcblxuICAgICAgICAgICAgLy8gVXBkYXRlIHBvc2l0aW9uXG4gICAgICAgICAgICBvYmouY3VycmVudEluZGV4ID0gcGFyc2VJbnQoaW5kZXgpO1xuICAgIFxuICAgICAgICAgICAgLy8gVXBkYXRlIHNjcm9sbCB0byB0aGUgY3Vyc29yIGVsZW1lbnRcbiAgICAgICAgICAgIHZhciBjb250YWluZXIgPSBjb250ZW50LnNjcm9sbFRvcDtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gb2JqLml0ZW1zW29iai5jdXJyZW50SW5kZXhdLmVsZW1lbnQ7XG4gICAgICAgICAgICBjb250ZW50LnNjcm9sbFRvcCA9IGVsZW1lbnQub2Zmc2V0VG9wIC0gZWxlbWVudC5zY3JvbGxUb3AgKyBlbGVtZW50LmNsaWVudFRvcCAtIDk1O1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVzZXQgY3Vyc29yXG4gICAgICovXG4gICAgb2JqLnJlc2V0Q3Vyc29yID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIFJlbW92ZSBjdXJyZW50IGN1cnNvclxuICAgICAgICBpZiAob2JqLmN1cnJlbnRJbmRleCAhPSBudWxsKSB7XG4gICAgICAgICAgICAvLyBSZW1vdmUgdmlzdWFsIGN1cnNvclxuICAgICAgICAgICAgaWYgKG9iai5pdGVtcyAmJiBvYmouaXRlbXNbb2JqLmN1cnJlbnRJbmRleF0pIHtcbiAgICAgICAgICAgICAgICBvYmouaXRlbXNbb2JqLmN1cnJlbnRJbmRleF0uZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdqZHJvcGRvd24tY3Vyc29yJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBSZXNldCBjdXJzb3JcbiAgICAgICAgICAgIG9iai5jdXJyZW50SW5kZXggPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVzZXQgY3Vyc29yXG4gICAgICovXG4gICAgb2JqLnJlc2V0U2VsZWN0ZWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gVW5zZWxlY3RlZCBhbGxcbiAgICAgICAgaWYgKG9iai5zZWxlY3RlZCkge1xuICAgICAgICAgICAgLy8gUmVtb3ZlIHZpc3VhbCBzZWxlY3Rpb25cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2JqLnNlbGVjdGVkLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKG9iai5pdGVtc1tvYmouc2VsZWN0ZWRbaV1dKSB7XG4gICAgICAgICAgICAgICAgICAgIG9iai5pdGVtc1tvYmouc2VsZWN0ZWRbaV1dLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnamRyb3Bkb3duLXNlbGVjdGVkJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gUmVzZXQgY3VycmVudCBzZWxlY3RlZCBpdGVtc1xuICAgICAgICAgICAgb2JqLnNlbGVjdGVkID0gW107XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXNldCBjdXJzb3IgYW5kIHNlbGVjdGVkIGl0ZW1zXG4gICAgICovXG4gICAgb2JqLnJlc2V0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIFJlc2V0IGN1cnNvclxuICAgICAgICBvYmoucmVzZXRDdXJzb3IoKTtcblxuICAgICAgICAvLyBSZXNldCBzZWxlY3RlZFxuICAgICAgICBvYmoucmVzZXRTZWxlY3RlZCgpO1xuXG4gICAgICAgIC8vIFVwZGF0ZSBsYWJlbHNcbiAgICAgICAgb2JqLnVwZGF0ZUxhYmVsKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmlyc3QgdmlzaWJsZSBpdGVtXG4gICAgICovXG4gICAgb2JqLmZpcnN0VmlzaWJsZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgbmV3SW5kZXggPSBudWxsO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iai5pdGVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKG9iai5pdGVtc1tpXS5lbGVtZW50LnN0eWxlLmRpc3BsYXkgIT0gJ25vbmUnKSB7XG4gICAgICAgICAgICAgICAgbmV3SW5kZXggPSBpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG5ld0luZGV4ID09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIG9iai51cGRhdGVDdXJzb3IobmV3SW5kZXgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE5hdmlnYXRpb25cbiAgICAgKi9cbiAgICBvYmouZmlyc3QgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIG5ld0luZGV4ID0gbnVsbDtcbiAgICAgICAgZm9yICh2YXIgaSA9IG9iai5jdXJyZW50SW5kZXggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgaWYgKG9iai5pdGVtc1tpXS5lbGVtZW50LnN0eWxlLmRpc3BsYXkgIT0gJ25vbmUnKSB7XG4gICAgICAgICAgICAgICAgbmV3SW5kZXggPSBpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG5ld0luZGV4ID09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIG9iai51cGRhdGVDdXJzb3IobmV3SW5kZXgpO1xuICAgIH1cblxuICAgIG9iai5sYXN0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBuZXdJbmRleCA9IG51bGw7XG4gICAgICAgIGZvciAodmFyIGkgPSBvYmouY3VycmVudEluZGV4ICsgMTsgaSA8IG9iai5pdGVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKG9iai5pdGVtc1tpXS5lbGVtZW50LnN0eWxlLmRpc3BsYXkgIT0gJ25vbmUnKSB7XG4gICAgICAgICAgICAgICAgbmV3SW5kZXggPSBpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG5ld0luZGV4ID09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIG9iai51cGRhdGVDdXJzb3IobmV3SW5kZXgpO1xuICAgIH1cblxuICAgIG9iai5uZXh0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBuZXdJbmRleCA9IG51bGw7XG4gICAgICAgIGZvciAodmFyIGkgPSBvYmouY3VycmVudEluZGV4ICsgMTsgaSA8IG9iai5pdGVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKG9iai5pdGVtc1tpXS5lbGVtZW50LnN0eWxlLmRpc3BsYXkgIT0gJ25vbmUnKSB7XG4gICAgICAgICAgICAgICAgbmV3SW5kZXggPSBpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG5ld0luZGV4ID09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIG9iai51cGRhdGVDdXJzb3IobmV3SW5kZXgpO1xuICAgIH1cblxuICAgIG9iai5wcmV2ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBuZXdJbmRleCA9IG51bGw7XG4gICAgICAgIGZvciAodmFyIGkgPSBvYmouY3VycmVudEluZGV4IC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICAgIGlmIChvYmouaXRlbXNbaV0uZWxlbWVudC5zdHlsZS5kaXNwbGF5ICE9ICdub25lJykge1xuICAgICAgICAgICAgICAgIG5ld0luZGV4ID0gaTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChuZXdJbmRleCA9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBvYmoudXBkYXRlQ3Vyc29yKG5ld0luZGV4KTtcbiAgICB9XG5cbiAgICBpZiAoISBqU3VpdGVzLmRyb3Bkb3duLmhhc0V2ZW50cykge1xuICAgICAgICBpZiAoJ29udG91Y2hzZW5kJyBpbiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQgPT09IHRydWUpIHtcbiAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc2VuZCcsIGpTdWl0ZXMuZHJvcGRvd24ubW91c2V1cCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgalN1aXRlcy5kcm9wZG93bi5tb3VzZXVwKTtcbiAgICAgICAgfVxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgalN1aXRlcy5kcm9wZG93bi5vbmtleWRvd24pO1xuXG4gICAgICAgIGpTdWl0ZXMuZHJvcGRvd24uaGFzRXZlbnRzID0gdHJ1ZTtcbiAgICB9XG5cbiAgICAvLyBTdGFydCBkcm9wZG93blxuICAgIG9iai5pbml0KCk7XG5cbiAgICAvLyBLZWVwIG9iamVjdCBhdmFpbGFibGUgZnJvbSB0aGUgbm9kZVxuICAgIGVsLmRyb3Bkb3duID0gb2JqO1xuXG4gICAgcmV0dXJuIG9iajtcbn0pO1xuXG5qU3VpdGVzLmRyb3Bkb3duLmhhc0V2ZW50cyA9IGZhbHNlO1xuXG5qU3VpdGVzLmRyb3Bkb3duLm1vdXNldXAgPSBmdW5jdGlvbihlKSB7XG4gICAgdmFyIGVsZW1lbnQgPSBqU3VpdGVzLmdldEVsZW1lbnQoZS50YXJnZXQsICdqZHJvcGRvd24nKTtcbiAgICBpZiAoZWxlbWVudCkge1xuICAgICAgICB2YXIgZHJvcGRvd24gPSBlbGVtZW50LmRyb3Bkb3duO1xuICAgICAgICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqZHJvcGRvd24taGVhZGVyJykpIHtcbiAgICAgICAgICAgIGlmIChlbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnamRyb3Bkb3duLWZvY3VzJykgJiYgZWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoJ2pkcm9wZG93bi1kZWZhdWx0JykpIHtcbiAgICAgICAgICAgICAgICBkcm9wZG93bi5jbG9zZSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBkcm9wZG93bi5vcGVuKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqZHJvcGRvd24tZ3JvdXAtbmFtZScpKSB7XG4gICAgICAgICAgICB2YXIgaXRlbXMgPSBlLnRhcmdldC5uZXh0U2libGluZy5jaGlsZHJlbjtcbiAgICAgICAgICAgIGlmIChlLnRhcmdldC5uZXh0U2libGluZy5zdHlsZS5kaXNwbGF5ICE9ICdub25lJykge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaXRlbXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW1zW2ldLnN0eWxlLmRpc3BsYXkgIT0gJ25vbmUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkcm9wZG93bi5zZWxlY3RJdGVtKGl0ZW1zW2ldKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2pkcm9wZG93bi1ncm91cC1hcnJvdycpKSB7XG4gICAgICAgICAgICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqZHJvcGRvd24tZ3JvdXAtYXJyb3ctZG93bicpKSB7XG4gICAgICAgICAgICAgICAgZS50YXJnZXQuY2xhc3NMaXN0LnJlbW92ZSgnamRyb3Bkb3duLWdyb3VwLWFycm93LWRvd24nKTtcbiAgICAgICAgICAgICAgICBlLnRhcmdldC5jbGFzc0xpc3QuYWRkKCdqZHJvcGRvd24tZ3JvdXAtYXJyb3ctdXAnKTtcbiAgICAgICAgICAgICAgICBlLnRhcmdldC5wYXJlbnROb2RlLm5leHRTaWJsaW5nLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGUudGFyZ2V0LmNsYXNzTGlzdC5yZW1vdmUoJ2pkcm9wZG93bi1ncm91cC1hcnJvdy11cCcpO1xuICAgICAgICAgICAgICAgIGUudGFyZ2V0LmNsYXNzTGlzdC5hZGQoJ2pkcm9wZG93bi1ncm91cC1hcnJvdy1kb3duJyk7XG4gICAgICAgICAgICAgICAgZS50YXJnZXQucGFyZW50Tm9kZS5uZXh0U2libGluZy5zdHlsZS5kaXNwbGF5ID0gJyc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqZHJvcGRvd24taXRlbScpKSB7XG4gICAgICAgICAgICBkcm9wZG93bi5zZWxlY3RJdGVtKGUudGFyZ2V0KTtcbiAgICAgICAgfSBlbHNlIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2pkcm9wZG93bi1pbWFnZScpKSB7XG4gICAgICAgICAgICBkcm9wZG93bi5zZWxlY3RJbmRleChlLnRhcmdldC5wYXJlbnROb2RlLmdldEF0dHJpYnV0ZSgnZGF0YS1pbmRleCcpKTtcbiAgICAgICAgfSBlbHNlIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2pkcm9wZG93bi1kZXNjcmlwdGlvbicpKSB7XG4gICAgICAgICAgICBkcm9wZG93bi5zZWxlY3RJbmRleChlLnRhcmdldC5wYXJlbnROb2RlLmdldEF0dHJpYnV0ZSgnZGF0YS1pbmRleCcpKTtcbiAgICAgICAgfSBlbHNlIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2pkcm9wZG93bi10aXRsZScpKSB7XG4gICAgICAgICAgICBkcm9wZG93bi5zZWxlY3RJbmRleChlLnRhcmdldC5wYXJlbnROb2RlLnBhcmVudE5vZGUuZ2V0QXR0cmlidXRlKCdkYXRhLWluZGV4JykpO1xuICAgICAgICB9IGVsc2UgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnamRyb3Bkb3duLWNsb3NlJykgfHwgZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqZHJvcGRvd24tYmFja2Ryb3AnKSkge1xuICAgICAgICAgICAgLy8gQ2xvc2VcbiAgICAgICAgICAgIGRyb3Bkb3duLmNsb3NlKCk7XG4gICAgICAgIH1cblxuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGpTdWl0ZXMuZHJvcGRvd24uY3VycmVudCkge1xuICAgICAgICAgICAgalN1aXRlcy5kcm9wZG93bi5jdXJyZW50LmRyb3Bkb3duLmNsb3NlKCk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cblxuLy8gS2V5ZG93biBjb250cm9sc1xualN1aXRlcy5kcm9wZG93bi5vbmtleWRvd24gPSBmdW5jdGlvbihlKSB7XG4gICAgaWYgKGpTdWl0ZXMuZHJvcGRvd24uY3VycmVudCkge1xuICAgICAgICAvLyBFbGVtZW50XG4gICAgICAgIHZhciBlbGVtZW50ID0galN1aXRlcy5kcm9wZG93bi5jdXJyZW50LmRyb3Bkb3duO1xuICAgICAgICAvLyBJbmRleFxuICAgICAgICB2YXIgaW5kZXggPSBlbGVtZW50LmN1cnJlbnRJbmRleDtcblxuICAgICAgICBpZiAoZS5zaGlmdEtleSkge1xuXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoZS53aGljaCA9PSAxMyB8fCBlLndoaWNoID09IDI3IHx8IGUud2hpY2ggPT0gMzUgfHwgZS53aGljaCA9PSAzNiB8fCBlLndoaWNoID09IDM4IHx8IGUud2hpY2ggPT0gNDApIHtcbiAgICAgICAgICAgICAgICAvLyBNb3ZlIGN1cnNvclxuICAgICAgICAgICAgICAgIGlmIChlLndoaWNoID09IDEzKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuc2VsZWN0SW5kZXgoaW5kZXgpXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlLndoaWNoID09IDM4KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmZpcnN0VmlzaWJsZSgpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGluZGV4ID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5wcmV2KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGUud2hpY2ggPT0gNDApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZmlyc3RWaXNpYmxlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaW5kZXggKyAxIDwgZWxlbWVudC5vcHRpb25zLmRhdGEubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50Lm5leHQoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZS53aGljaCA9PSAzNikge1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmZpcnN0KCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlLndoaWNoID09IDM1KSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQubGFzdCgpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZS53aGljaCA9PSAyNykge1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmpTdWl0ZXMuZHJvcGRvd24uZXh0cmFjdEZyb21Eb20gPSBmdW5jdGlvbihlbCwgb3B0aW9ucykge1xuICAgIC8vIEtlZXAgcmVmZXJlbmNlXG4gICAgdmFyIHNlbGVjdCA9IGVsO1xuICAgIGlmICghIG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IHt9O1xuICAgIH1cbiAgICAvLyBQcmVwYXJlIGNvbmZpZ3VyYXRpb25cbiAgICBpZiAoZWwuZ2V0QXR0cmlidXRlKCdtdWx0aXBsZScpICYmICghIG9wdGlvbnMgfHwgb3B0aW9ucy5tdWx0aXBsZSA9PSB1bmRlZmluZWQpKSB7XG4gICAgICAgIG9wdGlvbnMubXVsdGlwbGUgPSB0cnVlO1xuICAgIH1cbiAgICBpZiAoZWwuZ2V0QXR0cmlidXRlKCdwbGFjZWhvbGRlcicpICYmICghIG9wdGlvbnMgfHwgb3B0aW9ucy5wbGFjZWhvbGRlciA9PSB1bmRlZmluZWQpKSB7XG4gICAgICAgIG9wdGlvbnMucGxhY2Vob2xkZXIgPSBlbC5nZXRBdHRyaWJ1dGUoJ3BsYWNlaG9sZGVyJyk7XG4gICAgfVxuICAgIGlmIChlbC5nZXRBdHRyaWJ1dGUoJ2RhdGEtYXV0b2NvbXBsZXRlJykgJiYgKCEgb3B0aW9ucyB8fCBvcHRpb25zLmF1dG9jb21wbGV0ZSA9PSB1bmRlZmluZWQpKSB7XG4gICAgICAgIG9wdGlvbnMuYXV0b2NvbXBsZXRlID0gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKCEgb3B0aW9ucyB8fCBvcHRpb25zLndpZHRoID09IHVuZGVmaW5lZCkge1xuICAgICAgICBvcHRpb25zLndpZHRoID0gZWwub2Zmc2V0V2lkdGg7XG4gICAgfVxuICAgIGlmIChlbC52YWx1ZSAmJiAoISBvcHRpb25zIHx8IG9wdGlvbnMudmFsdWUgPT0gdW5kZWZpbmVkKSkge1xuICAgICAgICBvcHRpb25zLnZhbHVlID0gZWwudmFsdWU7XG4gICAgfVxuICAgIGlmICghIG9wdGlvbnMgfHwgb3B0aW9ucy5kYXRhID09IHVuZGVmaW5lZCkge1xuICAgICAgICBvcHRpb25zLmRhdGEgPSBbXTtcbiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBlbC5jaGlsZHJlbi5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgaWYgKGVsLmNoaWxkcmVuW2pdLnRhZ05hbWUgPT0gJ09QVEdST1VQJykge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZWwuY2hpbGRyZW5bal0uY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5kYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGVsLmNoaWxkcmVuW2pdLmNoaWxkcmVuW2ldLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogZWwuY2hpbGRyZW5bal0uY2hpbGRyZW5baV0uaW5uZXJIVE1MLFxuICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXA6IGVsLmNoaWxkcmVuW2pdLmdldEF0dHJpYnV0ZSgnbGFiZWwnKSxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBvcHRpb25zLmRhdGEucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIGlkOiBlbC5jaGlsZHJlbltqXS52YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogZWwuY2hpbGRyZW5bal0uaW5uZXJIVE1MLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGlmICghIG9wdGlvbnMgfHwgb3B0aW9ucy5vbmNoYW5nZSA9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgb3B0aW9ucy5vbmNoYW5nZSA9IGZ1bmN0aW9uKGEsYixjLGQpIHtcbiAgICAgICAgICAgIGlmIChvcHRpb25zLm11bHRpcGxlID09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBpZiAob2JqLml0ZW1zW2JdLmNsYXNzTGlzdC5jb250YWlucygnamRyb3Bkb3duLXNlbGVjdGVkJykpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0Lm9wdGlvbnNbYl0uc2V0QXR0cmlidXRlKCdzZWxlY3RlZCcsICdzZWxlY3RlZCcpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdC5vcHRpb25zW2JdLnJlbW92ZUF0dHJpYnV0ZSgnc2VsZWN0ZWQnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHNlbGVjdC52YWx1ZSA9IGQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gQ3JlYXRlIERJVlxuICAgIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBlbC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShkaXYsIGVsKTtcbiAgICBlbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgIGVsID0gZGl2O1xuXG4gICAgcmV0dXJuIHsgZWw6ZWwsIG9wdGlvbnM6b3B0aW9ucyB9O1xufVxyXG5cclxuLyoqXG4gKiAoYykgalRvb2xzIFRleHQgRWRpdG9yXG4gKiBodHRwczovL2dpdGh1Yi5jb20vcGF1bGhvZGVsL2p0b29sc1xuICpcbiAqIEBhdXRob3I6IFBhdWwgSG9kZWwgPHBhdWwuaG9kZWxAZ21haWwuY29tPlxuICogQGRlc2NyaXB0aW9uOiBJbmxpbmUgcmljaHRleHQgZWRpdG9yXG4gKi9cblxualN1aXRlcy5lZGl0b3IgPSAoZnVuY3Rpb24oZWwsIG9wdGlvbnMpIHtcbiAgICB2YXIgb2JqID0ge307XG4gICAgb2JqLm9wdGlvbnMgPSB7fTtcblxuICAgIC8vIERlZmF1bHQgY29uZmlndXJhdGlvblxuICAgIHZhciBkZWZhdWx0cyA9IHtcbiAgICAgICAgLy8gSW5pdGlhbCBIVE1MIGNvbnRlbnRcbiAgICAgICAgdmFsdWU6IG51bGwsXG4gICAgICAgIC8vIEluaXRpYWwgc25pcHBldFxuICAgICAgICBzbmlwcGV0OiBudWxsLFxuICAgICAgICAvLyBBZGQgdG9vbGJhclxuICAgICAgICB0b29sYmFyOiBudWxsLFxuICAgICAgICAvLyBNYXggaGVpZ2h0XG4gICAgICAgIG1heEhlaWdodDogbnVsbCxcbiAgICAgICAgLy8gV2Vic2l0ZSBwYXJzZXIgaXMgdG8gcmVhZCB3ZWJzaXRlcyBhbmQgaW1hZ2VzIGZyb20gY3Jvc3MgZG9tYWluXG4gICAgICAgIHJlbW90ZVBhcnNlcjogbnVsbCxcbiAgICAgICAgLy8gS2V5IGZyb20geW91dHViZSB0byByZWFkIHByb3BlcnRpZXMgZnJvbSBVUkxcbiAgICAgICAgeW91dHViZUtleTogbnVsbCxcbiAgICAgICAgLy8gVXNlciBsaXN0XG4gICAgICAgIHVzZXJTZWFyY2g6IG51bGwsXG4gICAgICAgIC8vIFBhcnNlIFVSTFxuICAgICAgICBwYXJzZVVSTDogZmFsc2UsXG4gICAgICAgIC8vIEFjY2VwdCBkcm9wIGZpbGVzXG4gICAgICAgIGRyb3Bab25lOiB0cnVlLFxuICAgICAgICBkcm9wQXNBdHRhY2htZW50OiBmYWxzZSxcbiAgICAgICAgYWNjZXB0SW1hZ2VzOiB0cnVlLFxuICAgICAgICBhY2NlcHRGaWxlczogZmFsc2UsXG4gICAgICAgIG1heEZpbGVTaXplOiA1MDAwMDAwLCBcbiAgICAgICAgLy8gQm9yZGVyXG4gICAgICAgIGJvcmRlcjogdHJ1ZSxcbiAgICAgICAgcGFkZGluZzogdHJ1ZSxcbiAgICAgICAgZm9jdXM6IGZhbHNlLFxuICAgICAgICAvLyBFdmVudHNcbiAgICAgICAgb25jbGljazogbnVsbCxcbiAgICAgICAgb25mb2N1czogbnVsbCxcbiAgICAgICAgb25ibHVyOiBudWxsLFxuICAgICAgICBvbmxvYWQ6IG51bGwsXG4gICAgICAgIG9uZW50ZXI6IG51bGwsXG4gICAgICAgIG9ua2V5dXA6IG51bGwsXG4gICAgICAgIG9ua2V5ZG93bjogbnVsbCxcbiAgICB9O1xuXG4gICAgLy8gTG9vcCB0aHJvdWdoIG91ciBvYmplY3RcbiAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBkZWZhdWx0cykge1xuICAgICAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmhhc093blByb3BlcnR5KHByb3BlcnR5KSkge1xuICAgICAgICAgICAgb2JqLm9wdGlvbnNbcHJvcGVydHldID0gb3B0aW9uc1twcm9wZXJ0eV07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBvYmoub3B0aW9uc1twcm9wZXJ0eV0gPSBkZWZhdWx0c1twcm9wZXJ0eV07XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBQcml2YXRlIGNvbnRyb2xsZXJzXG4gICAgdmFyIGltYWdlUmVzaXplID0gMDtcbiAgICB2YXIgZWRpdG9yVGltZXIgPSBudWxsO1xuICAgIHZhciBlZGl0b3JBY3Rpb24gPSBudWxsO1xuXG4gICAgLy8gTWFrZSBzdXJlIGVsZW1lbnQgaXMgZW1wdHlcbiAgICBlbC5pbm5lckhUTUwgPSAnJztcblxuICAgIC8vIFByZXBhcmUgY29udGFpbmVyXG4gICAgZWwuY2xhc3NMaXN0LmFkZCgnamVkaXRvci1jb250YWluZXInKTtcblxuICAgIC8vIFBhZGRpbmdcbiAgICBpZiAob2JqLm9wdGlvbnMucGFkZGluZyA9PSB0cnVlKSB7XG4gICAgICAgIGVsLmNsYXNzTGlzdC5hZGQoJ2plZGl0b3ItcGFkZGluZycpO1xuICAgIH1cblxuICAgIC8vIEJvcmRlclxuICAgIGlmIChvYmoub3B0aW9ucy5ib3JkZXIgPT0gZmFsc2UpIHtcbiAgICAgICAgZWwuc3R5bGUuYm9yZGVyID0gJzBweCc7XG4gICAgfVxuXG4gICAgLy8gU25pcHBldFxuICAgIHZhciBzbmlwcGV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgc25pcHBldC5jbGFzc05hbWUgPSAnc25pcHBldCc7XG4gICAgc25pcHBldC5zZXRBdHRyaWJ1dGUoJ2NvbnRlbnRlZGl0YWJsZScsIGZhbHNlKTtcblxuICAgIC8vIFRvb2xiYXJcbiAgICB2YXIgdG9vbGJhciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIHRvb2xiYXIuY2xhc3NOYW1lID0gJ2plZGl0b3ItdG9vbGJhcic7XG5cbiAgICAvLyBDcmVhdGUgZWRpdG9yXG4gICAgdmFyIGVkaXRvciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGVkaXRvci5zZXRBdHRyaWJ1dGUoJ2NvbnRlbnRlZGl0YWJsZScsIHRydWUpO1xuICAgIGVkaXRvci5zZXRBdHRyaWJ1dGUoJ3NwZWxsY2hlY2snLCBmYWxzZSk7XG4gICAgZWRpdG9yLmNsYXNzTmFtZSA9ICdqZWRpdG9yJztcblxuICAgIC8vIE1heCBoZWlnaHRcbiAgICBpZiAob2JqLm9wdGlvbnMubWF4SGVpZ2h0KSB7XG4gICAgICAgIGVkaXRvci5zdHlsZS5vdmVyZmxvd1kgPSAnYXV0byc7XG4gICAgICAgIGVkaXRvci5zdHlsZS5tYXhIZWlnaHQgPSBvYmoub3B0aW9ucy5tYXhIZWlnaHQ7XG4gICAgfVxuXG4gICAgLy8gU2V0IGVkaXRvciBpbml0aWFsIHZhbHVlXG4gICAgaWYgKG9iai5vcHRpb25zLnZhbHVlKSB7XG4gICAgICAgIHZhciB2YWx1ZSA9IG9iai5vcHRpb25zLnZhbHVlO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciB2YWx1ZSA9IGVsLmlubmVySFRNTCA/IGVsLmlubmVySFRNTCA6ICcnOyBcbiAgICB9XG5cbiAgICBpZiAoISB2YWx1ZSkge1xuICAgICAgICB2YXIgdmFsdWUgPSAnPGJyPic7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRXh0cmFjdCBpbWFnZXMgZnJvbSBhIEhUTUwgc3RyaW5nXG4gICAgICovXG4gICAgdmFyIGV4dHJhY3RJbWFnZUZyb21IdG1sID0gZnVuY3Rpb24oaHRtbCkge1xuICAgICAgICAvLyBDcmVhdGUgdGVtcCBlbGVtZW50XG4gICAgICAgIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgZGl2LmlubmVySFRNTCA9IGh0bWw7XG5cbiAgICAgICAgLy8gRXh0cmFjdCBpbWFnZXNcbiAgICAgICAgdmFyIGltZyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKCdpbWcnKTtcblxuICAgICAgICBpZiAoaW1nLmxlbmd0aCkge1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbWcubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBvYmouYWRkSW1hZ2UoaW1nW2ldLnNyYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJbnNlcnQgbm9kZSBhdCBjYXJldFxuICAgICAqL1xuICAgIHZhciBpbnNlcnROb2RlQXRDYXJldCA9IGZ1bmN0aW9uKG5ld05vZGUpIHtcbiAgICAgICAgdmFyIHNlbCwgcmFuZ2U7XG5cbiAgICAgICAgaWYgKHdpbmRvdy5nZXRTZWxlY3Rpb24pIHtcbiAgICAgICAgICAgIHNlbCA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKTtcbiAgICAgICAgICAgIGlmIChzZWwucmFuZ2VDb3VudCkge1xuICAgICAgICAgICAgICAgIHJhbmdlID0gc2VsLmdldFJhbmdlQXQoMCk7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGVjdGVkVGV4dCA9IHJhbmdlLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgcmFuZ2UuZGVsZXRlQ29udGVudHMoKTtcbiAgICAgICAgICAgICAgICByYW5nZS5pbnNlcnROb2RlKG5ld05vZGUpOyBcbiAgICAgICAgICAgICAgICAvLyBtb3ZlIHRoZSBjdXJzb3IgYWZ0ZXIgZWxlbWVudFxuICAgICAgICAgICAgICAgIHJhbmdlLnNldFN0YXJ0QWZ0ZXIobmV3Tm9kZSk7XG4gICAgICAgICAgICAgICAgcmFuZ2Uuc2V0RW5kQWZ0ZXIobmV3Tm9kZSk7IFxuICAgICAgICAgICAgICAgIHNlbC5yZW1vdmVBbGxSYW5nZXMoKTtcbiAgICAgICAgICAgICAgICBzZWwuYWRkUmFuZ2UocmFuZ2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQXBwZW5kIHNuaXBwZXQgb3IgdGh1bWJzIGluIHRoZSBlZGl0b3JcbiAgICAgKiBAUGFyYW0gb2JqZWN0IGRhdGFcbiAgICAgKi9cbiAgICB2YXIgYXBwZW5kRWxlbWVudCA9IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgLy8gUmVzZXQgc25pcHBldFxuICAgICAgICBzbmlwcGV0LmlubmVySFRNTCA9ICcnO1xuXG4gICAgICAgIGlmIChkYXRhLmltYWdlKSB7XG4gICAgICAgICAgICB2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICBkaXYuY2xhc3NOYW1lID0gJ3NuaXBwZXQtaW1hZ2UnO1xuICAgICAgICAgICAgZGl2LnNldEF0dHJpYnV0ZSgnZGF0YS1rJywgJ2ltYWdlJyk7XG4gICAgICAgICAgICBzbmlwcGV0LmFwcGVuZENoaWxkKGRpdik7XG5cbiAgICAgICAgICAgIHZhciBpbWFnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xuICAgICAgICAgICAgaW1hZ2Uuc3JjID0gZGF0YS5pbWFnZTtcbiAgICAgICAgICAgIGRpdi5hcHBlbmRDaGlsZChpbWFnZSk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIGRpdi5jbGFzc05hbWUgPSAnc25pcHBldC10aXRsZSc7XG4gICAgICAgIGRpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtaycsICd0aXRsZScpO1xuICAgICAgICBkaXYuaW5uZXJIVE1MID0gZGF0YS50aXRsZTtcbiAgICAgICAgc25pcHBldC5hcHBlbmRDaGlsZChkaXYpO1xuXG4gICAgICAgIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgZGl2LmNsYXNzTmFtZSA9ICdzbmlwcGV0LWRlc2NyaXB0aW9uJztcbiAgICAgICAgZGl2LnNldEF0dHJpYnV0ZSgnZGF0YS1rJywgJ2Rlc2NyaXB0aW9uJyk7XG4gICAgICAgIGRpdi5pbm5lckhUTUwgPSBkYXRhLmRlc2NyaXB0aW9uO1xuICAgICAgICBzbmlwcGV0LmFwcGVuZENoaWxkKGRpdik7XG5cbiAgICAgICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBkaXYuY2xhc3NOYW1lID0gJ3NuaXBwZXQtaG9zdCc7XG4gICAgICAgIGRpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtaycsICdob3N0Jyk7XG4gICAgICAgIGRpdi5pbm5lckhUTUwgPSBkYXRhLmhvc3Q7XG4gICAgICAgIHNuaXBwZXQuYXBwZW5kQ2hpbGQoZGl2KTtcblxuICAgICAgICB2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIGRpdi5jbGFzc05hbWUgPSAnc25pcHBldC11cmwnO1xuICAgICAgICBkaXYuc2V0QXR0cmlidXRlKCdkYXRhLWsnLCAndXJsJyk7XG4gICAgICAgIGRpdi5pbm5lckhUTUwgPSBkYXRhLnVybDtcbiAgICAgICAgc25pcHBldC5hcHBlbmRDaGlsZChkaXYpO1xuXG4gICAgICAgIGVkaXRvci5hcHBlbmRDaGlsZChzbmlwcGV0KTtcbiAgICB9XG5cbiAgICB2YXIgdmVyaWZ5RWRpdG9yID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGNsZWFyVGltZW91dChlZGl0b3JUaW1lcik7XG4gICAgICAgIGVkaXRvclRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBzbmlwcGV0ID0gZWRpdG9yLnF1ZXJ5U2VsZWN0b3IoJy5zbmlwcGV0Jyk7XG4gICAgICAgICAgICB2YXIgdGh1bWJzQ29udGFpbmVyID0gZWwucXVlcnlTZWxlY3RvcignLmplZGl0b3ItdGh1bWJzLWNvbnRhaW5lcicpO1xuXG4gICAgICAgICAgICBpZiAoISBzbmlwcGV0ICYmICEgdGh1bWJzQ29udGFpbmVyKSB7XG4gICAgICAgICAgICAgICAgdmFyIGh0bWwgPSBlZGl0b3IuaW5uZXJIVE1MLnJlcGxhY2UoL1xcbi9nLCAnICcpO1xuICAgICAgICAgICAgICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gaHRtbDtcbiAgICAgICAgICAgICAgICB2YXIgdGh1bWJzQ29udGFpbmVyID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5qZWRpdG9yLXRodW1icy1jb250YWluZXInKTtcbiAgICAgICAgICAgICAgICBpZiAodGh1bWJzQ29udGFpbmVyKSB7XG4gICAgICAgICAgICAgICAgICAgIHRodW1ic0NvbnRhaW5lci5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIHRleHQgPSBjb250YWluZXIuaW5uZXJUZXh0OyBcbiAgICAgICAgICAgICAgICB2YXIgdXJsID0galN1aXRlcy5lZGl0b3IuZGV0ZWN0VXJsKHRleHQpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHVybCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodXJsWzBdLnN1YnN0cigtMykgPT0gJ2pwZycgfHwgdXJsWzBdLnN1YnN0cigtMykgPT0gJ3BuZycgfHwgdXJsWzBdLnN1YnN0cigtMykgPT0gJ2dpZicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqU3VpdGVzLmVkaXRvci5nZXREb21haW4odXJsWzBdKSA9PSB3aW5kb3cubG9jYXRpb24uaG9zdG5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouaW1wb3J0SW1hZ2UodXJsWzBdLCAnJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5pbXBvcnRJbWFnZShvYmoub3B0aW9ucy5yZW1vdGVQYXJzZXIgKyB1cmxbMF0sICcnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpZCA9IGpTdWl0ZXMuZWRpdG9yLnlvdXR1YmVQYXJzZXIodXJsWzBdKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmdldFlvdXR1YmUoaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouZ2V0V2Vic2l0ZSh1cmxbMF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LCAxMDAwKTtcbiAgICB9XG5cbiAgICBvYmoucGFyc2VDb250ZW50ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZlcmlmeUVkaXRvcigpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBtZXRhZGF0YSBmcm9tIGEgeW91dHViZSB2aWRlb1xuICAgICAqL1xuICAgIG9iai5nZXRZb3V0dWJlID0gZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgaWYgKCEgb2JqLm9wdGlvbnMueW91dHViZUtleSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignVGhlIHlvdXR1YmVLZXkgaXMgbm90IGRlZmluZWQnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGpTdWl0ZXMuYWpheCh7XG4gICAgICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20veW91dHViZS92My92aWRlb3M/cGFydD1zbmlwcGV0LHN0YXRpc3RpY3Mma2V5PScgKyBvYmoub3B0aW9ucy55b3V0dWJlS2V5ICsgJyZpZD0nICsgaWQsXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBPbmx5IHZhbGlkIGVsZW1lbnRzIHRvIGJlIGFwcGVuZGVkXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuaXRlbXMgJiYgcmVzdWx0Lml0ZW1zWzBdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcCA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICcnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlOiAnJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3N0OiAnd3d3LnlvdXR1YmUuY29tJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6ICdodHRwczovL3d3dy55b3V0dWJlLmNvbT93YXRjaD0nICsgaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0Lml0ZW1zWzBdLnNuaXBwZXQudGl0bGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwLnRpdGxlID0gcmVzdWx0Lml0ZW1zWzBdLnNuaXBwZXQudGl0bGU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0Lml0ZW1zWzBdLnNuaXBwZXQuZGVzY3JpcHRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwLmRlc2NyaXB0aW9uID0gcmVzdWx0Lml0ZW1zWzBdLnNuaXBwZXQuZGVzY3JpcHRpb247XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocC5kZXNjcmlwdGlvbi5sZW5ndGggPiAxNTApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcC5kZXNjcmlwdGlvbiA9IHAuZGVzY3JpcHRpb24uc3Vic3RyKDAsIDE1MCkgKyAnLi4uJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0Lml0ZW1zWzBdLnNuaXBwZXQudGh1bWJuYWlscy5tZWRpdW0udXJsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcC5pbWFnZSA9IHJlc3VsdC5pdGVtc1swXS5zbmlwcGV0LnRodW1ibmFpbHMubWVkaXVtLnVybDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kRWxlbWVudChwKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IG1ldGEgaW5mb3JtYXRpb24gZnJvbSBhIHdlYnNpdGVcbiAgICAgKi9cbiAgICBvYmouZ2V0V2Vic2l0ZSA9IGZ1bmN0aW9uKHVybCkge1xuICAgICAgICBpZiAoISBvYmoub3B0aW9ucy5yZW1vdGVQYXJzZXIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdUaGUgcmVtb3RlUGFyc2VyIGlzIG5vdCBkZWZpbmVkJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBqU3VpdGVzLmFqYXgoe1xuICAgICAgICAgICAgICAgIHVybDogb2JqLm9wdGlvbnMucmVtb3RlUGFyc2VyICsgZW5jb2RlVVJJKHVybC50cmltKCkpLFxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHAgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJycsXG4gICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJycsXG4gICAgICAgICAgICAgICAgICAgICAgICBpbWFnZTogJycsXG4gICAgICAgICAgICAgICAgICAgICAgICBob3N0OiB1cmwsXG4gICAgICAgICAgICAgICAgICAgICAgICB1cmw6IHVybCxcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQudGl0bGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHAudGl0bGUgPSByZXN1bHQudGl0bGU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5kZXNjcmlwdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcC5kZXNjcmlwdGlvbiA9IHJlc3VsdC5kZXNjcmlwdGlvbjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmltYWdlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwLmltYWdlID0gcmVzdWx0LmltYWdlO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3VsdFsnb2c6aW1hZ2UnXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcC5pbWFnZSA9IHJlc3VsdFsnb2c6aW1hZ2UnXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0Lmhvc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHAuaG9zdCA9IHJlc3VsdC5ob3N0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQudXJsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwLnVybCA9IHJlc3VsdC51cmw7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBhcHBlbmRFbGVtZW50KHApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0IGVkaXRvciB2YWx1ZVxuICAgICAqL1xuICAgIG9iai5zZXREYXRhID0gZnVuY3Rpb24oaHRtbCkge1xuICAgICAgICBlZGl0b3IuaW5uZXJIVE1MID0gaHRtbDtcbiAgICAgICAgY3Vyc29yKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IGVkaXRvciBkYXRhXG4gICAgICovXG4gICAgb2JqLmdldERhdGEgPSBmdW5jdGlvbihqc29uKSB7XG4gICAgICAgIGlmICghIGpzb24pIHtcbiAgICAgICAgICAgIHZhciBkYXRhID0gZWRpdG9yLmlubmVySFRNTDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgIGNvbnRlbnQgOiAnJyxcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gR2V0IHRhZyB1c2Vyc1xuICAgICAgICAgICAgdmFyIHRhZ2dlZCA9IGVkaXRvci5xdWVyeVNlbGVjdG9yQWxsKCcucG9zdC10YWcnKTtcbiAgICAgICAgICAgIGlmICh0YWdnZWQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgZGF0YS51c2VycyA9IFtdO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGFnZ2VkLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB1c2VySWQgPSB0YWdnZWRbaV0uZ2V0QXR0cmlidXRlKCdkYXRhLXVzZXInKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJJZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS51c2Vycy5wdXNoKHVzZXJJZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZGF0YS51c2VycyA9IGRhdGEudXNlcnMuam9pbignLCcpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoc25pcHBldC5pbm5lckhUTUwpIHtcbiAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSAwO1xuICAgICAgICAgICAgICAgIGRhdGEuc25pcHBldCA9IHt9O1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc25pcHBldC5jaGlsZHJlbi5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAvLyBHZXQga2V5IGZyb20gZWxlbWVudFxuICAgICAgICAgICAgICAgICAgICB2YXIga2V5ID0gc25pcHBldC5jaGlsZHJlbltpXS5nZXRBdHRyaWJ1dGUoJ2RhdGEtaycpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoa2V5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoa2V5ID09ICdpbWFnZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnNuaXBwZXQuaW1hZ2UgPSBzbmlwcGV0LmNoaWxkcmVuW2ldLmNoaWxkcmVuWzBdLmdldEF0dHJpYnV0ZSgnc3JjJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuc25pcHBldFtrZXldID0gc25pcHBldC5jaGlsZHJlbltpXS5pbm5lckhUTUw7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBzbmlwcGV0LmlubmVySFRNTCA9ICcnO1xuICAgICAgICAgICAgICAgIHNuaXBwZXQucmVtb3ZlKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciB0ZXh0ID0gZWRpdG9yLmlubmVySFRNTDtcbiAgICAgICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoLzxicj4vZywgXCJcXG5cIik7XG4gICAgICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC88XFwvZGl2Pi9nLCBcIjxcXC9kaXY+XFxuXCIpO1xuICAgICAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvPCg/Oi58XFxuKSo/Pi9nbSwgXCJcIik7XG4gICAgICAgICAgICBkYXRhLmNvbnRlbnQgPSB0ZXh0LnRyaW0oKTtcbiAgICAgICAgICAgIGRhdGEgPSBKU09OLnN0cmluZ2lmeShkYXRhKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBkYXRhO1xuICAgIH1cblxuICAgIC8vIFJlc2V0XG4gICAgb2JqLnJlc2V0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGVkaXRvci5pbm5lckhUTUwgPSAnJztcbiAgICB9XG5cbiAgICBvYmouYWRkUGRmID0gZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICBpZiAoZGF0YS5yZXN1bHQuc3Vic3RyKDAsNCkgIT0gJ2RhdGEnKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdJbnZhbGlkIHNvdXJjZScpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xuICAgICAgICAgICAgY2FudmFzLndpZHRoID0gNjA7XG4gICAgICAgICAgICBjYW52YXMuaGVpZ2h0ID0gNjA7XG5cbiAgICAgICAgICAgIHZhciBpbWcgPSBuZXcgSW1hZ2UoKTtcbiAgICAgICAgICAgIHZhciBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoaW1nLCAwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xuXG4gICAgICAgICAgICBjYW52YXMudG9CbG9iKGZ1bmN0aW9uKGJsb2IpIHtcbiAgICAgICAgICAgICAgICB2YXIgbmV3SW1hZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcbiAgICAgICAgICAgICAgICBuZXdJbWFnZS5zcmMgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcbiAgICAgICAgICAgICAgICBuZXdJbWFnZS5zZXRBdHRyaWJ1dGUoJ2RhdGEtZXh0ZW5zaW9uJywgJ3BkZicpO1xuICAgICAgICAgICAgICAgIGlmIChkYXRhLm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgbmV3SW1hZ2Uuc2V0QXR0cmlidXRlKCdkYXRhLW5hbWUnLCBkYXRhLm5hbWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoZGF0YS5zaXplKSB7XG4gICAgICAgICAgICAgICAgICAgIG5ld0ltYWdlLnNldEF0dHJpYnV0ZSgnZGF0YS1zaXplJywgZGF0YS5zaXplKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEuZGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICBuZXdJbWFnZS5zZXRBdHRyaWJ1dGUoJ2RhdGEtZGF0ZScsIGRhdGEuZGF0ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG5ld0ltYWdlLmNsYXNzTmFtZSA9ICdqZmlsZSBwZGYnO1xuXG4gICAgICAgICAgICAgICAgaW5zZXJ0Tm9kZUF0Q2FyZXQobmV3SW1hZ2UpO1xuICAgICAgICAgICAgICAgIGpTdWl0ZXMuZmlsZXNbbmV3SW1hZ2Uuc3JjXSA9IGRhdGEucmVzdWx0LnN1YnN0cihkYXRhLnJlc3VsdC5pbmRleE9mKCcsJykgKyAxKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgb2JqLmFkZEltYWdlID0gZnVuY3Rpb24oc3JjLCBuYW1lLCBzaXplLCBkYXRlKSB7XG4gICAgICAgIGlmIChzcmMuc3Vic3RyKDAsNCkgIT0gJ2RhdGEnICYmICEgb2JqLm9wdGlvbnMucmVtb3RlUGFyc2VyKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdyZW1vdGVQYXJzZXIgbm90IGRlZmluZWQgaW4geW91ciBpbml0aWFsaXphdGlvbicpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gVGhpcyBpcyB0byBwcm9jZXNzIGNyb3NzIGRvbWFpbiBpbWFnZXNcbiAgICAgICAgICAgIGlmIChzcmMuc3Vic3RyKDAsNCkgPT0gJ2RhdGEnKSB7XG4gICAgICAgICAgICAgICAgdmFyIGV4dGVuc2lvbiA9IHNyYy5zcGxpdCgnOycpXG4gICAgICAgICAgICAgICAgZXh0ZW5zaW9uID0gZXh0ZW5zaW9uWzBdLnNwbGl0KCcvJyk7XG4gICAgICAgICAgICAgICAgZXh0ZW5zaW9uID0gZXh0ZW5zaW9uWzFdO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgZXh0ZW5zaW9uID0gc3JjLnN1YnN0cihzcmMubGFzdEluZGV4T2YoJy4nKSArIDEpO1xuICAgICAgICAgICAgICAgIC8vIFdvcmsgZm9yIGNyb3NzIGJyb3dzZXJzXG4gICAgICAgICAgICAgICAgc3JjID0gb2JqLm9wdGlvbnMucmVtb3RlUGFyc2VyICsgc3JjO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7XG5cbiAgICAgICAgICAgIGltZy5vbmxvYWQgPSBmdW5jdGlvbiBvbmxvYWQoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xuICAgICAgICAgICAgICAgIGNhbnZhcy53aWR0aCA9IGltZy53aWR0aDtcbiAgICAgICAgICAgICAgICBjYW52YXMuaGVpZ2h0ID0gaW1nLmhlaWdodDtcblxuICAgICAgICAgICAgICAgIHZhciBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKGltZywgMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTtcblxuICAgICAgICAgICAgICAgIGNhbnZhcy50b0Jsb2IoZnVuY3Rpb24oYmxvYikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbmV3SW1hZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcbiAgICAgICAgICAgICAgICAgICAgbmV3SW1hZ2Uuc3JjID0gd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XG4gICAgICAgICAgICAgICAgICAgIG5ld0ltYWdlLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnOTAwJyk7XG4gICAgICAgICAgICAgICAgICAgIG5ld0ltYWdlLnNldEF0dHJpYnV0ZSgnZGF0YS1leHRlbnNpb24nLCBleHRlbnNpb24pO1xuICAgICAgICAgICAgICAgICAgICBpZiAobmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV3SW1hZ2Uuc2V0QXR0cmlidXRlKCdkYXRhLW5hbWUnLCBuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoc2l6ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV3SW1hZ2Uuc2V0QXR0cmlidXRlKCdkYXRhLXNpemUnLCBzaXplKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV3SW1hZ2Uuc2V0QXR0cmlidXRlKCdkYXRhLWRhdGUnLCBkYXRlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBuZXdJbWFnZS5jbGFzc05hbWUgPSAnamZpbGUnO1xuICAgICAgICAgICAgICAgICAgICB2YXIgY29udGVudCA9IGNhbnZhcy50b0RhdGFVUkwoKTtcbiAgICAgICAgICAgICAgICAgICAgaW5zZXJ0Tm9kZUF0Q2FyZXQobmV3SW1hZ2UpO1xuXG4gICAgICAgICAgICAgICAgICAgIGpTdWl0ZXMuZmlsZXNbbmV3SW1hZ2Uuc3JjXSA9IGNvbnRlbnQuc3Vic3RyKGNvbnRlbnQuaW5kZXhPZignLCcpICsgMSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpbWcuc3JjID0gc3JjO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgb2JqLmFkZEZpbGUgPSBmdW5jdGlvbihmaWxlcykge1xuICAgICAgICB2YXIgcmVhZGVyID0gW107XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBmaWxlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKGZpbGVzW2ldLnNpemUgPiBvYmoub3B0aW9ucy5tYXhGaWxlU2l6ZSkge1xuICAgICAgICAgICAgICAgIGFsZXJ0KCdUaGUgZmlsZSBpcyB0b28gYmlnJyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIE9ubHkgUERGIG9yIEltYWdlc1xuICAgICAgICAgICAgICAgIHZhciB0eXBlID0gZmlsZXNbaV0udHlwZS5zcGxpdCgnLycpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVbMF0gPT0gJ2ltYWdlJykge1xuICAgICAgICAgICAgICAgICAgICB0eXBlID0gMTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVbMV0gPT0gJ3BkZicpIHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZSA9IDI7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZSA9IDA7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGZpbGVcbiAgICAgICAgICAgICAgICAgICAgcmVhZGVyW2ldID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgcmVhZGVyW2ldLmluZGV4ID0gaTtcbiAgICAgICAgICAgICAgICAgICAgcmVhZGVyW2ldLnR5cGUgPSB0eXBlO1xuICAgICAgICAgICAgICAgICAgICByZWFkZXJbaV0ubmFtZSA9IGZpbGVzW2ldLm5hbWU7XG4gICAgICAgICAgICAgICAgICAgIHJlYWRlcltpXS5kYXRlID0gZmlsZXNbaV0ubGFzdE1vZGlmaWVkO1xuICAgICAgICAgICAgICAgICAgICByZWFkZXJbaV0uc2l6ZSA9IGZpbGVzW2ldLnNpemU7XG4gICAgICAgICAgICAgICAgICAgIHJlYWRlcltpXS5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gR2V0IHJlc3VsdFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEudGFyZ2V0LnR5cGUgPT0gMikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5hY2NlcHRGaWxlcyA9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5hZGRQZGYoZGF0YS50YXJnZXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmFkZEltYWdlKGRhdGEudGFyZ2V0LnJlc3VsdCwgZGF0YS50YXJnZXQubmFtZSwgZGF0YS50b3RhbCwgZGF0YS50YXJnZXQubGFzdE1vZGlmaWVkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSwgZmFsc2UpO1xuXG4gICAgICAgICAgICAgICAgICAgIHJlYWRlcltpXS5yZWFkQXNEYXRhVVJMKGZpbGVzW2ldKVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGFsZXJ0KCdUaGUgZXh0ZW5zaW9uIGlzIG5vdCBhbGxvd2VkJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gRGVzdHJveVxuICAgIG9iai5kZXN0cm95ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGVkaXRvci5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgZWRpdG9yTW91c2VVcCk7XG4gICAgICAgIGVkaXRvci5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBlZGl0b3JNb3VzZURvd24pO1xuICAgICAgICBlZGl0b3IucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgZWRpdG9yTW91c2VNb3ZlKTtcbiAgICAgICAgZWRpdG9yLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleXVwJywgZWRpdG9yS2V5VXApO1xuICAgICAgICBlZGl0b3IucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGVkaXRvcktleURvd24pO1xuICAgICAgICBlZGl0b3IucmVtb3ZlRXZlbnRMaXN0ZW5lcignZHJhZ3N0YXJ0JywgZWRpdG9yRHJhZ1N0YXJ0KTtcbiAgICAgICAgZWRpdG9yLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2RyYWdlbnRlcicsIGVkaXRvckRyYWdFbnRlcik7XG4gICAgICAgIGVkaXRvci5yZW1vdmVFdmVudExpc3RlbmVyKCdkcmFnb3ZlcicsIGVkaXRvckRyYWdPdmVyKTtcbiAgICAgICAgZWRpdG9yLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2Ryb3AnLCBlZGl0b3JEcm9wKTtcbiAgICAgICAgZWRpdG9yLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Bhc3RlJywgZWRpdG9yUGFzdGUpO1xuXG4gICAgICAgIGlmICh0eXBlb2Yob2JqLm9wdGlvbnMub25ibHVyKSA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBlZGl0b3IucmVtb3ZlRXZlbnRMaXN0ZW5lcignYmx1cicsIGVkaXRvckJsdXIpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2Yob2JqLm9wdGlvbnMub25mb2N1cykgPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgZWRpdG9yLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgZWRpdG9yRm9jdXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgZWwuZWRpdG9yID0gbnVsbDtcbiAgICAgICAgZWwuY2xhc3NMaXN0LnJlbW92ZSgnamVkaXRvci1jb250YWluZXInKTtcblxuICAgICAgICB0b29sYmFyLnJlbW92ZSgpO1xuICAgICAgICBzbmlwcGV0LnJlbW92ZSgpO1xuICAgICAgICBlZGl0b3IucmVtb3ZlKCk7XG4gICAgfVxuXG4gICAgdmFyIGlzTGV0dGVyID0gZnVuY3Rpb24gKHN0cikge1xuICAgICAgICB2YXIgcmVnZXggPSAvKFtcXHUwMDQxLVxcdTAwNUFcXHUwMDYxLVxcdTAwN0FcXHUwMEFBXFx1MDBCNVxcdTAwQkFcXHUwMEMwLVxcdTAwRDZcXHUwMEQ4LVxcdTAwRjZcXHUwMEY4LVxcdTAyQzFcXHUwMkM2LVxcdTAyRDFcXHUwMkUwLVxcdTAyRTRcXHUwMkVDXFx1MDJFRVxcdTAzNzAtXFx1MDM3NFxcdTAzNzZcXHUwMzc3XFx1MDM3QS1cXHUwMzdEXFx1MDM4NlxcdTAzODgtXFx1MDM4QVxcdTAzOENcXHUwMzhFLVxcdTAzQTFcXHUwM0EzLVxcdTAzRjVcXHUwM0Y3LVxcdTA0ODFcXHUwNDhBLVxcdTA1MjdcXHUwNTMxLVxcdTA1NTZcXHUwNTU5XFx1MDU2MS1cXHUwNTg3XFx1MDVEMC1cXHUwNUVBXFx1MDVGMC1cXHUwNUYyXFx1MDYyMC1cXHUwNjRBXFx1MDY2RVxcdTA2NkZcXHUwNjcxLVxcdTA2RDNcXHUwNkQ1XFx1MDZFNVxcdTA2RTZcXHUwNkVFXFx1MDZFRlxcdTA2RkEtXFx1MDZGQ1xcdTA2RkZcXHUwNzEwXFx1MDcxMi1cXHUwNzJGXFx1MDc0RC1cXHUwN0E1XFx1MDdCMVxcdTA3Q0EtXFx1MDdFQVxcdTA3RjRcXHUwN0Y1XFx1MDdGQVxcdTA4MDAtXFx1MDgxNVxcdTA4MUFcXHUwODI0XFx1MDgyOFxcdTA4NDAtXFx1MDg1OFxcdTA4QTBcXHUwOEEyLVxcdTA4QUNcXHUwOTA0LVxcdTA5MzlcXHUwOTNEXFx1MDk1MFxcdTA5NTgtXFx1MDk2MVxcdTA5NzEtXFx1MDk3N1xcdTA5NzktXFx1MDk3RlxcdTA5ODUtXFx1MDk4Q1xcdTA5OEZcXHUwOTkwXFx1MDk5My1cXHUwOUE4XFx1MDlBQS1cXHUwOUIwXFx1MDlCMlxcdTA5QjYtXFx1MDlCOVxcdTA5QkRcXHUwOUNFXFx1MDlEQ1xcdTA5RERcXHUwOURGLVxcdTA5RTFcXHUwOUYwXFx1MDlGMVxcdTBBMDUtXFx1MEEwQVxcdTBBMEZcXHUwQTEwXFx1MEExMy1cXHUwQTI4XFx1MEEyQS1cXHUwQTMwXFx1MEEzMlxcdTBBMzNcXHUwQTM1XFx1MEEzNlxcdTBBMzhcXHUwQTM5XFx1MEE1OS1cXHUwQTVDXFx1MEE1RVxcdTBBNzItXFx1MEE3NFxcdTBBODUtXFx1MEE4RFxcdTBBOEYtXFx1MEE5MVxcdTBBOTMtXFx1MEFBOFxcdTBBQUEtXFx1MEFCMFxcdTBBQjJcXHUwQUIzXFx1MEFCNS1cXHUwQUI5XFx1MEFCRFxcdTBBRDBcXHUwQUUwXFx1MEFFMVxcdTBCMDUtXFx1MEIwQ1xcdTBCMEZcXHUwQjEwXFx1MEIxMy1cXHUwQjI4XFx1MEIyQS1cXHUwQjMwXFx1MEIzMlxcdTBCMzNcXHUwQjM1LVxcdTBCMzlcXHUwQjNEXFx1MEI1Q1xcdTBCNURcXHUwQjVGLVxcdTBCNjFcXHUwQjcxXFx1MEI4M1xcdTBCODUtXFx1MEI4QVxcdTBCOEUtXFx1MEI5MFxcdTBCOTItXFx1MEI5NVxcdTBCOTlcXHUwQjlBXFx1MEI5Q1xcdTBCOUVcXHUwQjlGXFx1MEJBM1xcdTBCQTRcXHUwQkE4LVxcdTBCQUFcXHUwQkFFLVxcdTBCQjlcXHUwQkQwXFx1MEMwNS1cXHUwQzBDXFx1MEMwRS1cXHUwQzEwXFx1MEMxMi1cXHUwQzI4XFx1MEMyQS1cXHUwQzMzXFx1MEMzNS1cXHUwQzM5XFx1MEMzRFxcdTBDNThcXHUwQzU5XFx1MEM2MFxcdTBDNjFcXHUwQzg1LVxcdTBDOENcXHUwQzhFLVxcdTBDOTBcXHUwQzkyLVxcdTBDQThcXHUwQ0FBLVxcdTBDQjNcXHUwQ0I1LVxcdTBDQjlcXHUwQ0JEXFx1MENERVxcdTBDRTBcXHUwQ0UxXFx1MENGMVxcdTBDRjJcXHUwRDA1LVxcdTBEMENcXHUwRDBFLVxcdTBEMTBcXHUwRDEyLVxcdTBEM0FcXHUwRDNEXFx1MEQ0RVxcdTBENjBcXHUwRDYxXFx1MEQ3QS1cXHUwRDdGXFx1MEQ4NS1cXHUwRDk2XFx1MEQ5QS1cXHUwREIxXFx1MERCMy1cXHUwREJCXFx1MERCRFxcdTBEQzAtXFx1MERDNlxcdTBFMDEtXFx1MEUzMFxcdTBFMzJcXHUwRTMzXFx1MEU0MC1cXHUwRTQ2XFx1MEU4MVxcdTBFODJcXHUwRTg0XFx1MEU4N1xcdTBFODhcXHUwRThBXFx1MEU4RFxcdTBFOTQtXFx1MEU5N1xcdTBFOTktXFx1MEU5RlxcdTBFQTEtXFx1MEVBM1xcdTBFQTVcXHUwRUE3XFx1MEVBQVxcdTBFQUJcXHUwRUFELVxcdTBFQjBcXHUwRUIyXFx1MEVCM1xcdTBFQkRcXHUwRUMwLVxcdTBFQzRcXHUwRUM2XFx1MEVEQy1cXHUwRURGXFx1MEYwMFxcdTBGNDAtXFx1MEY0N1xcdTBGNDktXFx1MEY2Q1xcdTBGODgtXFx1MEY4Q1xcdTEwMDAtXFx1MTAyQVxcdTEwM0ZcXHUxMDUwLVxcdTEwNTVcXHUxMDVBLVxcdTEwNURcXHUxMDYxXFx1MTA2NVxcdTEwNjZcXHUxMDZFLVxcdTEwNzBcXHUxMDc1LVxcdTEwODFcXHUxMDhFXFx1MTBBMC1cXHUxMEM1XFx1MTBDN1xcdTEwQ0RcXHUxMEQwLVxcdTEwRkFcXHUxMEZDLVxcdTEyNDhcXHUxMjRBLVxcdTEyNERcXHUxMjUwLVxcdTEyNTZcXHUxMjU4XFx1MTI1QS1cXHUxMjVEXFx1MTI2MC1cXHUxMjg4XFx1MTI4QS1cXHUxMjhEXFx1MTI5MC1cXHUxMkIwXFx1MTJCMi1cXHUxMkI1XFx1MTJCOC1cXHUxMkJFXFx1MTJDMFxcdTEyQzItXFx1MTJDNVxcdTEyQzgtXFx1MTJENlxcdTEyRDgtXFx1MTMxMFxcdTEzMTItXFx1MTMxNVxcdTEzMTgtXFx1MTM1QVxcdTEzODAtXFx1MTM4RlxcdTEzQTAtXFx1MTNGNFxcdTE0MDEtXFx1MTY2Q1xcdTE2NkYtXFx1MTY3RlxcdTE2ODEtXFx1MTY5QVxcdTE2QTAtXFx1MTZFQVxcdTE3MDAtXFx1MTcwQ1xcdTE3MEUtXFx1MTcxMVxcdTE3MjAtXFx1MTczMVxcdTE3NDAtXFx1MTc1MVxcdTE3NjAtXFx1MTc2Q1xcdTE3NkUtXFx1MTc3MFxcdTE3ODAtXFx1MTdCM1xcdTE3RDdcXHUxN0RDXFx1MTgyMC1cXHUxODc3XFx1MTg4MC1cXHUxOEE4XFx1MThBQVxcdTE4QjAtXFx1MThGNVxcdTE5MDAtXFx1MTkxQ1xcdTE5NTAtXFx1MTk2RFxcdTE5NzAtXFx1MTk3NFxcdTE5ODAtXFx1MTlBQlxcdTE5QzEtXFx1MTlDN1xcdTFBMDAtXFx1MUExNlxcdTFBMjAtXFx1MUE1NFxcdTFBQTdcXHUxQjA1LVxcdTFCMzNcXHUxQjQ1LVxcdTFCNEJcXHUxQjgzLVxcdTFCQTBcXHUxQkFFXFx1MUJBRlxcdTFCQkEtXFx1MUJFNVxcdTFDMDAtXFx1MUMyM1xcdTFDNEQtXFx1MUM0RlxcdTFDNUEtXFx1MUM3RFxcdTFDRTktXFx1MUNFQ1xcdTFDRUUtXFx1MUNGMVxcdTFDRjVcXHUxQ0Y2XFx1MUQwMC1cXHUxREJGXFx1MUUwMC1cXHUxRjE1XFx1MUYxOC1cXHUxRjFEXFx1MUYyMC1cXHUxRjQ1XFx1MUY0OC1cXHUxRjREXFx1MUY1MC1cXHUxRjU3XFx1MUY1OVxcdTFGNUJcXHUxRjVEXFx1MUY1Ri1cXHUxRjdEXFx1MUY4MC1cXHUxRkI0XFx1MUZCNi1cXHUxRkJDXFx1MUZCRVxcdTFGQzItXFx1MUZDNFxcdTFGQzYtXFx1MUZDQ1xcdTFGRDAtXFx1MUZEM1xcdTFGRDYtXFx1MUZEQlxcdTFGRTAtXFx1MUZFQ1xcdTFGRjItXFx1MUZGNFxcdTFGRjYtXFx1MUZGQ1xcdTIwNzFcXHUyMDdGXFx1MjA5MC1cXHUyMDlDXFx1MjEwMlxcdTIxMDdcXHUyMTBBLVxcdTIxMTNcXHUyMTE1XFx1MjExOS1cXHUyMTFEXFx1MjEyNFxcdTIxMjZcXHUyMTI4XFx1MjEyQS1cXHUyMTJEXFx1MjEyRi1cXHUyMTM5XFx1MjEzQy1cXHUyMTNGXFx1MjE0NS1cXHUyMTQ5XFx1MjE0RVxcdTIxODNcXHUyMTg0XFx1MkMwMC1cXHUyQzJFXFx1MkMzMC1cXHUyQzVFXFx1MkM2MC1cXHUyQ0U0XFx1MkNFQi1cXHUyQ0VFXFx1MkNGMlxcdTJDRjNcXHUyRDAwLVxcdTJEMjVcXHUyRDI3XFx1MkQyRFxcdTJEMzAtXFx1MkQ2N1xcdTJENkZcXHUyRDgwLVxcdTJEOTZcXHUyREEwLVxcdTJEQTZcXHUyREE4LVxcdTJEQUVcXHUyREIwLVxcdTJEQjZcXHUyREI4LVxcdTJEQkVcXHUyREMwLVxcdTJEQzZcXHUyREM4LVxcdTJEQ0VcXHUyREQwLVxcdTJERDZcXHUyREQ4LVxcdTJEREVcXHUyRTJGXFx1MzAwNVxcdTMwMDZcXHUzMDMxLVxcdTMwMzVcXHUzMDNCXFx1MzAzQ1xcdTMwNDEtXFx1MzA5NlxcdTMwOUQtXFx1MzA5RlxcdTMwQTEtXFx1MzBGQVxcdTMwRkMtXFx1MzBGRlxcdTMxMDUtXFx1MzEyRFxcdTMxMzEtXFx1MzE4RVxcdTMxQTAtXFx1MzFCQVxcdTMxRjAtXFx1MzFGRlxcdTM0MDAtXFx1NERCNVxcdTRFMDAtXFx1OUZDQ1xcdUEwMDAtXFx1QTQ4Q1xcdUE0RDAtXFx1QTRGRFxcdUE1MDAtXFx1QTYwQ1xcdUE2MTAtXFx1QTYxRlxcdUE2MkFcXHVBNjJCXFx1QTY0MC1cXHVBNjZFXFx1QTY3Ri1cXHVBNjk3XFx1QTZBMC1cXHVBNkU1XFx1QTcxNy1cXHVBNzFGXFx1QTcyMi1cXHVBNzg4XFx1QTc4Qi1cXHVBNzhFXFx1QTc5MC1cXHVBNzkzXFx1QTdBMC1cXHVBN0FBXFx1QTdGOC1cXHVBODAxXFx1QTgwMy1cXHVBODA1XFx1QTgwNy1cXHVBODBBXFx1QTgwQy1cXHVBODIyXFx1QTg0MC1cXHVBODczXFx1QTg4Mi1cXHVBOEIzXFx1QThGMi1cXHVBOEY3XFx1QThGQlxcdUE5MEEtXFx1QTkyNVxcdUE5MzAtXFx1QTk0NlxcdUE5NjAtXFx1QTk3Q1xcdUE5ODQtXFx1QTlCMlxcdUE5Q0ZcXHVBQTAwLVxcdUFBMjhcXHVBQTQwLVxcdUFBNDJcXHVBQTQ0LVxcdUFBNEJcXHVBQTYwLVxcdUFBNzZcXHVBQTdBXFx1QUE4MC1cXHVBQUFGXFx1QUFCMVxcdUFBQjVcXHVBQUI2XFx1QUFCOS1cXHVBQUJEXFx1QUFDMFxcdUFBQzJcXHVBQURCLVxcdUFBRERcXHVBQUUwLVxcdUFBRUFcXHVBQUYyLVxcdUFBRjRcXHVBQjAxLVxcdUFCMDZcXHVBQjA5LVxcdUFCMEVcXHVBQjExLVxcdUFCMTZcXHVBQjIwLVxcdUFCMjZcXHVBQjI4LVxcdUFCMkVcXHVBQkMwLVxcdUFCRTJcXHVBQzAwLVxcdUQ3QTNcXHVEN0IwLVxcdUQ3QzZcXHVEN0NCLVxcdUQ3RkJcXHVGOTAwLVxcdUZBNkRcXHVGQTcwLVxcdUZBRDlcXHVGQjAwLVxcdUZCMDZcXHVGQjEzLVxcdUZCMTdcXHVGQjFEXFx1RkIxRi1cXHVGQjI4XFx1RkIyQS1cXHVGQjM2XFx1RkIzOC1cXHVGQjNDXFx1RkIzRVxcdUZCNDBcXHVGQjQxXFx1RkI0M1xcdUZCNDRcXHVGQjQ2LVxcdUZCQjFcXHVGQkQzLVxcdUZEM0RcXHVGRDUwLVxcdUZEOEZcXHVGRDkyLVxcdUZEQzdcXHVGREYwLVxcdUZERkJcXHVGRTcwLVxcdUZFNzRcXHVGRTc2LVxcdUZFRkNcXHVGRjIxLVxcdUZGM0FcXHVGRjQxLVxcdUZGNUFcXHVGRjY2LVxcdUZGQkVcXHVGRkMyLVxcdUZGQzdcXHVGRkNBLVxcdUZGQ0ZcXHVGRkQyLVxcdUZGRDdcXHVGRkRBLVxcdUZGRENdKykvZztcbiAgICAgICAgcmV0dXJuIHN0ci5tYXRjaChyZWdleCkgPyAxIDogMDtcbiAgICB9XG5cbiAgICAvLyBFdmVudCBoYW5kbGVyc1xuICAgIHZhciBlZGl0b3JNb3VzZVVwID0gZnVuY3Rpb24oZSkge1xuICAgICAgICBlZGl0b3JBY3Rpb24gPSBmYWxzZTtcbiAgICB9XG5cbiAgICB2YXIgZWRpdG9yTW91c2VEb3duID0gZnVuY3Rpb24oZSkge1xuICAgICAgICB2YXIgY2xvc2UgPSBmdW5jdGlvbihzbmlwcGV0KSB7XG4gICAgICAgICAgICB2YXIgcmVjdCA9IHNuaXBwZXQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICAgICAgICBpZiAocmVjdC53aWR0aCAtIChlLmNsaWVudFggLSByZWN0LmxlZnQpIDwgNDAgJiYgZS5jbGllbnRZIC0gcmVjdC50b3AgPCA0MCkge1xuICAgICAgICAgICAgICAgIHNuaXBwZXQuaW5uZXJIVE1MID0gJyc7XG4gICAgICAgICAgICAgICAgc25pcHBldC5yZW1vdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChlLnRhcmdldC50YWdOYW1lID09ICdJTUcnKSB7XG4gICAgICAgICAgICBpZiAoZS50YXJnZXQuc3R5bGUuY3Vyc29yKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJlY3QgPSBlLnRhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgICAgICAgICBlZGl0b3JBY3Rpb24gPSB7XG4gICAgICAgICAgICAgICAgICAgIGU6IGUudGFyZ2V0LFxuICAgICAgICAgICAgICAgICAgICB4OiBlLmNsaWVudFgsXG4gICAgICAgICAgICAgICAgICAgIHk6IGUuY2xpZW50WSxcbiAgICAgICAgICAgICAgICAgICAgdzogcmVjdC53aWR0aCxcbiAgICAgICAgICAgICAgICAgICAgaDogcmVjdC5oZWlnaHQsXG4gICAgICAgICAgICAgICAgICAgIGQ6IGUudGFyZ2V0LnN0eWxlLmN1cnNvcixcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoISBlLnRhcmdldC5zdHlsZS53aWR0aCkge1xuICAgICAgICAgICAgICAgICAgICBlLnRhcmdldC5zdHlsZS53aWR0aCA9IHJlY3Qud2lkdGggKyAncHgnO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICghIGUudGFyZ2V0LnN0eWxlLmhlaWdodCkge1xuICAgICAgICAgICAgICAgICAgICBlLnRhcmdldC5zdHlsZS5oZWlnaHQgPSByZWN0LmhlaWdodCArICdweCc7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHMgPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCk7XG4gICAgICAgICAgICAgICAgaWYgKHMucmFuZ2VDb3VudCkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHMucmFuZ2VDb3VudDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzLnJlbW92ZVJhbmdlKHMuZ2V0UmFuZ2VBdChpKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGVkaXRvckFjdGlvbiA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7IFxuICAgICAgICAgICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnc25pcHBldCcpKSB7XG4gICAgICAgICAgICAgICAgY2xvc2UoZS50YXJnZXQpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChlLnRhcmdldC5wYXJlbnROb2RlLmNsYXNzTGlzdC5jb250YWlucygnc25pcHBldCcpKSB7XG4gICAgICAgICAgICAgICAgY2xvc2UoZS50YXJnZXQucGFyZW50Tm9kZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGVkaXRvckFjdGlvbiA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgZWRpdG9yTW91c2VNb3ZlID0gZnVuY3Rpb24oZSkge1xuICAgICAgICBpZiAoZS50YXJnZXQudGFnTmFtZSA9PSAnSU1HJykge1xuICAgICAgICAgICAgaWYgKGUudGFyZ2V0LmdldEF0dHJpYnV0ZSgndGFiaW5kZXgnKSkge1xuICAgICAgICAgICAgICAgIHZhciByZWN0ID0gZS50YXJnZXQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICAgICAgICAgICAgaWYgKGUuY2xpZW50WSAtIHJlY3QudG9wIDwgNSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVjdC53aWR0aCAtIChlLmNsaWVudFggLSByZWN0LmxlZnQpIDwgNSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZS50YXJnZXQuc3R5bGUuY3Vyc29yID0gJ25lLXJlc2l6ZSc7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZS5jbGllbnRYIC0gcmVjdC5sZWZ0IDwgNSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZS50YXJnZXQuc3R5bGUuY3Vyc29yID0gJ253LXJlc2l6ZSc7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLnRhcmdldC5zdHlsZS5jdXJzb3IgPSAnbi1yZXNpemUnO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZWN0LmhlaWdodCAtIChlLmNsaWVudFkgLSByZWN0LnRvcCkgPCA1KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZWN0LndpZHRoIC0gKGUuY2xpZW50WCAtIHJlY3QubGVmdCkgPCA1KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLnRhcmdldC5zdHlsZS5jdXJzb3IgPSAnc2UtcmVzaXplJztcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlLmNsaWVudFggLSByZWN0LmxlZnQgPCA1KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLnRhcmdldC5zdHlsZS5jdXJzb3IgPSAnc3ctcmVzaXplJztcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGUudGFyZ2V0LnN0eWxlLmN1cnNvciA9ICdzLXJlc2l6ZSc7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlY3Qud2lkdGggLSAoZS5jbGllbnRYIC0gcmVjdC5sZWZ0KSA8IDUpIHtcbiAgICAgICAgICAgICAgICAgICAgZS50YXJnZXQuc3R5bGUuY3Vyc29yID0gJ2UtcmVzaXplJztcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGUuY2xpZW50WCAtIHJlY3QubGVmdCA8IDUpIHtcbiAgICAgICAgICAgICAgICAgICAgZS50YXJnZXQuc3R5bGUuY3Vyc29yID0gJ3ctcmVzaXplJztcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBlLnRhcmdldC5zdHlsZS5jdXJzb3IgPSAnJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBNb3ZlXG4gICAgICAgIGlmIChlLndoaWNoID09IDEgJiYgZWRpdG9yQWN0aW9uICYmIGVkaXRvckFjdGlvbi5kKSB7XG4gICAgICAgICAgICBpZiAoZWRpdG9yQWN0aW9uLmQgPT0gJ2UtcmVzaXplJyB8fCBlZGl0b3JBY3Rpb24uZCA9PSAnbmUtcmVzaXplJyB8fCAgZWRpdG9yQWN0aW9uLmQgPT0gJ3NlLXJlc2l6ZScpIHtcbiAgICAgICAgICAgICAgICBlZGl0b3JBY3Rpb24uZS5zdHlsZS53aWR0aCA9IChlZGl0b3JBY3Rpb24udyArIChlLmNsaWVudFggLSBlZGl0b3JBY3Rpb24ueCkpICsgJ3B4JztcblxuICAgICAgICAgICAgICAgIGlmIChlLnNoaWZ0S2V5KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBuZXdIZWlnaHQgPSAoZS5jbGllbnRYIC0gZWRpdG9yQWN0aW9uLngpICogKGVkaXRvckFjdGlvbi5oIC8gZWRpdG9yQWN0aW9uLncpO1xuICAgICAgICAgICAgICAgICAgICBlZGl0b3JBY3Rpb24uZS5zdHlsZS5oZWlnaHQgPSBlZGl0b3JBY3Rpb24uaCArIG5ld0hlaWdodCArICdweCc7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5ld0hlaWdodCA9ICBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCEgbmV3SGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgaWYgKGVkaXRvckFjdGlvbi5kID09ICdzLXJlc2l6ZScgfHwgZWRpdG9yQWN0aW9uLmQgPT0gJ3NlLXJlc2l6ZScgfHwgZWRpdG9yQWN0aW9uLmQgPT0gJ3N3LXJlc2l6ZScpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEgZS5zaGlmdEtleSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZWRpdG9yQWN0aW9uLmUuc3R5bGUuaGVpZ2h0ID0gZWRpdG9yQWN0aW9uLmggKyAoZS5jbGllbnRZIC0gZWRpdG9yQWN0aW9uLnkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgdmFyIGVkaXRvcktleVVwID0gZnVuY3Rpb24oZSkge1xuICAgICAgICBpZiAoISBlZGl0b3IuaW5uZXJIVE1MKSB7XG4gICAgICAgICAgICBlZGl0b3IuaW5uZXJIVE1MID0gJzxkaXY+PGJyPjwvZGl2Pic7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHlwZW9mKG9iai5vcHRpb25zLm9ua2V5dXApID09ICdmdW5jdGlvbicpIHsgXG4gICAgICAgICAgICBvYmoub3B0aW9ucy5vbmtleXVwKGUsIGVsKTtcbiAgICAgICAgfVxuICAgIH1cblxuXG4gICAgdmFyIGVkaXRvcktleURvd24gPSBmdW5jdGlvbihlKSB7XG4gICAgICAgIC8vIENoZWNrIGZvciBVUkxcbiAgICAgICAgaWYgKG9iai5vcHRpb25zLnBhcnNlVVJMID09IHRydWUpIHtcbiAgICAgICAgICAgIHZlcmlmeUVkaXRvcigpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2xvc2FibGVcbiAgICAgICAgaWYgKHR5cGVvZihvYmoub3B0aW9ucy5vbmVudGVyKSA9PSAnZnVuY3Rpb24nICYmIGUud2hpY2ggPT0gMTMpIHtcbiAgICAgICAgICAgIHZhciBkYXRhID0gb2JqLmdldERhdGEoKTtcbiAgICAgICAgICAgIG9iai5vcHRpb25zLm9uZW50ZXIob2JqLCBlbCwgZGF0YSwgZSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHlwZW9mKG9iai5vcHRpb25zLm9ua2V5ZG93bikgPT0gJ2Z1bmN0aW9uJykgeyBcbiAgICAgICAgICAgIG9iai5vcHRpb25zLm9ua2V5ZG93bihlLCBlbCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgZWRpdG9yUGFzdGUgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgIGlmIChlLmNsaXBib2FyZERhdGEgfHwgZS5vcmlnaW5hbEV2ZW50LmNsaXBib2FyZERhdGEpIHtcbiAgICAgICAgICAgIHZhciBodG1sID0gKGUub3JpZ2luYWxFdmVudCB8fCBlKS5jbGlwYm9hcmREYXRhLmdldERhdGEoJ3RleHQvaHRtbCcpO1xuICAgICAgICAgICAgdmFyIHRleHQgPSAoZS5vcmlnaW5hbEV2ZW50IHx8IGUpLmNsaXBib2FyZERhdGEuZ2V0RGF0YSgndGV4dC9wbGFpbicpO1xuICAgICAgICAgICAgdmFyIGZpbGUgPSAoZS5vcmlnaW5hbEV2ZW50IHx8IGUpLmNsaXBib2FyZERhdGEuZmlsZXNcbiAgICAgICAgfSBlbHNlIGlmICh3aW5kb3cuY2xpcGJvYXJkRGF0YSkge1xuICAgICAgICAgICAgdmFyIGh0bWwgPSB3aW5kb3cuY2xpcGJvYXJkRGF0YS5nZXREYXRhKCdIdG1sJyk7XG4gICAgICAgICAgICB2YXIgdGV4dCA9IHdpbmRvdy5jbGlwYm9hcmREYXRhLmdldERhdGEoJ1RleHQnKTtcbiAgICAgICAgICAgIHZhciBmaWxlID0gd2luZG93LmNsaXBib2FyZERhdGEuZmlsZXNcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChmaWxlLmxlbmd0aCkge1xuICAgICAgICAgICAgLy8gUGFzdGUgYSBpbWFnZSBmcm9tIHRoZSBjbGlwYm9hcmRcbiAgICAgICAgICAgIG9iai5hZGRGaWxlKGZpbGUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gUGFzdGUgdGV4dFxuICAgICAgICAgICAgdGV4dCA9IHRleHQuc3BsaXQoJ1xcclxcbicpO1xuICAgICAgICAgICAgdmFyIHN0ciA9ICcnO1xuICAgICAgICAgICAgaWYgKGUudGFyZ2V0Lm5vZGVOYW1lID09ICdESVYnICYmICEgZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqZWRpdG9yJykpIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRleHQubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRleHRbaV0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0ciArPSB0ZXh0W2ldICsgXCI8YnI+XFxyXFxuXCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGV4dC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGV4dFtpXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RyICs9ICc8ZGl2PicgKyB0ZXh0W2ldICsgJzwvZGl2Pic7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdHIgKz0gJzxkaXY+PGJyPjwvZGl2Pic7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBJbnNlcnQgdGV4dFxuICAgICAgICAgICAgZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2luc2VydEh0bWwnLCBmYWxzZSwgc3RyKTtcblxuICAgICAgICAgICAgLy8gRXh0cmEgaW1hZ2VzIGZyb20gdGhlIHBhc3RlXG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuYWNjZXB0SW1hZ2VzID09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBleHRyYWN0SW1hZ2VGcm9tSHRtbChodG1sKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG5cbiAgICB2YXIgZWRpdG9yRHJhZ1N0YXJ0ID0gZnVuY3Rpb24oZSkge1xuICAgICAgICBpZiAoZWRpdG9yQWN0aW9uICYmIGVkaXRvckFjdGlvbi5lKSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgZWRpdG9yRHJhZ0VudGVyID0gZnVuY3Rpb24oZSkge1xuICAgICAgICBpZiAoZWRpdG9yQWN0aW9uIHx8IG9iai5vcHRpb25zLmRyb3Bab25lID09IGZhbHNlKSB7XG4gICAgICAgICAgICAvLyBEbyBub3RoaW5nXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBlbC5jbGFzc0xpc3QuYWRkKCdqZWRpdG9yLWRyYWdnaW5nJyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgZWRpdG9yRHJhZ092ZXIgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgIGlmIChlZGl0b3JBY3Rpb24gfHwgb2JqLm9wdGlvbnMuZHJvcFpvbmUgPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIC8vIERvIG5vdGhpbmdcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChlZGl0b3JUaW1lcikge1xuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dChlZGl0b3JUaW1lcik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGVkaXRvclRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBlbC5jbGFzc0xpc3QucmVtb3ZlKCdqZWRpdG9yLWRyYWdnaW5nJyk7XG4gICAgICAgICAgICB9LCAxMDApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgdmFyIGVkaXRvckRyb3AgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgIGlmIChlZGl0b3JBY3Rpb24gfHwgb2JqLm9wdGlvbnMuZHJvcFpvbmUgPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIC8vIERvIG5vdGhpbmdcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIFBvc2l0aW9uIGNhcmV0IG9uIHRoZSBkcm9wXG4gICAgICAgICAgICB2YXIgcmFuZ2UgPSBudWxsO1xuICAgICAgICAgICAgaWYgKGRvY3VtZW50LmNhcmV0UmFuZ2VGcm9tUG9pbnQpIHtcbiAgICAgICAgICAgICAgICByYW5nZT1kb2N1bWVudC5jYXJldFJhbmdlRnJvbVBvaW50KGUuY2xpZW50WCwgZS5jbGllbnRZKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZS5yYW5nZVBhcmVudCkge1xuICAgICAgICAgICAgICAgIHJhbmdlPWRvY3VtZW50LmNyZWF0ZVJhbmdlKCk7XG4gICAgICAgICAgICAgICAgcmFuZ2Uuc2V0U3RhcnQoZS5yYW5nZVBhcmVudCxlLnJhbmdlT2Zmc2V0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBzZWwgPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCk7XG4gICAgICAgICAgICBzZWwucmVtb3ZlQWxsUmFuZ2VzKCk7XG4gICAgICAgICAgICBzZWwuYWRkUmFuZ2UocmFuZ2UpO1xuICAgICAgICAgICAgc2VsLmFuY2hvck5vZGUucGFyZW50Tm9kZS5mb2N1cygpO1xuXG4gICAgICAgICAgICB2YXIgaHRtbCA9IChlLm9yaWdpbmFsRXZlbnQgfHwgZSkuZGF0YVRyYW5zZmVyLmdldERhdGEoJ3RleHQvaHRtbCcpO1xuICAgICAgICAgICAgdmFyIHRleHQgPSAoZS5vcmlnaW5hbEV2ZW50IHx8IGUpLmRhdGFUcmFuc2Zlci5nZXREYXRhKCd0ZXh0L3BsYWluJyk7XG4gICAgICAgICAgICB2YXIgZmlsZSA9IChlLm9yaWdpbmFsRXZlbnQgfHwgZSkuZGF0YVRyYW5zZmVyLmZpbGVzO1xuICAgIFxuICAgICAgICAgICAgaWYgKGZpbGUubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgb2JqLmFkZEZpbGUoZmlsZSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRleHQpIHtcbiAgICAgICAgICAgICAgICBleHRyYWN0SW1hZ2VGcm9tSHRtbChodG1sKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWwuY2xhc3NMaXN0LnJlbW92ZSgnamVkaXRvci1kcmFnZ2luZycpO1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgdmFyIGVkaXRvckJsdXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgb2JqLm9wdGlvbnMub25ibHVyKG9iaiwgZWwsIG9iai5nZXREYXRhKCkpO1xuICAgIH1cblxuICAgIHZhciBlZGl0b3JGb2N1cyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBvYmoub3B0aW9ucy5vbmZvY3VzKG9iaiwgZWwsIG9iai5nZXREYXRhKCkpO1xuICAgIH1cblxuICAgIGVkaXRvci5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgZWRpdG9yTW91c2VVcCk7XG4gICAgZWRpdG9yLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIGVkaXRvck1vdXNlRG93bik7XG4gICAgZWRpdG9yLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIGVkaXRvck1vdXNlTW92ZSk7XG4gICAgZWRpdG9yLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgZWRpdG9yS2V5VXApO1xuICAgIGVkaXRvci5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgZWRpdG9yS2V5RG93bik7XG4gICAgZWRpdG9yLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdzdGFydCcsIGVkaXRvckRyYWdTdGFydCk7XG4gICAgZWRpdG9yLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdlbnRlcicsIGVkaXRvckRyYWdFbnRlcik7XG4gICAgZWRpdG9yLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdvdmVyJywgZWRpdG9yRHJhZ092ZXIpO1xuICAgIGVkaXRvci5hZGRFdmVudExpc3RlbmVyKCdkcm9wJywgZWRpdG9yRHJvcCk7XG4gICAgZWRpdG9yLmFkZEV2ZW50TGlzdGVuZXIoJ3Bhc3RlJywgZWRpdG9yUGFzdGUpO1xuXG4gICAgLy8gQmx1clxuICAgIGlmICh0eXBlb2Yob2JqLm9wdGlvbnMub25ibHVyKSA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIGVkaXRvci5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgZWRpdG9yQmx1cik7XG4gICAgfVxuXG4gICAgLy8gRm9jdXNcbiAgICBpZiAodHlwZW9mKG9iai5vcHRpb25zLm9uZm9jdXMpID09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgZWRpdG9yLmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgZWRpdG9yRm9jdXMpO1xuICAgIH1cblxuICAgIC8vIE9ubG9hZFxuICAgIGlmICh0eXBlb2Yob2JqLm9wdGlvbnMub25sb2FkKSA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIG9iai5vcHRpb25zLm9ubG9hZChlbCwgZWRpdG9yKTtcbiAgICB9XG5cbiAgICAvLyBTZXQgdmFsdWUgdG8gdGhlIGVkaXRvclxuICAgIGVkaXRvci5pbm5lckhUTUwgPSB2YWx1ZTtcblxuICAgIC8vIEFwcGVuZCBlZGl0b3IgdG8gdGhlIGNvbnRhaW5yZVxuICAgIGVsLmFwcGVuZENoaWxkKGVkaXRvcik7XG5cbiAgICAvLyBTbmlwcGV0XG4gICAgaWYgKG9iai5vcHRpb25zLnNuaXBwZXQpIHtcbiAgICAgICAgYXBwZW5kRWxlbWVudChvYmoub3B0aW9ucy5zbmlwcGV0KTtcbiAgICB9XG5cbiAgICAvLyBEZWZhdWx0IHRvb2xiYXJcbiAgICBpZiAob2JqLm9wdGlvbnMudG9vbGJhciA9PSBudWxsKSB7XG4gICAgICAgIG9iai5vcHRpb25zLnRvb2xiYXIgPSBqU3VpdGVzLmVkaXRvci5nZXREZWZhdWx0VG9vbGJhcigpO1xuICAgIH1cblxuICAgIC8vIEFkZCB0b29sYmFyXG4gICAgaWYgKG9iai5vcHRpb25zLnRvb2xiYXIpIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvYmoub3B0aW9ucy50b29sYmFyLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMudG9vbGJhcltpXS5pY29uKSB7XG4gICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgICAgICBpdGVtLnN0eWxlLnVzZXJTZWxlY3QgPSAnbm9uZSc7XG4gICAgICAgICAgICAgICAgdmFyIGl0ZW1JY29uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaScpO1xuICAgICAgICAgICAgICAgIGl0ZW1JY29uLmNsYXNzTmFtZSA9ICdtYXRlcmlhbC1pY29ucyc7XG4gICAgICAgICAgICAgICAgaXRlbUljb24uaW5uZXJIVE1MID0gb2JqLm9wdGlvbnMudG9vbGJhcltpXS5pY29uO1xuICAgICAgICAgICAgICAgIGl0ZW1JY29uLm9uY2xpY2sgPSAoZnVuY3Rpb24gKGEpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBhO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMudG9vbGJhcltiXS5vbmNsaWNrKGVsLCBvYmosIHRoaXMpXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfSkoaSk7XG4gICAgICAgICAgICAgICAgaXRlbS5hcHBlbmRDaGlsZChpdGVtSWNvbik7XG4gICAgICAgICAgICAgICAgdG9vbGJhci5hcHBlbmRDaGlsZChpdGVtKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLnRvb2xiYXJbaV0udHlwZSA9PSAnZGl2aXNvcicpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5jbGFzc05hbWUgPSAnamVkaXRvci10b29sYmFyLWRpdmlzb3InO1xuICAgICAgICAgICAgICAgICAgICB0b29sYmFyLmFwcGVuZENoaWxkKGl0ZW0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob2JqLm9wdGlvbnMudG9vbGJhcltpXS50eXBlID09ICdidXR0b24nKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uY2xhc3NMaXN0LmFkZCgnamVkaXRvci10b29sYmFyLWJ1dHRvbicpO1xuICAgICAgICAgICAgICAgICAgICBpdGVtLmlubmVySFRNTCA9IG9iai5vcHRpb25zLnRvb2xiYXJbaV0udmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIHRvb2xiYXIuYXBwZW5kQ2hpbGQoaXRlbSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZWwuYXBwZW5kQ2hpbGQodG9vbGJhcik7XG4gICAgfVxuXG4gICAgLy8gRm9jdXMgdG8gdGhlIGVkaXRvclxuICAgIGlmIChvYmoub3B0aW9ucy5mb2N1cykge1xuICAgICAgICBqU3VpdGVzLmVkaXRvci5zZXRDdXJzb3IoZWRpdG9yLCBvYmoub3B0aW9ucy5mb2N1cyA9PSAnaW5pdGlhbCcgPyB0cnVlIDogZmFsc2UpO1xuICAgIH1cblxuICAgIGVsLmVkaXRvciA9IG9iajtcblxuICAgIHJldHVybiBvYmo7XG59KTtcblxualN1aXRlcy5lZGl0b3Iuc2V0Q3Vyc29yID0gZnVuY3Rpb24oZWxlbWVudCwgZmlyc3QpIHtcbiAgICBlbGVtZW50LmZvY3VzKCk7XG4gICAgZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ3NlbGVjdEFsbCcpO1xuICAgIHZhciBzZWwgPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCk7XG4gICAgdmFyIHJhbmdlID0gc2VsLmdldFJhbmdlQXQoMCk7XG4gICAgaWYgKGZpcnN0ID09IHRydWUpIHtcbiAgICAgICAgdmFyIG5vZGUgPSByYW5nZS5zdGFydENvbnRhaW5lcjtcbiAgICAgICAgdmFyIHNpemUgPSAwO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBub2RlID0gcmFuZ2UuZW5kQ29udGFpbmVyO1xuICAgICAgICB2YXIgc2l6ZSA9IG5vZGUubGVuZ3RoO1xuICAgIH1cbiAgICByYW5nZS5zZXRTdGFydChub2RlLCBzaXplKTtcbiAgICByYW5nZS5zZXRFbmQobm9kZSwgc2l6ZSk7XG4gICAgc2VsLnJlbW92ZUFsbFJhbmdlcygpO1xuICAgIHNlbC5hZGRSYW5nZShyYW5nZSk7XG59XG5cbmpTdWl0ZXMuZWRpdG9yLmdldERvbWFpbiA9IGZ1bmN0aW9uKHVybCkge1xuICAgIHJldHVybiB1cmwucmVwbGFjZSgnaHR0cDovLycsJycpLnJlcGxhY2UoJ2h0dHBzOi8vJywnJykucmVwbGFjZSgnd3d3LicsJycpLnNwbGl0KC9bLz8jXS8pWzBdLnNwbGl0KC86L2cpWzBdO1xufVxuXG5qU3VpdGVzLmVkaXRvci5kZXRlY3RVcmwgPSBmdW5jdGlvbih0ZXh0KSB7XG4gICAgdmFyIGV4cHJlc3Npb24gPSAvKCgoaHR0cHM/OlxcL1xcLyl8KHd3d1xcLikpWy1BLVowLTkrJkAjXFwvJT89fl98ITosLjtdKlstQS1aMC05KyZAI1xcLyU9fl98XSspL2lnO1xuICAgIHZhciBsaW5rcyA9IHRleHQubWF0Y2goZXhwcmVzc2lvbik7XG5cbiAgICBpZiAobGlua3MpIHtcbiAgICAgICAgaWYgKGxpbmtzWzBdLnN1YnN0cigwLDMpID09ICd3d3cnKSB7XG4gICAgICAgICAgICBsaW5rc1swXSA9ICdodHRwOi8vJyArIGxpbmtzWzBdO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGxpbmtzO1xufVxuXG5qU3VpdGVzLmVkaXRvci55b3V0dWJlUGFyc2VyID0gZnVuY3Rpb24odXJsKSB7XG4gICAgdmFyIHJlZ0V4cCA9IC9eLiooKHlvdXR1LmJlXFwvKXwodlxcLyl8KFxcL3VcXC9cXHdcXC8pfChlbWJlZFxcLyl8KHdhdGNoXFw/KSlcXD8/dj89PyhbXiNcXCZcXD9dKikuKi87XG4gICAgdmFyIG1hdGNoID0gdXJsLm1hdGNoKHJlZ0V4cCk7XG5cbiAgICByZXR1cm4gKG1hdGNoICYmIG1hdGNoWzddLmxlbmd0aCA9PSAxMSkgPyBtYXRjaFs3XSA6IGZhbHNlO1xufVxuXG5qU3VpdGVzLmVkaXRvci5nZXREZWZhdWx0VG9vbGJhciA9IGZ1bmN0aW9uKCkgeyBcbiAgICByZXR1cm4gW1xuICAgICAgICB7XG4gICAgICAgICAgICBpY29uOid1bmRvJyxcbiAgICAgICAgICAgIG9uY2xpY2s6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGRvY3VtZW50LmV4ZWNDb21tYW5kKCd1bmRvJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGljb246J3JlZG8nLFxuICAgICAgICAgICAgb25jbGljazogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ3JlZG8nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgdHlwZTonZGl2aXNvcidcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWNvbjonZm9ybWF0X2JvbGQnLFxuICAgICAgICAgICAgb25jbGljazogZnVuY3Rpb24oYSxiLGMpIHtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5leGVjQ29tbWFuZCgnYm9sZCcpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGRvY3VtZW50LnF1ZXJ5Q29tbWFuZFN0YXRlKFwiYm9sZFwiKSkge1xuICAgICAgICAgICAgICAgICAgICBjLmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGVkJyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgYy5jbGFzc0xpc3QucmVtb3ZlKCdzZWxlY3RlZCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWNvbjonZm9ybWF0X2l0YWxpYycsXG4gICAgICAgICAgICBvbmNsaWNrOiBmdW5jdGlvbihhLGIsYykge1xuICAgICAgICAgICAgICAgIGRvY3VtZW50LmV4ZWNDb21tYW5kKCdpdGFsaWMnKTtcblxuICAgICAgICAgICAgICAgIGlmIChkb2N1bWVudC5xdWVyeUNvbW1hbmRTdGF0ZShcIml0YWxpY1wiKSkge1xuICAgICAgICAgICAgICAgICAgICBjLmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGVkJyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgYy5jbGFzc0xpc3QucmVtb3ZlKCdzZWxlY3RlZCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWNvbjonZm9ybWF0X3VuZGVybGluZScsXG4gICAgICAgICAgICBvbmNsaWNrOiBmdW5jdGlvbihhLGIsYykge1xuICAgICAgICAgICAgICAgIGRvY3VtZW50LmV4ZWNDb21tYW5kKCd1bmRlcmxpbmUnKTtcblxuICAgICAgICAgICAgICAgIGlmIChkb2N1bWVudC5xdWVyeUNvbW1hbmRTdGF0ZShcInVuZGVybGluZVwiKSkge1xuICAgICAgICAgICAgICAgICAgICBjLmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGVkJyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgYy5jbGFzc0xpc3QucmVtb3ZlKCdzZWxlY3RlZCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgdHlwZTonZGl2aXNvcidcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWNvbjonZm9ybWF0X2xpc3RfYnVsbGV0ZWQnLFxuICAgICAgICAgICAgb25jbGljazogZnVuY3Rpb24oYSxiLGMpIHtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5leGVjQ29tbWFuZCgnaW5zZXJ0VW5vcmRlcmVkTGlzdCcpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGRvY3VtZW50LnF1ZXJ5Q29tbWFuZFN0YXRlKFwiaW5zZXJ0VW5vcmRlcmVkTGlzdFwiKSkge1xuICAgICAgICAgICAgICAgICAgICBjLmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGVkJyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgYy5jbGFzc0xpc3QucmVtb3ZlKCdzZWxlY3RlZCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWNvbjonZm9ybWF0X2xpc3RfbnVtYmVyZWQnLFxuICAgICAgICAgICAgb25jbGljazogZnVuY3Rpb24oYSxiLGMpIHtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5leGVjQ29tbWFuZCgnaW5zZXJ0T3JkZXJlZExpc3QnKTtcblxuICAgICAgICAgICAgICAgIGlmIChkb2N1bWVudC5xdWVyeUNvbW1hbmRTdGF0ZShcImluc2VydE9yZGVyZWRMaXN0XCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGMuY2xhc3NMaXN0LmFkZCgnc2VsZWN0ZWQnKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjLmNsYXNzTGlzdC5yZW1vdmUoJ3NlbGVjdGVkJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpY29uOidmb3JtYXRfaW5kZW50X2luY3JlYXNlJyxcbiAgICAgICAgICAgIG9uY2xpY2s6IGZ1bmN0aW9uKGEsYixjKSB7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2luZGVudCcsIHRydWUsIG51bGwpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGRvY3VtZW50LnF1ZXJ5Q29tbWFuZFN0YXRlKFwiaW5kZW50XCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGMuY2xhc3NMaXN0LmFkZCgnc2VsZWN0ZWQnKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjLmNsYXNzTGlzdC5yZW1vdmUoJ3NlbGVjdGVkJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpY29uOidmb3JtYXRfaW5kZW50X2RlY3JlYXNlJyxcbiAgICAgICAgICAgIG9uY2xpY2s6IGZ1bmN0aW9uKGEsYixjKSB7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ291dGRlbnQnKTtcblxuICAgICAgICAgICAgICAgIGlmIChkb2N1bWVudC5xdWVyeUNvbW1hbmRTdGF0ZShcIm91dGRlbnRcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgYy5jbGFzc0xpc3QuYWRkKCdzZWxlY3RlZCcpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGMuY2xhc3NMaXN0LnJlbW92ZSgnc2VsZWN0ZWQnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLyp7XG4gICAgICAgICAgICB0eXBlOidzZWxlY3QnLFxuICAgICAgICAgICAgaXRlbXM6IFsnVmVyZGFuYScsJ0FyaWFsJywnQ291cmllciBOZXcnXSxcbiAgICAgICAgICAgIG9uY2hhbmdlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgdHlwZTonc2VsZWN0JyxcbiAgICAgICAgICAgIGl0ZW1zOiBbJzEwcHgnLCcxMnB4JywnMTRweCcsJzE2cHgnLCcxOHB4JywnMjBweCcsJzIycHgnXSxcbiAgICAgICAgICAgIG9uY2hhbmdlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWNvbjonZm9ybWF0X2FsaWduX2xlZnQnLFxuICAgICAgICAgICAgb25jbGljazogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ0p1c3RpZnlMZWZ0Jyk7XG5cbiAgICAgICAgICAgICAgICBpZiAoZG9jdW1lbnQucXVlcnlDb21tYW5kU3RhdGUoXCJKdXN0aWZ5TGVmdFwiKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGVkJyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QucmVtb3ZlKCdzZWxlY3RlZCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWNvbjonZm9ybWF0X2FsaWduX2NlbnRlcicsXG4gICAgICAgICAgICBvbmNsaWNrOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5leGVjQ29tbWFuZCgnanVzdGlmeUNlbnRlcicpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGRvY3VtZW50LnF1ZXJ5Q29tbWFuZFN0YXRlKFwianVzdGlmeUNlbnRlclwiKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGVkJyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QucmVtb3ZlKCdzZWxlY3RlZCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWNvbjonZm9ybWF0X2FsaWduX3JpZ2h0JyxcbiAgICAgICAgICAgIG9uY2xpY2s6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGRvY3VtZW50LmV4ZWNDb21tYW5kKCdqdXN0aWZ5UmlnaHQnKTtcblxuICAgICAgICAgICAgICAgIGlmIChkb2N1bWVudC5xdWVyeUNvbW1hbmRTdGF0ZShcImp1c3RpZnlSaWdodFwiKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGVkJyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QucmVtb3ZlKCdzZWxlY3RlZCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWNvbjonZm9ybWF0X2FsaWduX2p1c3RpZnknLFxuICAgICAgICAgICAgb25jbGljazogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2p1c3RpZnlGdWxsJyk7XG5cbiAgICAgICAgICAgICAgICBpZiAoZG9jdW1lbnQucXVlcnlDb21tYW5kU3RhdGUoXCJqdXN0aWZ5RnVsbFwiKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGVkJyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QucmVtb3ZlKCdzZWxlY3RlZCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWNvbjonZm9ybWF0X2xpc3RfYnVsbGV0ZWQnLFxuICAgICAgICAgICAgb25jbGljazogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2luc2VydFVub3JkZXJlZExpc3QnKTtcblxuICAgICAgICAgICAgICAgIGlmIChkb2N1bWVudC5xdWVyeUNvbW1hbmRTdGF0ZShcImluc2VydFVub3JkZXJlZExpc3RcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKCdzZWxlY3RlZCcpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LnJlbW92ZSgnc2VsZWN0ZWQnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0qL1xuICAgIF07XG59XG5cclxuXHJcbmpTdWl0ZXMuaW1hZ2UgPSAoZnVuY3Rpb24oZWwsIG9wdGlvbnMpIHtcclxuICAgIHZhciBvYmogPSB7fTtcclxuICAgIG9iai5vcHRpb25zID0ge307XHJcblxyXG4gICAgLy8gRGVmYXVsdCBjb25maWd1cmF0aW9uXHJcbiAgICB2YXIgZGVmYXVsdHMgPSB7XHJcbiAgICAgICAgbWluV2lkdGg6IGZhbHNlLFxyXG4gICAgICAgIG9uY2hhbmdlOiBudWxsLFxyXG4gICAgICAgIHNpbmdsZUZpbGU6IHRydWUsXHJcbiAgICAgICAgcmVtb3RlUGFyc2VyOiBudWxsLFxyXG4gICAgICAgIHRleHQ6e1xyXG4gICAgICAgICAgICBleHRlbnNpb25Ob3RBbGxvd2VkOidUaGUgZXh0ZW5zaW9uIGlzIG5vdCBhbGxvd2VkJyxcclxuICAgICAgICAgICAgaW1hZ2VUb29TbWFsbDonVGhlIHJlc29sdXRpb24gaXMgdG9vIGxvdywgdHJ5IGEgaW1hZ2Ugd2l0aCBhIGJldHRlciByZXNvbHV0aW9uLiB3aWR0aCA+IDgwMHB4JyxcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIExvb3AgdGhyb3VnaCBvdXIgb2JqZWN0XHJcbiAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBkZWZhdWx0cykge1xyXG4gICAgICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuaGFzT3duUHJvcGVydHkocHJvcGVydHkpKSB7XHJcbiAgICAgICAgICAgIG9iai5vcHRpb25zW3Byb3BlcnR5XSA9IG9wdGlvbnNbcHJvcGVydHldO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIG9iai5vcHRpb25zW3Byb3BlcnR5XSA9IGRlZmF1bHRzW3Byb3BlcnR5XTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVXBsb2FkIGljb25cclxuICAgIGVsLmNsYXNzTGlzdC5hZGQoJ2p1cGxvYWQnKTtcclxuXHJcbiAgICAvLyBBZGQgaW1hZ2VcclxuICAgIG9iai5hZGRJbWFnZSA9IGZ1bmN0aW9uKGZpbGUpIHtcclxuICAgICAgICBpZiAoISBmaWxlLmRhdGUpIHtcclxuICAgICAgICAgICAgZmlsZS5kYXRlID0gJyc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcclxuICAgICAgICBpbWcuc2V0QXR0cmlidXRlKCdkYXRhLWRhdGUnLCBmaWxlLmxhc3Rtb2RpZmllZCA/IGZpbGUubGFzdG1vZGlmaWVkIDogZmlsZS5kYXRlKTtcclxuICAgICAgICBpbWcuc2V0QXR0cmlidXRlKCdkYXRhLW5hbWUnLCBmaWxlLm5hbWUpO1xyXG4gICAgICAgIGltZy5zZXRBdHRyaWJ1dGUoJ2RhdGEtc2l6ZScsIGZpbGUuc2l6ZSk7XHJcbiAgICAgICAgaW1nLnNldEF0dHJpYnV0ZSgnZGF0YS1zbWFsbCcsIGZpbGUuc21hbGwgPyBmaWxlLnNtYWxsIDogJycpO1xyXG4gICAgICAgIGltZy5zZXRBdHRyaWJ1dGUoJ2RhdGEtY292ZXInLCBmaWxlLmNvdmVyID8gMSA6IDApO1xyXG4gICAgICAgIGltZy5zZXRBdHRyaWJ1dGUoJ2RhdGEtZXh0ZW5zaW9uJywgZmlsZS5leHRlbnNpb24pO1xyXG4gICAgICAgIGltZy5zZXRBdHRyaWJ1dGUoJ3NyYycsIGZpbGUuZmlsZSk7XHJcbiAgICAgICAgaW1nLmNsYXNzTmFtZSA9ICdqZmlsZSc7XHJcbiAgICAgICAgaW1nLnN0eWxlLndpZHRoID0gJzEwMCUnO1xyXG5cclxuICAgICAgICByZXR1cm4gaW1nO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEFkZCBpbWFnZVxyXG4gICAgb2JqLmFkZEltYWdlcyA9IGZ1bmN0aW9uKGZpbGVzKSB7XHJcbiAgICAgICAgaWYgKG9iai5vcHRpb25zLnNpbmdsZUZpbGUgPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICBlbC5pbm5lckhUTUwgPSAnJztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZmlsZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgZWwuYXBwZW5kQ2hpbGQob2JqLmFkZEltYWdlKGZpbGVzW2ldKSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9iai5hZGRGcm9tRmlsZSA9IGZ1bmN0aW9uKGZpbGUpIHtcclxuICAgICAgICB2YXIgdHlwZSA9IGZpbGUudHlwZS5zcGxpdCgnLycpO1xyXG4gICAgICAgIGlmICh0eXBlWzBdID09ICdpbWFnZScpIHtcclxuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLnNpbmdsZUZpbGUgPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgZWwuaW5uZXJIVE1MID0gJyc7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZhciBpbWFnZUZpbGUgPSBuZXcgRmlsZVJlYWRlcigpO1xyXG4gICAgICAgICAgICBpbWFnZUZpbGUuYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRcIiwgZnVuY3Rpb24gKHYpIHtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaW1nLm9ubG9hZCA9IGZ1bmN0aW9uIG9ubG9hZCgpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FudmFzLndpZHRoID0gaW1nLndpZHRoO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSBpbWcuaGVpZ2h0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShpbWcsIDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxlOiBjYW52YXMudG9EYXRhVVJMKCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4dGVuc2lvbjogZmlsZS5uYW1lLnN1YnN0cihmaWxlLm5hbWUubGFzdEluZGV4T2YoJy4nKSArIDEpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBmaWxlLm5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpemU6IGZpbGUuc2l6ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGFzdG1vZGlmaWVkOiBmaWxlLmxhc3RNb2RpZmllZCxcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5ld0ltYWdlID0gb2JqLmFkZEltYWdlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsLmFwcGVuZENoaWxkKG5ld0ltYWdlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gT25jaGFuZ2VcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mKG9iai5vcHRpb25zLm9uY2hhbmdlKSA9PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLm9uY2hhbmdlKG5ld0ltYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGltZy5zcmMgPSB2LnNyY0VsZW1lbnQucmVzdWx0O1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGltYWdlRmlsZS5yZWFkQXNEYXRhVVJMKGZpbGUpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGFsZXJ0KHRleHQuZXh0ZW50aW9uTm90QWxsb3dlZCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9iai5hZGRGcm9tVXJsID0gZnVuY3Rpb24oc3JjKSB7XHJcbiAgICAgICAgaWYgKHNyYy5zdWJzdHIoMCw0KSAhPSAnZGF0YScgJiYgISBvYmoub3B0aW9ucy5yZW1vdGVQYXJzZXIpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcigncmVtb3RlUGFyc2VyIG5vdCBkZWZpbmVkIGluIHlvdXIgaW5pdGlhbGl6YXRpb24nKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBUaGlzIGlzIHRvIHByb2Nlc3MgY3Jvc3MgZG9tYWluIGltYWdlc1xyXG4gICAgICAgICAgICBpZiAoc3JjLnN1YnN0cigwLDQpID09ICdkYXRhJykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGV4dGVuc2lvbiA9IHNyYy5zcGxpdCgnOycpXHJcbiAgICAgICAgICAgICAgICBleHRlbnNpb24gPSBleHRlbnNpb25bMF0uc3BsaXQoJy8nKTtcclxuICAgICAgICAgICAgICAgIGV4dGVuc2lvbiA9IGV4dGVuc2lvblsxXTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHZhciBleHRlbnNpb24gPSBzcmMuc3Vic3RyKHNyYy5sYXN0SW5kZXhPZignLicpICsgMSk7XHJcbiAgICAgICAgICAgICAgICAvLyBXb3JrIGZvciBjcm9zcyBicm93c2Vyc1xyXG4gICAgICAgICAgICAgICAgc3JjID0gb2JqLm9wdGlvbnMucmVtb3RlUGFyc2VyICsgc3JjO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7XHJcblxyXG4gICAgICAgICAgICBpbWcub25sb2FkID0gZnVuY3Rpb24gb25sb2FkKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xyXG4gICAgICAgICAgICAgICAgY2FudmFzLndpZHRoID0gaW1nLndpZHRoO1xyXG4gICAgICAgICAgICAgICAgY2FudmFzLmhlaWdodCA9IGltZy5oZWlnaHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xyXG4gICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShpbWcsIDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XHJcblxyXG4gICAgICAgICAgICAgICAgY2FudmFzLnRvQmxvYihmdW5jdGlvbihibG9iKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGU6IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBleHRlbnNpb246IGV4dGVuc2lvblxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB2YXIgbmV3SW1hZ2UgPSBvYmouYWRkSW1hZ2UoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZWwuYXBwZW5kQ2hpbGQobmV3SW1hZ2UpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBLZWVwIGJhc2U2NCByZWFkeSB0byBnb1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjb250ZW50ID0gY2FudmFzLnRvRGF0YVVSTCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGpTdWl0ZXMuZmlsZXNbZGF0YS5maWxlXSA9IGNvbnRlbnQuc3Vic3RyKGNvbnRlbnQuaW5kZXhPZignLCcpICsgMSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIE9uY2hhbmdlXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZihvYmoub3B0aW9ucy5vbmNoYW5nZSkgPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5vbmNoYW5nZShuZXdJbWFnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBpbWcuc3JjID0gc3JjO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB2YXIgYXR0YWNobWVudElucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcclxuICAgIGF0dGFjaG1lbnRJbnB1dC50eXBlID0gJ2ZpbGUnO1xyXG4gICAgYXR0YWNobWVudElucHV0LnNldEF0dHJpYnV0ZSgnYWNjZXB0JywgJ2ltYWdlLyonKTtcclxuICAgIGF0dGFjaG1lbnRJbnB1dC5vbmNoYW5nZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5maWxlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBvYmouYWRkRnJvbUZpbGUodGhpcy5maWxlc1tpXSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoXCJkYmxjbGlja1wiLCBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgalN1aXRlcy5jbGljayhhdHRhY2htZW50SW5wdXQpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ2VudGVyJywgZnVuY3Rpb24oZSkge1xyXG4gICAgICAgIGVsLnN0eWxlLmJvcmRlciA9ICcxcHggZGFzaGVkICMwMDAnO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ2xlYXZlJywgZnVuY3Rpb24oZSkge1xyXG4gICAgICAgIGVsLnN0eWxlLmJvcmRlciA9ICcxcHggc29saWQgI2VlZSc7XHJcbiAgICB9KTtcclxuXHJcbiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdkcmFnc3RvcCcsIGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICBlbC5zdHlsZS5ib3JkZXIgPSAnMXB4IHNvbGlkICNlZWUnO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ292ZXInLCBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignZHJvcCcsIGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7ICBcclxuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG5cclxuXHJcbiAgICAgICAgdmFyIGh0bWwgPSAoZS5vcmlnaW5hbEV2ZW50IHx8IGUpLmRhdGFUcmFuc2Zlci5nZXREYXRhKCd0ZXh0L2h0bWwnKTtcclxuICAgICAgICB2YXIgZmlsZSA9IChlLm9yaWdpbmFsRXZlbnQgfHwgZSkuZGF0YVRyYW5zZmVyLmZpbGVzO1xyXG5cclxuICAgICAgICBpZiAoZmlsZS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlLmRhdGFUcmFuc2Zlci5maWxlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgb2JqLmFkZEZyb21GaWxlKGUuZGF0YVRyYW5zZmVyLmZpbGVzW2ldKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSBpZiAoaHRtbCkge1xyXG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuc2luZ2xlRmlsZSA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICBlbC5pbm5lckhUTUwgPSAnJztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gQ3JlYXRlIHRlbXAgZWxlbWVudFxyXG4gICAgICAgICAgICB2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgIGRpdi5pbm5lckhUTUwgPSBodG1sO1xyXG5cclxuICAgICAgICAgICAgLy8gRXh0cmFjdCBpbWFnZXNcclxuICAgICAgICAgICAgdmFyIGltZyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKCdpbWcnKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChpbWcubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGltZy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5hZGRGcm9tVXJsKGltZ1tpXS5zcmMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBlbC5zdHlsZS5ib3JkZXIgPSAnMXB4IHNvbGlkICNlZWUnO1xyXG5cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9KTtcclxuXHJcbiAgICBlbC5pbWFnZSA9IG9iajtcclxuXHJcbiAgICByZXR1cm4gb2JqO1xyXG59KTtcclxuXHJcbi8qKlxuICogKGMpIGpMb2FkaW5nXG4gKiBodHRwczovL2dpdGh1Yi5jb20vcGF1bGhvZGVsL2p0b29sc1xuICpcbiAqIEBhdXRob3I6IFBhdWwgSG9kZWwgPHBhdWwuaG9kZWxAZ21haWwuY29tPlxuICogQGRlc2NyaXB0aW9uOiBQYWdlIGxvYWRpbmcgc3BpblxuICovXG5cbmpTdWl0ZXMubG9hZGluZyA9IChmdW5jdGlvbigpIHtcbiAgICB2YXIgb2JqID0ge307XG5cbiAgICB2YXIgbG9hZGluZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGxvYWRpbmcuY2xhc3NOYW1lID0gJ2psb2FkaW5nJztcblxuICAgIG9iai5zaG93ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobG9hZGluZyk7XG4gICAgfTtcblxuICAgIG9iai5oaWRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQobG9hZGluZyk7XG4gICAgfTtcblxuICAgIHJldHVybiBvYmo7XG59KSgpO1xyXG5cclxuLyoqXG4gKiAoYykgakxvZ2luXG4gKiBodHRwczovL2dpdGh1Yi5jb20vcGF1bGhvZGVsL2p0b29sc1xuICpcbiAqIEBhdXRob3I6IFBhdWwgSG9kZWwgPHBhdWwuaG9kZWxAZ21haWwuY29tPlxuICogQGRlc2NyaXB0aW9uOiBMb2dpbiBoZWxwZXJcbiAqL1xuXG5qU3VpdGVzLmxvZ2luID0gKGZ1bmN0aW9uKGVsLCBvcHRpb25zKSB7XG4gICAgdmFyIG9iaiA9IHt9O1xuICAgIG9iai5vcHRpb25zID0ge307XG5cbiAgICAvLyBEZWZhdWx0IGNvbmZpZ3VyYXRpb25cbiAgICB2YXIgZGVmYXVsdHMgPSB7XG4gICAgICAgIHVybDogd2luZG93LmxvY2F0aW9uLmhyZWYsXG4gICAgICAgIHByZXBhcmVSZXF1ZXN0OiBudWxsLFxuICAgICAgICBhY2Nlc3NUb2tlbjogbnVsbCxcbiAgICAgICAgZGV2aWNlVG9rZW46IG51bGwsXG4gICAgICAgIGZhY2Vib29rVXJsOiBudWxsLFxuICAgICAgICBmYWNlYm9va0F1dGhlbnRpY2F0aW9uOiBudWxsLFxuICAgICAgICBtYXhIZWlnaHQ6IG51bGwsXG4gICAgICAgIG9ubG9hZDogbnVsbCxcbiAgICAgICAgb25zdWNjZXNzOiBudWxsLFxuICAgICAgICBvbmVycm9yOiBudWxsLFxuICAgICAgICBtZXNzYWdlOiBudWxsLFxuICAgICAgICBsb2dvOiBudWxsLFxuICAgICAgICBuZXdQcm9maWxlOiBmYWxzZSxcbiAgICAgICAgbmV3UHJvZmlsZVVybDogZmFsc2UsXG4gICAgICAgIG5ld1Byb2ZpbGVMb2dpbjogZmFsc2UsXG4gICAgICAgIGZ1bGxzY3JlZW46IGZhbHNlLFxuICAgICAgICBuZXdQYXNzd29yZFZhbGlkYXRpb246IG51bGwsXG4gICAgfTtcblxuICAgIC8vIExvb3AgdGhyb3VnaCBvdXIgb2JqZWN0XG4gICAgZm9yICh2YXIgcHJvcGVydHkgaW4gZGVmYXVsdHMpIHtcbiAgICAgICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5oYXNPd25Qcm9wZXJ0eShwcm9wZXJ0eSkpIHtcbiAgICAgICAgICAgIG9iai5vcHRpb25zW3Byb3BlcnR5XSA9IG9wdGlvbnNbcHJvcGVydHldO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgb2JqLm9wdGlvbnNbcHJvcGVydHldID0gZGVmYXVsdHNbcHJvcGVydHldO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gTWVzc2FnZSBjb25zb2xlIGNvbnRhaW5lclxuICAgIGlmICghIG9iai5vcHRpb25zLm1lc3NhZ2UpIHtcbiAgICAgICAgdmFyIG1lc3NhZ2VFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1lc3NhZ2UnKTtcbiAgICAgICAgaWYgKG1lc3NhZ2VFbGVtZW50KSB7XG4gICAgICAgICAgICBvYmoub3B0aW9ucy5tZXNzYWdlID0gbWVzc2FnZUVsZW1lbnQ7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBBY3Rpb25cbiAgICB2YXIgYWN0aW9uID0gbnVsbDtcblxuICAgIC8vIENvbnRhaW5lclxuICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdmb3JtJyk7XG4gICAgZWwuYXBwZW5kQ2hpbGQoY29udGFpbmVyKTtcblxuICAgIC8vIExvZ29cbiAgICB2YXIgZGl2TG9nbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGRpdkxvZ28uY2xhc3NOYW1lID0gJ2psb2dpbi1sb2dvJ1xuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChkaXZMb2dvKTtcblxuICAgIGlmIChvYmoub3B0aW9ucy5sb2dvKSB7XG4gICAgICAgIHZhciBsb2dvID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XG4gICAgICAgIGxvZ28uc3JjID0gb2JqLm9wdGlvbnMubG9nbztcbiAgICAgICAgZGl2TG9nby5hcHBlbmRDaGlsZChsb2dvKTtcbiAgICB9XG5cbiAgICAvLyBDb2RlXG4gICAgdmFyIGxhYmVsQ29kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xhYmVsJyk7XG4gICAgbGFiZWxDb2RlLmlubmVySFRNTCA9ICdQbGVhc2UgZW50ZXIgaGVyZSB0aGUgY29kZSByZWNlaXZlZCc7XG4gICAgdmFyIGlucHV0Q29kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gICAgaW5wdXRDb2RlLnR5cGUgPSAnbnVtYmVyJztcbiAgICBpbnB1dENvZGUuaWQgPSAnY29kZSc7XG4gICAgaW5wdXRDb2RlLnNldEF0dHJpYnV0ZSgnbWF4bGVuZ3RoJywgNik7XG4gICAgdmFyIGRpdkNvZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBkaXZDb2RlLmFwcGVuZENoaWxkKGxhYmVsQ29kZSk7XG4gICAgZGl2Q29kZS5hcHBlbmRDaGlsZChpbnB1dENvZGUpO1xuXG4gICAgLy8gSGFzaFxuICAgIHZhciBpbnB1dEhhc2ggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xuICAgIGlucHV0SGFzaC50eXBlID0gJ2hpZGRlbic7XG4gICAgaW5wdXRIYXNoLm5hbWUgPSAnaCc7XG4gICAgdmFyIGRpdkhhc2ggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBkaXZIYXNoLmFwcGVuZENoaWxkKGlucHV0SGFzaCk7XG5cbiAgICAvLyBSZWNvdmVyeVxuICAgIHZhciBpbnB1dFJlY292ZXJ5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgICBpbnB1dFJlY292ZXJ5LnR5cGUgPSAnaGlkZGVuJztcbiAgICBpbnB1dFJlY292ZXJ5Lm5hbWUgPSAncmVjb3ZlcnknO1xuICAgIGlucHV0UmVjb3ZlcnkudmFsdWUgPSAnMSc7XG4gICAgdmFyIGRpdlJlY292ZXJ5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgZGl2UmVjb3ZlcnkuYXBwZW5kQ2hpbGQoaW5wdXRSZWNvdmVyeSk7XG5cbiAgICAvLyBMb2dpblxuICAgIHZhciBsYWJlbExvZ2luID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGFiZWwnKTtcbiAgICBsYWJlbExvZ2luLmlubmVySFRNTCA9ICdMb2dpbic7XG4gICAgdmFyIGlucHV0TG9naW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xuICAgIGlucHV0TG9naW4udHlwZSA9ICd0ZXh0JztcbiAgICBpbnB1dExvZ2luLm5hbWUgPSAnbG9naW4nO1xuICAgIGlucHV0TG9naW4uc2V0QXR0cmlidXRlKCdhdXRvY29tcGxldGUnLCAnb2ZmJyk7XG4gICAgaW5wdXRMb2dpbi5vbmtleXVwID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLnZhbHVlLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvW15hLXpBLVowLTlfK10rL2dpLCAnJyk7XG4gICAgfSBcbiAgICB2YXIgZGl2TG9naW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBkaXZMb2dpbi5hcHBlbmRDaGlsZChsYWJlbExvZ2luKTtcbiAgICBkaXZMb2dpbi5hcHBlbmRDaGlsZChpbnB1dExvZ2luKTtcblxuICAgIC8vIE5hbWVcbiAgICB2YXIgbGFiZWxOYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGFiZWwnKTtcbiAgICBsYWJlbE5hbWUuaW5uZXJIVE1MID0gJ05hbWUnO1xuICAgIHZhciBpbnB1dE5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xuICAgIGlucHV0TmFtZS50eXBlID0gJ3RleHQnO1xuICAgIGlucHV0TmFtZS5uYW1lID0gJ25hbWUnO1xuICAgIHZhciBkaXZOYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgZGl2TmFtZS5hcHBlbmRDaGlsZChsYWJlbE5hbWUpO1xuICAgIGRpdk5hbWUuYXBwZW5kQ2hpbGQoaW5wdXROYW1lKTtcblxuICAgIC8vIEVtYWlsXG4gICAgdmFyIGxhYmVsVXNlcm5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsYWJlbCcpO1xuICAgIGxhYmVsVXNlcm5hbWUuaW5uZXJIVE1MID0gJ0UtbWFpbCc7XG4gICAgdmFyIGlucHV0VXNlcm5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xuICAgIGlucHV0VXNlcm5hbWUudHlwZSA9ICd0ZXh0JztcbiAgICBpbnB1dFVzZXJuYW1lLm5hbWUgPSAndXNlcm5hbWUnO1xuICAgIGlucHV0VXNlcm5hbWUuc2V0QXR0cmlidXRlKCdhdXRvY29tcGxldGUnLCAnbmV3LXVzZXJuYW1lJyk7XG4gICAgdmFyIGRpdlVzZXJuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgZGl2VXNlcm5hbWUuYXBwZW5kQ2hpbGQobGFiZWxVc2VybmFtZSk7XG4gICAgZGl2VXNlcm5hbWUuYXBwZW5kQ2hpbGQoaW5wdXRVc2VybmFtZSk7XG5cbiAgICAvLyBQYXNzd29yZFxuICAgIHZhciBsYWJlbFBhc3N3b3JkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGFiZWwnKTtcbiAgICBsYWJlbFBhc3N3b3JkLmlubmVySFRNTCA9ICdOZXcgcGFzc3dvcmQnO1xuICAgIHZhciBpbnB1dFBhc3N3b3JkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgICBpbnB1dFBhc3N3b3JkLnR5cGUgPSAncGFzc3dvcmQnO1xuICAgIGlucHV0UGFzc3dvcmQubmFtZSA9ICdwYXNzd29yZCc7XG4gICAgaW5wdXRQYXNzd29yZC5zZXRBdHRyaWJ1dGUoJ2F1dG9jb21wbGV0ZScsICduZXctcGFzc3dvcmQnKTtcbiAgICB2YXIgZGl2UGFzc3dvcmQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBkaXZQYXNzd29yZC5hcHBlbmRDaGlsZChsYWJlbFBhc3N3b3JkKTtcbiAgICBkaXZQYXNzd29yZC5hcHBlbmRDaGlsZChpbnB1dFBhc3N3b3JkKTtcbiAgICBkaXZQYXNzd29yZC5vbmtleWRvd24gPSBmdW5jdGlvbihlKSB7XG4gICAgICAgIGlmIChlLmtleUNvZGUgPT0gMTMpIHtcbiAgICAgICAgICAgIG9iai5leGVjdXRlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBSZXBlYXQgcGFzc3dvcmRcbiAgICB2YXIgbGFiZWxSZXBlYXRQYXNzd29yZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xhYmVsJyk7XG4gICAgbGFiZWxSZXBlYXRQYXNzd29yZC5pbm5lckhUTUwgPSAnUmVwZWF0IHRoZSBuZXcgcGFzc3dvcmQnO1xuICAgIHZhciBpbnB1dFJlcGVhdFBhc3N3b3JkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgICBpbnB1dFJlcGVhdFBhc3N3b3JkLnR5cGUgPSAncGFzc3dvcmQnO1xuICAgIGlucHV0UmVwZWF0UGFzc3dvcmQubmFtZSA9ICdwYXNzd29yZCc7XG4gICAgdmFyIGRpdlJlcGVhdFBhc3N3b3JkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgZGl2UmVwZWF0UGFzc3dvcmQuYXBwZW5kQ2hpbGQobGFiZWxSZXBlYXRQYXNzd29yZCk7XG4gICAgZGl2UmVwZWF0UGFzc3dvcmQuYXBwZW5kQ2hpbGQoaW5wdXRSZXBlYXRQYXNzd29yZCk7XG5cbiAgICAvLyBSZW1lbWJlciBjaGVja2JveFxuICAgIHZhciBsYWJlbFJlbWVtYmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGFiZWwnKTtcbiAgICBsYWJlbFJlbWVtYmVyLmlubmVySFRNTCA9ICdSZW1lbWJlciBtZSBvbiB0aGlzIGRldmljZSc7XG4gICAgdmFyIGlucHV0UmVtZW1iZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xuICAgIGlucHV0UmVtZW1iZXIudHlwZSA9ICdjaGVja2JveCc7XG4gICAgaW5wdXRSZW1lbWJlci5uYW1lID0gJ3JlbWVtYmVyJztcbiAgICBpbnB1dFJlbWVtYmVyLnZhbHVlID0gJzEnO1xuICAgIGxhYmVsUmVtZW1iZXIuYXBwZW5kQ2hpbGQoaW5wdXRSZW1lbWJlcik7XG4gICAgdmFyIGRpdlJlbWVtYmVyQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgZGl2UmVtZW1iZXJCdXR0b24uY2xhc3NOYW1lID0gJ3JlbWVtYmVyQnV0dG9uJztcbiAgICBkaXZSZW1lbWJlckJ1dHRvbi5hcHBlbmRDaGlsZChsYWJlbFJlbWVtYmVyKTtcblxuICAgIC8vIExvZ2luIGJ1dHRvblxuICAgIHZhciBhY3Rpb25CdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xuICAgIGFjdGlvbkJ1dHRvbi50eXBlID0gJ2J1dHRvbic7XG4gICAgYWN0aW9uQnV0dG9uLnZhbHVlID0gJ0xvZyBJbic7XG4gICAgYWN0aW9uQnV0dG9uLm9uY2xpY2sgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgb2JqLmV4ZWN1dGUoKTtcbiAgICB9XG4gICAgdmFyIGRpdkFjdGlvbkJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGRpdkFjdGlvbkJ1dHRvbi5hcHBlbmRDaGlsZChhY3Rpb25CdXR0b24pO1xuXG4gICAgLy8gQ2FuY2VsIGJ1dHRvblxuICAgIHZhciBjYW5jZWxCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBjYW5jZWxCdXR0b24uaW5uZXJIVE1MID0gJ0NhbmNlbCc7XG4gICAgY2FuY2VsQnV0dG9uLmNsYXNzTmFtZSA9ICdjYW5jZWxCdXR0b24nO1xuICAgIGNhbmNlbEJ1dHRvbi5vbmNsaWNrID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIG9iai5yZXF1ZXN0QWNjZXNzKCk7XG4gICAgfVxuICAgIHZhciBkaXZDYW5jZWxCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBkaXZDYW5jZWxCdXR0b24uYXBwZW5kQ2hpbGQoY2FuY2VsQnV0dG9uKTtcblxuICAgIC8vIENhcHRjaGFcbiAgICB2YXIgbGFiZWxDYXB0Y2hhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGFiZWwnKTtcbiAgICBsYWJlbENhcHRjaGEuaW5uZXJIVE1MID0gJ1BsZWFzZSB0eXBlIGhlcmUgdGhlIGNvZGUgYmVsb3cnO1xuICAgIHZhciBpbnB1dENhcHRjaGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xuICAgIGlucHV0Q2FwdGNoYS50eXBlID0gJ3RleHQnO1xuICAgIGlucHV0Q2FwdGNoYS5uYW1lID0gJ2NhcHRjaGEnO1xuICAgIHZhciBpbWFnZUNhcHRjaGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcbiAgICB2YXIgZGl2Q2FwdGNoYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGRpdkNhcHRjaGEuY2xhc3NOYW1lID0gJ2psb2dpbi1jYXB0Y2hhJztcbiAgICBkaXZDYXB0Y2hhLmFwcGVuZENoaWxkKGxhYmVsQ2FwdGNoYSk7XG4gICAgZGl2Q2FwdGNoYS5hcHBlbmRDaGlsZChpbnB1dENhcHRjaGEpO1xuICAgIGRpdkNhcHRjaGEuYXBwZW5kQ2hpbGQoaW1hZ2VDYXB0Y2hhKTtcblxuICAgIC8vIEZhY2Vib29rXG4gICAgdmFyIGZhY2Vib29rQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgZmFjZWJvb2tCdXR0b24uaW5uZXJIVE1MID0gJ0xvZ2luIHdpdGggRmFjZWJvb2snO1xuICAgIGZhY2Vib29rQnV0dG9uLmNsYXNzTmFtZSA9ICdmYWNlYm9va0J1dHRvbic7XG4gICAgdmFyIGRpdkZhY2Vib29rQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgZGl2RmFjZWJvb2tCdXR0b24uYXBwZW5kQ2hpbGQoZmFjZWJvb2tCdXR0b24pO1xuICAgIGRpdkZhY2Vib29rQnV0dG9uLm9uY2xpY2sgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgb2JqLnJlcXVlc3RMb2dpblZpYUZhY2Vib29rKCk7XG4gICAgfVxuICAgIC8vIEZvcmdvdCBwYXNzd29yZFxuICAgIHZhciBpbnB1dFJlcXVlc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gICAgaW5wdXRSZXF1ZXN0LmlubmVySFRNTCA9ICdSZXF1ZXN0IGEgbmV3IHBhc3N3b3JkJztcbiAgICB2YXIgZGl2UmVxdWVzdEJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGRpdlJlcXVlc3RCdXR0b24uY2xhc3NOYW1lID0gJ3JlcXVlc3RCdXR0b24nO1xuICAgIGRpdlJlcXVlc3RCdXR0b24uYXBwZW5kQ2hpbGQoaW5wdXRSZXF1ZXN0KTtcbiAgICBkaXZSZXF1ZXN0QnV0dG9uLm9uY2xpY2sgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgb2JqLnJlcXVlc3ROZXdQYXNzd29yZCgpO1xuICAgIH1cbiAgICAvLyBDcmVhdGUgYSBuZXcgUHJvZmlsZVxuICAgIHZhciBpbnB1dE5ld1Byb2ZpbGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gICAgaW5wdXROZXdQcm9maWxlLmlubmVySFRNTCA9ICdDcmVhdGUgYSBuZXcgcHJvZmlsZSc7XG4gICAgdmFyIGRpdk5ld1Byb2ZpbGVCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBkaXZOZXdQcm9maWxlQnV0dG9uLmNsYXNzTmFtZSA9ICduZXdQcm9maWxlQnV0dG9uJztcbiAgICBkaXZOZXdQcm9maWxlQnV0dG9uLmFwcGVuZENoaWxkKGlucHV0TmV3UHJvZmlsZSk7XG4gICAgZGl2TmV3UHJvZmlsZUJ1dHRvbi5vbmNsaWNrID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIG9iai5uZXdQcm9maWxlKCk7XG4gICAgfVxuXG4gICAgZWwuY2xhc3NOYW1lID0gJ2psb2dpbic7XG5cbiAgICBpZiAob2JqLm9wdGlvbnMuZnVsbHNjcmVlbiA9PSB0cnVlKSB7XG4gICAgICAgIGVsLmNsYXNzTGlzdC5hZGQoJ2psb2dpbi1mdWxsc2NyZWVuJyk7XG4gICAgfVxuXG4gICAgLyoqIFxuICAgICAqIFNob3cgbWVzc2FnZVxuICAgICAqL1xuICAgIG9iai5zaG93TWVzc2FnZSA9IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgdmFyIG1lc3NhZ2UgPSAodHlwZW9mKGRhdGEpID09ICdvYmplY3QnKSA/IGRhdGEubWVzc2FnZSA6IGRhdGE7XG5cbiAgICAgICAgaWYgKHR5cGVvZihvYmoub3B0aW9ucy5zaG93TWVzc2FnZSkgPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgb2JqLm9wdGlvbnMuc2hvd01lc3NhZ2UoZGF0YSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBqU3VpdGVzLmFsZXJ0KGRhdGEpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTmV3IHByb2ZpbGVcbiAgICAgKi9cbiAgICBvYmoubmV3UHJvZmlsZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gJyc7XG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChkaXZMb2dvKTtcbiAgICAgICAgaWYgKG9iai5vcHRpb25zLm5ld1Byb2ZpbGVMb2dpbikge1xuICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGRpdkxvZ2luKTtcbiAgICAgICAgfVxuICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZGl2TmFtZSk7XG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChkaXZVc2VybmFtZSk7XG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChkaXZBY3Rpb25CdXR0b24pO1xuICAgICAgICBpZiAob2JqLm9wdGlvbnMuZmFjZWJvb2tBdXRoZW50aWNhdGlvbiA9PSB0cnVlKSB7XG4gICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZGl2RmFjZWJvb2tCdXR0b24pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChkaXZDYW5jZWxCdXR0b24pO1xuXG4gICAgICAgIC8vIFJlc2V0IGlucHV0c1xuICAgICAgICBpbnB1dExvZ2luLnZhbHVlID0gJyc7XG4gICAgICAgIGlucHV0VXNlcm5hbWUudmFsdWUgPSAnJztcbiAgICAgICAgaW5wdXRQYXNzd29yZC52YWx1ZSA9ICcnO1xuXG4gICAgICAgIC8vIEJ1dHRvblxuICAgICAgICBhY3Rpb25CdXR0b24udmFsdWUgPSAnQ3JlYXRlIG5ldyBwcm9maWxlJztcblxuICAgICAgICAvLyBBY3Rpb25cbiAgICAgICAgYWN0aW9uID0gJ25ld1Byb2ZpbGUnO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlcXVlc3QgdGhlIGVtYWlsIHdpdGggdGhlIHJlY292ZXJ5IGluc3RydWN0aW9uc1xuICAgICAqL1xuICAgIG9iai5yZXF1ZXN0TmV3UGFzc3dvcmQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKEFycmF5LnByb3RvdHlwZS5pbmRleE9mLmNhbGwoY29udGFpbmVyLmNoaWxkcmVuLCBkaXZDYXB0Y2hhKSA+PSAwKSB7XG4gICAgICAgICAgICB2YXIgY2FwdGNoYSA9IHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gJyc7XG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChkaXZMb2dvKTtcbiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGRpdlJlY292ZXJ5KTtcbiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGRpdlVzZXJuYW1lKTtcbiAgICAgICAgaWYgKGNhcHRjaGEpIHtcbiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChkaXZDYXB0Y2hhKTtcbiAgICAgICAgfVxuICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZGl2QWN0aW9uQnV0dG9uKTtcbiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGRpdkNhbmNlbEJ1dHRvbik7XG4gICAgICAgIGFjdGlvbkJ1dHRvbi52YWx1ZSA9ICdSZXF1ZXN0IGEgbmV3IHBhc3N3b3JkJztcbiAgICAgICAgaW5wdXRSZWNvdmVyeS52YWx1ZSA9IDE7XG5cbiAgICAgICAgLy8gQWN0aW9uXG4gICAgICAgIGFjdGlvbiA9ICdyZXF1ZXN0TmV3UGFzc3dvcmQnO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvbmZpcm0gcmVjb3ZlcnkgY29kZVxuICAgICAqL1xuICAgIG9iai5jb2RlQ29uZmlybWF0aW9uID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSAnJztcbiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGRpdkxvZ28pO1xuICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZGl2SGFzaCk7XG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChkaXZDb2RlKTtcbiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGRpdkFjdGlvbkJ1dHRvbik7XG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChkaXZDYW5jZWxCdXR0b24pO1xuICAgICAgICBhY3Rpb25CdXR0b24udmFsdWUgPSAnQ29uZmlybSBjb2RlJztcbiAgICAgICAgaW5wdXRSZWNvdmVyeS52YWx1ZSA9IDI7XG5cbiAgICAgICAgLy8gQWN0aW9uXG4gICAgICAgIGFjdGlvbiA9ICdjb2RlQ29uZmlybWF0aW9uJztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVcGRhdGUgbXkgcGFzc3dvcmRcbiAgICAgKi9cbiAgICBvYmouY2hhbmdlTXlQYXNzd29yZCA9IGZ1bmN0aW9uKGhhc2gpIHtcbiAgICAgICAgY29udGFpbmVyLmlubmVySFRNTCA9ICcnO1xuICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZGl2TG9nbyk7XG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChkaXZIYXNoKTtcbiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGRpdlBhc3N3b3JkKTtcbiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGRpdlJlcGVhdFBhc3N3b3JkKTtcbiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGRpdkFjdGlvbkJ1dHRvbik7XG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChkaXZDYW5jZWxCdXR0b24pO1xuICAgICAgICBhY3Rpb25CdXR0b24udmFsdWUgPSAnQ2hhbmdlIG15IHBhc3N3b3JkJztcbiAgICAgICAgaW5wdXRIYXNoLnZhbHVlID0gaGFzaDtcblxuICAgICAgICAvLyBBY3Rpb25cbiAgICAgICAgYWN0aW9uID0gJ2NoYW5nZU15UGFzc3dvcmQnO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlcXVlc3QgYWNjZXNzIGRlZmF1bHQgbWV0aG9kXG4gICAgICovXG4gICAgb2JqLnJlcXVlc3RBY2Nlc3MgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgY29udGFpbmVyLmlubmVySFRNTCA9ICcnO1xuICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZGl2TG9nbyk7XG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChkaXZVc2VybmFtZSk7XG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChkaXZQYXNzd29yZCk7XG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChkaXZBY3Rpb25CdXR0b24pO1xuICAgICAgICBpZiAob2JqLm9wdGlvbnMuZmFjZWJvb2tBdXRoZW50aWNhdGlvbiA9PSB0cnVlKSB7XG4gICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZGl2RmFjZWJvb2tCdXR0b24pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChkaXZSZXF1ZXN0QnV0dG9uKTtcbiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGRpdlJlbWVtYmVyQnV0dG9uKTtcbiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGRpdlJlcXVlc3RCdXR0b24pO1xuICAgICAgICBpZiAob2JqLm9wdGlvbnMubmV3UHJvZmlsZSA9PSB0cnVlKSB7XG4gICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZGl2TmV3UHJvZmlsZUJ1dHRvbik7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBCdXR0b25cbiAgICAgICAgYWN0aW9uQnV0dG9uLnZhbHVlID0gJ0xvZ2luJztcblxuICAgICAgICAvLyBQYXNzd29yZFxuICAgICAgICBpbnB1dFBhc3N3b3JkLnZhbHVlID0gJyc7XG5cbiAgICAgICAgLy8gRW1haWwgcGVyc2lzdGVuY2VcbiAgICAgICAgaWYgKHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndXNlcm5hbWUnKSkge1xuICAgICAgICAgICAgaW5wdXRVc2VybmFtZS52YWx1ZSA9IHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndXNlcm5hbWUnKTtcbiAgICAgICAgICAgIGlucHV0UGFzc3dvcmQuZm9jdXMoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlucHV0VXNlcm5hbWUuZm9jdXMoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEFjdGlvblxuICAgICAgICBhY3Rpb24gPSAncmVxdWVzdEFjY2Vzcyc7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVxdWVzdCBsb2dpbiB2aWEgZmFjZWJvb2tcbiAgICAgKi9cbiAgICBvYmoucmVxdWVzdExvZ2luVmlhRmFjZWJvb2sgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHR5cGVvZihkZXZpY2VOb3RpZmljYXRpb25Ub2tlbikgPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIEZCLmdldExvZ2luU3RhdHVzKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKCEgcmVzcG9uc2Uuc3RhdHVzIHx8IHJlc3BvbnNlLnN0YXR1cyAhPSAnY29ubmVjdGVkJykge1xuICAgICAgICAgICAgICAgICAgICBGQi5sb2dpbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmF1dGhSZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5leGVjdXRlKHsgZjpyZXNwb25zZS5hdXRoUmVzcG9uc2UuYWNjZXNzVG9rZW4gfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5zaG93TWVzc2FnZSgnTm90IGF1dGhvcml6ZWQgYnkgZmFjZWJvb2snKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSwge3Njb3BlOiAncHVibGljX3Byb2ZpbGUsZW1haWwnfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgb2JqLmV4ZWN1dGUoeyBmOnJlc3BvbnNlLmF1dGhSZXNwb25zZS5hY2Nlc3NUb2tlbiB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCB0cnVlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGpEZXN0cm95ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgZmJMb2dpbi5yZW1vdmVFdmVudExpc3RlbmVyKCdsb2Fkc3RhcnQnLCBqU3RhcnQpO1xuICAgICAgICAgICAgICAgIGZiTG9naW4ucmVtb3ZlRXZlbnRMaXN0ZW5lcignbG9hZGVycm9yJywgakVycm9yKTtcbiAgICAgICAgICAgICAgICBmYkxvZ2luLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2V4aXQnLCBqRXhpdCk7XG4gICAgICAgICAgICAgICAgZmJMb2dpbi5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIGZiTG9naW4gPSBudWxsO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBqU3RhcnQgPSBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICAgIHZhciB1cmwgPSBldmVudC51cmw7XG4gICAgICAgICAgICAgICAgaWYgKHVybC5pbmRleE9mKFwiYWNjZXNzX3Rva2VuXCIpID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHUgPSB1cmwubWF0Y2goLz0oLio/KSYvKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1WzFdLmxlbmd0aCA+IDMyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmV4ZWN1dGUoeyBmOnVbMV0gfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBqRGVzdHJveSgpO1xuICAgICAgICAgICAgICAgICAgIH0sNTAwKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAodXJsLmluZGV4T2YoXCJlcnJvcj1hY2Nlc3NfZGVuaWVkXCIpID49IDApIHtcbiAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGpEZXN0cm95ICw1MDApO1xuICAgICAgICAgICAgICAgICAgIC8vIE5vdCBhdXRob3JpemVkIGJ5IGZhY2Vib29rXG4gICAgICAgICAgICAgICAgICAgb2JqLnNob3dNZXNzYWdlKCdOb3QgYXV0aG9yaXplZCBieSBmYWNlYm9vaycpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgakVycm9yID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBqRGVzdHJveSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgICAgIGpFeGl0ID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBqRGVzdHJveSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmYkxvZ2luID0gd2luZG93Lm9wZW4ob2JqLm9wdGlvbnMuZmFjZWJvb2tVcmwsIFwiX2JsYW5rXCIsIFwibG9jYXRpb249bm8sY2xvc2VidXR0b25jYXB0aW9uPUV4aXQsZGlzYWxsb3dvdmVyc2Nyb2xsPXllcyx0b29sYmFyPW5vXCIpO1xuICAgICAgICAgICAgZmJMb2dpbi5hZGRFdmVudExpc3RlbmVyKCdsb2Fkc3RhcnQnLCBqU3RhcnQpO1xuICAgICAgICAgICAgZmJMb2dpbi5hZGRFdmVudExpc3RlbmVyKCdsb2FkZXJyb3InLCBqRXJyb3IpO1xuICAgICAgICAgICAgZmJMb2dpbi5hZGRFdmVudExpc3RlbmVyKCdleGl0JywgakV4aXQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQWN0aW9uXG4gICAgICAgIGFjdGlvbiA9ICdyZXF1ZXN0TG9naW5WaWFGYWNlYm9vayc7XG4gICAgfVxuXG4gICAgLy8gUGVyZm9ybSByZXF1ZXN0XG4gICAgb2JqLmV4ZWN1dGUgPSBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgIC8vIE5ldyBwcm9maWxlXG4gICAgICAgIGlmIChhY3Rpb24gPT0gJ25ld1Byb2ZpbGUnKSB7XG4gICAgICAgICAgICB2YXIgcGF0dGVybiA9IG5ldyBSZWdFeHAoL14oW1xcdy1cXC5dK0AoW1xcdy1dK1xcLikrW1xcdy1dezIsNH0pPyQvKTtcbiAgICAgICAgICAgIGlmICghIGlucHV0VXNlcm5hbWUudmFsdWUgfHwgISBwYXR0ZXJuLnRlc3QoaW5wdXRVc2VybmFtZS52YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZSA9ICdJbnZhbGlkIGUtbWFpbCBhZGRyZXNzJzsgXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBwYXR0ZXJuID0gbmV3IFJlZ0V4cCgvXlthLXpBLVowLTlcXF9cXC1cXC5cXHMrXSskLyk7XG4gICAgICAgICAgICBpZiAoISBpbnB1dExvZ2luLnZhbHVlIHx8ICEgcGF0dGVybi50ZXN0KGlucHV0TG9naW4udmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSAnSW52YWxpZCB1c2VybmFtZSwgcGxlYXNlIHVzZSBvbmx5IGNoYXJhY3RlcnMgYW5kIG51bWJlcnMnO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAobWVzc2FnZSkge1xuICAgICAgICAgICAgICAgIG9iai5zaG93TWVzc2FnZShtZXNzYWdlKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoYWN0aW9uID09ICdjaGFuZ2VNeVBhc3N3b3JkJykge1xyXG4gICAgICAgICAgICBpZiAoaW5wdXRQYXNzd29yZC52YWx1ZS5sZW5ndGggPCAzKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZSA9ICdQYXNzd29yZCBpcyB0b28gc2hvcnQnO1xyXG4gICAgICAgICAgICB9IGVsc2UgIGlmIChpbnB1dFBhc3N3b3JkLnZhbHVlICE9IGlucHV0UmVwZWF0UGFzc3dvcmQudmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlID0gJ1Bhc3N3b3JkIHNob3VsZCBtYXRjaCc7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mKG9iai5vcHRpb25zLm5ld1Bhc3N3b3JkVmFsaWRhdGlvbikgPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWwgPSBvYmoub3B0aW9ucy5uZXdQYXNzd29yZFZhbGlkYXRpb24ob2JqLCBpbnB1dFBhc3N3b3JkLnZhbHVlLCBpbnB1dFBhc3N3b3JkLnZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodmFsICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlID0gdmFsO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAobWVzc2FnZSkge1xyXG4gICAgICAgICAgICAgICAgb2JqLnNob3dNZXNzYWdlKG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEtlZXAgZW1haWxcbiAgICAgICAgaWYgKGlucHV0VXNlcm5hbWUudmFsdWUgIT0gJycpIHtcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbSgndXNlcm5hbWUnLCBpbnB1dFVzZXJuYW1lLnZhbHVlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENhcHRjaGFcbiAgICAgICAgaWYgKEFycmF5LnByb3RvdHlwZS5pbmRleE9mLmNhbGwoY29udGFpbmVyLmNoaWxkcmVuLCBkaXZDYXB0Y2hhKSA+PSAwKSB7XG4gICAgICAgICAgICBpZiAoaW5wdXRDYXB0Y2hhLnZhbHVlID09ICcnKSB7XG4gICAgICAgICAgICAgICAgb2JqLnNob3dNZXNzYWdlKCdQbGVhc2UgZW50ZXIgdGhlIGNhcHRjaCBjb2RlIGJlbG93Jyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gVXJsXG4gICAgICAgIHZhciB1cmwgPSBvYmoub3B0aW9ucy51cmw7XG5cbiAgICAgICAgLy8gRGV2aWNlIHRva2VuXG4gICAgICAgIGlmIChvYmoub3B0aW9ucy5kZXZpY2VUb2tlbikge1xuICAgICAgICAgICAgdXJsICs9ICc/dG9rZW49JyArIG9iai5vcHRpb25zLmRldmljZVRva2VuO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2FsbGJhY2tcbiAgICAgICAgdmFyIG9uc3VjY2VzcyA9IGZ1bmN0aW9uKHJlc3VsdCkge1xuICAgICAgICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgIC8vIFN1Y2Nlc3NmdWxseSByZXNwb25zZVxuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuc3VjY2VzcyA9PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFJlY292ZXJ5IHByb2Nlc3NcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGlvbiA9PSAncmVxdWVzdE5ld1Bhc3N3b3JkJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmNvZGVDb25maXJtYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhY3Rpb24gPT0gJ2NvZGVDb25maXJtYXRpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVxdWVzdEFjY2VzcygpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbiA9PSAnbmV3UHJvZmlsZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5yZXF1ZXN0QWNjZXNzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBOZXcgcHJvZmlsZVxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0Lm5ld1Byb2ZpbGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gVG9rZW5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC50b2tlbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRva2VuXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5hY2Nlc3NUb2tlbiA9IHJlc3VsdC50b2tlbjtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNhdmUgdG9rZW5cbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnQWNjZXNzLVRva2VuJywgcmVzdWx0LnRva2VuKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIFNob3cgbWVzc2FnZVxuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQubWVzc2FnZSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBTaG93IG1lc3NhZ2VcbiAgICAgICAgICAgICAgICAgICAgb2JqLnNob3dNZXNzYWdlKHJlc3VsdC5tZXNzYWdlKVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIFJlcXVlc3QgY2FwdGNoYSBjb2RlXG4gICAgICAgICAgICAgICAgaWYgKCEgcmVzdWx0LmRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKEFycmF5LnByb3RvdHlwZS5pbmRleE9mLmNhbGwoY29udGFpbmVyLmNoaWxkcmVuLCBkaXZDYXB0Y2hhKSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXZDYXB0Y2hhLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmluc2VydEJlZm9yZShkaXZDYXB0Y2hhLCBkaXZBY3Rpb25CdXR0b24pO1xuICAgICAgICAgICAgICAgICAgICBpbWFnZUNhcHRjaGEuc2V0QXR0cmlidXRlKCdzcmMnLCAnZGF0YTppbWFnZS9wbmc7YmFzZTY0LCcgKyByZXN1bHQuZGF0YSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gR2l2ZSB0aW1lIHRvIHVzZXIgc2VlIHRoZSBtZXNzYWdlXG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5oYXNoKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIENoYW5nZSBwYXNzd29yZFxuICAgICAgICAgICAgICAgICAgICBvYmouY2hhbmdlTXlQYXNzd29yZChyZXN1bHQuaGFzaCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXN1bHQudXJsKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEFwcCBpbml0aWFsaXphdGlvblxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MgPT0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZihvYmoub3B0aW9ucy5vbnN1Y2Nlc3MpID09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5vbnN1Y2Nlc3MocmVzdWx0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5tZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7IHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gcmVzdWx0LnVybDsgfSwgMjAwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSByZXN1bHQudXJsO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2Yob2JqLm9wdGlvbnMub25lcnJvcikgPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLm9uZXJyb3IocmVzdWx0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFBhc3N3b3JkXG4gICAgICAgIGlmICghIGRhdGEpIHtcbiAgICAgICAgICAgIHZhciBkYXRhID0galN1aXRlcy5nZXRGb3JtRWxlbWVudHMoZWwpO1xuICAgICAgICAgICAgLy8gRW5jb2RlIHBhc3N3b3JmZFxuICAgICAgICAgICAgaWYgKGRhdGEucGFzc3dvcmQpIHtcbiAgICAgICAgICAgICAgICBkYXRhLnBhc3N3b3JkID0galN1aXRlcy5sb2dpbi5zaGE1MTIoZGF0YS5wYXNzd29yZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBSZWNvdmVyeSBjb2RlXG4gICAgICAgICAgICBpZiAoQXJyYXkucHJvdG90eXBlLmluZGV4T2YuY2FsbChjb250YWluZXIuY2hpbGRyZW4sIGRpdkNvZGUpID49IDAgJiYgaW5wdXRDb2RlLnZhbHVlKSB7XG4gICAgICAgICAgICAgICAgZGF0YS5oID0galN1aXRlcy5sb2dpbi5zaGE1MTIoaW5wdXRDb2RlLnZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIExvYWRpbmdcbiAgICAgICAgZWwuY2xhc3NMaXN0LmFkZCgnamxvZ2luLWxvYWRpbmcnKTtcblxuICAgICAgICAvLyBVcmxcbiAgICAgICAgdmFyIHVybCA9IChhY3Rpb24gPT0gJ25ld1Byb2ZpbGUnICYmIG9iai5vcHRpb25zLm5ld1Byb2ZpbGVVcmwpID8gb2JqLm9wdGlvbnMubmV3UHJvZmlsZVVybCA6IG9iai5vcHRpb25zLnVybDtcblxuICAgICAgICAvLyBSZW1vdGUgY2FsbFxuICAgICAgICBqU3VpdGVzLmFqYXgoe1xuICAgICAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgICAgICBkYXRhOiBkYXRhLFxuICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgLy8gUmVtb3ZlIGxvYWRpbmdcbiAgICAgICAgICAgICAgICBlbC5jbGFzc0xpc3QucmVtb3ZlKCdqbG9naW4tbG9hZGluZycpO1xuICAgICAgICAgICAgICAgIC8vIENhbGxiYWNrXG4gICAgICAgICAgICAgICAgb25zdWNjZXNzKHJlc3VsdCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgIC8vIEVycm9yXG4gICAgICAgICAgICAgICAgZWwuY2xhc3NMaXN0LnJlbW92ZSgnamxvZ2luLWxvYWRpbmcnKTtcblxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2Yob2JqLm9wdGlvbnMub25lcnJvcikgPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5vbmVycm9yKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICB2YXIgcXVlcnlTdHJpbmcgPSB3aW5kb3cubG9jYXRpb24uaHJlZi5zcGxpdCgnPycpO1xyXG4gICAgaWYgKHF1ZXJ5U3RyaW5nWzFdICYmIHF1ZXJ5U3RyaW5nWzFdLmxlbmd0aCA9PSAxMzAgJiYgcXVlcnlTdHJpbmdbMV0uc3Vic3RyKDAsMikgPT0gJ2g9Jykge1xyXG4gICAgICAgIG9iai5jaGFuZ2VNeVBhc3N3b3JkKHF1ZXJ5U3RyaW5nWzFdLnN1YnN0cigyKSk7XHJcbiAgICB9IGVsc2Uge1xuICAgICAgICBvYmoucmVxdWVzdEFjY2VzcygpO1xuICAgIH1cblxuICAgIHJldHVybiBvYmo7XG59KTtcblxualN1aXRlcy5sb2dpbi5zaGE1MTIgPSAoZnVuY3Rpb24oc3RyKSB7XG4gICAgZnVuY3Rpb24gaW50NjQobXNpbnRfMzIsIGxzaW50XzMyKSB7XG4gICAgICAgIHRoaXMuaGlnaE9yZGVyID0gbXNpbnRfMzI7XG4gICAgICAgIHRoaXMubG93T3JkZXIgPSBsc2ludF8zMjtcbiAgICB9XG5cbiAgICB2YXIgSCA9IFtuZXcgaW50NjQoMHg2YTA5ZTY2NywgMHhmM2JjYzkwOCksIG5ldyBpbnQ2NCgweGJiNjdhZTg1LCAweDg0Y2FhNzNiKSxcbiAgICAgICAgbmV3IGludDY0KDB4M2M2ZWYzNzIsIDB4ZmU5NGY4MmIpLCBuZXcgaW50NjQoMHhhNTRmZjUzYSwgMHg1ZjFkMzZmMSksXG4gICAgICAgIG5ldyBpbnQ2NCgweDUxMGU1MjdmLCAweGFkZTY4MmQxKSwgbmV3IGludDY0KDB4OWIwNTY4OGMsIDB4MmIzZTZjMWYpLFxuICAgICAgICBuZXcgaW50NjQoMHgxZjgzZDlhYiwgMHhmYjQxYmQ2YiksIG5ldyBpbnQ2NCgweDViZTBjZDE5LCAweDEzN2UyMTc5KV07XG5cbiAgICB2YXIgSyA9IFtuZXcgaW50NjQoMHg0MjhhMmY5OCwgMHhkNzI4YWUyMiksIG5ldyBpbnQ2NCgweDcxMzc0NDkxLCAweDIzZWY2NWNkKSxcbiAgICAgICAgbmV3IGludDY0KDB4YjVjMGZiY2YsIDB4ZWM0ZDNiMmYpLCBuZXcgaW50NjQoMHhlOWI1ZGJhNSwgMHg4MTg5ZGJiYyksXG4gICAgICAgIG5ldyBpbnQ2NCgweDM5NTZjMjViLCAweGYzNDhiNTM4KSwgbmV3IGludDY0KDB4NTlmMTExZjEsIDB4YjYwNWQwMTkpLFxuICAgICAgICBuZXcgaW50NjQoMHg5MjNmODJhNCwgMHhhZjE5NGY5YiksIG5ldyBpbnQ2NCgweGFiMWM1ZWQ1LCAweGRhNmQ4MTE4KSxcbiAgICAgICAgbmV3IGludDY0KDB4ZDgwN2FhOTgsIDB4YTMwMzAyNDIpLCBuZXcgaW50NjQoMHgxMjgzNWIwMSwgMHg0NTcwNmZiZSksXG4gICAgICAgIG5ldyBpbnQ2NCgweDI0MzE4NWJlLCAweDRlZTRiMjhjKSwgbmV3IGludDY0KDB4NTUwYzdkYzMsIDB4ZDVmZmI0ZTIpLFxuICAgICAgICBuZXcgaW50NjQoMHg3MmJlNWQ3NCwgMHhmMjdiODk2ZiksIG5ldyBpbnQ2NCgweDgwZGViMWZlLCAweDNiMTY5NmIxKSxcbiAgICAgICAgbmV3IGludDY0KDB4OWJkYzA2YTcsIDB4MjVjNzEyMzUpLCBuZXcgaW50NjQoMHhjMTliZjE3NCwgMHhjZjY5MjY5NCksXG4gICAgICAgIG5ldyBpbnQ2NCgweGU0OWI2OWMxLCAweDllZjE0YWQyKSwgbmV3IGludDY0KDB4ZWZiZTQ3ODYsIDB4Mzg0ZjI1ZTMpLFxuICAgICAgICBuZXcgaW50NjQoMHgwZmMxOWRjNiwgMHg4YjhjZDViNSksIG5ldyBpbnQ2NCgweDI0MGNhMWNjLCAweDc3YWM5YzY1KSxcbiAgICAgICAgbmV3IGludDY0KDB4MmRlOTJjNmYsIDB4NTkyYjAyNzUpLCBuZXcgaW50NjQoMHg0YTc0ODRhYSwgMHg2ZWE2ZTQ4MyksXG4gICAgICAgIG5ldyBpbnQ2NCgweDVjYjBhOWRjLCAweGJkNDFmYmQ0KSwgbmV3IGludDY0KDB4NzZmOTg4ZGEsIDB4ODMxMTUzYjUpLFxuICAgICAgICBuZXcgaW50NjQoMHg5ODNlNTE1MiwgMHhlZTY2ZGZhYiksIG5ldyBpbnQ2NCgweGE4MzFjNjZkLCAweDJkYjQzMjEwKSxcbiAgICAgICAgbmV3IGludDY0KDB4YjAwMzI3YzgsIDB4OThmYjIxM2YpLCBuZXcgaW50NjQoMHhiZjU5N2ZjNywgMHhiZWVmMGVlNCksXG4gICAgICAgIG5ldyBpbnQ2NCgweGM2ZTAwYmYzLCAweDNkYTg4ZmMyKSwgbmV3IGludDY0KDB4ZDVhNzkxNDcsIDB4OTMwYWE3MjUpLFxuICAgICAgICBuZXcgaW50NjQoMHgwNmNhNjM1MSwgMHhlMDAzODI2ZiksIG5ldyBpbnQ2NCgweDE0MjkyOTY3LCAweDBhMGU2ZTcwKSxcbiAgICAgICAgbmV3IGludDY0KDB4MjdiNzBhODUsIDB4NDZkMjJmZmMpLCBuZXcgaW50NjQoMHgyZTFiMjEzOCwgMHg1YzI2YzkyNiksXG4gICAgICAgIG5ldyBpbnQ2NCgweDRkMmM2ZGZjLCAweDVhYzQyYWVkKSwgbmV3IGludDY0KDB4NTMzODBkMTMsIDB4OWQ5NWIzZGYpLFxuICAgICAgICBuZXcgaW50NjQoMHg2NTBhNzM1NCwgMHg4YmFmNjNkZSksIG5ldyBpbnQ2NCgweDc2NmEwYWJiLCAweDNjNzdiMmE4KSxcbiAgICAgICAgbmV3IGludDY0KDB4ODFjMmM5MmUsIDB4NDdlZGFlZTYpLCBuZXcgaW50NjQoMHg5MjcyMmM4NSwgMHgxNDgyMzUzYiksXG4gICAgICAgIG5ldyBpbnQ2NCgweGEyYmZlOGExLCAweDRjZjEwMzY0KSwgbmV3IGludDY0KDB4YTgxYTY2NGIsIDB4YmM0MjMwMDEpLFxuICAgICAgICBuZXcgaW50NjQoMHhjMjRiOGI3MCwgMHhkMGY4OTc5MSksIG5ldyBpbnQ2NCgweGM3NmM1MWEzLCAweDA2NTRiZTMwKSxcbiAgICAgICAgbmV3IGludDY0KDB4ZDE5MmU4MTksIDB4ZDZlZjUyMTgpLCBuZXcgaW50NjQoMHhkNjk5MDYyNCwgMHg1NTY1YTkxMCksXG4gICAgICAgIG5ldyBpbnQ2NCgweGY0MGUzNTg1LCAweDU3NzEyMDJhKSwgbmV3IGludDY0KDB4MTA2YWEwNzAsIDB4MzJiYmQxYjgpLFxuICAgICAgICBuZXcgaW50NjQoMHgxOWE0YzExNiwgMHhiOGQyZDBjOCksIG5ldyBpbnQ2NCgweDFlMzc2YzA4LCAweDUxNDFhYjUzKSxcbiAgICAgICAgbmV3IGludDY0KDB4Mjc0ODc3NGMsIDB4ZGY4ZWViOTkpLCBuZXcgaW50NjQoMHgzNGIwYmNiNSwgMHhlMTliNDhhOCksXG4gICAgICAgIG5ldyBpbnQ2NCgweDM5MWMwY2IzLCAweGM1Yzk1YTYzKSwgbmV3IGludDY0KDB4NGVkOGFhNGEsIDB4ZTM0MThhY2IpLFxuICAgICAgICBuZXcgaW50NjQoMHg1YjljY2E0ZiwgMHg3NzYzZTM3MyksIG5ldyBpbnQ2NCgweDY4MmU2ZmYzLCAweGQ2YjJiOGEzKSxcbiAgICAgICAgbmV3IGludDY0KDB4NzQ4ZjgyZWUsIDB4NWRlZmIyZmMpLCBuZXcgaW50NjQoMHg3OGE1NjM2ZiwgMHg0MzE3MmY2MCksXG4gICAgICAgIG5ldyBpbnQ2NCgweDg0Yzg3ODE0LCAweGExZjBhYjcyKSwgbmV3IGludDY0KDB4OGNjNzAyMDgsIDB4MWE2NDM5ZWMpLFxuICAgICAgICBuZXcgaW50NjQoMHg5MGJlZmZmYSwgMHgyMzYzMWUyOCksIG5ldyBpbnQ2NCgweGE0NTA2Y2ViLCAweGRlODJiZGU5KSxcbiAgICAgICAgbmV3IGludDY0KDB4YmVmOWEzZjcsIDB4YjJjNjc5MTUpLCBuZXcgaW50NjQoMHhjNjcxNzhmMiwgMHhlMzcyNTMyYiksXG4gICAgICAgIG5ldyBpbnQ2NCgweGNhMjczZWNlLCAweGVhMjY2MTljKSwgbmV3IGludDY0KDB4ZDE4NmI4YzcsIDB4MjFjMGMyMDcpLFxuICAgICAgICBuZXcgaW50NjQoMHhlYWRhN2RkNiwgMHhjZGUwZWIxZSksIG5ldyBpbnQ2NCgweGY1N2Q0ZjdmLCAweGVlNmVkMTc4KSxcbiAgICAgICAgbmV3IGludDY0KDB4MDZmMDY3YWEsIDB4NzIxNzZmYmEpLCBuZXcgaW50NjQoMHgwYTYzN2RjNSwgMHhhMmM4OThhNiksXG4gICAgICAgIG5ldyBpbnQ2NCgweDExM2Y5ODA0LCAweGJlZjkwZGFlKSwgbmV3IGludDY0KDB4MWI3MTBiMzUsIDB4MTMxYzQ3MWIpLFxuICAgICAgICBuZXcgaW50NjQoMHgyOGRiNzdmNSwgMHgyMzA0N2Q4NCksIG5ldyBpbnQ2NCgweDMyY2FhYjdiLCAweDQwYzcyNDkzKSxcbiAgICAgICAgbmV3IGludDY0KDB4M2M5ZWJlMGEsIDB4MTVjOWJlYmMpLCBuZXcgaW50NjQoMHg0MzFkNjdjNCwgMHg5YzEwMGQ0YyksXG4gICAgICAgIG5ldyBpbnQ2NCgweDRjYzVkNGJlLCAweGNiM2U0MmI2KSwgbmV3IGludDY0KDB4NTk3ZjI5OWMsIDB4ZmM2NTdlMmEpLFxuICAgICAgICBuZXcgaW50NjQoMHg1ZmNiNmZhYiwgMHgzYWQ2ZmFlYyksIG5ldyBpbnQ2NCgweDZjNDQxOThjLCAweDRhNDc1ODE3KV07XG5cbiAgICB2YXIgVyA9IG5ldyBBcnJheSg2NCk7XG4gICAgdmFyIGEsIGIsIGMsIGQsIGUsIGYsIGcsIGgsIGksIGo7XG4gICAgdmFyIFQxLCBUMjtcbiAgICB2YXIgY2hhcnNpemUgPSA4O1xuXG4gICAgZnVuY3Rpb24gdXRmOF9lbmNvZGUoc3RyKSB7XG4gICAgICAgIHJldHVybiB1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQoc3RyKSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc3RyMmJpbmIoc3RyKSB7XG4gICAgICAgIHZhciBiaW4gPSBbXTtcbiAgICAgICAgdmFyIG1hc2sgPSAoMSA8PCBjaGFyc2l6ZSkgLSAxO1xuICAgICAgICB2YXIgbGVuID0gc3RyLmxlbmd0aCAqIGNoYXJzaXplO1xuICAgIFxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSArPSBjaGFyc2l6ZSkge1xuICAgICAgICAgICAgYmluW2kgPj4gNV0gfD0gKHN0ci5jaGFyQ29kZUF0KGkgLyBjaGFyc2l6ZSkgJiBtYXNrKSA8PCAoMzIgLSBjaGFyc2l6ZSAtIChpICUgMzIpKTtcbiAgICAgICAgfVxuICAgIFxuICAgICAgICByZXR1cm4gYmluO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGJpbmIyaGV4KGJpbmFycmF5KSB7XG4gICAgICAgIHZhciBoZXhfdGFiID0gXCIwMTIzNDU2Nzg5YWJjZGVmXCI7XG4gICAgICAgIHZhciBzdHIgPSBcIlwiO1xuICAgICAgICB2YXIgbGVuZ3RoID0gYmluYXJyYXkubGVuZ3RoICogNDtcbiAgICAgICAgdmFyIHNyY0J5dGU7XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgICAgc3JjQnl0ZSA9IGJpbmFycmF5W2kgPj4gMl0gPj4gKCgzIC0gKGkgJSA0KSkgKiA4KTtcbiAgICAgICAgICAgIHN0ciArPSBoZXhfdGFiLmNoYXJBdCgoc3JjQnl0ZSA+PiA0KSAmIDB4RikgKyBoZXhfdGFiLmNoYXJBdChzcmNCeXRlICYgMHhGKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBzdHI7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2FmZV9hZGRfMih4LCB5KSB7XG4gICAgICAgIHZhciBsc3csIG1zdywgbG93T3JkZXIsIGhpZ2hPcmRlcjtcblxuICAgICAgICBsc3cgPSAoeC5sb3dPcmRlciAmIDB4RkZGRikgKyAoeS5sb3dPcmRlciAmIDB4RkZGRik7XG4gICAgICAgIG1zdyA9ICh4Lmxvd09yZGVyID4+PiAxNikgKyAoeS5sb3dPcmRlciA+Pj4gMTYpICsgKGxzdyA+Pj4gMTYpO1xuICAgICAgICBsb3dPcmRlciA9ICgobXN3ICYgMHhGRkZGKSA8PCAxNikgfCAobHN3ICYgMHhGRkZGKTtcblxuICAgICAgICBsc3cgPSAoeC5oaWdoT3JkZXIgJiAweEZGRkYpICsgKHkuaGlnaE9yZGVyICYgMHhGRkZGKSArIChtc3cgPj4+IDE2KTtcbiAgICAgICAgbXN3ID0gKHguaGlnaE9yZGVyID4+PiAxNikgKyAoeS5oaWdoT3JkZXIgPj4+IDE2KSArIChsc3cgPj4+IDE2KTtcbiAgICAgICAgaGlnaE9yZGVyID0gKChtc3cgJiAweEZGRkYpIDw8IDE2KSB8IChsc3cgJiAweEZGRkYpO1xuXG4gICAgICAgIHJldHVybiBuZXcgaW50NjQoaGlnaE9yZGVyLCBsb3dPcmRlcik7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2FmZV9hZGRfNChhLCBiLCBjLCBkKSB7XG4gICAgICAgIHZhciBsc3csIG1zdywgbG93T3JkZXIsIGhpZ2hPcmRlcjtcblxuICAgICAgICBsc3cgPSAoYS5sb3dPcmRlciAmIDB4RkZGRikgKyAoYi5sb3dPcmRlciAmIDB4RkZGRikgKyAoYy5sb3dPcmRlciAmIDB4RkZGRikgKyAoZC5sb3dPcmRlciAmIDB4RkZGRik7XG4gICAgICAgIG1zdyA9IChhLmxvd09yZGVyID4+PiAxNikgKyAoYi5sb3dPcmRlciA+Pj4gMTYpICsgKGMubG93T3JkZXIgPj4+IDE2KSArIChkLmxvd09yZGVyID4+PiAxNikgKyAobHN3ID4+PiAxNik7XG4gICAgICAgIGxvd09yZGVyID0gKChtc3cgJiAweEZGRkYpIDw8IDE2KSB8IChsc3cgJiAweEZGRkYpO1xuXG4gICAgICAgIGxzdyA9IChhLmhpZ2hPcmRlciAmIDB4RkZGRikgKyAoYi5oaWdoT3JkZXIgJiAweEZGRkYpICsgKGMuaGlnaE9yZGVyICYgMHhGRkZGKSArIChkLmhpZ2hPcmRlciAmIDB4RkZGRikgKyAobXN3ID4+PiAxNik7XG4gICAgICAgIG1zdyA9IChhLmhpZ2hPcmRlciA+Pj4gMTYpICsgKGIuaGlnaE9yZGVyID4+PiAxNikgKyAoYy5oaWdoT3JkZXIgPj4+IDE2KSArIChkLmhpZ2hPcmRlciA+Pj4gMTYpICsgKGxzdyA+Pj4gMTYpO1xuICAgICAgICBoaWdoT3JkZXIgPSAoKG1zdyAmIDB4RkZGRikgPDwgMTYpIHwgKGxzdyAmIDB4RkZGRik7XG5cbiAgICAgICAgcmV0dXJuIG5ldyBpbnQ2NChoaWdoT3JkZXIsIGxvd09yZGVyKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzYWZlX2FkZF81KGEsIGIsIGMsIGQsIGUpIHtcbiAgICAgICAgdmFyIGxzdywgbXN3LCBsb3dPcmRlciwgaGlnaE9yZGVyO1xuXG4gICAgICAgIGxzdyA9IChhLmxvd09yZGVyICYgMHhGRkZGKSArIChiLmxvd09yZGVyICYgMHhGRkZGKSArIChjLmxvd09yZGVyICYgMHhGRkZGKSArIChkLmxvd09yZGVyICYgMHhGRkZGKSArIChlLmxvd09yZGVyICYgMHhGRkZGKTtcbiAgICAgICAgbXN3ID0gKGEubG93T3JkZXIgPj4+IDE2KSArIChiLmxvd09yZGVyID4+PiAxNikgKyAoYy5sb3dPcmRlciA+Pj4gMTYpICsgKGQubG93T3JkZXIgPj4+IDE2KSArIChlLmxvd09yZGVyID4+PiAxNikgKyAobHN3ID4+PiAxNik7XG4gICAgICAgIGxvd09yZGVyID0gKChtc3cgJiAweEZGRkYpIDw8IDE2KSB8IChsc3cgJiAweEZGRkYpO1xuXG4gICAgICAgIGxzdyA9IChhLmhpZ2hPcmRlciAmIDB4RkZGRikgKyAoYi5oaWdoT3JkZXIgJiAweEZGRkYpICsgKGMuaGlnaE9yZGVyICYgMHhGRkZGKSArIChkLmhpZ2hPcmRlciAmIDB4RkZGRikgKyAoZS5oaWdoT3JkZXIgJiAweEZGRkYpICsgKG1zdyA+Pj4gMTYpO1xuICAgICAgICBtc3cgPSAoYS5oaWdoT3JkZXIgPj4+IDE2KSArIChiLmhpZ2hPcmRlciA+Pj4gMTYpICsgKGMuaGlnaE9yZGVyID4+PiAxNikgKyAoZC5oaWdoT3JkZXIgPj4+IDE2KSArIChlLmhpZ2hPcmRlciA+Pj4gMTYpICsgKGxzdyA+Pj4gMTYpO1xuICAgICAgICBoaWdoT3JkZXIgPSAoKG1zdyAmIDB4RkZGRikgPDwgMTYpIHwgKGxzdyAmIDB4RkZGRik7XG5cbiAgICAgICAgcmV0dXJuIG5ldyBpbnQ2NChoaWdoT3JkZXIsIGxvd09yZGVyKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBtYWooeCwgeSwgeikge1xuICAgICAgICByZXR1cm4gbmV3IGludDY0KFxuICAgICAgICAgICAgKHguaGlnaE9yZGVyICYgeS5oaWdoT3JkZXIpIF4gKHguaGlnaE9yZGVyICYgei5oaWdoT3JkZXIpIF4gKHkuaGlnaE9yZGVyICYgei5oaWdoT3JkZXIpLFxuICAgICAgICAgICAgKHgubG93T3JkZXIgJiB5Lmxvd09yZGVyKSBeICh4Lmxvd09yZGVyICYgei5sb3dPcmRlcikgXiAoeS5sb3dPcmRlciAmIHoubG93T3JkZXIpXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY2goeCwgeSwgeikge1xuICAgICAgICByZXR1cm4gbmV3IGludDY0KFxuICAgICAgICAgICAgKHguaGlnaE9yZGVyICYgeS5oaWdoT3JkZXIpIF4gKH54LmhpZ2hPcmRlciAmIHouaGlnaE9yZGVyKSxcbiAgICAgICAgICAgICh4Lmxvd09yZGVyICYgeS5sb3dPcmRlcikgXiAofngubG93T3JkZXIgJiB6Lmxvd09yZGVyKVxuICAgICAgICApO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHJvdHIoeCwgbikge1xuICAgICAgICBpZiAobiA8PSAzMikge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBpbnQ2NChcbiAgICAgICAgICAgICAoeC5oaWdoT3JkZXIgPj4+IG4pIHwgKHgubG93T3JkZXIgPDwgKDMyIC0gbikpLFxuICAgICAgICAgICAgICh4Lmxvd09yZGVyID4+PiBuKSB8ICh4LmhpZ2hPcmRlciA8PCAoMzIgLSBuKSlcbiAgICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IGludDY0KFxuICAgICAgICAgICAgICh4Lmxvd09yZGVyID4+PiBuKSB8ICh4LmhpZ2hPcmRlciA8PCAoMzIgLSBuKSksXG4gICAgICAgICAgICAgKHguaGlnaE9yZGVyID4+PiBuKSB8ICh4Lmxvd09yZGVyIDw8ICgzMiAtIG4pKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNpZ21hMCh4KSB7XG4gICAgICAgIHZhciByb3RyMjggPSByb3RyKHgsIDI4KTtcbiAgICAgICAgdmFyIHJvdHIzNCA9IHJvdHIoeCwgMzQpO1xuICAgICAgICB2YXIgcm90cjM5ID0gcm90cih4LCAzOSk7XG5cbiAgICAgICAgcmV0dXJuIG5ldyBpbnQ2NChcbiAgICAgICAgICAgIHJvdHIyOC5oaWdoT3JkZXIgXiByb3RyMzQuaGlnaE9yZGVyIF4gcm90cjM5LmhpZ2hPcmRlcixcbiAgICAgICAgICAgIHJvdHIyOC5sb3dPcmRlciBeIHJvdHIzNC5sb3dPcmRlciBeIHJvdHIzOS5sb3dPcmRlclxuICAgICAgICApO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNpZ21hMSh4KSB7XG4gICAgICAgIHZhciByb3RyMTQgPSByb3RyKHgsIDE0KTtcbiAgICAgICAgdmFyIHJvdHIxOCA9IHJvdHIoeCwgMTgpO1xuICAgICAgICB2YXIgcm90cjQxID0gcm90cih4LCA0MSk7XG5cbiAgICAgICAgcmV0dXJuIG5ldyBpbnQ2NChcbiAgICAgICAgICAgIHJvdHIxNC5oaWdoT3JkZXIgXiByb3RyMTguaGlnaE9yZGVyIF4gcm90cjQxLmhpZ2hPcmRlcixcbiAgICAgICAgICAgIHJvdHIxNC5sb3dPcmRlciBeIHJvdHIxOC5sb3dPcmRlciBeIHJvdHI0MS5sb3dPcmRlclxuICAgICAgICApO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdhbW1hMCh4KSB7XG4gICAgICAgIHZhciByb3RyMSA9IHJvdHIoeCwgMSksIHJvdHI4ID0gcm90cih4LCA4KSwgc2hyNyA9IHNocih4LCA3KTtcblxuICAgICAgICByZXR1cm4gbmV3IGludDY0KFxuICAgICAgICAgICAgcm90cjEuaGlnaE9yZGVyIF4gcm90cjguaGlnaE9yZGVyIF4gc2hyNy5oaWdoT3JkZXIsXG4gICAgICAgICAgICByb3RyMS5sb3dPcmRlciBeIHJvdHI4Lmxvd09yZGVyIF4gc2hyNy5sb3dPcmRlclxuICAgICAgICApO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdhbW1hMSh4KSB7XG4gICAgICAgIHZhciByb3RyMTkgPSByb3RyKHgsIDE5KTtcbiAgICAgICAgdmFyIHJvdHI2MSA9IHJvdHIoeCwgNjEpO1xuICAgICAgICB2YXIgc2hyNiA9IHNocih4LCA2KTtcblxuICAgICAgICByZXR1cm4gbmV3IGludDY0KFxuICAgICAgICAgICAgcm90cjE5LmhpZ2hPcmRlciBeIHJvdHI2MS5oaWdoT3JkZXIgXiBzaHI2LmhpZ2hPcmRlcixcbiAgICAgICAgICAgIHJvdHIxOS5sb3dPcmRlciBeIHJvdHI2MS5sb3dPcmRlciBeIHNocjYubG93T3JkZXJcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzaHIoeCwgbikge1xuICAgICAgICBpZiAobiA8PSAzMikge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBpbnQ2NChcbiAgICAgICAgICAgICAgICB4LmhpZ2hPcmRlciA+Pj4gbixcbiAgICAgICAgICAgICAgICB4Lmxvd09yZGVyID4+PiBuIHwgKHguaGlnaE9yZGVyIDw8ICgzMiAtIG4pKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgaW50NjQoXG4gICAgICAgICAgICAgICAgMCxcbiAgICAgICAgICAgICAgICB4LmhpZ2hPcmRlciA8PCAoMzIgLSBuKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHZhciBzdHIgPSB1dGY4X2VuY29kZShzdHIpO1xuICAgIHZhciBzdHJsZW4gPSBzdHIubGVuZ3RoKmNoYXJzaXplO1xuICAgIHN0ciA9IHN0cjJiaW5iKHN0cik7XG5cbiAgICBzdHJbc3RybGVuID4+IDVdIHw9IDB4ODAgPDwgKDI0IC0gc3RybGVuICUgMzIpO1xuICAgIHN0clsoKChzdHJsZW4gKyAxMjgpID4+IDEwKSA8PCA1KSArIDMxXSA9IHN0cmxlbjtcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3RyLmxlbmd0aDsgaSArPSAzMikge1xuICAgICAgICBhID0gSFswXTtcbiAgICAgICAgYiA9IEhbMV07XG4gICAgICAgIGMgPSBIWzJdO1xuICAgICAgICBkID0gSFszXTtcbiAgICAgICAgZSA9IEhbNF07XG4gICAgICAgIGYgPSBIWzVdO1xuICAgICAgICBnID0gSFs2XTtcbiAgICAgICAgaCA9IEhbN107XG5cbiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCA4MDsgaisrKSB7XG4gICAgICAgICAgICBpZiAoaiA8IDE2KSB7XG4gICAgICAgICAgICAgICAgV1tqXSA9IG5ldyBpbnQ2NChzdHJbaioyICsgaV0sIHN0cltqKjIgKyBpICsgMV0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBXW2pdID0gc2FmZV9hZGRfNChnYW1tYTEoV1tqIC0gMl0pLCBXW2ogLSA3XSwgZ2FtbWEwKFdbaiAtIDE1XSksIFdbaiAtIDE2XSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIFQxID0gc2FmZV9hZGRfNShoLCBzaWdtYTEoZSksIGNoKGUsIGYsIGcpLCBLW2pdLCBXW2pdKTtcbiAgICAgICAgICAgIFQyID0gc2FmZV9hZGRfMihzaWdtYTAoYSksIG1haihhLCBiLCBjKSk7XG4gICAgICAgICAgICBoID0gZztcbiAgICAgICAgICAgIGcgPSBmO1xuICAgICAgICAgICAgZiA9IGU7XG4gICAgICAgICAgICBlID0gc2FmZV9hZGRfMihkLCBUMSk7XG4gICAgICAgICAgICBkID0gYztcbiAgICAgICAgICAgIGMgPSBiO1xuICAgICAgICAgICAgYiA9IGE7XG4gICAgICAgICAgICBhID0gc2FmZV9hZGRfMihUMSwgVDIpO1xuICAgICAgICB9XG5cbiAgICAgICAgSFswXSA9IHNhZmVfYWRkXzIoYSwgSFswXSk7XG4gICAgICAgIEhbMV0gPSBzYWZlX2FkZF8yKGIsIEhbMV0pO1xuICAgICAgICBIWzJdID0gc2FmZV9hZGRfMihjLCBIWzJdKTtcbiAgICAgICAgSFszXSA9IHNhZmVfYWRkXzIoZCwgSFszXSk7XG4gICAgICAgIEhbNF0gPSBzYWZlX2FkZF8yKGUsIEhbNF0pO1xuICAgICAgICBIWzVdID0gc2FmZV9hZGRfMihmLCBIWzVdKTtcbiAgICAgICAgSFs2XSA9IHNhZmVfYWRkXzIoZywgSFs2XSk7XG4gICAgICAgIEhbN10gPSBzYWZlX2FkZF8yKGgsIEhbN10pO1xuICAgIH1cblxuICAgIHZhciBiaW5hcnJheSA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgSC5sZW5ndGg7IGkrKykge1xuICAgICAgICBiaW5hcnJheS5wdXNoKEhbaV0uaGlnaE9yZGVyKTtcbiAgICAgICAgYmluYXJyYXkucHVzaChIW2ldLmxvd09yZGVyKTtcbiAgICB9XG5cbiAgICByZXR1cm4gYmluYjJoZXgoYmluYXJyYXkpO1xufSk7XHJcblxyXG4vKipcclxuICogKGMpIGpUb29scyBJbnB1dCBNYXNrXHJcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9wYXVsaG9kZWwvanRvb2xzXHJcbiAqXHJcbiAqIEBhdXRob3I6IFBhdWwgSG9kZWwgPHBhdWwuaG9kZWxAZ21haWwuY29tPlxyXG4gKiBAZGVzY3JpcHRpb246IElucHV0IG1hc2tcclxuICovXHJcblxyXG5qU3VpdGVzLm1hc2sgPSAoZnVuY3Rpb24oKSB7XHJcbiAgICB2YXIgb2JqID0ge307XHJcbiAgICB2YXIgaW5kZXggPSAwO1xyXG4gICAgdmFyIHZhbHVlcyA9IFtdXHJcbiAgICB2YXIgcGllY2VzID0gW107XHJcblxyXG4gICAgb2JqLnJ1biA9IGZ1bmN0aW9uKHZhbHVlLCBtYXNrLCBkZWNpbWFsKSB7XHJcbiAgICAgICAgaWYgKHZhbHVlICYmIG1hc2spIHtcclxuICAgICAgICAgICAgaWYgKCEgZGVjaW1hbCkge1xyXG4gICAgICAgICAgICAgICAgZGVjaW1hbCA9ICcuJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodmFsdWUgPT0gTnVtYmVyKHZhbHVlKSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIG51bWJlciA9ICgnJyt2YWx1ZSkuc3BsaXQoJy4nKTtcclxuICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IG51bWJlclswXTtcclxuICAgICAgICAgICAgICAgIHZhciB2YWx1ZURlY2ltYWwgPSBudW1iZXJbMV07XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2YWx1ZSA9ICcnICsgdmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaW5kZXggPSAwO1xyXG4gICAgICAgICAgICB2YWx1ZXMgPSBbXTtcclxuICAgICAgICAgICAgLy8gQ3JlYXRlIG1hc2sgdG9rZW5cclxuICAgICAgICAgICAgb2JqLnByZXBhcmUobWFzayk7XHJcbiAgICAgICAgICAgIC8vIEN1cnJlbnQgdmFsdWVcclxuICAgICAgICAgICAgdmFyIGN1cnJlbnRWYWx1ZSA9IHZhbHVlO1xyXG4gICAgICAgICAgICBpZiAoY3VycmVudFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBDaGVja2luZyBjdXJyZW50IHZhbHVlXHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGN1cnJlbnRWYWx1ZS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50VmFsdWVbaV0gIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoucHJvY2VzcyhjdXJyZW50VmFsdWVbaV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodmFsdWVEZWNpbWFsKSB7XHJcbiAgICAgICAgICAgICAgICBvYmoucHJvY2VzcyhkZWNpbWFsKTtcclxuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50VmFsdWUgPSB2YWx1ZURlY2ltYWw7XHJcbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2tpbmcgY3VycmVudCB2YWx1ZVxyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY3VycmVudFZhbHVlLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50VmFsdWVbaV0gIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnByb2Nlc3MoY3VycmVudFZhbHVlW2ldKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBGb3JtYXR0ZWQgdmFsdWVcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlcy5qb2luKCcnKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gJyc7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9iai5hcHBseSA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICBpZiAoZS50YXJnZXQgJiYgISBlLnRhcmdldC5nZXRBdHRyaWJ1dGUoJ3JlYWRvbmx5JykpIHtcclxuICAgICAgICAgICAgdmFyIG1hc2sgPSBlLnRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtbWFzaycpO1xyXG4gICAgICAgICAgICBpZiAobWFzayAmJiBlLmtleUNvZGUgPiA0Nikge1xyXG4gICAgICAgICAgICAgICAgaW5kZXggPSAwO1xyXG4gICAgICAgICAgICAgICAgdmFsdWVzID0gW107XHJcbiAgICAgICAgICAgICAgICAvLyBDcmVhdGUgbWFzayB0b2tlblxyXG4gICAgICAgICAgICAgICAgb2JqLnByZXBhcmUobWFzayk7XHJcbiAgICAgICAgICAgICAgICAvLyBDdXJyZW50IHZhbHVlXHJcbiAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXQuc2VsZWN0aW9uU3RhcnQgPCBlLnRhcmdldC5zZWxlY3Rpb25FbmQpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY3VycmVudFZhbHVlID0gZS50YXJnZXQudmFsdWUuc3Vic3RyaW5nKDAsIGUudGFyZ2V0LnNlbGVjdGlvblN0YXJ0KTsgXHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjdXJyZW50VmFsdWUgPSBlLnRhcmdldC52YWx1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50VmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBDaGVja2luZyBjdXJyZW50IHZhbHVlXHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjdXJyZW50VmFsdWUubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRWYWx1ZVtpXSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoucHJvY2VzcyhjdXJyZW50VmFsdWVbaV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gTmV3IGlucHV0XHJcbiAgICAgICAgICAgICAgICBvYmoucHJvY2VzcyhvYmouZnJvbUtleUNvZGUoZSkpO1xyXG4gICAgICAgICAgICAgICAgLy8gVXBkYXRlIHZhbHVlIHRvIHRoZSBlbGVtZW50XHJcbiAgICAgICAgICAgICAgICBlLnRhcmdldC52YWx1ZSA9IHZhbHVlcy5qb2luKCcnKTtcclxuICAgICAgICAgICAgICAgIGlmIChwaWVjZXMubGVuZ3RoID09IHZhbHVlcy5sZW5ndGggJiYgcGllY2VzW3BpZWNlcy5sZW5ndGgtMV0ubGVuZ3RoID09IHZhbHVlc1t2YWx1ZXMubGVuZ3RoLTFdLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGUudGFyZ2V0LnNldEF0dHJpYnV0ZSgnZGF0YS1jb21wbGV0ZWQnLCAndHJ1ZScpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBlLnRhcmdldC5zZXRBdHRyaWJ1dGUoJ2RhdGEtY29tcGxldGVkJywgJ2ZhbHNlJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyBQcmV2ZW50IGRlZmF1bHRcclxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFByb2Nlc3MgaW5wdXRzIGFuZCBzYXZlIHRvIHZhbHVlc1xyXG4gICAgICovXHJcbiAgICBvYmoucHJvY2VzcyA9IGZ1bmN0aW9uKGlucHV0KSB7XHJcbiAgICAgICAgZG8ge1xyXG4gICAgICAgICAgICBpZiAocGllY2VzW2luZGV4XSA9PSAnbW0nKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodmFsdWVzW2luZGV4XSA9PSBudWxsIHx8IHZhbHVlc1tpbmRleF0gPT0gJycpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VJbnQoaW5wdXQpID4gMSAmJiBwYXJzZUludChpbnB1dCkgPCAxMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZXNbaW5kZXhdID0gJzAnICsgaW5wdXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4Kys7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocGFyc2VJbnQoaW5wdXQpIDwgMTApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzW2luZGV4XSA9IGlucHV0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWVzW2luZGV4XSA9PSAxICYmIHZhbHVlc1tpbmRleF0gPCAyICYmIHBhcnNlSW50KGlucHV0KSA8IDMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzW2luZGV4XSArPSBpbnB1dDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXgrKztcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZXNbaW5kZXhdID09IDAgJiYgdmFsdWVzW2luZGV4XSA8IDEwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlc1tpbmRleF0gKz0gaW5wdXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4Kys7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIGlmIChwaWVjZXNbaW5kZXhdID09ICdkZCcpIHtcclxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZXNbaW5kZXhdID09IG51bGwgfHwgdmFsdWVzW2luZGV4XSA9PSAnJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZUludChpbnB1dCkgPiAzICYmIHBhcnNlSW50KGlucHV0KSA8IDEwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlc1tpbmRleF0gPSAnMCcgKyBpbnB1dDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXgrKztcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwYXJzZUludChpbnB1dCkgPCAxMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZXNbaW5kZXhdID0gaW5wdXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZXNbaW5kZXhdID09IDMgJiYgcGFyc2VJbnQoaW5wdXQpIDwgMikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZXNbaW5kZXhdICs9IGlucHV0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmRleCsrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlc1tpbmRleF0gPCAzICYmIHBhcnNlSW50KGlucHV0KSA8IDEwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlc1tpbmRleF0gKz0gaW5wdXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4Kys7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIGlmIChwaWVjZXNbaW5kZXhdID09ICdoaDI0Jykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlc1tpbmRleF0gPT0gbnVsbCB8fCB2YWx1ZXNbaW5kZXhdID09ICcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlSW50KGlucHV0KSA+IDIgJiYgcGFyc2VJbnQoaW5wdXQpIDwgMTApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzW2luZGV4XSA9ICcwJyArIGlucHV0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmRleCsrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHBhcnNlSW50KGlucHV0KSA8IDEwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlc1tpbmRleF0gPSBpbnB1dDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlc1tpbmRleF0gPT0gMiAmJiBwYXJzZUludChpbnB1dCkgPCA0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlc1tpbmRleF0gKz0gaW5wdXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4Kys7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWVzW2luZGV4XSA8IDIgJiYgcGFyc2VJbnQoaW5wdXQpIDwgMTApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzW2luZGV4XSArPSBpbnB1dDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXgrKztcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHBpZWNlc1tpbmRleF0gPT0gJ2hoJykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlc1tpbmRleF0gPT0gbnVsbCB8fCB2YWx1ZXNbaW5kZXhdID09ICcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlSW50KGlucHV0KSA+IDEgJiYgcGFyc2VJbnQoaW5wdXQpIDwgMTApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzW2luZGV4XSA9ICcwJyArIGlucHV0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmRleCsrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHBhcnNlSW50KGlucHV0KSA8IDEwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlc1tpbmRleF0gPSBpbnB1dDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlc1tpbmRleF0gPT0gMSAmJiBwYXJzZUludChpbnB1dCkgPCAzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlc1tpbmRleF0gKz0gaW5wdXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4Kys7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWVzW2luZGV4XSA8IDEgJiYgcGFyc2VJbnQoaW5wdXQpIDwgMTApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzW2luZGV4XSArPSBpbnB1dDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXgrKztcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHBpZWNlc1tpbmRleF0gPT0gJ21pJyB8fCBwaWVjZXNbaW5kZXhdID09ICdzcycpIHtcclxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZXNbaW5kZXhdID09IG51bGwgfHwgdmFsdWVzW2luZGV4XSA9PSAnJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZUludChpbnB1dCkgPiA1ICYmIHBhcnNlSW50KGlucHV0KSA8IDEwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlc1tpbmRleF0gPSAnMCcgKyBpbnB1dDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXgrKztcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwYXJzZUludChpbnB1dCkgPCAxMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZXNbaW5kZXhdID0gaW5wdXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZUludChpbnB1dCkgPCAxMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZXNbaW5kZXhdICs9IGlucHV0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmRleCsrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHBpZWNlc1tpbmRleF0gPT0gJ3l5JyB8fCBwaWVjZXNbaW5kZXhdID09ICd5eXl5Jykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHBhcnNlSW50KGlucHV0KSA8IDEwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlc1tpbmRleF0gPT0gbnVsbCB8fCB2YWx1ZXNbaW5kZXhdID09ICcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlc1tpbmRleF0gPSBpbnB1dDtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZXNbaW5kZXhdICs9IGlucHV0O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWVzW2luZGV4XS5sZW5ndGggPT0gcGllY2VzW2luZGV4XS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXgrKztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIGlmIChwaWVjZXNbaW5kZXhdID09ICcjJyB8fCBwaWVjZXNbaW5kZXhdID09ICcjLiMjJyB8fCBwaWVjZXNbaW5kZXhdID09ICcjLCMjJyB8fCBwaWVjZXNbaW5kZXhdID09ICcjICMjJykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGlucHV0Lm1hdGNoKC9bMC05XS9nKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwaWVjZXNbaW5kZXhdID09ICcjLiMjJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2VwYXJhdG9yID0gJy4nO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocGllY2VzW2luZGV4XSA9PSAnIywjIycpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNlcGFyYXRvciA9ICcsJztcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHBpZWNlc1tpbmRleF0gPT0gJyMgIyMnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzZXBhcmF0b3IgPSAnICc7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNlcGFyYXRvciA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWVzW2luZGV4XSA9PSBudWxsIHx8IHZhbHVlc1tpbmRleF0gPT0gJycpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzW2luZGV4XSA9IGlucHV0O1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlc1tpbmRleF0gKz0gaW5wdXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZXBhcmF0b3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlc1tpbmRleF0gPSB2YWx1ZXNbaW5kZXhdLm1hdGNoKC9bMC05XS9nKS5qb2luKCcnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcyA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gdmFsdWVzW2luZGV4XS5sZW5ndGggLSAxOyBqID49IDAgOyBqLS0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LnB1c2godmFsdWVzW2luZGV4XVtqXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcysrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghIChzICUgMykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5wdXNoKHNlcGFyYXRvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdCA9IHQucmV2ZXJzZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzW2luZGV4XSA9IHQuam9pbignJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWVzW2luZGV4XS5zdWJzdHIoMCwxKSA9PSBzZXBhcmF0b3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZXNbaW5kZXhdID0gdmFsdWVzW2luZGV4XS5zdWJzdHIoMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocGllY2VzW2luZGV4XSA9PSAnIy4jIycgJiYgaW5wdXQgPT0gJy4nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIERvIG5vdGhpbmdcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHBpZWNlc1tpbmRleF0gPT0gJyMsIyMnICYmIGlucHV0ID09ICcsJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBEbyBub3RoaW5nXHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwaWVjZXNbaW5kZXhdID09ICcjICMjJyAmJiBpbnB1dCA9PSAnICcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gRG8gbm90aGluZ1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZXNbaW5kZXhdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleCsrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBpZWNlc1tpbmRleF0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGllY2VzW2luZGV4XSA9PSBpbnB1dCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZXNbaW5kZXhdID0gaW5wdXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwaWVjZXNbaW5kZXhdID09ICcwJyAmJiBwaWVjZXNbaW5kZXgrMV0gPT0gaW5wdXQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4Kys7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZXNbaW5kZXhdID0gaW5wdXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHBpZWNlc1tpbmRleF0gPT0gJzAnKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaW5wdXQubWF0Y2goL1swLTldL2cpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVzW2luZGV4XSA9IGlucHV0O1xyXG4gICAgICAgICAgICAgICAgICAgIGluZGV4Kys7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIGlmIChwaWVjZXNbaW5kZXhdID09ICdhJykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGlucHV0Lm1hdGNoKC9bYS16QS1aXS9nKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlc1tpbmRleF0gPSBpbnB1dDtcclxuICAgICAgICAgICAgICAgICAgICBpbmRleCsrO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocGllY2VzW2luZGV4XSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBpZWNlc1tpbmRleF0gPT0gJ1xcXFxhJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdiA9ICdhJztcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHBpZWNlc1tpbmRleF0gPT0gJ1xcXFwwJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdiA9ICcwJztcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHBpZWNlc1tpbmRleF0gPT0gJ1stXScpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlucHV0ID09ICctJyB8fCBpbnB1dCA9PSAnKycpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2ID0gaW5wdXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdiA9ICcgJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2ID0gcGllY2VzW2luZGV4XTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVzW2luZGV4XSA9IHY7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlucHV0ID09IHYpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXgrKztcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpbmRleCsrO1xyXG4gICAgICAgIH0gd2hpbGUgKHBpZWNlc1tpbmRleF0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlIHRva2VucyBmb3IgdGhlIG1hc2tcclxuICAgICAqL1xyXG4gICAgb2JqLnByZXBhcmUgPSBmdW5jdGlvbihtYXNrKSB7XHJcbiAgICAgICAgcGllY2VzID0gW107XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXNrLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmIChtYXNrW2ldLm1hdGNoKC9bMC05XXxbYS16XXxcXFxcL2cpKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobWFza1tpXSA9PSAneScgJiYgbWFza1tpKzFdID09ICd5JyAmJiBtYXNrW2krMl0gPT0gJ3knICYmIG1hc2tbaSszXSA9PSAneScpIHtcclxuICAgICAgICAgICAgICAgICAgICBwaWVjZXMucHVzaCgneXl5eScpO1xyXG4gICAgICAgICAgICAgICAgICAgIGkgKz0gMztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobWFza1tpXSA9PSAneScgJiYgbWFza1tpKzFdID09ICd5Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIHBpZWNlcy5wdXNoKCd5eScpO1xyXG4gICAgICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobWFza1tpXSA9PSAnbScgJiYgbWFza1tpKzFdID09ICdtJyAmJiBtYXNrW2krMl0gPT0gJ20nICYmIG1hc2tbaSszXSA9PSAnbScpIHtcclxuICAgICAgICAgICAgICAgICAgICBwaWVjZXMucHVzaCgnbW1tbScpO1xyXG4gICAgICAgICAgICAgICAgICAgIGkgKz0gMztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobWFza1tpXSA9PSAnbScgJiYgbWFza1tpKzFdID09ICdtJyAmJiBtYXNrW2krMl0gPT0gJ20nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGllY2VzLnB1c2goJ21tbScpO1xyXG4gICAgICAgICAgICAgICAgICAgIGkgKz0gMjtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobWFza1tpXSA9PSAnbScgJiYgbWFza1tpKzFdID09ICdtJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHBpZWNlcy5wdXNoKCdtbScpO1xyXG4gICAgICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobWFza1tpXSA9PSAnZCcgJiYgbWFza1tpKzFdID09ICdkJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHBpZWNlcy5wdXNoKCdkZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobWFza1tpXSA9PSAnaCcgJiYgbWFza1tpKzFdID09ICdoJyAmJiBtYXNrW2krMl0gPT0gJzInICYmIG1hc2tbaSszXSA9PSAnNCcpIHtcclxuICAgICAgICAgICAgICAgICAgICBwaWVjZXMucHVzaCgnaGgyNCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIGkgKz0gMztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobWFza1tpXSA9PSAnaCcgJiYgbWFza1tpKzFdID09ICdoJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHBpZWNlcy5wdXNoKCdoaCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobWFza1tpXSA9PSAnbScgJiYgbWFza1tpKzFdID09ICdpJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHBpZWNlcy5wdXNoKCdtaScpO1xyXG4gICAgICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobWFza1tpXSA9PSAncycgJiYgbWFza1tpKzFdID09ICdzJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHBpZWNlcy5wdXNoKCdzcycpO1xyXG4gICAgICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobWFza1tpXSA9PSAnYScgJiYgbWFza1tpKzFdID09ICdtJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHBpZWNlcy5wdXNoKCdhbScpO1xyXG4gICAgICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobWFza1tpXSA9PSAncCcgJiYgbWFza1tpKzFdID09ICdtJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHBpZWNlcy5wdXNoKCdwbScpO1xyXG4gICAgICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobWFza1tpXSA9PSAnXFxcXCcgJiYgbWFza1tpKzFdID09ICcwJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHBpZWNlcy5wdXNoKCdcXFxcMCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobWFza1tpXSA9PSAnXFxcXCcgJiYgbWFza1tpKzFdID09ICdhJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHBpZWNlcy5wdXNoKCdcXFxcYScpO1xyXG4gICAgICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGllY2VzLnB1c2gobWFza1tpXSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobWFza1tpXSA9PSAnIycgJiYgbWFza1tpKzFdID09ICcuJyAmJiBtYXNrW2krMl0gPT0gJyMnICYmIG1hc2tbaSszXSA9PSAnIycpIHtcclxuICAgICAgICAgICAgICAgICAgICBwaWVjZXMucHVzaCgnIy4jIycpO1xyXG4gICAgICAgICAgICAgICAgICAgIGkgKz0gMztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobWFza1tpXSA9PSAnIycgJiYgbWFza1tpKzFdID09ICcsJyAmJiBtYXNrW2krMl0gPT0gJyMnICYmIG1hc2tbaSszXSA9PSAnIycpIHtcclxuICAgICAgICAgICAgICAgICAgICBwaWVjZXMucHVzaCgnIywjIycpO1xyXG4gICAgICAgICAgICAgICAgICAgIGkgKz0gMztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobWFza1tpXSA9PSAnIycgJiYgbWFza1tpKzFdID09ICcgJyAmJiBtYXNrW2krMl0gPT0gJyMnICYmIG1hc2tbaSszXSA9PSAnIycpIHtcclxuICAgICAgICAgICAgICAgICAgICBwaWVjZXMucHVzaCgnIyAjIycpO1xyXG4gICAgICAgICAgICAgICAgICAgIGkgKz0gMztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobWFza1tpXSA9PSAnWycgJiYgbWFza1tpKzFdID09ICctJyAmJiBtYXNrW2krMl0gPT0gJ10nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGllY2VzLnB1c2goJ1stXScpO1xyXG4gICAgICAgICAgICAgICAgICAgIGkgKz0gMjtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGllY2VzLnB1c2gobWFza1tpXSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIFxyXG4gICAgICogVGhhbmtzIGZvciB0aGUgY29sbGFib3JhdGlvblxyXG4gICAgICovXHJcbiAgICBvYmouZnJvbUtleUNvZGUgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgdmFyIF90b19hc2NpaSA9IHtcclxuICAgICAgICAgICAgJzE4OCc6ICc0NCcsXHJcbiAgICAgICAgICAgICcxMDknOiAnNDUnLFxyXG4gICAgICAgICAgICAnMTkwJzogJzQ2JyxcclxuICAgICAgICAgICAgJzE5MSc6ICc0NycsXHJcbiAgICAgICAgICAgICcxOTInOiAnOTYnLFxyXG4gICAgICAgICAgICAnMjIwJzogJzkyJyxcclxuICAgICAgICAgICAgJzIyMic6ICczOScsXHJcbiAgICAgICAgICAgICcyMjEnOiAnOTMnLFxyXG4gICAgICAgICAgICAnMjE5JzogJzkxJyxcclxuICAgICAgICAgICAgJzE3Myc6ICc0NScsXHJcbiAgICAgICAgICAgICcxODcnOiAnNjEnLCAvL0lFIEtleSBjb2Rlc1xyXG4gICAgICAgICAgICAnMTg2JzogJzU5JywgLy9JRSBLZXkgY29kZXNcclxuICAgICAgICAgICAgJzE4OSc6ICc0NScgIC8vSUUgS2V5IGNvZGVzXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgc2hpZnRVcHMgPSB7XHJcbiAgICAgICAgICAgIFwiOTZcIjogXCJ+XCIsXHJcbiAgICAgICAgICAgIFwiNDlcIjogXCIhXCIsXHJcbiAgICAgICAgICAgIFwiNTBcIjogXCJAXCIsXHJcbiAgICAgICAgICAgIFwiNTFcIjogXCIjXCIsXHJcbiAgICAgICAgICAgIFwiNTJcIjogXCIkXCIsXHJcbiAgICAgICAgICAgIFwiNTNcIjogXCIlXCIsXHJcbiAgICAgICAgICAgIFwiNTRcIjogXCJeXCIsXHJcbiAgICAgICAgICAgIFwiNTVcIjogXCImXCIsXHJcbiAgICAgICAgICAgIFwiNTZcIjogXCIqXCIsXHJcbiAgICAgICAgICAgIFwiNTdcIjogXCIoXCIsXHJcbiAgICAgICAgICAgIFwiNDhcIjogXCIpXCIsXHJcbiAgICAgICAgICAgIFwiNDVcIjogXCJfXCIsXHJcbiAgICAgICAgICAgIFwiNjFcIjogXCIrXCIsXHJcbiAgICAgICAgICAgIFwiOTFcIjogXCJ7XCIsXHJcbiAgICAgICAgICAgIFwiOTNcIjogXCJ9XCIsXHJcbiAgICAgICAgICAgIFwiOTJcIjogXCJ8XCIsXHJcbiAgICAgICAgICAgIFwiNTlcIjogXCI6XCIsXHJcbiAgICAgICAgICAgIFwiMzlcIjogXCJcXFwiXCIsXHJcbiAgICAgICAgICAgIFwiNDRcIjogXCI8XCIsXHJcbiAgICAgICAgICAgIFwiNDZcIjogXCI+XCIsXHJcbiAgICAgICAgICAgIFwiNDdcIjogXCI/XCJcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgYyA9IGUud2hpY2g7XHJcblxyXG4gICAgICAgIGlmIChfdG9fYXNjaWkuaGFzT3duUHJvcGVydHkoYykpIHtcclxuICAgICAgICAgICAgYyA9IF90b19hc2NpaVtjXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghZS5zaGlmdEtleSAmJiAoYyA+PSA2NSAmJiBjIDw9IDkwKSkge1xyXG4gICAgICAgICAgICBjID0gU3RyaW5nLmZyb21DaGFyQ29kZShjICsgMzIpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoZS5zaGlmdEtleSAmJiBzaGlmdFVwcy5oYXNPd25Qcm9wZXJ0eShjKSkge1xyXG4gICAgICAgICAgICBjID0gc2hpZnRVcHNbY107XHJcbiAgICAgICAgfSBlbHNlIGlmICg5NiA8PSBjICYmIGMgPD0gMTA1KSB7XHJcbiAgICAgICAgICAgIGMgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGMgLSA0OCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgYyA9IFN0cmluZy5mcm9tQ2hhckNvZGUoYyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gYztcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gb2JqO1xyXG59KSgpO1xyXG5cclxualN1aXRlcy5tb2JpbGUgPSAoZnVuY3Rpb24oZWwsIG9wdGlvbnMpIHtcclxuICAgIHZhciBvYmogPSB7fTtcclxuICAgIG9iai5vcHRpb25zID0ge307XHJcblxyXG4gICAgaWYgKGpTdWl0ZXMuZWwpIHtcclxuICAgICAgICBqU3VpdGVzLmVsLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnb3B0aW9uLXRpdGxlJykpIHtcclxuICAgICAgICAgICAgICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ3NlbGVjdGVkJykpIHtcclxuICAgICAgICAgICAgICAgICAgICBlLnRhcmdldC5jbGFzc0xpc3QucmVtb3ZlKCdzZWxlY3RlZCcpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBlLnRhcmdldC5jbGFzc0xpc3QuYWRkKCdzZWxlY3RlZCcpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG9iajtcclxufSkoKTtcclxuXHJcbmpTdWl0ZXMucGFnZXMgPSAoZnVuY3Rpb24oKSB7XHJcbiAgICB2YXIgY29udGFpbmVyID0gbnVsbDtcclxuICAgIHZhciBjdXJyZW50ID0gbnVsbDtcclxuXHJcbiAgICAvLyBDcmVhdGUgYSBwYWdlXHJcbiAgICB2YXIgY3JlYXRlUGFnZSA9IGZ1bmN0aW9uKG9wdGlvbnMsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgLy8gQ3JlYXRlIHBhZ2VcclxuICAgICAgICB2YXIgcGFnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgIHBhZ2UuY2xhc3NMaXN0LmFkZCgncGFnZScpO1xyXG5cclxuICAgICAgICAvLyBBbHdheXMgaGlkZGVuXHJcbiAgICAgICAgcGFnZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG5cclxuICAgICAgICAvLyBLZWVwIG9wdGlvbnNcclxuICAgICAgICBwYWdlLm9wdGlvbnMgPSBvcHRpb25zID8gb3B0aW9ucyA6IHt9O1xyXG5cclxuICAgICAgICBpZiAoISBjdXJyZW50KSB7XHJcbiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChwYWdlKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb250YWluZXIuaW5zZXJ0QmVmb3JlKHBhZ2UsIGN1cnJlbnQubmV4dFNpYmxpbmcpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgalN1aXRlcy5hamF4KHtcclxuICAgICAgICAgICAgdXJsOiBwYWdlLm9wdGlvbnMudXJsLFxyXG4gICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIC8vIFB1c2ggdG8gcmVmcmVzaCBjb250cm9sc1xyXG4gICAgICAgICAgICAgICAgalN1aXRlcy5yZWZyZXNoKHBhZ2UsIHBhZ2Uub3B0aW9ucy5vbnB1c2gpO1xyXG5cbiAgICAgICAgICAgICAgICAvLyBPcGVuIHBhZ2VcclxuICAgICAgICAgICAgICAgIHBhZ2UuaW5uZXJIVE1MID0gcmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgLy8gR2V0IGphdmFzY3JpcHRcclxuICAgICAgICAgICAgICAgIHZhciBzY3JpcHQgPSBwYWdlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzY3JpcHQnKTtcclxuICAgICAgICAgICAgICAgIC8vIFJ1biBwb3NzaWJsZSBpbmxpbmUgc2NyaXB0c1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzY3JpcHQubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBHZXQgdHlwZVxyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0eXBlID0gc2NyaXB0W2ldLmdldEF0dHJpYnV0ZSgndHlwZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghIHR5cGUgfHwgdHlwZSA9PSAndGV4dC9qYXZhc2NyaXB0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBldmFsKHNjcmlwdFtpXS5pbm5lckhUTUwpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vIFNldCB0aXRsZVxyXG4gICAgICAgICAgICAgICAgcGFnZS5zZXRUaXRsZSA9IGZ1bmN0aW9uKHRleHQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNoaWxkcmVuWzBdLmNoaWxkcmVuWzBdLmNoaWxkcmVuWzFdLmlubmVySFRNTCA9IHRleHQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyBTaG93IHBhZ2VcclxuICAgICAgICAgICAgICAgIGlmICghIHBhZ2Uub3B0aW9ucy5jbG9zZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBzaG93UGFnZShwYWdlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vIE9ubG9hZCBjYWxsYmFja1xyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZihwYWdlLm9wdGlvbnMub25sb2FkKSA9PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGFnZS5vcHRpb25zLm9ubG9hZChwYWdlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vIEZvcmNlIGNhbGxiYWNrXHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mKGNhbGxiYWNrKSA9PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2socGFnZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHBhZ2U7XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIHNob3dQYWdlID0gZnVuY3Rpb24ocGFnZSwgaWdub3JlSGlzdG9yeSwgY2FsbGJhY2spIHtcclxuICAgICAgICBpZiAoY3VycmVudCkge1xyXG4gICAgICAgICAgICBpZiAoY3VycmVudCA9PSBwYWdlKSB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50ID0gcGFnZTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIEtlZXAgc2Nyb2xsIGluIHRoZSB0b3BcclxuICAgICAgICAgICAgICAgIHdpbmRvdy5zY3JvbGxUbyh7IHRvcDogMCB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBTaG93IHBhZ2VcclxuICAgICAgICAgICAgICAgIHBhZ2Uuc3R5bGUuZGlzcGxheSA9ICcnO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBhID0gQXJyYXkucHJvdG90eXBlLmluZGV4T2YuY2FsbChjb250YWluZXIuY2hpbGRyZW4sIGN1cnJlbnQpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGIgPSBBcnJheS5wcm90b3R5cGUuaW5kZXhPZi5jYWxsKGNvbnRhaW5lci5jaGlsZHJlbiwgcGFnZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gTGVhdmVcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YoY3VycmVudC5vcHRpb25zLm9ubGVhdmUpID09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50Lm9wdGlvbnMub25sZWF2ZShjdXJyZW50LCBwYWdlLCBpZ25vcmVIaXN0b3J5KTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBqU3VpdGVzLnNsaWRlTGVmdChjb250YWluZXIsIChhIDwgYiA/IDAgOiAxKSwgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnQgPSBwYWdlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gRW50ZXJcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YocGFnZS5vcHRpb25zLm9uZW50ZXIpID09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgICAgICBwYWdlLm9wdGlvbnMub25lbnRlcihwYWdlLCBjdXJyZW50LCBpZ25vcmVIaXN0b3J5KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIFNob3dcclxuICAgICAgICAgICAgcGFnZS5zdHlsZS5kaXNwbGF5ID0gJyc7XHJcblxyXG4gICAgICAgICAgICAvLyBLZWVwIGN1cnJlbnRcclxuICAgICAgICAgICAgY3VycmVudCA9IHBhZ2U7XHJcblxyXG4gICAgICAgICAgICAvLyBFbnRlclxyXG4gICAgICAgICAgICBpZiAodHlwZW9mKHBhZ2Uub3B0aW9ucy5vbmVudGVyKSA9PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgICBwYWdlLm9wdGlvbnMub25lbnRlcihwYWdlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQWRkIGhpc3RvcnlcclxuICAgICAgICBpZiAoISBpZ25vcmVIaXN0b3J5KSB7XHJcbiAgICAgICAgICAgIC8vIEFkZCBoaXN0b3J5XHJcbiAgICAgICAgICAgIHdpbmRvdy5oaXN0b3J5LnB1c2hTdGF0ZSh7IHJvdXRlOiBwYWdlLm9wdGlvbnMucm91dGUgfSwgcGFnZS5vcHRpb25zLnRpdGxlLCBwYWdlLm9wdGlvbnMucm91dGUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQ2FsbGJhY2tcclxuICAgICAgICBpZiAodHlwZW9mKGNhbGxiYWNrKSA9PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgIGNhbGxiYWNrKHBhZ2UpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBJbml0IG1ldGhvZFxyXG4gICAgdmFyIG9iaiA9IGZ1bmN0aW9uKHJvdXRlLCBtaXhlZCkge1xyXG5cclxuICAgICAgICAvLyBDcmVhdGUgcGFnZSBjb250YWluZXJcclxuICAgICAgICBpZiAoISBjb250YWluZXIpIHtcclxuICAgICAgICAgICAgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBhZ2VzJyk7XHJcbiAgICAgICAgICAgIGlmICghIGNvbnRhaW5lcikge1xyXG4gICAgICAgICAgICAgICAgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgICAgICBjb250YWluZXIuY2xhc3NOYW1lID0gJ3BhZ2VzJztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gQXBwZW5kIGNvbnRhaW5lciB0byB0aGUgYXBwbGljYXRpb25cclxuICAgICAgICAgICAgaWYgKGpTdWl0ZXMuZWwpIHtcclxuICAgICAgICAgICAgICAgIGpTdWl0ZXMuZWwuYXBwZW5kQ2hpbGQoY29udGFpbmVyKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoY29udGFpbmVyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCEgb2JqLnBhZ2VzW3JvdXRlXSkge1xyXG4gICAgICAgICAgICBpZiAoISByb3V0ZSkge1xyXG4gICAgICAgICAgICAgICAgYWxlcnQoJ0Vycm9yLCBubyByb3V0ZSBwcm92aWRlZCcpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZihtaXhlZCkgPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBvcHRpb25zID0ge307XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNhbGxiYWNrID0gbWl4ZWQ7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFBhZ2Ugb3B0aW9uc1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBvcHRpb25zID0gbWl4ZWQgPyBtaXhlZCA6IHt9O1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIENsb3NlZFxyXG4gICAgICAgICAgICAgICAgb3B0aW9ucy5jbG9zZWQgPSBtaXhlZCAmJiBtaXhlZC5jbG9zZWQgPyAxIDogMDtcclxuICAgICAgICAgICAgICAgIC8vIEtlZXAgUm91dGVcclxuICAgICAgICAgICAgICAgIG9wdGlvbnMucm91dGUgPSByb3V0ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBOZXcgcGFnZSB1cmxcclxuICAgICAgICAgICAgICAgIGlmICghIG9wdGlvbnMudXJsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJvdXRlUGF0aCA9IHJvdXRlLnNwbGl0KCcjJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy51cmwgPSBqU3VpdGVzLnBhZ2VzLnBhdGggKyByb3V0ZVBhdGhbMF0gKyAnLmh0bWwnO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gVGl0bGVcclxuICAgICAgICAgICAgICAgIGlmICghIG9wdGlvbnMudGl0bGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnRpdGxlID0gJ1VudGl0bGVkJztcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBDcmVhdGUgbmV3IHBhZ2VcclxuICAgICAgICAgICAgICAgIG9iai5wYWdlc1tyb3V0ZV0gPSBjcmVhdGVQYWdlKG9wdGlvbnMsIGNhbGxiYWNrID8gY2FsbGJhY2sgOiBudWxsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIFVwZGF0ZSBjb25maWdcclxuICAgICAgICAgICAgaWYgKG1peGVkKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBIaXN0b3J5XHJcbiAgICAgICAgICAgICAgICB2YXIgaWdub3JlSGlzdG9yeSA9IDA7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZihtaXhlZCkgPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjYWxsYmFjayA9IG1peGVkO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mKG1peGVkLm9uZW50ZXIpID09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnBhZ2VzW3JvdXRlXS5vcHRpb25zLm9uZW50ZXIgPSBtaXhlZC5vbmVudGVyO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mKG1peGVkLm9ubGVhdmUpID09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnBhZ2VzW3JvdXRlXS5vcHRpb25zLm9ubGVhdmUgPSBtaXhlZC5vbmxlYXZlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gSWdub3JlIGhpc3RvcnlcclxuICAgICAgICAgICAgICAgICAgICBpZ25vcmVIaXN0b3J5ID0gbWl4ZWQuaWdub3JlSGlzdG9yeSA/IDEgOiAwOyBcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgc2hvd1BhZ2Uob2JqLnBhZ2VzW3JvdXRlXSwgaWdub3JlSGlzdG9yeSwgY2FsbGJhY2sgPyBjYWxsYmFjayA6IG51bGwpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvYmoucGFnZXMgPSB7fTtcclxuXHJcbiAgICAvLyBHZXQgcGFnZVxyXG4gICAgb2JqLmdldCA9IGZ1bmN0aW9uKHJvdXRlKSB7XHJcbiAgICAgICAgaWYgKG9iai5wYWdlc1tyb3V0ZV0pIHtcclxuICAgICAgICAgICAgcmV0dXJuIG9iai5wYWdlc1tyb3V0ZV07IFxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvYmouZ2V0Q29udGFpbmVyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIGNvbnRhaW5lcjtcclxuICAgIH1cclxuXHJcbiAgICBvYmouZGVzdHJveSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIC8vIEN1cnJlbnQgaXMgbnVsbFxyXG4gICAgICAgIGN1cnJlbnQgPSBudWxsO1xyXG4gICAgICAgIC8vIERlc3Ryb3kgY29udGFpbmVyc1xyXG4gICAgICAgIG9iai5wYWdlcyA9IHt9O1xyXG4gICAgICAgIC8vIFJlc2V0IGNvbnRhaW5lclxyXG4gICAgICAgIGlmIChjb250YWluZXIpIHtcclxuICAgICAgICAgICAgY29udGFpbmVyLmlubmVySFRNTCA9ICcnO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gb2JqO1xyXG59KSgpO1xyXG5cclxuLy8gUGF0aFxyXG5qU3VpdGVzLnBhZ2VzLnBhdGggPSAncGFnZXMnO1xyXG5cclxuLy8gUGFuZWxcclxualN1aXRlcy5wYW5lbCA9IChmdW5jdGlvbigpIHtcclxuICAgIC8vIE5vIGluaXRpYWwgcGFuZWwgZGVjbGFyZWRcclxuICAgIHZhciBwYW5lbCA9IG51bGw7XHJcblxyXG4gICAgdmFyIG9iaiA9IGZ1bmN0aW9uKHJvdXRlKSB7XHJcbiAgICAgICAgaWYgKCEgcGFuZWwpIHtcclxuICAgICAgICAgICAgb2JqLmNyZWF0ZShqU3VpdGVzLnBhZ2VzLnBhdGggKyByb3V0ZSArICcuaHRtbCcpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gU2hvdyBwYW5lbFxyXG4gICAgICAgIHBhbmVsLnN0eWxlLmRpc3BsYXkgPSAnJztcclxuXHJcbiAgICAgICAgLy8gQWRkIGFuaW1hdGlvblxyXG4gICAgICAgIGlmIChwYW5lbC5jbGFzc0xpc3QuY29udGFpbnMoJ3BhbmVsLWxlZnQnKSkge1xyXG4gICAgICAgICAgICBqU3VpdGVzLnNsaWRlTGVmdChwYW5lbCwgMSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgalN1aXRlcy5zbGlkZVJpZ2h0KHBhbmVsLCAxKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb2JqLmNyZWF0ZSA9IGZ1bmN0aW9uKHJvdXRlKSB7XHJcbiAgICAgICAgaWYgKCEgcGFuZWwpIHtcclxuICAgICAgICAgICAgLy8gQ3JlYXRlIGVsZW1lbnRcclxuICAgICAgICAgICAgcGFuZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgcGFuZWwuY2xhc3NMaXN0LmFkZCgncGFuZWwnKTtcclxuICAgICAgICAgICAgcGFuZWwuY2xhc3NMaXN0LmFkZCgncGFuZWwtbGVmdCcpO1xyXG4gICAgICAgICAgICBwYW5lbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG5cclxuICAgICAgICAgICAgLy8gQmluZCB0byB0aGUgYXBwXHJcbiAgICAgICAgICAgIGlmIChqU3VpdGVzLmVsKSB7XHJcbiAgICAgICAgICAgICAgICBqU3VpdGVzLmVsLmFwcGVuZENoaWxkKHBhbmVsKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQocGFuZWwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZW1vdGUgY29udGVudFxyXG4gICAgICAgIGlmIChyb3V0ZSkge1xyXG5cdCAgICAgICAgdmFyIHVybCA9IGpTdWl0ZXMucGFnZXMucGF0aCArIHJvdXRlICsgJy5odG1sJztcclxuXHJcbiAgICAgICAgICAgIGpTdWl0ZXMuYWpheCh7XHJcbiAgICAgICAgICAgICAgICB1cmw6IHVybCxcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBTZXQgY29udGVudFxyXG4gICAgICAgICAgICAgICAgICAgIHBhbmVsLmlubmVySFRNTCA9IHJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICAvLyBHZXQgamF2YXNjcmlwdFxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzY3JpcHQgPSBwYW5lbC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2NyaXB0Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gUnVuIHBvc3NpYmxlIGlubGluZSBzY3JpcHRzXHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzY3JpcHQubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gR2V0IHR5cGVcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHR5cGUgPSBzY3JpcHRbaV0uZ2V0QXR0cmlidXRlKCd0eXBlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghIHR5cGUgfHwgdHlwZSA9PSAndGV4dC9qYXZhc2NyaXB0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZhbChzY3JpcHRbaV0uaW5uZXJIVE1MKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9iai5jbG9zZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGlmIChwYW5lbCkge1xyXG4gICAgICAgICAgICAvLyBBbmltYXRpb25cclxuICAgICAgICAgICAgaWYgKHBhbmVsLmNsYXNzTGlzdC5jb250YWlucygncGFuZWwtbGVmdCcpKSB7XHJcbiAgICAgICAgICAgICAgICBqU3VpdGVzLnNsaWRlTGVmdChwYW5lbCwgMCwgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGFuZWwuc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgalN1aXRlcy5zbGlkZVJpZ2h0KHBhbmVsLCAwLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICBwYW5lbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb2JqLmdldCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBwYW5lbDtcclxuICAgIH1cclxuXHJcbiAgICBvYmouZGVzdHJveSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHBhbmVsLnJlbW92ZSgpO1xyXG4gICAgICAgIHBhbmVsID0gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gb2JqO1xyXG59KSgpO1xyXG5cclxualN1aXRlcy50b29sYmFyID0gKGZ1bmN0aW9uKGVsLCBvcHRpb25zKSB7XHJcbiAgICB2YXIgb2JqID0ge307XHJcbiAgICBvYmoub3B0aW9ucyA9IG9wdGlvbnM7XHJcblxyXG4gICAgb2JqLnNlbGVjdEl0ZW0gPSBmdW5jdGlvbihlbGVtZW50KSB7XHJcbiAgICAgICAgdmFyIGVsZW1lbnRzID0gdG9vbGJhckNvbnRlbnQuY2hpbGRyZW47XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbGVtZW50cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBlbGVtZW50c1tpXS5jbGFzc0xpc3QucmVtb3ZlKCdzZWxlY3RlZCcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGVkJyk7XHJcbiAgICB9XHJcblxyXG4gICAgb2JqLmhpZGUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBqU3VpdGVzLnNsaWRlQm90dG9tKHRvb2xiYXIsIDAsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB0b29sYmFyLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgb2JqLnNob3cgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICB0b29sYmFyLnN0eWxlLmRpc3BsYXkgPSAnJztcclxuICAgICAgICBqU3VpdGVzLnNsaWRlQm90dG9tKHRvb2xiYXIsIDEpO1xyXG4gICAgfVxyXG5cclxuICAgIG9iai5nZXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gdG9vbGJhcjtcclxuICAgIH1cclxuXHJcbiAgICBvYmouc2V0QmFkZ2UgPSBmdW5jdGlvbihpbmRleCwgdmFsdWUpIHtcclxuICAgICAgICB0b29sYmFyQ29udGVudC5jaGlsZHJlbltpbmRleF0uY2hpbGRyZW5bMV0uZmlyc3RDaGlsZC5pbm5lckhUTUwgPSB2YWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICBvYmouZGVzdHJveSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHRvb2xiYXIucmVtb3ZlKCk7XHJcbiAgICAgICAgdG9vbGJhciA9IG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIHRvb2xiYXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgIHRvb2xiYXIuY2xhc3NMaXN0LmFkZCgnanRvb2xiYXInKTtcclxuICAgIHRvb2xiYXIub25jbGljayA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICB2YXIgZWxlbWVudCA9IGpTdWl0ZXMuZ2V0RWxlbWVudChlLnRhcmdldCwgJ2p0b29sYmFyLWl0ZW0nKTtcclxuICAgICAgICBpZiAoZWxlbWVudCkge1xyXG4gICAgICAgICAgICBvYmouc2VsZWN0SXRlbShlbGVtZW50KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIHRvb2xiYXJDb250ZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICB0b29sYmFyLmFwcGVuZENoaWxkKHRvb2xiYXJDb250ZW50KTtcclxuXHJcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9wdGlvbnMuaXRlbXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICB2YXIgdG9vbGJhckl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICB0b29sYmFySXRlbS5jbGFzc0xpc3QuYWRkKCdqdG9vbGJhci1pdGVtJyk7XHJcbiAgICAgICAgaWYgKG9wdGlvbnMuaXRlbXNbaV0ucm91dGUpIHtcclxuICAgICAgICAgICAgdG9vbGJhckl0ZW0uc2V0QXR0cmlidXRlKCdkYXRhLWhyZWYnLCBvcHRpb25zLml0ZW1zW2ldLnJvdXRlKTtcclxuICAgICAgICAgICAgalN1aXRlcy5wYWdlcyhvcHRpb25zLml0ZW1zW2ldLnJvdXRlLCB7XHJcbiAgICAgICAgICAgICAgICBjbG9zZWQ6IHRydWUsXHJcbiAgICAgICAgICAgICAgICBvbmVudGVyOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmouc2VsZWN0SXRlbSh0b29sYmFySXRlbSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKG9wdGlvbnMuaXRlbXNbaV0uaWNvbikge1xyXG4gICAgICAgICAgICB2YXIgdG9vbGJhckljb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpJyk7XHJcbiAgICAgICAgICAgIHRvb2xiYXJJY29uLmNsYXNzTGlzdC5hZGQoJ21hdGVyaWFsLWljb25zJyk7XHJcbiAgICAgICAgICAgIHRvb2xiYXJJY29uLmlubmVySFRNTCA9IG9wdGlvbnMuaXRlbXNbaV0uaWNvbjtcclxuICAgICAgICAgICAgdG9vbGJhckl0ZW0uYXBwZW5kQ2hpbGQodG9vbGJhckljb24pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIHRvb2xiYXJCYWRnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgIHRvb2xiYXJCYWRnZS5jbGFzc0xpc3QuYWRkKCdqYmFkZ2UnKTtcclxuICAgICAgICB2YXIgdG9vbGJhckJhZGdlQ29udGVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgIHRvb2xiYXJCYWRnZUNvbnRlbnQuaW5uZXJIVE1MID0gb3B0aW9ucy5pdGVtc1tpXS5iYWRnZSA/IG9wdGlvbnMuaXRlbXNbaV0uYmFkZ2UgOiAnJztcclxuICAgICAgICB0b29sYmFyQmFkZ2UuYXBwZW5kQ2hpbGQodG9vbGJhckJhZGdlQ29udGVudCk7XHJcbiAgICAgICAgdG9vbGJhckl0ZW0uYXBwZW5kQ2hpbGQodG9vbGJhckJhZGdlKTtcclxuXHJcbiAgICAgICAgaWYgKG9wdGlvbnMuaXRlbXNbaV0udGl0bGUpIHtcclxuICAgICAgICAgICAgdmFyIHRvb2xiYXJUaXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcclxuICAgICAgICAgICAgdG9vbGJhclRpdGxlLmlubmVySFRNTCA9IG9wdGlvbnMuaXRlbXNbaV0udGl0bGU7XHJcbiAgICAgICAgICAgIHRvb2xiYXJJdGVtLmFwcGVuZENoaWxkKHRvb2xiYXJUaXRsZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0b29sYmFyQ29udGVudC5hcHBlbmRDaGlsZCh0b29sYmFySXRlbSk7XHJcbiAgICB9XHJcblxyXG4gICAgZWwudG9vbGJhciA9IG9iajtcclxuXHJcbiAgICBlbC5hcHBlbmRDaGlsZCh0b29sYmFyKTtcclxuXHJcbiAgICByZXR1cm4gb2JqO1xyXG59KTtcclxuXHJcbmpTdWl0ZXMuYWN0aW9uc2hlZXQgPSAoZnVuY3Rpb24oKSB7XHJcbiAgICB2YXIgYWN0aW9uc2hlZXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgIGFjdGlvbnNoZWV0LmNsYXNzTmFtZSA9ICdqYWN0aW9uc2hlZXQnO1xyXG4gICAgYWN0aW9uc2hlZXQuc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuXHJcbiAgICB2YXIgYWN0aW9uQ29udGVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgYWN0aW9uQ29udGVudC5jbGFzc05hbWUgPSAnamFjdGlvbnNoZWV0LWNvbnRlbnQnO1xyXG4gICAgYWN0aW9uc2hlZXQuYXBwZW5kQ2hpbGQoYWN0aW9uQ29udGVudCk7XHJcblxyXG4gICAgdmFyIG9iaiA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcclxuICAgICAgICBpZiAob3B0aW9ucykge1xyXG4gICAgICAgICAgICBvYmoub3B0aW9ucyA9IG9wdGlvbnM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZXNldCBjb250YWluZXJcclxuICAgICAgICBhY3Rpb25Db250ZW50LmlubmVySFRNTCA9ICcnO1xyXG5cclxuICAgICAgICAvLyBDcmVhdGUgbmV3IGVsZW1lbnRzXHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvYmoub3B0aW9ucy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICB2YXIgYWN0aW9uR3JvdXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgYWN0aW9uR3JvdXAuY2xhc3NOYW1lID0gJ2phY3Rpb25zaGVldC1ncm91cCc7XHJcblxyXG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG9iai5vcHRpb25zW2ldLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdiA9IG9iai5vcHRpb25zW2ldW2pdO1xyXG4gICAgICAgICAgICAgICAgdmFyIGFjdGlvbkl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgICAgIHZhciBhY3Rpb25JbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XHJcbiAgICAgICAgICAgICAgICBhY3Rpb25JbnB1dC50eXBlID0gJ2J1dHRvbic7XHJcbiAgICAgICAgICAgICAgICBhY3Rpb25JbnB1dC52YWx1ZSA9IHYudGl0bGU7XHJcbiAgICAgICAgICAgICAgICBpZiAodi5jbGFzc05hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBhY3Rpb25JbnB1dC5jbGFzc05hbWUgPSB2LmNsYXNzTmFtZTsgXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodi5vbmNsaWNrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uSW5wdXQub25jbGljayA9IHYub25jbGljazsgXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodi5hY3Rpb24gPT0gJ2NhbmNlbCcpIHtcclxuICAgICAgICAgICAgICAgICAgICBhY3Rpb25JbnB1dC5zdHlsZS5jb2xvciA9ICdyZWQnO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgYWN0aW9uSXRlbS5hcHBlbmRDaGlsZChhY3Rpb25JbnB1dCk7XHJcbiAgICAgICAgICAgICAgICBhY3Rpb25Hcm91cC5hcHBlbmRDaGlsZChhY3Rpb25JdGVtKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgYWN0aW9uQ29udGVudC5hcHBlbmRDaGlsZChhY3Rpb25Hcm91cCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBTaG93XHJcbiAgICAgICAgYWN0aW9uc2hlZXQuc3R5bGUuZGlzcGxheSA9ICcnO1xyXG5cclxuICAgICAgICAvLyBBcHBlbmRcclxuICAgICAgICBqU3VpdGVzLmVsLmFwcGVuZENoaWxkKGFjdGlvbnNoZWV0KTtcclxuXHJcbiAgICAgICAgLy8gQW5pbWF0aW9uXHJcbiAgICAgICAgalN1aXRlcy5zbGlkZUJvdHRvbShhY3Rpb25Db250ZW50LCB0cnVlKTtcclxuICAgIH1cclxuXHJcbiAgICBvYmouY2xvc2UgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiAoYWN0aW9uc2hlZXQuc3R5bGUuZGlzcGxheSAhPSAnbm9uZScpIHtcclxuICAgICAgICAgICAgLy8gUmVtb3ZlIGFueSBleGlzdGluZyBhY3Rpb25zaGVldFxyXG4gICAgICAgICAgICBqU3VpdGVzLnNsaWRlQm90dG9tKGFjdGlvbkNvbnRlbnQsIGZhbHNlLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIGFjdGlvbnNoZWV0LnJlbW92ZSgpO1xyXG4gICAgICAgICAgICAgICAgYWN0aW9uc2hlZXQuc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHZhciBtb3VzZVVwID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgIG9iai5jbG9zZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGFjdGlvbnNoZWV0LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBtb3VzZVVwKTtcclxuXHJcbiAgICBvYmoub3B0aW9ucyA9IHt9O1xyXG5cclxuICAgIHJldHVybiBvYmo7XHJcbn0pKCk7XHJcblxyXG4vKipcclxuICogKGMpIGpTdWl0ZXMgbW9kYWxcclxuICogaHR0cHM6Ly9naXRodWIuY29tL3BhdWxob2RlbC9qc3VpdGVzXHJcbiAqXHJcbiAqIEBhdXRob3I6IFBhdWwgSG9kZWwgPHBhdWwuaG9kZWxAZ21haWwuY29tPlxyXG4gKiBAZGVzY3JpcHRpb246IE1vZGFsXHJcbiAqL1xyXG5cclxualN1aXRlcy5tb2RhbCA9IChmdW5jdGlvbihlbCwgb3B0aW9ucykge1xyXG4gICAgdmFyIG9iaiA9IHt9O1xyXG4gICAgb2JqLm9wdGlvbnMgPSB7fTtcclxuXHJcbiAgICAvLyBEZWZhdWx0IGNvbmZpZ3VyYXRpb25cclxuICAgIHZhciBkZWZhdWx0cyA9IHtcclxuICAgICAgICB1cmw6IG51bGwsXHJcbiAgICAgICAgb25vcGVuOiBudWxsLFxyXG4gICAgICAgIG9uY2xvc2U6IG51bGwsXHJcbiAgICAgICAgY2xvc2VkOiBmYWxzZSxcclxuICAgICAgICB3aWR0aDogbnVsbCxcclxuICAgICAgICBoZWlnaHQ6IG51bGwsXHJcbiAgICAgICAgdGl0bGU6IG51bGwsXHJcbiAgICB9O1xyXG5cclxuICAgIC8vIExvb3AgdGhyb3VnaCBvdXIgb2JqZWN0XHJcbiAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBkZWZhdWx0cykge1xyXG4gICAgICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuaGFzT3duUHJvcGVydHkocHJvcGVydHkpKSB7XHJcbiAgICAgICAgICAgIG9iai5vcHRpb25zW3Byb3BlcnR5XSA9IG9wdGlvbnNbcHJvcGVydHldO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIG9iai5vcHRpb25zW3Byb3BlcnR5XSA9IGRlZmF1bHRzW3Byb3BlcnR5XTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVGl0bGVcclxuICAgIGlmICghIG9iai5vcHRpb25zLnRpdGxlICYmIGVsLmdldEF0dHJpYnV0ZSgndGl0bGUnKSkge1xyXG4gICAgICAgIG9iai5vcHRpb25zLnRpdGxlID0gZWwuZ2V0QXR0cmlidXRlKCd0aXRsZScpO1xyXG4gICAgfVxyXG5cclxuICAgIHZhciB0ZW1wID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVsLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgdGVtcC5hcHBlbmRDaGlsZChlbC5jaGlsZHJlbltpXSk7XHJcbiAgICB9XHJcblxyXG4gICAgb2JqLmNvbnRlbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgIG9iai5jb250ZW50LmNsYXNzTmFtZSA9ICdqbW9kYWxfY29udGVudCc7XHJcbiAgICBvYmouY29udGVudC5pbm5lckhUTUwgPSBlbC5pbm5lckhUTUw7XHJcblxyXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0ZW1wLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgb2JqLmNvbnRlbnQuYXBwZW5kQ2hpbGQodGVtcC5jaGlsZHJlbltpXSk7XHJcbiAgICB9XHJcblxyXG4gICAgb2JqLmNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgb2JqLmNvbnRhaW5lci5jbGFzc05hbWUgPSAnam1vZGFsJztcclxuICAgIG9iai5jb250YWluZXIuYXBwZW5kQ2hpbGQob2JqLmNvbnRlbnQpO1xyXG5cclxuICAgIGlmIChvYmoub3B0aW9ucy53aWR0aCkge1xyXG4gICAgICAgIG9iai5jb250YWluZXIuc3R5bGUud2lkdGggPSBvYmoub3B0aW9ucy53aWR0aDtcclxuICAgIH1cclxuICAgIGlmIChvYmoub3B0aW9ucy5oZWlnaHQpIHtcclxuICAgICAgICBvYmouY29udGFpbmVyLnN0eWxlLmhlaWdodCA9IG9iai5vcHRpb25zLmhlaWdodDtcclxuICAgIH1cclxuICAgIGlmIChvYmoub3B0aW9ucy50aXRsZSkge1xyXG4gICAgICAgIG9iai5jb250YWluZXIuc2V0QXR0cmlidXRlKCd0aXRsZScsIG9iai5vcHRpb25zLnRpdGxlKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgb2JqLmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCduby10aXRsZScpO1xyXG4gICAgfVxyXG4gICAgZWwuaW5uZXJIVE1MID0gJyc7XHJcbiAgICBlbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG4gICAgZWwuYXBwZW5kQ2hpbGQob2JqLmNvbnRhaW5lcik7XHJcblxyXG4gICAgLy8gQmFja2Ryb3BcclxuICAgIHZhciBiYWNrZHJvcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgYmFja2Ryb3AuY2xhc3NOYW1lID0gJ2ptb2RhbF9iYWNrZHJvcCc7XHJcbiAgICBlbC5hcHBlbmRDaGlsZChiYWNrZHJvcCk7XHJcblxyXG4gICAgb2JqLm9wZW4gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBlbC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcclxuICAgICAgICAvLyBGdWxsc2NyZWVuXHJcbiAgICAgICAgY29uc3QgcmVjdCA9IG9iai5jb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICAgICAgaWYgKGpTdWl0ZXMuZ2V0V2luZG93V2lkdGgoKSA8IHJlY3Qud2lkdGgpIHtcclxuICAgICAgICAgICAgb2JqLmNvbnRhaW5lci5zdHlsZS50b3AgPSAnJztcclxuICAgICAgICAgICAgb2JqLmNvbnRhaW5lci5zdHlsZS5sZWZ0ID0gJyc7XHJcbiAgICAgICAgICAgIG9iai5jb250YWluZXIuY2xhc3NMaXN0LmFkZCgnam1vZGFsX2Z1bGxzY3JlZW4nKTtcclxuICAgICAgICAgICAgalN1aXRlcy5zbGlkZUJvdHRvbShvYmouY29udGFpbmVyLCAxKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBiYWNrZHJvcC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gQ3VycmVudFxyXG4gICAgICAgIGpTdWl0ZXMubW9kYWwuY3VycmVudCA9IG9iajtcclxuICAgICAgICAvLyBFdmVudFxyXG4gICAgICAgIGlmICh0eXBlb2Yob2JqLm9wdGlvbnMub25vcGVuKSA9PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgIG9iai5vcHRpb25zLm9ub3BlbihlbCwgb2JqKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb2JqLnJlc2V0UG9zaXRpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBvYmouY29udGFpbmVyLnN0eWxlLnRvcCA9ICcnO1xyXG4gICAgICAgIG9iai5jb250YWluZXIuc3R5bGUubGVmdCA9ICcnO1xyXG4gICAgfVxyXG5cclxuICAgIG9iai5pc09wZW4gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gZWwuc3R5bGUuZGlzcGxheSAhPSAnbm9uZScgPyB0cnVlIDogZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgb2JqLmNsb3NlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgZWwuc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICAgICAgICAvLyBCYWNrZHJvcFxyXG4gICAgICAgIGJhY2tkcm9wLnN0eWxlLmRpc3BsYXkgPSAnJztcclxuICAgICAgICAvLyBDdXJyZW50XHJcbiAgICAgICAgalN1aXRlcy5tb2RhbC5jdXJyZW50ID0gbnVsbDtcclxuICAgICAgICAvLyBSZW1vdmUgZnVsbHNjcmVlbiBjbGFzc1xyXG4gICAgICAgIG9iai5jb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgnam1vZGFsX2Z1bGxzY3JlZW4nKTtcclxuICAgICAgICAvLyBFdmVudFxyXG4gICAgICAgIGlmICh0eXBlb2Yob2JqLm9wdGlvbnMub25jbG9zZSkgPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICBvYmoub3B0aW9ucy5vbmNsb3NlKGVsLCBvYmopO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpZiAoISBqU3VpdGVzLm1vZGFsLmhhc0V2ZW50cykge1xyXG4gICAgICAgIGpTdWl0ZXMubW9kYWwuY3VycmVudCA9IG9iajtcclxuXHJcbiAgICAgICAgaWYgKCdvbnRvdWNoc3RhcnQnIGluIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hzdGFydFwiLCBqU3VpdGVzLm1vZGFsLm1vdXNlRG93bkNvbnRyb2xzKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBqU3VpdGVzLm1vZGFsLm1vdXNlRG93bkNvbnRyb2xzKTtcclxuICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgalN1aXRlcy5tb2RhbC5tb3VzZU1vdmVDb250cm9scyk7XHJcbiAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBqU3VpdGVzLm1vZGFsLm1vdXNlVXBDb250cm9scyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgalN1aXRlcy5tb2RhbC5rZXlEb3duQ29udHJvbHMpO1xyXG5cclxuICAgICAgICBqU3VpdGVzLm1vZGFsLmhhc0V2ZW50cyA9IHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKG9iai5vcHRpb25zLnVybCkge1xyXG4gICAgICAgIGpTdWl0ZXMuYWpheCh7XHJcbiAgICAgICAgICAgIHVybDogb2JqLm9wdGlvbnMudXJsLFxyXG4gICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICBvYmouY29udGVudC5pbm5lckhUTUwgPSBkYXRhO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICghIG9iai5vcHRpb25zLmNsb3NlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5vcGVuKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgaWYgKCEgb2JqLm9wdGlvbnMuY2xvc2VkKSB7XHJcbiAgICAgICAgICAgIG9iai5vcGVuKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIEtlZXAgb2JqZWN0IGF2YWlsYWJsZSBmcm9tIHRoZSBub2RlXHJcbiAgICBlbC5tb2RhbCA9IG9iajtcclxuXHJcbiAgICByZXR1cm4gb2JqO1xyXG59KTtcclxuXHJcbmpTdWl0ZXMubW9kYWwuY3VycmVudCA9IG51bGw7XHJcbmpTdWl0ZXMubW9kYWwucG9zaXRpb24gPSBudWxsO1xyXG5cclxualN1aXRlcy5tb2RhbC5rZXlEb3duQ29udHJvbHMgPSBmdW5jdGlvbihlKSB7XHJcbiAgICBpZiAoZS53aGljaCA9PSAyNykge1xyXG4gICAgICAgIGlmIChqU3VpdGVzLm1vZGFsLmN1cnJlbnQpIHtcclxuICAgICAgICAgICAgalN1aXRlcy5tb2RhbC5jdXJyZW50LmNsb3NlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5qU3VpdGVzLm1vZGFsLm1vdXNlVXBDb250cm9scyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgIGlmIChqU3VpdGVzLm1vZGFsLmN1cnJlbnQpIHtcclxuICAgICAgICBqU3VpdGVzLm1vZGFsLmN1cnJlbnQuY29udGFpbmVyLnN0eWxlLmN1cnNvciA9ICdhdXRvJztcclxuICAgIH1cclxuICAgIGpTdWl0ZXMubW9kYWwucG9zaXRpb24gPSBudWxsO1xyXG59XHJcblxyXG5qU3VpdGVzLm1vZGFsLm1vdXNlTW92ZUNvbnRyb2xzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgaWYgKGpTdWl0ZXMubW9kYWwuY3VycmVudCAmJiBqU3VpdGVzLm1vZGFsLnBvc2l0aW9uKSB7XHJcbiAgICAgICAgaWYgKGUud2hpY2ggPT0gMSB8fCBlLndoaWNoID09IDMpIHtcclxuICAgICAgICAgICAgdmFyIHBvc2l0aW9uID0galN1aXRlcy5tb2RhbC5wb3NpdGlvbjtcclxuICAgICAgICAgICAgalN1aXRlcy5tb2RhbC5jdXJyZW50LmNvbnRhaW5lci5zdHlsZS50b3AgPSAocG9zaXRpb25bMV0gKyAoZS5jbGllbnRZIC0gcG9zaXRpb25bM10pICsgKHBvc2l0aW9uWzVdIC8gMikpICsgJ3B4JztcclxuICAgICAgICAgICAgalN1aXRlcy5tb2RhbC5jdXJyZW50LmNvbnRhaW5lci5zdHlsZS5sZWZ0ID0gKHBvc2l0aW9uWzBdICsgKGUuY2xpZW50WCAtIHBvc2l0aW9uWzJdKSArIChwb3NpdGlvbls0XSAvIDIpKSArICdweCc7XHJcbiAgICAgICAgICAgIGpTdWl0ZXMubW9kYWwuY3VycmVudC5jb250YWluZXIuc3R5bGUuY3Vyc29yID0gJ21vdmUnO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGpTdWl0ZXMubW9kYWwuY3VycmVudC5jb250YWluZXIuc3R5bGUuY3Vyc29yID0gJ2F1dG8nO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxualN1aXRlcy5tb2RhbC5tb3VzZURvd25Db250cm9scyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgIGpTdWl0ZXMubW9kYWwucG9zaXRpb24gPSBbXTtcclxuXHJcbiAgICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqbW9kYWwnKSkge1xyXG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIC8vIEdldCB0YXJnZXQgaW5mb1xyXG4gICAgICAgICAgICB2YXIgcmVjdCA9IGUudGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGUuY2hhbmdlZFRvdWNoZXMgJiYgZS5jaGFuZ2VkVG91Y2hlc1swXSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHggPSBlLmNoYW5nZWRUb3VjaGVzWzBdLmNsaWVudFg7XHJcbiAgICAgICAgICAgICAgICB2YXIgeSA9IGUuY2hhbmdlZFRvdWNoZXNbMF0uY2xpZW50WTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHZhciB4ID0gZS5jbGllbnRYO1xyXG4gICAgICAgICAgICAgICAgdmFyIHkgPSBlLmNsaWVudFk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChyZWN0LndpZHRoIC0gKHggLSByZWN0LmxlZnQpIDwgNTAgJiYgKHkgLSByZWN0LnRvcCkgPCA1MCkge1xyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICBqU3VpdGVzLm1vZGFsLmN1cnJlbnQuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgIH0sIDEwMCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXQuZ2V0QXR0cmlidXRlKCd0aXRsZScpICYmICh5IC0gcmVjdC50b3ApIDwgNTApIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZG9jdW1lbnQuc2VsZWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LnNlbGVjdGlvbi5lbXB0eSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIHdpbmRvdy5nZXRTZWxlY3Rpb24gKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5yZW1vdmVBbGxSYW5nZXMoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGpTdWl0ZXMubW9kYWwucG9zaXRpb24gPSBbXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlY3QubGVmdCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVjdC50b3AsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGUuY2xpZW50WCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZS5jbGllbnRZLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWN0LndpZHRoLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWN0LmhlaWdodCxcclxuICAgICAgICAgICAgICAgICAgICBdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSwgMTAwKTtcclxuICAgIH1cclxufVxyXG5cclxuXHJcbmpTdWl0ZXMubm90aWZpY2F0aW9uID0gKGZ1bmN0aW9uKG9wdGlvbnMpIHtcclxuICAgIHZhciBvYmogPSB7fTtcclxuICAgIG9iai5vcHRpb25zID0ge307XHJcblxyXG4gICAgLy8gRGVmYXVsdCBjb25maWd1cmF0aW9uXHJcbiAgICB2YXIgZGVmYXVsdHMgPSB7XHJcbiAgICAgICAgaWNvbjogbnVsbCxcclxuICAgICAgICBuYW1lOiAnTm90aWZpY2F0aW9uJyxcclxuICAgICAgICBkYXRlOiBudWxsLFxyXG4gICAgICAgIHRpdGxlOiBudWxsLFxyXG4gICAgICAgIG1lc3NhZ2U6IG51bGwsXHJcbiAgICAgICAgdGltZW91dDogNDAwMCxcclxuICAgICAgICBhdXRvSGlkZTogdHJ1ZSxcclxuICAgICAgICBjbG9zZWFibGU6IHRydWUsXHJcbiAgICB9O1xyXG5cclxuICAgIC8vIExvb3AgdGhyb3VnaCBvdXIgb2JqZWN0XHJcbiAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBkZWZhdWx0cykge1xyXG4gICAgICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuaGFzT3duUHJvcGVydHkocHJvcGVydHkpKSB7XHJcbiAgICAgICAgICAgIG9iai5vcHRpb25zW3Byb3BlcnR5XSA9IG9wdGlvbnNbcHJvcGVydHldO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIG9iai5vcHRpb25zW3Byb3BlcnR5XSA9IGRlZmF1bHRzW3Byb3BlcnR5XTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIG5vdGlmaWNhdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgbm90aWZpY2F0aW9uLmNsYXNzTmFtZSA9ICdqbm90aWZpY2F0aW9uJztcclxuXHJcbiAgICB2YXIgbm90aWZpY2F0aW9uQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICBub3RpZmljYXRpb25Db250YWluZXIuY2xhc3NOYW1lID0gJ2pub3RpZmljYXRpb24tY29udGFpbmVyJztcclxuICAgIG5vdGlmaWNhdGlvbi5hcHBlbmRDaGlsZChub3RpZmljYXRpb25Db250YWluZXIpO1xyXG5cclxuICAgIHZhciBub3RpZmljYXRpb25IZWFkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgIG5vdGlmaWNhdGlvbkhlYWRlci5jbGFzc05hbWUgPSAnam5vdGlmaWNhdGlvbi1oZWFkZXInO1xyXG4gICAgbm90aWZpY2F0aW9uQ29udGFpbmVyLmFwcGVuZENoaWxkKG5vdGlmaWNhdGlvbkhlYWRlcik7XHJcblxyXG4gICAgdmFyIG5vdGlmaWNhdGlvbkltYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICBub3RpZmljYXRpb25JbWFnZS5jbGFzc05hbWUgPSAnam5vdGlmaWNhdGlvbi1pbWFnZSc7XHJcbiAgICBub3RpZmljYXRpb25IZWFkZXIuYXBwZW5kQ2hpbGQobm90aWZpY2F0aW9uSW1hZ2UpO1xyXG5cclxuICAgIGlmIChvYmoub3B0aW9ucy5pY29uKSB7XHJcbiAgICAgICAgdmFyIG5vdGlmaWNhdGlvbkljb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcclxuICAgICAgICBub3RpZmljYXRpb25JY29uLnNyYyA9IG9iai5vcHRpb25zLmljb247XHJcbiAgICAgICAgbm90aWZpY2F0aW9uSW1hZ2UuYXBwZW5kQ2hpbGQobm90aWZpY2F0aW9uSWNvbik7XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIG5vdGlmaWNhdGlvbk5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgIG5vdGlmaWNhdGlvbk5hbWUuY2xhc3NOYW1lID0gJ2pub3RpZmljYXRpb24tbmFtZSc7XHJcbiAgICBub3RpZmljYXRpb25OYW1lLmlubmVySFRNTCA9IG9iai5vcHRpb25zLm5hbWU7XHJcbiAgICBub3RpZmljYXRpb25IZWFkZXIuYXBwZW5kQ2hpbGQobm90aWZpY2F0aW9uTmFtZSk7XHJcblxyXG4gICAgaWYgKG9iai5vcHRpb25zLmNsb3NlYWJsZSA9PSB0cnVlKSB7XHJcbiAgICAgICAgdmFyIG5vdGlmaWNhdGlvbkNsb3NlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgbm90aWZpY2F0aW9uQ2xvc2UuY2xhc3NOYW1lID0gJ2pub3RpZmljYXRpb24tY2xvc2UnO1xyXG4gICAgICAgIG5vdGlmaWNhdGlvbkNsb3NlLm9uY2xpY2sgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgb2JqLmhpZGUoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbm90aWZpY2F0aW9uSGVhZGVyLmFwcGVuZENoaWxkKG5vdGlmaWNhdGlvbkNsb3NlKTtcclxuICAgIH1cclxuXHJcbiAgICB2YXIgbm90aWZpY2F0aW9uRGF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgbm90aWZpY2F0aW9uRGF0ZS5jbGFzc05hbWUgPSAnam5vdGlmaWNhdGlvbi1kYXRlJztcclxuICAgIG5vdGlmaWNhdGlvbkhlYWRlci5hcHBlbmRDaGlsZChub3RpZmljYXRpb25EYXRlKTtcclxuXHJcbiAgICB2YXIgbm90aWZpY2F0aW9uQ29udGVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgbm90aWZpY2F0aW9uQ29udGVudC5jbGFzc05hbWUgPSAnam5vdGlmaWNhdGlvbi1jb250ZW50JztcclxuICAgIG5vdGlmaWNhdGlvbkNvbnRhaW5lci5hcHBlbmRDaGlsZChub3RpZmljYXRpb25Db250ZW50KTtcclxuXHJcbiAgICBpZiAob2JqLm9wdGlvbnMudGl0bGUpIHtcclxuICAgICAgICB2YXIgbm90aWZpY2F0aW9uVGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICBub3RpZmljYXRpb25UaXRsZS5jbGFzc05hbWUgPSAnam5vdGlmaWNhdGlvbi10aXRsZSc7XHJcbiAgICAgICAgbm90aWZpY2F0aW9uVGl0bGUuaW5uZXJIVE1MID0gb2JqLm9wdGlvbnMudGl0bGU7XHJcbiAgICAgICAgbm90aWZpY2F0aW9uQ29udGVudC5hcHBlbmRDaGlsZChub3RpZmljYXRpb25UaXRsZSk7XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIG5vdGlmaWNhdGlvbk1lc3NhZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgIG5vdGlmaWNhdGlvbk1lc3NhZ2UuY2xhc3NOYW1lID0gJ2pub3RpZmljYXRpb24tbWVzc2FnZSc7XHJcbiAgICBub3RpZmljYXRpb25NZXNzYWdlLmlubmVySFRNTCA9IG9iai5vcHRpb25zLm1lc3NhZ2U7XHJcbiAgICBub3RpZmljYXRpb25Db250ZW50LmFwcGVuZENoaWxkKG5vdGlmaWNhdGlvbk1lc3NhZ2UpO1xyXG5cclxuICAgIG9iai5zaG93ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChub3RpZmljYXRpb24pO1xyXG4gICAgICAgIGlmIChqU3VpdGVzLmdldFdpbmRvd1dpZHRoKCkgPiA4MDApIHsgXHJcbiAgICAgICAgICAgIGpTdWl0ZXMuZmFkZUluKG5vdGlmaWNhdGlvbik7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgalN1aXRlcy5zbGlkZVRvcChub3RpZmljYXRpb24sIDEpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvYmouaGlkZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGlmIChqU3VpdGVzLmdldFdpbmRvd1dpZHRoKCkgPiA4MDApIHsgXHJcbiAgICAgICAgICAgIGpTdWl0ZXMuZmFkZU91dChub3RpZmljYXRpb24sIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobm90aWZpY2F0aW9uKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgalN1aXRlcy5zbGlkZVRvcChub3RpZmljYXRpb24sIDAsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobm90aWZpY2F0aW9uKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBvYmouc2hvdygpO1xyXG5cclxuICAgIGlmIChvYmoub3B0aW9ucy5hdXRvSGlkZSA9PSB0cnVlKSB7XHJcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgb2JqLmhpZGUoKTtcclxuICAgICAgICB9LCBvYmoub3B0aW9ucy50aW1lb3V0KTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoalN1aXRlcy5nZXRXaW5kb3dXaWR0aCgpIDwgODAwKSB7XHJcbiAgICAgICAgbm90aWZpY2F0aW9uLmFkZEV2ZW50TGlzdGVuZXIoXCJzd2lwZXVwXCIsIGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgb2JqLmhpZGUoKTtcclxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBvYmo7XHJcbn0pO1xyXG5cclxualN1aXRlcy5yYXRpbmcgPSAoZnVuY3Rpb24oZWwsIG9wdGlvbnMpIHtcclxuICAgIHZhciBvYmogPSB7fTtcclxuICAgIG9iai5vcHRpb25zID0ge307XHJcblxyXG4gICAgLy8gRGVmYXVsdCBjb25maWd1cmF0aW9uXHJcbiAgICB2YXIgZGVmYXVsdHMgPSB7XHJcbiAgICAgICAgbnVtYmVyOiA1LFxyXG4gICAgICAgIHZhbHVlOiAwLFxyXG4gICAgICAgIHRvb2x0aXA6IFsgJ1ZlcnkgYmFkJywgJ0JhZCcsICdBdmVyYWdlJywgJ0dvb2QnLCAnVmVyeSBnb29kJyBdLFxyXG4gICAgICAgIG9uY2hhbmdlOiBudWxsLFxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBMb29wIHRocm91Z2ggdGhlIGluaXRpYWwgY29uZmlndXJhdGlvblxyXG4gICAgZm9yICh2YXIgcHJvcGVydHkgaW4gZGVmYXVsdHMpIHtcclxuICAgICAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmhhc093blByb3BlcnR5KHByb3BlcnR5KSkge1xyXG4gICAgICAgICAgICBvYmoub3B0aW9uc1twcm9wZXJ0eV0gPSBvcHRpb25zW3Byb3BlcnR5XTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBvYmoub3B0aW9uc1twcm9wZXJ0eV0gPSBkZWZhdWx0c1twcm9wZXJ0eV07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIENsYXNzXHJcbiAgICBlbC5jbGFzc0xpc3QuYWRkKCdqcmF0aW5nJyk7XHJcblxyXG4gICAgLy8gQWRkIGVsZW1lbnRzXHJcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iai5vcHRpb25zLm51bWJlcjsgaSsrKSB7XHJcbiAgICAgICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgIGRpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtaW5kZXgnLCAoaSArIDEpKVxyXG4gICAgICAgIGRpdi5zZXRBdHRyaWJ1dGUoJ3RpdGxlJywgb2JqLm9wdGlvbnMudG9vbHRpcFtpXSlcclxuICAgICAgICBlbC5hcHBlbmRDaGlsZChkaXYpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFNldCB2YWx1ZVxyXG4gICAgb2JqLnNldFZhbHVlID0gZnVuY3Rpb24oaW5kZXgpIHtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iai5vcHRpb25zLm51bWJlcjsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmIChpIDwgaW5kZXgpIHtcclxuICAgICAgICAgICAgICAgIGVsLmNoaWxkcmVuW2ldLmNsYXNzTGlzdC5hZGQoJ2pyYXRpbmctc2VsZWN0ZWQnKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGVsLmNoaWxkcmVuW2ldLmNsYXNzTGlzdC5yZW1vdmUoJ2pyYXRpbmctb3ZlcicpO1xyXG4gICAgICAgICAgICAgICAgZWwuY2hpbGRyZW5baV0uY2xhc3NMaXN0LnJlbW92ZSgnanJhdGluZy1zZWxlY3RlZCcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBvYmoub3B0aW9ucy52YWx1ZSA9IGluZGV4O1xyXG5cclxuICAgICAgICBpZiAodHlwZW9mKG9iai5vcHRpb25zLm9uY2hhbmdlKSA9PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgIG9iai5vcHRpb25zLm9uY2hhbmdlKGVsLCBpbmRleCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9iai5nZXRWYWx1ZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBvYmoub3B0aW9ucy52YWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAob2JqLm9wdGlvbnMudmFsdWUpIHtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iai5vcHRpb25zLm51bWJlcjsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmIChpIDwgb2JqLm9wdGlvbnMudmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIGVsLmNoaWxkcmVuW2ldLmNsYXNzTGlzdC5hZGQoJ2pyYXRpbmctc2VsZWN0ZWQnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBFdmVudHNcclxuICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgdmFyIGluZGV4ID0gZS50YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLWluZGV4Jyk7XHJcbiAgICAgICAgaWYgKGluZGV4ICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBpZiAoaW5kZXggPT0gb2JqLm9wdGlvbnMudmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIG9iai5zZXRWYWx1ZSgwKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIG9iai5zZXRWYWx1ZShpbmRleCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBlbC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdmVyXCIsIGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICB2YXIgaW5kZXggPSBlLnRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtaW5kZXgnKTtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iai5vcHRpb25zLm51bWJlcjsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmIChpIDwgaW5kZXgpIHtcclxuICAgICAgICAgICAgICAgIGVsLmNoaWxkcmVuW2ldLmNsYXNzTGlzdC5hZGQoJ2pyYXRpbmctb3ZlcicpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZWwuY2hpbGRyZW5baV0uY2xhc3NMaXN0LnJlbW92ZSgnanJhdGluZy1vdmVyJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBlbC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdXRcIiwgZnVuY3Rpb24oZSkge1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2JqLm9wdGlvbnMubnVtYmVyOyBpKyspIHtcclxuICAgICAgICAgICAgZWwuY2hpbGRyZW5baV0uY2xhc3NMaXN0LnJlbW92ZSgnanJhdGluZy1vdmVyJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgZWwucmF0aW5nID0gb2JqO1xyXG5cclxuICAgIHJldHVybiBvYmo7XHJcbn0pO1xyXG5cclxuXHJcbi8qKlxyXG4gKiAoYykgSW1hZ2Ugc2xpZGVyXHJcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9wYXVsaG9kZWwvanRvb2xzXHJcbiAqXHJcbiAqIEBhdXRob3I6IFBhdWwgSG9kZWwgPHBhdWwuaG9kZWxAZ21haWwuY29tPlxyXG4gKiBAZGVzY3JpcHRpb246IEltYWdlIFNsaWRlclxyXG4gKi9cclxuXHJcbmpTdWl0ZXMuc2xpZGVyID0gKGZ1bmN0aW9uKGVsLCBvcHRpb25zKSB7XHJcbiAgICB2YXIgb2JqID0ge307XHJcbiAgICBvYmoub3B0aW9ucyA9IHt9O1xyXG4gICAgb2JqLmN1cnJlbnRJbWFnZSA9IG51bGw7XHJcblxyXG4gICAgaWYgKG9wdGlvbnMpIHtcclxuICAgICAgICBvYmoub3B0aW9ucyA9IG9wdGlvbnM7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gSXRlbXNcclxuICAgIG9iai5vcHRpb25zLml0ZW1zID0gW107XHJcblxyXG4gICAgaWYgKCEgZWwuY2xhc3NMaXN0LmNvbnRhaW5zKCdqc2xpZGVyJykpIHtcclxuICAgICAgICBlbC5jbGFzc0xpc3QuYWRkKCdqc2xpZGVyJyk7XHJcblxyXG4gICAgICAgIC8vIENyZWF0ZSBjb250YWluZXJcclxuICAgICAgICB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgY29udGFpbmVyLmNsYXNzTmFtZSA9ICdqc2xpZGVyLWNvbnRhaW5lcic7XHJcblxyXG4gICAgICAgIC8vIE1vdmUgY2hpbGRyZW4gaW5zaWRlXHJcbiAgICAgICAgaWYgKGVsLmNoaWxkcmVuLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgLy8gS2VlcCBjaGlsZHJlbiBpdGVtc1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVsLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5pdGVtcy5wdXNoKGVsLmNoaWxkcmVuW2ldKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAob2JqLm9wdGlvbnMuaXRlbXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iai5vcHRpb25zLml0ZW1zLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5pdGVtc1tpXS5jbGFzc0xpc3QuYWRkKCdqZmlsZScpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gb2JqLm9wdGlvbnMuaXRlbXNbaV0uc3JjLmxhc3RJbmRleE9mKCcvJyk7XHJcbiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPCAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMuaXRlbXNbaV0uc2V0QXR0cmlidXRlKCdkYXRhLW5hbWUnLCBvYmoub3B0aW9ucy5pdGVtc1tpXS5zcmMpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5pdGVtc1tpXS5zZXRBdHRyaWJ1dGUoJ2RhdGEtbmFtZScsIG9iai5vcHRpb25zLml0ZW1zW2ldLnNyYy5zdWJzdHIoaW5kZXggKyAxKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSBvYmoub3B0aW9ucy5pdGVtc1tpXS5zcmMubGFzdEluZGV4T2YoJy8nKTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQob2JqLm9wdGlvbnMuaXRlbXNbaV0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsLmFwcGVuZENoaWxkKGNvbnRhaW5lcik7XHJcbiAgICAgICAgLy8gQWRkIGNsb3NlIGJ1dHRvbVxyXG4gICAgICAgIHZhciBjbG9zZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgIGNsb3NlLmNsYXNzTmFtZSA9ICdqc2xpZGVyLWNsb3NlJztcclxuICAgICAgICBjbG9zZS5pbm5lckhUTUwgPSAnJztcclxuICAgICAgICBjbG9zZS5vbmNsaWNrID0gIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBvYmouY2xvc2UoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWwuYXBwZW5kQ2hpbGQoY2xvc2UpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICB2YXIgY29udGFpbmVyID0gZWwucXVlcnlTZWxlY3Rvcignc2xpZGVyLWNvbnRhaW5lcicpO1xyXG4gICAgfVxyXG5cclxuICAgIG9iai5zaG93ID0gZnVuY3Rpb24odGFyZ2V0KSB7XHJcbiAgICAgICAgaWYgKCEgdGFyZ2V0KSB7XHJcbiAgICAgICAgICAgIHZhciB0YXJnZXQgPSBjb250YWluZXIuY2hpbGRyZW5bMF07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoISBjb250YWluZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdqc2xpZGVyLXByZXZpZXcnKSkge1xyXG4gICAgICAgICAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZCgnanNsaWRlci1wcmV2aWV3Jyk7XHJcbiAgICAgICAgICAgIGNsb3NlLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gSGlkZSBhbGwgaW1hZ2VzXHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb250YWluZXIuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgY29udGFpbmVyLmNoaWxkcmVuW2ldLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBTaG93IGNsaWNrZWQgb25seVxyXG4gICAgICAgIHRhcmdldC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcclxuXHJcbiAgICAgICAgLy8gSXMgdGhlcmUgYW55IHByZXZpb3VzXHJcbiAgICAgICAgaWYgKHRhcmdldC5wcmV2aW91c1NpYmxpbmcpIHtcclxuICAgICAgICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2pzbGlkZXItbGVmdCcpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdqc2xpZGVyLWxlZnQnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIElzIHRoZXJlIGFueSBuZXh0XHJcbiAgICAgICAgaWYgKHRhcmdldC5uZXh0U2libGluZykge1xyXG4gICAgICAgICAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZCgnanNsaWRlci1yaWdodCcpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdqc2xpZGVyLXJpZ2h0Jyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBvYmouY3VycmVudEltYWdlID0gdGFyZ2V0O1xyXG4gICAgfVxyXG5cclxuICAgIG9iai5vcGVuID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgb2JqLnNob3coKTtcclxuXHJcbiAgICAgICAgLy8gRXZlbnRcclxuICAgICAgICBpZiAodHlwZW9mKG9iai5vcHRpb25zLm9ub3BlbikgPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICBvYmoub3B0aW9ucy5vbm9wZW4oZWwpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvYmouY2xvc2UgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBjb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgnanNsaWRlci1wcmV2aWV3Jyk7XHJcbiAgICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoJ2pzbGlkZXItbGVmdCcpO1xyXG4gICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdqc2xpZGVyLXJpZ2h0Jyk7XHJcblxyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY29udGFpbmVyLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnRhaW5lci5jaGlsZHJlbltpXS5zdHlsZS5kaXNwbGF5ID0gJyc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjbG9zZS5zdHlsZS5kaXNwbGF5ID0gJyc7XHJcblxyXG4gICAgICAgIG9iai5jdXJyZW50SW1hZ2UgPSBudWxsO1xyXG5cclxuICAgICAgICAvLyBFdmVudFxyXG4gICAgICAgIGlmICh0eXBlb2Yob2JqLm9wdGlvbnMub25jbG9zZSkgPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICBvYmoub3B0aW9ucy5vbmNsb3NlKGVsKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb2JqLnJlc2V0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgY29udGFpbmVyLmlubmVySFRNTCA9ICcnO1xyXG4gICAgfVxyXG5cclxuICAgIG9iai5hZGRGaWxlID0gZnVuY3Rpb24odiwgaWdub3JlRXZlbnRzKSB7XHJcbiAgICAgICAgdmFyIGltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xyXG4gICAgICAgIGltZy5zZXRBdHRyaWJ1dGUoJ2RhdGEtbGFzdG1vZGlmaWVkJywgdi5sYXN0bW9kaWZpZWQpO1xyXG4gICAgICAgIGltZy5zZXRBdHRyaWJ1dGUoJ2RhdGEtbmFtZScsIHYubmFtZSk7XHJcbiAgICAgICAgaW1nLnNldEF0dHJpYnV0ZSgnZGF0YS1zaXplJywgdi5zaXplKTtcclxuICAgICAgICBpbWcuc2V0QXR0cmlidXRlKCdkYXRhLWV4dGVuc2lvbicsIHYuZXh0ZW5zaW9uKTtcclxuICAgICAgICBpbWcuc2V0QXR0cmlidXRlKCdkYXRhLWNvdmVyJywgdi5jb3Zlcik7XHJcbiAgICAgICAgaW1nLnNldEF0dHJpYnV0ZSgnc3JjJywgdi5maWxlKTtcclxuICAgICAgICBpbWcuY2xhc3NOYW1lID0gJ2pmaWxlJztcclxuICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoaW1nKTtcclxuICAgICAgICBvYmoub3B0aW9ucy5pdGVtcy5wdXNoKGltZyk7XHJcblxyXG4gICAgICAgIC8vIE9uY2hhbmdlXHJcbiAgICAgICAgaWYgKCEgaWdub3JlRXZlbnRzKSB7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2Yob2JqLm9wdGlvbnMub25jaGFuZ2UpID09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLm9uY2hhbmdlKGVsLCB2KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvYmouYWRkRmlsZXMgPSBmdW5jdGlvbihmaWxlcykge1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZmlsZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgb2JqLmFkZEZpbGUoZmlsZXNbaV0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvYmoubmV4dCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGlmIChvYmouY3VycmVudEltYWdlLm5leHRTaWJsaW5nKSB7XHJcbiAgICAgICAgICAgIG9iai5zaG93KG9iai5jdXJyZW50SW1hZ2UubmV4dFNpYmxpbmcpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgb2JqLnByZXYgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiAob2JqLmN1cnJlbnRJbWFnZS5wcmV2aW91c1NpYmxpbmcpIHtcclxuICAgICAgICAgICAgb2JqLnNob3cob2JqLmN1cnJlbnRJbWFnZS5wcmV2aW91c1NpYmxpbmcpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvYmouZ2V0RGF0YSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBqU3VpdGVzLmdldEZpbGVzKGNvbnRhaW5lcik7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQXBwZW5kIGRhdGFcclxuICAgIGlmIChvYmoub3B0aW9ucy5kYXRhICYmIG9iai5vcHRpb25zLmRhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvYmoub3B0aW9ucy5kYXRhLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5kYXRhW2ldKSB7XHJcbiAgICAgICAgICAgICAgICBvYmouYWRkRmlsZShvYmoub3B0aW9ucy5kYXRhW2ldKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBBbGxvdyBpbnNlcnRcclxuICAgIGlmIChvYmoub3B0aW9ucy5hbGxvd0F0dGFjaG1lbnQpIHtcclxuICAgICAgICB2YXIgYXR0YWNobWVudElucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcclxuICAgICAgICBhdHRhY2htZW50SW5wdXQudHlwZSA9ICdmaWxlJztcclxuICAgICAgICBhdHRhY2htZW50SW5wdXQuY2xhc3NOYW1lID0gJ3NsaWRlci1hdHRhY2htZW50JztcclxuICAgICAgICBhdHRhY2htZW50SW5wdXQuc2V0QXR0cmlidXRlKCdhY2NlcHQnLCAnaW1hZ2UvKicpO1xyXG4gICAgICAgIGF0dGFjaG1lbnRJbnB1dC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG4gICAgICAgIGF0dGFjaG1lbnRJbnB1dC5vbmNoYW5nZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2YXIgcmVhZGVyID0gW107XHJcblxyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuZmlsZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciB0eXBlID0gdGhpcy5maWxlc1tpXS50eXBlLnNwbGl0KCcvJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVbMF0gPT0gJ2ltYWdlJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBleHRlbnNpb24gPSB0aGlzLmZpbGVzW2ldLm5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgZXh0ZW5zaW9uID0gZXh0ZW5zaW9uLnNwbGl0KCcuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgZXh0ZW5zaW9uID0gZXh0ZW5zaW9uW2V4dGVuc2lvbi5sZW5ndGgtMV07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBmaWxlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzaXplOiB0aGlzLmZpbGVzW2ldLnNpemUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHRoaXMuZmlsZXNbaV0ubmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXh0ZW5zaW9uOiBleHRlbnNpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvdmVyOiAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYXN0bW9kaWZpZWQ6IHRoaXMuZmlsZXNbaV0ubGFzdE1vZGlmaWVkLFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmVhZGVyW2ldID0gbmV3IEZpbGVSZWFkZXIoKTtcclxuICAgICAgICAgICAgICAgICAgICByZWFkZXJbaV0uYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRcIiwgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5maWxlID0gZS50YXJnZXQucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouYWRkRmlsZShmaWxlKTtcclxuICAgICAgICAgICAgICAgICAgICB9LCBmYWxzZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJlYWRlcltpXS5yZWFkQXNEYXRhVVJMKHRoaXMuZmlsZXNbaV0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBhbGVydCgnVGhlIGV4dGVuc2lvbiBpcyBub3QgYWxsb3dlZCcpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGF0dGFjaG1lbnRJY29uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaScpO1xyXG4gICAgICAgIGF0dGFjaG1lbnRJY29uLmlubmVySFRNTCA9ICdhdHRhY2htZW50JztcclxuICAgICAgICBhdHRhY2htZW50SWNvbi5jbGFzc05hbWUgPSAnanNsaWRlci1hdHRhY2ggbWF0ZXJpYWwtaWNvbnMnO1xyXG4gICAgICAgIGF0dGFjaG1lbnRJY29uLm9uY2xpY2sgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgalN1aXRlcy5jbGljayhhdHRhY2htZW50SW5wdXQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZWwuYXBwZW5kQ2hpbGQoYXR0YWNobWVudElucHV0KTtcclxuICAgICAgICBlbC5hcHBlbmRDaGlsZChhdHRhY2htZW50SWNvbik7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gUHVzaCB0byByZWZyZXNoXHJcbiAgICB2YXIgbG9uZ1RvdWNoVGltZXIgPSBudWxsO1xyXG5cclxuICAgIHZhciBtb3VzZURvd24gPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgaWYgKGUudGFyZ2V0LnRhZ05hbWUgPT0gJ0lNRycpIHtcclxuICAgICAgICAgICAgLy8gUmVtb3ZlXHJcbiAgICAgICAgICAgIHZhciB0YXJnZXRJbWFnZSA9IGUudGFyZ2V0O1xyXG4gICAgICAgICAgICBsb25nVG91Y2hUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXQuc3JjLnN1YnN0cigwLDQpID09ICdkYXRhJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGUudGFyZ2V0LnJlbW92ZSgpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqcmVtb3ZlJykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZS50YXJnZXQuY2xhc3NMaXN0LnJlbW92ZSgnanJlbW92ZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGUudGFyZ2V0LmNsYXNzTGlzdC5hZGQoJ2pyZW1vdmUnKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gT25jaGFuZ2VcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2Yob2JqLm9wdGlvbnMub25jaGFuZ2UpID09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5vbmNoYW5nZShlbCwgZS50YXJnZXQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCAxMDAwKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIG1vdXNlVXAgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgaWYgKGxvbmdUb3VjaFRpbWVyKSB7XHJcbiAgICAgICAgICAgIGNsZWFyVGltZW91dChsb25nVG91Y2hUaW1lcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBPcGVuIHNsaWRlclxyXG4gICAgICAgIGlmIChlLnRhcmdldC50YWdOYW1lID09ICdJTUcnKSB7XHJcbiAgICAgICAgICAgIGlmICghIGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnanJlbW92ZScpKSB7XHJcbiAgICAgICAgICAgICAgICBvYmouc2hvdyhlLnRhcmdldCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBBcnJvdyBjb250cm9sc1xyXG4gICAgICAgICAgICBpZiAoZS50YXJnZXQuY2xpZW50V2lkdGggLSBlLm9mZnNldFggPCA0MCkge1xyXG4gICAgICAgICAgICAgICAgLy8gU2hvdyBuZXh0IGltYWdlXHJcbiAgICAgICAgICAgICAgICBvYmoubmV4dCgpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGUub2Zmc2V0WCA8IDQwKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBTaG93IHByZXZpb3VzIGltYWdlXHJcbiAgICAgICAgICAgICAgICBvYmoucHJldigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBtb3VzZURvd24pO1xyXG4gICAgY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCBtb3VzZURvd24pO1xyXG4gICAgY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBtb3VzZVVwKTtcclxuICAgIGNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIG1vdXNlVXApO1xyXG5cclxuICAgIC8vIEFkZCBnbG9iYWwgZXZlbnRzXHJcbiAgICBlbC5hZGRFdmVudExpc3RlbmVyKFwic3dpcGVsZWZ0XCIsIGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICBvYmoubmV4dCgpO1xyXG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZWwuYWRkRXZlbnRMaXN0ZW5lcihcInN3aXBlcmlnaHRcIiwgZnVuY3Rpb24oZSkge1xyXG4gICAgICAgIG9iai5wcmV2KCk7XHJcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICB9KTtcclxuXHJcblxyXG4gICAgZWwuc2xpZGVyID0gb2JqO1xyXG5cclxuICAgIHJldHVybiBvYmo7XHJcbn0pO1xyXG5cclxuLyoqXG4gKiAoYykgalRvb2xzIHYxLjAuMSAtIEVsZW1lbnQgc29ydGluZ1xuICogaHR0cHM6Ly9naXRodWIuY29tL3BhdWxob2RlbC9qdG9vbHNcbiAqXG4gKiBAYXV0aG9yOiBQYXVsIEhvZGVsIDxwYXVsLmhvZGVsQGdtYWlsLmNvbT5cbiAqIEBkZXNjcmlwdGlvbjogRWxlbWVudCBkcmFnIGFuZCBkcm9wIHNvcnRpbmdcbiAqL1xuXG5qU3VpdGVzLnNvcnRpbmcgPSAoZnVuY3Rpb24oZWwsIG9wdGlvbnMpIHtcbiAgICBlbC5jbGFzc0xpc3QuYWRkKCdqc29ydGluZycpO1xuXG4gICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ3N0YXJ0JywgZnVuY3Rpb24oZSkge1xuICAgICAgICBlLnRhcmdldC5jbGFzc0xpc3QuYWRkKCdkcmFnZ2luZycpO1xuICAgIH0pO1xuXG4gICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ292ZXInLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICBpZiAoZS50YXJnZXQuY2xpZW50SGVpZ2h0IC8gMiA+IGUub2Zmc2V0WSkge1xuICAgICAgICAgICAgZS5wYXRoWzBdLnN0eWxlLmJvcmRlclRvcCA9ICcxcHggZG90dGVkICNjY2MnO1xuICAgICAgICAgICAgZS5wYXRoWzBdLnN0eWxlLmJvcmRlckJvdHRvbSA9ICcnO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZS5wYXRoWzBdLnN0eWxlLmJvcmRlclRvcCA9ICcnO1xuICAgICAgICAgICAgZS5wYXRoWzBdLnN0eWxlLmJvcmRlckJvdHRvbSA9ICcxcHggZG90dGVkICNjY2MnO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdkcmFnbGVhdmUnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIGUucGF0aFswXS5zdHlsZS5ib3JkZXJUb3AgPSAnJztcbiAgICAgICAgZS5wYXRoWzBdLnN0eWxlLmJvcmRlckJvdHRvbSA9ICcnO1xuICAgIH0pO1xuXG4gICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ2VuZCcsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgZS5wYXRoWzFdLnF1ZXJ5U2VsZWN0b3IoJy5kcmFnZ2luZycpLmNsYXNzTGlzdC5yZW1vdmUoJ2RyYWdnaW5nJyk7XG4gICAgfSk7XG5cbiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdkcm9wJywgZnVuY3Rpb24oZSkge1xuICAgICAgICB2YXIgZWxlbWVudCA9IGUucGF0aFsxXS5xdWVyeVNlbGVjdG9yKCcuZHJhZ2dpbmcnKTtcblxuICAgICAgICBpZiAoZS50YXJnZXQuY2xpZW50SGVpZ2h0IC8gMiA+IGUub2Zmc2V0WSkge1xuICAgICAgICAgICAgZS5wYXRoWzFdLmluc2VydEJlZm9yZShlbGVtZW50LCBlLnBhdGhbMF0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZS5wYXRoWzFdLmluc2VydEJlZm9yZShlbGVtZW50LCBlLnBhdGhbMF0ubmV4dFNpYmxpbmcpO1xuICAgICAgICB9XG5cbiAgICAgICAgZS5wYXRoWzBdLnN0eWxlLmJvcmRlclRvcCA9ICcnO1xuICAgICAgICBlLnBhdGhbMF0uc3R5bGUuYm9yZGVyQm90dG9tID0gJyc7XG4gICAgfSk7XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVsLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGVsLmNoaWxkcmVuW2ldLnNldEF0dHJpYnV0ZSgnZHJhZ2dhYmxlJywgJ3RydWUnKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIGVsO1xufSk7XHJcblxyXG5qU3VpdGVzLnRhYnMgPSAoZnVuY3Rpb24oZWwsIG9wdGlvbnMpIHtcclxuICAgIHZhciBvYmogPSB7fTtcclxuICAgIG9iai5vcHRpb25zID0ge307XHJcblxyXG4gICAgLy8gRGVmYXVsdCBjb25maWd1cmF0aW9uXHJcbiAgICB2YXIgZGVmYXVsdHMgPSB7XHJcbiAgICAgICAgZGF0YTogbnVsbCxcclxuICAgICAgICBhbGxvd0NyZWF0ZTogZmFsc2UsXHJcbiAgICAgICAgb25sb2FkOiBudWxsLFxyXG4gICAgICAgIG9uY2hhbmdlOiBudWxsLFxyXG4gICAgICAgIG9uY3JlYXRlOiBudWxsLFxyXG4gICAgICAgIGFuaW1hdGlvbjogZmFsc2UsXHJcbiAgICAgICAgY3JlYXRlOiBudWxsLFxyXG4gICAgICAgIGF1dG9OYW1lOiBmYWxzZSxcclxuICAgICAgICBwcmVmaXhOYW1lOiAnJyxcclxuICAgICAgICBoaWRlSGVhZGVyczogZmFsc2UsXHJcbiAgICB9O1xyXG5cclxuICAgIC8vIExvb3AgdGhyb3VnaCB0aGUgaW5pdGlhbCBjb25maWd1cmF0aW9uXHJcbiAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBkZWZhdWx0cykge1xyXG4gICAgICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuaGFzT3duUHJvcGVydHkocHJvcGVydHkpKSB7XHJcbiAgICAgICAgICAgIG9iai5vcHRpb25zW3Byb3BlcnR5XSA9IG9wdGlvbnNbcHJvcGVydHldO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIG9iai5vcHRpb25zW3Byb3BlcnR5XSA9IGRlZmF1bHRzW3Byb3BlcnR5XTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ2xhc3NcclxuICAgIGVsLmNsYXNzTGlzdC5hZGQoJ2p0YWJzJyk7XHJcblxyXG4gICAgaWYgKG9iai5vcHRpb25zLmFuaW1hdGlvbiA9PSB0cnVlKSB7XHJcbiAgICAgICAgLy8gQm9yZGVyXHJcbiAgICAgICAgdmFyIGJvcmRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgIGJvcmRlci5jbGFzc05hbWUgPSAnanRhYnMtYm9yZGVyJztcclxuICAgICAgICBlbC5hcHBlbmRDaGlsZChib3JkZXIpO1xyXG5cclxuICAgICAgICB2YXIgc2V0Qm9yZGVyID0gZnVuY3Rpb24oaW5kZXgpIHtcclxuICAgICAgICAgICAgdmFyIHJlY3QgPSBoZWFkZXJzLmNoaWxkcmVuW2luZGV4XS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgICAgICAgdmFyIHJlY3RDb250ZW50ID0gY29udGVudC5jaGlsZHJlbltpbmRleF0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICAgICAgICAgIGJvcmRlci5zdHlsZS53aWR0aCA9IHJlY3Qud2lkdGggKyAncHgnO1xyXG4gICAgICAgICAgICBib3JkZXIuc3R5bGUubGVmdCA9IChyZWN0LmxlZnQgLSByZWN0Q29udGVudC5sZWZ0KSArICdweCc7XHJcbiAgICAgICAgICAgIGJvcmRlci5zdHlsZS50b3AgPSByZWN0LmhlaWdodCArICdweCc7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIFNldCB2YWx1ZVxyXG4gICAgb2JqLm9wZW4gPSBmdW5jdGlvbihpbmRleCkge1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaGVhZGVycy5jaGlsZHJlbi5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBoZWFkZXJzLmNoaWxkcmVuW2ldLmNsYXNzTGlzdC5yZW1vdmUoJ2p0YWJzLXNlbGVjdGVkJyk7XHJcbiAgICAgICAgICAgIGlmIChjb250ZW50LmNoaWxkcmVuW2ldKSB7XHJcbiAgICAgICAgICAgICAgICBjb250ZW50LmNoaWxkcmVuW2ldLmNsYXNzTGlzdC5yZW1vdmUoJ2p0YWJzLXNlbGVjdGVkJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGhlYWRlcnMuY2hpbGRyZW5baW5kZXhdLmNsYXNzTGlzdC5hZGQoJ2p0YWJzLXNlbGVjdGVkJyk7XHJcbiAgICAgICAgaWYgKGNvbnRlbnQuY2hpbGRyZW5baW5kZXhdKSB7XHJcbiAgICAgICAgICAgIGNvbnRlbnQuY2hpbGRyZW5baW5kZXhdLmNsYXNzTGlzdC5hZGQoJ2p0YWJzLXNlbGVjdGVkJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBIaWRlXHJcbiAgICAgICAgaWYgKG9iai5vcHRpb25zLmhpZGVIZWFkZXJzID09IHRydWUgJiYgKGhlYWRlcnMuY2hpbGRyZW4ubGVuZ3RoIDwgMiAmJiBvYmoub3B0aW9ucy5hbGxvd0NyZWF0ZSA9PSBmYWxzZSkpIHtcclxuICAgICAgICAgICAgaGVhZGVycy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGhlYWRlcnMuc3R5bGUuZGlzcGxheSA9ICcnO1xyXG4gICAgICAgICAgICAvLyBTZXQgYm9yZGVyXHJcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5hbmltYXRpb24gPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICBzZXRCb3JkZXIoaW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgfSwgMTAwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvYmouc2VsZWN0SW5kZXggPSBmdW5jdGlvbihhKSB7XHJcbiAgICAgICAgdmFyIGluZGV4ID0gQXJyYXkucHJvdG90eXBlLmluZGV4T2YuY2FsbChoZWFkZXJzLmNoaWxkcmVuLCBhKTtcclxuICAgICAgICBpZiAoaW5kZXggPj0gMCkge1xyXG4gICAgICAgICAgICBvYmoub3BlbihpbmRleCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9iai5jcmVhdGUgPSBmdW5jdGlvbih0aXRsZSwgZGl2KSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZihvYmoub3B0aW9ucy5jcmVhdGUpID09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgb2JqLm9wdGlvbnMuY3JlYXRlKCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgb2JqLmFwcGVuZEVsZW1lbnQodGl0bGUsIGRpdik7XHJcblxyXG4gICAgICAgICAgICBpZiAodHlwZW9mKG9iai5vcHRpb25zLm9uY3JlYXRlKSA9PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5vbmNyZWF0ZShlbCwgZGl2KVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9iai5hcHBlbmRFbGVtZW50ID0gZnVuY3Rpb24odGl0bGUsIGRpdikge1xyXG4gICAgICAgIGlmICghIHRpdGxlKSB7XHJcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5hdXRvTmFtZSA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdGl0bGUgPSBvYmoub3B0aW9ucy5wcmVmaXhOYW1lO1xyXG4gICAgICAgICAgICAgICAgdGl0bGUgKz0gJyAnICsgKHBhcnNlSW50KGNvbnRlbnQuY2hpbGRyZW4ubGVuZ3RoKSArIDEpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdmFyIHRpdGxlID0gcHJvbXB0KCdUaXRsZT8nLCAnJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aXRsZSkge1xyXG4gICAgICAgICAgICAvLyBBZGQgaGVhZGVyc1xyXG4gICAgICAgICAgICB2YXIgaGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgIGhlYWRlci5pbm5lckhUTUwgPSB0aXRsZTtcclxuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmFsbG93Q3JlYXRlKSB7XHJcbiAgICAgICAgICAgICAgICBoZWFkZXJzLmluc2VydEJlZm9yZShoZWFkZXIsIGhlYWRlcnMubGFzdENoaWxkKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGhlYWRlcnMuYXBwZW5kQ2hpbGQoaGVhZGVyKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gQWRkIGNvbnRlbnRcclxuICAgICAgICAgICAgaWYgKCEgZGl2KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29udGVudC5hcHBlbmRDaGlsZChkaXYpO1xyXG5cclxuICAgICAgICAgICAgLy8gT3BlbiBuZXcgdGFiXHJcbiAgICAgICAgICAgIG9iai5zZWxlY3RJbmRleChoZWFkZXIpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBDcmVhdGUgZnJvbSBkYXRhXHJcbiAgICBpZiAob2JqLm9wdGlvbnMuZGF0YSkge1xyXG4gICAgICAgIC8vIE1ha2Ugc3VyZSB0aGUgY29tcG9uZW50IGlzIGJsYW5rXHJcbiAgICAgICAgZWwuaW5uZXJIVE1MID0gJyc7XHJcbiAgICAgICAgdmFyIGhlYWRlcnMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICB2YXIgY29udGVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgIGhlYWRlcnMuY2xhc3NMaXN0LmFkZCgnanRhYnMtaGVhZGVycycpO1xyXG4gICAgICAgIGNvbnRlbnQuY2xhc3NMaXN0LmFkZCgnanRhYnMtY29udGVudCcpO1xyXG4gICAgICAgIGVsLmFwcGVuZENoaWxkKGhlYWRlcnMpO1xyXG4gICAgICAgIGVsLmFwcGVuZENoaWxkKGNvbnRlbnQpO1xyXG5cclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iai5vcHRpb25zLmRhdGEubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgdmFyIGhlYWRlcnNJdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgIGhlYWRlcnMuYXBwZW5kQ2hpbGQoaGVhZGVyc0l0ZW0pO1xyXG4gICAgICAgICAgICB2YXIgY29udGVudEl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgY29udGVudC5hcHBlbmRDaGlsZChjb250ZW50SXRlbSk7XHJcblxyXG4gICAgICAgICAgICBoZWFkZXJzSXRlbS5pbm5lckhUTUwgPSBvYmoub3B0aW9ucy5kYXRhW2ldLnRpdGxlO1xyXG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuZGF0YVtpXS5jb250ZW50KSB7XHJcbiAgICAgICAgICAgICAgICBjb250ZW50SXRlbS5pbm5lckhUTUwgPSBvYmoub3B0aW9ucy5kYXRhW2ldLmNvbnRlbnQ7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAob2JqLm9wdGlvbnMuZGF0YVtpXS51cmwpIHtcclxuICAgICAgICAgICAgICAgIGpTdWl0ZXMuYWpheCh7XHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBvYmoub3B0aW9ucy5kYXRhW2ldLnVybCxcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudEl0ZW0uaW5uZXJIVE1MID0gcmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgY29tcGxldGU6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mKG9iai5vcHRpb25zLm9ubG9hZCkgPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMub25sb2FkKGVsKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoub3BlbigwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSBlbHNlIGlmIChlbC5jaGlsZHJlblswXSAmJiBlbC5jaGlsZHJlblsxXSkge1xyXG4gICAgICAgIC8vIENyZWF0ZSBmcm9tIGV4aXN0aW5nIGVsZW1lbnRzXHJcbiAgICAgICAgdmFyIGhlYWRlcnMgPSBlbC5jaGlsZHJlblswXTtcclxuICAgICAgICB2YXIgY29udGVudCA9IGVsLmNoaWxkcmVuWzFdO1xyXG4gICAgICAgIGhlYWRlcnMuY2xhc3NMaXN0LmFkZCgnanRhYnMtaGVhZGVycycpO1xyXG4gICAgICAgIGNvbnRlbnQuY2xhc3NMaXN0LmFkZCgnanRhYnMtY29udGVudCcpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBlbC5pbm5lckhUTUwgPSAnJztcclxuICAgICAgICB2YXIgaGVhZGVycyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgIHZhciBjb250ZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgaGVhZGVycy5jbGFzc0xpc3QuYWRkKCdqdGFicy1oZWFkZXJzJyk7XHJcbiAgICAgICAgY29udGVudC5jbGFzc0xpc3QuYWRkKCdqdGFicy1jb250ZW50Jyk7XHJcbiAgICAgICAgZWwuYXBwZW5kQ2hpbGQoaGVhZGVycyk7XHJcbiAgICAgICAgZWwuYXBwZW5kQ2hpbGQoY29udGVudCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gTmV3XHJcbiAgICBpZiAob2JqLm9wdGlvbnMuYWxsb3dDcmVhdGUgPT0gdHJ1ZSkge1xyXG4gICAgICAgIHZhciBhZGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpJyk7XHJcbiAgICAgICAgYWRkLmNsYXNzTmFtZSA9ICdqdGFicy1hZGQnO1xyXG4gICAgICAgIGhlYWRlcnMuYXBwZW5kQ2hpbGQoYWRkKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBFdmVudHNcclxuICAgIGhlYWRlcnMuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICBpZiAoZS50YXJnZXQudGFnTmFtZSA9PSAnRElWJykge1xyXG4gICAgICAgICAgICBvYmouc2VsZWN0SW5kZXgoZS50YXJnZXQpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIG9iai5jcmVhdGUoKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAoaGVhZGVycy5jaGlsZHJlbi5sZW5ndGgpIHtcclxuICAgICAgICBvYmoub3BlbigwKTtcclxuICAgIH1cclxuXHJcbiAgICBlbC50YWJzID0gb2JqO1xyXG5cclxuICAgIHJldHVybiBvYmo7XHJcbn0pO1xyXG5cclxualN1aXRlcy50YWdzID0gKGZ1bmN0aW9uKGVsLCBvcHRpb25zKSB7XHJcbiAgICB2YXIgb2JqID0ge307XHJcbiAgICBvYmoub3B0aW9ucyA9IHt9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQHR5cGVkZWYge09iamVjdH0gZGVmYXVsdHNcclxuICAgICAqIEBwcm9wZXJ0eSB7KHN0cmluZ3xBcnJheSl9IHZhbHVlIC0gSW5pdGlhbCB2YWx1ZSBvZiB0aGUgY29tcG9udGVudFxyXG4gICAgICogQHByb3BlcnR5IHtudW1iZXJ9IGxpbWl0IC0gTWF4IG51bWJlciBvZiB0YWdzIGluc2lkZSB0aGUgZWxlbWVudFxyXG4gICAgICogQHByb3BlcnR5IHtzdHJpbmd9IHNlYXJjaCAtIFRoZSBVUkwgZm9yIHN1Z2dlc3Rpb25zXHJcbiAgICAgKiBAcHJvcGVydHkge3N0cmluZ30gcGxhY2Vob2xkZXIgLSBUaGUgZGVmYXVsdCBpbnN0cnVjdGlvbiB0ZXh0IG9uIHRoZSBlbGVtZW50XHJcbiAgICAgKiBAcHJvcGVydHkge3ZhbGlkYXRpb259IHZhbGlkYXRpb24gLSBNZXRob2QgdG8gdmFsaWRhdGUgdGhlIHRhZ3NcclxuICAgICAqIEBwcm9wZXJ0eSB7cmVxdWVzdENhbGxiYWNrfSBvbmJlZm9yZWNoYW5nZSAtIE1ldGhvZCB0byBiZSBleGVjdXRlIGJlZm9yZSBhbnkgY2hhbmdlcyBvbiB0aGUgZWxlbWVudFxyXG4gICAgICogQHByb3BlcnR5IHtyZXF1ZXN0Q2FsbGJhY2t9IG9uY2hhbmdlIC0gTWV0aG9kIHRvIGJlIGV4ZWN1dGUgYWZ0ZXIgYW55IGNoYW5nZXMgb24gdGhlIGVsZW1lbnRcclxuICAgICAqIEBwcm9wZXJ0eSB7cmVxdWVzdENhbGxiYWNrfSBvbmZvY3VzIC0gTWV0aG9kIHRvIGJlIGV4ZWN1dGUgd2hlbiBvbiBmb2N1c1xyXG4gICAgICogQHByb3BlcnR5IHtyZXF1ZXN0Q2FsbGJhY2t9IG9uYmx1ciAtIE1ldGhvZCB0byBiZSBleGVjdXRlIHdoZW4gb24gYmx1clxyXG4gICAgICogQHByb3BlcnR5IHtyZXF1ZXN0Q2FsbGJhY2t9IG9ubG9hZCAtIE1ldGhvZCB0byBiZSBleGVjdXRlIHdoZW4gdGhlIGVsZW1lbnQgaXMgbG9hZGVkXHJcbiAgICAgKi9cclxuICAgIHZhciBkZWZhdWx0cyA9IHtcclxuICAgICAgICB2YWx1ZTogbnVsbCxcclxuICAgICAgICBsaW1pdDogbnVsbCxcclxuICAgICAgICBsaW1pdE1lc3NhZ2U6ICdUaGUgbGltaXQgb2YgZW50cmllcyBpczogJyxcclxuICAgICAgICBzZWFyY2g6IG51bGwsXHJcbiAgICAgICAgcGxhY2Vob2xkZXI6IG51bGwsXHJcbiAgICAgICAgdmFsaWRhdGlvbjogbnVsbCxcclxuICAgICAgICBvbmJlZm9yZWNoYW5nZTogbnVsbCxcclxuICAgICAgICBvbmNoYW5nZTogbnVsbCxcclxuICAgICAgICBvbmZvY3VzOiBudWxsLFxyXG4gICAgICAgIG9uYmx1cjogbnVsbCxcclxuICAgICAgICBvbmxvYWQ6IG51bGwsXHJcbiAgICAgICAgY29sb3JzOiBudWxsLFxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBMb29wIHRocm91Z2ggdGhvdWdoIHRoZSBkZWZhdWx0IGNvbmZpZ3VyYXRpb25cclxuICAgIGZvciAodmFyIHByb3BlcnR5IGluIGRlZmF1bHRzKSB7XHJcbiAgICAgICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5oYXNPd25Qcm9wZXJ0eShwcm9wZXJ0eSkpIHtcclxuICAgICAgICAgICAgb2JqLm9wdGlvbnNbcHJvcGVydHldID0gb3B0aW9uc1twcm9wZXJ0eV07XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgb2JqLm9wdGlvbnNbcHJvcGVydHldID0gZGVmYXVsdHNbcHJvcGVydHldO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBTZWFyY2ggaGVscGVyc1xyXG4gICAgdmFyIHNlYXJjaENvbnRhaW5lciA9IG51bGw7XHJcbiAgICB2YXIgc2VhcmNoVGVybXMgPSBudWxsO1xyXG4gICAgdmFyIHNlYXJjaEluZGV4ID0gMDtcclxuICAgIHZhciBzZWFyY2hUaW1lciA9IDA7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBBZGQgYSBuZXcgdGFnIHRvIHRoZSBlbGVtZW50XHJcbiAgICAgKiBAcGFyYW0geyg/c3RyaW5nfEFycmF5KX0gdmFsdWUgLSBUaGUgdmFsdWUgb2YgdGhlIG5ldyBlbGVtZW50XHJcbiAgICAgKi9cclxuICAgIG9iai5hZGQgPSBmdW5jdGlvbih2YWx1ZSwgZm9jdXMpIHtcclxuICAgICAgICBpZiAodHlwZW9mKG9iai5vcHRpb25zLm9uYmVmb3JlY2hhbmdlKSA9PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgIHZhciB2ID0gb2JqLm9wdGlvbnMub25iZWZvcmVjaGFuZ2UoZWwsIG9iaiwgdmFsdWUpO1xyXG4gICAgICAgICAgICBpZiAodiAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IHY7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIENsb3NlIHNlYXJjaFxyXG4gICAgICAgIGlmIChzZWFyY2hDb250YWluZXIpIHtcclxuICAgICAgICAgICAgc2VhcmNoQ29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSAnJztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChvYmoub3B0aW9ucy5saW1pdCA+IDAgJiYgZWwuY2hpbGRyZW4ubGVuZ3RoID49IG9iai5vcHRpb25zLmxpbWl0KSB7XHJcbiAgICAgICAgICAgIGFsZXJ0KG9iai5vcHRpb25zLmxpbWl0TWVzc2FnZSArICcgJyArIG9iai5vcHRpb25zLmxpbWl0KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBHZXQgbm9kZVxyXG4gICAgICAgICAgICB2YXIgbm9kZSA9IGdldFNlbGVjdGlvblN0YXJ0KCk7XHJcblxyXG4gICAgICAgICAgICAvLyBNaXggYXJndW1lbnQgc3RyaW5nIG9yIGFycmF5XHJcbiAgICAgICAgICAgIGlmICghIHZhbHVlIHx8IHR5cGVvZih2YWx1ZSkgPT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgICAgIGRpdi5pbm5lckhUTUwgPSB2YWx1ZSA/IHZhbHVlIDogJzxicj4nO1xyXG4gICAgICAgICAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5wYXJlbnROb2RlLmNsYXNzTGlzdC5jb250YWlucygnanRhZ3MnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsLmluc2VydEJlZm9yZShkaXYsIG5vZGUubmV4dFNpYmxpbmcpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBlbC5hcHBlbmRDaGlsZChkaXYpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5wYXJlbnROb2RlLmNsYXNzTGlzdC5jb250YWlucygnanRhZ3MnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghIG5vZGUuaW5uZXJUZXh0LnJlcGxhY2UoXCJcXG5cIiwgXCJcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWwucmVtb3ZlQ2hpbGQobm9kZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDw9IHZhbHVlLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEgb2JqLm9wdGlvbnMubGltaXQgfHwgZWwuY2hpbGRyZW4ubGVuZ3RoIDwgb2JqLm9wdGlvbnMubGltaXQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXYuaW5uZXJIVE1MID0gdmFsdWVbaV0gPyB2YWx1ZVtpXSA6ICc8YnI+JztcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWwuYXBwZW5kQ2hpbGQoZGl2KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFBsYWNlIGNhcmV0XHJcbiAgICAgICAgICAgIGlmIChmb2N1cykge1xyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXJldChkaXYpO1xyXG4gICAgICAgICAgICAgICAgfSwgMCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIEZpbHRlclxyXG4gICAgICAgICAgICBmaWx0ZXIoKTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0eXBlb2Yob2JqLm9wdGlvbnMub25jaGFuZ2UpID09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLm9uY2hhbmdlKGVsLCBvYmosIHZhbHVlID8gdmFsdWUgOiAnJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBHZXQgYWxsIHRhZ3MgaW4gdGhlIGVsZW1lbnRcclxuICAgICAqIEByZXR1cm4ge0FycmF5fSBkYXRhIC0gQWxsIHRhZ3MgYXMgYW4gYXJyYXlcclxuICAgICAqL1xyXG4gICAgb2JqLmdldERhdGEgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgZGF0YSA9IFtdO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZWwuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgdmFyIHZhbHVlID0gb2JqLmdldFZhbHVlKGkpO1xyXG4gICAgICAgICAgICBpZiAodmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIHZhciBpZCA9IGVsLmNoaWxkcmVuW2ldLmdldEF0dHJpYnV0ZSgnZGF0YS1pZCcpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCEgaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZCA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZGF0YS5wdXNoKHsgaWQ6IGlkLCB2YWx1ZTogdmFsdWUgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBHZXQgdGhlIHZhbHVlIG9mIG9uZSB0YWcuIE51bGwgZm9yIGFsbCB0YWdzXHJcbiAgICAgKiBAcGFyYW0gez9udW1iZXJ9IGluZGV4IC0gVGFnIGluZGV4IG51bWJlci4gTnVsbCBmb3IgYWxsIHRhZ3MuXHJcbiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IHZhbHVlIC0gQWxsIHRhZ3Mgc2VwYXJhdGVkIGJ5IGNvbW1hXHJcbiAgICAgKi9cclxuICAgIG9iai5nZXRWYWx1ZSA9IGZ1bmN0aW9uKGluZGV4KSB7XHJcbiAgICAgICAgdmFyIHZhbHVlID0gbnVsbDtcclxuXHJcbiAgICAgICAgaWYgKGluZGV4ICE9IG51bGwpIHtcclxuICAgICAgICAgICAgLy8gR2V0IG9uZSBpbmRpdmlkdWFsIHZhbHVlXHJcbiAgICAgICAgICAgIHZhbHVlID0gZWwuY2hpbGRyZW5baW5kZXhdLmlubmVyVGV4dC5yZXBsYWNlKFwiXFxuXCIsIFwiXCIpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIEdldCBhbGxcclxuICAgICAgICAgICAgdmFyIGRhdGEgPSBbXTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbC5jaGlsZHJlbi5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgdmFsdWUgPSBlbC5jaGlsZHJlbltpXS5pbm5lclRleHQucmVwbGFjZShcIlxcblwiLCBcIlwiKTtcclxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucHVzaChvYmouZ2V0VmFsdWUoaSkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhbHVlID0gZGF0YS5qb2luKCcsJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTZXQgdGhlIHZhbHVlIG9mIHRoZSBlbGVtZW50IGJhc2VkIG9uIGEgc3RyaW5nIHNlcGFyZXRlZCBieSAoLHw7fFxcclxcbilcclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZSAtIEEgc3RyaW5nIHdpdGggdGhlIHRhZ3NcclxuICAgICAqL1xyXG4gICAgb2JqLnNldFZhbHVlID0gZnVuY3Rpb24odGV4dCkge1xyXG4gICAgICAgIC8vIFJlbW92ZSB3aGl0ZXNwYWNlc1xyXG4gICAgICAgIHRleHQgPSB0ZXh0LnRyaW0oKTtcclxuXHJcbiAgICAgICAgaWYgKHRleHQpIHtcclxuICAgICAgICAgICAgLy8gVGFnc1xyXG4gICAgICAgICAgICB2YXIgZGF0YSA9IGV4dHJhY3RUYWdzKHRleHQpO1xyXG4gICAgICAgICAgICAvLyBBZGQgdGFncyB0byB0aGUgZWxlbWVudFxyXG4gICAgICAgICAgICBvYmouYWRkKGRhdGEpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvYmoucmVzZXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBlbC5pbm5lckhUTUwgPSAnPGRpdj48YnI+PC9kaXY+JztcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFZlcmlmeSBpZiBhbGwgdGFncyBpbiB0aGUgZWxlbWVudCBhcmUgdmFsaWRcclxuICAgICAqIEByZXR1cm4ge2Jvb2xlYW59XHJcbiAgICAgKi9cclxuICAgIG9iai5pc1ZhbGlkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIHRlc3QgPSAwO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZWwuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKGVsLmNoaWxkcmVuW2ldLmNsYXNzTGlzdC5jb250YWlucygnanRhZ3NfZXJyb3InKSkge1xyXG4gICAgICAgICAgICAgICAgdGVzdCsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0ZXN0ID09IDAgPyB0cnVlIDogZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBBZGQgb25lIGVsZW1lbnQgZnJvbSB0aGUgc3VnZ2VzdGlvbnMgdG8gdGhlIGVsZW1lbnRcclxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBpdGVtIC0gTm9kZSBlbGVtZW50IGluIHRoZSBzdWdnZXN0aW9ucyBjb250YWluZXJcclxuICAgICAqLyBcclxuICAgIG9iai5zZWxlY3RJbmRleCA9IGZ1bmN0aW9uKGl0ZW0pIHtcclxuICAgICAgICAvLyBSZXNldCB0ZXJtc1xyXG4gICAgICAgIHNlYXJjaFRlcm1zID0gJyc7XHJcbiAgICAgICAgdmFyIG5vZGUgPSBnZXRTZWxlY3Rpb25TdGFydCgpO1xyXG4gICAgICAgIC8vIEFwcGVuZCB0ZXh0IHRvIHRoZSBjYXJldFxyXG4gICAgICAgIG5vZGUuaW5uZXJUZXh0ID0gaXRlbS5jaGlsZHJlblsxXS5pbm5lclRleHQ7XHJcbiAgICAgICAgLy8gU2V0IG5vZGUgaWRcclxuICAgICAgICBpZiAoaXRlbS5jaGlsZHJlblsxXS5nZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnKSkge1xyXG4gICAgICAgICAgICBub2RlLnNldEF0dHJpYnV0ZSgnZGF0YS1pZCcsIGl0ZW0uY2hpbGRyZW5bMV0uZ2V0QXR0cmlidXRlKCdkYXRhLWlkJykpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBDbG9zZSBjb250YWluZXJcclxuICAgICAgICBpZiAoc2VhcmNoQ29udGFpbmVyKSB7XHJcbiAgICAgICAgICAgIHNlYXJjaENvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJyc7XHJcbiAgICAgICAgICAgIHNlYXJjaENvbnRhaW5lci5pbm5lckhUTUwgPSAnJztcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gUmVtb3ZlIGFueSBlcnJvclxyXG4gICAgICAgIG5vZGUuY2xhc3NMaXN0LnJlbW92ZSgnanRhZ3NfZXJyb3InKTtcclxuICAgICAgICAvLyBBZGQgbmV3IGl0ZW1cclxuICAgICAgICBvYmouYWRkKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTZWFyY2ggZm9yIHN1Z2dlc3Rpb25zXHJcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gbm9kZSAtIFRhcmdldCBub2RlIGZvciBhbnkgc3VnZ2VzdGlvbnNcclxuICAgICAqL1xyXG4gICAgb2JqLnNlYXJjaCA9IGZ1bmN0aW9uKG5vZGUpIHtcclxuICAgICAgICAvLyBDcmVhdGUgYW5kIGFwcGVuZCBzZWFyY2ggY29udGFpbmVyIHRvIHRoZSBET01cclxuICAgICAgICBpZiAoISBzZWFyY2hDb250YWluZXIpIHtcclxuICAgICAgICAgICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICBkaXYuc3R5bGUucG9zaXRpb24gPSAncmVsYXRpdmUnO1xyXG4gICAgICAgICAgICBlbC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShkaXYsIGVsLm5leHRTaWJsaW5nKTtcclxuXHJcbiAgICAgICAgICAgIC8vIENyZWF0ZSBjb250YWluZXJcclxuICAgICAgICAgICAgc2VhcmNoQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgIHNlYXJjaENvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdqdGFnc19zZWFyY2gnKTtcclxuICAgICAgICAgICAgZGl2LmFwcGVuZENoaWxkKHNlYXJjaENvbnRhaW5lcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBTZWFyY2ggZm9yXHJcbiAgICAgICAgdmFyIHRlcm1zID0gbm9kZS5hbmNob3JOb2RlLm5vZGVWYWx1ZTtcclxuXHJcbiAgICAgICAgLy8gU2VhcmNoXHJcbiAgICAgICAgaWYgKG5vZGUuYW5jaG9yTm9kZS5ub2RlVmFsdWUgJiYgdGVybXMgIT0gc2VhcmNoVGVybXMpIHtcclxuICAgICAgICAgICAgLy8gVGVybXNcclxuICAgICAgICAgICAgc2VhcmNoVGVybXMgPSBub2RlLmFuY2hvck5vZGUubm9kZVZhbHVlO1xyXG4gICAgICAgICAgICAvLyBSZXNldCBpbmRleFxyXG4gICAgICAgICAgICBzZWFyY2hJbmRleCA9IDA7XHJcbiAgICAgICAgICAgIC8vIEdldCByZW1vdmUgcmVzdWx0c1xyXG4gICAgICAgICAgICBqU3VpdGVzLmFqYXgoe1xyXG4gICAgICAgICAgICAgICAgdXJsOiBvYmoub3B0aW9ucy5zZWFyY2ggKyBzZWFyY2hUZXJtcyxcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxyXG4gICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFJlc2V0IGNvbnRhaW5lclxyXG4gICAgICAgICAgICAgICAgICAgIHNlYXJjaENvbnRhaW5lci5pbm5lckhUTUwgPSAnJztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gUHJpbnQgcmVzdWx0c1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghIGRhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNob3cgY29udGFpbmVyXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaENvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2hvdyBjb250YWluZXJcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoQ29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2hvdyBpdGVtc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbGVuID0gZGF0YS5sZW5ndGggPCAxMSA/IGRhdGEubGVuZ3RoIDogMTA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpID09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXYuY2xhc3NMaXN0LmFkZCgnc2VsZWN0ZWQnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhW2ldLmltYWdlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1nLnNyYyA9IGRhdGFbaV0uaW1hZ2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltZy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGl2LmFwcGVuZENoaWxkKGltZyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uc2V0QXR0cmlidXRlKCdkYXRhLWlkJywgZGF0YVtpXS5pZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmlubmVySFRNTCA9IGRhdGFbaV0ubmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpdi5vbmNsaWNrID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRkIGl0ZW1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouc2VsZWN0SW5kZXgodGhpcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXYuYXBwZW5kQ2hpbGQoaXRlbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBBcHBlbmQgaXRlbSB0byB0aGUgY29udGFpbmVyXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWFyY2hDb250YWluZXIuYXBwZW5kQ2hpbGQoZGl2KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIERlc3Ryb3kgdGFncyBlbGVtZW50XHJcbiAgICBvYmouZGVzdHJveSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIC8vIEJpbmQgZXZlbnRzXHJcbiAgICAgICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHRhZ3NNb3VzZVVwKTtcclxuICAgICAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGFnc0tleURvd24pO1xyXG4gICAgICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleXVwJywgdGFnc0tleVVwKTtcclxuICAgICAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCdwYXN0ZScsIHRhZ3NQYXN0ZSk7XHJcbiAgICAgICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignZm9jdXMnLCB0YWdzRm9jdXMpO1xyXG4gICAgICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2JsdXInLCB0YWdzQmx1cik7XHJcbiAgICAgICAgLy8gUmVtb3ZlIGVsZW1lbnRcclxuICAgICAgICBlbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGVsKTtcclxuICAgIH1cclxuXHJcbiAgICB2YXIgZ2V0UmFuZG9tQ29sb3IgPSBmdW5jdGlvbihpbmRleCkge1xyXG4gICAgICAgIHZhciByYW5kID0gZnVuY3Rpb24obWluLCBtYXgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG1pbiArIE1hdGgucmFuZG9tKCkgKiAobWF4IC0gbWluKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuICdoc2woJyArIHJhbmQoMSwgMzYwKSArICcsJyArIHJhbmQoNDAsIDcwKSArICclLCcgKyByYW5kKDY1LCA3MikgKyAnJSknO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogRmlsdGVyIHRhZ3NcclxuICAgICAqL1xyXG4gICAgdmFyIGZpbHRlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZWwuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgLy8gQ3JlYXRlIGxhYmVsIGRlc2lnblxyXG4gICAgICAgICAgICBpZiAoISBvYmouZ2V0VmFsdWUoaSkpIHtcclxuICAgICAgICAgICAgICAgIGVsLmNoaWxkcmVuW2ldLmNsYXNzTGlzdC5yZW1vdmUoJ2p0YWdzX2xhYmVsJyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBlbC5jaGlsZHJlbltpXS5jbGFzc0xpc3QuYWRkKCdqdGFnc19sYWJlbCcpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIFZhbGlkYXRpb24gaW4gcGxhY2VcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2Yob2JqLm9wdGlvbnMudmFsaWRhdGlvbikgPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmouZ2V0VmFsdWUoaSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEgb2JqLm9wdGlvbnMudmFsaWRhdGlvbihlbC5jaGlsZHJlbltpXSwgZWwuY2hpbGRyZW5baV0uaW5uZXJUZXh0LCBlbC5jaGlsZHJlbltpXS5nZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnKSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsLmNoaWxkcmVuW2ldLmNsYXNzTGlzdC5hZGQoJ2p0YWdzX2Vycm9yJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbC5jaGlsZHJlbltpXS5jbGFzc0xpc3QucmVtb3ZlKCdqdGFnc19lcnJvcicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWwuY2hpbGRyZW5baV0uY2xhc3NMaXN0LnJlbW92ZSgnanRhZ3NfZXJyb3InKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBQbGFjZSBjYXJldCBpbiB0aGUgZWxlbWVudCBub2RlXHJcbiAgICAgKi9cclxuICAgIHZhciBjYXJldCA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICB2YXIgcmFuZ2UgPSBkb2N1bWVudC5jcmVhdGVSYW5nZSgpO1xyXG4gICAgICAgIHZhciBzZWwgPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCk7XHJcbiAgICAgICAgcmFuZ2Uuc2V0U3RhcnQoZSwgZS5pbm5lclRleHQubGVuZ3RoKTtcclxuICAgICAgICByYW5nZS5jb2xsYXBzZSh0cnVlKTtcclxuICAgICAgICBzZWwucmVtb3ZlQWxsUmFuZ2VzKCk7XHJcbiAgICAgICAgc2VsLmFkZFJhbmdlKHJhbmdlKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFNlbGVjdGlvblxyXG4gICAgICovXHJcbiAgICB2YXIgZ2V0U2VsZWN0aW9uU3RhcnQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgbm9kZSA9IGRvY3VtZW50LmdldFNlbGVjdGlvbigpLmFuY2hvck5vZGU7XHJcbiAgICAgICAgaWYgKG5vZGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIChub2RlLm5vZGVUeXBlID09IDMgPyBub2RlLnBhcmVudE5vZGUgOiBub2RlKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBFeHRyYWN0IHRhZ3MgZnJvbSBhIHN0cmluZ1xyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHRleHQgLSBSYXcgc3RyaW5nXHJcbiAgICAgKiBAcmV0dXJuIHtBcnJheX0gZGF0YSAtIEFycmF5IHdpdGggZXh0cmFjdGVkIHRhZ3NcclxuICAgICAqL1xyXG4gICAgdmFyIGV4dHJhY3RUYWdzID0gZnVuY3Rpb24odGV4dCkge1xyXG4gICAgICAgIC8qKiBAdHlwZSB7QXJyYXl9ICovXHJcbiAgICAgICAgdmFyIGRhdGEgPSBbXTtcclxuXHJcbiAgICAgICAgLyoqIEB0eXBlIHtzdHJpbmd9ICovXHJcbiAgICAgICAgdmFyIHdvcmQgPSAnJztcclxuXHJcbiAgICAgICAgLy8gUmVtb3ZlIHdoaXRlc3BhY2VzXHJcbiAgICAgICAgdGV4dCA9IHRleHQudHJpbSgpO1xyXG5cclxuICAgICAgICBpZiAodGV4dCkge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRleHQubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGlmICh0ZXh0W2ldID09ICcsJyB8fCB0ZXh0W2ldID09ICc7JyB8fCB0ZXh0W2ldID09ICdcXHJcXG4nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHdvcmQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5wdXNoKHdvcmQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB3b3JkID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB3b3JkICs9IHRleHRbaV07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh3b3JkKSB7XHJcbiAgICAgICAgICAgICAgICBkYXRhLnB1c2god29yZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiBAdHlwZSB7bnVtYmVyfSAqL1xyXG4gICAgdmFyIGFuY2hvck9mZnNldCA9IDA7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBQcm9jZXNzaW5nIGV2ZW50IGtleWRvd24gb24gdGhlIGVsZW1lbnRcclxuICAgICAqIEBwYXJhbSBlIHtvYmplY3R9XHJcbiAgICAgKi9cclxuICAgIHZhciB0YWdzS2V5RG93biA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAvLyBBbmNob3JvZmZzZXRcclxuICAgICAgICBhbmNob3JPZmZzZXQgPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuYW5jaG9yT2Zmc2V0O1xyXG5cclxuICAgICAgICAvLyBWZXJpZnkgY29udGVudFxyXG4gICAgICAgIGlmICghIGVsLmNoaWxkcmVuLmxlbmd0aCkge1xyXG4gICAgICAgICAgICB2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgIGRpdi5pbm5lckhUTUwgPSAnPGJyPic7XHJcbiAgICAgICAgICAgIGVsLmFwcGVuZENoaWxkKGRpdik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIENvbW1hXHJcbiAgICAgICAgaWYgKGUud2hpY2ggPT0gOSB8fCBlLndoaWNoID09IDE4NiB8fCBlLndoaWNoID09IDE4OCkge1xyXG4gICAgICAgICAgICB2YXIgbiA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5hbmNob3JPZmZzZXQ7XHJcbiAgICAgICAgICAgIGlmIChuID4gMSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCEgb2JqLm9wdGlvbnMubGltaXQgfHwgZWwuY2hpbGRyZW4ubGVuZ3RoIDwgb2JqLm9wdGlvbnMubGltaXQpIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmouYWRkKCcnLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChlLndoaWNoID09IDEzKSB7XHJcbiAgICAgICAgICAgIC8vIEVudGVyXHJcbiAgICAgICAgICAgIGlmIChzZWFyY2hDb250YWluZXIgJiYgc2VhcmNoQ29udGFpbmVyLnN0eWxlLmRpc3BsYXkgIT0gJycpIHtcclxuICAgICAgICAgICAgICAgIG9iai5zZWxlY3RJbmRleChzZWFyY2hDb250YWluZXIuY2hpbGRyZW5bc2VhcmNoSW5kZXhdKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHZhciBuID0gd2luZG93LmdldFNlbGVjdGlvbigpLmFuY2hvck9mZnNldDtcclxuICAgICAgICAgICAgICAgIGlmIChuID4gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghIG9iai5vcHRpb25zLmxpbWl0IHx8IGVsLmNoaWxkcmVuLmxlbmd0aCA8IG9iai5vcHRpb25zLmxpbWl0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5hZGQoJycsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChlLndoaWNoID09IDM4KSB7XHJcbiAgICAgICAgICAgIC8vIFVwXHJcbiAgICAgICAgICAgIGlmIChzZWFyY2hDb250YWluZXIgJiYgc2VhcmNoQ29udGFpbmVyLnN0eWxlLmRpc3BsYXkgIT0gJycpIHtcclxuICAgICAgICAgICAgICAgIHNlYXJjaENvbnRhaW5lci5jaGlsZHJlbltzZWFyY2hJbmRleF0uY2xhc3NMaXN0LnJlbW92ZSgnc2VsZWN0ZWQnKTtcclxuICAgICAgICAgICAgICAgIGlmIChzZWFyY2hJbmRleCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBzZWFyY2hJbmRleC0tO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgc2VhcmNoQ29udGFpbmVyLmNoaWxkcmVuW3NlYXJjaEluZGV4XS5jbGFzc0xpc3QuYWRkKCdzZWxlY3RlZCcpO1xyXG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIGlmIChlLndoaWNoID09IDQwKSB7XHJcbiAgICAgICAgICAgIC8vIERvd25cclxuICAgICAgICAgICAgaWYgKHNlYXJjaENvbnRhaW5lciAmJiBzZWFyY2hDb250YWluZXIuc3R5bGUuZGlzcGxheSAhPSAnJykge1xyXG4gICAgICAgICAgICAgICAgc2VhcmNoQ29udGFpbmVyLmNoaWxkcmVuW3NlYXJjaEluZGV4XS5jbGFzc0xpc3QucmVtb3ZlKCdzZWxlY3RlZCcpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNlYXJjaEluZGV4IDwgOSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlYXJjaEluZGV4Kys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBzZWFyY2hDb250YWluZXIuY2hpbGRyZW5bc2VhcmNoSW5kZXhdLmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGVkJyk7XHJcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBQcm9jZXNzaW5nIGV2ZW50IGtleXVwIG9uIHRoZSBlbGVtZW50XHJcbiAgICAgKiBAcGFyYW0gZSB7b2JqZWN0fVxyXG4gICAgICovXHJcbiAgICB2YXIgdGFnc0tleVVwID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgIGlmIChlLndoaWNoID09IDM5KSB7XHJcbiAgICAgICAgICAgIHZhciBuID0gd2luZG93LmdldFNlbGVjdGlvbigpLmFuY2hvck9mZnNldDtcclxuICAgICAgICAgICAgaWYgKG4gPiAxICYmIG4gPT0gYW5jaG9yT2Zmc2V0KSB7XHJcbiAgICAgICAgICAgICAgICBvYmouYWRkKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2UgaWYgKGUud2hpY2ggPT0gMTMgfHwgZS53aGljaCA9PSAzOCB8fCBlLndoaWNoID09IDQwKSB7XHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAoc2VhcmNoVGltZXIpIHtcclxuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dChzZWFyY2hUaW1lcik7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHNlYXJjaFRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIC8vIEN1cnJlbnQgbm9kZVxyXG4gICAgICAgICAgICAgICAgdmFyIG5vZGUgPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICAvLyBTZWFyY2hcclxuICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5zZWFyY2gpIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmouc2VhcmNoKG5vZGUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgc2VhcmNoVGltZXIgPSBudWxsO1xyXG4gICAgICAgICAgICB9LCAzMDApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZmlsdGVyKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBQcm9jZXNzaW5nIGV2ZW50IHBhc3RlIG9uIHRoZSBlbGVtZW50XHJcbiAgICAgKiBAcGFyYW0gZSB7b2JqZWN0fVxyXG4gICAgICovXHJcbiAgICB2YXIgdGFnc1Bhc3RlID0gIGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICBpZiAoZS5jbGlwYm9hcmREYXRhIHx8IGUub3JpZ2luYWxFdmVudC5jbGlwYm9hcmREYXRhKSB7XHJcbiAgICAgICAgICAgIHZhciBodG1sID0gKGUub3JpZ2luYWxFdmVudCB8fCBlKS5jbGlwYm9hcmREYXRhLmdldERhdGEoJ3RleHQvaHRtbCcpO1xyXG4gICAgICAgICAgICB2YXIgdGV4dCA9IChlLm9yaWdpbmFsRXZlbnQgfHwgZSkuY2xpcGJvYXJkRGF0YS5nZXREYXRhKCd0ZXh0L3BsYWluJyk7XHJcbiAgICAgICAgfSBlbHNlIGlmICh3aW5kb3cuY2xpcGJvYXJkRGF0YSkge1xyXG4gICAgICAgICAgICB2YXIgaHRtbCA9IHdpbmRvdy5jbGlwYm9hcmREYXRhLmdldERhdGEoJ0h0bWwnKTtcclxuICAgICAgICAgICAgdmFyIHRleHQgPSB3aW5kb3cuY2xpcGJvYXJkRGF0YS5nZXREYXRhKCdUZXh0Jyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBvYmouc2V0VmFsdWUodGV4dCk7XHJcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUHJvY2Vzc2luZyBldmVudCBtb3VzZXVwIG9uIHRoZSBlbGVtZW50XHJcbiAgICAgKiBAcGFyYW0gZSB7b2JqZWN0fVxyXG4gICAgICovXHJcbiAgICB2YXIgdGFnc01vdXNlVXAgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgaWYgKGUudGFyZ2V0LnBhcmVudE5vZGUgJiYgZS50YXJnZXQucGFyZW50Tm9kZS5jbGFzc0xpc3QuY29udGFpbnMoJ2p0YWdzJykpIHtcclxuICAgICAgICAgICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnanRhZ3NfbGFiZWwnKSB8fCBlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2p0YWdzX2Vycm9yJykpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJlY3QgPSBlLnRhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgICAgICAgICAgIGlmIChyZWN0LndpZHRoIC0gKGUuY2xpZW50WCAtIHJlY3QubGVmdCkgPCAxNikge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsLnJlbW92ZUNoaWxkKGUudGFyZ2V0KTtcclxuICAgICAgICAgICAgICAgICAgICBlbC5mb2N1cygpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoc2VhcmNoQ29udGFpbmVyKSB7XHJcbiAgICAgICAgICAgIHNlYXJjaENvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJyc7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUHJvY2Vzc2luZyBldmVudCBmb2N1cyBvbiB0aGUgZWxlbWVudFxyXG4gICAgICogQHBhcmFtIGUge29iamVjdH1cclxuICAgICAqL1xyXG4gICAgdmFyIHRhZ3NGb2N1cyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICBpZiAoISBlbC5jaGlsZHJlbi5sZW5ndGggfHwgb2JqLmdldFZhbHVlKGVsLmNoaWxkcmVuLmxlbmd0aCAtIDEpKSB7XHJcbiAgICAgICAgICAgIGlmICghIG9iai5vcHRpb25zLmxpbWl0IHx8IGVsLmNoaWxkcmVuLmxlbmd0aCA8IG9iai5vcHRpb25zLmxpbWl0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgICAgICBkaXYuaW5uZXJIVE1MID0gJzxicj4nO1xyXG4gICAgICAgICAgICAgICAgZWwuYXBwZW5kQ2hpbGQoZGl2KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHR5cGVvZihvYmoub3B0aW9ucy5vbmZvY3VzKSA9PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgIG9iai5vcHRpb25zLm9uZm9jdXMoZWwsIG9iaiwgb2JqLmdldFZhbHVlKCkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFByb2Nlc3NpbmcgZXZlbnQgYmx1ciBvbiB0aGUgZWxlbWVudFxyXG4gICAgICogQHBhcmFtIGUge29iamVjdH1cclxuICAgICAqL1xyXG4gICAgdmFyIHRhZ3NCbHVyID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgIGlmIChzZWFyY2hDb250YWluZXIpIHtcclxuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHNlYXJjaENvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJyc7XHJcbiAgICAgICAgICAgIH0sIDIwMCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVsLmNoaWxkcmVuLmxlbmd0aCAtIDE7IGkrKykge1xyXG4gICAgICAgICAgICAvLyBDcmVhdGUgbGFiZWwgZGVzaWduXHJcbiAgICAgICAgICAgIGlmICghIG9iai5nZXRWYWx1ZShpKSkge1xyXG4gICAgICAgICAgICAgICAgZWwucmVtb3ZlQ2hpbGQoZWwuY2hpbGRyZW5baV0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodHlwZW9mKG9iai5vcHRpb25zLm9uYmx1cikgPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICBvYmoub3B0aW9ucy5vbmJsdXIoZWwsIG9iaiwgb2JqLmdldFZhbHVlKCkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBCaW5kIGV2ZW50c1xyXG4gICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHRhZ3NNb3VzZVVwKTtcclxuICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0YWdzS2V5RG93bik7XHJcbiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIHRhZ3NLZXlVcCk7XHJcbiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdwYXN0ZScsIHRhZ3NQYXN0ZSk7XHJcbiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsIHRhZ3NGb2N1cyk7XHJcbiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgdGFnc0JsdXIpO1xyXG5cclxuICAgIC8vIFByZXBhcmUgY29udGFpbmVyXHJcbiAgICBlbC5jbGFzc0xpc3QuYWRkKCdqdGFncycpO1xyXG4gICAgZWwuc2V0QXR0cmlidXRlKCdjb250ZW50ZWRpdGFibGUnLCB0cnVlKTtcclxuICAgIGVsLnNldEF0dHJpYnV0ZSgnc3BlbGxjaGVjaycsIGZhbHNlKTtcclxuXHJcbiAgICBpZiAob2JqLm9wdGlvbnMucGxhY2Vob2xkZXIpIHtcclxuICAgICAgICBlbC5wbGFjZWhvbGRlciA9IG9iai5vcHRpb25zLnBsYWNlaG9sZGVyO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIE1ha2Ugc3VyZSBlbGVtZW50IGlzIGVtcHR5XHJcbiAgICBpZiAob2JqLm9wdGlvbnMudmFsdWUpIHtcclxuICAgICAgICBvYmouc2V0VmFsdWUob2JqLm9wdGlvbnMudmFsdWUpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBlbC5pbm5lckhUTUwgPSAnPGRpdj48YnI+PC9kaXY+JztcclxuICAgIH1cclxuXHJcbiAgICBpZiAodHlwZW9mKG9iai5vcHRpb25zLm9ubG9hZCkgPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgIG9iai5vcHRpb25zLm9ubG9hZChlbCwgb2JqKTtcclxuICAgIH1cclxuXHJcbiAgICBlbC50YWdzID0gb2JqO1xyXG5cclxuICAgIHJldHVybiBvYmo7XHJcbn0pO1xyXG5cclxualN1aXRlcy50cmFja2VyID0gKGZ1bmN0aW9uKGVsLCBvcHRpb25zKSB7XHJcbiAgICB2YXIgb2JqID0ge307XHJcbiAgICBvYmoub3B0aW9ucyA9IHt9O1xyXG5cclxuICAgIC8vIERlZmF1bHQgY29uZmlndXJhdGlvblxyXG4gICAgdmFyIGRlZmF1bHRzID0ge1xyXG4gICAgICAgIHVybDogbnVsbCxcclxuICAgICAgICBtZXNzYWdlOiAnQXJlIHlvdSBzdXJlPyBUaGVyZSBhcmUgdW5zYXZlZCBpbmZvcm1hdGlvbiBpbiB5b3VyIGZvcm0nLFxyXG4gICAgICAgIGlnbm9yZTogZmFsc2UsXHJcbiAgICAgICAgY3VycmVudEhhc2g6IG51bGwsXHJcbiAgICAgICAgc3VibWl0QnV0dG9uOm51bGwsXHJcbiAgICAgICAgb25sb2FkOiBudWxsLFxyXG4gICAgICAgIG9uYmVmb3Jlc2F2ZTogbnVsbCxcclxuICAgICAgICBvbnNhdmU6IG51bGwsXHJcbiAgICB9O1xyXG5cclxuICAgIC8vIExvb3AgdGhyb3VnaCBvdXIgb2JqZWN0XHJcbiAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBkZWZhdWx0cykge1xyXG4gICAgICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuaGFzT3duUHJvcGVydHkocHJvcGVydHkpKSB7XHJcbiAgICAgICAgICAgIG9iai5vcHRpb25zW3Byb3BlcnR5XSA9IG9wdGlvbnNbcHJvcGVydHldO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIG9iai5vcHRpb25zW3Byb3BlcnR5XSA9IGRlZmF1bHRzW3Byb3BlcnR5XTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb2JqLnNldFVybCA9IGZ1bmN0aW9uKHVybCkge1xyXG4gICAgICAgIG9iai5vcHRpb25zLnVybCA9IHVybDtcclxuICAgIH1cclxuXHJcbiAgICBvYmoubG9hZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGpTdWl0ZXMuYWpheCh7XHJcbiAgICAgICAgICAgIHVybDogb2JqLm9wdGlvbnMudXJsLFxyXG4gICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxyXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZWxlbWVudHMgPSBlbC5xdWVyeVNlbGVjdG9yQWxsKFwiaW5wdXQsIHNlbGVjdCwgdGV4dGFyZWFcIik7XHJcbiBcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZWxlbWVudHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IGVsZW1lbnRzW2ldLmdldEF0dHJpYnV0ZSgnbmFtZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhW25hbWVdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRzW2ldLnZhbHVlID0gZGF0YVtuYW1lXTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZihvYmoub3B0aW9ucy5vbmxvYWQpID09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5vbmxvYWQoZWwsIGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgb2JqLnNhdmUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgdGVzdCA9IG9iai52YWxpZGF0ZSgpO1xyXG5cclxuICAgICAgICBpZiAodGVzdCkge1xyXG4gICAgICAgICAgICBqU3VpdGVzLmFsZXJ0KHRlc3QpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHZhciBkYXRhID0gb2JqLmdldEVsZW1lbnRzKHRydWUpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHR5cGVvZihvYmoub3B0aW9ucy5vbmJlZm9yZXNhdmUpID09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgIHZhciBkYXRhID0gb2JqLm9wdGlvbnMub25iZWZvcmVzYXZlKGVsLCBkYXRhKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZGF0YSA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnT25iZWZvcmVzYXZlIHJldHVybmVkIGZhbHNlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOyBcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgalN1aXRlcy5hamF4KHtcclxuICAgICAgICAgICAgICAgIHVybDogb2JqLm9wdGlvbnMudXJsLFxyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxyXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGpTdWl0ZXMuYWxlcnQocmVzdWx0Lm1lc3NhZ2UpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mKG9iai5vcHRpb25zLm9uc2F2ZSkgPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IG9iai5vcHRpb25zLm9uc2F2ZShlbCwgcmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIG9iai5yZXNldCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb2JqLnZhbGlkYXRlRWxlbWVudCA9IGZ1bmN0aW9uKGVsZW1lbnQpIHtcclxuICAgICAgICB2YXIgZW1haWxDaGVja2VyID0gZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICB2YXIgcGF0dGVybiA9IG5ldyBSZWdFeHAoL14oW1xcdy1cXC5dK0AoW1xcdy1dK1xcLikrW1xcdy1dezIsNH0pPyQvKTtcclxuICAgICAgICAgICAgcmV0dXJuIHBhdHRlcm4udGVzdChkYXRhKSA/IHRydWUgOiBmYWxzZTsgXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgcGFzc3dvcmRDaGVja2VyID0gZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICByZXR1cm4gKGRhdGEubGVuZ3RoID4gNSkgPyB0cnVlIDogZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgYWRkRXJyb3IgPSBmdW5jdGlvbihlbGVtZW50KSB7XHJcbiAgICAgICAgICAgIC8vIEFkZCBlcnJvciBpbiB0aGUgZWxlbWVudFxyXG4gICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2Vycm9yJyk7XHJcbiAgICAgICAgICAgIC8vIFN1Ym1pdCBidXR0b25cclxuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLnN1Ym1pdEJ1dHRvbikge1xyXG4gICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMuc3VibWl0QnV0dG9uLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCB0cnVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgbWVzc2FnZVxyXG4gICAgICAgICAgICByZXR1cm4gZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2RhdGEtZXJyb3InKSB8fCAnVGhlcmUgaXMgYW4gZXJyb3IgaW4gdGhlIGZvcm0nO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGRlbEVycm9yID0gZnVuY3Rpb24oZWxlbWVudCkge1xyXG4gICAgICAgICAgICB2YXIgZXJyb3IgPSBmYWxzZTtcclxuICAgICAgICAgICAgLy8gUmVtb3ZlIGNsYXNzIGZyb20gdGhpcyBlbGVtZW50XHJcbiAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnZXJyb3InKTtcclxuICAgICAgICAgICAgLy8gR2V0IGVsZW1lbnRzIGluIHRoZSBmb3JtXHJcbiAgICAgICAgICAgIHZhciBlbGVtZW50cyA9IGVsLnF1ZXJ5U2VsZWN0b3JBbGwoXCJpbnB1dCwgc2VsZWN0LCB0ZXh0YXJlYVwiKTtcclxuICAgICAgICAgICAgLy8gUnVuIGFsbCBlbGVtZW50cyBcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbGVtZW50cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnRzW2ldLmdldEF0dHJpYnV0ZSgnZGF0YS12YWxpZGF0aW9uJykpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZWxlbWVudHNbaV0uY2xhc3NMaXN0LmNvbnRhaW5zKCdlcnJvcicpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5zdWJtaXRCdXR0b24pIHtcclxuICAgICAgICAgICAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLnN1Ym1pdEJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLnN1Ym1pdEJ1dHRvbi5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIEJsYW5rXHJcbiAgICAgICAgdmFyIHRlc3QgPSAnJztcclxuICAgICAgICBpZiAoISBlbGVtZW50LnZhbHVlKSB7XHJcbiAgICAgICAgICAgIHRlc3QgPSBhZGRFcnJvcihlbGVtZW50KTtcclxuICAgICAgICB9IGVsc2UgaWYgKGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLWVtYWlsJykgJiYgISBlbWFpbENoZWNrZXIoZWxlbWVudC52YWx1ZSkpIHtcclxuICAgICAgICAgICAgdGVzdCA9IGFkZEVycm9yKGVsZW1lbnQpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2RhdGEtcGFzc3dvcmQnKSAmJiAhIGVtYWlsQ2hlY2tlcihlbGVtZW50LnZhbHVlKSkge1xyXG4gICAgICAgICAgICB0ZXN0ID0gYWRkRXJyb3IoZWxlbWVudCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKGVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdlcnJvcicpKSB7XHJcbiAgICAgICAgICAgICAgICBkZWxFcnJvcihlbGVtZW50KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRlc3Q7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gUnVuIGZvcm0gdmFsaWRhdGlvblxyXG4gICAgb2JqLnZhbGlkYXRlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIHRlc3QgPSAnJztcclxuICAgICAgICAvLyBHZXQgZWxlbWVudHMgaW4gdGhlIGZvcm1cclxuICAgICAgICB2YXIgZWxlbWVudHMgPSBlbC5xdWVyeVNlbGVjdG9yQWxsKFwiaW5wdXQsIHNlbGVjdCwgdGV4dGFyZWFcIik7XHJcbiAgICAgICAgLy8gUnVuIGFsbCBlbGVtZW50cyBcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmIChlbGVtZW50c1tpXS5nZXRBdHRyaWJ1dGUoJ2RhdGEtdmFsaWRhdGlvbicpKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGVzdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRlc3QgKz0gXCI8YnI+XFxyXFxuXCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0ZXN0ICs9IG9iai52YWxpZGF0ZUVsZW1lbnQoZWxlbWVudHNbaV0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0ZXN0O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENoZWNrIHRoZSBmb3JtXHJcbiAgICBvYmouZ2V0RXJyb3IgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAvLyBWYWxpZGF0aW9uXHJcbiAgICAgICAgcmV0dXJuIG9iai52YWxpZGF0aW9uKCkgPyB0cnVlIDogZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gUmV0dXJuIHRoZSBmb3JtIGhhc2hcclxuICAgIG9iai5zZXRIYXNoID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIG9iai5nZXRIYXNoKG9iai5nZXRFbGVtZW50cygpKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBHZXQgdGhlIGZvcm0gaGFzaFxyXG4gICAgb2JqLmdldEhhc2ggPSBmdW5jdGlvbihzdHIpIHtcclxuICAgICAgICB2YXIgaGFzaCA9IDAsIGksIGNocjtcclxuXHJcbiAgICAgICAgaWYgKHN0ci5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIGhhc2g7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgIGNociA9IHN0ci5jaGFyQ29kZUF0KGkpO1xyXG4gICAgICAgICAgICAgIGhhc2ggPSAoKGhhc2ggPDwgNSkgLSBoYXNoKSArIGNocjtcclxuICAgICAgICAgICAgICBoYXNoIHw9IDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBoYXNoO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIElzIHRoZXJlIGFueSBjaGFuZ2UgaW4gdGhlIGZvcm0gc2luY2Ugc3RhcnQgdHJhY2tpbmc/XHJcbiAgICBvYmouaXNDaGFuZ2VkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIGhhc2ggPSBvYmouc2V0SGFzaCgpO1xyXG4gICAgICAgIHJldHVybiAob2JqLm9wdGlvbnMuY3VycmVudEhhc2ggIT0gaGFzaCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gUmVzdGFydCB0cmFja2luZ1xyXG4gICAgb2JqLnJlc2V0VHJhY2tlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIG9iai5vcHRpb25zLmN1cnJlbnRIYXNoID0gb2JqLnNldEhhc2goKTtcclxuICAgICAgICBvYmoub3B0aW9ucy5pZ25vcmUgPSBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBvYmoucmVzZXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBvYmoub3B0aW9ucy5jdXJyZW50SGFzaCA9IG9iai5zZXRIYXNoKCk7XHJcbiAgICAgICAgb2JqLm9wdGlvbnMuaWdub3JlID0gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gSWdub3JlIGZsYWdcclxuICAgIG9iai5zZXRJZ25vcmUgPSBmdW5jdGlvbihpZ25vcmVGbGFnKSB7XHJcbiAgICAgICAgb2JqLm9wdGlvbnMuaWdub3JlID0gaWdub3JlRmxhZyA/IHRydWUgOiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBHZXQgZm9ybSBlbGVtZW50c1xyXG4gICAgb2JqLmdldEVsZW1lbnRzID0gZnVuY3Rpb24oYXNBcnJheSkge1xyXG4gICAgICAgIHZhciBkYXRhID0ge307XHJcbiAgICAgICAgdmFyIGVsZW1lbnRzID0gZWwucXVlcnlTZWxlY3RvckFsbChcImlucHV0LCBzZWxlY3QsIHRleHRhcmVhXCIpO1xyXG5cclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gZWxlbWVudHNbaV07XHJcbiAgICAgICAgICAgIHZhciBuYW1lID0gZWxlbWVudC5uYW1lO1xyXG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBlbGVtZW50LnZhbHVlO1xyXG5cclxuICAgICAgICAgICAgaWYgKG5hbWUpIHtcclxuICAgICAgICAgICAgICAgIGRhdGFbbmFtZV0gPSB2YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGFzQXJyYXkgPT0gdHJ1ZSA/IGRhdGEgOiBKU09OLnN0cmluZ2lmeShkYXRhKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBTdGFydCB0cmFja2luZyBpbiBvbmUgc2Vjb25kXHJcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIG9iai5vcHRpb25zLmN1cnJlbnRIYXNoID0gb2JqLnNldEhhc2goKTtcclxuICAgIH0sIDEwMDApO1xyXG5cclxuICAgIC8vIEFsZXJ0XHJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImJlZm9yZXVubG9hZFwiLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgIGlmIChvYmouaXNDaGFuZ2VkKCkgJiYgb2JqLm9wdGlvbnMuaWdub3JlID09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgIHZhciBjb25maXJtYXRpb25NZXNzYWdlID0gIG9iai5vcHRpb25zLm1lc3NhZ2U/IG9iai5vcHRpb25zLm1lc3NhZ2UgOiBcIlxcby9cIjtcclxuXHJcbiAgICAgICAgICAgIGlmIChjb25maXJtYXRpb25NZXNzYWdlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGUgPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICAgICAgICAgICAgICBlID0gd2luZG93LmV2ZW50O1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZS5yZXR1cm5WYWx1ZSA9IGNvbmZpcm1hdGlvbk1lc3NhZ2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpcm1hdGlvbk1lc3NhZ2U7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCgwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIC8vIFZhbGlkYXRpb25zXHJcbiAgICBlbC5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgZnVuY3Rpb24oZSkge1xyXG4gICAgICAgIGlmIChlLnRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtdmFsaWRhdGlvbicpKSB7XHJcbiAgICAgICAgICAgIG9iai52YWxpZGF0ZUVsZW1lbnQoZS50YXJnZXQpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIGVsLnRyYWNrZXIgPSBvYmo7XHJcblxyXG4gICAgcmV0dXJuIG9iajtcclxufSk7XHJcblxyXG5cclxuXHJcbiAgICByZXR1cm4galN1aXRlcztcclxuXHJcbn0pKSk7IiwiLy8gZXh0cmFjdGVkIGJ5IG1pbmktY3NzLWV4dHJhY3QtcGx1Z2luXG5leHBvcnQge307IiwiLy8gZXh0cmFjdGVkIGJ5IG1pbmktY3NzLWV4dHJhY3QtcGx1Z2luXG5leHBvcnQge307Il0sInNvdXJjZVJvb3QiOiIifQ==
